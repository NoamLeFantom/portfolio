var CABLES;
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	// The require scope
/******/ 	var __webpack_require__ = {};
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ core)
});

// NAMESPACE OBJECT: ./src/core/utils.js
var utils_namespaceObject = {};
__webpack_require__.r(utils_namespaceObject);
__webpack_require__.d(utils_namespaceObject, {
  UTILS: () => (UTILS),
  ajax: () => (ajax),
  ajaxSync: () => (ajaxSync),
  basename: () => (basename),
  cacheBust: () => (cacheBust),
  clamp: () => (clamp),
  cleanJson: () => (cleanJson),
  copyArray: () => (copyArray),
  filename: () => (filename),
  generateUUID: () => (generateUUID),
  getShortOpName: () => (getShortOpName),
  keyCodeToName: () => (keyCodeToName),
  logErrorConsole: () => (logErrorConsole),
  logStack: () => (logStack),
  map: () => (map),
  prefixedHash: () => (prefixedHash),
  request: () => (request),
  shortId: () => (shortId),
  shuffleArray: () => (shuffleArray),
  simpleId: () => (simpleId),
  smoothStep: () => (smoothStep),
  smootherStep: () => (smootherStep),
  uuid: () => (uuid)
});

// NAMESPACE OBJECT: ./src/core/anim.js
var anim_namespaceObject = {};
__webpack_require__.r(anim_namespaceObject);
__webpack_require__.d(anim_namespaceObject, {
  ANIM: () => (ANIM),
  Anim: () => (Anim)
});

;// CONCATENATED MODULE: ./src/core/constants.js
const CONSTANTS = {
    "ANIM": {
        "EASINGS": [
            "linear",
            "absolute",
            "smoothstep",
            "smootherstep",
            "Cubic In",
            "Cubic Out",
            "Cubic In Out",
            "Expo In",
            "Expo Out",
            "Expo In Out",
            "Sin In",
            "Sin Out",
            "Sin In Out",
            "Quart In",
            "Quart Out",
            "Quart In Out",
            "Quint In",
            "Quint Out",
            "Quint In Out",
            "Back In",
            "Back Out",
            "Back In Out",
            "Elastic In",
            "Elastic Out",
            "Bounce In",
            "Bounce Out",
        ],
        "EASING_LINEAR": 0,
        "EASING_ABSOLUTE": 1,
        "EASING_SMOOTHSTEP": 2,
        "EASING_SMOOTHERSTEP": 3,
        "EASING_CUBICSPLINE": 4,

        "EASING_CUBIC_IN": 5,
        "EASING_CUBIC_OUT": 6,
        "EASING_CUBIC_INOUT": 7,

        "EASING_EXPO_IN": 8,
        "EASING_EXPO_OUT": 9,
        "EASING_EXPO_INOUT": 10,

        "EASING_SIN_IN": 11,
        "EASING_SIN_OUT": 12,
        "EASING_SIN_INOUT": 13,

        "EASING_BACK_IN": 14,
        "EASING_BACK_OUT": 15,
        "EASING_BACK_INOUT": 16,

        "EASING_ELASTIC_IN": 17,
        "EASING_ELASTIC_OUT": 18,

        "EASING_BOUNCE_IN": 19,
        "EASING_BOUNCE_OUT": 21,

        "EASING_QUART_IN": 22,
        "EASING_QUART_OUT": 23,
        "EASING_QUART_INOUT": 24,

        "EASING_QUINT_IN": 25,
        "EASING_QUINT_OUT": 26,
        "EASING_QUINT_INOUT": 27,
    },

    "OP": {
        "OP_PORT_TYPE_VALUE": 0,
        "OP_PORT_TYPE_NUMBER": 0,
        "OP_PORT_TYPE_FUNCTION": 1,
        "OP_PORT_TYPE_TRIGGER": 1,
        "OP_PORT_TYPE_OBJECT": 2,
        "OP_PORT_TYPE_TEXTURE": 2,
        "OP_PORT_TYPE_ARRAY": 3,
        "OP_PORT_TYPE_DYNAMIC": 4,
        "OP_PORT_TYPE_STRING": 5,

        "OP_VERSION_PREFIX": "_v",
    },

    "PORT": {
        "PORT_DIR_IN": 0,
        "PORT_DIR_OUT": 1,
    },

    "PACO": {
        "PACO_CLEAR": 0,
        "PACO_VALUECHANGE": 1,
        "PACO_OP_DELETE": 2,
        "PACO_UNLINK": 3,
        "PACO_LINK": 4,
        "PACO_LOAD": 5,
        "PACO_OP_CREATE": 6,
        "PACO_OP_ENABLE": 7,
        "PACO_OP_DISABLE": 8,
        "PACO_UIATTRIBS": 9,
        "PACO_VARIABLES": 10,
        "PACO_TRIGGERS": 11,
        "PACO_PORT_SETVARIABLE": 12,
        "PACO_PORT_SETANIMATED": 13,
        "PACO_PORT_ANIM_UPDATED": 14,
        "PACO_DESERIALIZE": 15,
        "PACO_OP_RELOAD": 16
    },
};

;// CONCATENATED MODULE: ./src/core/utils.js

/**
 * @namespace external:CABLES#Utils
 */



const UTILS = {};
/**
 * Merge two Float32Arrays.
 * @function float32Concat
 * @memberof Utils
 * @param {Float32Array} first Left-hand side array
 * @param {Float32Array} second Right-hand side array
 * @return {Float32Array}
 * @static
 */
UTILS.float32Concat = function (first, second)
{
    if (!(first instanceof Float32Array)) first = new Float32Array(first);
    if (!(second instanceof Float32Array)) second = new Float32Array(second);

    const result = new Float32Array(first.length + second.length);

    result.set(first);
    result.set(second, first.length);

    return result;
};

/**
 * get op shortname: only last part of fullname and without version
 * @function getShortOpName
 * @memberof CABLES
 * @param {string} fullname full op name
 * @static
 */
const getShortOpName = function (fullname)
{
    let name = fullname.split(".")[fullname.split(".").length - 1];

    if (name.contains(CONSTANTS.OP.OP_VERSION_PREFIX))
    {
        const n = name.split(CONSTANTS.OP.OP_VERSION_PREFIX)[1];
        name = name.substring(0, name.length - (CONSTANTS.OP.OP_VERSION_PREFIX + n).length);
    }
    return name;
};

/**
 * randomize order of an array
 * @function shuffleArray
 * @memberof Utils
 * @param {Array|Float32Array} array {Array} original
 * @return {Array|Float32Array} shuffled array
 * @static
 */
const shuffleArray = function (array)
{
    for (let i = array.length - 1; i > 0; i--)
    {
        const j = Math.floor(Math.seededRandom() * (i + 1));
        const temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
};


/**
 * generate a short "relativly unique" id
 * @function shortId
 * @memberof Utils
 * @return {String} generated ID
 * @static
 */

const _shortIds = {};
const _shortId = function ()
{
    let str = Math.random().toString(36).substr(2, 9);

    if (_shortIds.hasOwnProperty(str)) str = _shortId();
    _shortIds[str] = true;
    return str;
};
const shortId = _shortId;


/**
 * generate a UUID
 * @function uuid
 * @memberof Utils
 * @return {String} generated UUID
 * @static
 */
const _uuid = function ()
{
    let d = new Date().getTime();
    const uuid = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) =>
    {
        const r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c == "x" ? r : (r & 0x3) | 0x8).toString(16);
    });
    return uuid;
};
const uuid = _uuid;
const generateUUID = _uuid;



function cleanJson(obj)
{
    for (const i in obj)
    {
        if (obj[i] && typeof objValue === "object" && obj[i].constructor === Object) obj[i] = cleanJson(obj[i]);

        if (obj[i] === null || obj[i] === undefined) delete obj[i];
        else if (Array.isArray(obj[i]) && obj[i].length == 0) delete obj[i];
    }

    return obj;
}


/**
 * @see http://stackoverflow.com/q/7616461/940217
 * @memberof Utils
 * @param str
 * @param prefix
 * @return {string}
 */
const _prefixedHash = function (str, prefix = "id")
{
    let hash = 0;
    if (Array.prototype.reduce)
    {
        hash = str.split("").reduce((a, b) => { a = ((a << 5) - a) + b.charCodeAt(0); return a & a; }, 0);
    }
    else
    {
        if (str.length > 0)
        {
            for (let i = 0; i < str.length; i++)
            {
                let character = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + character;
                hash &= hash; // Convert to 32bit integer
            }
        }
    }
    return prefix + "" + hash;
};
const prefixedHash = _prefixedHash;

/**
 * generate a simple ID
 * @function simpleId
 * @memberof Utils
 * @return {Number} new id
 * @static
 */
let simpleIdCounter = 0;
const simpleId = function ()
{
    simpleIdCounter++;
    return simpleIdCounter;
};

/**
 * smoothStep a value
 * @function smoothStep
 * @memberof Utils
 * @function
 * @param {Number} perc value value to be smoothed [0-1]
 * @return {Number} smoothed value
 * @static
 */
const smoothStep = function (perc)
{
    const x = Math.max(0, Math.min(1, (perc - 0) / (1 - 0)));
    perc = x * x * (3 - 2 * x); // smoothstep
    return perc;
};

/**
 * smootherstep a value
 * @function smootherStep
 * @memberof Utils
 * @param {Number} perc value to be smoothed [0-1]
 * @return {Number} smoothed value
 * @static
 */
const smootherStep = function (perc)
{
    const x = Math.max(0, Math.min(1, (perc - 0) / (1 - 0)));
    perc = x * x * x * (x * (x * 6 - 15) + 10); // smootherstep
    return perc;
};


/**
 * clamp number / make sure its between min/max
 * @function clamp
 * @memberof Utils
 * @param {Number} value value to be mapped
 * @param {Number} min minimum value
 * @param {Number} max maximum value
 * @static
 */
const clamp = function (value, min, max)
{
    return Math.min(Math.max(value, min), max);
};

/**
 * map a value in a range to a value in another range
 * @function map
 * @memberof Utils
 * @param {Number} x value to be mapped
 * @param {Number} _oldMin old range minimum value
 * @param {Number} _oldMax old range maximum value
 * @param {Number} _newMin new range minimum value
 * @param {Number} _newMax new range maximum value
 * @param {Number} _easing
 * @return {Number} mapped value
 * @static
 */
const map = function (x, _oldMin, _oldMax, _newMin, _newMax, _easing)
{
    if (x >= _oldMax) return _newMax;
    if (x <= _oldMin) return _newMin;

    let reverseInput = false;
    const oldMin = Math.min(_oldMin, _oldMax);
    const oldMax = Math.max(_oldMin, _oldMax);
    if (oldMin != _oldMin) reverseInput = true;

    let reverseOutput = false;
    const newMin = Math.min(_newMin, _newMax);
    const newMax = Math.max(_newMin, _newMax);
    if (newMin != _newMin) reverseOutput = true;

    let portion = 0;
    let r = 0;

    if (reverseInput) portion = ((oldMax - x) * (newMax - newMin)) / (oldMax - oldMin);
    else portion = ((x - oldMin) * (newMax - newMin)) / (oldMax - oldMin);

    if (reverseOutput) r = newMax - portion;
    else r = portion + newMin;

    if (!_easing) return r;
    if (_easing == 1)
    {
        // smoothstep
        x = Math.max(0, Math.min(1, (r - _newMin) / (_newMax - _newMin)));
        return _newMin + x * x * (3 - 2 * x) * (_newMax - _newMin);
    }
    if (_easing == 2)
    {
        // smootherstep
        x = Math.max(0, Math.min(1, (r - _newMin) / (_newMax - _newMin)));
        return _newMin + x * x * x * (x * (x * 6 - 15) + 10) * (_newMax - _newMin);
    }

    return r;
};

/**
 * @namespace Math
 */
/**
 * set random seed for seededRandom()
 * @memberof Math
 * @type Number
 * @static
 */
Math.randomSeed = 1;


Math.setRandomSeed = function (seed)
{
    // https://github.com/cables-gl/cables_docs/issues/622
    Math.randomSeed = seed * 50728129;
    if (seed != 0)
    {
        Math.randomSeed = Math.seededRandom() * 17624813;
        Math.randomSeed = Math.seededRandom() * 9737333;
    }
};


/**
 * generate a seeded random number
 * @function seededRandom
 * @memberof Math
 * @param {Number} max minimum possible random number
 * @param {Number} min maximum possible random number
 * @return {Number} random value
 * @static
 */
Math.seededRandom = function (max, min)
{
    if (Math.randomSeed === 0) Math.randomSeed = Math.random() * 999;
    max = max || 1;
    min = min || 0;

    Math.randomSeed = (Math.randomSeed * 9301 + 49297) % 233280;
    const rnd = Math.randomSeed / 233280.0;

    return min + rnd * (max - min);
};


// ----------------------------------------------------------------

/**
 * returns true if parameter is a number
 * @function isNumeric
 * @memberof Utils
 * @param {Any} n value The value to check.
 * @return {Boolean}
 * @static
 */
UTILS.isNumeric = function (n)
{
    return !isNaN(parseFloat(n)) && isFinite(n);
};

/**
 * returns true if parameter is array
 * @function isArray
 * @param {Any} v value Value to check
 * @memberof Utils
 * @return {Boolean}
 * @static
 */
UTILS.isArray = function (v)
{
    return Object.prototype.toString.call(v) === "[object Array]";
};

/**
 * @namespace String
 */

/**
 * append a linebreak to a string
 * @function endl
 * @memberof String
 * @return {String} string with newline break appended ('\n')
 */
String.prototype.endl = function ()
{
    return this + "\n";
};

/**
 * return true if string starts with prefix
 * @function startsWith
 * @memberof String
 * @param {String} prefix The prefix to check.
 * @return {Boolean}
 */
String.prototype.startsWith = function (prefix)
{
    if (!this || !prefix) return false;
    if (this.length >= prefix.length)
    {
        if (this.substring(0, prefix.length) == prefix) return true;
    }
    return false;
    // return this.indexOf(prefix) === 0;
};

/**
 * return true if string ends with suffix
 * @function endsWith
 * @memberof String
 * @param {String} suffix
 * @return {Boolean}
 */
String.prototype.endsWith = String.prototype.endsWith || function (suffix)
{
    return this.match(suffix + "$") == suffix;
};

/**
 * return true if string contains string
 * @function contains
 * @memberof String
 * @param {String} searchStr
 * @return {Boolean}
 */
String.prototype.contains = String.prototype.contains || function (searchStr)
{
    return this.indexOf(searchStr) > -1;
};



// ----------------------------------------------------------------

/**
 * append a unique/random parameter to a url, so the browser is forced to reload the file, even if its cached
 * @function cacheBust
 * @static
 * @memberof Utils
 * @param {String} url The url to append the cachebuster parameter to.
 * @return {String} url with cachebuster parameter
 */
const cacheBust = function (url = "")
{
    if (!url) return "";
    if (url.startsWith("data:")) return;
    if (url.contains("?")) url += "&";
    else url += "?";
    return url + "cache=" + CABLES.uuid();
};

/**
 * copy the content of an array
 * @function copyArray
 * @static
 * @memberof Utils
 * @param {Array} src sourceArray
 * @param {Array} dst optional
 * @return {Array} dst
 */
const copyArray = function (src, dst)
{
    if (!src) return null;
    dst = dst || [];
    dst.length = src.length;
    for (let i = 0; i < src.length; i++)
    {
        dst[i] = src[i];
    }

    return dst;
};


/**
 * return the filename part of a url without extension
 * @function basename
 * @static
 * @memberof Utils
 * @param {String} url
 * @return {String} just the filename
 */
const basename = function (url)
{
    let name = CABLES.filename(url);

    const parts2 = name.split(".");
    name = parts2[0];

    return name;
};

/**
 * output a stacktrace to the console
 * @function logStack
 * @static
 * @memberof Utils
 */
const logStack = function ()
{
    console.log("logstack", (new Error()).stack);
};

/**
 * return the filename part of a url
 * @function filename
 * @static
 * @memberof Utils
 * @param {String} url
 * @return {String} just the filename
 */
const filename = function (url)
{
    let name = "";
    if (!url) return "";

    if (url.startsWith("data:") && url.contains(":"))
    {
        const parts = url.split(",");
        return parts[0];
    }

    let parts = (url + "").split("/");
    if (parts.length > 0)
    {
        const str = parts[parts.length - 1];
        let parts2 = str.split("?");
        name = parts2[0];
    }

    return name || "";
};


const ajaxSync = function (url, cb, method, post, contenttype)
{
    request({
        "url": url,
        "cb": cb,
        "method": method,
        "data": post,
        "contenttype": contenttype,
        "sync": true,
    });
};

/**
 * make an ajax request
 * @static
 * @function ajax
 * @param url
 * @param cb
 * @param method
 * @param post
 * @param contenttype
 * @param jsonP
 * @param headers
 * @param options
 */
const ajax = function (url, cb, method, post, contenttype, jsonP, headers = {}, options = {})
{
    const requestOptions = {
        "url": url,
        "cb": cb,
        "method": method,
        "data": post,
        "contenttype": contenttype,
        "sync": false,
        "jsonP": jsonP,
        "headers": headers,
    };
    if (options && options.credentials) requestOptions.credentials = options.credentials;
    request(requestOptions);
};

const request = function (options)
{
    if (!options.hasOwnProperty("asynch")) options.asynch = true;

    let xhr;
    try
    {
        xhr = new XMLHttpRequest();
    }
    catch (e) {}

    xhr.onreadystatechange = function ()
    {
        if (xhr.readyState != 4) return;

        if (options.cb)
        {
            if (xhr.status == 200 || xhr.status == 0) options.cb(false, xhr.responseText, xhr);
            else options.cb(true, xhr.responseText, xhr);
        }
    };

    try
    {
        xhr.open(options.method ? options.method.toUpperCase() : "GET", options.url, !options.sync);
    }
    catch (e)
    {
        if (options.cb && e) options.cb(true, e.msg, xhr);
    }

    if (typeof options.headers === "object")
    {
        if (options.headers)
        {
            const keys = Object.keys(options.headers);
            for (let i = 0; i < keys.length; i++)
            {
                const name = keys[i];
                const value = options.headers[name];
                xhr.setRequestHeader(name, value);
            }
        }
    }

    if (options.credentials && options.credentials !== "omit")
    {
        xhr.withCredentials = true;
    }

    try
    {
        if (!options.post && !options.data)
        {
            xhr.send();
        }
        else
        {
            xhr.setRequestHeader(
                "Content-type",
                options.contenttype ? options.contenttype : "application/x-www-form-urlencoded",
            );
            xhr.send(options.data || options.post);
        }
    }
    catch (e)
    {
        if (options.cb) options.cb(true, e.msg, xhr);
    }
};


const keyCodeToName = function (keyCode)
{
    if (!keyCode && keyCode !== 0) return "Unidentified";
    const keys = {
        "8": "Backspace",
        "9": "Tab",
        "12": "Clear",
        "13": "Enter",
        "16": "Shift",
        "17": "Control",
        "18": "Alt",
        "19": "Pause",
        "20": "CapsLock",
        "27": "Escape",
        "32": "Space",
        "33": "PageUp",
        "34": "PageDown",
        "35": "End",
        "36": "Home",
        "37": "ArrowLeft",
        "38": "ArrowUp",
        "39": "ArrowRight",
        "40": "ArrowDown",
        "45": "Insert",
        "46": "Delete",
        "112": "F1",
        "113": "F2",
        "114": "F3",
        "115": "F4",
        "116": "F5",
        "117": "F6",
        "118": "F7",
        "119": "F8",
        "120": "F9",
        "121": "F10",
        "122": "F11",
        "123": "F12",
        "144": "NumLock",
        "145": "ScrollLock",
        "224": "Meta"
    };
    if (keys[keyCode])
    {
        return keys[keyCode];
    }
    else
    {
        return String.fromCharCode(keyCode);
    }
};
// ----------------------------------------------------------------

window.performance = window.performance || {
    "offset": Date.now(),
    "now": function now()
    {
        return Date.now() - this.offset;
    },
};


const logErrorConsole = function (initiator)
{
    CABLES.errorConsole = CABLES.errorConsole || { "log": [] };
    CABLES.errorConsole.log.push({ "initiator": initiator, "arguments": arguments });

    if (!CABLES.errorConsole.ele)
    {
        const ele = document.createElement("div");
        ele.id = "cablesErrorConsole";
        ele.style.width = "90%";
        ele.style.height = "300px";
        ele.style.zIndex = "9999999";
        ele.style.display = "inline-block";
        ele.style.position = "absolute";
        ele.style.padding = "10px";
        ele.style.fontFamily = "monospace";
        ele.style.color = "red";
        ele.style.backgroundColor = "#200";

        CABLES.errorConsole.ele = ele;
        document.body.appendChild(ele);
    }

    let logHtml = "ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";

    for (let l = 0; l < CABLES.errorConsole.log.length; l++)
    {
        logHtml += CABLES.errorConsole.log[l].initiator + " ";
        for (let i = 1; i < CABLES.errorConsole.log[l].arguments.length; i++)
        {
            if (i > 2)logHtml += ", ";
            let arg = CABLES.errorConsole.log[l].arguments[i];
            if (arg.constructor.name.indexOf("Error") > -1 || arg.constructor.name.indexOf("error") > -1)
            {
                let txt = "Uncaught ErrorEvent ";
                if (arg.message)txt += " message: " + arg.message;
                logHtml += txt;
            }
            else if (typeof arg == "string")
                logHtml += arg;
            else if (typeof arg == "number")
                logHtml += String(arg) + " ";
        }
        logHtml += "<br/>";
    }


    CABLES.errorConsole.ele.innerHTML = logHtml;
};




;// CONCATENATED MODULE: ../shared/client/src/logger.js
/* eslint-disable no-console */

class Logger
{
    constructor(initiator, options)
    {
        this.initiator = initiator;
        this._options = options;
    }

    stack(t)
    {
        console.info("[" + this.initiator + "] ", t);
        console.log((new Error()).stack);
    }

    groupCollapsed(t)
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 0 }, ...arguments)) || !CABLES.logSilent) console.log("[" + this.initiator + "]", ...arguments);

        console.groupCollapsed("[" + this.initiator + "] " + t);
    }

    table(t)
    {
        console.table(t);
    }

    groupEnd()
    {
        console.groupEnd();
    }

    error()
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 2 }, ...arguments)) || !CABLES.UI)
        {
            console.error("[" + this.initiator + "]", ...arguments);
        }

        if (this._options && this._options.onError)
        {
            this._options.onError(this.initiator, ...arguments);
            // console.log("emitevent onerror...");
            // CABLES.patch.emitEvent("onError", this.initiator, ...arguments);
            // CABLES.logErrorConsole("[" + this.initiator + "]", ...arguments);
        }
    }

    errorGui()
    {
        if (CABLES.UI) CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 2 }, ...arguments);
    }

    warn()
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 1 }, ...arguments)) || !CABLES.logSilent)
            console.warn("[" + this.initiator + "]", ...arguments);
    }

    verbose()
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 0 }, ...arguments)) || !CABLES.logSilent)
            console.log("[" + this.initiator + "]", ...arguments);
    }

    info()
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 0 }, ...arguments)) || !CABLES.logSilent)
            console.info("[" + this.initiator + "]", ...arguments);
    }

    log()
    {
        if ((CABLES.UI && CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 0 }, ...arguments)) || !CABLES.logSilent)
            console.log("[" + this.initiator + "]", ...arguments);
    }

    logGui()
    {
        if (CABLES.UI) CABLES.UI.logFilter.filterLog({ "initiator": this.initiator, "level": 0 }, ...arguments);
    }

    userInteraction(text)
    {
        // this.log({ "initiator": "userinteraction", "text": text });
    }
}

;// CONCATENATED MODULE: ./src/core/anim_key.js


const Key = function (obj)
{
    this.time = 0.0;
    this.value = 0.0;
    // this.ui = null;
    this.onChange = null;
    this._easing = 0;
    // this.bezTangIn = 0;
    // this.bezTangOut = 0;
    // this.bezTime = 0.5;
    // this.bezValue = 0;
    // this.bezTimeIn = -0.5;
    // this.bezValueIn = 0;

    this.cb = null;
    this.cbTriggered = false;

    // const bezierAnim = null;
    // this._updateBezier = false;

    this.setEasing(CONSTANTS.ANIM.EASING_LINEAR);
    this.set(obj);
};

Key.cubicSpline = function (perc, key1, key2)
{
    let
        previousPoint = key1.value,
        previousTangent = key1.bezTangOut,
        nextPoint = key2.value,
        nextTangent = key2.bezTangIn;
    let t = perc;
    let t2 = t * t;
    let t3 = t2 * t;

    return (2 * t3 - 3 * t2 + 1) * previousPoint + (t3 - 2 * t2 + t) * previousTangent + (-2 * t3 + 3 * t2) * nextPoint + (t3 - t2) * nextTangent;
};

Key.easeCubicSpline = function (perc, key2)
{
    return Key.cubicSpline(perc, this, key2);
};


Key.linear = function (perc, key1, key2)
{
    return parseFloat(key1.value) + parseFloat(key2.value - key1.value) * perc;
};

Key.easeLinear = function (perc, key2)
{
    return Key.linear(perc, this, key2);
};

Key.easeAbsolute = function (perc, key2)
{
    return this.value;
};

const easeExpoIn = function (t)
{
    return (t = 2 ** (10 * (t - 1)));
};

Key.easeExpoIn = function (t, key2)
{
    t = easeExpoIn(t);
    return Key.linear(t, this, key2);
};

const easeExpoOut = function (t)
{
    t = -(2 ** (-10 * t)) + 1;
    return t;
};

Key.easeExpoOut = function (t, key2)
{
    t = easeExpoOut(t);
    return Key.linear(t, this, key2);
};

const easeExpoInOut = function (t)
{
    t *= 2;
    if (t < 1)
    {
        t = 0.5 * 2 ** (10 * (t - 1));
    }
    else
    {
        t--;
        t = 0.5 * (-(2 ** (-10 * t)) + 2);
    }
    return t;
};

Key.easeExpoInOut = function (t, key2)
{
    t = easeExpoInOut(t);
    return Key.linear(t, this, key2);
};

Key.easeSinIn = function (t, key2)
{
    t = -1 * Math.cos((t * Math.PI) / 2) + 1;
    return Key.linear(t, this, key2);
};

Key.easeSinOut = function (t, key2)
{
    t = Math.sin((t * Math.PI) / 2);
    return Key.linear(t, this, key2);
};

Key.easeSinInOut = function (t, key2)
{
    t = -0.5 * (Math.cos(Math.PI * t) - 1.0);
    return Key.linear(t, this, key2);
};

const easeCubicIn = function (t)
{
    t = t * t * t;
    return t;
};

Key.easeCubicIn = function (t, key2)
{
    t = easeCubicIn(t);
    return Key.linear(t, this, key2);
};


// b 0
// c 1/2 or 1
// d always 1
// easeOutCubic: function (x, t, b, c, d) {
//     return c*((t=t/d-1)*t*t + 1) + b;

Key.easeInQuint = function (t, key2)
{
    t = t * t * t * t * t;
    return Key.linear(t, this, key2);
};
Key.easeOutQuint = function (t, key2)
{
    t = (t -= 1) * t * t * t * t + 1;
    return Key.linear(t, this, key2);
};
Key.easeInOutQuint = function (t, key2)
{
    if ((t /= 0.5) < 1) t = 0.5 * t * t * t * t * t;
    else t = 0.5 * ((t -= 2) * t * t * t * t + 2);
    return Key.linear(t, this, key2);
};

Key.easeInQuart = function (t, key2)
{
    t = t * t * t * t;
    return Key.linear(t, this, key2);
};

Key.easeOutQuart = function (t, key2)
{
    // return -c * ((t=t/d-1)*t*t*t - 1) + b;
    t = -1 * ((t -= 1) * t * t * t - 1);
    return Key.linear(t, this, key2);
};

Key.easeInOutQuart = function (t, key2)
{
    if ((t /= 0.5) < 1) t = 0.5 * t * t * t * t;
    else t = -0.5 * ((t -= 2) * t * t * t - 2);
    return Key.linear(t, this, key2);
};

Key.bounce = function (t)
{
    if ((t /= 1) < 1 / 2.75) t = 7.5625 * t * t;
    else if (t < 2 / 2.75) t = 7.5625 * (t -= 1.5 / 2.75) * t + 0.75;
    else if (t < 2.5 / 2.75) t = 7.5625 * (t -= 2.25 / 2.75) * t + 0.9375;
    else t = 7.5625 * (t -= 2.625 / 2.75) * t + 0.984375;
    return t;
};

Key.easeInBounce = function (t, key2)
{
    return Key.linear(Key.bounce(t), this, key2);
    // return c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d);
};

Key.easeOutBounce = function (t, key2)
{
    return Key.linear(Key.bounce(t), this, key2);
};

Key.easeInElastic = function (t, key2)
{
    let s = 1.70158;
    let p = 0;
    let a = 1;

    const b = 0;
    const d = 1;
    const c = 1;

    if (t === 0) t = b;
    else if ((t /= d) == 1) t = b + c;
    else
    {
        if (!p) p = d * 0.3;
        if (a < Math.abs(c))
        {
            a = c;
            s = p / 4;
        }
        else s = (p / (2 * Math.PI)) * Math.asin(c / a);
        t = -(a * 2 ** (10 * (t -= 1)) * Math.sin(((t * d - s) * (2 * Math.PI)) / p)) + b;
    }

    return Key.linear(t, this, key2);
};


Key.easeOutElastic = function (t, key2)
{
    let s = 1.70158;
    let p = 0;
    let a = 1;

    const b = 0;
    const d = 1;
    const c = 1;

    if (t === 0) t = b;
    else if ((t /= d) == 1) t = b + c;
    else
    {
        if (!p) p = d * 0.3;
        if (a < Math.abs(c))
        {
            a = c;
            s = p / 4;
        }
        else s = (p / (2 * Math.PI)) * Math.asin(c / a);
        t = a * 2 ** (-10 * t) * Math.sin(((t * d - s) * (2 * Math.PI)) / p) + c + b;
    }

    return Key.linear(t, this, key2);
};

Key.easeInBack = function (t, key2)
{
    const s = 1.70158;
    t = t * t * ((s + 1) * t - s);

    return Key.linear(t, this, key2);
};

Key.easeOutBack = function (t, key2)
{
    const s = 1.70158;
    t = (t = t / 1 - 1) * t * ((s + 1) * t + s) + 1;

    return Key.linear(t, this, key2);
};

Key.easeInOutBack = function (t, key2)
{
    let s = 1.70158;
    const c = 1 / 2;
    if ((t /= 1 / 2) < 1) t = c * (t * t * (((s *= 1.525) + 1) * t - s));
    else t = c * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2);

    return Key.linear(t, this, key2);
};

const easeCubicOut = function (t)
{
    t--;
    t = t * t * t + 1;
    return t;
};

Key.easeCubicOut = function (t, key2)
{
    t = easeCubicOut(t);
    return Key.linear(t, this, key2);
};

const easeCubicInOut = function (t)
{
    t *= 2;
    if (t < 1) t = 0.5 * t * t * t;
    else
    {
        t -= 2;
        t = 0.5 * (t * t * t + 2);
    }
    return t;
};

Key.easeCubicInOut = function (t, key2)
{
    t = easeCubicInOut(t);
    return Key.linear(t, this, key2);
};

Key.easeSmoothStep = function (perc, key2)
{
    // var x = Math.max(0, Math.min(1, (perc-0)/(1-0)));
    const x = Math.max(0, Math.min(1, perc));
    perc = x * x * (3 - 2 * x); // smoothstep
    return Key.linear(perc, this, key2);
};

Key.easeSmootherStep = function (perc, key2)
{
    const x = Math.max(0, Math.min(1, (perc - 0) / (1 - 0)));
    perc = x * x * x * (x * (x * 6 - 15) + 10); // smootherstep
    return Key.linear(perc, this, key2);
};

Key.prototype.setEasing = function (e)
{
    this._easing = e;

    if (this._easing == CONSTANTS.ANIM.EASING_LINEAR) this.ease = Key.easeLinear;
    else if (this._easing == CONSTANTS.ANIM.EASING_ABSOLUTE) this.ease = Key.easeAbsolute;
    else if (this._easing == CONSTANTS.ANIM.EASING_SMOOTHSTEP) this.ease = Key.easeSmoothStep;
    else if (this._easing == CONSTANTS.ANIM.EASING_SMOOTHERSTEP) this.ease = Key.easeSmootherStep;
    else if (this._easing == CONSTANTS.ANIM.EASING_CUBIC_IN) this.ease = Key.easeCubicIn;
    else if (this._easing == CONSTANTS.ANIM.EASING_CUBIC_OUT) this.ease = Key.easeCubicOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_CUBIC_INOUT) this.ease = Key.easeCubicInOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_EXPO_IN) this.ease = Key.easeExpoIn;
    else if (this._easing == CONSTANTS.ANIM.EASING_EXPO_OUT) this.ease = Key.easeExpoOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_EXPO_INOUT) this.ease = Key.easeExpoInOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_SIN_IN) this.ease = Key.easeSinIn;
    else if (this._easing == CONSTANTS.ANIM.EASING_SIN_OUT) this.ease = Key.easeSinOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_SIN_INOUT) this.ease = Key.easeSinInOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_BACK_OUT) this.ease = Key.easeOutBack;
    else if (this._easing == CONSTANTS.ANIM.EASING_BACK_IN) this.ease = Key.easeInBack;
    else if (this._easing == CONSTANTS.ANIM.EASING_BACK_INOUT) this.ease = Key.easeInOutBack;
    else if (this._easing == CONSTANTS.ANIM.EASING_ELASTIC_IN) this.ease = Key.easeInElastic;
    else if (this._easing == CONSTANTS.ANIM.EASING_ELASTIC_OUT) this.ease = Key.easeOutElastic;
    else if (this._easing == CONSTANTS.ANIM.EASING_ELASTIC_INOUT) this.ease = Key.easeElasticInOut;
    else if (this._easing == CONSTANTS.ANIM.EASING_BOUNCE_IN) this.ease = Key.easeInBounce;
    else if (this._easing == CONSTANTS.ANIM.EASING_BOUNCE_OUT) this.ease = Key.easeOutBounce;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUART_OUT) this.ease = Key.easeOutQuart;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUART_IN) this.ease = Key.easeInQuart;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUART_INOUT) this.ease = Key.easeInOutQuart;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUINT_OUT) this.ease = Key.easeOutQuint;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUINT_IN) this.ease = Key.easeInQuint;
    else if (this._easing == CONSTANTS.ANIM.EASING_QUINT_INOUT) this.ease = Key.easeInOutQuint;
    else if (this._easing == CONSTANTS.ANIM.EASING_CUBICSPLINE)
    {
        // this._updateBezier = true;
        this.ease = Key.easeCubicSpline;
    }
    else
    {
        this._easing = CONSTANTS.ANIM.EASING_LINEAR;
        this.ease = Key.easeLinear;
    }
};

Key.prototype.trigger = function ()
{
    this.cb();
    this.cbTriggered = true;
};

Key.prototype.setValue = function (v)
{
    this.value = v;
    // this._updateBezier = true;
    if (this.onChange !== null) this.onChange();
};

Key.prototype.set = function (obj)
{
    if (obj)
    {
        if (obj.e) this.setEasing(obj.e);
        if (obj.cb)
        {
            this.cb = obj.cb;
            this.cbTriggered = false;
        }

        if (obj.b)
        {
            // this.bezTime = obj.b[0];
            // this.bezValue = obj.b[1];
            // this.bezTimeIn = obj.b[2];
            // this.bezValueIn = obj.b[3];
            // this._updateBezier = true;
        }

        if (obj.hasOwnProperty("t")) this.time = obj.t;
        if (obj.hasOwnProperty("time")) this.time = obj.time;
        if (obj.hasOwnProperty("v")) this.value = obj.v;
        else if (obj.hasOwnProperty("value")) this.value = obj.value;
    }
    if (this.onChange !== null) this.onChange();
};

Key.prototype.getSerialized = function ()
{
    const obj = {};
    obj.t = this.time;
    obj.v = this.value;
    obj.e = this._easing;
    // if (this._easing == CONSTANTS.ANIM.EASING_CUBICSPLINE) obj.b = [this.bezTime, this.bezValue, this.bezTimeIn, this.bezValueIn];

    return obj;
};

Key.prototype.getEasing = function ()
{
    return this._easing;
};



;// CONCATENATED MODULE: ./src/core/eventtarget.js


const EventTarget = function ()
{
    this._log = new Logger("eventtarget");
    this._eventCallbacks = {};
    this._logName = "";
    this._logEvents = false;
    this._listeners = {};

    this.addEventListener = this.on = function (which, cb, idPrefix)
    {
        const event =
        {
            "id": (idPrefix || "") + CABLES.simpleId(),
            "name": which,
            "cb": cb,
        };
        if (!this._eventCallbacks[which]) this._eventCallbacks[which] = [event];
        else this._eventCallbacks[which].push(event);

        this._listeners[event.id] = event;

        return event.id;
    };

    this.hasEventListener = function (which, cb)
    {
        if (which && !cb)
        {
            // check by id
            if (this._listeners[which]) return true;
            else return false;
        }
        else
        {
            this._log.warn("old eventtarget function haseventlistener!");
            if (which && cb)
            {
                if (this._eventCallbacks[which])
                {
                    const idx = this._eventCallbacks[which].indexOf(cb);
                    if (idx == -1) return false;
                    return true;
                }
            }
        }
    };

    this.hasListenerForEventName = function (eventName)
    {
        return this._eventCallbacks[eventName] && this._eventCallbacks[eventName].length > 0;
    };

    this.removeEventListener = this.off = function (which, cb)
    {
        if (which === null || which === undefined) return;

        if (!cb) // new style, remove by id, not by name/callback
        {
            const event = this._listeners[which];
            if (!event)
            {
                this._log.log("removeEvent: could not find event...", which, this);
                return;
            }

            let found = true;
            while (found)
            {
                found = false;
                let index = -1;
                for (let i = 0; i < this._eventCallbacks[event.name].length; i++)
                {
                    if (this._eventCallbacks[event.name][i].id.startsWith(which)) // this._eventCallbacks[event.name][i].id == which ||
                    {
                        found = true;
                        index = i;
                    }
                }

                if (index !== -1)
                {
                    this._eventCallbacks[event.name].splice(index, 1);
                    delete this._listeners[which];
                }
            }

            return;
        }

        this._log.info("[eventtaget] ", "old function signature: removeEventListener! use listener id");
        this._log.log((new Error()).stack);

        let index = null;
        for (let i = 0; i < this._eventCallbacks[which].length; i++)
            if (this._eventCallbacks[which][i].cb == cb)
                index = i;

        if (index !== null)
        {
            delete this._eventCallbacks[index];
        }
        else this._log.warn("removeEventListener not found " + which);
    };

    this.logEvents = function (enabled, name)
    {
        this._logEvents = enabled;
        this._logName = name;
    };

    this.emitEvent = function (which, param1, param2, param3, param4, param5, param6)
    {
        if (this._logEvents) this._log.log("[event] ", this._logName, which, this._eventCallbacks);

        if (this._eventCallbacks[which])
        {
            for (let i = 0; i < this._eventCallbacks[which].length; i++)
            {
                if (this._eventCallbacks[which][i])
                {
                    this._eventCallbacks[which][i].cb(param1, param2, param3, param4, param5, param6);
                }
            }
        }
        else
        {
            if (this._logEvents) this._log.log("[event] has no event callback", which, this._eventCallbacks);
        }
    };
};



;// CONCATENATED MODULE: ./src/core/anim.js





/**
 * Keyframed interpolated animation.
 *
 * Available Easings:
 * <code>
 * CONSTANTS.ANIM.EASING_LINEAR
 * CONSTANTS.ANIM.EASING_ABSOLUTE
 * CONSTANTS.ANIM.EASING_SMOOTHSTEP
 * CONSTANTS.ANIM.EASING_SMOOTHERSTEP
 * CONSTANTS.ANIM.EASING_CUBICSPLINE

 * CONSTANTS.ANIM.EASING_CUBIC_IN
 * CONSTANTS.ANIM.EASING_CUBIC_OUT
 * CONSTANTS.ANIM.EASING_CUBIC_INOUT

 * CONSTANTS.ANIM.EASING_EXPO_IN
 * CONSTANTS.ANIM.EASING_EXPO_OUT
 * CONSTANTS.ANIM.EASING_EXPO_INOUT

 * CONSTANTS.ANIM.EASING_SIN_IN
 * CONSTANTS.ANIM.EASING_SIN_OUT
 * CONSTANTS.ANIM.EASING_SIN_INOUT

 * CONSTANTS.ANIM.EASING_BACK_IN
 * CONSTANTS.ANIM.EASING_BACK_OUT
 * CONSTANTS.ANIM.EASING_BACK_INOUT

 * CONSTANTS.ANIM.EASING_ELASTIC_IN
 * CONSTANTS.ANIM.EASING_ELASTIC_OUT

 * CONSTANTS.ANIM.EASING_BOUNCE_IN
 * CONSTANTS.ANIM.EASING_BOUNCE_OUT

 * CONSTANTS.ANIM.EASING_QUART_IN
 * CONSTANTS.ANIM.EASING_QUART_OUT
 * CONSTANTS.ANIM.EASING_QUART_INOUT

 * CONSTANTS.ANIM.EASING_QUINT_IN
 * CONSTANTS.ANIM.EASING_QUINT_OUT
 * CONSTANTS.ANIM.EASING_QUINT_INOUT
 * </code>
 * @class
 * @param cfg
 * @example
 * var anim=new CABLES.Anim();
 * anim.setValue(0,0);  // set value 0 at 0 seconds
 * anim.setValue(10,1); // set value 1 at 10 seconds
 * anim.getValue(5);    // get value at 5 seconds - this returns 0.5
 */

const Anim = function (cfg)
{
    EventTarget.apply(this);

    cfg = cfg || {};
    this.keys = [];
    this.onChange = null;
    this.stayInTimeline = false;
    this.loop = false;
    this._log = new Logger("Anim");
    this._lastKeyIndex = 0;
    this._cachedIndex = 0;
    this.name = cfg.name || null;

    /**
     * @member defaultEasing
     * @memberof Anim
     * @instance
     * @type {Number}
     */
    this.defaultEasing = cfg.defaultEasing || CONSTANTS.ANIM.EASING_LINEAR;
    this.onLooped = null;

    this._timesLooped = 0;
    this._needsSort = false;
};

Anim.prototype.forceChangeCallback = function ()
{
    if (this.onChange !== null) this.onChange();
    this.emitEvent("onChange", this);
};

Anim.prototype.getLoop = function ()
{
    return this.loop;
};

Anim.prototype.setLoop = function (target)
{
    this.loop = target;
    this.emitEvent("onChange", this);
};

/**
 * returns true if animation has ended at @time
 * checks if last key time is < time
 * @param {Number} time
 * @returns {Boolean}
 * @memberof Anim
 * @instance
 * @function
 */
Anim.prototype.hasEnded = function (time)
{
    if (this.keys.length === 0) return true;
    if (this.keys[this._lastKeyIndex].time <= time) return true;
    return false;
};

Anim.prototype.isRising = function (time)
{
    if (this.hasEnded(time)) return false;
    const ki = this.getKeyIndex(time);
    if (this.keys[ki].value < this.keys[ki + 1].value) return true;
    return false;
};

/**
 * remove all keys from animation before time
 * @param {Number} time
 * @memberof Anim
 * @instance
 * @function
 */
Anim.prototype.clearBefore = function (time)
{
    const v = this.getValue(time);
    const ki = this.getKeyIndex(time);

    this.setValue(time, v);

    if (ki > 1) this.keys.splice(0, ki);
    this._updateLastIndex();
};
/**
 * remove all keys from animation
 * @param {Number} [time=0] set a new key at time with the old value at time
 * @memberof Anim
 * @instance
 * @function
 */
Anim.prototype.clear = function (time)
{
    let v = 0;
    if (time) v = this.getValue(time);
    this.keys.length = 0;
    this._updateLastIndex();
    if (time) this.setValue(time, v);
    if (this.onChange !== null) this.onChange();
    this.emitEvent("onChange", this);
};

Anim.prototype.sortKeys = function ()
{
    this.keys.sort((a, b) => { return parseFloat(a.time) - parseFloat(b.time); });
    this._updateLastIndex();
    this._needsSort = false;
    if (this.keys.length % 1000 == 0)console.log(this.name, this.keys.length);
};

Anim.prototype.getLength = function ()
{
    if (this.keys.length === 0) return 0;
    return this.keys[this.keys.length - 1].time;
};

Anim.prototype.getKeyIndex = function (time)
{
    let index = 0;
    let start = 0;
    if (this._cachedIndex && this.keys.length > this._cachedIndex && time >= this.keys[this._cachedIndex].time) start = this._cachedIndex;
    for (let i = start; i < this.keys.length; i++)
    {
        if (time >= this.keys[i].time) index = i;
        if (this.keys[i].time > time)
        {
            if (time != 0) this._cachedIndex = index;
            return index;
        }
    }

    return index;
};

/**
 * set value at time
 * @function setValue
 * @memberof Anim
 * @instance
 * @param {Number} time
 * @param {Number} value
 * @param {Function} cb callback
 */
Anim.prototype.setValue = function (time, value, cb)
{
    let found = null;

    if (this.keys.length == 0 || time <= this.keys[this.keys.length - 1].time)
        for (let i = 0; i < this.keys.length; i++)
            if (this.keys[i].time == time)
            {
                found = this.keys[i];
                this.keys[i].setValue(value);
                this.keys[i].cb = cb;
                break;
            }

    if (!found)
    {
        found = new Key(
            {
                "time": time,
                "value": value,
                "e": this.defaultEasing,
                "cb": cb,
            });
        this.keys.push(found);

        // if (this.keys.length % 1000 == 0)console.log(this.name, this.keys.length);
        this._updateLastIndex();
    }

    if (this.onChange) this.onChange();
    this.emitEvent("onChange", this);
    this._needsSort = true;
    return found;
};

Anim.prototype.setKeyEasing = function (index, e)
{
    if (this.keys[index])
    {
        this.keys[index].setEasing(e);
        this.emitEvent("onChange", this);
    }
};

Anim.prototype.getSerialized = function ()
{
    const obj = {};
    obj.keys = [];
    obj.loop = this.loop;

    for (let i = 0; i < this.keys.length; i++)
        obj.keys.push(this.keys[i].getSerialized());

    return obj;
};

Anim.prototype.getKey = function (time)
{
    const index = this.getKeyIndex(time);
    return this.keys[index];
};

Anim.prototype.getNextKey = function (time)
{
    let index = this.getKeyIndex(time) + 1;
    if (index >= this.keys.length) index = this.keys.length - 1;

    return this.keys[index];
};

Anim.prototype.isFinished = function (time)
{
    if (this.keys.length <= 0) return true;
    return time > this.keys[this.keys.length - 1].time;
};

Anim.prototype.isStarted = function (time)
{
    if (this.keys.length <= 0) return false;
    return time >= this.keys[0].time;
};

/**
 * get value at time
 * @function getValue
 * @memberof Anim
 * @instance
 * @param {Number} [time] time
 * @returns {Number} interpolated value at time
 */
Anim.prototype.getValue = function (time)
{
    if (this.keys.length === 0)
    {
        return 0;
    }
    if (this._needsSort) this.sortKeys();

    if (!this.loop && time > this.keys[this._lastKeyIndex].time)
    {
        if (this.keys[this._lastKeyIndex].cb && !this.keys[this._lastKeyIndex].cbTriggered) this.keys[this._lastKeyIndex].trigger();

        return this.keys[this._lastKeyIndex].value;
    }

    if (time < this.keys[0].time)
    {
        // if (this.name)console.log("A");

        return this.keys[0].value;
    }

    if (this.loop && time > this.keys[this._lastKeyIndex].time)
    {
        const currentLoop = time / this.keys[this._lastKeyIndex].time;
        if (currentLoop > this._timesLooped)
        {
            this._timesLooped++;
            if (this.onLooped) this.onLooped();
        }
        time = (time - this.keys[0].time) % (this.keys[this._lastKeyIndex].time - this.keys[0].time);
        time += this.keys[0].time;
    }

    const index = this.getKeyIndex(time);
    if (index >= this._lastKeyIndex)
    {
        if (this.keys[this._lastKeyIndex].cb && !this.keys[this._lastKeyIndex].cbTriggered) this.keys[this._lastKeyIndex].trigger();

        return this.keys[this._lastKeyIndex].value;
    }


    const index2 = index + 1;
    const key1 = this.keys[index];
    const key2 = this.keys[index2];

    if (key1.cb && !key1.cbTriggered) key1.trigger();

    if (!key2) return -1;

    const perc = (time - key1.time) / (key2.time - key1.time);

    if (!key1.ease) this.log._warn("has no ease", key1, key2);

    return key1.ease(perc, key2);
};

Anim.prototype._updateLastIndex = function ()
{
    this._lastKeyIndex = this.keys.length - 1;
};

Anim.prototype.addKey = function (k)
{
    if (k.time === undefined)
    {
        this.log.warn("key time undefined, ignoring!");
    }
    else
    {
        this.keys.push(k);
        if (this.onChange !== null) this.onChange();
        this.emitEvent("onChange", this);
    }
    this._updateLastIndex();
};

Anim.prototype.easingFromString = function (str)
{
    if (str == "linear") return CONSTANTS.ANIM.EASING_LINEAR;
    if (str == "absolute") return CONSTANTS.ANIM.EASING_ABSOLUTE;
    if (str == "smoothstep") return CONSTANTS.ANIM.EASING_SMOOTHSTEP;
    if (str == "smootherstep") return CONSTANTS.ANIM.EASING_SMOOTHERSTEP;

    if (str == "Cubic In") return CONSTANTS.ANIM.EASING_CUBIC_IN;
    if (str == "Cubic Out") return CONSTANTS.ANIM.EASING_CUBIC_OUT;
    if (str == "Cubic In Out") return CONSTANTS.ANIM.EASING_CUBIC_INOUT;

    if (str == "Expo In") return CONSTANTS.ANIM.EASING_EXPO_IN;
    if (str == "Expo Out") return CONSTANTS.ANIM.EASING_EXPO_OUT;
    if (str == "Expo In Out") return CONSTANTS.ANIM.EASING_EXPO_INOUT;

    if (str == "Sin In") return CONSTANTS.ANIM.EASING_SIN_IN;
    if (str == "Sin Out") return CONSTANTS.ANIM.EASING_SIN_OUT;
    if (str == "Sin In Out") return CONSTANTS.ANIM.EASING_SIN_INOUT;

    if (str == "Back In") return CONSTANTS.ANIM.EASING_BACK_IN;
    if (str == "Back Out") return CONSTANTS.ANIM.EASING_BACK_OUT;
    if (str == "Back In Out") return CONSTANTS.ANIM.EASING_BACK_INOUT;

    if (str == "Elastic In") return CONSTANTS.ANIM.EASING_ELASTIC_IN;
    if (str == "Elastic Out") return CONSTANTS.ANIM.EASING_ELASTIC_OUT;

    if (str == "Bounce In") return CONSTANTS.ANIM.EASING_BOUNCE_IN;
    if (str == "Bounce Out") return CONSTANTS.ANIM.EASING_BOUNCE_OUT;

    if (str == "Quart Out") return CONSTANTS.ANIM.EASING_QUART_OUT;
    if (str == "Quart In") return CONSTANTS.ANIM.EASING_QUART_IN;
    if (str == "Quart In Out") return CONSTANTS.ANIM.EASING_QUART_INOUT;

    if (str == "Quint Out") return CONSTANTS.ANIM.EASING_QUINT_OUT;
    if (str == "Quint In") return CONSTANTS.ANIM.EASING_QUINT_IN;
    if (str == "Quint In Out") return CONSTANTS.ANIM.EASING_QUINT_INOUT;
};

Anim.prototype.createPort = function (op, title, cb)
{
    const port = op.inDropDown(title, CONSTANTS.ANIM.EASINGS, "Cubic Out");

    // const port = op.addInPort(
    //     new Port(op, title, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
    //         "display": "dropdown",
    //         "values": CONSTANTS.ANIM.EASINGS,
    //     }),
    // );

    port.set("linear");
    port.defaultValue = "linear";

    port.onChange = function ()
    {
        this.defaultEasing = this.easingFromString(port.get());
        this.emitEvent("onChangeDefaultEasing", this);

        if (cb) cb();
    }.bind(this);

    return port;
};

// ------------------------------

Anim.slerpQuaternion = function (time, q, animx, animy, animz, animw)
{
    if (!Anim.slerpQuaternion.q1)
    {
        Anim.slerpQuaternion.q1 = quat.create();
        Anim.slerpQuaternion.q2 = quat.create();
    }

    const i1 = animx.getKeyIndex(time);
    let i2 = i1 + 1;
    if (i2 >= animx.keys.length) i2 = animx.keys.length - 1;

    if (i1 == i2)
    {
        quat.set(q, animx.keys[i1].value, animy.keys[i1].value, animz.keys[i1].value, animw.keys[i1].value);
    }
    else
    {
        const key1Time = animx.keys[i1].time;
        const key2Time = animx.keys[i2].time;
        const perc = (time - key1Time) / (key2Time - key1Time);

        quat.set(Anim.slerpQuaternion.q1, animx.keys[i1].value, animy.keys[i1].value, animz.keys[i1].value, animw.keys[i1].value);

        quat.set(Anim.slerpQuaternion.q2, animx.keys[i2].value, animy.keys[i2].value, animz.keys[i2].value, animw.keys[i2].value);

        quat.slerp(q, Anim.slerpQuaternion.q1, Anim.slerpQuaternion.q2, perc);
    }
    return q;
};

const ANIM = { "Key": Key };




;// CONCATENATED MODULE: ./src/core/core_link.js



/**
 * @namespace external:CABLES#Link
 * @param {Object} scene The patch object
 * @description a link is a connection between two ops/ports -> one input and one output port
 * @hideconstructor
 * @class
 */
const Link = function (scene)
{
    EventTarget.apply(this);

    this.id = CABLES.simpleId();
    this.portIn = null;
    this.portOut = null;
    this.scene = scene; // todo: make private and rename to patch
    this.activityCounter = 0;
    this.ignoreInSerialize = false;
};

Link.prototype.setValue = function (v)
{
    if (v === undefined) this._setValue();
    else this.portIn.set(v);
};

Link.prototype.activity = function ()
{
    this.activityCounter++;
    // if(Date.now()-this.lastTime>100)
    // {
    //     // this.lastTime=Date.now();
    //     // this.changesPerSecond=this.changesCounter*10;
    //     this.changesCounter=0;
    // }
};

Link.prototype._setValue = function ()
{
    if (!this.portOut)
    {
        this.remove();
        return;
    }
    const v = this.portOut.get();

    if (v == v) // NaN is the only JavaScript value that is treated as unequal to itself
    {
        if (this.portIn.type != CONSTANTS.OP.OP_PORT_TYPE_FUNCTION) this.activity();

        if (this.portIn.get() !== v)
        {
            this.portIn.set(v);
        }
        else
        {
            if (this.portIn.changeAlways) this.portIn.set(v);
            if (this.portOut.forceRefChange) this.portIn.forceChange();
        }
    }
};

/**
 * @function getOtherPort
 * @memberof Link
 * @instance
 * @param {Port} p port
 * @description returns the port of the link, which is not port
 */
Link.prototype.getOtherPort = function (p)
{
    if (p == this.portIn) return this.portOut;
    return this.portIn;
};

/**
 * @function remove
 * @memberof Link
 * @instance
 * @description unlink/remove this link from all ports
 */
Link.prototype.remove = function ()
{
    if (this.portIn) this.portIn.removeLink(this);
    if (this.portOut) this.portOut.removeLink(this);
    if (this.scene)
    {
        this.scene.emitEvent("onUnLink", this.portIn, this.portOut, this);
    }

    if (this.portIn && (this.portIn.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT || this.portIn.type == CONSTANTS.OP.OP_PORT_TYPE_ARRAY))
    {
        this.portIn.set(null);
        if (this.portIn.links.length > 0) this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get());
    }

    if (this.portIn) this.portIn.op._checkLinksNeededToWork();
    if (this.portOut) this.portOut.op._checkLinksNeededToWork();

    this.portIn = null;
    this.portOut = null;
    this.scene = null;
};

/**
 * @function link
 * @memberof Link
 * @instance
 * @description link those two ports
 * @param {Port} p1 port1
 * @param {Port} p2 port2
 */
Link.prototype.link = function (p1, p2)
{
    if (!Link.canLink(p1, p2))
    {
        console.warn("[core_link] cannot link ports!", p1, p2);
        return false;
    }

    if (p1.direction == CONSTANTS.PORT.PORT_DIR_IN)
    {
        this.portIn = p1;
        this.portOut = p2;
    }
    else
    {
        this.portIn = p2;
        this.portOut = p1;
    }

    p1.addLink(this);
    p2.addLink(this);

    this.setValue();

    if (p1.onLink) p1.onLink(this);
    if (p2.onLink) p2.onLink(this);

    p1.op._checkLinksNeededToWork();
    p2.op._checkLinksNeededToWork();
};

Link.prototype.getSerialized = function ()
{
    const obj = {};

    obj.portIn = this.portIn.getName();
    obj.portOut = this.portOut.getName();
    obj.objIn = this.portIn.op.id;
    obj.objOut = this.portOut.op.id;

    return obj;
};

// --------------------------------------------

/**
 * @function canLinkText
 * @memberof Link
 * @instance
 * @description return a text message with human readable reason if ports can not be linked, or can be
 * @param {Port} p1 port1
 * @param {Port} p2 port2
 */
Link.canLinkText = function (p1, p2)
{
    if (p1.direction == p2.direction)
    {
        let txt = "(out)";
        if (p2.direction == CONSTANTS.PORT.PORT_DIR_IN) txt = "(in)";
        return "can not link: same direction " + txt;
    }
    if (p1.op == p2.op) return "can not link: same op";
    if (p1.type != CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC && p2.type != CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC)
    {
        if (p1.type != p2.type) return "can not link: different type";
    }

    if (CABLES.UI && p1.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT && p2.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT)
    {
        if (p1.uiAttribs.objType && p2.uiAttribs.objType)
            if (p1.uiAttribs.objType != p2.uiAttribs.objType)
                return "incompatible objects";
    }


    if (!p1) return "can not link: port 1 invalid";
    if (!p2) return "can not link: port 2 invalid";

    if (p1.direction == CONSTANTS.PORT.PORT_DIR_IN && p1.isAnimated()) return "can not link: is animated";
    if (p2.direction == CONSTANTS.PORT.PORT_DIR_IN && p2.isAnimated()) return "can not link: is animated";

    // if(p1.direction==CABLES.CONSTANTS.PORT.PORT_DIR_IN && p1.links.length>0)return 'input port already busy';
    // if(p2.direction==CABLES.CONSTANTS.PORT.PORT_DIR_IN && p2.links.length>0)return 'input port already busy';
    if (p1.isLinkedTo(p2)) return "ports already linked";

    if ((p1.canLink && !p1.canLink(p2)) || (p2.canLink && !p2.canLink(p1))) return "Incompatible";

    return "can link";
};

/**
 * @function canLink
 * @memberof Link
 * @instance
 * @description return true if ports can be linked
 * @param {Port} p1 port1
 * @param {Port} p2 port2
 * @returns {Boolean}
 */
Link.canLink = function (p1, p2)
{
    if (!p1) return false;
    if (!p2) return false;
    if (p1.direction == CONSTANTS.PORT.PORT_DIR_IN && p1.isAnimated()) return false;
    if (p2.direction == CONSTANTS.PORT.PORT_DIR_IN && p2.isAnimated()) return false;

    if (p1.isHidden() || p2.isHidden()) return false;

    if (p1.isLinkedTo(p2)) return false;

    if (p1.direction == p2.direction) return false;

    if (CABLES.UI && p1.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT && p2.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT)
    {
        if (p1.uiAttribs.objType && p2.uiAttribs.objType)
        {
            if (p1.uiAttribs.objType.indexOf("sg_") == 0 && p2.uiAttribs.objType.indexOf("sg_") == 0) return true;
            if (p1.uiAttribs.objType != p2.uiAttribs.objType)
                return false;
        }
    }

    if (p1.type != p2.type && (p1.type != CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC && p2.type != CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC)) return false;
    if (p1.type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC || p2.type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC) return true;

    if (p1.op == p2.op) return false;

    if (p1.canLink && !p1.canLink(p2)) return false;
    if (p2.canLink && !p2.canLink(p1)) return false;

    return true;
};



;// CONCATENATED MODULE: ./src/core/core_port.js







/**
 * data is coming into and out of ops through input and output ports
 * @namespace external:CABLES#Port
 * @class
 * @hideconstructor
 * @param ___op
 * @param name
 * @param type
 * @param uiAttribs
 * @example
 * const myPort=op.inString("String Port");
 */
const Port = function (___op, name, type, uiAttribs)
{
    EventTarget.apply(this);

    this.data = {}; // UNUSED, DEPRECATED, only left in for backwards compatibility with userops
    this._log = new Logger("core_port");
    /**
     * @type {Number}
     * @name direction
     * @instance
     * @memberof Port
     * @description direction of port (input(0) or output(1))
     */
    this.direction = CONSTANTS.PORT.PORT_DIR_IN;
    this.id = String(CABLES.simpleId());
    this._op = ___op;

    /**
     * @type {Array<Link>}
     * @name links
     * @instance
     * @memberof Port
     * @description links of port
     */
    this.links = [];
    this.value = 0.0;
    this.name = name;
    this.type = type || CONSTANTS.OP.OP_PORT_TYPE_VALUE;
    this.uiAttribs = uiAttribs || {};
    this.anim = null;
    this._oldAnimVal = -5711;
    this.defaultValue = null;


    this._uiActiveState = true;
    this.ignoreValueSerialize = false;
    this.onLinkChanged = null;
    this.crashed = false;

    this._valueBeforeLink = null;
    this._lastAnimFrame = -1;
    this._animated = false;

    this.onValueChanged = null;
    this.onTriggered = null;
    this.onUiActiveStateChange = null;
    this.changeAlways = false;
    this.forceRefChange = false;

    this._useVariableName = null;

    this.activityCounter = 0;
    this.apf = 0;
    this.activityCounterStartFrame = 0;

    this._tempLastUiValue = null;

    Object.defineProperty(this, "title", {
        get()
        {
            return this.uiAttribs.title || this.name;
        } });

    Object.defineProperty(this, "parent", {
        get()
        {
            this._log.stack("use port.op, not .parent");
            return this._op;
        } });

    Object.defineProperty(this, "op", {
        get()
        {
            return this._op;
        } });

    Object.defineProperty(this, "val", {
        get()
        {
            // this._log.warn("val getter deprecated!", this);
            // this._log.stack("val getter deprecated");
            return this.get();
        },
        set(v)
        {
            // this._log.warn("val setter deprecated!", this);
            // this._log.stack("val setter deprecated");
            this.setValue(v);
        }
    });
};


/**
 * copy over a uiattrib from an external connected port to another port
 * @function copyLinkedUiAttrib
 * @memberof Port
 * @param {string} which attrib name
 * @param {Port} port source port
 * @instance
 * @example

inArray.onLinkChanged=()=>
{
    if(inArray) inArray.copyLinkedUiAttrib("stride", outArray);
};

 */
Port.prototype.copyLinkedUiAttrib = function (which, port)
{
    if (!CABLES.UI) return;
    if (!this.isLinked()) return;

    const attr = {};
    attr[which] = this.links[0].getOtherPort(this).getUiAttrib(which);
    port.setUiAttribs(attr);
};


// TODO make extend class for ports, like for ops only for ui
Port.prototype.getValueForDisplay = function ()
{
    let str = this.value;

    if (typeof this.value === "string" || this.value instanceof String)
    {
        if (str.length > 1000)
        {
            str = str.substring(0, 999);
            str += "...";
        }
        if (this.uiAttribs && (this.uiAttribs.display == "boolnum"))
        {
            str += " - ";

            if (!this.value) str += "false";
            else str += "true";
        }

        str = str.replace(/[\u00A0-\u9999<>\&]/g, function (i)
        {
            return "&#" + i.charCodeAt(0) + ";";
        });


        if (str.length > 100) str = str.substring(0, 100);
    }
    else
    {
        str = this.value;
    }
    return str;
};

/**
 * change listener for input value ports, overwrite to react to changes
 * @function onChange
 * @memberof Port
 * @instance
 * @example
 * const myPort=op.inString("MyPort");
 * myPort.onChange=function()
 * {
 *   console.log("was changed to: ",myPort.get());
 * }
 *
 */
Port.prototype.onAnimToggle = function () {};
Port.prototype._onAnimToggle = function ()
{
    this.onAnimToggle();
};


/**
 * @function remove
 * @memberof Port
 * @instance
 * @description remove port
 */
Port.prototype.remove = function ()
{
    // this.setUiAttribs({ "hidePort": true });
    this.removeLinks();
    this._op.removePort(this);
};

/**
 * set ui attributes
 * @function setUiAttribs
 * @memberof Port
 * @instance
 * @param {Object} newAttribs
 * <pre>
 * title - overwrite title of port (by default this is portname)
 * greyout - port paramater will appear greyed out, can not be
 * hidePort - port will be hidden from op
 * hideParam - port params will be hidden from parameter panel
 * showIndex - only for dropdowns - show value index (e.g. `0 - normal` )
 * editorSyntax - set syntax highlighting theme for editor port
 * ignoreObjTypeErrors - do not auto check object types
 * </pre>
 * @example
 * myPort.setUiAttribs({greyout:true});
 */
Port.prototype.setUiAttribs = function (newAttribs)
{
    let changed = false;
    if (!this.uiAttribs) this.uiAttribs = {};

    for (const p in newAttribs)
    {
        if (newAttribs[p] === undefined)
        {
            // delete newAttribs[p];
            delete this.uiAttribs[p];
            continue;
        }
        if (this.uiAttribs[p] != newAttribs[p]) changed = true;
        this.uiAttribs[p] = newAttribs[p];

        if (p == "group" && this.indexPort) this.indexPort.setUiAttribs({ "group": newAttribs[p] });
    }

    if (newAttribs.hasOwnProperty("expose")) this._op.patch.emitEvent("subpatchExpose", this._op.uiAttribs.subPatch);

    if (changed) this.emitEvent("onUiAttrChange", newAttribs, this);
};

/**
 * get ui attributes
 * @function getUiAttribs
 * @memberof Port
 * @example
 * myPort.getUiAttribs();
 */
Port.prototype.getUiAttribs = function ()
{
    return this.uiAttribs;
};

/**
 * get ui attribute
 * @function getUiAttrib
 * @memberof Port
 * @instance
 * @param {String} attribName
 * <pre>
 * attribName - return value of the ui-attribute, or null on unknown attribute
 * </pre>
 * @example
 * myPort.setUiAttribs("values");
 */
Port.prototype.getUiAttrib = function (attribName)
{
    if (!this.uiAttribs || !this.uiAttribs.hasOwnProperty(attribName))
    {
        return null;
    }
    return this.uiAttribs[attribName];
};

/**
 * @function get
 * @memberof Port
 * @instance
 * @description get value of port
 */
Port.prototype.get = function ()
{
    if (this._animated && this._lastAnimFrame != this._op.patch.getFrameNum())
    {
        this._lastAnimFrame = this._op.patch.getFrameNum();

        let animval = this.anim.getValue(this._op.patch.timer.getTime());

        if (this.value != animval)
        {
            this.value = animval;
            this._oldAnimVal = this.value;
            this.forceChange();
        }
    }

    return this.value;
};

Port.prototype.setRef = function (v)
{
    this.forceRefChange = true;
    this.set(v);
};

/**
 * @function setValue
 * @memberof Port
 * @instance
 * @description set value of port / will send value to all linked ports (only for output ports)
 */
Port.prototype.set = Port.prototype.setValue = function (v)
{
    if (v === undefined) v = null;


    if (CABLES.UI && CABLES.UI.showDevInfos)
        if (this.direction == CONSTANTS.PORT.PORT_DIR_OUT && this.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT && v && !this.forceRefChange)
            this._log.warn("object port uses .set", this.name, this.op.objName);


    if (this._op.enabled && !this.crashed)
    {
        if (v !== this.value || this.changeAlways || this.type == CONSTANTS.OP.OP_PORT_TYPE_TEXTURE || this.type == CONSTANTS.OP.OP_PORT_TYPE_ARRAY)
        {
            if (this._animated)
            {
                this.anim.setValue(this._op.patch.timer.getTime(), v);
            }
            else
            {
                try
                {
                    this.value = v;
                    this.forceChange();
                }
                catch (ex)
                {
                    this.crashed = true;

                    this.setValue = function (_v) {};
                    this.onTriggered = function () {};

                    this._log.error("exception in ", this._op);
                    this._log.error(ex);

                    this._op.patch.emitEvent("exception", ex, this._op);
                }

                if (this._op && this._op.patch && this._op.patch.isEditorMode() && this.type == CONSTANTS.OP.OP_PORT_TYPE_TEXTURE) gui.texturePreview().updateTexturePort(this);
            }

            if (this.direction == CONSTANTS.PORT.PORT_DIR_OUT) for (let i = 0; i < this.links.length; ++i) this.links[i].setValue();
        }
    }
};

Port.prototype.updateAnim = function ()
{
    if (this._animated)
    {
        this.value = this.get();

        if (this._oldAnimVal != this.value || this.changeAlways)
        {
            this._oldAnimVal = this.value;
            this.forceChange();
        }
        this._oldAnimVal = this.value;
    }
};

Port.prototype.forceChange = function ()
{
    if (this.onValueChanged || this.onChange)
    {
        // very temporary: deprecated warning!!!!!!!!!
        // if(params.length>0) this._log.warn('TOM: port has onchange params!',this._op.objName,this.name);
    }
    this._activity();
    this.emitEvent("change", this.value, this);

    // try
    // {
    if (this.onChange) this.onChange(this, this.value);
    else if (this.onValueChanged) this.onValueChanged(this, this.value); // deprecated
    // }
    // catch (e)
    // {
    //     console.log(e);
    // }
};

/**
 * @function getTypeString
 * @memberof Port
 * @instance
 * @description get port type as string, e.g. "Function","Value"...
 * @return {String} type
 */
Port.prototype.getTypeString = function ()
{
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_VALUE) return "Number";
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_FUNCTION) return "Trigger";
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT) return "Object";
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC) return "Dynamic";
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_ARRAY) return "Array";
    if (this.type == CONSTANTS.OP.OP_PORT_TYPE_STRING) return "String";
    return "Unknown";
};

Port.prototype.deSerializeSettings = function (objPort)
{
    if (!objPort) return;
    if (objPort.animated) this.setAnimated(objPort.animated);
    if (objPort.useVariable) this.setVariableName(objPort.useVariable);
    if (objPort.title) this.setUiAttribs({ "title": objPort.title });
    if (objPort.expose) this.setUiAttribs({ "expose": true });
    if (objPort.order) this.setUiAttribs({ "order": objPort.order });

    if (objPort.multiPortManual) this.setUiAttribs({ "multiPortManual": objPort.multiPortManual });
    if (objPort.multiPortNum) this.setUiAttribs({ "multiPortNum": objPort.multiPortNum });

    if (objPort.anim)
    {
        if (!this.anim) this.anim = new Anim({ "name": "port " + this.name });
        this._op._hasAnimPort = true;
        this.anim.addEventListener("onChange", () =>
        {
            this._op.patch.emitEvent("portAnimUpdated", this._op, this, this.anim);
        });
        if (objPort.anim.loop) this.anim.loop = objPort.anim.loop;
        for (const ani in objPort.anim.keys)
        {
            this.anim.keys.push(new ANIM.Key(objPort.anim.keys[ani]));
        }
        this.anim.sortKeys();
    }
};


Port.prototype.setInitialValue = function (v)
{
    if (this.op.preservedPortLinks[this.name])
    {
        for (let i = 0; i < this.op.preservedPortLinks[this.name].length; i++)
        {
            const lobj = this.op.preservedPortLinks[this.name][i];
            this.op.patch._addLink(
                lobj.objIn,
                lobj.objOut,
                lobj.portIn,
                lobj.portOut);
        }
    }


    if (this.op.preservedPortValues && this.op.preservedPortValues.hasOwnProperty(this.name) && this.op.preservedPortValues[this.name] !== undefined)
    {
        this.set(this.op.preservedPortValues[this.name]);
    }
    else
    if (v !== undefined) this.set(v);
    if (v !== undefined) this.defaultValue = v;
};




Port.prototype.getSerialized = function ()
{
    let obj = { "name": this.getName() };


    if (!this.ignoreValueSerialize && this.links.length === 0)
    {
        if (this.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT && this.value && this.value.tex) {}
        else obj.value = this.value;
    }
    if (this._useVariableName) obj.useVariable = this._useVariableName;
    if (this._animated) obj.animated = true;
    if (this.anim) obj.anim = this.anim.getSerialized();
    if (this.uiAttribs.multiPortNum) obj.multiPortNum = this.uiAttribs.multiPortNum;
    if (this.uiAttribs.multiPortManual) obj.multiPortManual = this.uiAttribs.multiPortManual;

    if (this.uiAttribs.display == "file") obj.display = this.uiAttribs.display;
    if (this.uiAttribs.expose)
    {
        obj.expose = true;
        if (this.uiAttribs.hasOwnProperty("order")) obj.order = this.uiAttribs.order;
    }
    if (this.uiAttribs.title) obj.title = this.uiAttribs.title;
    if ((this.preserveLinks || this.direction == CONSTANTS.PORT.PORT_DIR_OUT) && this.links.length > 0)
    {
        obj.links = [];
        for (const i in this.links)
        {
            if (!this.links[i].ignoreInSerialize && (this.links[i].portIn && this.links[i].portOut)) obj.links.push(this.links[i].getSerialized());
        }
    }

    if (this.direction == CONSTANTS.PORT.PORT_DIR_IN && this.links.length > 0)
    {
        for (const i in this.links)
        {
            if (!this.links[i].portIn || !this.links[i].portOut) continue;

            const otherp = this.links[i].getOtherPort(this);
            // check if functions exist, are defined in core_extend_ops code in ui
            if (otherp.op.isInBlueprint2 && this.op.isInBlueprint2)
            {
                if (otherp.op.isInBlueprint2() && !this.op.isInBlueprint2())
                {
                    obj.links = obj.links || [];
                    obj.links.push(this.links[i].getSerialized());
                }
            }
        }
    }

    if (obj.links && obj.links.length == 0) delete obj.links;
    if (this.type === CONSTANTS.OP.OP_PORT_TYPE_FUNCTION) delete obj.value;
    if (this.type === CONSTANTS.OP.OP_PORT_TYPE_FUNCTION && this.links.length == 0) obj = null;
    if (obj && Object.keys(obj).length == 1 && obj.name)obj = null; // obj is null if there is no real information other than name

    // console.log(obj);
    cleanJson(obj);

    return obj;
};

Port.prototype.shouldLink = function ()
{
    return true;
};

/**
 * @function removeLinks
 * @memberof Port
 * @instance
 * @description remove all links from port
 */
Port.prototype.removeLinks = function ()
{
    let count = 0;
    while (this.links.length > 0)
    {
        count++;
        if (count > 5000)
        {
            this._log.warn("could not delete links... / infinite loop");
            this.links.length = 0;
            break;
        }
        this.links[0].remove();
    }
};

/**
 * @function removeLink
 * @memberof Port
 * @instance
 * @description remove all link from port
 * @param {CABLES.Link} link
 */
Port.prototype.removeLink = function (link)
{
    for (const i in this.links)
        if (this.links[i] == link)
            this.links.splice(i, 1);

    if (this.direction == CONSTANTS.PORT.PORT_DIR_IN)
    {
        if (this.type == CONSTANTS.OP.OP_PORT_TYPE_VALUE) this.setValue(this._valueBeforeLink || 0);
        else this.setValue(this._valueBeforeLink || null);
    }

    if (CABLES.UI && this._op.checkLinkTimeWarnings) this._op.checkLinkTimeWarnings();

    try
    {
        if (this.onLinkChanged) this.onLinkChanged();
        this.emitEvent("onLinkChanged");
        this.emitEvent("onLinkRemoved");
        this._op.emitEvent("onLinkChanged");
    }
    catch (e)
    {
        this._log.error(e);
    }
};

/**
 * @function getName
 * @memberof Port
 * @instance
 * @description return port name
 */
Port.prototype.getName = function ()
{
    return this.name;
};

/**
 * @function getTitle
 * @memberof Port
 * @instance
 * @description return port name or title
 */
Port.prototype.getTitle = function ()
{
    if (this.uiAttribs.title) return this.uiAttribs.title;
    return this.name;
};

Port.prototype.addLink = function (l)
{
    this._valueBeforeLink = this.value;
    this.links.push(l);
    if (CABLES.UI && this._op.checkLinkTimeWarnings) this._op.checkLinkTimeWarnings();

    try
    {
        if (this.onLinkChanged) this.onLinkChanged();
        this.emitEvent("onLinkChanged");
        this._op.emitEvent("onLinkChanged");
    }
    catch (e)
    {
        this._log.error(e);
    }
};

/**
 * @function getLinkTo
 * @memberof Port
 * @instance
 * @param {Port} p2 otherPort
 * @description return link, which is linked to otherPort
 */
Port.prototype.getLinkTo = function (p2)
{
    for (const i in this.links) if (this.links[i].portIn == p2 || this.links[i].portOut == p2) return this.links[i];
};

/**
 * @function removeLinkTo
 * @memberof Port
 * @instance
 * @param {Port} p2 otherPort
 * @description removes link, which is linked to otherPort
 */
Port.prototype.removeLinkTo = function (p2)
{
    for (const i in this.links)
    {
        if (this.links[i].portIn == p2 || this.links[i].portOut == p2)
        {
            this.links[i].remove();
            if (CABLES.UI && this._op.checkLinkTimeWarnings) this._op.checkLinkTimeWarnings();

            if (this.onLinkChanged) this.onLinkChanged();
            this.emitEvent("onLinkChanged");
            this.emitEvent("onLinkRemoved");
            return;
        }
    }
};

/**
 * @function isLinkedTo
 * @memberof Port
 * @instance
 * @param {Port} p2 otherPort
 * @description returns true if port is linked to otherPort
 */
Port.prototype.isLinkedTo = function (p2)
{
    for (const i in this.links) if (this.links[i].portIn == p2 || this.links[i].portOut == p2) return true;

    return false;
};

Port.prototype._activity = function ()
{
    this.activityCounter++;
};

/**
 * @function trigger
 * @memberof Port
 * @instance
 * @description trigger the linked port (usually invoked on an output function port)
 */
Port.prototype.trigger = function ()
{
    const linksLength = this.links.length;

    this._activity();
    if (linksLength === 0) return;
    if (!this._op.enabled) return;

    let portTriggered = null;
    try
    {
        for (let i = 0; i < linksLength; ++i)
        {
            if (this.links[i].portIn)
            {
                portTriggered = this.links[i].portIn;

                portTriggered.op.patch.pushTriggerStack(portTriggered);
                portTriggered._onTriggered();

                portTriggered.op.patch.popTriggerStack();
            }
            if (this.links[i]) this.links[i].activity();
        }
    }
    catch (ex)
    {
        portTriggered.op.enabled = false;

        if (this._op.patch.isEditorMode())
        {
            // this._op.patch.emitEvent("exception", ex, portTriggered.op);
            // this._op.patch.emitEvent("opcrash", portTriggered);
            // console.log("crash", portTriggered.op.objName);

            if (portTriggered.op.onError) portTriggered.op.onError(ex);
        }
        this._log.error("exception in port: ", portTriggered.name, portTriggered.op.name, portTriggered.op);
        this._log.error(ex);
    }
};

Port.prototype.call = function ()
{
    this._log.warn("call deprecated - use trigger() ");
    this.trigger();
};

Port.prototype.execute = function ()
{
    this._log.warn("### execute port: " + this.getName(), this.goals.length);
};

Port.prototype.setVariableName = function (n)
{
    this._useVariableName = n;


    this._op.patch.on("variableRename", (oldname, newname) =>
    {
        if (oldname != this._useVariableName) return;
        this._useVariableName = newname;
    });
};

Port.prototype.getVariableName = function ()
{
    return this._useVariableName;
};

Port.prototype.setVariable = function (v)
{
    this.setAnimated(false);
    const attr = { "useVariable": false };

    if (this._variableIn && this._varChangeListenerId)
    {
        this._variableIn.off(this._varChangeListenerId);
        this._variableIn = null;
    }

    if (v)
    {
        this._variableIn = this._op.patch.getVar(v);

        if (!this._variableIn)
        {
            this._log.warn("PORT VAR NOT FOUND!!!", v);
        }
        else
        {
            if (this.type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT)
            {
                this._varChangeListenerId = this._variableIn.on("change", () => { this.set(null); this.set(this._variableIn.getValue()); });
            }
            else
            {
                this._varChangeListenerId = this._variableIn.on("change", this.set.bind(this));
            }
            this.set(this._variableIn.getValue());
        }
        this._useVariableName = v;
        attr.useVariable = true;
        attr.variableName = this._useVariableName;
    }
    else
    {
        attr.variableName = this._useVariableName = null;
        attr.useVariable = false;
    }

    this.setUiAttribs(attr);
    this._op.patch.emitEvent("portSetVariable", this._op, this, v);
};

Port.prototype._handleNoTriggerOpAnimUpdates = function (a)
{
    let hasTriggerPort = false;
    for (let i = 0; i < this._op.portsIn.length; i++)
    {
        if (this._op.portsIn.type == CONSTANTS.OP.OP_PORT_TYPE_FUNCTION)
        {
            hasTriggerPort = true;
            break;
        }
    }

    if (!hasTriggerPort)
    {
        if (a) this._notriggerAnimUpdate = this._op.patch.on("onRenderFrame",
            () =>
            {
                this.updateAnim();
            });
        else this._op.patch.removeEventListener(this._notriggerAnimUpdate);
    }
};

Port.prototype.setAnimated = function (a)
{
    if (this._animated != a)
    {
        this._animated = a;
        this._op._hasAnimPort = true;

        if (this._animated && !this.anim)
        {
            this.anim = new Anim({ "name": "port " + this.name });
            this.anim.addEventListener("onChange", () =>
            {
                this._op.patch.emitEvent("portAnimUpdated", this._op, this, this.anim);
            });
        }
        this._onAnimToggle();
    }

    this._handleNoTriggerOpAnimUpdates(a);
    if (!a)
    {
        this.anim = null;
    }

    this.setUiAttribs({ "isAnimated": this._animated });
};

Port.prototype.toggleAnim = function ()
{
    this._animated = !this._animated;
    if (this._animated && !this.anim)
    {
        this.anim = new Anim({ "name": "port " + this.name });
        this.anim.addEventListener("onChange", () =>
        {
            this._op.patch.emitEvent("portAnimUpdated", this._op, this, this.anim);
        });
    }
    this.setAnimated(this._animated);
    this._onAnimToggle();
    this.setUiAttribs({ "isAnimated": this._animated });
};

/**
 * <pre>
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_VALUE = 0;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_FUNCTION = 1;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_OBJECT = 2;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_TEXTURE = 2;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_ARRAY = 3;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC = 4;
 * CABLES.CONSTANTS.OP.OP_PORT_TYPE_STRING = 5;
 * </pre>
 * @function getType
 * @memberof Port
 * @instance
 * @return {Number} type of port
 */
Port.prototype.getType = function ()
{
    return this.type;
};

/**
 * @function isLinked
 * @memberof Port
 * @instance
 * @return {Boolean} true if port is linked
 */
Port.prototype.isLinked = function ()
{
    return this.links.length > 0 || this._animated || this._useVariableName != null;
};

Port.prototype.isBoundToVar = function ()
{
    const b = this._useVariableName != null;
    this.uiAttribs.boundToVar = b;
    return b;
};
/**
 * @function isAnimated
 * @memberof Port
 * @instance
 * @return {Boolean} true if port is animated
 */
Port.prototype.isAnimated = function ()
{
    return this._animated;
};

/**
 * @function isHidden
 * @memberof Port
 * @instance
 * @return {Boolean} true if port is hidden
 */
Port.prototype.isHidden = function ()
{
    return this.uiAttribs.hidePort;
};

/**
 * @function onTriggered
 * @memberof Port
 * @instance
 * @param {function} a onTriggeredCallback
 * @description set callback, which will be executed when port was triggered (usually output port)
 */
Port.prototype._onTriggered = function (a)
{
    this._activity();
    this._op.updateAnims();
    if (this._op.enabled && this.onTriggered) this.onTriggered(a);

    if (this._op.enabled) this.emitEvent("trigger");
};

Port.prototype._onSetProfiling = function (v)
{
    this._op.patch.profiler.add("port", this);
    this.setValue(v);
    this._op.patch.profiler.add("port", null);
};

Port.prototype._onTriggeredProfiling = function ()
{
    if (this._op.enabled && this.onTriggered)
    {
        this._op.patch.profiler.add("port", this);
        this.onTriggered();
        this._op.patch.profiler.add("port", null);
    }
};



Port.prototype.getUiActiveState = function ()
{
    return this._uiActiveState;
};

Port.prototype.setUiActiveState = function (onoff)
{
    this._uiActiveState = onoff;
    if (this.onUiActiveStateChange) this.onUiActiveStateChange();
};

/**
 * @deprecated
 * @param {function} cb
 */
Port.prototype.onValueChange = function (cb)
{
    this.onChange = cb;
};

/**
 * @deprecated
 */
Port.prototype.hidePort = function () {};


/**
 * Returns the port type string, e.g. "value" based on the port type number
 * @function portTypeNumberToString
 * @instance
 * @memberof Port
 * @param {Number} type - The port type number
 * @returns {String} - The port type as string
 */
Port.portTypeNumberToString = function (type)
{
    if (type == CONSTANTS.OP.OP_PORT_TYPE_VALUE) return "value";
    if (type == CONSTANTS.OP.OP_PORT_TYPE_FUNCTION) return "function";
    if (type == CONSTANTS.OP.OP_PORT_TYPE_OBJECT) return "object";
    if (type == CONSTANTS.OP.OP_PORT_TYPE_ARRAY) return "array";
    if (type == CONSTANTS.OP.OP_PORT_TYPE_STRING) return "string";
    if (type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC) return "dynamic";
    return "unknown";
};



;// CONCATENATED MODULE: ./src/core/core_port_switch.js




class SwitchPort extends Port
{
    constructor(__parent, name, type, uiAttribs, indexPort)
    {
        super(__parent, name, type, uiAttribs);

        this.get = () =>
        {
            let s = super.get();

            if (CABLES.UI)
            {
                if (
                    s === "" ||
                    s === null ||
                    s === undefined ||
                    (uiAttribs.values && uiAttribs.values.indexOf(String(s)) === -1)
                )
                {
                    this.op.setUiError("invalidswitch", "Invalid Value [" + this.name + "]: \"" + s + "\"", 1);
                }
                else this.op.setUiError("invalidswitch", null);
            }

            if (s === null || s === undefined)s = "";

            return s;
        };

        this.indexPort = indexPort;
        this.indexPort.set = (value) =>
        {
            const values = uiAttribs.values;

            if (!values)
            {
                // console.log("switch port has no values", this);
                return;
            }

            let intValue = Math.floor(value);

            intValue = Math.min(intValue, values.length - 1);
            intValue = Math.max(intValue, 0);

            this.indexPort.setValue(intValue);
            this.set(values[intValue]);

            if (this.op.patch.isEditorMode() && performance.now() - (this.lastTime || 0) > 100 && window.gui && gui.patchView.isCurrentOp(this.op))
            {
                gui.opParams.show(this.op);
                this.lastTime = performance.now();
            }
        };
    }

    setUiAttribs(attribs)
    {
        const hidePort = attribs.hidePort;
        attribs.hidePort = true;
        super.setUiAttribs(attribs);
        if (typeof hidePort !== "undefined")
        {
            this.indexPort.setUiAttribs({ hidePort });
        }
    }
}



;// CONCATENATED MODULE: ./src/core/core_port_select.js




class ValueSelectPort extends SwitchPort
{
    setUiAttribs(newAttribs)
    {
        // never unhide valuePort when indexPort is linked
        if (this.indexPort.isLinked())
        {
            for (const p in newAttribs)
            {
                if (p == "greyout" && !newAttribs[p]) newAttribs[p] = "true";
            }
        }
        super.setUiAttribs(newAttribs);
    }
}





;// CONCATENATED MODULE: ./src/core/core_port_multi.js



const MIN_NUM_PORTS = 2;

class MultiPort extends Port
{
    constructor(__parent, name, type, dir, uiAttribs, uiAttribsPorts)
    {
        super(__parent, name, CONSTANTS.OP.OP_PORT_TYPE_ARRAY, uiAttribs);

        this.setUiAttribs({ "multiPort": true, "group": this.name, "order": -1 });
        this.ports = [];
        this.direction = dir;
        this._uiAttribsPorts = uiAttribsPorts;

        // console.log("uiattribs", uiAttribs);

        const updateArray = () =>
        {
            const arr = [];

            let ll = 1;
            if (this.uiAttribs.multiPortManual)ll = 0;

            for (let i = 0; i < this.ports.length - ll; i++)
                arr[i] = this.ports[i];

            this.setRef(arr);
        };

        const updateUi = () =>
        {
            let grey = !this.uiAttribs.multiPortManual || undefined;

            if (this.direction == CONSTANTS.PORT.PORT_DIR_OUT)grey = false;

            for (let i = 0; i < this.ports.length; i++)
            {
                let lp; // undefined to remove/not set it
                // let opacity;// undefined to remove/not set it
                // let grey;// undefined to remove/not set it
                let addPort = false;
                let title;
                let o = {};


                // console.log("this.op.preservedPortTitles", this.op.preservedPortTitles, this.op.preservedPortTitles[po.name], po.name);
                if (this.op.preservedPortTitles && this.op.preservedPortTitles[this.ports[i].name]) title = this.op.preservedPortTitles[this.ports[i].name];


                // if (!this.uiAttribs.multiPortManual)grey = true;
                if (i == 0) lp = this.ports.length;

                if (!this.uiAttribs.multiPortManual)
                    if (i == this.ports.length - 1)
                    {
                        title = "add port";
                        addPort = true;
                        grey = true;
                    }

                for (const attin in this._uiAttribsPorts)
                {
                    o[attin] = this._uiAttribsPorts[attin];
                }

                o.addPort = addPort;
                o.longPort = lp;
                o.title = title;
                o.greyout = grey;
                o.group = this.name;

                this.ports[i].setUiAttribs(o);
            }
        };

        this.removeInvalidPorts = () =>
        {
            for (let i = 0; i < this.ports.length; i++)
            {
                if (!this.ports[i]) this.ports.splice(i, 1);
            }

            if (!this.uiAttribs.multiPortManual)
            {
                if (this.ports.length > MIN_NUM_PORTS)

                    for (let i = this.ports.length - 1; i > 1; i--)
                    {
                        if (!this.ports[i].isLinked()) this.uiAttribs.multiPortNum = i;
                        else break;
                    }
            }

            updateArray();
        };

        this.countPorts = () =>
        {
            if (CABLES.UI && !gui.isRemoteClient && gui.patchView && gui.patchView.patchRenderer && gui.patchView.patchRenderer.isDraggingPort())
            {
                clearTimeout(this.retryTo);
                this.retryTo = setTimeout(this.countPorts.bind(this));
                return;
            }
            this.retryTo = null;

            let redo = false;
            this.removeListeners();
            this.removeInvalidPorts();

            for (let i = 0; i < this.ports.length; i++)
            {
                if (this.ports[i] && this.ports[i].links.length > 1)
                {
                    const po = this.ports[i + 1];
                    const otherPort = this.ports[i].links[0].getOtherPort(this.ports[i]);

                    if (!po || !otherPort)
                    {
                        this._log.warn("no port found?");
                    }
                    else
                    {
                        this.ports[i].links[0].remove();
                        this.op.patch.link(this.op, po.name, otherPort.op, otherPort.name);
                        redo = true;
                    }
                    break;
                }
            }

            if (!this.uiAttribs.multiPortManual)
            {
                let foundHole = true;
                while (foundHole)
                {
                    // console.log("search holes...");
                    foundHole = false;

                    for (let i = this.ports.length - 1; i > 1; i--)
                    {
                        if (this.ports[i] && this.ports[i].links.length > 0 && this.ports[i - 1].links.length == 0)
                        {
                            // console.log("found hole!");

                            // found hole
                            const otherPort = this.ports[i].links[0].getOtherPort(this.ports[i]);
                            this.ports[i].links[0].remove();

                            const po = this.ports[i - 1];

                            if (po && this.ports[i])
                            {
                                // console.log("move ", this.ports[i].name, "to", po.name);
                                this.op.patch.link(this.op, po.name, otherPort.op, otherPort.name);
                                foundHole = true;
                                redo = true;
                                break;
                            }
                        }
                    }


                    // this.checkNum();
                }

                // this.removeInvalidPorts();
            }


            if (!this.uiAttribs.multiPortManual) // if auto
            {
                while (this.ports.length > MIN_NUM_PORTS && !this.ports[this.ports.length - 1].isLinked() && !this.ports[this.ports.length - 2].isLinked())
                {
                    let i = this.ports.length - 1;
                    if (!this.ports[i].isLinked() && this.ports[i - 1] && !this.ports[i - 1].isLinked())
                    {
                        this.ports[i].setUiAttribs({ "removed": true });
                        this.ports[i].remove();
                        // this.ports[i] = null;
                        this.ports.splice(i, 1);
                    }
                }
            }

            this.removeInvalidPorts();

            if (!this.uiAttribs.multiPortManual && this.ports.length > 0 && this.ports[this.ports.length - 1].isLinked()) this.newPort();

            updateArray();
            updateUi();

            if (redo) this.countPorts();
            else this.addListeners();
        };

        this.removeListeners = () =>
        {
            for (let i = 0; i < this.ports.length; i++)
            {
                const po = this.ports[i];
                po.multiPortChangeListener = po.off(po.multiPortChangeListener);
                po.multiLinkChangeListener = po.off(po.multiLinkChangeListener);
            }
        };

        this.addListeners = () =>
        {
            for (let i = 0; i < this.ports.length; i++)
            {
                const po = this.ports[i];
                const idx = i;

                if (po.multiPortChangeListener)po.multiPortChangeListener = po.off(po.multiPortChangeListener);
                po.multiPortChangeListener = po.on("change", updateArray.bind(this));


                if (po.multiPortTriggerListener)po.multiPortTriggerListener = po.off(po.multiPortTriggerListener);
                po.multiPortTriggerListener = po.on("trigger", () => { this._onTriggered(idx); });


                // if (po.multiPortTriggerListener)po.multiPortTriggerListener = po.off(po.multiPortTriggerListener);
                // po.multiPortTriggerListener = po.on("trigger", this.trigger());

                if (po.multiLinkChangeListener)po.multiLinkChangeListener = po.off(po.multiLinkChangeListener);
                po.multiLinkChangeListener = po.on("onLinkChanged", () =>
                {
                    this.countPorts();
                    this.emitEvent("onLinkChanged");
                });

                if (po.multiLinkRemoveListener)po.multiLinkRemoveListener = po.off(po.multiLinkRemoveListener);
                po.multiLinkRemoveListener = po.on("onLinkRemoved", () =>
                {
                    // this.removeInvalidPorts();
                    // this.checkNum();
                    // this.countPorts();
                    updateUi();
                    this.emitEvent("onLinkChanged");
                    // this.countPorts.bind(this);
                });
            }
        };

        this.newPort = () =>
        {
            const attrs = {};
            // if (type == CABLES.OP_PORT_TYPE_STRING) attrs.type = "string";
            attrs.type = type;
            const po = new Port(this.op, name + "_" + this.ports.length, type, attrs);

            po.direction = dir;
            this.ports.push(po);
            // console.log("CONSTANTS.PORT_DIR_OUT", CONSTANTS.PORT.PORT_DIR_OUT, this.direction);
            if (this.direction == CONSTANTS.PORT.PORT_DIR_OUT) this.op.addOutPort(po);
            else this.op.addInPort(po);

            if (type == CONSTANTS.OP.OP_PORT_TYPE_NUMBER) po.setInitialValue(0);
            else if (type == CONSTANTS.OP.OP_PORT_TYPE_STRING) po.setInitialValue("");

            this.addListeners();

            updateUi();
            updateArray();
            this.emitEvent("onLinkChanged");
            // console.log("this.op.preservedPortTitles", this.op.preservedPortTitles, this.op.preservedPortTitles[po.name], po.name);
            if (this.op.preservedPortTitles && this.op.preservedPortTitles[po.name]) po.setUiAttribs({ "title": this.op.preservedPortTitles[po.name] });

            return po;
        };

        this.initPorts = () =>
        {
            for (let i = 0; i < MIN_NUM_PORTS; i++) this.newPort();
            updateArray();
            updateUi();
        };

        this.checkNum = () =>
        {
            this.uiAttribs.multiPortNum = Math.max(MIN_NUM_PORTS, this.uiAttribs.multiPortNum);

            while (this.ports.length < this.uiAttribs.multiPortNum) this.newPort();
            while (this.ports.length > this.uiAttribs.multiPortNum) if (this.ports[this.ports.length - 1]) this.ports.pop().remove();

            this.removeInvalidPorts();
        };

        this.incDec = (incDir) =>
        {
            this.uiAttribs.multiPortNum = this.uiAttribs.multiPortNum || MIN_NUM_PORTS;
            // console.log("this.uiAttribs.multiPortNum", this.uiAttribs.multiPortNum, this.uiAttribs.multiPortNum + incDir);
            this.setUiAttribs({ "multiPortNum": this.uiAttribs.multiPortNum + incDir });
            this.checkNum();

            updateUi();
        };

        this.toggleManual = () =>
        {
            this.setUiAttribs({ "multiPortManual": !this.uiAttribs.multiPortManual });
            this.op.refreshParams();
        };

        this.on("onUiAttrChange", (attribs) =>
        {
            if (attribs.hasOwnProperty("multiPortManual"))
            {
                updateUi();
                this.removeInvalidPorts();
                this.checkNum();
                this.countPorts();
                updateUi();
            }
        });


        this.on("onUiAttrChange", this.checkNum.bind(this));
        this.checkNum();
        this.countPorts();
        this.removeInvalidPorts();
        updateUi();
    }
}





;// CONCATENATED MODULE: ./src/core/core_op.js









/**
 * op the class of all operators
 * @namespace external:CABLES#Op
 * @hideconstructor
 */

/**
 * @type {Object}
 * @name attachments
 * @instance
 * @memberof Op
 * @description access file attachments as String values
 * @example
 * // set shader source to attached files (files are called shader.vert / shader.frag)
 * shader.setSource(attachments.shader_vert,attachments.shader_frag);
 */

const Ops = {};

const Op = function ()
{
    EventTarget.apply(this);

    this._log = new Logger("core_op");
    this.data = {}; // UNUSED, DEPRECATED, only left in for backwards compatibility with userops
    this.storage = {}; // op-specific data to be included in export
    this.__objName = "";
    this.portsOut = [];
    this.portsIn = [];
    this.portsInData = []; // original loaded patch data
    this.opId = ""; // unique op id
    this.uiAttribs = {};
    this.enabled = true;
    this.patch = arguments[0];
    this._name = arguments[1];
    this.preservedPortTitles = {};
    this.preservedPortValues = {};
    this.preservedPortLinks = {};

    this._linkTimeRules = {
        "needsLinkedToWork": [],
        "needsParentOp": null
    };

    this.shouldWork = {};
    this.hasUiErrors = false;
    this._uiErrors = {};
    this._hasAnimPort = false;

    if (arguments[1])
    {
        this._shortOpName = CABLES.getShortOpName(arguments[1]);
        this.getTitle();
    }

    this.id = arguments[2] || shortId(); // instance id
    this.onAddPort = null;
    this.onCreate = null;
    this.onResize = null;
    this.onLoaded = null;
    this.onDelete = null;
    this.onError = null;

    this._instances = null;

    /**
     * overwrite this to prerender shader and meshes / will be called by op `loadingStatus`
     * @function preRender
     * @memberof Op
     * @instance
     */
    this.preRender = null;

    /**
     * overwrite this to initialize your op
     * @function init
     * @memberof Op
     * @instance
     */
    this.init = null;

    Object.defineProperty(this, "name", {
        get() { return this.getTitle(); },
        set(v)
        {
            this.setTitle(v);
        }
    });

    Object.defineProperty(this, "_objName", { set(on)
    {
        this.__objName = on; this._log = new Logger("op " + on);
    } });

    Object.defineProperty(this, "objName", { get() { return this.__objName; } });
    Object.defineProperty(this, "shortName", { get() { return this._shortOpName; } });

    if (this.initUi) this.initUi();
};

{
    Op.prototype.clearUiAttrib = function (name)
    {
        const obj = {};
        // obj.name = null;
        this.uiAttrib(obj);
    };

    Op.prototype.require = function (name)
    {
        if (CABLES.platform && CABLES.StandaloneElectron && !CABLES.platform.frontendOptions.isStandalone)
            this.setUiError("notstandalone", "This op will only work in cables standalone version", 3);

        return null;
    };


    Op.prototype.checkMainloopExists = function ()
    {
        if (!CABLES.UI) return;
        if (!this.patch.tempData.mainloopOp) this.setUiError("nomainloop", "patch should have a mainloop to use this op");
        else this.setUiError("nomainloop", null);
    };

    Op.prototype.getTitle = function ()
    {
        if (!this.uiAttribs) return "nouiattribs" + this._name;

        // if ((this.uiAttribs.title === undefined || this.uiAttribs.title === "") && this.objName.indexOf("Ops.Ui.") == -1)
        //     this.uiAttribs.title = this._shortOpName;

        return this.uiAttribs.title || this._shortOpName;
    };

    Op.prototype.setTitle = function (title)
    {
        // this._log.log("settitle", title);
        // this._log.log(
        //     (new Error()).stack
        // );

        if (title != this.getTitle()) this.uiAttr({ "title": title });
    };

    Op.prototype.setStorage = function (newAttribs)
    {
        if (!newAttribs) return;
        this.storage = this.storage || {};

        let changed = false;
        for (const p in newAttribs)
        {
            if (this.storage[p] != newAttribs[p]) changed = true;
            this.storage[p] = newAttribs[p];
        }

        if (changed) this.emitEvent("onStorageChange", newAttribs);
    };

    Op.prototype.isSubPatchOp = function ()
    {
        if (this.patchId && this.storage) return (this.storage.subPatchVer || this.storage.blueprintVer || 0);
        return false;
    };

    const _setUiAttrib = function (newAttribs)
    {
        if (!newAttribs) return;

        if (newAttribs.error || newAttribs.warning || newAttribs.hint)
        {
            this._log.warn("old ui error/warning attribute in " + this._name + ", use op.setUiError !", newAttribs);
        }


        if (typeof newAttribs != "object") this._log.error("op.uiAttrib attribs are not of type object");
        if (!this.uiAttribs) this.uiAttribs = {};

        let changed = false;
        let emitMove = false;
        if (
            CABLES.UI &&
            newAttribs.hasOwnProperty("translate") &&
            (
                !this.uiAttribs.translate ||
                this.uiAttribs.translate.x != newAttribs.translate.x ||
                this.uiAttribs.translate.y != newAttribs.translate.y
            )) emitMove = true;


        if (newAttribs.hasOwnProperty("title") && newAttribs.title != this.uiAttribs.title)
        {
            // const doEmitEvent = newAttribs.title != this.getTitle();
            this.uiAttribs.title = newAttribs.title;
            // if (doEmitEvent) this.emitEvent("onTitleChange", newAttribs.title);
            changed = true;
            // this.setTitle(newAttribs.title);
        }

        if (newAttribs.hasOwnProperty("disabled")) this.setEnabled(!newAttribs.disabled);

        for (const p in newAttribs)
        {
            if (this.uiAttribs[p] != newAttribs[p]) changed = true;
            this.uiAttribs[p] = newAttribs[p];
        }


        if (this.uiAttribs.hasOwnProperty("selected") && this.uiAttribs.selected == false) delete this.uiAttribs.selected;


        if (changed)
        {
            this.emitEvent("onUiAttribsChange", newAttribs);
            this.patch.emitEvent("onUiAttribsChange", this, newAttribs);
        }


        if (emitMove) this.emitEvent("move");
    };
    /**
     * setUiAttrib
     * possible values:
     * <pre>
     * warning - warning message - showing up in op parameter panel
     * error - error message - showing up in op parameter panel
     * extendTitle - op title extension, e.g. [ + ]
     * </pre>
     * @function setUiAttrib
     * @param {Object} newAttribs, e.g. {"attrib":value}
     * @memberof Op
     * @instance
     * @example
     * op.setUiAttrib({"extendTitle":str});
     */
    Op.prototype.setUiAttribs = Op.prototype.setUiAttrib = Op.prototype.uiAttr = _setUiAttrib;

    Op.prototype.getName = function ()
    {
        if (this.uiAttribs.name) return this.uiAttribs.name;
        return this._name;
    };

    Op.prototype.addOutPort = function (p)
    {
        p.direction = CONSTANTS.PORT.PORT_DIR_OUT;
        p._op = this;
        this.portsOut.push(p);
        this.emitEvent("onPortAdd", p);
        return p;
    };

    Op.prototype.hasDynamicPort = function ()
    {
        let i = 0;
        for (i = 0; i < this.portsIn.length; i++)
        {
            if (this.portsIn[i].type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC) return true;
            if (this.portsIn[i].getName() == "dyn") return true;
        }
        for (i = 0; i < this.portsOut.length; i++)
        {
            if (this.portsOut[i].type == CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC) return true;
            if (this.portsOut[i].getName() == "dyn") return true;
        }

        return false;
    };

    Op.prototype.addInPort = function (p)
    {
        if (!(p instanceof Port)) throw new Error("parameter is not a port!");

        p.direction = CONSTANTS.PORT.PORT_DIR_IN;
        p._op = this;

        this.portsIn.push(p);
        this.emitEvent("onPortAdd", p);

        return p;
    };

    /**
     * create a trigger input port
     * @function inTrigger
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     *
     */
    Op.prototype.inFunction = Op.prototype.inTrigger = function (name, v)
    {
        const p = this.addInPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_FUNCTION));
        if (v !== undefined) p.set(v);
        return p;
    };

    /**
     * create multiple UI trigger buttons
     * @function inTriggerButton
     * @memberof Op
     * @instance
     * @param {String} name
     * @param {Array} names
     * @return {Port} created port
     */
    Op.prototype.inFunctionButton = Op.prototype.inTriggerButton = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_FUNCTION, {
                "display": "button"
            })
        );
        if (v !== undefined) p.set(v);
        return p;
    };

    Op.prototype.inFunctionButton = Op.prototype.inUiTriggerButtons = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_FUNCTION, {
                "display": "buttons"
            })
        );
        if (v !== undefined) p.set(v);
        return p;
    };



    /**
     * create a number value input port
     * @function inFloat
     * @memberof Op
     * @instance
     * @param {String} name
     * @param {Number} value
     * @return {Port} created port
     */
    Op.prototype.inValueFloat = Op.prototype.inValue = Op.prototype.inFloat = function (name, v)
    {
        const p = this.addInPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE));

        p.setInitialValue(v);

        return p;
    };

    /**
     * create a boolean input port, displayed as a checkbox
     * @function inBool
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {Boolean} value
     * @return {Port} created port
     */
    Op.prototype.inValueBool = Op.prototype.inBool = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_NUMBER, {
                "display": "bool"
            })
        );

        if (v === true)v = 1;
        if (v === false)v = 0;
        p.setInitialValue(v);

        return p;
    };


    Op.prototype.inMultiPort = function (name, type)
    {
        const p = new MultiPort(
            this,
            name,
            type,
            CONSTANTS.PORT.PORT_DIR_IN,
            {
                "addPort": true,
                "hidePort": true
            }
        );
        p.ignoreValueSerialize = true;

        this.addInPort(p);
        p.initPorts();

        return p;
    };

    Op.prototype.outMultiPort = function (name, type, uiAttribsPort = {})
    {
        const p = new MultiPort(
            this,
            name,
            type,
            CONSTANTS.PORT.PORT_DIR_OUT,
            {
                "display": "multiport",
                "hidePort": true
            },
            uiAttribsPort
        );
        p.ignoreValueSerialize = true;

        this.addOutPort(p);
        p.initPorts();

        return p;
    };



    Op.prototype.inValueString = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "type": "string"
            })
        );
        p.value = "";

        p.setInitialValue(v);
        return p;
    };

    /**
     * create a String value input port
     * @function inString
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {String} value default value
     * @return {Port} created port
     */
    Op.prototype.inString = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "type": "string"
            })
        );
        v = v || "";
        // p.value = v;

        p.setInitialValue(v);
        return p;
    };

    /**
     * create a String value input port displayed as TextArea
     * @function inValueText
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {String} value default value
     * @return {Port} created port
     */
    Op.prototype.inValueText = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "type": "string",
                "display": "text"
            })
        );
        p.value = "";

        p.setInitialValue(v);
        // if (v !== undefined)
        // {
        //     p.set(v);
        //     p.defaultValue = v;
        // }
        return p;
    };

    Op.prototype.inTextarea = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "type": "string",
                "display": "text"
            })
        );
        p.value = "";
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    /**
     * create a String value input port displayed as editor
     * @function inStringEditor
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {String} value default value
     * @return {Port} created port
     */
    // new string
    Op.prototype.inStringEditor = function (name, v, syntax, hideFormatButton = true)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "type": "string",
                "display": "editor",
                "editShortcut": true,
                "editorSyntax": syntax,
                "hideFormatButton": hideFormatButton
            }));

        p.value = "";
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    // old
    Op.prototype.inValueEditor = function (name, v, syntax, hideFormatButton = true)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_NUMBER, {
                "type": "string",
                "display": "editor",
                "editorSyntax": syntax,
                "hideFormatButton": hideFormatButton
            })
        );
        p.value = "";
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    /**
     * create a string select box
     * @function inDropDown
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {Array} values
     * @param {String} value default value
     * @return {Port} created port
     */
    Op.prototype.inValueSelect = Op.prototype.inDropDown = function (name, values, v, noindex)
    {
        let p = null;
        if (!noindex)
        {
            const indexPort = new Port(this, name + " index", CONSTANTS.OP.OP_PORT_TYPE_NUMBER, {
                "increment": "integer",
                "hideParam": true
            });
            const n = this.addInPort(indexPort);

            if (values) for (let i = 0; i < values.length; i++) values[i] = String(values[i]);

            const valuePort = new ValueSelectPort(
                this,
                name,
                CONSTANTS.OP.OP_PORT_TYPE_NUMBER,
                {
                    "display": "dropdown",
                    "hidePort": true,
                    "type": "string",
                    "values": values
                },
                n
            );

            valuePort.indexPort = indexPort;

            valuePort.on("change", (val, thePort) =>
            {
                if (!thePort.indexPort.isLinked() && thePort.uiAttribs.values)
                {
                    const idx = thePort.uiAttribs.values.indexOf(val);
                    if (idx > -1) thePort.indexPort.set(idx);
                }
            });

            indexPort.onLinkChanged = function ()
            {
                valuePort.setUiAttribs({ "greyout": indexPort.isLinked() });
            };

            p = this.addInPort(valuePort);

            if (v !== undefined)
            {
                p.set(v);
                const index = values.findIndex((item) => { return item == v; });
                n.setValue(index);
                p.defaultValue = v;
                n.defaultValue = index;
            }
        }
        else
        {
            const valuePort = new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "display": "dropdown",
                "hidePort": true,
                "type": "string",
                values
            });

            p = this.addInPort(valuePort);
        }

        return p;
    };

    /**
     * create a string switch box
     * @function inSwitch
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {Array} values
     * @param {String} value default value
     * @return {Port} created port
     */
    Op.prototype.inSwitch = function (name, values, v, noindex)
    {
        let p = null;
        if (!noindex)
        {
            if (!v)v = values[0];
            const indexPort = new Port(this, name + " index", CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "increment": "integer",
                "values": values,
                "hideParam": true
            });
            const n = this.addInPort(indexPort);

            if (values) for (let i = 0; i < values.length; i++) values[i] = String(values[i]);

            const switchPort = new SwitchPort(
                this,
                name,
                CONSTANTS.OP.OP_PORT_TYPE_STRING,
                {
                    "display": "switch",
                    "hidePort": true,
                    "type": "string",
                    "values": values
                },
                n
            );

            switchPort.indexPort = indexPort;

            switchPort.on("change", (val, thePort) =>
            {
                if (!thePort.indexPort.isLinked() && thePort.uiAttribs.values)
                {
                    const idx = thePort.uiAttribs.values.indexOf(val);
                    if (idx > -1) thePort.indexPort.set(idx);
                }
            });

            indexPort.onLinkChanged = function ()
            {
                switchPort.setUiAttribs({ "greyout": indexPort.isLinked() });
            };
            p = this.addInPort(switchPort);

            if (v !== undefined)
            {
                p.set(v);
                const index = values.findIndex((item) => { return item == v; });
                n.setValue(index);
                p.defaultValue = v;
                n.defaultValue = index;
            }
        }
        else
        {
            const switchPort = new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "display": "switch",
                "hidePort": true,
                "type": "string",
                "values": values
            });
            p = this.addInPort(switchPort);
        }

        return p;
    };

    /**
     * create a integer input port
     * @function inInt
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {number} value default value
     * @return {Port} created port
     */
    Op.prototype.inValueInt = Op.prototype.inInt = function (name, v)
    {
        // old
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "increment": "integer"
            })
        );
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    /**
     * create a file/URL input port
     * @function inURL
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.inFile = function (name, filter, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "display": "file",
                "type": "string",
                "filter": filter
            })
        );
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    Op.prototype.inUrl = function (name, filter, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "display": "file",
                "type": "string",
                "filter": filter
            })
        );
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    /**
     * create a texture input port
     * @function inTexture
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.inTexture = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_OBJECT, {
                "display": "texture",
                "objType": "texture",
                "preview": true
            })
        );
        p.ignoreValueSerialize = true;
        if (v !== undefined) p.set(v);
        return p;
    };


    /**
     * create a object input port
     * @function inObject
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.inObject = function (name, v, objType)
    {
        const p = this.addInPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_OBJECT, { "objType": objType }));
        p.ignoreValueSerialize = true;

        if (v !== undefined) p.set(v);
        return p;
    };

    Op.prototype.inGradient = function (name, v)
    {
        const p = this.addInPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "display": "gradient"
                // "hidePort": true
            })
        );
        if (v !== undefined) p.set(v);
        return p;
    };


    Op.prototype.getPortVisibleIndex = function (p)
    {
        let ports = this.portsIn;
        if (p.direction == CONSTANTS.PORT_DIR_OUT)ports = this.portsOut;

        let index = 0;
        for (let i = 0; i < ports.length; i++)
        {
            if (ports[i].uiAttribs.hidePort) continue;
            index++;
            if (ports[i] == p) return index;
        }
    };

    /**
     * create a array input port
     * @function inArray
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.inArray = function (name, v, stride)
    {
        if (!stride && CABLES.UTILS.isNumeric(v))stride = v;

        const p = this.addInPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_ARRAY, { "stride": stride }));

        if (v !== undefined && (Array.isArray(v) || v == null)) p.set(v);

        // if (v !== undefined) p.set(v);
        return p;
    };

    /**
     * create a value slider input port
     * @function inFloatSlider
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {number} defaultvalue
     * @param {number} min
     * @param {number} max
     * @return {Port} created port
     */
    Op.prototype.inValueSlider = Op.prototype.inFloatSlider = function (name, v, min, max)
    {
        const uiattribs = { "display": "range" };

        if (min != undefined && max != undefined)
        {
            uiattribs.min = min;
            uiattribs.max = max;
        }

        const p = this.addInPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, uiattribs));
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    /**
     * create output trigger port
     * @function outTrigger
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outFunction = Op.prototype.outTrigger = function (name, v)
    {
        // old
        const p = this.addOutPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_FUNCTION));
        if (v !== undefined) p.set(v);
        return p;
    };

    /**
     * create output value port
     * @function outNumber
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {number} default value
     * @return {Port} created port
     */
    Op.prototype.outValue = Op.prototype.outNumber = function (name, v)
    {
        // old
        const p = this.addOutPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE));
        if (v !== undefined) p.set(v);
        return p;
    };

    /**
     * deprecated create output boolean port
     * @deprecated
     * @function outBool
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outValueBool = Op.prototype.outBool = function (name, v)
    {
        // old: use outBoolNum
        const p = this.addOutPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "display": "bool"
            })
        );
        if (v !== undefined) p.set(v);
        else p.set(0);
        return p;
    };

    /**
     * create output boolean port,value will be converted to 0 or 1
     * @function outBoolNum
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outBoolNum = function (name, v)
    {
        const p = this.addOutPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "display": "boolnum"
            })
        );

        p.set = function (b)
        {
            this.setValue(b ? 1 : 0);
            // this._log.log("bool set", b, this.get());
        }.bind(p);

        if (v !== undefined) p.set(v);
        else p.set(0);
        return p;
    };

    /**
     * create output string port
     * @function outString
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outValueString = function (name, v)
    {
        const p = this.addOutPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_VALUE, {
                "type": "string"
            })
        );
        if (v !== undefined) p.set(v);
        return p;
    };
    Op.prototype.outString = function (name, v)
    {
        const p = this.addOutPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_STRING, {
                "type": "string"
            })
        );
        if (v !== undefined) p.set(v);
        else p.set("");
        return p;
    };

    /**
     * create output object port
     * @function outObject
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outObject = function (name, v, objType)
    {
        const p = this.addOutPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_OBJECT, { "objType": objType || null }));
        p.set(v || null);
        p.ignoreValueSerialize = true;
        return p;
    };

    /**
     * create output array port
     * @function outArray
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outArray = function (name, v, stride)
    {
        if (!stride && CABLES.UTILS.isNumeric(v))stride = v;
        const p = this.addOutPort(new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_ARRAY, { "stride": stride }));
        if (v !== undefined && (Array.isArray(v) || v == null)) p.set(v);

        p.ignoreValueSerialize = true;
        return p;
    };

    /**
     * create output texture port
     * @function outTexture
     * @instance
     * @memberof Op
     * @param {String} name
     * @return {Port} created port
     */
    Op.prototype.outTexture = function (name, v)
    {
        const p = this.addOutPort(
            new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_OBJECT, {
                "preview": true,
                "objType": "texture",
                "display": "texture"
            })
        );
        if (v !== undefined) p.setRef(v || CGL.Texture.getEmptyTexture(this.patch.cgl));

        p.ignoreValueSerialize = true;
        return p;
    };

    Op.prototype.inDynamic = function (name, filter, options, v)
    {
        const p = new Port(this, name, CONSTANTS.OP.OP_PORT_TYPE_DYNAMIC, options);

        p.shouldLink = function (p1, p2)
        {
            if (filter && UTILS.isArray(filter))
            {
                for (let i = 0; i < filter.length; i++)
                {
                    if (p1 == this && p2.type === filter[i]) return true;
                    if (p2 == this && p1.type === filter[i]) return true;
                }
                return false; // types do not match
            }
            return true; // no filter set
        };

        this.addInPort(p);
        if (v !== undefined)
        {
            p.set(v);
            p.defaultValue = v;
        }
        return p;
    };

    Op.prototype.removeLinks = function ()
    {
        for (let i = 0; i < this.portsIn.length; i++) this.portsIn[i].removeLinks();
        for (let i = 0; i < this.portsOut.length; i++) this.portsOut[i].removeLinks();
    };

    Op.prototype.getSerialized = function ()
    {
        const opObj = {};

        if (this.opId) opObj.opId = this.opId;
        if (this.patch.storeObjNames) opObj.objName = this.objName;

        opObj.id = this.id;
        opObj.uiAttribs = JSON.parse(JSON.stringify(this.uiAttribs)) || {};

        if (this.storage && Object.keys(this.storage).length > 0) opObj.storage = JSON.parse(JSON.stringify(this.storage));
        if (this.uiAttribs.hasOwnProperty("working") && this.uiAttribs.working == true) delete this.uiAttribs.working;
        if (opObj.uiAttribs.hasOwnProperty("uierrors")) delete opObj.uiAttribs.uierrors;

        if (opObj.uiAttribs.title === "") delete opObj.uiAttribs.title;
        if (opObj.uiAttribs.color === null) delete opObj.uiAttribs.color;
        if (opObj.uiAttribs.comment === null) delete opObj.uiAttribs.comment;

        if (opObj.uiAttribs.title == this._shortOpName ||
            (this.uiAttribs.title || "").toLowerCase() == this._shortOpName.toLowerCase()) delete opObj.uiAttribs.title;

        opObj.portsIn = [];
        opObj.portsOut = [];

        for (let i = 0; i < this.portsIn.length; i++)
        {
            const s = this.portsIn[i].getSerialized();
            if (s) opObj.portsIn.push(s);
        }

        for (let i = 0; i < this.portsOut.length; i++)
        {
            const s = this.portsOut[i].getSerialized();
            if (s) opObj.portsOut.push(s);
        }

        if (opObj.portsIn.length == 0) delete opObj.portsIn;
        if (opObj.portsOut.length == 0) delete opObj.portsOut;
        cleanJson(opObj);

        return opObj;
    };

    Op.prototype.getFirstOutPortByType = function (type)
    {
        for (const ipo in this.portsOut) if (this.portsOut[ipo].type == type) return this.portsOut[ipo];
    };

    Op.prototype.getFirstInPortByType = function (type)
    {
        for (const ipo in this.portsIn) if (this.portsIn[ipo].type == type) return this.portsIn[ipo];
    };

    /**
     * return port by the name portName
     * @function getPort
     * @instance
     * @memberof Op
     * @param {String} portName
     * @return {Port}
     */
    Op.prototype.getPort = Op.prototype.getPortByName = function (name, lowerCase)
    {
        if (lowerCase)
        {
            for (let ipi = 0; ipi < this.portsIn.length; ipi++)
                if (this.portsIn[ipi].getName().toLowerCase() == name || this.portsIn[ipi].id.toLowerCase() == name)
                    return this.portsIn[ipi];

            for (let ipo = 0; ipo < this.portsOut.length; ipo++)
                if (this.portsOut[ipo].getName().toLowerCase() == name || this.portsOut[ipo].id.toLowerCase() == name)
                    return this.portsOut[ipo];
        }
        else
        {
            for (let ipi = 0; ipi < this.portsIn.length; ipi++)
                if (this.portsIn[ipi].getName() == name || this.portsIn[ipi].id == name)
                    return this.portsIn[ipi];

            for (let ipo = 0; ipo < this.portsOut.length; ipo++)
                if (this.portsOut[ipo].getName() == name || this.portsOut[ipo].id == name)
                    return this.portsOut[ipo];
        }
    };


    /**
     * return port by the name id
     * @function getPortById
     * @instance
     * @memberof Op
     * @param {String} id
     * @return {Port}
     */
    Op.prototype.getPortById = function (id)
    {
        for (let ipi = 0; ipi < this.portsIn.length; ipi++) if (this.portsIn[ipi].id == id) return this.portsIn[ipi];
        for (let ipo = 0; ipo < this.portsOut.length; ipo++) if (this.portsOut[ipo].id == id) return this.portsOut[ipo];
    };

    Op.prototype.updateAnims = function ()
    {
        if (this._hasAnimPort)
            for (let i = 0; i < this.portsIn.length; i++) this.portsIn[i].updateAnim();
    };

    Op.prototype.log = function ()
    {
        this._log.log(...arguments);
    };

    Op.prototype.error = Op.prototype.logError = function ()
    {
        // if (!this)
        // {
        //     this._log.error("no this...!!!");
        //     debugger;
        //     return;
        // }
        // const initiator = "op " + this.objName;
        // if (CABLES.UI && !CABLES.UI.logFilter.filterLog({ "initiator": initiator, "opInstId": this.id, "level": 2 }, ...arguments)) return;

        // // if (this.patch.silent) return;
        // const args = ["[op " + CABLES.getShortOpName(this.objName) + "]"];
        // args.push.apply(args, arguments);
        // Function.prototype.apply.apply(this._log.error, [console, args]);// eslint-disable-line
        // if (window.gui) window.gui.emitEvent("opLogEvent", this.objName, "error", arguments);
        this._log.error(...arguments);
    };

    Op.prototype.warn = Op.prototype.logWarn = function ()
    {
        this._log.warn(...arguments);

        // const initiator = "op " + this.objName;
        // if (CABLES.UI && !CABLES.UI.logFilter.filterLog({ "initiator": initiator, "opInstId": this.id, "level": 1 }, ...arguments)) return;

        // // if (this.patch.silent) return;
        // const args = ["[op " + CABLES.getShortOpName(this.objName) + "]"];
        // args.push.apply(args, arguments);
        // Function.prototype.apply.apply(this._log.warn, [console, args]);// eslint-disable-line
    };

    Op.prototype.verbose = Op.prototype.logVerbose = function ()
    {
        // const initiator = "op " + CABLES.getShortOpName(this.objName);
        // if (CABLES.UI && !CABLES.UI.logFilter.filterLog({ "initiator": initiator, "opInstId": this.id, "level": 0 }, ...arguments)) return;

        // if (!CABLES.UI && this.patch.silent) return;

        // const args = ["[" + initiator + "]"];
        // args.push.apply(args, arguments);
        // Function.prototype.apply.apply(this._log.info, [console, args]);// eslint-disable-line
        this._log.verbose(...arguments);
    };


    Op.prototype.profile = function (enable)
    {
        for (let ipi = 0; ipi < this.portsIn.length; ipi++)
        {
            this.portsIn[ipi]._onTriggered = this.portsIn[ipi]._onTriggeredProfiling;
            this.portsIn[ipi].set = this.portsIn[ipi]._onSetProfiling;
        }
    };

    Op.prototype.findParent = function (objName)
    {
        for (let ipi = 0; ipi < this.portsIn.length; ipi++)
        {
            if (this.portsIn[ipi].isLinked())
            {
                if (this.portsIn[ipi].links[0].portOut.parent.objName == objName)
                    return this.portsIn[ipi].links[0].portOut.parent;

                let found = null;
                found = this.portsIn[ipi].links[0].portOut.parent.findParent(objName);
                if (found) return found;
            }
        }
        return null;
    };


    // todo: check instancing stuff?
    Op.prototype.cleanUp = function ()
    {
        if (this._instances)
        {
            for (let i = 0; i < this._instances.length; i++)
            {
                if (this._instances[i].onDelete) this._instances[i].onDelete();
            }


            this._instances.length = 0;
        }
        for (let i = 0; i < this.portsIn.length; i++)
        {
            this.portsIn[i].setAnimated(false);
        }

        if (this.onAnimFrame) this.patch.removeOnAnimFrame(this);
    };

    // todo: check instancing stuff?
    Op.prototype.instanced = function (triggerPort)
    {
        return false;
        // this._log.log("instanced", this.patch.instancing.numCycles());
        // if (this.patch.instancing.numCycles() === 0) return false;


        // let i = 0;
        // let ipi = 0;
        // if (!this._instances || this._instances.length != this.patch.instancing.numCycles())
        // {
        //     if (!this._instances) this._instances = [];
        //     this._.log("creating instances of ", this.objName, this.patch.instancing.numCycles(), this._instances.length);
        //     this._instances.length = this.patch.instancing.numCycles();

        //     for (i = 0; i < this._instances.length; i++)
        //     {
        //         this._instances[i] = this.patch.createOp(this.objName, true);
        //         this._instances[i].instanced = function ()
        //         {
        //             return false;
        //         };
        //         this._instances[i].uiAttr(this.uiAttribs);

        //         for (let ipo = 0; ipo < this.portsOut.length; ipo++)
        //         {
        //             if (this.portsOut[ipo].type == CONSTANTS.OP.OP_PORT_TYPE_FUNCTION)
        //             {
        //                 this._instances[i].getPortByName(this.portsOut[ipo].name).trigger = this.portsOut[ipo].trigger.bind(this.portsOut[ipo]);
        //             }
        //         }
        //     }

        //     for (ipi = 0; ipi < this.portsIn.length; ipi++)
        //     {
        //         this.portsIn[ipi].onChange = null;
        //         this.portsIn[ipi].onValueChanged = null;
        //     }
        // }

        // const theTriggerPort = null;
        // for (ipi = 0; ipi < this.portsIn.length; ipi++)
        // {
        //     if (
        //         this.portsIn[ipi].type == CONSTANTS.OP.OP_PORT_TYPE_VALUE ||
        //         this.portsIn[ipi].type == CONSTANTS.OP.OP_PORT_TYPE_ARRAY
        //     )
        //     {
        //         this._instances[this.patch.instancing.index()].portsIn[ipi].set(this.portsIn[ipi].get());
        //     }
        //     if (this.portsIn[ipi].type == CONSTANTS.OP.OP_PORT_TYPE_FUNCTION)
        //     {
        //         // if(this._instances[ this.patch.instancing.index() ].portsIn[ipi].name==triggerPort.name)
        //         // theTriggerPort=this._instances[ this.patch.instancing.index() ].portsIn[ipi];
        //     }
        // }

        // if (theTriggerPort) theTriggerPort.onTriggered();

        // for (ipi = 0; ipi < this.portsOut.length; ipi++)
        // {
        //     if (this.portsOut[ipi].type == CONSTANTS.OP.OP_PORT_TYPE_VALUE)
        //     {
        //         this.portsOut[ipi].set(this._instances[this.patch.instancing.index()].portsOut[ipi].get());
        //     }
        // }

        // return true;
    };

    // todo: check instancing stuff?
    Op.prototype.initInstancable = function ()
    {
        //         if(this.isInstanced)
        //         {
        //             this._log.log('cancel instancing');
        //             return;
        //         }
        //         this._instances=[];
        //         for(var ipi=0;ipi<this.portsIn.length;ipi++)
        //         {
        //             if(this.portsIn[ipi].type==CONSTANTS.OP.OP_PORT_TYPE_VALUE)
        //             {
        //
        //             }
        //             if(this.portsIn[ipi].type==CONSTANTS.OP.OP_PORT_TYPE_FUNCTION)
        //             {
        //                 // var piIndex=ipi;
        //                 this.portsIn[ipi].onTriggered=function(piIndex)
        //                 {
        //
        //                     var i=0;
        // // this._log.log('trigger',this._instances.length);
        //
        //                 }.bind(this,ipi );
        //
        //             }
        // };
        // this._instances=null;
    };

    Op.prototype.setValues = function (obj)
    {
        for (const i in obj)
        {
            const port = this.getPortByName(i);
            if (port) port.set(obj[i]);
            else this._log.warn("op.setValues: port not found:", i);
        }
    };

    /**
     * return true if op has this error message id
     * @function hasUiError
     * @instance
     * @memberof Op
     * @param {id} error id
     * @returns {Boolean} - has id
     */
    Op.prototype.hasUiError = function (id)
    {
        return this._uiErrors.hasOwnProperty(id) && this._uiErrors[id];
    };

    /**
     * show op error message - set message to null to remove error message
     * @function setUiError
     * @instance
     * @memberof Op
     * @param {id} error id
     * @param {txt} text message
     * @param {level} level
     */
    Op.prototype.setUiError = function (id, txt, level)
    {
        // overwritten in ui: core_extend_op
    };

    // todo: remove
    Op.prototype.setError = function (id, txt)
    {
        this._log.warn("old error message op.error() - use op.setUiError()");
    };


    /**
     * enable/disable op
     * @function
     * @instance
     * @memberof Op
     * @param {boolean}
     */
    Op.prototype.setEnabled = function (b)
    {
        this.enabled = b;
        this.emitEvent("onEnabledChange", b);
    };

    /**
     * organize ports into a group
     * @function
     * @instance
     * @memberof Op
     * @param {String} name
     * @param {Array} ports
     */
    Op.prototype.setPortGroup = function (name, ports)
    {
        for (let i = 0; i < ports.length; i++)
        {
            if (ports[i])
                if (ports[i].setUiAttribs) ports[i].setUiAttribs({ "group": name });
                else
                {
                    this._log.error("setPortGroup: invalid port!");
                }
        }
    };

    /**
     * visually indicate ports that they are coordinate inputs
     * @function
     * @instance
     * @memberof Op
     * @param {Port} portX
     * @param {Port} portY
     * @param {Port} portZ
     */
    Op.prototype.setUiAxisPorts = function (px, py, pz)
    {
        if (px) px.setUiAttribs({ "axis": "X" });
        if (py) py.setUiAttribs({ "axis": "Y" });
        if (pz) pz.setUiAttribs({ "axis": "Z" });
    };

    /**
     * remove port from op
     * @function removePort
     * @instance
     * @memberof Op
     * @param {Port} port to remove
     */
    Op.prototype.removePort = function (port)
    {
        for (let ipi = 0; ipi < this.portsIn.length; ipi++)
        {
            if (this.portsIn[ipi] == port)
            {
                this.portsIn.splice(ipi, 1);
                this.emitEvent("onUiAttribsChange", {});
                this.emitEvent("onPortRemoved", {});
                return;
            }
        }
        for (let ipi = 0; ipi < this.portsOut.length; ipi++)
        {
            if (this.portsOut[ipi] == port)
            {
                this.portsOut.splice(ipi, 1);
                this.emitEvent("onUiAttribsChange", {});
                this.emitEvent("onPortRemoved", {});
                return;
            }
        }
    };

    Op.prototype._checkLinksNeededToWork = function () {};

    /**
     * show a warning of this op is not a child of parentOpName
     * @function
     * @instance
     * @memberof Op
     * @param {String} parentOpName
     */
    Op.prototype.toWorkNeedsParent = function (parentOpName)
    {
        this._linkTimeRules.needsParentOp = parentOpName;
    };

    // /**
    //  * show a warning of this op is a child of parentOpName
    //  * @function
    //  * @instance
    //  * @memberof Op
    //  * @param {String} parentOpName
    //  */
    Op.prototype.toWorkShouldNotBeChild = function (parentOpName, type)
    {
        if (!this.patch.isEditorMode()) return;
        this._linkTimeRules.forbiddenParent = parentOpName;
        if (type != undefined) this._linkTimeRules.forbiddenParentType = type;
    };


    /**
     * show a small X to indicate op is not working when given ports are not linked
     * @function
     * @instance
     * @memberof Op
     * @param {Port} port1
     * @param {Port} port2
     * @param {Port} port3
     */
    Op.prototype.toWorkPortsNeedToBeLinked = function ()
    {
        if (!this.patch.isEditorMode()) return;
        for (let i = 0; i < arguments.length; i++)
            if (this._linkTimeRules.needsLinkedToWork.indexOf(arguments[i]) == -1) this._linkTimeRules.needsLinkedToWork.push(arguments[i]);
    };
    Op.prototype.toWorkPortsNeedToBeLinkedReset = function ()
    {
        if (!this.patch.isEditorMode()) return;
        this._linkTimeRules.needsLinkedToWork.length = 0;
        if (this.checkLinkTimeWarnings) this.checkLinkTimeWarnings();
    };

    Op.prototype.initVarPorts = function ()
    {
        for (let i = 0; i < this.portsIn.length; i++)
        {
            if (this.portsIn[i].getVariableName()) this.portsIn[i].setVariable(this.portsIn[i].getVariableName());
        }
    };

    /**
     * refresh op parameters, if current op is selected
     * @function
     * @instance
     * @memberof Op
     */
    Op.prototype.refreshParams = function ()
    {
        if (this.patch && this.patch.isEditorMode() && this.isCurrentUiOp())
        {
            gui.opParams.show(this);
        }
    };

    /**
     * Returns true if op is selected and parameter are shown in the editor, can only return true if in editor/ui
     * @function isCurrentUiOp
     * @instance
     * @memberof Op
     * @returns {Boolean} - is current ui op
     */
    Op.prototype.isCurrentUiOp = function ()
    {
        if (this.patch.isEditorMode()) return gui.patchView.isCurrentOp(this);
    };

    /**
     * Implement to render 2d canvas based graphics from in an op
     * @function renderVizLayer
     * @instance
     * @memberof Op
     * @param {ctx} context of canvas 2d
     * @param {Object} layer info
     * @param {number} layer.x x position on canvas
     * @param {number} layer.y y position on canvas
     * @param {number} layer.width width of canvas
     * @param {number} layer.height height of canvas
     * @param {number} layer.scale current scaling of patchfield view
     */
    Op.prototype.renderVizLayer = null; // optionaly defined in op instance
}



;// CONCATENATED MODULE: ./src/core/loadingstatus.js




/**
 * LoadingStatus class, manages asynchronous loading jobs
 *
 * @namespace external:CABLES#LoadingStatus
 * @hideconstructor
 * @class
 * @param patch
 */
const LoadingStatus = function (patch)
{
    EventTarget.apply(this);

    this._log = new Logger("LoadingStatus");
    this._loadingAssets = {};
    this._cbFinished = [];
    this._assetTasks = [];
    this._percent = 0;
    this._count = 0;
    this._countFinished = 0;
    this._order = 0;
    this._startTime = 0;
    this._patch = patch;
    this._wasFinishedPrinted = false;
    this._loadingAssetTaskCb = false;
};

LoadingStatus.prototype.setOnFinishedLoading = function (cb)
{
    this._cbFinished.push(cb);
};

LoadingStatus.prototype.getNumAssets = function ()
{
    return this._countFinished;
};

LoadingStatus.prototype.getProgress = function ()
{
    return this._percent;
};

LoadingStatus.prototype.checkStatus = function ()
{
    this._countFinished = 0;
    this._count = 0;

    for (const i in this._loadingAssets)
    {
        this._count++;
        if (!this._loadingAssets[i].finished)
        {
            this._countFinished++;
        }
    }

    this._percent = (this._count - this._countFinished) / this._count;

    if (this._countFinished === 0)
    {
        for (let j = 0; j < this._cbFinished.length; j++)
        {
            if (this._cbFinished[j])
            {
                const cb = this._cbFinished[j];
                setTimeout(() => { cb(this._patch); this.emitEvent("finishedAll"); }, 100);
            }
        }

        if (!this._wasFinishedPrinted)
        {
            this._wasFinishedPrinted = true;
            this.print();
        }
        this.emitEvent("finishedAll");
    }
};

LoadingStatus.prototype.getList = function ()
{
    let arr = [];
    for (const i in this._loadingAssets)
    {
        arr.push(this._loadingAssets[i]);
    }

    return arr;
};


LoadingStatus.prototype.getListJobs = function ()
{
    let arr = [];
    for (const i in this._loadingAssets)
    {
        if (!this._loadingAssets[i].finished)arr.push(this._loadingAssets[i].name);
    }

    return arr;
};

LoadingStatus.prototype.print = function ()
{
    if (this._patch.config.silent) return;

    const rows = [];

    for (const i in this._loadingAssets)
    {
        rows.push([
            this._loadingAssets[i].order,
            this._loadingAssets[i].type,
            this._loadingAssets[i].name,
            (this._loadingAssets[i].timeEnd - this._loadingAssets[i].timeStart) / 1000 + "s",
        ]);
    }

    this._log.groupCollapsed("finished loading " + this._order + " assets in " + (Date.now() - this._startTime) / 1000 + "s");
    this._log.table(rows);
    this._log.groupEnd();
};

LoadingStatus.prototype.finished = function (id)
{
    const l = this._loadingAssets[id];
    if (l)
    {
        if (l.finished) this._log.warn("loading job was already finished", l);

        if (l.op) l.op.setUiAttribs({ "loading": false });
        l.finished = true;
        l.timeEnd = Date.now();
    }

    this.checkStatus();
    this.emitEvent("finishedTask");
    return null;
};

LoadingStatus.prototype._startAssetTasks = function ()
{
    for (let i = 0; i < this._assetTasks.length; i++) this._assetTasks[i]();
    this._assetTasks.length = 0;
};

/**
 * delay an asset loading task, mainly to wait for ui to be finished loading and showing, and only then start loading assets
 * @function addAssetLoadingTask
 * @instance
 * @memberof LoadingStatus
 * @param {function} cb callback
 */
LoadingStatus.prototype.addAssetLoadingTask = function (cb)
{
    if (this._patch.isEditorMode() && !CABLES.UI.loaded)
    {
        this._assetTasks.push(cb);

        if (!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded", this._startAssetTasks.bind(this));
        this._loadingAssetTaskCb = true;
    }
    else
    {
        cb();
    }
    this.emitEvent("addAssetTask");
};

LoadingStatus.prototype.existByName = function (name)
{
    for (let i in this._loadingAssets)
    {
        if (this._loadingAssets[i].name == name && !this._loadingAssets[i].finished)
            return true;
    }
};

LoadingStatus.prototype.start = function (type, name, op)
{
    if (this._startTime == 0) this._startTime = Date.now();
    const id = generateUUID();

    name = name || "unknown";
    if (name.length > 100)name = name.substring(0, 100);


    if (op)op.setUiAttribs({ "loading": true });

    this._loadingAssets[id] = {
        "id": id,
        "op": op,
        "type": type,
        "name": name,
        "finished": false,
        "timeStart": Date.now(),
        "order": this._order,
    };
    this._order++;

    this.emitEvent("startTask");

    return id;
};



;// CONCATENATED MODULE: ./src/core/timer.js


/** @namespace CABLES */

const internalNow = function ()
{
    return window.performance.now();
};



/**
 * current time in milliseconds
 * @memberof CABLES
 * @function now
 * @static
 */
const now = function ()
{
    return internalNow();
};

// ----------------------------

/**
 * Measuring time
 * @namespace external:CABLES#Timer
 * @hideconstructor
 * @class
 */
const Timer = function ()
{
    EventTarget.apply(this);

    this._timeStart = internalNow();
    this._timeOffset = 0;

    this._currentTime = 0;
    this._lastTime = 0;
    this._paused = true;
    this._delay = 0;
    this.overwriteTime = -1;
};


Timer.prototype._internalNow = function ()
{
    if (this._ts) return this._ts;
    return internalNow();
};

Timer.prototype._getTime = function ()
{
    this._lastTime = (this._internalNow() - this._timeStart) / 1000;
    return this._lastTime + this._timeOffset;
};

Timer.prototype.setDelay = function (d)
{
    this._delay = d;
    this.emitEvent("timeChange");
};

/**
 * @function
 * @memberof Timer
 * @instance
 * @description returns true if timer is playing
 * @return {Boolean} value
 */
Timer.prototype.isPlaying = function ()
{
    return !this._paused;
};

/**
 * @function
 * @memberof Timer
 * @instance
 * @param ts
 * @description update timer
 * @return {Number} time
 */
Timer.prototype.update = function (ts)
{
    if (ts) this._ts = ts;
    if (this._paused) return;
    this._currentTime = this._getTime();

    return this._currentTime;
};

/**
 * @function
 * @memberof Timer
 * @instance
 * @return {Number} time in milliseconds
 */
Timer.prototype.getMillis = function ()
{
    return this.get() * 1000;
};

/**
 * @function
 * @memberof Timer
 * @instance
 * @return {Number} value time in seconds
 */
Timer.prototype.get = Timer.prototype.getTime = function ()
{
    if (this.overwriteTime >= 0) return this.overwriteTime - this._delay;
    return this._currentTime - this._delay;
};

/**
 * toggle between play/pause state
 * @function
 * @memberof Timer
 * @instance
 */
Timer.prototype.togglePlay = function ()
{
    if (this._paused) this.play();
    else this.pause();
};

/**
 * set current time
 * @function
 * @memberof Timer
 * @instance
 * @param {Number} t
 */
Timer.prototype.setTime = function (t)
{
    if (isNaN(t) || t < 0) t = 0;
    this._timeStart = this._internalNow();
    this._timeOffset = t;
    this._currentTime = t;
    this.emitEvent("timeChange");
};

Timer.prototype.setOffset = function (val)
{
    if (this._currentTime + val < 0)
    {
        this._timeStart = this._internalNow();
        this._timeOffset = 0;
        this._currentTime = 0;
    }
    else
    {
        this._timeOffset += val;
        this._currentTime = this._lastTime + this._timeOffset;
    }
    this.emitEvent("timeChange");
};

/**
 * (re)starts the timer
 * @function
 * @memberof Timer
 * @instance
 */
Timer.prototype.play = function ()
{
    this._timeStart = this._internalNow();
    this._paused = false;
    this.emitEvent("playPause");
};

/**
 * pauses the timer
 * @function
 * @memberof Timer
 * @instance
 */
Timer.prototype.pause = function ()
{
    this._timeOffset = this._currentTime;
    this._paused = true;
    this.emitEvent("playPause");
};



;// CONCATENATED MODULE: ./src/core/core_profiler.js


class Profiler
{
    constructor(patch)
    {
        this.startFrame = patch.getFrameNum();
        this.items = {};
        this.currentId = null;
        this.currentStart = 0;
        this._patch = patch;
    }

    getItems()
    {
        return this.items;
    }

    clear()
    {
        if (this.paused) return;
        this.items = {};
    }

    togglePause()
    {
        this.paused = !this.paused;
        if (!this.paused)
        {
            this.items = {};
            this.currentStart = performance.now();
        }
    }

    add(type, object)
    {
        if (this.paused) return;

        if (this.currentId !== null)
        {
            if (!object || object.id != this.currentId)
            {
                if (this.items[this.currentId])
                {
                    this.items[this.currentId].timeUsed += performance.now() - this.currentStart;

                    if (!this.items[this.currentId].peakTime || now() - this.items[this.currentId].peakTime > 5000)
                    {
                        this.items[this.currentId].peak = 0;
                        this.items[this.currentId].peakTime = now();
                    }
                    this.items[this.currentId].peak = Math.max(this.items[this.currentId].peak, performance.now() - this.currentStart);
                }
            }
        }

        if (object !== null)
        {
            if (!this.items[object.id])
            {
                this.items[object.id] = {
                    "numTriggers": 0,
                    "timeUsed": 0,
                };
            }

            if (this.items[object.id].lastFrame != this._patch.getFrameNum()) this.items[object.id].numTriggers = 0;

            this.items[object.id].lastFrame = this._patch.getFrameNum();
            this.items[object.id].numTriggers++;
            this.items[object.id].opid = object.op.id;
            this.items[object.id].title = object.op.name + "." + object.name;
            this.items[object.id].subPatch = object.op.uiAttribs.subPatch;

            this.currentId = object.id;
            this.currentStart = performance.now();
        }
        else
        {
            this.currentId = null;
        }
    }

    print()
    {
        console.log("--------");
        for (const i in this.items)
        {
            console.log(this.items[i].title + ": " + this.items[i].numTriggers + " / " + this.items[i].timeUsed);
        }
    }
}



;// CONCATENATED MODULE: ./src/core/cgl/constants.js
const SHADER = {
    // default attributes
    "SHADERVAR_VERTEX_POSITION": "vPosition",
    "SHADERVAR_VERTEX_NUMBER": "attrVertIndex",
    "SHADERVAR_VERTEX_NORMAL": "attrVertNormal",
    "SHADERVAR_VERTEX_TEXCOORD": "attrTexCoord",
    "SHADERVAR_INSTANCE_MMATRIX": "instMat",
    "SHADERVAR_VERTEX_COLOR": "attrVertColor",

    "SHADERVAR_INSTANCE_INDEX": "instanceIndex",

    // default uniforms
    "SHADERVAR_UNI_PROJMAT": "projMatrix",
    "SHADERVAR_UNI_VIEWMAT": "viewMatrix",
    "SHADERVAR_UNI_MODELMAT": "modelMatrix",
    "SHADERVAR_UNI_NORMALMAT": "normalMatrix",
    "SHADERVAR_UNI_INVVIEWMAT": "inverseViewMatrix",
    "SHADERVAR_UNI_INVPROJMAT": "invProjMatrix",
    "SHADERVAR_UNI_MATERIALID": "materialId",
    "SHADERVAR_UNI_OBJECTID": "objectId",

    "SHADERVAR_UNI_VIEWPOS": "camPos",
};


const BLEND_MODES = {
    "BLEND_NONE": 0,
    "BLEND_NORMAL": 1,
    "BLEND_ADD": 2,
    "BLEND_SUB": 3,
    "BLEND_MUL": 4,
};





const RAD2DEG = 180.0 / Math.PI;
const DEG2RAD = Math.PI / 180.0;

const constants_CONSTANTS = {
    "MATH": {
        "DEG2RAD": DEG2RAD,
        "RAD2DEG": RAD2DEG,
    },
    "SHADER": SHADER,
    "BLEND_MODES": BLEND_MODES,
};




;// CONCATENATED MODULE: ./src/core/cg/cg_uniform.js



class CgUniform
{
    constructor(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName)
    {
        this._log = new Logger("cg_uniform");
        this._type = __type;
        this._name = __name;
        this._shader = __shader;
        this._value = 0.00001;
        this._oldValue = null;
        this._port = null;
        this._structName = _structName;
        this._structUniformName = _structUniformName;
        this._propertyName = _propertyName;

        this._shader._addUniform(this);
        this.needsUpdate = true;
        this.shaderType = null;
        this.comment = null;

        if (__type == "f")
        {
            this.set = this.setValue = this.setValueF.bind(this);
            this.updateValue = this.updateValueF.bind(this);
        }
        else if (__type == "f[]")
        {
            this.set = this.setValue = this.setValueArrayF.bind(this);
            this.updateValue = this.updateValueArrayF.bind(this);
        }
        else if (__type == "2f[]")
        {
            this.set = this.setValue = this.setValueArray2F.bind(this);
            this.updateValue = this.updateValueArray2F.bind(this);
        }
        else if (__type == "3f[]")
        {
            this.set = this.setValue = this.setValueArray3F.bind(this);
            this.updateValue = this.updateValueArray3F.bind(this);
        }
        else if (__type == "4f[]")
        {
            this.set = this.setValue = this.setValueArray4F.bind(this);
            this.updateValue = this.updateValueArray4F.bind(this);
        }
        else if (__type == "i")
        {
            this.set = this.setValue = this.setValueI.bind(this);
            this.updateValue = this.updateValueI.bind(this);
        }
        else if (__type == "2i")
        {
            this.set = this.setValue = this.setValue2I.bind(this);
            this.updateValue = this.updateValue2I.bind(this);
        }
        else if (__type == "3i")
        {
            this.set = this.setValue = this.setValue3I.bind(this);
            this.updateValue = this.updateValue3I.bind(this);
        }
        else if (__type == "4i")
        {
            this.set = this.setValue = this.setValue4I.bind(this);
            this.updateValue = this.updateValue4I.bind(this);
        }
        else if (__type == "b")
        {
            this.set = this.setValue = this.setValueBool.bind(this);
            this.updateValue = this.updateValueBool.bind(this);
        }
        else if (__type == "4f")
        {
            this.set = this.setValue = this.setValue4F.bind(this);
            this.updateValue = this.updateValue4F.bind(this);
        }
        else if (__type == "3f")
        {
            this.set = this.setValue = this.setValue3F.bind(this);
            this.updateValue = this.updateValue3F.bind(this);
        }
        else if (__type == "2f")
        {
            this.set = this.setValue = this.setValue2F.bind(this);
            this.updateValue = this.updateValue2F.bind(this);
        }
        else if (__type == "t")
        {
            this.set = this.setValue = this.setValueT.bind(this);
            this.updateValue = this.updateValueT.bind(this);
        }
        else if (__type == "sampler")
        {
            if (this.setValueAny)
            {
                this.set = this.setValue = this.setValueAny.bind(this);
                this.updateValue = this.updateValueAny.bind(this);
            }
        }
        else if (__type == "tc")
        {
            this.set = this.setValue = this.setValueT.bind(this);
            this.updateValue = this.updateValueT.bind(this);
        }
        else if (__type == "t[]")
        {
            this.set = this.setValue = this.setValueArrayT.bind(this);
            this.updateValue = this.updateValueArrayT.bind(this);
        }
        else if (__type == "m4" || __type == "m4[]")
        {
            this.set = this.setValue = this.setValueM4.bind(this);
            this.updateValue = this.updateValueM4.bind(this);
        }
        else
        {
            // console.error("unknown");
            this._log.error("Unknown uniform type " + __type);
        }

        if (typeof _value == "object" && _value instanceof Port)
        {
            this._port = _value;
            this._value = this._port.get();


            if (_port2 && _port3 && _port4)
            {
                if (!(_port2 instanceof Port) || !(_port3 instanceof Port) || !(_port4 instanceof Port))
                {
                    this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ", this._name);
                }

                this._value = [0, 0, 0, 0];
                this._port2 = _port2;
                this._port3 = _port3;
                this._port4 = _port4;

                this._port.on("change", this.updateFromPort4f.bind(this));
                this._port2.on("change", this.updateFromPort4f.bind(this));
                this._port3.on("change", this.updateFromPort4f.bind(this));
                this._port4.on("change", this.updateFromPort4f.bind(this));

                // this._port.onChange = this._port2.onChange = this._port3.onChange = this._port4.onChange = this.updateFromPort4f.bind(this);
                this.updateFromPort4f();
            }
            else if (_port2 && _port3)
            {
                if (!(_port2 instanceof Port) || !(_port3 instanceof Port))
                {
                    this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ", this._name);
                }

                this._value = [0, 0, 0];
                this._port2 = _port2;
                this._port3 = _port3;
                // this._port.onChange = this._port2.onChange = this._port3.onChange = this.updateFromPort3f.bind(this);
                this._port.on("change", this.updateFromPort3f.bind(this));
                this._port2.on("change", this.updateFromPort3f.bind(this));
                this._port3.on("change", this.updateFromPort3f.bind(this));

                this.updateFromPort3f();
            }
            else if (_port2)
            {
                if (!(_port2 instanceof Port))
                {
                    this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ", this._name);
                }

                this._value = [0, 0];
                this._port2 = _port2;
                // this._port.onChange = this._port2.onChange = this.updateFromPort2f.bind(this);
                this._port.on("change", this.updateFromPort2f.bind(this));
                this._port2.on("change", this.updateFromPort2f.bind(this));

                this.updateFromPort2f();
            }
            else
            {
                // this._port.on = this.updateFromPort.bind(this);
                this._port.on("change", this.updateFromPort.bind(this));
            }
        }
        else this._value = _value;


        if (this._value == undefined)
        {
            console.log("value undefined", this);
            this._value = 0;
        }

        this.setValue(this._value);

        this.needsUpdate = true;
    }

    getType()
    {
        return this._type;
    }

    get type()
    {
        return this._type;
    }

    get name()
    {
        return this._name;
    }

    getName()
    {
        return this._name;
    }

    getValue()
    {
        return this._value;
    }

    getShaderType()
    {
        return this.shaderType;
    }

    isStructMember()
    {
        return !!this._structName;
    }


    updateFromPort4f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this._value[2] = this._port3.get();
        this._value[3] = this._port4.get();
        this.setValue(this._value);
    }

    updateFromPort3f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this._value[2] = this._port3.get();
        this.setValue(this._value);
    }

    updateFromPort2f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this.setValue(this._value);
    }

    updateFromPort()
    {
        this.setValue(this._port.get());
    }
}

/* harmony default export */ const cg_uniform = (CgUniform);

;// CONCATENATED MODULE: ./src/core/cgl/cgl_shader_uniform.js




/**
 * Shader uniforms
 *
 * types:
 * <pre>
 * f    - float
 * 2f   - vec2
 * 3f   - vec3
 * 4f   - vec4
 * i    - integer
 * t    - texture
 * m4   - mat4, 4x4 float matrix
 * f[]  - array of floats
 * 2f[] - array of float vec2
 * 3f[] - array of float vec3
 * 4f[] - array of float vec4
 * </pre>
 *
 * @namespace external:CGL
 * @class
 * @param {Shader} shader
 * @param {String} [type=f]
 * @param {String} name
 * @param {Number|Port} value  can be a Number,Matrix or Port
 * @example
 * // bind float uniform called myfloat and initialize with value 1.0
 * const unir=new CGL.Uniform(shader,'f','myfloat',1.0);
 * unir.setValue(1.0);
 *
 * // bind float uniform called myfloat and automatically set it to input port value
 * const myPort=op.inFloat("input");
 * const pv=new CGL.Uniform(shader,'f','myfloat',myPort);
 *
 */


// export const Uniform(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName)

class Uniform extends cg_uniform
{
    constructor(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName)
    {
        super(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName);
        this._loc = -1;
        this._cgl = __shader._cgl;
    }

    get name()
    {
        return this._name;
    }

    copy(newShader)
    {
        const uni = new Uniform(newShader, this._type, this._name, this._value, this._port2, this._port3, this._port4, this._structUniformName, this._structName, this._propertyName);
        uni.shaderType = this.shaderType;
        return uni;
    }

    /**
     * returns type as glsl type string. e.g. 'f' returns 'float'
     * @function getGlslTypeString
     * @memberof Uniform
     * @instance
     * @return {string} type as string
     */
    getGlslTypeString()
    {
        return Uniform.glslTypeString(this._type);
    }

    _isValidLoc()
    {
        return this._loc != -1;// && this._loc != null;
    }

    resetLoc()
    {
        this._loc = -1;
        this.needsUpdate = true;
    }

    bindTextures() {}

    getLoc()
    {
        return this._loc;
    }

    updateFromPort4f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this._value[2] = this._port3.get();
        this._value[3] = this._port4.get();
        this.setValue(this._value);
    }

    updateFromPort3f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this._value[2] = this._port3.get();
        this.setValue(this._value);
    }

    updateFromPort2f()
    {
        this._value[0] = this._port.get();
        this._value[1] = this._port2.get();
        this.setValue(this._value);
    }

    updateFromPort()
    {
        this.setValue(this._port.get());
    }

    updateValueF()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        this._shader.getCgl().gl.uniform1f(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueF(v)
    {
        if (v != this._value)
        {
            this.needsUpdate = true;
            this._value = v;
        }
    }

    updateValueI()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        this._shader.getCgl().gl.uniform1i(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    updateValue2I()
    {
        if (!this._value) return;

        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        this._shader.getCgl().gl.uniform2i(this._loc, this._value[0], this._value[1]);

        this.needsUpdate = false;
        this._cgl.profileData.profileUniformCount++;
    }

    updateValue3I()
    {
        if (!this._value) return;
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        this._shader.getCgl().gl.uniform3i(this._loc, this._value[0], this._value[1], this._value[2]);
        this.needsUpdate = false;
        this._cgl.profileData.profileUniformCount++;
    }

    updateValue4I()
    {
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }
        this._shader.getCgl().gl.uniform4i(this._loc, this._value[0], this._value[1], this._value[2], this._value[3]);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueI(v)
    {
        if (v != this._value)
        {
            this.needsUpdate = true;
            this._value = v;
        }
    }

    setValue2I(v)
    {
        if (!v) return;
        if (!this._oldValue)
        {
            this._oldValue = [v[0] - 1, 1];
            this.needsUpdate = true;
        }
        else if (v[0] != this._oldValue[0] || v[1] != this._oldValue[1])
        {
            this._oldValue[0] = v[0];
            this._oldValue[1] = v[1];
            this.needsUpdate = true;
        }

        this._value = v;
    }

    setValue3I(v)
    {
        if (!v) return;
        if (!this._oldValue)
        {
            this._oldValue = [v[0] - 1, 1, 2];
            this.needsUpdate = true;
        }
        else if (v[0] != this._oldValue[0] || v[1] != this._oldValue[1] || v[2] != this._oldValue[2])
        {
            this._oldValue[0] = v[0];
            this._oldValue[1] = v[1];
            this._oldValue[2] = v[2];
            this.needsUpdate = true;
        }

        this._value = v;
    }

    setValue4I(v)
    {
        this.needsUpdate = true;
        this._value = v || vec4.create();
    }

    updateValueBool()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;
        this._shader.getCgl().gl.uniform1i(this._loc, this._value ? 1 : 0);

        this._cgl.profileData.profileUniformCount++;
    }

    setValueBool(v)
    {
        if (v != this._value)
        {
            this.needsUpdate = true;
            this._value = v;
        }
    }

    setValueArray4F(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValueArray4F()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        if (!this._value) return;
        this._shader.getCgl().gl.uniform4fv(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueArray3F(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValueArray3F()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        if (!this._value) return;
        this._shader.getCgl().gl.uniform3fv(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueArray2F(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValueArray2F()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        if (!this._value) return;
        this._shader.getCgl().gl.uniform2fv(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueArrayF(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValueArrayF()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        if (!this._value) return;
        this._shader.getCgl().gl.uniform1fv(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueArrayT(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }


    updateValue3F()
    {
        if (!this._value) return;
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        this._shader.getCgl().gl.uniform3f(this._loc, this._value[0], this._value[1], this._value[2]);
        this.needsUpdate = false;
        this._cgl.profileData.profileUniformCount++;
    }

    setValue3F(v)
    {
        if (!v) return;
        if (!this._oldValue)
        {
            this._oldValue = [v[0] - 1, 1, 2];
            this.needsUpdate = true;
        }
        else if (v[0] != this._oldValue[0] || v[1] != this._oldValue[1] || v[2] != this._oldValue[2])
        {
            this._oldValue[0] = v[0];
            this._oldValue[1] = v[1];
            this._oldValue[2] = v[2];
            this.needsUpdate = true;
        }

        this._value = v;
    }

    updateValue2F()
    {
        if (!this._value) return;

        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        this._shader.getCgl().gl.uniform2f(this._loc, this._value[0], this._value[1]);
        this.needsUpdate = false;
        this._cgl.profileData.profileUniformCount++;
    }

    setValue2F(v)
    {
        if (!v) return;
        if (!this._oldValue)
        {
            this._oldValue = [v[0] - 1, 1];
            this.needsUpdate = true;
        }
        else if (v[0] != this._oldValue[0] || v[1] != this._oldValue[1])
        {
            this._oldValue[0] = v[0];
            this._oldValue[1] = v[1];
            this.needsUpdate = true;
        }
        this._value = v;
    }

    updateValue4F()
    {
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        if (!this._value)
        {
            this._log.warn("no value for uniform", this._name, this);
            this._value = [0, 0, 0, 0];
        }

        this.needsUpdate = false;
        this._shader.getCgl().gl.uniform4f(this._loc, this._value[0], this._value[1], this._value[2], this._value[3]);
        this._cgl.profileData.profileUniformCount++;
    }

    setValue4F(v)
    {
        if (typeof this.value == "number") this.value = vec4.create(); // this should not be needed, but somehow it crashes with some shadermods

        if (!v) return;
        if (!this._oldValue)
        {
            this._oldValue = [v[0] - 1, 1, 2, 3];
            this.needsUpdate = true;
        }
        else if (v[0] != this._oldValue[0] || v[1] != this._oldValue[1] || v[2] != this._oldValue[2] || v[3] != this._oldValue[3])
        {
            this._oldValue[0] = v[0];
            this._oldValue[1] = v[1];
            this._oldValue[2] = v[2];
            this.needsUpdate = true;
        }

        this._value = v;
    }

    updateValueM4()
    {
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }
        if (!this._value || this._value.length % 16 != 0) return console.log("this.name", this._name, this._value);

        this._shader.getCgl().gl.uniformMatrix4fv(this._loc, false, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    setValueM4(v)
    {
        this.needsUpdate = true;
        this._value = v || mat4.create();
    }

    updateValueArrayT()
    {
        if (!this._isValidLoc()) this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
        else this.needsUpdate = false;

        if (!this._value) return;
        this._shader.getCgl().gl.uniform1iv(this._loc, this._value);
        this._cgl.profileData.profileUniformCount++;
    }

    updateValueT()
    {
        if (!this._isValidLoc())
        {
            this._loc = this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(), this._name);
            this._cgl.profileData.profileShaderGetUniform++;
            this._cgl.profileData.profileShaderGetUniformName = this._name;
        }

        this._cgl.profileData.profileUniformCount++;
        this._shader.getCgl().gl.uniform1i(this._loc, this._value);
        this.needsUpdate = false;
    }

    setValueT(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }
}


Uniform.glslTypeString = (t) =>
{
    if (t == "f") return "float";
    if (t == "b") return "bool";
    if (t == "i") return "int";
    if (t == "2i") return "ivec2";
    if (t == "2f") return "vec2";
    if (t == "3f") return "vec3";
    if (t == "4f") return "vec4";
    if (t == "m4") return "mat4";

    if (t == "t") return "sampler2D";
    if (t == "tc") return "samplerCube";

    if (t == "3f[]") return null; // ignore this for now...
    if (t == "m4[]") return null; // ignore this for now...
    if (t == "f[]") return null; // ignore this for now...

    console.warn("[CGL UNIFORM] unknown glsl type string ", t);
};


/**
 * @function setValue
 * @memberof Uniform
 * @instance
 * @param {Number|Array|Matrix|Texture} value
 */



;// CONCATENATED MODULE: ./src/core/cg/cg_texture.js
const DEFAULT_TEXTURE_SIZE = 8;

class CgTexture
{
    constructor(options = {})
    {
        this.id = CABLES.uuid();
        this.width = 0;
        this.height = 0;
        this.name = "unknown";

        options = options || {};
        this.pixelFormat = options.pixelFormat || CgTexture.PFORMATSTR_RGBA8UB;

        this.name = options.name || "unknown";

        if (!options.width) options.width = DEFAULT_TEXTURE_SIZE;
        if (!options.height) options.height = DEFAULT_TEXTURE_SIZE;
    }
}


CgTexture.getDefaultTextureData = (name, size, options = {}) =>
{
    if (name == "empty")
    {
        return new Uint8Array(size * size * 4).fill(0);
    }
    else
    if (name == "color")
    {
        const data = new Uint8Array(size * size * 4);
        let r = options.r || 1;
        let g = options.g || 1;
        let b = options.b || 1;

        for (let x = 0; x < size * size; x++)
        {
            data[x * 4 + 0] = r;
            data[x * 4 + 1] = g;
            data[x * 4 + 2] = b;
            data[x * 4 + 3] = 255;
        }
        return data;
    }
    else
    if (name == "randomUInt")
    {
        const data = new Uint8Array(size * size * 4);

        for (let x = 0; x < size * size; x++)
        {
            data[x * 4 + 0] = Math.random() * 255;
            data[x * 4 + 1] = Math.random() * 255;
            data[x * 4 + 2] = Math.random() * 255;
            data[x * 4 + 3] = 255;
        }
        return data;
    }
    else
    if (name == "random" || name == "randomFloat")
    {
        const data = new Float32Array(size * size * 4);

        for (let x = 0; x < size * size; x++)
        {
            data[x * 4 + 0] = (Math.random() - 0.5) * 2.0;
            data[x * 4 + 1] = (Math.random() - 0.5) * 2.0;
            data[x * 4 + 2] = (Math.random() - 0.5) * 2.0;
            data[x * 4 + 3] = 1;
        }
        return data;
    }
    else
    if (name == "stripes")
    {
        const arr = [];

        let r = options.r;
        let g = options.g;
        let b = options.b;

        if (r === undefined)r = 1;
        if (g === undefined)g = 1;
        if (b === undefined)b = 1;

        for (let y = 0; y < size; y++)
        {
            for (let x = 0; x < size; x++)
            {
                if ((x + y) % 64 < 32)
                {
                    arr.push((200 + (y / size) * 25 + (x / size) * 25) * r);
                    arr.push((200 + (y / size) * 25 + (x / size) * 25) * g);
                    arr.push((200 + (y / size) * 25 + (x / size) * 25) * b);
                }
                else
                {
                    arr.push((40 + (y / size) * 25 + (x / size) * 25) * r);
                    arr.push((40 + (y / size) * 25 + (x / size) * 25) * g);
                    arr.push((40 + (y / size) * 25 + (x / size) * 25) * b);
                }
                arr.push(255);
            }
        }

        return new Uint8Array(arr);
    }
    else
    {
        console.warn("unknown default texture", name);
        return CgTexture.getDefaultTextureData("stripes", size, { "r": 1, "g": 0, "b": 0 });
    }
};



CgTexture.FILTER_NEAREST = 0;
CgTexture.FILTER_LINEAR = 1;
CgTexture.FILTER_MIPMAP = 2;

CgTexture.WRAP_REPEAT = 0;
CgTexture.WRAP_MIRRORED_REPEAT = 1;
CgTexture.WRAP_CLAMP_TO_EDGE = 2;

CgTexture.TYPE_DEFAULT = 0;
CgTexture.TYPE_DEPTH = 1;
CgTexture.TYPE_FLOAT = 2;


CgTexture.PFORMATSTR_RGB565 = "RGB 5/6/5bit ubyte";

CgTexture.PFORMATSTR_R8UB = "R 8bit ubyte";
CgTexture.PFORMATSTR_RG8UB = "RG 8bit ubyte";
CgTexture.PFORMATSTR_RGB8UB = "RGB 8bit ubyte";
CgTexture.PFORMATSTR_RGBA8UB = "RGBA 8bit ubyte";

CgTexture.PFORMATSTR_SRGBA8 = "SRGBA 8bit ubyte";

CgTexture.PFORMATSTR_R11FG11FB10F = "RGB 11/11/10bit float";

CgTexture.PFORMATSTR_R16F = "R 16bit float";
CgTexture.PFORMATSTR_RG16F = "RG 16bit float";
CgTexture.PFORMATSTR_RGB16F = "RGB 16bit float";
CgTexture.PFORMATSTR_RGBA16F = "RGBA 16bit float";


CgTexture.PFORMATSTR_R32F = "R 32bit float";
CgTexture.PFORMATSTR_RG32F = "RG 32bit float";
CgTexture.PFORMATSTR_RGB32F = "RGB 32bit float";
CgTexture.PFORMATSTR_RGBA32F = "RGBA 32bit float";

CgTexture.PFORMATSTR_DEPTH = "DEPTH";


CgTexture.PIXELFORMATS = [

    CgTexture.PFORMATSTR_RGB565,

    CgTexture.PFORMATSTR_R8UB,
    CgTexture.PFORMATSTR_RG8UB,
    CgTexture.PFORMATSTR_RGB8UB,
    CgTexture.PFORMATSTR_RGBA8UB,

    CgTexture.PFORMATSTR_SRGBA8,

    CgTexture.PFORMATSTR_R11FG11FB10F,
    CgTexture.PFORMATSTR_R16F,
    CgTexture.PFORMATSTR_RG16F,
    CgTexture.PFORMATSTR_RGBA16F,

    CgTexture.PFORMATSTR_R32F,
    CgTexture.PFORMATSTR_RGBA32F

];

;// CONCATENATED MODULE: ./src/core/cgl/cgl_texture.js




const cgl_texture_DEFAULT_TEXTURE_SIZE = 8;

/**
 * A Texture
 * @namespace external:CGL
 * @class
 * @param {Context} __cgl cgl
 * @param {Object} options
 * @hideconstructor
 * @example
 * // generate a 256x256 pixel texture of random colors
 * const size=256;
 * const data = new Uint8Array(size*size*4);
 *
 * for(var x=0;x<size*size*4;x++) data[ x*4+3]=255;
 *
 * const tex=new CGL.Texture(cgl);
 * tex.initFromData(data,size,size,CGL.Texture.FILTER_NEAREST,CGL.Texture.WRAP_REPEAT);
 */
class Texture extends CgTexture
{
    constructor(__cgl, options = {})
    {
        super(options);
        if (!__cgl) throw new Error("no cgl");
        this._log = new Logger("cgl_texture");
        this._cgl = __cgl;
        this.tex = this._cgl.gl.createTexture();
        this.loading = false;
        this.flip = true;
        this.flipped = false;
        this.shadowMap = false;
        this.deleted = false;
        this.image = null;
        this.anisotropic = 0;
        this.filter = Texture.FILTER_NEAREST;
        this.wrap = Texture.WRAP_CLAMP_TO_EDGE;
        this.texTarget = this._cgl.gl.TEXTURE_2D;
        if (options && options.type) this.texTarget = options.type;
        this.textureType = Texture.TYPE_DEFAULT;
        this.unpackAlpha = true;
        this._fromData = true;

        this._glDataType = -1;
        this._glInternalFormat = -1;
        this._glDataFormat = -1;


        if (options)
        {
            if (options.isDepthTexture) this.textureType = Texture.TYPE_DEPTH;
            if (options.isFloatingPointTexture === true) this.textureType = Texture.TYPE_FLOAT;

            if ("textureType" in options) this.textureType = options.textureType;
            if ("filter" in options) this.filter = options.filter;
            if ("wrap" in options) this.wrap = options.wrap;
            if ("unpackAlpha" in options) this.unpackAlpha = options.unpackAlpha;
            if ("flip" in options) this.flip = options.flip;
            if ("shadowMap" in options) this.shadowMap = options.shadowMap;
            if ("anisotropic" in options) this.anisotropic = options.anisotropic;
        }
        else
        {
            options = {};
        }

        if (!options.pixelFormat && options.isFloatingPointTexture) this.pixelFormat = Texture.PFORMATSTR_RGBA32F;

        if (this.textureType == Texture.TYPE_DEPTH) this.pixelFormat = Texture.PFORMATSTR_DEPTH;

        this._cgl.profileData.profileTextureNew++;


        this.setFormat(Texture.setUpGlPixelFormat(this._cgl, this.pixelFormat));
        this._cgl.profileData.addHeavyEvent("texture created", this.name, options.width + "x" + options.height);

        this.setSize(options.width, options.height);
        this.getInfoOneLine();
    }



    isFloatingPoint()
    {
        return Texture.isPixelFormatFloat(this.pixelFormat);
    }

    /**
     * returns true if otherTexture has same options (width/height/filter/wrap etc)
     * @function compareSettings
     * @memberof Texture
     * @instance
     * @param {Texture} tex otherTexture
     * @returns {Boolean}
     */
    compareSettings(tex)
    {
    // if (!tex) { this._log.warn("compare: no tex"); return false; }
    // if (tex.width != this.width) this._log.warn("tex.width not equal", tex.width, this.width);
    // if (tex.height != this.height) this._log.warn("tex.height not equal", tex.height, this.height);
    // if (tex.filter != this.filter) this._log.warn("tex.filter not equal");
    // if (tex.wrap != this.wrap) this._log.warn("tex.wrap not equal");
    // if (tex.textureType != this.textureType) this._log.warn("tex.textureType not equal");
    // if (tex.unpackAlpha != this.unpackAlpha) this._log.warn("tex.unpackAlpha not equal");
    // if (tex.anisotropic != this.anisotropic) this._log.warn("tex.anisotropic not equal");
    // if (tex.shadowMap != this.shadowMap) this._log.warn("tex.shadowMap not equal");
    // if (tex.texTarget != this.texTarget) this._log.warn("tex.texTarget not equal");
    // if (tex.flip != this.flip) this._log.warn("tex.flip not equal");

        if (!tex) return false;
        return (
            tex.width == this.width &&
            tex.height == this.height &&
            tex.filter == this.filter &&
            tex.wrap == this.wrap &&
            tex.textureType == this.textureType &&
            tex.unpackAlpha == this.unpackAlpha &&
            tex.anisotropic == this.anisotropic &&
            tex.shadowMap == this.shadowMap &&
            tex.texTarget == this.texTarget &&
            tex.flip == this.flip
        );
    }

    /**
     * returns a new texture with the same settings (does not copy texture itself)
     * @function clone
     * @memberof Texture
     * @instance
     * @returns {Texture}
     */
    clone()
    {
        const newTex = new Texture(this._cgl, {
            "name": this.name,
            "filter": this.filter,
            "anisotropic": this.anisotropic,
            "wrap": this.wrap,
            "textureType": this.textureType,
            "pixelFormat": this.pixelFormat,
            "unpackAlpha": this.unpackAlpha,
            "flip": this.flip,
            "width": this.width,
            "height": this.height,
        });

        this._cgl.profileData.addHeavyEvent("texture created", this.name, this.width + "x" + this.height);

        if (!this.compareSettings(newTex))
        {
            this._log.error("Cloned texture settings do not compare!");
            this._log.error(this);
            this._log.error(newTex);
        }

        return newTex;
    }


    setFormat(o)
    {
        this.pixelFormat = o.pixelFormat;
        this._glDataFormat = o.glDataFormat;
        this._glInternalFormat = o.glInternalFormat;
        this._glDataType = o.glDataType;
    }



    /**
     * set pixel size of texture
     * @function setSize
     * @memberof Texture
     * @instance
     * @param {Number} w width
     * @param {Number} h height
     */
    setSize(w, h)
    {
        if (this._cgl.aborted) return;
        if (w != w || w <= 0 || !w) w = cgl_texture_DEFAULT_TEXTURE_SIZE;
        if (h != h || h <= 0 || !h) h = cgl_texture_DEFAULT_TEXTURE_SIZE;

        if (w > this._cgl.maxTexSize || h > this._cgl.maxTexSize) this._log.error("texture size too big! " + w + "x" + h + " / max: " + this._cgl.maxTexSize);

        w = Math.min(w, this._cgl.maxTexSize);
        h = Math.min(h, this._cgl.maxTexSize);

        w = Math.floor(w);
        h = Math.floor(h);
        if (this.width == w && this.height == h) return;

        w = this._cgl.checkTextureSize(w);
        h = this._cgl.checkTextureSize(h);

        this.width = w;
        this.height = h;
        this.deleted = false;

        this.setFormat(Texture.setUpGlPixelFormat(this._cgl, this.pixelFormat));

        this.shortInfoString = this.getInfoOneLine();// w + "x" + h + "";

        this._cgl.gl.bindTexture(this.texTarget, this.tex);
        this._cgl.profileData.profileTextureResize++;

        const uarr = null;

        this._cgl.gl.texImage2D(this.texTarget, 0, this._glInternalFormat, w, h, 0, this._glDataFormat, this._glDataType, uarr);

        this._setFilter();

        this.updateMipMap();

        this._cgl.gl.bindTexture(this.texTarget, null);
    }


    /**
     * @function initFromData
     * @memberof Texture
     * @instance
     * @description create texturem from rgb data
     * @param {Array<Number>} data rgb color array [r,g,b,a,r,g,b,a,...]
     * @param {Number} w width
     * @param {Number} h height
     * @param {Number} filter
     * @param {Number} wrap
     */
    initFromData(data, w, h, filter, wrap)
    {
        this.filter = filter;
        this.wrap = wrap;
        if (filter == undefined) this.filter = Texture.FILTER_LINEAR;
        if (wrap == undefined) this.wrap = Texture.WRAP_CLAMP_TO_EDGE;
        this.width = w;
        this.height = h;
        this._fromData = true;
        this.deleted = false;

        if (this.height > this._cgl.maxTexSize || this.width > this._cgl.maxTexSize)
        {
            const t = CGL.Texture.getTempTexture(this._cgl);
            this.width = t.width;
            this.height = t.height;
            this.tex = t.tex;
            this._log.warn("[cgl_texture] texture size too big!", this.width, this.height, this._cgl.maxTexSize);
            return;
        }

        if (this.flip) this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL, this.flip);

        this._cgl.gl.bindTexture(this.texTarget, this.tex);

        this.setFormat(Texture.setUpGlPixelFormat(this._cgl, this.pixelFormat));

        this._cgl.gl.texImage2D(this.texTarget, 0, this._glInternalFormat, w, h, 0, this._glDataFormat, this._glDataType, data);

        this._setFilter();
        this.updateMipMap();

        if (this.flip) this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL, false);
        this._cgl.gl.bindTexture(this.texTarget, null);
    }

    updateMipMap()
    {
        if ((this._cgl.glVersion == 2 || this.isPowerOfTwo()) && this.filter == Texture.FILTER_MIPMAP)
        {
            this._cgl.gl.generateMipmap(this.texTarget);
            this._cgl.profileData.profileGenMipMap++;
        }
    }

    /**
     * set texture data from an image/canvas object
     * @function initTexture
     * @memberof Texture
     * @instance
     * @param {Object} img image
     * @param {Number} filter
     */
    initTexture(img, filter)
    {
        this._cgl.printError("before initTexture");
        this._cgl.checkFrameStarted("texture inittexture");
        this._fromData = false;

        this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.unpackAlpha);
        if (img.width || img.videoWidth) this.width = img.videoWidth || img.width;
        if (img.height || img.videoHeight) this.height = img.videoHeight || img.height;

        if (filter !== undefined) this.filter = filter; // todo: can we remove this filter param?

        if (img.height > this._cgl.maxTexSize || img.width > this._cgl.maxTexSize)
        {
            const t = CGL.Texture.getTempTexture(this._cgl);
            this.width = t.width;
            this.height = t.height;
            this.tex = t.tex;
            this._log.warn("[cgl_texture] texture size too big!", img.width, img.height, this._cgl.maxTexSize);
            return;
        }

        this._cgl.gl.bindTexture(this.texTarget, this.tex);

        this.deleted = false;
        this.flipped = !this.flip;
        if (this.flipped) this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL, this.flipped);


        this.setFormat(Texture.setUpGlPixelFormat(this._cgl, this.pixelFormat));

        this._cgl.gl.texImage2D(this.texTarget, 0, this._glInternalFormat, this._glDataFormat, this._glDataType, img);

        this._setFilter();
        this.updateMipMap();

        this._cgl.gl.bindTexture(this.texTarget, null);
        this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
        if (this.flipped) this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL, false);

        this.getInfoOneLine();
        this._cgl.printError("initTexture");
    }

    /**
     * delete texture. use this when texture is no longer needed
     * @function delete
     * @memberof Texture
     * @instance
     */
    dispose()
    {
        this.delete();
    }

    delete()
    {
        if (this.loading)
        {
        // cant delete texture when still loading
        // setTimeout(this.delete.bind(this), 50);
            return;
        }

        this.deleted = true;
        this.width = 0;
        this.height = 0;
        this._cgl.profileData.profileTextureDelete++;
        this._cgl.gl.deleteTexture(this.tex);
        this.image = null;

        this.tex = null;
    }

    /**
     * @function isPowerOfTwo
     * @memberof Texture
     * @instance
     * @description return true if texture width and height are both power of two
     * @return {Boolean}
     */
    isPowerOfTwo()
    {
        return Texture.isPowerOfTwo(this.width) && Texture.isPowerOfTwo(this.height);
    }

    printInfo()
    {
        console.log(this.getInfo());
    }

    getInfoReadable()
    {
        const info = this.getInfo();
        let html = "";

        info.name = info.name.substr(0, info.name.indexOf("?rnd="));

        for (const i in info)
        {
            html += "* " + i + ":  **" + info[i] + "**\n";
        }

        return html;
    }

    getInfoOneLine()
    {
        let txt = "" + this.width + "x" + this.height;
        txt += " ";
        // if (this.textureType === CGL.Texture.TYPE_FLOAT) txt += " 32bit"; else txt += " 8bit";
        // if (this.textureType === CGL.Texture.TYPE_FLOAT) txt += " 32bit"; else txt += " 8bit";
        txt += this.pixelFormat;

        if (this.filter === CGL.Texture.FILTER_NEAREST) txt += " nearest";
        if (this.filter === CGL.Texture.FILTER_LINEAR) txt += " linear";
        if (this.filter === CGL.Texture.FILTER_MIPMAP) txt += " mipmap";

        if (this.wrap === CGL.Texture.WRAP_CLAMP_TO_EDGE) txt += " clamp";
        if (this.wrap === CGL.Texture.WRAP_REPEAT) txt += " repeat";
        if (this.wrap === CGL.Texture.WRAP_MIRRORED_REPEAT) txt += " repeatmir";

        this.shortInfoString = txt;

        return txt;
    }

    getInfoOneLineShort()
    {
        let txt = "" + this.width + "x" + this.height;
        // if (this.textureType === CGL.Texture.TYPE_FLOAT) txt += " 32bit"; else txt += " 8bit";
        txt += " ";
        txt += this.pixelFormat;

        this.shortInfoString = txt;

        return txt;
    }


    getInfo()
    {
        return Texture.getTexInfo(this);
    }


    _setFilter()
    {
        this._cgl.printError("before _setFilter");

        if (!this._fromData)
        {
            this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.unpackAlpha);
        }

        if (this.shadowMap)
        {
            this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D, this._cgl.gl.TEXTURE_COMPARE_MODE, this._cgl.gl.COMPARE_REF_TO_TEXTURE);
            this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D, this._cgl.gl.TEXTURE_COMPARE_FUNC, this._cgl.gl.LEQUAL);
        }

        if (this.textureType == Texture.TYPE_FLOAT && this.filter == Texture.FILTER_MIPMAP)
        {
            this.filter = Texture.FILTER_LINEAR;
            this._log.stack("texture: HDR and mipmap filtering at the same time is not possible");
        }

        if (this._cgl.glVersion == 1 && !this.isPowerOfTwo())
        {
            this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MAG_FILTER, this._cgl.gl.NEAREST);
            this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MIN_FILTER, this._cgl.gl.NEAREST);

            this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_S, this._cgl.gl.CLAMP_TO_EDGE);
            this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_T, this._cgl.gl.CLAMP_TO_EDGE);

            this.filter = Texture.FILTER_NEAREST;
            this.wrap = Texture.WRAP_CLAMP_TO_EDGE;
        }
        else
        {
            if (this.wrap == Texture.WRAP_CLAMP_TO_EDGE)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_S, this._cgl.gl.CLAMP_TO_EDGE);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_T, this._cgl.gl.CLAMP_TO_EDGE);
            }
            else if (this.wrap == Texture.WRAP_REPEAT)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_S, this._cgl.gl.REPEAT);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_T, this._cgl.gl.REPEAT);
            }
            else if (this.wrap == Texture.WRAP_MIRRORED_REPEAT)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_S, this._cgl.gl.MIRRORED_REPEAT);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_WRAP_T, this._cgl.gl.MIRRORED_REPEAT);
            }

            if (this.filter == Texture.FILTER_NEAREST)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MAG_FILTER, this._cgl.gl.NEAREST);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MIN_FILTER, this._cgl.gl.NEAREST);
            }
            else if (this.filter == Texture.FILTER_LINEAR)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MIN_FILTER, this._cgl.gl.LINEAR);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MAG_FILTER, this._cgl.gl.LINEAR);
            }
            else if (this.filter == Texture.FILTER_MIPMAP)
            {
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MAG_FILTER, this._cgl.gl.LINEAR);
                this._cgl.gl.texParameteri(this.texTarget, this._cgl.gl.TEXTURE_MIN_FILTER, this._cgl.gl.LINEAR_MIPMAP_LINEAR);
            }
            else
            {
                this._log.log("unknown texture filter!", this.filter);
                throw new Error("unknown texture filter!" + this.filter);
            }

            if (this.anisotropic)
            {
                const ext = this._cgl.enableExtension("EXT_texture_filter_anisotropic");



                if (this._cgl.maxAnisotropic)
                {
                    const aniso = Math.min(this._cgl.maxAnisotropic, this.anisotropic);
                    this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D, ext.TEXTURE_MAX_ANISOTROPY_EXT, aniso);
                }
            }
        }
        this.getInfoOneLine();
        this._cgl.printError("_setFilter");
    }
}


























/**
 * @function load
 * @static
 * @memberof Texture
 * @description load an image from an url
 * @param {Context} cgl
 * @param {String} url
 * @param {Function} finishedCallback
 * @param {Object} settings
 * @return {Texture}
 */
Texture.load = function (cgl, url, finishedCallback, settings)
{
    if (!url) return finishedCallback({ "error": true });
    let loadingId = null;
    if (!cgl.patch.loading.existByName(url)) loadingId = cgl.patch.loading.start("cgl.texture", url);

    const texture = new Texture(cgl);
    texture.name = url;

    texture.image = new Image();
    texture.image.crossOrigin = "anonymous";
    texture.loading = true;

    if (settings && settings.hasOwnProperty("filter")) texture.filter = settings.filter;
    if (settings && settings.hasOwnProperty("flip")) texture.flip = settings.flip;
    if (settings && settings.hasOwnProperty("wrap")) texture.wrap = settings.wrap;
    if (settings && settings.hasOwnProperty("anisotropic")) texture.anisotropic = settings.anisotropic;
    if (settings && settings.hasOwnProperty("unpackAlpha")) texture.unpackAlpha = settings.unpackAlpha;
    if (settings && settings.hasOwnProperty("pixelFormat")) texture.pixelFormat = settings.pixelFormat;

    texture.image.onabort = texture.image.onerror = (e) =>
    {
        console.warn("[cgl.texture.load] error loading texture", url, e);
        texture.loading = false;
        if (loadingId) cgl.patch.loading.finished(loadingId);
        const error = { "error": true };
        if (finishedCallback) finishedCallback(error, texture);
    };

    texture.image.onload = function (e)
    {
        cgl.addNextFrameOnceCallback(() =>
        {
            texture.initTexture(texture.image);
            if (loadingId) cgl.patch.loading.finished(loadingId);
            texture.loading = false;

            if (finishedCallback) finishedCallback(null, texture);
        });
    };
    texture.image.src = url;

    return texture;
};






/**
 * @static
 * @function getTempTexture
 * @memberof Texture
 * @description returns the default temporary texture (grey diagonal stipes)
 * @param {Context} cgl
 * @return {Texture}
 */
Texture.getTempTexture = function (cgl)
{
    if (!cgl) console.error("[getTempTexture] no cgl!");
    if (!cgl.tempTexture) cgl.tempTexture = Texture.getTemporaryTexture(cgl, 256, Texture.FILTER_LINEAR, Texture.REPEAT);
    return cgl.tempTexture;
};

/**
 * @static
 * @function getErrorTexture
 * @memberof Texture
 * @description returns the default temporary texture (grey diagonal stipes)
 * @param {Context} cgl
 * @return {Texture}
 */
Texture.getErrorTexture = function (cgl)
{
    if (!cgl) console.error("[getTempTexture] no cgl!");
    if (!cgl.errorTexture) cgl.errorTexture = Texture.getTemporaryTexture(cgl, 256, Texture.FILTER_LINEAR, Texture.REPEAT, 1, 0.2, 0.2);
    return cgl.errorTexture;
};


/**
 * @function getEmptyTexture
 * @memberof Texture
 * @instance
 * @param cgl
 * @param fp
 * @description returns a reference to a small empty (transparent) texture
 * @return {Texture}
 */
Texture.getEmptyTexture = function (cgl, fp)
{
    if (fp) return Texture.getEmptyTextureFloat(cgl);
    if (!cgl) console.error("[getEmptyTexture] no cgl!");
    if (cgl.tempTextureEmpty) return cgl.tempTextureEmpty;

    let size = 8;

    cgl.tempTextureEmpty = new Texture(cgl, { "name": "emptyTexture" });
    const data = Texture.getDefaultTextureData("empty", size);

    cgl.tempTextureEmpty.initFromData(data, size, size, Texture.FILTER_NEAREST, Texture.WRAP_REPEAT);

    return cgl.tempTextureEmpty;
};

/**
 * @function getEmptyTextureFloat
 * @memberof Texture
 * @instance
 * @param cgl
 * @description returns a reference to a small empty (transparent) 32bit texture
 * @return {Texture}
 */
Texture.getEmptyTextureFloat = function (cgl)
{
    if (!cgl) console.error("[getEmptyTextureFloat] no cgl!");
    if (cgl.tempTextureEmptyFloat) return cgl.tempTextureEmptyFloat;

    cgl.tempTextureEmptyFloat = new Texture(cgl, { "name": "emptyTexture", "isFloatingPointTexture": true });
    const data = new Float32Array(8 * 8 * 4).fill(1);
    for (let i = 0; i < 8 * 8 * 4; i += 4) data[i + 3] = 0;

    cgl.tempTextureEmptyFloat.initFromData(data, 8, 8, Texture.FILTER_NEAREST, Texture.WRAP_REPEAT);

    return cgl.tempTextureEmptyFloat;
};


/**
 * @function getRandomTexture
 * @memberof Texture
 * @static
 * @param cgl
 * @description returns a reference to a random texture
 * @return {Texture}
 */
Texture.getRandomTexture = function (cgl)
{
    if (!cgl) console.error("[getRandomTexture] no cgl!");
    if (cgl.randomTexture) return cgl.randomTexture;

    const size = 256;
    const data = Texture.getDefaultTextureData("randomUInt", size);

    cgl.randomTexture = new Texture(cgl);
    cgl.randomTexture.initFromData(data, size, size, Texture.FILTER_NEAREST, Texture.WRAP_REPEAT);

    return cgl.randomTexture;
};

/**
 * @function getRandomFloatTexture
 * @memberof Texture
 * @static
 * @param cgl
 * @description returns a reference to a texture containing random numbers between -1 and 1
 * @return {Texture}
 */
Texture.getRandomFloatTexture = function (cgl)
{
    if (!cgl) console.error("[getRandomTexture] no cgl!");
    if (cgl.getRandomFloatTexture) return cgl.getRandomFloatTexture;

    const size = 256;
    const data = Texture.getDefaultTextureData("randomFloat", size);

    cgl.getRandomFloatTexture = new Texture(cgl, { "isFloatingPointTexture": true });
    cgl.getRandomFloatTexture.initFromData(data, size, size, Texture.FILTER_NEAREST, Texture.WRAP_REPEAT);

    return cgl.getRandomFloatTexture;
};

/**
 * @function getBlackTexture
 * @memberof Texture
 * @static
 * @param cgl
 * @description returns a reference to a black texture
 * @return {Texture}
 */
Texture.getBlackTexture = function (cgl)
{
    if (!cgl) this._log.error("[getBlackTexture] no cgl!");
    if (cgl.blackTexture) return cgl.blackTexture;

    const size = 8;
    const data = Texture.getDefaultTextureData("color", size, { "r": 0, "g": 0, "b": 0 });

    cgl.blackTexture = new Texture(cgl);
    cgl.blackTexture.initFromData(data, size, size, Texture.FILTER_NEAREST, Texture.WRAP_REPEAT);

    return cgl.blackTexture;
};


/**
 * @function getEmptyCubemapTexture
 * @memberof Texture
 * @static
 * @param cgl
 * @description returns an empty cubemap texture with rgba = [0, 0, 0, 0]
 * @return {Texture}
 */
Texture.getEmptyCubemapTexture = function (cgl)
{
    const faces = [
        cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_X,
        cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,
        cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,
        cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,
        cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,
        cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z
    ];

    const tex = cgl.gl.createTexture();
    const target = cgl.gl.TEXTURE_CUBE_MAP;
    const filter = Texture.FILTER_NEAREST;
    const wrap = Texture.WRAP_CLAMP_TO_EDGE;
    const width = 8;
    const height = 8;

    cgl.profileData.profileTextureNew++;


    cgl.gl.bindTexture(target, tex);
    cgl.profileData.profileTextureResize++;

    for (let i = 0; i < 6; i += 1)
    {
        const data = new Uint8Array(8 * 8 * 4);

        cgl.gl.texImage2D(faces[i], 0, cgl.gl.RGBA, 8, 8, 0, cgl.gl.RGBA, cgl.gl.UNSIGNED_BYTE, data);
        cgl.gl.texParameteri(target, cgl.gl.TEXTURE_MAG_FILTER, cgl.gl.NEAREST);
        cgl.gl.texParameteri(target, cgl.gl.TEXTURE_MIN_FILTER, cgl.gl.NEAREST);

        cgl.gl.texParameteri(target, cgl.gl.TEXTURE_WRAP_S, cgl.gl.CLAMP_TO_EDGE);
        cgl.gl.texParameteri(target, cgl.gl.TEXTURE_WRAP_T, cgl.gl.CLAMP_TO_EDGE);
    }


    cgl.gl.bindTexture(target, null);

    return {
        "id": CABLES.uuid(),
        "tex": tex,
        "cubemap": tex,
        "width": width,
        "height": height,
        "filter": filter,
        "wrap": wrap,
        "unpackAlpha": true,
        "flip": true,
        "_fromData": true,
        "name": "emptyCubemapTexture",
        "anisotropic": 0,
    };
};


Texture.getTempGradientTexture = function (cgl) // deprecated...
{
    if (!cgl) console.error("[getTempGradientTexture] no cgl!");
    return Texture.getTempTexture(cgl);
};

Texture.getTemporaryTexture = function (cgl, size, filter, wrap, r, g, b)
{
    const data = Texture.getDefaultTextureData("stripes", 256, { "r": r, "g": g, "b": b });
    const temptex = new Texture(cgl);
    temptex.initFromData(data, size, size, filter, wrap);
    return temptex;
};

/**
 * @static
 * @function createFromImage
 * @memberof Texture
 * @description create texturem from image data (e.g. image or canvas)
 * @param {Context} cgl
 * @param {Object} img image
 * @param {Object} options
 */
Texture.createFromImage = function (cgl, img, options)
{
    options = options || {};
    const texture = new Texture(cgl, options);
    texture.flip = false;
    texture.image = img;
    texture.width = img.videoWidth || img.width || 8;
    texture.height = img.videoHeight || img.height || 8;
    if (options.hasOwnProperty("wrap"))texture.wrap = options.wrap;

    texture.initTexture(img, options.filter);

    return texture;
};

// deprecated!
Texture.fromImage = function (cgl, img, filter, wrap)
{
    console.error("deprecated texture from image...");

    const texture = new Texture(cgl);
    texture.flip = false;
    if (filter) texture.filter = filter;
    if (wrap) texture.wrap = wrap;
    texture.image = img;
    texture.initTexture(img);
    return texture;
};

/**
 * @static
 * @function isPowerOfTwo
 * @memberof Texture
 * @description returns true if x is power of two
 * @param {Number} x
 * @return {Boolean}
 */
Texture.isPowerOfTwo = function (x)
{
    return x == 1 || x == 2 || x == 4 || x == 8 || x == 16 || x == 32 || x == 64 || x == 128 || x == 256 || x == 512 || x == 1024 || x == 2048 || x == 4096 || x == 8192 || x == 16384;
};

Texture.getTexInfo = function (tex)
{
    const obj = {};

    obj.name = tex.name;
    obj["power of two"] = tex.isPowerOfTwo();
    obj.size = tex.width + " x " + tex.height;

    let targetString = tex.texTarget;
    if (tex.texTarget == tex._cgl.gl.TEXTURE_2D) targetString = "TEXTURE_2D";
    obj.target = targetString;

    obj.unpackAlpha = tex.unpackAlpha;

    if (tex.cubemap)obj.cubemap = true;

    if (tex.textureType == Texture.TYPE_FLOAT) obj.textureType = "TYPE_FLOAT";
    if (tex.textureType == Texture.TYPE_HALF_FLOAT) obj.textureType = "TYPE_HALF_FLOAT";
    else if (tex.textureType == Texture.TYPE_DEPTH) obj.textureType = "TYPE_DEPTH";
    else if (tex.textureType == Texture.TYPE_DEFAULT) obj.textureType = "TYPE_DEFAULT";
    else obj.textureType = "UNKNOWN " + this.textureType;

    if (tex.wrap == Texture.WRAP_CLAMP_TO_EDGE) obj.wrap = "CLAMP_TO_EDGE";
    else if (tex.wrap == Texture.WRAP_REPEAT) obj.wrap = "WRAP_REPEAT";
    else if (tex.wrap == Texture.WRAP_MIRRORED_REPEAT) obj.wrap = "WRAP_MIRRORED_REPEAT";
    else obj.wrap = "UNKNOWN";

    if (tex.filter == Texture.FILTER_NEAREST) obj.filter = "FILTER_NEAREST";
    else if (tex.filter == Texture.FILTER_LINEAR) obj.filter = "FILTER_LINEAR";
    else if (tex.filter == Texture.FILTER_MIPMAP) obj.filter = "FILTER_MIPMAP";
    else obj.filter = "UNKNOWN";

    obj.pixelFormat = tex.pixelFormat || "unknown";

    return obj;
};

Texture.setUpGlPixelFormat = function (cgl, pixelFormatStr)
{
    const o = {};

    if (!pixelFormatStr)
    {
        cgl._log.error("no pixelformatstr!");
        cgl._log.log(new Error());
        pixelFormatStr = Texture.PFORMATSTR_RGBA8UB;
    }

    o.pixelFormatBase = pixelFormatStr;
    o.pixelFormat = pixelFormatStr;
    o.glDataType = cgl.gl.UNSIGNED_BYTE;
    o.glInternalFormat = cgl.gl.RGBA8;
    o.glDataFormat = cgl.gl.RGBA;

    let floatDatatype = cgl.gl.FLOAT;

    if (cgl.glUseHalfFloatTex)
    {
        if (pixelFormatStr == Texture.PFORMATSTR_RGBA32F) pixelFormatStr = Texture.PFORMATSTR_RGBA16F;
        if (pixelFormatStr == Texture.PFORMATSTR_RG32F) pixelFormatStr = Texture.PFORMATSTR_RG16F;
        if (pixelFormatStr == Texture.PFORMATSTR_R32F) pixelFormatStr = Texture.PFORMATSTR_R16F;
    }

    if (pixelFormatStr.contains("16bit"))
    {
        if (cgl.glVersion == 2)
        {
            // cgl.enableExtension("OES_texture_half_float");
            const hasExt = cgl.enableExtension("EXT_color_buffer_half_float");

            if (!hasExt)
            {
                console.warn("no 16bit extension, fallback to 32bit", pixelFormatStr);
                // fallback to 32 bit?
                if (pixelFormatStr == Texture.PFORMATSTR_RGBA16F) pixelFormatStr = Texture.PFORMATSTR_RGBA32F;
                if (pixelFormatStr == Texture.PFORMATSTR_RGB16F) pixelFormatStr = Texture.PFORMATSTR_RGB32F;
                if (pixelFormatStr == Texture.PFORMATSTR_RG16F) pixelFormatStr = Texture.PFORMATSTR_RG32F;
                if (pixelFormatStr == Texture.PFORMATSTR_R16F) pixelFormatStr = Texture.PFORMATSTR_R32F;
            }
            else
            {
                floatDatatype = cgl.gl.HALF_FLOAT;
            }
        }
    }

    if (cgl.glVersion == 1)
    {
        o.glInternalFormat = cgl.gl.RGBA;

        if (pixelFormatStr == Texture.PFORMATSTR_RGBA16F || pixelFormatStr == Texture.PFORMATSTR_RG16F || pixelFormatStr == Texture.PFORMATSTR_R16F)
        {
            const ext = cgl.enableExtension("OES_texture_half_float");
            if (!ext) throw new Error("no half float texture extension");

            floatDatatype = ext.HALF_FLOAT_OES;
        }
    }


    if (pixelFormatStr == Texture.PFORMATSTR_RGBA8UB)
    {
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RGB565)
    {
        o.glInternalFormat = cgl.gl.RGB565;
        o.glDataFormat = cgl.gl.RGB;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_R8UB)
    {
        o.glInternalFormat = cgl.gl.R8;
        o.glDataFormat = cgl.gl.RED;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RG8UB)
    {
        o.glInternalFormat = cgl.gl.RG8;
        o.glDataFormat = cgl.gl.RG;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RGB8UB)
    {
        o.glInternalFormat = cgl.gl.RGB8;
        o.glDataFormat = cgl.gl.RGB;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_SRGBA8)
    {
        o.glInternalFormat = cgl.gl.SRGB8_ALPHA8;
    }

    else if (pixelFormatStr == Texture.PFORMATSTR_R32F)
    {
        o.glInternalFormat = cgl.gl.R32F;
        o.glDataFormat = cgl.gl.RED;
        o.glDataType = floatDatatype;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_R16F)
    {
        o.glInternalFormat = cgl.gl.R16F;
        o.glDataType = floatDatatype;
        o.glDataFormat = cgl.gl.RED;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RG16F)
    {
        o.glInternalFormat = cgl.gl.RG16F;
        o.glDataType = floatDatatype;
        o.glDataFormat = cgl.gl.RG;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RGBA16F)
    {
        if (cgl.glVersion == 1) o.glInternalFormat = cgl.gl.RGBA;
        else o.glInternalFormat = cgl.gl.RGBA16F;
        o.glDataType = floatDatatype;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_R11FG11FB10F)
    {
        o.glInternalFormat = cgl.gl.R11F_G11F_B10F;
        o.glDataType = floatDatatype;
        o.glDataFormat = cgl.gl.RGB;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_RGBA32F)
    {
        if (cgl.glVersion == 1) o.glInternalFormat = cgl.gl.RGBA;
        else o.glInternalFormat = cgl.gl.RGBA32F;
        o.glDataType = floatDatatype;
    }
    else if (pixelFormatStr == Texture.PFORMATSTR_DEPTH)
    {
        if (cgl.glVersion == 1)
        {
            o.glInternalFormat = cgl.gl.DEPTH_COMPONENT;
            o.glDataType = cgl.gl.UNSIGNED_SHORT;
            o.glDataFormat = cgl.gl.DEPTH_COMPONENT;
        }
        else
        {
            o.glInternalFormat = cgl.gl.DEPTH_COMPONENT32F;
            o.glDataType = cgl.gl.FLOAT;
            o.glDataFormat = cgl.gl.DEPTH_COMPONENT;
        }
    }
    else
    {
        console.log("unknown pixelformat ", pixelFormatStr);
    }

    /// //////

    if (pixelFormatStr.contains("32bit") || pixelFormatStr == Texture.PFORMATSTR_R11FG11FB10F)
    {
        if (cgl.glVersion == 2) cgl.enableExtension("EXT_color_buffer_float");
        if (cgl.glVersion == 2) cgl.enableExtension("EXT_float_blend");

        cgl.enableExtension("OES_texture_float_linear"); // yes, i am sure, this is a webgl 1 and 2 ext
    }


    o.numColorChannels = Texture.getPixelFormatNumChannels(pixelFormatStr);


    if (!o.glDataType || !o.glInternalFormat || !o.glDataFormat) console.log("pixelformat wrong ?!", pixelFormatStr, o.glDataType, o.glInternalFormat, o.glDataFormat, this);

    return o;
};



Texture.getPixelFormatNumChannels =
    (pxlFrmtStr) =>
    {
        if (pxlFrmtStr.startsWith("RGBA")) return 4;
        if (pxlFrmtStr.startsWith("RGB")) return 3;
        if (pxlFrmtStr.startsWith("RG")) return 2;
        return 1;
    };

Texture.isPixelFormatFloat =
    (pxlFrmtStr) =>
    {
        return (pxlFrmtStr || "").contains("float");
    };

Texture.isPixelFormatHalfFloat =
    (pxlFrmtStr) =>
    {
        return (pxlFrmtStr || "").contains("float") && (pxlFrmtStr || "").contains("16bit");
    };






;// CONCATENATED MODULE: ./src/core/cg/cg_boundingbox.js


/**
 * bounding box
 *
 * @namespace external:CGL
 * @param {Geometry} geometry or bounding box
 */
class BoundingBox
{
    constructor(geom)
    {
        this._init();
        this._first = true;
        this._wireMesh = null;

        if (geom) this.apply(geom);
    }

    _init()
    {
        this._max = [-0, -0, -0];
        this._min = [0, 0, 0];
        this._center = [0, 0, 0];
        this._size = [0, 0, 0];
        this._maxAxis = 0.0;
        this._first = true;
    }

    /**
     * get biggest number of maxX,maxY,maxZ
     * @type {Number}
     */
    get maxAxis() { return this._maxAxis || 1; }

    /**
     * size of bounding box
     * @type {vec3}
     */
    get size() { return this._size; }

    /**
     * center of bounding box
     * @type {vec3}
     */
    get center() { return this._center; }

    /**
     * center x
     * @type {Number}
     */
    get x() { return this._center[0]; }

    /**
     * center y
     * @type {Number}
     */
    get y() { return this._center[1]; }

    /**
     * center z
     * @type {Number}
     */
    get z() { return this._center[2]; }


    /**
     * minimum x
     * @type {Number}
     */
    get minX() { return this._min[0]; }

    /**
     * minimum y
     * @type {Number}
     */
    get minY() { return this._min[1]; }

    /**
     * minimum z
     * @type {Number}
     */
    get minZ() { return this._min[2]; }

    /**
     * maximum x
     * @type {Number}
     */
    get maxX() { return this._max[0]; }

    /**
     * maximum y
     * @type {Number}
     */
    get maxY() { return this._max[1]; }

    /**
     * maximum z
     * @type {Number}
     */
    get maxZ() { return this._max[2]; }


    apply(geom, mat)
    {
        if (!geom)
        {
            // console.warn("[boundingbox] no geom/vertices", geom);
            return;
        }

        if (geom instanceof BoundingBox)
        {
            const bb = geom;

            this.applyPos(bb.maxX, bb.maxY, bb.maxZ);
            this.applyPos(bb.minX, bb.minY, bb.minZ);
        }
        else
        {
            for (let i = 0; i < geom.vertices.length; i += 3)
                this.applyPos(geom.vertices[i], geom.vertices[i + 1], geom.vertices[i + 2]);
        }
        this.calcCenterSize();
    }

    /**
     * returns a copy of the bounding box
     * @function copy
     * @memberof BoundingBox
     * @instance
     */
    copy()
    {
        return new BoundingBox(this);
    }

    get changed()
    {
        return !(this._max[0] == -Number.MAX_VALUE && this._max[1] == -Number.MAX_VALUE && this._max[2] == -Number.MAX_VALUE);
    }

    applyPos(x, y, z)
    {
        if (x == Number.MAX_VALUE || x == -Number.MAX_VALUE ||
            y == Number.MAX_VALUE || y == -Number.MAX_VALUE ||
            z == Number.MAX_VALUE || z == -Number.MAX_VALUE) return;

        if (!CABLES.UTILS.isNumeric(x) || !CABLES.UTILS.isNumeric(y) || !CABLES.UTILS.isNumeric(z)) return;

        if (this._first)
        {
            this._max[0] = x;
            this._max[1] = y;
            this._max[2] = z;

            this._min[0] = x;
            this._min[1] = y;
            this._min[2] = z;
            this._first = false;
            return;
        }

        this._max[0] = Math.max(this._max[0], x);
        this._max[1] = Math.max(this._max[1], y);
        this._max[2] = Math.max(this._max[2], z);

        this._min[0] = Math.min(this._min[0], x);
        this._min[1] = Math.min(this._min[1], y);
        this._min[2] = Math.min(this._min[2], z);
    }

    calcCenterSize()
    {
        if (this._first) return;


        this._size[0] = this._max[0] - this._min[0];
        this._size[1] = this._max[1] - this._min[1];
        this._size[2] = this._max[2] - this._min[2];

        this._center[0] = (this._min[0] + this._max[0]) / 2;
        this._center[1] = (this._min[1] + this._max[1]) / 2;
        this._center[2] = (this._min[2] + this._max[2]) / 2;

        this._maxAxis = Math.max(this._size[2], Math.max(this._size[0], this._size[1]));
    }

    mulMat4(m)
    {
        if (this._first)
        {
            this._max[0] = 0;
            this._max[1] = 0;
            this._max[2] = 0;

            this._min[0] = 0;
            this._min[1] = 0;
            this._min[2] = 0;
            this._first = false;
        }
        vec3.transformMat4(this._max, this._max, m);
        vec3.transformMat4(this._min, this._min, m);
        this.calcCenterSize();
    }

    render(cgl, shader, op)
    {
        if (!this._wireMesh) this._wireMesh = new CGL.WireCube(cgl);

        cgl.pushModelMatrix();
        mat4.translate(cgl.mMatrix, cgl.mMatrix, this._center);

        if (CABLES.UI && op)
        {
            CABLES.UI.OverlayMeshes.drawCube(op, this._size[0] / 2, this._size[1] / 2, this._size[2] / 2);
        }

        cgl.popModelMatrix();
    }
}

;// CONCATENATED MODULE: ./src/core/cg/cg_geom.js
// import { vec2, vec3 } from "gl-matrix";




/**
 * a geometry contains all information about a mesh, vertices, texturecoordinates etc. etc.
 * @namespace external:CGL#Geometry
 * @param {String} name
 * @class
 * @example
 * // create a triangle with all attributes
 * const geom=new Geometry("triangle"),
 *
 * geom.vertices = [
 *      0.0,           sizeH.get(),  0.0,
 *     -sizeW.get(),  -sizeH.get(),  0.0,
 *      sizeW.get(),  -sizeH.get(),  0.0 ];
 *
 * geom.vertexNormals = [
 *      0.0,  0.0,  1.0,
 *      0.0,  0.0,  1.0,
 *      0.0,  0.0,  1.0 ];
 *
 * geom.tangents = [
 *     1,0,0,
 *     1,0,0,
 *     1,0,0 ];
 *
 * geom.biTangents = [
 *     0,1,0,
 *     0,1,0,
 *     0,1,0 ];
 *
 * geom.texCoords = [
 *      0.5,  0.0,
 *      1.0,  1.0,
 *      0.0,  1.0, ];
 *
 * geom.verticesIndices = [
 *     0, 1, 2 ];
 *
 */
const Geometry = function (name)
{
    this.name = name || "unknown";
    this._log = new Logger("cgl_geometry");

    this.faceVertCount = 3;
    this.glPrimitive = null;
    this._attributes = {};

    this._vertices = [];
    this.verticesIndices = [];

    this.isGeometry = true;

    this.morphTargets = [];

    Object.defineProperty(this, "vertices", {
        get()
        {
            return this._vertices;
        },
        set(v)
        {
            this.setVertices(v);
        },
    });

    Object.defineProperty(this, "texCoords", {
        get()
        {
            const att = this.getAttribute("texCoords");
            if (!att) return [];
            return att.data;
        },
        set(v)
        {
            this.setAttribute("texCoords", v, 2);
        },
    });

    Object.defineProperty(this, "vertexNormals", {
        get()
        {
            const att = this.getAttribute("vertexNormals");
            if (!att) return [];
            return att.data;
        },
        set(v)
        {
            this.setAttribute("vertexNormals", v, 3);
        },
    });

    Object.defineProperty(this, "tangents", {
        get()
        {
            const att = this.getAttribute("tangents");
            if (!att) return [];
            return att.data;
        },
        set(v)
        {
            this.setAttribute("tangents", v, 3);
        },
    });

    Object.defineProperty(this, "biTangents", {
        get()
        {
            const att = this.getAttribute("biTangents");
            if (!att) return [];
            return att.data;
        },
        set(v)
        {
            this.setAttribute("biTangents", v, 3);
        },
    });

    Object.defineProperty(this, "vertexColors", {
        get()
        {
            const att = this.getAttribute("vertexColors");
            if (!att) return [];
            return att.data;
        },
        set(v)
        {
            this.setAttribute("vertexColors", v, 4);
        },
    });
};

/**
 * @function clear
 * @memberof Geometry
 * @instance
 * @description clear all buffers/set them to length 0
 */
Geometry.prototype.clear = function ()
{
    this._vertices = new Float32Array([]);
    this.verticesIndices = [];
    this.texCoords = new Float32Array([]);
    this.vertexNormals = new Float32Array([]);
    this.tangents = [];
    this.biTangents = [];
    this._attributes = {};
};



/**
 * @function getAttributes
   @memberof Geometry
 * @instance
 * @return {Array<Object>} returns array of attribute objects
 */
Geometry.prototype.getAttributes = function ()
{
    return this._attributes;
};

/**
 * @function getAttribute
 * @memberof Geometry
 * @instance
 * @param {String} name
 * @return {Object}
 */
Geometry.prototype.getAttribute = function (name)
{
    for (const i in this._attributes)
    {
        if (this._attributes[i].name == name) return this._attributes[i];
    }
    return null;
};

/**
 * @function setAttribute
 * @description create an attribute
 * @memberof Geometry
 * @instance
 * @param {String} name
 * @param {Array} arr
 * @param {Number} itemSize
 */
Geometry.prototype.setAttribute = function (name, arr, itemSize)
{
    let attrType = "";
    if (!itemSize || itemSize > 4)
    {
        console.log("itemsize wrong?", itemSize, name);
        this._log.stack("itemsize");

        itemSize = 3;
    }

    if (itemSize == 1) attrType = "float";
    else if (itemSize == 2) attrType = "vec2";
    else if (itemSize == 3) attrType = "vec3";
    else if (itemSize == 4) attrType = "vec4";


    const attr = {
        "name": name,
        "data": arr,
        "itemSize": itemSize,
        "type": attrType,
    };

    this._attributes[name] = attr;
};

Geometry.prototype.copyAttribute = function (name, newgeom)
{
    const attr = this.getAttribute(name);
    newgeom.setAttribute(name, new Float32Array(attr.data), attr.itemSize);
};


/**
 * @function setVertices
 * @memberof Geometry
 * @instance
 * @description set vertices
 * @param {Array|Float32Array} arr [x,y,z,x,y,z,...]
 */
Geometry.prototype.setVertices = function (arr)
{
    if (arr instanceof Float32Array) this._vertices = arr;
    else this._vertices = new Float32Array(arr);
};

/**
 * @function setTexCoords
 * @memberof Geometry
 * @instance
 * @description set texcoords
 * @param {Array|Float32Array} arr [u,v,u,v,...]
 */
Geometry.prototype.setTexCoords = function (arr)
{
    if (arr instanceof Float32Array) this.texCoords = arr;
    else this.texCoords = new Float32Array(arr);
};

// Geometry.prototype.testIndices = function ()
// {
//     var foundError = false;
//     for (var i = 0; i < this.verticesIndices.length; i++)
//     {
//         if (this.verticesIndices[i * 3 + 0] >= this._vertices.length / 3 || this.verticesIndices[i * 3 + 1] >= this._vertices.length / 3 || this.verticesIndices[i * 3 + 2] >= this._vertices.length / 3)
//         {
//             foundError = true;
//             console.log("index error!");
//         }
//     }
// };

// deprecated
Geometry.prototype.calcNormals = function (smooth)
{
    const options = { "smooth": smooth };
    this.calculateNormals(options);
};

/**
 * @function flipNormals
 * @memberof Geometry
 * @param x
 * @param y
 * @param z
 * @description flip normals
 */
Geometry.prototype.flipNormals = function (x, y, z)
{
    let vec = vec3.create();

    if (x == undefined)x = 1;
    if (y == undefined)y = 1;
    if (z == undefined)z = 1;


    for (let i = 0; i < this.vertexNormals.length; i += 3)
    {
        vec3.set(vec,
            this.vertexNormals[i + 0],
            this.vertexNormals[i + 1],
            this.vertexNormals[i + 2]);

        vec[0] *= -x;
        vec[1] *= -y;
        vec[2] *= -z;

        vec3.normalize(vec, vec);

        this.vertexNormals[i + 0] = vec[0];
        this.vertexNormals[i + 1] = vec[1];
        this.vertexNormals[i + 2] = vec[2];
    }
};

Geometry.prototype.getNumTriangles = function ()
{
    if (this.verticesIndices && this.verticesIndices.length) return this.verticesIndices.length / 3;
    return this.vertices.length / 3;
};


/**
 * @function flipVertDir
 * @memberof Geometry
 * @description flip order of vertices in geom faces
 */
Geometry.prototype.flipVertDir = function ()
{
    const newInd = [];
    newInd.length = this.verticesIndices.length;
    for (let i = 0; i < this.verticesIndices.length; i += 3)
    {
        newInd[i] = this.verticesIndices[i + 2];
        newInd[i + 1] = this.verticesIndices[i + 1];
        newInd[i + 2] = this.verticesIndices[i];
    }
    this.verticesIndices = newInd;
};


Geometry.prototype.setPointVertices = function (verts)
{
    if (verts.length % 3 !== 0)
    {
        this._log.error("SetPointVertices: Array must be multiple of three.");
        return;
    }

    if (!(verts instanceof Float32Array)) this.vertices = new Float32Array(verts);
    else this.vertices = verts;

    if (!(this.texCoords instanceof Float32Array)) this.texCoords = new Float32Array((verts.length / 3) * 2);

    // this.texCoords.length=verts.length/3*2;
    this.verticesIndices.length = verts.length / 3;
    // this.verticesIndices=[];

    for (let i = 0; i < verts.length / 3; i++)
    {
        this.verticesIndices[i] = i;
        this.texCoords[i * 2] = 0;
        this.texCoords[i * 2 + 1] = 0;
    }
};

/**
 * merge a different geometry into the this geometry
 * @function merge
 * @param {Geometry} geom
 * @memberof Geometry
 * @instance
 */
Geometry.prototype.merge = function (geom)
{
    if (!geom) return;

    if (this.isIndexed() != geom.isIndexed())
    {
        if (this.isIndexed())
        {
            this.unIndex(false, true);
        }
        if (geom.isIndexed())
        {
            const g = geom.copy();
            g.unIndex(false, true);
            geom = g;
        }
    }

    const oldIndizesLength = this.verticesIndices.length;
    const vertLength = this._vertices.length / 3;

    this.verticesIndices.length += geom.verticesIndices.length;
    for (let i = 0; i < geom.verticesIndices.length; i++)
        this.verticesIndices[oldIndizesLength + i] = geom.verticesIndices[i] + vertLength;

    this.vertices = UTILS.float32Concat(this._vertices, geom.vertices);
    this.texCoords = UTILS.float32Concat(this.texCoords, geom.texCoords);
    this.vertexNormals = UTILS.float32Concat(this.vertexNormals, geom.vertexNormals);
    this.tangents = UTILS.float32Concat(this.tangents, geom.tangents);
    this.biTangents = UTILS.float32Concat(this.biTangents, geom.biTangents);
};

/**
 *   a copy of the geometry
 * @function copy
 * @memberof Geometry
 * @instance
 */
Geometry.prototype.copy = function ()
{
    const geom = new Geometry(this.name + " copy");
    geom.faceVertCount = this.faceVertCount;
    geom.glPrimitive = this.glPrimitive;

    geom.setVertices(this._vertices.slice(0));

    if (this.verticesIndices)
    {
        geom.verticesIndices.length = this.verticesIndices.length;
        for (let i = 0; i < this.verticesIndices.length; i++) geom.verticesIndices[i] = this.verticesIndices[i];
    }

    for (let i in this._attributes) this.copyAttribute(i, geom);

    geom.morphTargets.length = this.morphTargets.length;
    for (let i = 0; i < this.morphTargets.length; i++) geom.morphTargets[i] = this.morphTargets[i];

    return geom;
};

/**
 * Calculaten normals
 * @function calculateNormals
 * @memberof Geometry
 * @param options
 * @instance
 */
Geometry.prototype.calculateNormals = function (options)
{
    // todo: should check angle of normals to get edges    https://community.khronos.org/t/calculating-accurate-vertex-normals/28152
    options = options || {};
    if (options.smooth === false) this.unIndex();

    const u = vec3.create();
    const v = vec3.create();
    const n = vec3.create();

    function calcNormal(triangle)
    {
        vec3.subtract(u, triangle[0], triangle[1]);
        vec3.subtract(v, triangle[0], triangle[2]);
        vec3.cross(n, u, v);
        vec3.normalize(n, n);

        if (options && options.forceZUp)
        {
            if (n[2] < 0)
            {
                n[0] *= -1;
                n[1] *= -1;
                n[2] *= -1;
            }
        }
        return n;
    }

    this.getVertexVec = function (which)
    {
        const vec = [0, 0, 0];
        vec[0] = this.vertices[which * 3 + 0];
        vec[1] = this.vertices[which * 3 + 1];
        vec[2] = this.vertices[which * 3 + 2];
        return vec;
    };

    if (!(this.vertexNormals instanceof Float32Array) || this.vertexNormals.length != this.vertices.length) this.vertexNormals = new Float32Array(this.vertices.length);

    for (let i = 0; i < this.vertices.length; i++)
    {
        this.vertexNormals[i] = 0;
    }

    if (!this.isIndexed())
    {
        const norms = [];
        for (let i = 0; i < this.vertices.length; i += 9)
        {
            const triangle = [[this.vertices[i + 0], this.vertices[i + 1], this.vertices[i + 2]], [this.vertices[i + 3], this.vertices[i + 4], this.vertices[i + 5]], [this.vertices[i + 6], this.vertices[i + 7], this.vertices[i + 8]]];
            const nn = calcNormal(triangle);
            norms.push(nn[0], nn[1], nn[2], nn[0], nn[1], nn[2], nn[0], nn[1], nn[2]);
        }
        this.vertexNormals = norms;
    }
    else
    {
        const faceNormals = [];

        faceNormals.length = Math.floor(this.verticesIndices.length / 3);

        for (let i = 0; i < this.verticesIndices.length; i += 3)
        {
            const triangle = [this.getVertexVec(this.verticesIndices[i + 0]), this.getVertexVec(this.verticesIndices[i + 1]), this.getVertexVec(this.verticesIndices[i + 2])];

            faceNormals[i / 3] = calcNormal(triangle);

            this.vertexNormals[this.verticesIndices[i + 0] * 3 + 0] += faceNormals[i / 3][0];
            this.vertexNormals[this.verticesIndices[i + 0] * 3 + 1] += faceNormals[i / 3][1];
            this.vertexNormals[this.verticesIndices[i + 0] * 3 + 2] += faceNormals[i / 3][2];

            this.vertexNormals[this.verticesIndices[i + 1] * 3 + 0] += faceNormals[i / 3][0];
            this.vertexNormals[this.verticesIndices[i + 1] * 3 + 1] += faceNormals[i / 3][1];
            this.vertexNormals[this.verticesIndices[i + 1] * 3 + 2] += faceNormals[i / 3][2];

            this.vertexNormals[this.verticesIndices[i + 2] * 3 + 0] += faceNormals[i / 3][0];
            this.vertexNormals[this.verticesIndices[i + 2] * 3 + 1] += faceNormals[i / 3][1];
            this.vertexNormals[this.verticesIndices[i + 2] * 3 + 2] += faceNormals[i / 3][2];
        }


        for (let i = 0; i < this.verticesIndices.length; i += 3) // faces
        {
            for (let k = 0; k < 3; k++) // triangles
            {
                const vv = [this.vertexNormals[this.verticesIndices[i + k] * 3 + 0], this.vertexNormals[this.verticesIndices[i + k] * 3 + 1], this.vertexNormals[this.verticesIndices[i + k] * 3 + 2]];
                vec3.normalize(vv, vv);
                this.vertexNormals[this.verticesIndices[i + k] * 3 + 0] = vv[0];
                this.vertexNormals[this.verticesIndices[i + k] * 3 + 1] = vv[1];
                this.vertexNormals[this.verticesIndices[i + k] * 3 + 2] = vv[2];
            }
        }
    }
};

/**
 * Calculates tangents & bitangents with the help of uv-coordinates. Adapted from
 * Lengyel, Eric. Computing Tangent Space Basis Vectors for an Arbitrary Mesh.
 * Terathon Software 3D Graphics Library.
 * https://fenix.tecnico.ulisboa.pt/downloadFile/845043405449073/Tangent%20Space%20Calculation.pdf
 *
 * @function calcTangentsBitangents
 * @memberof Geometry
 * @instance
 */
Geometry.prototype.calcTangentsBitangents = function ()
{
    if (!this.vertices.length)
    {
        // this._log.error("Cannot calculate tangents/bitangents without vertices.");
        return;
    }
    if (!this.vertexNormals.length)
    {
        // this._log.error("Cannot calculate tangents/bitangents without normals.");
        return;
    }
    if (!this.texCoords.length)
    {
        // console.warn("No texcoords. Replacing with default values [0, 0].");
        const texCoordLength = (this.vertices.length / 3) * 2;
        this.texCoords = new Float32Array(texCoordLength);
        for (let i = 0; i < texCoordLength; i += 1) this.texCoords[i] = 0;
    }
    if (!this.verticesIndices || !this.verticesIndices.length)
    {
        // this._log.error("Cannot calculate tangents/bitangents without vertex indices.");
        return;
    }
    // this code assumes that we have three indices per triangle
    if (this.verticesIndices.length % 3 !== 0)
    {
        this._log.error("Vertex indices mismatch!");
        return;
    }

    const triangleCount = this.verticesIndices.length / 3;
    const vertexCount = this.vertices.length / 3;

    this.tangents = new Float32Array(this.vertexNormals.length);
    this.biTangents = new Float32Array(this.vertexNormals.length);

    // temporary buffers
    const tempVertices = [];
    tempVertices.length = vertexCount * 2;
    const v1 = vec3.create();
    const v2 = vec3.create();
    const v3 = vec3.create();

    const w1 = vec2.create();
    const w2 = vec2.create();
    const w3 = vec2.create();

    const sdir = vec3.create();
    const tdir = vec3.create();

    // for details on calculation, see article referenced above
    for (let tri = 0; tri < triangleCount; tri += 1)
    {
        // indices of the three vertices for a triangle
        const i1 = this.verticesIndices[tri * 3];
        const i2 = this.verticesIndices[tri * 3 + 1];
        const i3 = this.verticesIndices[tri * 3 + 2];

        // vertex position as vec3
        vec3.set(v1, this.vertices[i1 * 3], this.vertices[i1 * 3 + 1], this.vertices[i1 * 3 + 2]);
        vec3.set(v2, this.vertices[i2 * 3], this.vertices[i2 * 3 + 1], this.vertices[i2 * 3 + 2]);
        vec3.set(v3, this.vertices[i3 * 3], this.vertices[i3 * 3 + 1], this.vertices[i3 * 3 + 2]);

        // texture coordinate as vec2
        vec2.set(w1, this.texCoords[i1 * 2], this.texCoords[i1 * 2 + 1]);
        vec2.set(w2, this.texCoords[i2 * 2], this.texCoords[i2 * 2 + 1]);
        vec2.set(w3, this.texCoords[i3 * 2], this.texCoords[i3 * 2 + 1]);

        const x1 = v2[0] - v1[0];
        const x2 = v3[0] - v1[0];
        const y1 = v2[1] - v1[1];
        const y2 = v3[1] - v1[1];
        const z1 = v2[2] - v1[2];
        const z2 = v3[2] - v1[2];

        const s1 = w2[0] - w1[0];
        const s2 = w3[0] - w1[0];
        const t1 = w2[1] - w1[1];
        const t2 = w3[1] - w1[1];

        const r = 1.0 / (s1 * t2 - s2 * t1);

        vec3.set(sdir, (t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);
        vec3.set(tdir, (s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);

        tempVertices[i1] = sdir;
        tempVertices[i2] = sdir;
        tempVertices[i3] = sdir;

        tempVertices[i1 + vertexCount] = tdir;
        tempVertices[i2 + vertexCount] = tdir;
        tempVertices[i3 + vertexCount] = tdir;
    }

    const normal = vec3.create();
    const tempVert = vec3.create();
    const tan = vec3.create();
    const bitan = vec3.create();
    const temp1 = vec3.create();
    const temp2 = vec3.create();
    const crossPd = vec3.create();
    const normalized = vec3.create();

    for (let vert = 0; vert < vertexCount; vert += 1)
    {
        // NOTE: some meshes don't have index 0 - n in their indexbuffer, if this is the case, skip calculation of this vertex
        if (!tempVertices[vert]) continue;

        vec3.set(normal, this.vertexNormals[vert * 3], this.vertexNormals[vert * 3 + 1], this.vertexNormals[vert * 3 + 2]);
        vec3.set(tempVert, tempVertices[vert][0], tempVertices[vert][1], tempVertices[vert][2]);

        // Gram-Schmidt orthagonalize
        const _dp = vec3.dot(normal, tempVert);
        vec3.scale(temp1, normal, _dp);
        vec3.subtract(temp2, tempVert, temp1);

        vec3.normalize(normalized, temp2);
        vec3.cross(crossPd, normal, tempVert);

        // const intermDot = vec3.dot(crossPd, tempVertices[vert + vertexCount]);
        const w = 1.0;// intermDot < 0.0 ? -1.0 : 1.0;

        vec3.scale(tan, normalized, 1 / w);
        vec3.cross(bitan, normal, tan);

        this.tangents[vert * 3 + 0] = tan[0];
        this.tangents[vert * 3 + 1] = tan[1];
        this.tangents[vert * 3 + 2] = tan[2];
        this.biTangents[vert * 3 + 0] = bitan[0];
        this.biTangents[vert * 3 + 1] = bitan[1];
        this.biTangents[vert * 3 + 2] = bitan[2];
    }
};

Geometry.prototype.isIndexed = function ()
{
    if (this._vertices.length == 0) return true;
    return this.verticesIndices.length != 0;
};

/**
 * @function unIndex
 * @memberof Geometry
 * @instance
 * @description remove all vertex indizes, vertices array will contain 3*XYZ for every triangle
 * @param {boolean} reIndex
 * @param {boolean} dontCalcNormals
 */
Geometry.prototype.unIndex = function (reIndex, dontCalcNormals)
{
    const newVerts = [];
    const newIndizes = [];
    let count = 0;

    for (let j in this._attributes)
    {
        const attr = this._attributes[j];
        let na = [];

        for (let i = 0; i < this.verticesIndices.length; i += 3)
        {
            for (let s = 0; s < 3; s++)
            {
                if (attr.itemSize == 3)
                    na.push(
                        attr.data[this.verticesIndices[i + s] * 3 + 0],
                        attr.data[this.verticesIndices[i + s] * 3 + 1],
                        attr.data[this.verticesIndices[i + s] * 3 + 2]);
                else if (attr.itemSize == 4)
                    na.push(
                        attr.data[this.verticesIndices[i + s] * 4 + 0],
                        attr.data[this.verticesIndices[i + s] * 4 + 1],
                        attr.data[this.verticesIndices[i + s] * 4 + 2],
                        attr.data[this.verticesIndices[i + s] * 4 + 3]);
                else if (attr.itemSize == 2)
                    na.push(
                        attr.data[this.verticesIndices[i + s] * 2 + 0],
                        attr.data[this.verticesIndices[i + s] * 2 + 1]);
                else if (attr.itemSize == 1)
                    na.push(
                        attr.data[this.verticesIndices[i + s]]);
                else console.log("unknown attr", attr);
            }
        }
        this.setAttribute(attr.name, na, attr.itemSize);
    }

    for (let i = 0; i < this.verticesIndices.length; i += 3)
    {
        newVerts.push(
            this.vertices[this.verticesIndices[i + 0] * 3 + 0],
            this.vertices[this.verticesIndices[i + 0] * 3 + 1],
            this.vertices[this.verticesIndices[i + 0] * 3 + 2]);

        newIndizes.push(count);
        count++;

        newVerts.push(
            this.vertices[this.verticesIndices[i + 1] * 3 + 0],
            this.vertices[this.verticesIndices[i + 1] * 3 + 1],
            this.vertices[this.verticesIndices[i + 1] * 3 + 2]);

        newIndizes.push(count);
        count++;

        newVerts.push(
            this.vertices[this.verticesIndices[i + 2] * 3 + 0],
            this.vertices[this.verticesIndices[i + 2] * 3 + 1],
            this.vertices[this.verticesIndices[i + 2] * 3 + 2]);

        newIndizes.push(count);
        count++;
    }

    this.vertices = newVerts;

    this.verticesIndices = [];
    if (reIndex) this.verticesIndices = newIndizes;

    if (!dontCalcNormals) this.calculateNormals();
};

Geometry.prototype.calcBarycentric = function ()
{
    let barycentrics = [];
    barycentrics.length = this.vertices.length;
    for (let i = 0; i < this.vertices.length; i++) barycentrics[i] = 0;

    let count = 0;
    for (let i = 0; i < this.vertices.length; i += 3)
    {
        barycentrics[i + count] = 1;
        count++;
        if (count == 3) count = 0;
    }

    this.setAttribute("attrBarycentric", barycentrics, 3);
};

Geometry.prototype.getBounds = function ()
{
    return new BoundingBox(this);
};

Geometry.prototype.center = function (x, y, z)
{
    if (x === undefined)
    {
        x = true;
        y = true;
        z = true;
    }

    let i = 0;
    const bounds = this.getBounds();
    const offset = [bounds.minX + (bounds.maxX - bounds.minX) / 2, bounds.minY + (bounds.maxY - bounds.minY) / 2, bounds.minZ + (bounds.maxZ - bounds.minZ) / 2];

    for (i = 0; i < this.vertices.length; i += 3)
    {
        if (this.vertices[i + 0] == this.vertices[i + 0])
        {
            if (x) this.vertices[i + 0] -= offset[0];
            if (y) this.vertices[i + 1] -= offset[1];
            if (z) this.vertices[i + 2] -= offset[2];
        }
    }

    return offset;
};

Geometry.prototype.mapTexCoords2d = function ()
{
    const bounds = this.getBounds();
    const num = this.vertices.length / 3;

    this.texCoords = new Float32Array(num * 2);

    for (let i = 0; i < num; i++)
    {
        const vertX = this.vertices[i * 3 + 0];
        const vertY = this.vertices[i * 3 + 1];
        this.texCoords[i * 2 + 0] = vertX / (bounds.maxX - bounds.minX) + 0.5;
        this.texCoords[i * 2 + 1] = 1.0 - vertY / (bounds.maxY - bounds.minY) + 0.5;
    }
};


Geometry.prototype.getInfoOneLine = function ()
{
    let txt = "";
    if (this.faceVertCount == 3 && this.verticesIndices)txt += this.verticesIndices.length / 3;
    else txt += 0;

    txt += " tris ";

    if (this.vertices)txt += this.vertices.length / 3;
    else txt += 0;

    txt += " verts";

    return txt;
};

Geometry.prototype.getInfo = function ()
{
    const info = {};

    if (this.faceVertCount == 3 && this.verticesIndices)info.numFaces = this.verticesIndices.length / 3;
    else info.numFaces = 0;

    if (this.verticesIndices && this.verticesIndices.length)info.indices = this.verticesIndices.length;

    if (this.vertices)info.numVerts = this.vertices.length / 3;
    else info.numVerts = 0;

    if (this.vertexNormals) info.numNormals = this.vertexNormals.length / 3;
    else info.numNormals = 0;

    if (this.texCoords) info.numTexCoords = this.texCoords.length / 2;
    else info.numTexCoords = 0;

    if (this.tangents) info.numTangents = this.tangents.length / 3;
    else info.numTangents = 0;

    if (this.biTangents) info.numBiTangents = this.biTangents.length / 3;
    else info.numBiTangents = 0;

    if (this.biTangents) info.numBiTangents = this.biTangents.length / 3;
    else info.numBiTangents = 0;

    if (this.vertexColors) info.numVertexColors = this.vertexColors.length / 4;
    else info.numVertexColors = 0;

    if (this.getAttributes()) info.numAttribs = Object.keys(this.getAttributes()).length;
    else info.numAttribs = 0;

    info.isIndexed = this.isIndexed();

    return info;
};

// -----------------

// TODO : rewritwe circle op
Geometry.buildFromFaces = function (arr, name, optimize)
{
    const vertices = [];
    const verticesIndices = [];

    for (let i = 0; i < arr.length; i += 3)
    {
        const a = arr[i + 0];
        const b = arr[i + 1];
        const c = arr[i + 2];
        const face = [-1, -1, -1];

        if (optimize)
            for (let iv = 0; iv < vertices.length; iv += 3)
            {
                if (vertices[iv + 0] == a[0] && vertices[iv + 1] == a[1] && vertices[iv + 2] == a[2]) face[0] = iv / 3;
                if (vertices[iv + 0] == b[0] && vertices[iv + 1] == b[1] && vertices[iv + 2] == b[2]) face[1] = iv / 3;
                if (vertices[iv + 0] == c[0] && vertices[iv + 1] == c[1] && vertices[iv + 2] == c[2]) face[2] = iv / 3;
            }

        if (face[0] == -1)
        {
            vertices.push(a[0], a[1], a[2]);
            face[0] = (vertices.length - 1) / 3;
        }

        if (face[1] == -1)
        {
            vertices.push(b[0], b[1], b[2]);
            face[1] = (vertices.length - 1) / 3;
        }

        if (face[2] == -1)
        {
            vertices.push(c[0], c[1], c[2]);
            face[2] = (vertices.length - 1) / 3;
        }

        verticesIndices.push(parseInt(face[0], 10));
        verticesIndices.push(parseInt(face[1], 10));
        verticesIndices.push(parseInt(face[2], 10));
    }

    const geom = new Geometry(name);
    geom.name = name;
    geom.vertices = vertices;
    geom.verticesIndices = verticesIndices;

    return geom;
};




;// CONCATENATED MODULE: ./src/core/cgl/cgl_mesh.js




const MESH = {};
MESH.lastMesh = null;

/**
 * webgl renderable 3d object
 * @class
 * @namespace external:CGL
 * @hideconstructor
 * @param {Context} _cgl cgl
 * @param {Geometry} __geom geometry
 * @param {Number} _options glPrimitive
 * @example
 * const cgl=this._cgl
 * const mesh=new CGL.Mesh(cgl, geometry);
 *
 * function render()
 * {
 *   mesh.render(cgl.getShader());
 * }
 */
const Mesh = function (_cgl, __geom, _options)
{
    this._cgl = _cgl;

    let options = _options || {};
    if (CABLES.UTILS.isNumeric(options))options = { "glPrimitive": _options }; // old constructor fallback...
    this._log = new Logger("cgl_mesh");
    this._bufVertexAttrib = null;
    this._bufVerticesIndizes = this._cgl.gl.createBuffer();
    this._indexType = this._cgl.gl.UNSIGNED_SHORT;
    this._attributes = [];
    this._attribLocs = {};
    this._geom = null;
    this._lastShader = null;
    this._numInstances = 0;
    this._glPrimitive = options.glPrimitive;

    this.opId = options.opId || "";
    this._preWireframeGeom = null;
    this.addVertexNumbers = false;
    this._name = "unknown";

    this.feedBackAttributes = [];
    this.setGeom(__geom);

    this._feedBacks = [];
    this._feedBacksChanged = false;
    this._transformFeedBackLoc = -1;
    this._lastAttrUpdate = 0;

    this.memFreed = false;

    this._cgl.profileData.addHeavyEvent("mesh constructed", this._name);

    this._queryExt = null;

    Object.defineProperty(this, "numInstances", {
        get()
        {
            return this._numInstances;
        },
        set(v)
        {
            this.setNumInstances(v);
        },
    });
};

Mesh.prototype.freeMem = function ()
{
    this.memFreed = true;

    for (let i = 0; i < this._attributes.length; i++)
    {
        this._attributes[i].floatArray = null;
    }
};

/**
 * @function updateVertices
 * @memberof Mesh
 * @instance
 * @description update vertices only from a geometry
 * @param {Geometry} geom
 */
Mesh.prototype.updateVertices = function (geom)
{
    this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_POSITION, geom.vertices, 3);
    this._numVerts = geom.vertices.length / 3;
};

Mesh.prototype.setAttributePointer = function (attrName, name, stride, offset)
{
    for (let i = 0; i < this._attributes.length; i++)
    {
        if (this._attributes[i].name == attrName)
        {
            if (!this._attributes[i].pointer) this._attributes[i].pointer = [];

            this._attributes[i].pointer.push(
                {
                    "loc": -1,
                    "name": name,
                    "stride": stride,
                    "offset": offset,
                    "instanced": attrName == constants_CONSTANTS.SHADER.SHADERVAR_INSTANCE_MMATRIX,
                }
            );
        }
    }
};

Mesh.prototype.getAttribute = function (name)
{
    for (let i = 0; i < this._attributes.length; i++) if (this._attributes[i].name == name) return this._attributes[i];
};

Mesh.prototype.setAttributeRange = function (attr, array, start, end)
{
    if (!attr) return;
    if (!start && !end) return;

    if (!attr.name)
    {
        this._log.stack("no attrname?!");
    }

    this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER, attr.buffer);
    this._cgl.profileData.profileMeshAttributes += (end - start) || 0;

    this._cgl.profileData.profileSingleMeshAttribute[this._name] = this._cgl.profileData.profileSingleMeshAttribute[this._name] || 0;
    this._cgl.profileData.profileSingleMeshAttribute[this._name] += (end - start) || 0;

    if (attr.numItems < array.length / attr.itemSize)
    {
        this._resizeAttr(array, attr);
    }

    if (end > array.length)
    {
        if (CABLES.platform.isDevEnv())
            this._log.log(this._cgl.canvas.id + " " + attr.name + " buffersubdata out of bounds ?", array.length, end, start, attr);
        // end = array.length - 1;
        return;
    }

    if (this._cgl.glVersion == 1) this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER, 0, array); // probably slow/ maybe create and array with only changed size ??
    else this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER, start * 4, array, start, (end - start));
};

Mesh.prototype._resizeAttr = function (array, attr)
{
    if (attr.buffer)
        this._cgl.gl.deleteBuffer(attr.buffer);

    attr.buffer = this._cgl.gl.createBuffer();
    this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER, attr.buffer);
    this._bufferArray(array, attr);
    attr.numItems = array.length / attr.itemSize;// numItems;
};


Mesh.prototype._bufferArray = function (array, attr)
{
    let floatArray = attr.floatArray || null;
    if (!array) return;


    if (this._cgl.debugOneFrame)
    {
        console.log("_bufferArray", array.length, attr.name); // eslint-disable-line
    }

    if (!(array instanceof Float32Array))
    {
        if (attr && floatArray && floatArray.length == array.length)
        {
            floatArray.set(array);
            // floatArray = floatArray;
        }
        else
        {
            floatArray = new Float32Array(array);

            if (this._cgl.debugOneFrame)
            {
                console.log("_bufferArray create new float32array", array.length, attr.name); // eslint-disable-line
            }

            if (array.length > 10000)
            {
                this._cgl.profileData.profileNonTypedAttrib++;
                this._cgl.profileData.profileNonTypedAttribNames = "(" + this._name + ":" + attr.name + ")";
            }
        }
    }
    else floatArray = array;

    attr.arrayLength = floatArray.length;
    attr.floatArray = null;// floatArray;

    this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER, floatArray, this._cgl.gl.DYNAMIC_DRAW);
};

/**
 * @function setAttribute
 * @description update attribute
 * @memberof Mesh
 * @instance
 * @param {String} attribute name
 * @param {Array} data
 * @param {Number} itemSize
 * @param {Object} options
 */
Mesh.prototype.addAttribute = Mesh.prototype.updateAttribute = Mesh.prototype.setAttribute = function (name, array, itemSize, options)
{
    if (!array)
    {
        this._log.error("mesh addAttribute - no array given! " + name);
        throw new Error();
    }
    let cb = null;
    let instanced = false;
    let i = 0;
    const numItems = array.length / itemSize;

    this._cgl.profileData.profileMeshAttributes += numItems || 0;

    if (typeof options == "function")
    {
        cb = options;
    }

    if (typeof options == "object")
    {
        if (options.cb) cb = options.cb;
        if (options.instanced) instanced = options.instanced;
    }

    if (name == constants_CONSTANTS.SHADER.SHADERVAR_INSTANCE_MMATRIX) instanced = true;


    for (i = 0; i < this._attributes.length; i++)
    {
        const attr = this._attributes[i];
        if (attr.name == name)
        {
            if (attr.numItems === numItems)
            {
            }
            else
            {
                // this._log.log("wrong buffer size", this._geom.name, attr.name, attr.numItems, numItems);
                this._resizeAttr(array, attr);
            }

            this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER, attr.buffer);
            this._bufferArray(array, attr);

            return attr;
        }
    }

    // create new buffer...

    const buffer = this._cgl.gl.createBuffer();

    this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER, buffer);
    // this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER, floatArray, this._cgl.gl.DYNAMIC_DRAW);

    let type = this._cgl.gl.FLOAT;
    if (options && options.type) type = options.type;
    const attr = {
        "buffer": buffer,
        "name": name,
        "cb": cb,
        "itemSize": itemSize,
        "numItems": numItems,
        "startItem": 0,
        "instanced": instanced,
        "type": type
    };

    this._bufferArray(array, attr);

    if (name == constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_POSITION) this._bufVertexAttrib = attr;
    this._attributes.push(attr);
    this._attribLocs = {};

    return attr;
};

Mesh.prototype.getAttributes = function ()
{
    return this._attributes;
};

/**
 * @function updateTexCoords
 * @description update texture coordinates only from a geometry
 * @memberof Mesh
 * @instance
 * @param {Geometry} geom
 */
Mesh.prototype.updateTexCoords = function (geom)
{
    if (geom.texCoords && geom.texCoords.length > 0)
    {
        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_TEXCOORD, geom.texCoords, 2);
    }
    else
    {
        const tcBuff = new Float32Array(Math.round((geom.vertices.length / 3) * 2));
        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_TEXCOORD, tcBuff, 2);
    }
};


/**
 * @function updateNormals
 * @description update normals only from a geometry
 * @memberof Mesh
 * @instance
 * @param {Geometry} geom
 */
Mesh.prototype.updateNormals = function (geom)
{
    if (geom.vertexNormals && geom.vertexNormals.length > 0)
    {
        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_NORMAL, geom.vertexNormals, 3);
    }
    else
    {
        const tcBuff = new Float32Array(Math.round((geom.vertices.length)));
        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_NORMAL, tcBuff, 3);
    }
};


Mesh.prototype._setVertexNumbers = function (arr)
{
    if (!this._verticesNumbers || this._verticesNumbers.length != this._numVerts || arr)
    {
        if (arr) this._verticesNumbers = arr;
        else
        {
            this._verticesNumbers = new Float32Array(this._numVerts);
            for (let i = 0; i < this._numVerts; i++) this._verticesNumbers[i] = i;
        }

        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_NUMBER, this._verticesNumbers, 1, (attr, geom, shader) =>
        {
            if (!shader.uniformNumVertices) shader.uniformNumVertices = new Uniform(shader, "f", "numVertices", this._numVerts);
            shader.uniformNumVertices.setValue(this._numVerts);

            // console.log("this._numVerts", this._numVerts, attr, shader.uniformNumVertices);
        });
    }
};

/**
 * @function setVertexIndices
 * @description update vertex indices / faces
 * @memberof Mesh
 * @instance
 * @param {array} vertIndices
 */
Mesh.prototype.setVertexIndices = function (vertIndices)
{
    if (!this._bufVerticesIndizes)
    {
        this._log.warn("no bufVerticesIndizes: " + this._name);
        return;
    }
    if (vertIndices.length > 0)
    {
        if (vertIndices instanceof Float32Array) this._log.warn("vertIndices float32Array: " + this._name);

        for (let i = 0; i < vertIndices.length; i++)
        {
            if (vertIndices[i] >= this._numVerts)
            {
                this._log.warn("invalid index in " + this._name, i, vertIndices[i]);
                return;
            }
        }

        this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER, this._bufVerticesIndizes);

        // todo cache this ?
        // if(!this.vertIndicesTyped || this.vertIndicesTyped.length!=this._geom.verticesIndices.length)

        if (vertIndices.length > 65535)
        {
            this.vertIndicesTyped = new Uint32Array(vertIndices);
            this._indexType = this._cgl.gl.UNSIGNED_INT;
        }
        else
        if (vertIndices instanceof Uint32Array)
        {
            this.vertIndicesTyped = vertIndices;
            this._indexType = this._cgl.gl.UNSIGNED_INT;
        }
        else
        if (!(vertIndices instanceof Uint16Array))
        {
            this.vertIndicesTyped = new Uint16Array(vertIndices);
            this._indexType = this._cgl.gl.UNSIGNED_SHORT;
        }
        else this.vertIndicesTyped = vertIndices;

        this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER, this.vertIndicesTyped, this._cgl.gl.DYNAMIC_DRAW);
        this._bufVerticesIndizes.itemSize = 1;
        this._bufVerticesIndizes.numItems = vertIndices.length;
    }
    else this._bufVerticesIndizes.numItems = 0;
};

/**
 * @function setGeom
 * @memberof Mesh
 * @instance
 * @description set geometry for mesh
 * @param {Geometry} geom
 * @param {boolean} removeRef
 */
Mesh.prototype.setGeom = function (geom, removeRef)
{
    this._geom = geom;
    if (geom.glPrimitive != null) this._glPrimitive = geom.glPrimitive;
    if (this._geom && this._geom.name) this._name = "mesh " + this._geom.name;

    MESH.lastMesh = null;
    this._cgl.profileData.profileMeshSetGeom++;

    this._disposeAttributes();

    this.updateVertices(this._geom);
    this.setVertexIndices(this._geom.verticesIndices);

    if (this.addVertexNumbers) this._setVertexNumbers();

    const geomAttribs = this._geom.getAttributes();

    const attribAssoc = {
        "texCoords": constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_TEXCOORD,
        "vertexNormals": constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_NORMAL,
        "vertexColors": constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_COLOR,
        "tangents": "attrTangent",
        "biTangents": "attrBiTangent",
    };

    for (const index in geomAttribs)
        if (geomAttribs[index].data && geomAttribs[index].data.length)
            this.setAttribute(attribAssoc[index] || index, geomAttribs[index].data, geomAttribs[index].itemSize);


    if (removeRef)
    {
        this._geom = null;
    }
};

Mesh.prototype._preBind = function (shader)
{
    for (let i = 0; i < this._attributes.length; i++)
        if (this._attributes[i].cb)
            this._attributes[i].cb(this._attributes[i], this._geom, shader);
};

Mesh.prototype._checkAttrLengths = function ()
{
    if (this.memFreed) return;
    // check length
    for (let i = 0; i < this._attributes.length; i++)
    {
        if (this._attributes[i].arrayLength / this._attributes[i].itemSize < this._attributes[0].arrayLength / this._attributes[0].itemSize)
        {
            let name = "unknown";
            if (this._geom)name = this._geom.name;
            // this._log.warn(
            //     name + ": " + this._attributes[i].name +
            //     " wrong attr length. is:", this._attributes[i].arrayLength / this._attributes[i].itemSize,
            //     " should be:", this._attributes[0].arrayLength / this._attributes[0].itemSize,
            // );
        }
    }
};

Mesh.prototype._bind = function (shader)
{
    if (!shader.isValid()) return;

    let attrLocs = [];
    if (this._attribLocs[shader.id]) attrLocs = this._attribLocs[shader.id];
    else this._attribLocs[shader.id] = attrLocs;

    this._lastShader = shader;
    if (shader.lastCompile > this._lastAttrUpdate || attrLocs.length != this._attributes.length)
    {
        this._lastAttrUpdate = shader.lastCompile;
        for (let i = 0; i < this._attributes.length; i++) attrLocs[i] = -1;
    }

    for (let i = 0; i < this._attributes.length; i++)
    {
        const attribute = this._attributes[i];
        if (attrLocs[i] == -1)
        {
            if (attribute._attrLocationLastShaderTime != shader.lastCompile)
            {
                attribute._attrLocationLastShaderTime = shader.lastCompile;
                attrLocs[i] = this._cgl.glGetAttribLocation(shader.getProgram(), attribute.name);
                // this._log.log('attribloc',attribute.name,attrLocs[i]);
                this._cgl.profileData.profileAttrLoc++;
            }
        }

        if (attrLocs[i] != -1)
        {
            this._cgl.gl.enableVertexAttribArray(attrLocs[i]);
            this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER, attribute.buffer);

            if (attribute.instanced)
            {
                // todo: easier way to fill mat4 attribs...
                if (attribute.itemSize <= 4)
                {
                    if (!attribute.itemSize || attribute.itemSize == 0) this._log.warn("instanced attrib itemsize error", this._geom.name, attribute);

                    this._cgl.gl.vertexAttribPointer(attrLocs[i], attribute.itemSize, attribute.type, false, attribute.itemSize * 4, 0);
                    this._cgl.gl.vertexAttribDivisor(attrLocs[i], 1);
                }
                else if (attribute.itemSize == 16)
                {
                    const stride = 16 * 4;

                    this._cgl.gl.vertexAttribPointer(attrLocs[i], 4, attribute.type, false, stride, 0);
                    this._cgl.gl.enableVertexAttribArray(attrLocs[i] + 1);
                    this._cgl.gl.vertexAttribPointer(attrLocs[i] + 1, 4, attribute.type, false, stride, 4 * 4 * 1);
                    this._cgl.gl.enableVertexAttribArray(attrLocs[i] + 2);
                    this._cgl.gl.vertexAttribPointer(attrLocs[i] + 2, 4, attribute.type, false, stride, 4 * 4 * 2);
                    this._cgl.gl.enableVertexAttribArray(attrLocs[i] + 3);
                    this._cgl.gl.vertexAttribPointer(attrLocs[i] + 3, 4, attribute.type, false, stride, 4 * 4 * 3);

                    this._cgl.gl.vertexAttribDivisor(attrLocs[i], 1);
                    this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 1, 1);
                    this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 2, 1);
                    this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 3, 1);
                }
                else
                {
                    this._log.warn("unknown instance attrib size", attribute.name);
                }
            }
            else
            {
                if (!attribute.itemSize || attribute.itemSize == 0) this._log.warn("attrib itemsize error", this._name, attribute);
                this._cgl.gl.vertexAttribPointer(attrLocs[i], attribute.itemSize, attribute.type, false, attribute.itemSize * 4, 0);

                if (attribute.pointer)
                {
                    for (let ip = 0; ip < attribute.pointer.length; ip++)
                    {
                        const pointer = attribute.pointer[ip];

                        if (pointer.loc == -1)
                            pointer.loc = this._cgl.glGetAttribLocation(shader.getProgram(), pointer.name);

                        this._cgl.profileData.profileAttrLoc++;

                        this._cgl.gl.enableVertexAttribArray(pointer.loc);
                        this._cgl.gl.vertexAttribPointer(pointer.loc, attribute.itemSize, attribute.type, false, pointer.stride, pointer.offset);
                    }
                }
                if (this.bindFeedback) this.bindFeedback(attribute);
            }
        }
    }

    if (this._bufVerticesIndizes && this._bufVerticesIndizes.numItems !== 0) this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER, this._bufVerticesIndizes);
};

Mesh.prototype.unBind = function ()
{
    const shader = this._lastShader;
    this._lastShader = null;
    if (!shader) return;

    let attrLocs = [];
    if (this._attribLocs[shader.id]) attrLocs = this._attribLocs[shader.id];
    else this._attribLocs[shader.id] = attrLocs;

    MESH.lastMesh = null;

    for (let i = 0; i < this._attributes.length; i++)
    {
        if (this._attributes[i].instanced)
        {
            // todo: easier way to fill mat4 attribs...
            if (this._attributes[i].itemSize <= 4)
            {
                if (attrLocs[i] != -1) this._cgl.gl.vertexAttribDivisor(attrLocs[i], 0);
                if (attrLocs[i] >= 0) this._cgl.gl.disableVertexAttribArray(attrLocs[i]);
            }
            else
            {
                this._cgl.gl.vertexAttribDivisor(attrLocs[i], 0);
                this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 1, 0);
                this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 2, 0);
                this._cgl.gl.vertexAttribDivisor(attrLocs[i] + 3, 0);
                this._cgl.gl.disableVertexAttribArray(attrLocs[i] + 1);
                this._cgl.gl.disableVertexAttribArray(attrLocs[i] + 2);
                this._cgl.gl.disableVertexAttribArray(attrLocs[i] + 3);
            }
        }

        if (attrLocs[i] != -1) this._cgl.gl.disableVertexAttribArray(attrLocs[i]);
    }
};

Mesh.prototype.meshChanged = function ()
{
    return this._cgl.lastMesh && this._cgl.lastMesh != this;
};

Mesh.prototype.printDebug = function (shader)
{
    console.log("--attributes");
    for (let i = 0; i < this._attributes.length; i++)
    {
        console.log("attribute " + i + " " + this._attributes[i].name);
    }
};

Mesh.prototype.setNumVertices = function (num)
{
    this._bufVertexAttrib.numItems = num;
};

Mesh.prototype.getNumVertices = function ()
{
    return this._bufVertexAttrib.numItems;
};


/**
 * @function render
 * @memberof Mesh
 * @instance
 * @description draw mesh to screen
 * @param {Shader} shader
 */
Mesh.prototype.render = function (shader)
{
    // TODO: enable/disablevertex only if the mesh has changed... think drawing 10000x the same mesh

    if (!shader || !shader.isValid() || this._cgl.aborted) return;

    this._checkAttrLengths();

    if (this._geom)
    {
        if (this._preWireframeGeom && !shader.wireframe && !this._geom.isIndexed())
        {
            this.setGeom(this._preWireframeGeom);
            this._preWireframeGeom = null;
            // console.log("remove prewireframe geom");
        }

        if (shader.wireframe)
        {
            let changed = false;

            if (this._geom.isIndexed())
            {
                if (!this._preWireframeGeom)
                {
                    this._preWireframeGeom = this._geom;
                    this._geom = this._geom.copy();
                }

                this._geom.unIndex();
                changed = true;
            }

            if (!this._geom.getAttribute("attrBarycentric"))
            {
                if (!this._preWireframeGeom)
                {
                    this._preWireframeGeom = this._geom;
                    this._geom = this._geom.copy();
                }
                changed = true;

                this._geom.calcBarycentric();
            }
            if (changed) this.setGeom(this._geom);
        }
        // if (shader.wireframe)
        // console.log(shader.wireframe, this._geom.isIndexed());
    }

    let needsBind = false;
    if (MESH.lastMesh != this)
    {
        if (MESH.lastMesh) MESH.lastMesh.unBind();
        needsBind = true;
    }


    // var needsBind=false;
    // {
    //     needsBind=true;
    // }
    if (needsBind) this._preBind(shader);

    if (!shader.bind()) return;

    // if(needsBind)
    this._bind(shader);
    if (this.addVertexNumbers) this._setVertexNumbers();

    MESH.lastMesh = this;

    let prim = this._cgl.gl.TRIANGLES;
    if (this._glPrimitive !== undefined) prim = this._glPrimitive;
    if (shader.glPrimitive !== null) prim = shader.glPrimitive;

    let elementDiv = 1;
    let doQuery = this._cgl.profileData.doProfileGlQuery;
    let queryStarted = false;
    if (doQuery)
    {
        let id = this._name + " - " + shader.getName() + " #" + shader.id;
        if (this._numInstances) id += " instanced " + this._numInstances + "x";

        let queryProfilerData = this._cgl.profileData.glQueryData[id];

        if (!queryProfilerData) queryProfilerData = { "id": id, "num": 0 };

        if (shader.opId)queryProfilerData.shaderOp = shader.opId;
        if (this.opId)queryProfilerData.meshOp = this.opId;

        this._cgl.profileData.glQueryData[id] = queryProfilerData;

        if (!this._queryExt && this._queryExt !== false) this._queryExt = this._cgl.enableExtension("EXT_disjoint_timer_query_webgl2") || false;
        if (this._queryExt)
        {
            if (queryProfilerData._drawQuery)
            {
                const available = this._cgl.gl.getQueryParameter(queryProfilerData._drawQuery, this._cgl.gl.QUERY_RESULT_AVAILABLE);
                if (available)
                {
                    const elapsedNanos = this._cgl.gl.getQueryParameter(queryProfilerData._drawQuery, this._cgl.gl.QUERY_RESULT);
                    const currentTimeGPU = elapsedNanos / 1000000;

                    queryProfilerData._times = queryProfilerData._times || 0;
                    queryProfilerData._times += currentTimeGPU;
                    queryProfilerData._numcount++;
                    queryProfilerData.when = performance.now();
                    queryProfilerData._drawQuery = null;
                    queryProfilerData.queryStarted = false;
                }
            }

            if (!queryProfilerData.queryStarted)
            {
                queryProfilerData._drawQuery = this._cgl.gl.createQuery();
                this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT, queryProfilerData._drawQuery);
                queryStarted = queryProfilerData.queryStarted = true;
            }
        }
    }


    if (this.hasFeedbacks && this.hasFeedbacks()) this.drawFeedbacks(shader, prim);
    else if (!this._bufVerticesIndizes || this._bufVerticesIndizes.numItems === 0)
    {
        // for (let i = 0; i < this._attributes.length; i++)
        // {
        //     if (this._attributes[i].arrayLength / this._attributes[i].itemSize != this._bufVertexAttrib.floatArray.length / 3)
        //     {
        //         this._log.warn("attrib buffer length wrong! ", this._attributes[i].name, this._attributes[i].arrayLength / this._attributes[i].itemSize, this._bufVertexAttrib.floatArray.length / 3, this._attributes[i].itemSize);
        //         // this._log.log(this);
        //         // debugger;
        //         return;
        //     }
        // }


        if (prim == this._cgl.gl.TRIANGLES)elementDiv = 3;
        if (this._numInstances === 0) this._cgl.gl.drawArrays(prim, this._bufVertexAttrib.startItem, this._bufVertexAttrib.numItems - this._bufVertexAttrib.startItem);
        else this._cgl.gl.drawArraysInstanced(prim, this._bufVertexAttrib.startItem, this._bufVertexAttrib.numItems, this._numInstances);
    }
    else
    {
        if (prim == this._cgl.gl.TRIANGLES)elementDiv = 3;
        if (this._numInstances === 0)
        {
            // console.log("la", this._bufVerticesIndizes.numItems);

            this._cgl.gl.drawElements(prim, this._bufVerticesIndizes.numItems, this._indexType, 0);
        }
        else
        {
            this._cgl.gl.drawElementsInstanced(prim, this._bufVerticesIndizes.numItems, this._indexType, 0, this._numInstances);
        }
    }

    if (this._cgl.debugOneFrame && this._cgl.gl.getError() != this._cgl.gl.NO_ERROR)
    {
        this._log.error("mesh draw gl error");
        this._log.error("mesh", this);
        this._log.error("shader", shader);

        const attribNames = [];
        for (let i = 0; i < this._cgl.gl.getProgramParameter(shader.getProgram(), this._cgl.gl.ACTIVE_ATTRIBUTES); i++)
        {
            const name = this._cgl.gl.getActiveAttrib(shader.getProgram(), i).name;
            this._log.error("attrib ", name);
        }
    }

    this._cgl.profileData.profileMeshNumElements += (this._bufVertexAttrib.numItems / elementDiv) * (this._numInstances || 1);
    this._cgl.profileData.profileMeshDraw++;

    if (doQuery && queryStarted)
    {
        this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT);
    }

    this._cgl.printError("mesh render " + this._name);

    this.unBind();
};

Mesh.prototype.setNumInstances = function (n)
{
    n = Math.max(0, n);
    if (this._numInstances != n)
    {
        this._numInstances = n;
        const indexArr = new Float32Array(n);
        for (let i = 0; i < n; i++) indexArr[i] = i;
        this.setAttribute(constants_CONSTANTS.SHADER.SHADERVAR_INSTANCE_INDEX, indexArr, 1, { "instanced": true });
    }
};

Mesh.prototype._disposeAttributes = function ()
{
    if (!this._attributes) return;

    for (let i = 0; i < this._attributes.length; i++)
    {
        if (this._attributes[i].buffer)
        {
            this._cgl.gl.deleteBuffer(this._attributes[i].buffer);
            this._attributes[i].buffer = null;
        }
    }
    this._attributes.length = 0;
};

Mesh.prototype.dispose = function ()
{
    if (this._bufVertexAttrib && this._bufVertexAttrib.buffer) this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);
    if (this._bufVerticesIndizes) this._cgl.gl.deleteBuffer(this._bufVerticesIndizes);
    this._bufVerticesIndizes = null;

    this._disposeAttributes();
};





;// CONCATENATED MODULE: ./src/core/cgl/cgl_simplerect.js




const MESHES = {};

MESHES.getSimpleRect = function (cgl, name, size = 1.0)
{
    const geom = new Geometry(name);



    geom.vertices = [1.0 * size, 1.0 * size, 0.0, -1.0 * size, 1.0 * size, 0.0, 1.0 * size, -1.0 * size, 0.0, -1.0 * size, -1.0 * size, 0.0];
    geom.texCoords = [1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0];
    geom.verticesIndices = [0, 1, 2, 2, 1, 3];
    geom.vertexNormals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];

    return cgl.createMesh(geom);
    // return new Mesh(cgl, geom);
};


MESHES.getSimpleCube = function (cgl, name)
{
    const geom = new Geometry(name);
    geom.vertices = [-1, -1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, -1];
    geom.setTexCoords([0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0,]);
    geom.verticesIndices = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23];
    geom.vertexNormals = new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0]);
    geom.tangents = new Float32Array([0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1]);
    geom.biTangents = new Float32Array([-1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1]);

    return new Mesh(cgl, geom);
};




;// CONCATENATED MODULE: ./src/core/cgl/cgl_textureeffect.js




const TextureEffect = function (cgl, options)
{
    this._cgl = cgl;
    this._log = new Logger("cgl_TextureEffect");

    if (!cgl.TextureEffectMesh) this.createMesh();

    this._textureSource = null;
    this._options = options;
    this.name = options.name || "unknown";

    // TODO: do we still need the options ?
    // var opts=options ||
    //     {
    //         isFloatingPointTexture:false,
    //         filter:CGL.Texture.FILTER_LINEAR
    //     };
    // if(options && options.fp)opts.isFloatingPointTexture=true;

    this.imgCompVer = 0;
    this.aspectRatio = 1;
    this._textureTarget = null; // new CGL.Texture(this._cgl,opts);
    this._frameBuf = this._cgl.gl.createFramebuffer();
    this._frameBuf2 = this._cgl.gl.createFramebuffer();
    this._renderbuffer = this._cgl.gl.createRenderbuffer();
    this._renderbuffer2 = this._cgl.gl.createRenderbuffer();
    this.switched = false;
    this.depth = false;
};

TextureEffect.prototype.dispose = function ()
{
    if (this._renderbuffer) this._cgl.gl.deleteRenderbuffer(this._renderbuffer);
    if (this._frameBuf) this._cgl.gl.deleteFramebuffer(this._frameBuf);
    if (this._renderbuffer2) this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);
    if (this._frameBuf2) this._cgl.gl.deleteFramebuffer(this._frameBuf2);
};

TextureEffect.prototype.getWidth = function ()
{
    return this._textureSource.width;
};

TextureEffect.prototype.getHeight = function ()
{
    return this._textureSource.height;
};

TextureEffect.prototype.setSourceTexture = function (tex)
{
    if (tex === null)
    {
        this._textureSource = new Texture(this._cgl);
        this._textureSource.setSize(16, 16);
    }
    else
    {
        this._textureSource = tex;
    }

    if (!this._textureSource.compareSettings(this._textureTarget))
    {
        if (this._textureTarget) this._textureTarget.delete();

        this._textureTarget = this._textureSource.clone();

        this._cgl.profileData.profileEffectBuffercreate++;

        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuf);

        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, this._renderbuffer);

        // if(tex.textureType==CGL.Texture.TYPE_FLOAT) this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA32F, this._textureSource.width,this._textureSource.height);
        // else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA8, this._textureSource.width,this._textureSource.height);

        if (this.depth) this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER, this._cgl.gl.DEPTH_COMPONENT16, this._textureSource.width, this._textureSource.height);
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.TEXTURE_2D, this._textureTarget.tex, 0);
        if (this.depth) this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.RENDERBUFFER, this._renderbuffer);

        // this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.TEXTURE_2D, this._textureTarget.tex, 0);

        this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, null);
        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, null);
        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);

        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuf2);

        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, this._renderbuffer2);

        // if(tex.textureType==CGL.Texture.TYPE_FLOAT) this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA32F, this._textureSource.width,this._textureSource.height);
        // else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA8, this._textureSource.width,this._textureSource.height);

        if (this.depth) this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER, this._cgl.gl.DEPTH_COMPONENT16, this._textureSource.width, this._textureSource.height);
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.TEXTURE_2D, this._textureSource.tex, 0);

        if (this.depth) this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.RENDERBUFFER, this._renderbuffer2);

        // this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.TEXTURE_2D, this._textureSource.tex, 0);

        this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, null);
        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, null);
        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);
    }

    this.aspectRatio = this._textureSource.width / this._textureSource.height;
};
TextureEffect.prototype.continueEffect = function ()
{
    this._cgl.pushDepthTest(false);
    this._cgl.pushModelMatrix();
    this._cgl.pushPMatrix();
    // todo why two pushs?



    this._cgl.pushViewPort(0, 0, this.getCurrentTargetTexture().width, this.getCurrentTargetTexture().height);



    mat4.perspective(this._cgl.pMatrix, 45, this.getCurrentTargetTexture().width / this.getCurrentTargetTexture().height, 0.1, 1100.0); // todo: why?

    this._cgl.pushPMatrix();
    mat4.identity(this._cgl.pMatrix);

    this._cgl.pushViewMatrix();
    mat4.identity(this._cgl.vMatrix);

    this._cgl.pushModelMatrix();
    mat4.identity(this._cgl.mMatrix);
};


TextureEffect.prototype.startEffect = function (bgTex)
{
    if (!this._textureTarget)
    {
        this._log.warn("effect has no target");
        return;
    }

    this.switched = false;

    this.continueEffect();

    if (bgTex)
    {
        this._bgTex = bgTex;
    }
    this._countEffects = 0;
};

TextureEffect.prototype.endEffect = function ()
{
    this._cgl.popDepthTest();
    this._cgl.popModelMatrix();

    this._cgl.popPMatrix();
    this._cgl.popModelMatrix();
    this._cgl.popViewMatrix();

    this._cgl.popPMatrix();
    this._cgl.popViewPort();
};

TextureEffect.prototype.bind = function ()
{
    if (this._textureSource === null)
    {
        this._log.warn("no base texture set!");
        return;
    }

    if (!this.switched)
    {
        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuf);
        this._cgl.pushGlFrameBuffer(this._frameBuf);
    }
    else
    {
        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuf2);
        this._cgl.pushGlFrameBuffer(this._frameBuf2);
    }
};

TextureEffect.prototype.finish = function ()
{
    if (this._textureSource === null)
    {
        this._log.warn("no base texture set!");
        return;
    }

    this._cgl.TextureEffectMesh.render(this._cgl.getShader());

    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.popGlFrameBuffer());

    this._cgl.profileData.profileTextureEffect++;

    if (this._textureTarget.filter == Texture.FILTER_MIPMAP)
    {
        if (!this.switched)
        {
            this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, this._textureTarget.tex);
            this._textureTarget.updateMipMap();
        }
        else
        {
            this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, this._textureSource.tex);
            this._textureSource.updateMipMap();
        }

        this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, null);
    }

    this.switched = !this.switched;
    this._countEffects++;
};

TextureEffect.prototype.getCurrentTargetTexture = function ()
{
    if (this.switched) return this._textureSource;
    return this._textureTarget;
};

TextureEffect.prototype.getCurrentSourceTexture = function ()
{
    if (this._countEffects == 0 && this._bgTex) return this._bgTex;

    if (this.switched) return this._textureTarget;
    return this._textureSource;
};

TextureEffect.prototype.delete = function ()
{
    if (this._textureTarget) this._textureTarget.delete();
    if (this._textureSource) this._textureSource.delete();
    this._cgl.gl.deleteRenderbuffer(this._renderbuffer);
    this._cgl.gl.deleteFramebuffer(this._frameBuf);
};

TextureEffect.prototype.createMesh = function ()
{
    this._cgl.TextureEffectMesh = MESHES.getSimpleRect(this._cgl, "texEffectRect");
};

// ---------------------------------------------------------------------------------

TextureEffect.checkOpNotInTextureEffect = function (op)
{
    if (!op.patch.cgl) return true;
    if (op.uiAttribs.error && !op.patch.cgl.currentTextureEffect)
    {
        op.setUiError("textureeffect", null);
        return true;
    }
    if (!op.patch.cgl.currentTextureEffect) return true;

    if (op.patch.cgl.currentTextureEffect && !op.uiAttribs.error)
    {
        op.setUiError("textureeffect", "This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.", 0);
        return false;
    }

    if (op.patch.cgl.currentTextureEffect) return false;
    return true;
};

TextureEffect.checkOpInEffect = function (op, minver)
{
    minver = minver || 0;

    if (op.patch.cgl.currentTextureEffect)
    {
        if (op.uiAttribs.uierrors && op.patch.cgl.currentTextureEffect.imgCompVer >= minver)
        {
            op.setUiError("texeffect", null);
            return true;
        }

        if (minver && op.patch.cgl.currentTextureEffect.imgCompVer < minver)
        {
            op.setUiError("texeffect", "This op must be a child of an ImageCompose op with version >=" + minver + " <span class=\"button-small\" onclick=\"gui.patchView.downGradeOp('" + op.id + "','" + op.name + "')\">Downgrade</span> to previous version", 1);
        }
    }

    if (op.patch.cgl.currentTextureEffect) return true;

    if (!op.patch.cgl.currentTextureEffect && (!op.uiAttribs.uierrors || op.uiAttribs.uierrors.length == 0))
    {
        op.setUiError("texeffect", "This op must be a child of an ImageCompose op! More infos <a href=\"https://cables.gl/docs/image_composition/image_composition.html\" target=\"_blank\">here</a>. ", 1);
        return false;
    }

    if (!op.patch.cgl.currentTextureEffect) return false;
    return true;
};

TextureEffect.getBlendCode = function (ver)
{
    let src = "".endl()
        + "vec3 _blend(vec3 base,vec3 blend)".endl()
        + "{".endl()
        + "   vec3 colNew=blend;".endl()
        + "   #ifdef BM_MULTIPLY".endl()
        + "       colNew=base*blend;".endl()
        + "   #endif".endl()
        + "   #ifdef BM_MULTIPLY_INV".endl()
        + "       colNew=base* vec3(1.0)-blend;".endl()
        + "   #endif".endl()
        + "   #ifdef BM_AVERAGE".endl()
        + "       colNew=((base + blend) / 2.0);".endl()
        + "   #endif".endl()
        + "   #ifdef BM_ADD".endl()
        + "       colNew=min(base + blend, vec3(1.0));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_SUBTRACT_ONE".endl()
        + "       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()
        + "   #endif".endl()

        + "   #ifdef BM_SUBTRACT".endl()
        + "       colNew=base - blend;".endl()
        + "   #endif".endl()

        + "   #ifdef BM_DIFFERENCE".endl()
        + "       colNew=abs(base - blend);".endl()
        + "   #endif".endl()
        + "   #ifdef BM_NEGATION".endl()
        + "       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_EXCLUSION".endl()
        + "       colNew=(base + blend - 2.0 * base * blend);".endl()
        + "   #endif".endl()
        + "   #ifdef BM_LIGHTEN".endl()
        + "       colNew=max(blend, base);".endl()
        + "   #endif".endl()
        + "   #ifdef BM_DARKEN".endl()
        + "       colNew=min(blend, base);".endl()
        + "   #endif".endl()
        + "   #ifdef BM_OVERLAY".endl()
        + "      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))"
            // .endl()+'       #define BlendOverlay(base, blend)       Blend(base, blend, BlendOverlayf)'
            //    .endl()+'      colNew=Blend(base, blend, BlendOverlayf);'
            .endl()
        + "      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_SCREEN".endl()
        + "      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))"
            // .endl()+'       #define BlendScreen(base, blend)        Blend(base, blend, BlendScreenf)'
            // .endl()+'      colNew=Blend(base, blend, BlendScreenf);'
            .endl()
        + "      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_SOFTLIGHT".endl()
        + "      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))"
            // .endl()+'       #define BlendSoftLight(base, blend)     Blend(base, blend, BlendSoftLightf)'
            //    .endl()+'      colNew=Blend(base, blend, BlendSoftLightf);'
            .endl()
        + "      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_HARDLIGHT".endl()
        + "      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))"
            // .endl()+'       #define BlendOverlay(base, blend)       Blend(base, blend, BlendOverlayf)'
            // .endl()+'      colNew=Blend(blend, base, BlendOverlayf);'
            .endl()
        + "      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_COLORDODGE".endl()
        + "      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))"
            // .endl()+'      colNew=Blend(base, blend, BlendColorDodgef);'
            .endl()
        + "      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()
        + "   #endif".endl()
        + "   #ifdef BM_COLORBURN".endl()
        + "      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))"
            // .endl()+'      colNew=Blend(base, blend, BlendColorBurnf);'
            .endl()
        + "      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()
        + "   #endif".endl()










        + "   return colNew;".endl()
        + "}".endl();

    if (!ver)
        src += "vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()
                + "{".endl()
                    + "vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()
                    + "col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()
                    + "return col;".endl()
                + "}".endl();

    if (ver >= 3)
        src += "vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl() +
                "{".endl() +

                "#ifdef BM_MATH_ADD".endl() +
                "   return vec4(base.rgb+col.rgb*amount,1.0);".endl() +
                "#endif".endl() +

                "#ifdef BM_MATH_SUB".endl() +
                "   return vec4(base.rgb-col.rgb*amount,1.0);".endl() +
                "#endif".endl() +

                "#ifdef BM_MATH_MUL".endl() +
                "   return vec4(base.rgb*col.rgb*amount,1.0);".endl() +
                "#endif".endl() +

                "#ifdef BM_MATH_DIV".endl() +
                "   return vec4(base.rgb/col.rgb*amount,1.0);".endl() +
                "#endif".endl() +


                    "#ifndef BM_MATH".endl() +
                        "vec3 colNew=_blend(base.rgb,col.rgb);".endl() +

                        "float newA=clamp(base.a+(col.a*amount),0.,1.);".endl() +

                        "#ifdef BM_ALPHAMASKED".endl() +
                            "newA=base.a;".endl() +
                        "#endif".endl() +

                        "return vec4(".endl() +
                            "mix(colNew,base.rgb,1.0-(amount*col.a)),".endl() +
                            "newA);".endl() +

                    "#endif".endl() +
    "}".endl();

    return src;
};

TextureEffect.onChangeBlendSelect = function (shader, blendName, maskAlpha = false)
{
    blendName = String(blendName);
    shader.toggleDefine("BM_NORMAL", blendName == "normal");
    shader.toggleDefine("BM_MULTIPLY", blendName == "multiply");
    shader.toggleDefine("BM_MULTIPLY_INV", blendName == "multiply invert");
    shader.toggleDefine("BM_AVERAGE", blendName == "average");
    shader.toggleDefine("BM_ADD", blendName == "add");
    shader.toggleDefine("BM_SUBTRACT_ONE", blendName == "subtract one");
    shader.toggleDefine("BM_SUBTRACT", blendName == "subtract");
    shader.toggleDefine("BM_DIFFERENCE", blendName == "difference");
    shader.toggleDefine("BM_NEGATION", blendName == "negation");
    shader.toggleDefine("BM_EXCLUSION", blendName == "exclusion");
    shader.toggleDefine("BM_LIGHTEN", blendName == "lighten");
    shader.toggleDefine("BM_DARKEN", blendName == "darken");
    shader.toggleDefine("BM_OVERLAY", blendName == "overlay");
    shader.toggleDefine("BM_SCREEN", blendName == "screen");
    shader.toggleDefine("BM_SOFTLIGHT", blendName == "softlight");
    shader.toggleDefine("BM_HARDLIGHT", blendName == "hardlight");
    shader.toggleDefine("BM_COLORDODGE", blendName == "color dodge");
    shader.toggleDefine("BM_COLORBURN", blendName == "color burn");

    shader.toggleDefine("BM_MATH_ADD", blendName == "Math Add");
    shader.toggleDefine("BM_MATH_SUB", blendName == "Math Subtract");
    shader.toggleDefine("BM_MATH_MUL", blendName == "Math Multiply");
    shader.toggleDefine("BM_MATH_DIV", blendName == "Math Divide");

    shader.toggleDefine("BM_MATH", blendName.indexOf("Math ") == 0);


    shader.toggleDefine("BM_ALPHAMASKED", maskAlpha);
};

TextureEffect.AddBlendSelect = function (op, name, defaultMode)
{
    const p = op.inValueSelect(name || "Blend Mode", [
        "normal", "lighten", "darken", "multiply", "multiply invert", "average", "add", "subtract", "difference", "negation", "exclusion", "overlay", "screen", "color dodge", "color burn", "softlight", "hardlight", "subtract one",
        "Math Add",
        "Math Subtract",
        "Math Multiply",
        "Math Divide",

    ], defaultMode || "normal");
    return p;
};

TextureEffect.AddBlendAlphaMask = function (op, name, defaultMode)
{
    const p = op.inSwitch(name || "Alpha Mask", ["Off", "On"], defaultMode || "Off");
    return p;
};

TextureEffect.setupBlending = function (op, shader, blendPort, amountPort, alphaMaskPort)
{
    const onChange = () =>
    {
        let maskAlpha = false;
        if (alphaMaskPort) maskAlpha = alphaMaskPort.get() == "On";
        TextureEffect.onChangeBlendSelect(shader, blendPort.get(), maskAlpha);

        let str = blendPort.get();
        if (str == "normal") str = null;
        else if (str == "multiply") str = "mul";
        else if (str == "multiply invert") str = "mulinv";
        else if (str == "lighten") str = "light";
        else if (str == "darken") str = "darken";
        else if (str == "average") str = "avg";
        else if (str == "subtract one") str = "sub one";
        else if (str == "subtract") str = "sub";
        else if (str == "difference") str = "diff";
        else if (str == "negation") str = "neg";
        else if (str == "exclusion") str = "exc";
        else if (str == "overlay") str = "ovl";
        else if (str == "color dodge") str = "dodge";
        else if (str == "color burn") str = "burn";
        else if (str == "softlight") str = "soft";
        else if (str == "hardlight") str = "hard";
        else if (str == "Math Add") str = "+";
        else if (str == "Math Subtract") str = "-";
        else if (str == "Math Multiply") str = "*";
        else if (str == "Math Divide") str = "/";

        op.setUiAttrib({ "extendTitle": str });
    };
    op.setPortGroup("Blending", [blendPort, amountPort, alphaMaskPort]);

    let maskAlpha = false;

    blendPort.onChange = onChange;
    if (alphaMaskPort)
    {
        alphaMaskPort.onChange = onChange;
        maskAlpha = alphaMaskPort.get() == "On";
    }

    TextureEffect.onChangeBlendSelect(shader, blendPort.get(), maskAlpha);
};



;// CONCATENATED MODULE: ./src/core/cgl/cgl_shader_lib.js




const ShaderLibMods = {
    "CGL.BLENDMODES": function ()
    {
        this.name = "blendmodes";
        this.srcHeadFrag = TextureEffect.getBlendCode();
    },
    "CGL.BLENDMODES3": function ()
    {
        this.name = "blendmodes3";
        this.srcHeadFrag = TextureEffect.getBlendCode(3);
    },

    "CGL.LUMINANCE": function ()
    {
        this.name = "luminance";
        this.srcHeadFrag = "".endl()
            + "float cgl_luminance(vec3 c)".endl()
            + "{".endl()
            + "    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()
            + "}".endl();
    },


    // quite good random numbers, but somehow don't work in ANGLE
    "CGL.RANDOM_OLD": function ()
    {
        this.name = "randomNumber";
        this.srcHeadFrag = "".endl()
            + "float cgl_random(vec2 co)".endl()
            + "{".endl()
            + "    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()
            + "}".endl()
            + "vec3 cgl_random3(vec2 co)".endl()
            + "{".endl()
            + "    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()
            + "}";
    },


    // low quality generative ranodm numbers
    "CGL.RANDOM_LOW": function ()
    {
        this.name = "randomNumber";
        this.srcHeadFrag = "".endl()
            + "float cgl_random(vec2 co)".endl()
            + "{".endl()
            + "    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()
            + "}".endl()
            + "vec3 cgl_random3(vec2 co)".endl()
            + "{".endl()
            + "    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()
            + "}";
    },

    // texture based random numbers
    "CGL.RANDOM_TEX": function ()
    {
        this.name = "randomNumbertex";
        this.srcHeadFrag = "".endl()
            + "UNI sampler2D CGLRNDTEX;".endl()
            + "float cgl_random(vec2 co)".endl()
            + "{".endl()
            + "    return texture(CGLRNDTEX,co*5711.0).r;".endl()
            + "}".endl()
            + "vec3 cgl_random3(vec2 co)".endl()
            + "{".endl()
            + "    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()
            + "}";

        this.initUniforms = function (shader)
        {
            return [new Uniform(shader, "t", "CGLRNDTEX", 7)];
        };

        this.onBind = function (cgl, shader)
        {
            Texture.getRandomTexture(cgl);
            cgl.setTexture(7, Texture.getRandomTexture(cgl).tex);
        };
    },
};



;// CONCATENATED MODULE: ./src/core/cgl/cgl_utils.js
/** @namespace CGL */

/**
 * multiply to get radians from degree, e.g. `360 * CGL.DEG2RAD`
 * @const {Number}
 * @memberof CGL
 * @static
 */
const cgl_utils_DEG2RAD = Math.PI / 180.0;

/**
 * to get degrees from radians, e.g. `3.14 * CGL.RAD2DEG`
 * @const {number}
 * @memberof CGL
 */
const cgl_utils_RAD2DEG = 180.0 / Math.PI;

const onLoadingAssetsFinished = null; // deprecated / remove later

/**
 * get normalized mouse wheel delta (including browser specific adjustment)
 * @function getWheelDelta
 * @static
 * @memberof CGL
 * @param {MouseEvent} event
 * @return {Number} normalized delta
 */
const isWindows = window.navigator.userAgent.contains("Windows");
const getWheelDelta_ = function (event)
{
    let normalized;
    if (event.wheelDelta)
    {
        // chrome
        normalized = (event.wheelDelta % 120) - 0 == -0 ? event.wheelDelta / 120 : event.wheelDelta / 30;
        normalized *= -1.5;
        if (isWindows) normalized *= 2;
    }
    else
    {
        // firefox
        let d = event.deltaY;
        if (event.shiftKey) d = event.deltaX;
        const rawAmmount = d || event.detail;
        normalized = -(rawAmmount % 3 ? rawAmmount * 10 : rawAmmount / 3);
        normalized *= -3;
    }

    if (normalized > 20) normalized = 20;
    if (normalized < -20) normalized = -20;

    return normalized;
};

const getWheelSpeed = getWheelDelta_;
const getWheelDelta = getWheelDelta_;

// from https://github.com/lodash/lodash/blob/master/escape.js

const htmlEscapes = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    "\"": "&quot;",
    "'": "&#39;",
};

/** Used to match HTML entities and HTML characters. */
const reUnescapedHtml = /[&<>"']/g;
const reHasUnescapedHtml = RegExp(reUnescapedHtml.source);

/*  eslint-disable */
const escapeHTML = function(string)
{
    return string && reHasUnescapedHtml.test(string) ?
        string.replace(reUnescapedHtml, function(chr) { return htmlEscapes[chr]; })
        : string || "";
}
/* eslint-enable */

;// CONCATENATED MODULE: ./src/core/cg/cg_shader.js



class CgShader extends EventTarget
{
    constructor()
    {
        super();
        this.id = simpleId();
        this._isValid = true;
        this._defines = [];

        this._moduleNames = [];
        this._modules = [];
        this._moduleNumId = 0;
    }

    /**
     * easily enable/disable a define without a value
     * @function toggleDefine
     * @memberof Shader
     * @instance
     * @param {name} name
     * @param {any} enabled value or port
     */
    toggleDefine(name, enabled)
    {
        if (enabled && typeof (enabled) == "object" && enabled.addEventListener) // port
        {
            if (enabled.changeListener)enabled.removeEventListener(enabled.changeListener);

            enabled.onToggleDefine = (v) =>
            {
                this.toggleDefine(name, v);
            };

            enabled.changeListener = enabled.on("change", enabled.onToggleDefine);
            enabled = enabled.get();
        }

        if (enabled) this.define(name);
        else this.removeDefine(name);
    }

    /**
     * add a define to a shader, e.g.  #define DO_THIS_THAT 1
     * @function define
     * @memberof Shader
     * @instance
     * @param {String} name
     * @param {Any} value (can be empty)
     */
    define(name, value)
    {
        if (value === null || value === undefined) value = "";

        if (typeof (value) == "object") // port
        {
            value.removeEventListener("change", value.onDefineChange);
            value.onDefineChange = (v) =>
            {
                this.define(name, v);
            };
            value.on("change", value.onDefineChange);

            value = value.get();
        }


        for (let i = 0; i < this._defines.length; i++)
        {
            if (this._defines[i][0] == name && this._defines[i][1] == value) return;
            if (this._defines[i][0] == name)
            {
                this._defines[i][1] = value;
                this.setWhyCompile("define " + name + " " + value);

                this._needsRecompile = true;
                return;
            }
        }
        this.setWhyCompile("define " + name + " " + value);
        this._needsRecompile = true;
        this._defines.push([name, value]);
    }

    getDefines()
    {
        return this._defines;
    }

    getDefine(name)
    {
        for (let i = 0; i < this._defines.length; i++)
            if (this._defines[i][0] == name) return this._defines[i][1];
        return null;
    }

    /**
     * return true if shader has define
     * @function hasDefine
     * @memberof Shader
     * @instance
     * @param {String} name
     * @return {Boolean}
     */
    hasDefine(name)
    {
        for (let i = 0; i < this._defines.length; i++)
            if (this._defines[i][0] == name) return true;
    }

    /**
     * remove a define from a shader
     * @param {name} name
     * @function removeDefine
     * @memberof Shader
     * @instance
     */
    removeDefine(name)
    {
        for (let i = 0; i < this._defines.length; i++)
        {
            if (this._defines[i][0] == name)
            {
                this._defines.splice(i, 1);
                this._needsRecompile = true;

                this.setWhyCompile("define removed:" + name);

                return;
            }
        }
    }


    hasModule(modId)
    {
        for (let i = 0; i < this._modules.length; i++)
        {
            if (this._modules[i].id == modId) return true;
        }
        return false;
    }

    setModules(names)
    {
        this._moduleNames = names;
    }


    /**
     * remove a module from shader
     * @function removeModule
     * @memberof Shader
     * @instance
     * @param {shaderModule} mod the module to be removed
     */
    removeModule(mod)
    {
        for (let i = 0; i < this._modules.length; i++)
        {
            if (mod && mod.id)
            {
                if (this._modules[i].id == mod.id || !this._modules[i])
                {
                    let found = true;
                    while (found)
                    {
                        found = false;
                        for (let j = 0; j < this._uniforms.length; j++)
                        {
                            if (this._uniforms[j].getName().startsWith(mod.prefix))
                            {
                                this._uniforms.splice(j, 1);
                                found = true;
                                continue;
                            }
                        }
                    }

                    this._needsRecompile = true;
                    this.setWhyCompile("remove module " + mod.title);
                    this._modules.splice(i, 1);
                    break;
                }
            }
        }
    }


    getNumModules()
    {
        return this._modules.length;
    }


    getCurrentModules() { return this._modules; }


    /**
     * add a module
     * @function addModule
     * @memberof Shader
     * @instance
     * @param {shaderModule} mod the module to be added
     * @param {shaderModule} [sibling] sibling module, new module will share the same group
     */
    addModule(mod, sibling)
    {
        if (this.hasModule(mod.id)) return;
        if (!mod.id) mod.id = CABLES.simpleId();
        if (!mod.numId) mod.numId = this._moduleNumId;
        if (!mod.num)mod.num = this._modules.length;
        if (sibling && !sibling.group) sibling.group = simpleId();

        if (!mod.group)
            if (sibling) mod.group = sibling.group;
            else mod.group = simpleId();

        mod.prefix = "mod" + mod.group + "_";
        this._modules.push(mod);

        this._needsRecompile = true;
        this.setWhyCompile("add module " + mod.title);
        this._moduleNumId++;

        return mod;
    }

    getAttributeSrc(mod, srcHeadVert, srcVert)
    {
        if (mod.attributes)
            for (let k = 0; k < mod.attributes.length; k++)
            {
                const r = this._getAttrSrc(mod.attributes[k], false);
                if (r.srcHeadVert)srcHeadVert += r.srcHeadVert;
                if (r.srcVert)srcVert += r.srcVert;
            }

        return { "srcHeadVert": srcHeadVert, "srcVert": srcVert };
    }

    replaceModuleSrc()
    {
        let srcHeadVert = "";

        for (let j = 0; j < this._modules.length; j++)
        {
            const mod = this._modules[j];
            if (mod.name == this._moduleNames[i])
            {
                srcHeadVert += "\n//---- MOD: group:" + mod.group + ": idx:" + j + " - prfx:" + mod.prefix + " - " + mod.title + " ------\n";

                srcVert += "\n\n//---- MOD: " + mod.title + " / " + mod.priority + " ------\n";


                if (mod.getAttributeSrc)
                {
                    const r = getAttributeSrc(mod, srcHeadVert, srcVert);
                    if (r.srcHeadVert)srcHeadVert += r.srcHeadVert;
                    if (r.srcVert)srcVert += r.srcVert;
                }


                srcHeadVert += mod.srcHeadVert || "";
                srcVert += mod.srcBodyVert || "";

                srcHeadVert += "\n//---- end mod ------\n";

                srcVert += "\n//---- end mod ------\n";

                srcVert = srcVert.replace(/{{mod}}/g, mod.prefix);
                srcHeadVert = srcHeadVert.replace(/{{mod}}/g, mod.prefix);

                srcVert = srcVert.replace(/MOD_/g, mod.prefix);
                srcHeadVert = srcHeadVert.replace(/MOD_/g, mod.prefix);
            }
        }


        vs = vs.replace("{{" + this._moduleNames[i] + "}}", srcVert);
    }
}



;// CONCATENATED MODULE: ./src/core/cgl/cgl_shader_default_glsl.vert
/* harmony default export */ const cgl_shader_default_glsl = ("{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n");
;// CONCATENATED MODULE: ./src/core/cgl/cgl_shader.js









// ---------------------------------------------------------------------------


/*

proposal default shader variable names:

attrVertex - currently: vPosition
attrVertexIndex - currently: attrVertIndex
attrTexCoord
attrInstMat - currently: instMat
attrVertColor
attrTangent
attrBiTangent

uProjMatrix - currently: projMatrix
uModelMatrix - currently: modelMatrix
uNormalMatrix - currently: normalMatrix
uCamPosition - currently: camPos

*/


// ---------------------------------------------------------------------------

let materialIdCounter = 0;




function getDefaultVertexShader()
{
    return cgl_shader_default_glsl;
}


function getDefaultFragmentShader(r, g, b)
{
    if (r == undefined)
    {
        r = 0.5;
        g = 0.5;
        b = 0.5;
    }
    return ""
        .endl() + "IN vec2 texCoord;"
        .endl() + "{{MODULES_HEAD}}"
        .endl() + "void main()"
        .endl() + "{"
        .endl() + "    vec4 col=vec4(" + r + "," + g + "," + b + ",1.0);"
        .endl() + "    {{MODULE_COLOR}}"
        .endl() + "    outColor = col;"
        .endl() + "}";
};


/**
 * @class
 * @namespace external:CGL
 * @hideconstructor
 * @param _cgl
 * @param _name
 * @param _op
 * @example
 * var shader=new CGL.Shader(cgl,'MinimalMaterial');
 * shader.setSource(attachments.shader_vert,attachments.shader_frag);
 */
class Shader extends CgShader
{
    constructor (_cgl, _name, _op)
    {
        super();
        if (!_cgl) throw new Error("shader constructed without cgl " + _name);

        this._log = new Logger("cgl_shader");
        this._cgl = _cgl;

        if (!_name) this._log.stack("no shader name given");
        this._name = _name || "unknown";

        if (_op) this.opId = _op.id;
        this.glslVersion = 0;
        if (_cgl.glVersion > 1) this.glslVersion = 300;

        this._materialId = ++materialIdCounter;

        this._program = null;
        this._uniforms = [];
        this._drawBuffers = [true];

        this._needsRecompile = true;
        this._compileReason = "initial";

        this.ignoreMissingUniforms = false;
        this._projMatrixUniform = null;
        this._mvMatrixUniform = null;
        this._mMatrixUniform = null;
        this._vMatrixUniform = null;
        this._camPosUniform = null;
        this._normalMatrixUniform = null;
        this._inverseViewMatrixUniform = null;
        this._fromUserInteraction = false;

        this._attrVertexPos = -1;
        this.precision = _cgl.patch.config.glslPrecision || "highp";

        this._pMatrixState = -1;
        this._vMatrixState = -1;

        this._countMissingUniforms = 0;
        this._modGroupCount = 0; // not needed anymore...
        this._feedBackNames = [];
        this._attributes = [];

        this.glPrimitive = null;
        this.offScreenPass = false;
        this._extensions = [];
        this.srcVert = getDefaultVertexShader();
        this.srcFrag = getDefaultFragmentShader();
        this.lastCompile = 0;


        this._libs = [];
        this._structNames = [];
        this._structUniformNames = [];
        this._textureStackUni = [];
        this._textureStackTex = [];
        this._textureStackType = [];
        this._textureStackTexCgl = [];

        this._tempNormalMatrix = mat4.create();
        this._tempCamPosMatrix = mat4.create();
        this._tempInverseViewMatrix = mat4.create();
        this._tempInverseProjMatrix = mat4.create();

        this.setModules(["MODULE_VERTEX_POSITION", "MODULE_COLOR", "MODULE_BEGIN_FRAG", "MODULE_VERTEX_MODELVIEW"]);
    };







    isValid()
    {
        return this._isValid;
    };

    getCgl()
    {
        return this._cgl;
    };

    getName()
    {
        return this._name;
    };

    /**
     * enable an extension for the shader
     * @function enableExtension
     * @memberof Shader
     * @instance
     * @param name extension name
     */
    enableExtension(name)
    {
        this.setWhyCompile("enable extension " + name);
        this._needsRecompile = true;
        this._extensions.push(name);
    };

    getAttrVertexPos()
    {
        return this._attrVertexPos;
    };

    hasTextureUniforms()
    {
        for (let i = 0; i < this._uniforms.length; i++)
            if (this._uniforms[i].getType() == "t") return true;
        return false;
    };

    setWhyCompile(why)
    {
        this._compileReason = why;
    };

    /**
     * copy all uniform values from another shader
     * @function copyUniforms
     * @memberof Shader
     * @instance
     * @param origShader uniform values will be copied from this shader
     */
    copyUniformValues(origShader)
    {
        // console.log(origShader._uniforms);
        for (let i = 0; i < origShader._uniforms.length; i++)
        {
            if (!this._uniforms[i])
            {
                this._log.log("unknown uniform?!");
                continue;
            }

            // this._log.log(origShader._uniforms[i].getName());
            // this.getUniform(origShader._uniforms[i].)
            // this._uniforms[i].set(origShader._uniforms[i].getValue());


            // if (origShader._uniforms[i].getName().contains("pathPoints"))
            //     console.log("copyUniformValues", origShader._uniforms[i].getName(), origShader._uniforms[i].getValue());

            this.getUniform(origShader._uniforms[i].getName()).set(origShader._uniforms[i].getValue());
        }

        this.popTextures();
        for (let i = 0; i < origShader._textureStackUni.length; i++)
        {
            this._textureStackUni[i] = origShader._textureStackUni[i];
            this._textureStackTex[i] = origShader._textureStackTex[i];
            this._textureStackType[i] = origShader._textureStackType[i];
            this._textureStackTexCgl[i] = origShader._textureStackTexCgl[i];
        }

        // this._textureStackUni = [];
        // this._textureStackTex = [];
        // this._textureStackType = [];
        // this._textureStackTexCgl = [];
    };

    /**
     * copy current shader
     * @function copy
     * @memberof Shader
     * @instance
     * @returns newShader
     */
    copy()
    {
        const shader = new Shader(this._cgl, this._name + " copy");
        shader.setSource(this.srcVert, this.srcFrag);

        shader._modules = JSON.parse(JSON.stringify(this._modules));
        shader._defines = JSON.parse(JSON.stringify(this._defines));

        shader._modGroupCount = this._modGroupCount;
        shader._moduleNames = this._moduleNames;
        shader.glPrimitive = this.glPrimitive;
        shader.offScreenPass = this.offScreenPass;
        shader._extensions = this._extensions;
        shader.wireframe = this.wireframe;
        shader._attributes = this._attributes;

        for (let i = 0; i < this._uniforms.length; i++)
        {
            const u = this._uniforms[i].copy(shader);
            u.resetLoc();
        }

        this.setWhyCompile("copy");
        shader._needsRecompile = true;
        return shader;
    };


    /**
     * set shader source code
     * @function setSource
     * @memberof Shader
     * @instance
     * @param {String} srcVert
     * @param {String} srcFrag
     * @param {Bool} fromUserInteraction
     */
    setSource(srcVert, srcFrag, fromUserInteraction)
    {
        this._fromUserInteraction = fromUserInteraction;
        this.srcVert = srcVert;
        this.srcFrag = srcFrag;
        this.setWhyCompile("Source changed");
        this._needsRecompile = true;
        this._isValid = true;
    };

    _addLibs(src)
    {
        for (const id in ShaderLibMods)
        {
            if (src.contains(id))
            {
                const lib = new ShaderLibMods[id]();
                src = src.replace("{{" + id + "}}", lib.srcHeadFrag);
                this._libs.push(lib);
                if (lib.initUniforms)lib.initUniforms(this);
            }
        }

        return src;
    };

    createStructUniforms()
    {
        // * create structs
        let structStrFrag = "";
        let structStrVert = ""; // TODO: not used yet

        this._structNames = [];
        // * reset the arrays holding the value each recompile so we don't skip structs
        // * key value mapping so the same struct can be added twice (two times the same modifier)
        this._injectedStringsFrag = {};
        this._injectedStringsVert = {};

        this._structUniformNamesIndicesFrag = [];
        this._structUniformNamesIndicesVert = [];

        for (let i = 0; i < this._uniforms.length; i++)
        {
            // * only add uniforms to struct that are a member of a struct
            if (this._uniforms[i].isStructMember())
            {
                const injectionString = "{{INJECTION_POINT_STRUCT_" + this._uniforms[i]._structName + "}}";

                // * check if struct is not already part of shader
                if (!this._structNames.includes(this._uniforms[i]._structName))
                {
                    // * create struct definition with placeholder string to inject
                    const structDefinition = "struct "
                        + this._uniforms[i]._structName + " {".endl()
                        + injectionString
                        + "};".endl().endl();

                    if (this._uniforms[i].getShaderType() === "both" || this._uniforms[i].getShaderType() === "frag")
                        structStrFrag = structStrFrag.concat(structDefinition);

                    if (this._uniforms[i].getShaderType() === "both" || this._uniforms[i].getShaderType() === "vert")
                        structStrVert = structStrVert.concat(structDefinition);

                    this._structNames.push(this._uniforms[i]._structName);
                    this._injectedStringsFrag[this._uniforms[i]._structName] = [];
                    this._injectedStringsVert[this._uniforms[i]._structName] = [];
                }

                // * create member & comment
                let comment = "";
                if (this._uniforms[i].comment) comment = " // " + this._uniforms[i].comment;

                let stringToInsert = "";
                if (this._uniforms[i].getGlslTypeString() == undefined)stringToInsert += "//";
                stringToInsert += "  " + this._uniforms[i].getGlslTypeString()
                        + " " + this._uniforms[i]._propertyName + ";"
                        + comment;

                if (this._uniforms[i].getShaderType() === "both")
                {
                    // * inject member before {injectionString}
                    if (
                        !this._injectedStringsFrag[this._uniforms[i]._structName].contains(stringToInsert)
                    && !this._injectedStringsVert[this._uniforms[i]._structName].contains(stringToInsert))
                    {
                        const insertionIndexFrag = structStrFrag.lastIndexOf(injectionString);
                        const insertionIndexVert = structStrVert.lastIndexOf(injectionString);

                        structStrFrag =
                            structStrFrag.slice(0, insertionIndexFrag)
                            + stringToInsert + structStrFrag.slice(insertionIndexFrag - 1);

                        structStrVert =
                            structStrVert.slice(0, insertionIndexVert)
                            + stringToInsert + structStrVert.slice(insertionIndexVert - 1);

                        this._injectedStringsFrag[this._uniforms[i]._structName].push(stringToInsert);
                        this._injectedStringsVert[this._uniforms[i]._structName].push(stringToInsert);
                    }

                    if (!this._structUniformNamesIndicesFrag.includes(i)) this._structUniformNamesIndicesFrag.push(i);
                    if (!this._structUniformNamesIndicesVert.includes(i)) this._structUniformNamesIndicesVert.push(i);
                }
                else if (this._uniforms[i].getShaderType() === "frag")
                {
                    // * inject member before {injectionString}
                    if (!this._injectedStringsFrag[this._uniforms[i]._structName].includes(stringToInsert)) //
                    {
                        const insertionIndexFrag = structStrFrag.lastIndexOf(injectionString);

                        structStrFrag =
                            structStrFrag.slice(0, insertionIndexFrag)
                            + stringToInsert + structStrFrag.slice(insertionIndexFrag - 1);

                        this._injectedStringsFrag[this._uniforms[i]._structName].push(stringToInsert);
                    }

                    if (!this._structUniformNamesIndicesFrag.includes(i)) this._structUniformNamesIndicesFrag.push(i);
                }
                else if (this._uniforms[i].getShaderType() === "vert")
                {
                    // * inject member before {injectionString}
                    if (!this._injectedStringsVert[this._uniforms[i]._structName].includes(stringToInsert))
                    {
                        const insertionIndexVert = structStrVert.lastIndexOf(injectionString);

                        structStrVert =
                            structStrVert.slice(0, insertionIndexVert)
                            + stringToInsert + structStrVert.slice(insertionIndexVert - 1);

                        this._injectedStringsVert[this._uniforms[i]._structName].push(stringToInsert);
                    }

                    if (!this._structUniformNamesIndicesVert.includes(i)) this._structUniformNamesIndicesVert.push(i);
                }
            }
        }

        // * dedupe injected uni declarations
        this._uniDeclarationsFrag = [];
        this._uniDeclarationsVert = [];

        // * remove struct injection points and add uniform in fragment
        for (let i = 0; i < this._structUniformNamesIndicesFrag.length; i += 1)
        {
            const index = this._structUniformNamesIndicesFrag[i];
            const uniDeclarationString = "UNI " + this._uniforms[index]._structName + " " + this._uniforms[index]._structUniformName + ";".endl();

            if (!this._uniDeclarationsFrag.includes(uniDeclarationString))
            {
                const injectionString = "{{INJECTION_POINT_STRUCT_" + this._uniforms[index]._structName + "}}";

                structStrFrag = structStrFrag.replace(injectionString, "");
                structStrFrag += uniDeclarationString;

                this._uniDeclarationsFrag.push(uniDeclarationString);
            }
        }

        // * remove struct injection points and add uniform in vertex
        for (let i = 0; i < this._structUniformNamesIndicesVert.length; i += 1)
        {
            const index = this._structUniformNamesIndicesVert[i];
            const uniDeclarationString = "UNI " + this._uniforms[index]._structName + " " + this._uniforms[index]._structUniformName + ";".endl();

            if (!this._uniDeclarationsVert.includes(uniDeclarationString))
            {
                const injectionString = "{{INJECTION_POINT_STRUCT_" + this._uniforms[index]._structName + "}}";

                structStrVert = structStrVert.replace(injectionString, "");
                structStrVert += uniDeclarationString;
                this._uniDeclarationsVert.push(uniDeclarationString);
            }
        }

        return [structStrVert, structStrFrag];
    };

    _getAttrSrc(attr, firstLevel)
    {
        const r = {};
        if (attr.name && attr.type)
        {
            r.srcHeadVert = "";
            if (!firstLevel) r.srcHeadVert += "#ifndef ATTRIB_" + attr.name.endl();
            r.srcHeadVert += "#define ATTRIB_" + attr.name.endl();
            r.srcHeadVert += "IN " + attr.type + " " + attr.name + ";".endl();
            if (!firstLevel) r.srcHeadVert += "#endif".endl();

            if (attr.nameFrag)
            {
                r.srcHeadVert += "";
                if (!firstLevel) r.srcHeadVert += "#ifndef ATTRIB_" + attr.nameFrag.endl();
                r.srcHeadVert += "#define ATTRIB_" + attr.nameFrag.endl();
                r.srcHeadVert += "OUT " + attr.type + " " + attr.nameFrag + ";".endl();
                if (!firstLevel) r.srcHeadVert += "#endif".endl();

                r.srcVert = "".endl() + attr.nameFrag + "=" + attr.name + ";";

                r.srcHeadFrag = "";
                if (!firstLevel) r.srcHeadFrag += "#ifndef ATTRIB_" + attr.nameFrag.endl();
                r.srcHeadFrag += "#define ATTRIB_" + attr.nameFrag.endl();
                r.srcHeadFrag += "IN " + attr.type + " " + attr.nameFrag + ";".endl();
                if (!firstLevel) r.srcHeadFrag += "#endif".endl();
            }
        }
        return r;
    };

    compile()
    {
        if (this._cgl.aborted) return;
        const startTime = performance.now();



        this._cgl.profileData.profileShaderCompiles++;
        this._cgl.profileData.profileShaderCompileName = this._name + " [" + this._compileReason + "]";

        let extensionString = "";
        if (this._extensions)
            for (let i = 0; i < this._extensions.length; i++)
                extensionString += "#extension " + this._extensions[i] + " : enable".endl();

        let definesStr = "";
        if (this._defines.length) definesStr = "\n// cgl generated".endl();
        for (let i = 0; i < this._defines.length; i++)
            definesStr += "#define " + this._defines[i][0] + " " + this._defines[i][1] + "".endl();

        const structStrings = this.createStructUniforms();
        this._cgl.profileData.addHeavyEvent("shader compile", this._name + " [" + this._compileReason + "]");
        this._compileReason = "";



        if (this._uniforms)
        {
            // * we create an array of the uniform names to check our indices & an array to save them
            const uniNames = this._uniforms.map((uni) => { return uni._name; });
            const indicesToRemove = [];

            // * we go through our uniforms and check if the same name is contained somewhere further in the array
            // * if so, we add the current index to be removed later
            for (let i = 0; i < this._uniforms.length; i++)
            {
                const uni = this._uniforms[i];
                const nextIndex = uniNames.indexOf(uni._name, i + 1);
                if (nextIndex > -1) indicesToRemove.push(i);
            }

            // * after that, we go through the uniforms backwards (so we keep the order) and remove the indices
            // * also, we reset the locations of all the other valid uniforms
            for (let j = this._uniforms.length - 1; j >= 0; j -= 1)
            {
                if (indicesToRemove.includes(j)) this._uniforms.splice(j, 1);
                else this._uniforms[j].resetLoc();
            }
        }

        this._cgl.printError("uniform resets");

        if (this.hasTextureUniforms()) definesStr += "#define HAS_TEXTURES".endl();

        let vs = "";
        let fs = "";

        if (!this.srcFrag)
        {
            this._log.warn("[cgl shader] has no fragment source!", this._name, this);
            this.srcVert = getDefaultVertexShader();
            this.srcFrag = getDefaultFragmentShader();
            // return;
        }

        if (this.glslVersion == 300)
        {
            vs = "#version 300 es"
                .endl() + "// "
                .endl() + "// vertex shader " + this._name
                .endl() + "// "
                .endl() + "precision " + this.precision + " float;"
                .endl() + "precision " + this.precision + " sampler2D;"
                .endl() + ""
                .endl() + "#define WEBGL2"
                .endl() + "#define texture2D texture"
                .endl() + "#define UNI uniform"
                .endl() + "#define IN in"
                .endl() + "#define OUT out"
                .endl();

            fs = "#version 300 es"
                .endl() + "// "
                .endl() + "// fragment shader " + this._name
                .endl() + "// "
                .endl() + "precision " + this.precision + " float;"
                .endl() + "precision " + this.precision + " sampler2D;"
                .endl() + ""
                .endl() + "#define WEBGL2"
                .endl() + "#define texture2D texture"
                .endl() + "#define IN in"
                .endl() + "#define OUT out"
                .endl() + "#define UNI uniform"
                .endl() + "{{DRAWBUFFER}}"

                .endl();
        }
        else
        {
            fs = ""
                .endl() + "// "
                .endl() + "// fragment shader " + this._name
                .endl() + "// "
                .endl() + "#define WEBGL1"
                .endl() + "#define texture texture2D"
                .endl() + "#define outColor gl_FragColor"
                .endl() + "#define IN varying"
                .endl() + "#define UNI uniform"
                .endl();

            vs = ""
                .endl() + "// "
                .endl() + "// vertex shader " + this._name
                .endl() + "// "
                .endl() + "#define WEBGL1"
                .endl() + "#define texture texture2D"
                .endl() + "#define OUT varying"
                .endl() + "#define IN attribute"
                .endl() + "#define UNI uniform"
                .endl();
        }

        let uniformsStrVert = "\n// cgl generated".endl();
        let uniformsStrFrag = "\n// cgl generated".endl();


        fs += "\n// active mods: --------------- ";
        vs += "\n// active mods: --------------- ";

        let foundModsFrag = false;
        let foundModsVert = false;
        for (let i = 0; i < this._moduleNames.length; i++)
        {
            for (let j = 0; j < this._modules.length; j++)
            {
                if (this._modules[j].name == this._moduleNames[i])
                {
                    if (this._modules[j].srcBodyFrag || this._modules[j].srcHeadFrag)
                    {
                        foundModsFrag = true;
                        fs += "\n// " + i + "." + j + ". " + this._modules[j].title + " (" + this._modules[j].name + ")";
                    }
                    if (this._modules[j].srcBodyVert || this._modules[j].srcHeadVert)
                    {
                        vs += "\n// " + i + "." + j + ". " + this._modules[j].title + " (" + this._modules[j].name + ")";
                        foundModsVert = true;
                    }
                }
            }
        }
        if (!foundModsVert)fs += "\n// no mods used...";
        if (!foundModsFrag)fs += "\n// no mods used...";
        fs += "\n";
        vs += "\n";

        for (let i = 0; i < this._uniforms.length; i++)
        {
            if (this._uniforms[i].shaderType && !this._uniforms[i].isStructMember())
            {
                let uniStr = "";
                if (!this._uniforms[i].getGlslTypeString())uniStr += "// ";
                uniStr += "UNI " + this._uniforms[i].getGlslTypeString() + " " + this._uniforms[i].getName();
                let comment = "";
                if (this._uniforms[i].comment) comment = " // " + this._uniforms[i].comment;

                if (this._uniforms[i].shaderType == "vert" || this._uniforms[i].shaderType == "both")
                    if (!this.srcVert.contains(uniStr) && !this.srcVert.contains("uniform " + this._uniforms[i].getGlslTypeString() + " " + this._uniforms[i].getName()))
                        uniformsStrVert += uniStr + ";" + comment.endl();

                if (this._uniforms[i].shaderType == "frag" || this._uniforms[i].shaderType == "both")
                    if (!this.srcFrag.contains(uniStr) && !this.srcFrag.contains("uniform " + this._uniforms[i].getGlslTypeString() + " " + this._uniforms[i].getName()))
                        uniformsStrFrag += uniStr + ";" + comment.endl();
            }
        }


        let countUniFrag = 0;
        let countUniVert = 0;
        for (let i = 0; i < this._uniforms.length; i++)
        {
            if (this._uniforms[i].shaderType && !this._uniforms[i].isStructMember())
            {
                if (this._uniforms[i].shaderType == "vert" || this._uniforms[i].shaderType == "both") countUniVert++;
                if (this._uniforms[i].shaderType == "frag" || this._uniforms[i].shaderType == "both") countUniFrag++;
            }
        }
        if (countUniFrag >= this._cgl.maxUniformsFrag) this._log.warn("[cgl_shader] num uniforms frag: " + countUniFrag + " / " + this._cgl.maxUniformsFrag);
        if (countUniVert >= this._cgl.maxUniformsVert) this._log.warn("[cgl_shader] num uniforms vert: " + countUniVert + " / " + this._cgl.maxUniformsVert);


        if (!fs.contains("precision")) fs = "precision " + this.precision + " float;".endl() + fs;
        if (!vs.contains("precision")) vs = "precision " + this.precision + " float;".endl() + vs;
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))
        {
            fs += "#define MOBILE".endl();
            vs += "#define MOBILE".endl();
        }
        vs = extensionString + vs + definesStr + structStrings[0] + uniformsStrVert + "\n// -- \n" + this.srcVert;
        fs = extensionString + fs + definesStr + structStrings[1] + uniformsStrFrag + "\n// -- \n" + this.srcFrag;


        let srcHeadVert = "";
        let srcHeadFrag = "";

        // testing if this breaks things...
        // this._modules.sort(function (a, b)
        // {
        //     return a.group - b.group;
        // });

        this._modules.sort(function (a, b)
        {
            return a.priority || 0 - b.priority || 0;
        });


        let addedAttribs = false;

        for (let i = 0; i < this._moduleNames.length; i++)
        {
            let srcVert = "";
            let srcFrag = "";

            if (!addedAttribs)
            {
                addedAttribs = true;

                for (let k = 0; k < this._attributes.length; k++)
                {
                    const r = this._getAttrSrc(this._attributes[k], true);
                    if (r.srcHeadVert)srcHeadVert += r.srcHeadVert;
                    if (r.srcVert)srcVert += r.srcVert;
                    if (r.srcHeadFrag)srcHeadFrag += r.srcHeadFrag;
                }
            }

            for (let j = 0; j < this._modules.length; j++)
            {
                const mod = this._modules[j];
                if (mod.name == this._moduleNames[i])
                {
                    srcHeadVert += "\n//---- MOD: group:" + mod.group + ": idx:" + j + " - prfx:" + mod.prefix + " - " + mod.title + " ------\n";
                    srcHeadFrag += "\n//---- MOD: group:" + mod.group + ": idx:" + j + " - prfx:" + mod.prefix + " - " + mod.title + " ------\n";

                    srcVert += "\n\n//---- MOD: " + mod.title + " / " + mod.priority + " ------\n";
                    srcFrag += "\n\n//---- MOD: " + mod.title + " / " + mod.priority + " ------\n";

                    if (mod.attributes)
                        for (let k = 0; k < mod.attributes.length; k++)
                        {
                            const r = this._getAttrSrc(mod.attributes[k], false);
                            if (r.srcHeadVert)srcHeadVert += r.srcHeadVert;
                            if (r.srcVert)srcVert += r.srcVert;
                            if (r.srcHeadFrag)srcHeadFrag += r.srcHeadFrag;
                        }

                    srcHeadVert += mod.srcHeadVert || "";
                    srcHeadFrag += mod.srcHeadFrag || "";
                    srcVert += mod.srcBodyVert || "";
                    srcFrag += mod.srcBodyFrag || "";

                    srcHeadVert += "\n//---- end mod ------\n";
                    srcHeadFrag += "\n//---- end mod ------\n";

                    srcVert += "\n//---- end mod ------\n";
                    srcFrag += "\n//---- end mod ------\n";

                    srcVert = srcVert.replace(/{{mod}}/g, mod.prefix);
                    srcFrag = srcFrag.replace(/{{mod}}/g, mod.prefix);
                    srcHeadVert = srcHeadVert.replace(/{{mod}}/g, mod.prefix);
                    srcHeadFrag = srcHeadFrag.replace(/{{mod}}/g, mod.prefix);

                    srcVert = srcVert.replace(/MOD_/g, mod.prefix);
                    srcFrag = srcFrag.replace(/MOD_/g, mod.prefix);
                    srcHeadVert = srcHeadVert.replace(/MOD_/g, mod.prefix);
                    srcHeadFrag = srcHeadFrag.replace(/MOD_/g, mod.prefix);
                }
            }


            vs = vs.replace("{{" + this._moduleNames[i] + "}}", srcVert);
            fs = fs.replace("{{" + this._moduleNames[i] + "}}", srcFrag);
        }


        vs = vs.replace("{{MODULES_HEAD}}", srcHeadVert);
        fs = fs.replace("{{MODULES_HEAD}}", srcHeadFrag);


        vs = this._addLibs(vs);
        fs = this._addLibs(fs);


        // SETUP draw buffers / multi texture render targets

        let drawBufferStr = "";
        for (let i = 0; i < 16; i++)
            if (fs.contains("outColor" + i)) this._drawBuffers[i] = true;

        if (this._drawBuffers.length == 1)
        {
            drawBufferStr = "out vec4 outColor;".endl();
            drawBufferStr += "#define gl_FragColor outColor".endl();
        }
        else
        {
            drawBufferStr += "#define MULTI_COLORTARGETS".endl();
            drawBufferStr += "vec4 outColor;".endl();

            let count = 0;
            for (let i = 0; i < this._drawBuffers.length; i++)
            {
                if (count == 0) drawBufferStr += "#define gl_FragColor outColor" + i + "".endl();
                drawBufferStr += "layout(location = " + i + ") out vec4 outColor" + i + ";".endl();
                count++;
            }
        }

        fs = fs.replace("{{DRAWBUFFER}}", drawBufferStr);
        // //////


        if (!this._program)
        {
            this._program = this._createProgram(vs, fs);
        }
        else
        {
            // this.vshader=createShader(vs, gl.VERTEX_SHADER, this.vshader );
            // this.fshader=createShader(fs, gl.FRAGMENT_SHADER, this.fshader );
            // linkProgram(program);
            this._program = this._createProgram(vs, fs);

            this._projMatrixUniform = null;

            for (let i = 0; i < this._uniforms.length; i++) this._uniforms[i].resetLoc();
        }

        this.finalShaderFrag = fs;
        this.finalShaderVert = vs;


        MESH.lastMesh = null;
        MESH.lastShader = null;

        this._countMissingUniforms = 0;
        this._needsRecompile = false;
        this.lastCompile = now();

        // this._cgl.printError("shader compile");

        this._cgl.profileData.shaderCompileTime += performance.now() - startTime;
    };

    hasChanged()
    {
        return this._needsRecompile;
    }


    bind()
    {
        if (!this._isValid || this._cgl.aborted) return;

        MESH.lastShader = this;

        if (!this._program || this._needsRecompile) this.compile();
        if (!this._isValid) return;

        if (!this._projMatrixUniform && !this.ignoreMissingUniforms)
        {
            this._countMissingUniforms++;
            // if (this._countMissingUniforms == 10)console.log("stopping getlocation of missing uniforms...", this._name);
            if (this._countMissingUniforms < 10)
            {
                this._projMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_PROJMAT);
                this._attrVertexPos = this._cgl.glGetAttribLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_VERTEX_POSITION);
                this._mvMatrixUniform = this._cgl.gl.getUniformLocation(this._program, "mvMatrix");
                this._vMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_VIEWMAT);
                this._mMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_MODELMAT);
                this._camPosUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_VIEWPOS);
                this._normalMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_NORMALMAT);
                this._inverseViewMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_INVVIEWMAT);
                this._inverseProjMatrixUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_INVPROJMAT);
                this._materialIdUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_MATERIALID);
                this._objectIdUniform = this._cgl.gl.getUniformLocation(this._program, constants_CONSTANTS.SHADER.SHADERVAR_UNI_OBJECTID);

                for (let i = 0; i < this._uniforms.length; i++) this._uniforms[i].needsUpdate = true;
            }
        }


        if (this._cgl.currentProgram != this._program)
        {
            this._cgl.profileData.profileShaderBinds++;
            this._cgl.gl.useProgram(this._program);
            this._cgl.currentProgram = this._program;
        }

        for (let i = 0; i < this._uniforms.length; i++)
            if (this._uniforms[i].needsUpdate) this._uniforms[i].updateValue();

        if (this._pMatrixState != this._cgl.getProjectionMatrixStateCount())
        {
            this._pMatrixState = this._cgl.getProjectionMatrixStateCount();
            this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform, false, this._cgl.pMatrix);
            this._cgl.profileData.profileMVPMatrixCount++;
        }

        if (this._objectIdUniform)
            this._cgl.gl.uniform1f(this._objectIdUniform, ++this._cgl.tempData.objectIdCounter);

        if (this._materialIdUniform)
            this._cgl.gl.uniform1f(this._materialIdUniform, this._materialId);

        if (this._vMatrixUniform)
        {
            if (this._vMatrixState != this._cgl.getViewMatrixStateCount())
            {
                this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform, false, this._cgl.vMatrix);
                this._cgl.profileData.profileMVPMatrixCount++;
                this._vMatrixState = this._cgl.getViewMatrixStateCount();

                if (this._inverseViewMatrixUniform)
                {
                    mat4.invert(this._tempInverseViewMatrix, this._cgl.vMatrix);
                    this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform, false, this._tempInverseViewMatrix);
                    this._cgl.profileData.profileMVPMatrixCount++;
                }
                if (this._inverseProjMatrixUniform)
                {
                    mat4.invert(this._tempInverseProjMatrix, this._cgl.pMatrix);
                    this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform, false, this._tempInverseProjMatrix);
                    this._cgl.profileData.profileMVPMatrixCount++;
                }
            }
            this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform, false, this._cgl.mMatrix);
            this._cgl.profileData.profileMVPMatrixCount++;

            if (this._camPosUniform)
            {
                mat4.invert(this._tempCamPosMatrix, this._cgl.vMatrix);
                this._cgl.gl.uniform3f(this._camPosUniform, this._tempCamPosMatrix[12], this._tempCamPosMatrix[13], this._tempCamPosMatrix[14]);
                this._cgl.profileData.profileMVPMatrixCount++;
            }
        }
        else
        {
            // mvmatrix deprecated....
            const tempmv = mat4.create();

            mat4.mul(tempmv, this._cgl.vMatrix, this._cgl.mMatrix);
            this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform, false, tempmv);
            this._cgl.profileData.profileMVPMatrixCount++;
        }

        if (this._normalMatrixUniform)
        {
            // mat4.mul(this._tempNormalMatrix, this._cgl.vMatrix, this._cgl.mMatrix);
            mat4.invert(this._tempNormalMatrix, this._cgl.mMatrix);
            mat4.transpose(this._tempNormalMatrix, this._tempNormalMatrix);

            this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform, false, this._tempNormalMatrix);
            this._cgl.profileData.profileMVPMatrixCount++;
        }

        for (let i = 0; i < this._libs.length; i++)
        {
            if (this._libs[i].onBind) this._libs[i].onBind.bind(this._libs[i])(this._cgl, this);
        }

        this._bindTextures();

        return this._isValid;
    };

    unBind()
    {
    };


    dispose()
    {
        this._cgl.gl.deleteProgram(this._program);
    };

    needsRecompile()
    {
        return this._needsRecompile;
    };

    setDrawBuffers(arr)
    {
        console.log("useless drawbuffers...?!");
        // if (this._drawBuffers.length !== arr.length)
        // {
        //     this._drawBuffers = arr;
        //     this._needsRecompile = true;
        //     this.setWhyCompile("setDrawBuffers");
        //     return;
        // }
        // for (let i = 0; i < arr.length; i++)
        // {
        //     if (arr[i] !== this._drawBuffers[i])
        //     {
        //         this._drawBuffers = arr;
        //         this._needsRecompile = true;
        //         this.setWhyCompile("setDrawBuffers");
        //         return;
        //     }
        // }
    };

    getUniforms()
    {
        return this._uniforms;
    };

    getUniform(name)
    {
        for (let i = 0; i < this._uniforms.length; i++)
            if (this._uniforms[i].getName() == name)
                return this._uniforms[i];
        return null;
    };

    removeAllUniforms()
    {
        this._uniforms = [];
        // for (let i = 0; i < this._uniforms.length; i++)
        //     this.removeUniform(this._uniforms[i].name);
    };

    removeUniform(name)
    {
        for (let i = 0; i < this._uniforms.length; i++)
        {
            if (this._uniforms[i].getName() == name)
            {
                this._uniforms.splice(i, 1);
            }
        }
        this._needsRecompile = true;
        this.setWhyCompile("remove uniform " + name);
    };


    _addUniform(uni)
    {
        this._uniforms.push(uni);
        this.setWhyCompile("add uniform " + name);
        this._needsRecompile = true;
    };

    /**
     * add a uniform to the fragment shader
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniformFrag
     * @returns {CGL.Uniform}
     */
    addUniformFrag(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new CGL.Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "frag";
        return uni;
    };

    /**
     * add a uniform to the vertex shader
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniformVert
     * @returns {CGL.Uniform}
     */
    addUniformVert(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new CGL.Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "vert";
        return uni;
    };
    /**
     * add a uniform to both shaders
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniformBoth
     * @returns {CGL.Uniform}
     */
    addUniformBoth(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new CGL.Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "both";
        return uni;
    };

    /**
     * add a struct & its uniforms to the fragment shader
     * @param {String} structName name of the struct, i.e.: LightStruct
     * @param {String} uniformName name of the struct uniform in the shader, i.e.: lightUni
     * @param {Array} members array of objects containing the struct members. see example for structure

     * @memberof Shader
     * @instance
     * @function addUniformStructFrag
     * @returns {Object}
     * @example
     * const shader = new CGL.Shader(cgl, 'MinimalMaterial');
     * shader.setSource(attachments.shader_vert, attachments.shader_frag);
     * shader.addUniformStructFrag("Light", "uniformLight", [
     * { "type": "3f", "name": "position", "v1": null },
     * { "type": "4f", "name": "color", "v1": inR, v2: inG, v3: inB, v4: inAlpha }
     * ]);
     */
    addUniformStructFrag(structName, uniformName, members)
    {
        const uniforms = {};

        if (!members) return uniforms;

        for (let i = 0; i < members.length; i += 1)
        {
            const member = members[i];
            if (!this.hasUniform(uniformName + "." + member.name))
            {
                const uni = new CGL.Uniform(this, member.type, uniformName + "." + member.name, member.v1, member.v2, member.v3, member.v4, uniformName, structName, member.name);
                uni.shaderType = "frag";
                uniforms[uniformName + "." + member.name] = uni;
            }
        }

        return uniforms;
    };

    /**
     * add a struct & its uniforms to the vertex shader
     * @param {String} structName name of the struct, i.e.: LightStruct
     * @param {String} uniformName name of the struct uniform in the shader, i.e.: lightUni
     * @param {Array} members array of objects containing the struct members. see example for structure

     * @memberof Shader
     * @instance
     * @function addUniformStructVert
     * @returns {CGL.Uniform}
     * @example
     * const shader = new CGL.Shader(cgl, 'MinimalMaterial');
     * shader.setSource(attachments.shader_vert, attachments.shader_frag);
     * shader.addUniformStructVert("Light", "uniformLight", [
     * { "type": "3f", "name": "position", "v1": null },
     * { "type": "4f", "name": "color", "v1": inR, v2: inG, v3: inB, v4: inAlpha }
     * ]);
     */
    addUniformStructVert(structName, uniformName, members)
    {
        const uniforms = {};

        if (!members) return uniforms;

        for (let i = 0; i < members.length; i += 1)
        {
            const member = members[i];
            if (!this.hasUniform(uniformName + "." + member.name))
            {
                const uni = new CGL.Uniform(this, member.type, uniformName + "." + member.name, member.v1, member.v2, member.v3, member.v4, uniformName, structName, member.name);
                uni.shaderType = "vert";
                uniforms[uniformName + "." + member.name] = uni;
            }
        }

        return uniforms;
    };

    /**
     * add a struct & its uniforms to the both shaders. PLEASE NOTE: it is not possible to add the same struct to both shaders when it contains ANY integer members.
     * @param {String} structName name of the struct, i.e.: LightStruct
     * @param {String} uniformName name of the struct uniform in the shader, i.e.: lightUni
     * @param {Array} members array of objects containing the struct members. see example for structure

     * @memberof Shader
     * @instance
     * @function addUniformStructBoth
     * @returns {Object}
     * @example
     * const shader = new CGL.Shader(cgl, 'MinimalMaterial');
     * shader.setSource(attachments.shader_vert, attachments.shader_frag);
     * shader.addUniformStructBoth("Light", "uniformLight", [
     * { "type": "3f", "name": "position", "v1": null },
     * { "type": "4f", "name": "color", "v1": inR, v2: inG, v3: inB, v4: inAlpha }
     * ]);
     */
    addUniformStructBoth(structName, uniformName, members)
    {
        const uniforms = {};

        if (!members) return uniforms;

        for (let i = 0; i < members.length; i += 1)
        {
            const member = members[i];
            if ((member.type === "2i" || member.type === "i" || member.type === "3i"))
                this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:", structName, " with member:", member.name, " of type:", member.type, ".");
            if (!this.hasUniform(uniformName + "." + member.name))
            {
                const uni = new CGL.Uniform(this, member.type, uniformName + "." + member.name, member.v1, member.v2, member.v3, member.v4, uniformName, structName, member.name);
                uni.shaderType = "both";
                uniforms[uniformName + "." + member.name] = uni;
            }
        }

        return uniforms;
    };

    hasUniform(name)
    {
        for (let i = 0; i < this._uniforms.length; i++)
        {
            if (this._uniforms[i].getName() == name) return true;
        }
        return false;
    };

    _createProgram(vstr, fstr)
    {
        this._cgl.printError("before _createprogram");

        const program = this._cgl.gl.createProgram();

        this.vshader = Shader.createShader(this._cgl, vstr, this._cgl.gl.VERTEX_SHADER, this);
        this.fshader = Shader.createShader(this._cgl, fstr, this._cgl.gl.FRAGMENT_SHADER, this);


        if (this.vshader && this.fshader)
        {
            this._cgl.gl.attachShader(program, this.vshader);
            this._cgl.gl.attachShader(program, this.fshader);

            this._linkProgram(program, vstr, fstr);
        }
        else
        {
            this._isValid = false;
            this._cgl.printError("shader _createProgram");
            this._log.error("could not link shaderprogram");
            return null;
        }

        this._cgl.printError("shader _createProgram");
        return program;
    };

    hasErrors()
    {
        return this._hasErrors;
    };

    _linkProgram(program, vstr, fstr)
    {
        this._cgl.printError("before _linkprogram");

        if (this._feedBackNames.length > 0)
        {
            this._cgl.gl.transformFeedbackVaryings(program, this._feedBackNames, this._cgl.gl.SEPARATE_ATTRIBS);
            // INTERLEAVED_ATTRIBS
            // SEPARATE_ATTRIBS
        }

        this._cgl.gl.linkProgram(program);
        this._cgl.printError("gl.linkprogram");
        this._isValid = true;

        this._hasErrors = false;

        if (this._cgl.patch.config.glValidateShader !== false)
        {
            this._cgl.gl.validateProgram(program);

            if (!this._cgl.gl.getProgramParameter(program, this._cgl.gl.VALIDATE_STATUS))
            {
                // validation failed
                console.log("shaderprogram validation failed...");
                console.log(this._name + " programinfo: ", this._cgl.gl.getProgramInfoLog(program));
            }

            if (!this._cgl.gl.getProgramParameter(program, this._cgl.gl.LINK_STATUS))
            {
                this._hasErrors = true;

                const infoLogFrag = this._cgl.gl.getShaderInfoLog(this.fshader);
                const infoLogVert = this._cgl.gl.getShaderInfoLog(this.vshader);

                if (infoLogFrag) this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));
                if (infoLogVert) this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));

                this._log.error(this._name + " shader linking fail...");

                console.log(this._name + " programinfo: ", this._cgl.gl.getProgramInfoLog(program));
                console.log(this);
                this._isValid = false;

                this._name = "errorshader";
                this.setSource(Shader.getDefaultVertexShader(), Shader.getErrorFragmentShader());
                this._cgl.printError("shader link err");
            }
        }
    };

    getProgram()
    {
        return this._program;
    };

    setFeedbackNames(names)
    {
        this.setWhyCompile("setFeedbackNames");
        this._needsRecompile = true;
        this._feedBackNames = names;
    };

    // getDefaultVertexShader()
    // {
    //     return defaultShaderSrcVert;
    // }

    // getDefaultFragmentShader()
    // {
    //     return this.getDefaultFragmentShader()
    // }


    /**
      * adds attribute definition to shader header without colliding with other shader modules...
     * when attrFrag is defined, vertex shader will output this attribute to the fragment shader
     * @function
     * @memberof Shader
     * @instance
     * @param {Object} attr {type:x,name:x,[nameFrag:x]}
     * @return {Object}
     */
    addAttribute = function (attr)
    {
        for (let i = 0; i < this._attributes.length; i++)
        {
            if (this._attributes[i].name == attr.name && this._attributes[i].nameFrag == attr.nameFrag) return;
        }
        this._attributes.push(attr);
        this._needsRecompile = true;
        this.setWhyCompile("addAttribute");
    };

    bindTextures()
    {
        this._bindTextures();
    }
    _bindTextures()
    {
        if (this._textureStackTex.length > this._cgl.maxTextureUnits)
        {
            this._log.warn("[shader._bindTextures] too many textures bound", this._textureStackTex.length + "/" + this._cgl.maxTextureUnits);
        }

        // for (let i = this._textureStackTex.length + 1; i < this._cgl.maxTextureUnits; i++) this._cgl.setTexture(i, null);

        for (let i = 0; i < this._textureStackTex.length; i++)
        {
            // console.log(this._textureStackTex.length, i);
            if (!this._textureStackTex[i] && !this._textureStackTexCgl[i])
            {
                this._log.warn("no texture for pushtexture", this._name);
            }
            else
            {
                let t = this._textureStackTex[i];
                if (this._textureStackTexCgl[i])
                {
                    t = this._textureStackTexCgl[i].tex || CGL.Texture.getEmptyTexture(this._cgl).tex;
                }

                let bindOk = true;

                if (!this._textureStackUni[i])
                {
                    // throw(new Error('no uniform given to texturestack'));
                    this._log.warn("no uniform for pushtexture", this._name);
                    bindOk = this._cgl.setTexture(i, t, this._textureStackType[i]);
                }
                else
                {
                    this._textureStackUni[i].setValue(i);
                    bindOk = this._cgl.setTexture(i, t, this._textureStackType[i]);

                    // console.log(bindOk, i, t, this._textureStackType[i]);
                }
                if (!bindOk) console.warn("tex bind failed", this.getName(), this._textureStackUni[i]);
            }
        }
    };

    setUniformTexture = function (uni, tex)
    {
        tex = tex || CGL.Texture.getTempTexture(this._cgl);
        for (let i = 0; i < this._textureStackUni.length; i++)
            if (this._textureStackUni[i] == uni)
            {
                const old = this._textureStackTex[i] || this._textureStackTexCgl[i];
                if (tex.hasOwnProperty("tex"))
                {
                    this._textureStackTexCgl[i] = tex;
                    this._textureStackTex[i] = null;
                }
                else
                {
                    this._textureStackTexCgl[i] = null;
                    this._textureStackTex[i] = tex;
                }

                // this._textureStackTex[i] = tex;
                // this._cgl.setTexture(i, tex, this._textureStackType[i]);
                return old;
            }
        return null;
    };

    /**
     * push a texture on the stack. those textures will be bound when binding the shader. texture slots are automatically set
     * @param {uniform} uniform texture uniform
     * @param {texture} t texture
     * @param {type} type texture type, can be ignored when TEXTURE_2D
     * @function pushTexture
     * @memberof Shader
     * @instance
     */
    pushTexture = function (uniform, t, type)
    {
        if (!uniform)
        {
            // console.log("pushtexture: no uniform given to texturestack", "shader:"+this._name,uniform,t,type);
            return;
        }
        if (!t)
        {
            // if(uniform)this._log.warn("pushtexture: no tex","shader:"+this._name," uniform:"+uniform.name);
            return;
        }
        if (!t.hasOwnProperty("tex") && !(t instanceof WebGLTexture))
        {
            this._log.warn(new Error("invalid texture").stack);

            this._log.warn("[cgl_shader] invalid texture...", t);
            return;
        }

        this._textureStackUni.push(uniform);

        if (t.hasOwnProperty("tex"))
        {
            this._textureStackTexCgl.push(t);
            this._textureStackTex.push(null);
        }
        else
        {
            this._textureStackTexCgl.push(null);
            this._textureStackTex.push(t);
        }

        this._textureStackType.push(type);
    };

    /**
     * pop last texture
     * @function popTexture
     * @memberof Shader
     * @instance
     */
    popTexture = function ()
    {
        this._textureStackUni.pop();
        this._textureStackTex.pop();
        this._textureStackTexCgl.pop();
        this._textureStackType.pop();
    };

    /**
     * pop all textures
     * @function popTextures
     * @memberof Shader
     * @instance
     */
    popTextures = function ()
    {
        this._textureStackTex.length =
        this._textureStackTexCgl.length =
        this._textureStackType.length =
        this._textureStackUni.length = 0;
    };

    getMaterialId()
    {
        return this._materialId;
    };

    getInfo()
    {
        const info = {};
        info.name = this._name;
        // info.modules = JSON.parse(JSON.stringify(this._modules));
        // info.defines = JSON.parse(JSON.stringify(this._defines));
        info.defines = this.getDefines();
        info.hasErrors = this.hasErrors();

        return info;
    };


    getDefaultFragmentShader=function(r,g,b,a)
    {
        return getDefaultFragmentShader(r,g,b,a);
    }

    getDefaultVertexShader=function()
    {
        return getDefaultVertexShader();
    }


}

























// --------------------------

Shader.getDefaultVertexShader=getDefaultVertexShader;
Shader.getDefaultFragmentShader=getDefaultFragmentShader;


Shader.getErrorFragmentShader = function ()
{
    return ""
        .endl() + "void main()"
        .endl() + "{"
        .endl() + "   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"
        .endl() + "   g= step(0.1,g);"
        .endl() + "   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"
        .endl() + "}";
};

Shader.createShader = function (cgl, str, type, cglShader)
{
    if (cgl.aborted) return;

    // cgl.printError("[Shader.createShader] ", cglShader._name);

    function getBadLines(infoLog)
    {
        const basLines = [];
        const lines = infoLog.split("\n");
        for (const i in lines)
        {
            const divide = lines[i].split(":");
            if (parseInt(divide[2], 10)) basLines.push(parseInt(divide[2], 10));
        }
        return basLines;
    }


    const shader = cgl.gl.createShader(type);
    cgl.gl.shaderSource(shader, str);
    cgl.gl.compileShader(shader);

    if (!cgl.gl.getShaderParameter(shader, cgl.gl.COMPILE_STATUS))
    {
        let infoLog = cgl.gl.getShaderInfoLog(shader);
        if (!infoLog)
        {
            console.warn("empty shader info log", this._name);
            return;
        }


        const badLines = getBadLines(infoLog);
        let htmlWarning = "<pre style=\"margin-bottom:0px;\"><code class=\"shaderErrorCode language-glsl\" style=\"padding-bottom:0px;max-height: initial;max-width: initial;\">";
        const lines = str.match(/^.*((\r\n|\n|\r)|$)/gm);

        if (!cgl.aborted && infoLog)
        {
            if (type == cgl.gl.VERTEX_SHADER) console.log("VERTEX_SHADER");
            if (type == cgl.gl.FRAGMENT_SHADER) console.log("FRAGMENT_SHADER");

            for (const i in lines)
            {
                const j = parseInt(i, 10) + 1;
                const line = j + ": " + lines[i];

                let isBadLine = false;
                for (const bj in badLines)
                    if (badLines[bj] == j) isBadLine = true;

                if (isBadLine)
                {
                    htmlWarning += "</code></pre>";
                    htmlWarning += "<pre style=\"margin:0\"><code class=\"language-glsl\" style=\"background-color:#660000;padding-top:0px;padding-bottom:0px\">";

                    cglShader._log.log("bad line: `" + line + "`");
                }
                htmlWarning += escapeHTML(line);

                if (isBadLine)
                {
                    htmlWarning += "</code></pre>";
                    htmlWarning += "<pre style=\"margin:0\"><code class=\"language-glsl\" style=\";padding-top:0px;padding-bottom:0px\">";
                }
            }
        }

        infoLog = infoLog.replace(/\n/g, "<br/>");
        if (cgl.patch.isEditorMode())console.log("Shader error ", cglShader._name, infoLog, this);

        htmlWarning = infoLog + "<br/>" + htmlWarning + "<br/><br/>";
        htmlWarning += "</code></pre>";

        if (this._fromUserInteraction)
        {
            // console.log("todo show modal?");
            // cgl.patch.emitEvent("criticalError", { "title": "Shader error " + cglShader._name, "text": htmlWarning, "exception": { "message": infoLog } });
        }

        cglShader.setSource(Shader.getDefaultVertexShader(), Shader.getErrorFragmentShader());
    }
    else
    {
        // console.log(name+' shader compiled...');
    }
    // cgl.printError("shader create2");
    return shader;
};













;// CONCATENATED MODULE: ./src/core/cgl/cgl_profiledata.js
class ProfileData
{
    constructor(cgl)
    {
        this._cgl = cgl;
        this._lastTime = 0;
        this.pause = false;
        this.profileUniformCount = 0;
        this.profileShaderBinds = 0;
        this.profileUniformCount = 0;
        this.profileShaderCompiles = 0;
        this.profileVideosPlaying = 0;
        this.profileMVPMatrixCount = 0;
        this.profileEffectBuffercreate = 0;
        this.profileShaderGetUniform = 0;
        this.profileFrameBuffercreate = 0;
        this.profileMeshSetGeom = 0;
        this.profileTextureNew = 0;
        this.profileGenMipMap = 0;
        this.profileOnAnimFrameOps = 0;

        this.profileFencedPixelRead = 0;
        this.profileMainloopMs = 0;
        this.profileMeshDraw = 0;
        this.profileTextureEffect = 0;
        this.profileTexPreviews = 0;
        this.shaderCompileTime = 0;
        this.profileMeshNumElements = 0;
        this.profileMeshAttributes = 0;
        this.profileSingleMeshAttribute = [];
        this.heavyEvents = [];

        this.doProfileGlQuery = false;
        this.glQueryData = {};
    }

    clear()
    {
        this.profileSingleMeshAttribute = {};
        this.profileMeshAttributes = 0;
        this.profileUniformCount = 0;
        this.profileShaderGetUniform = 0;
        this.profileShaderCompiles = 0;
        this.profileShaderBinds = 0;
        this.profileTextureResize = 0;
        this.profileFrameBuffercreate = 0;
        this.profileEffectBuffercreate = 0;
        this.profileTextureDelete = 0;
        this.profileMeshSetGeom = 0;
        this.profileVideosPlaying = 0;
        this.profileMVPMatrixCount = 0;
        this.profileNonTypedAttrib = 0;
        this.profileNonTypedAttribNames = "";
        this.profileTextureNew = 0;
        this.profileGenMipMap = 0;
        this.profileFramebuffer = 0;
        this.profileMeshDraw = 0;
        this.profileTextureEffect = 0;
        this.profileTexPreviews = 0;
        this.profileMeshNumElements = 0;
        this.profileFencedPixelRead = 0;
    }

    clearGlQuery()
    {
        for (let i in this.glQueryData)
        {
            if (!this.glQueryData[i].lastClear || performance.now() - this.glQueryData[i].lastClear > 1000)
            {
                this.glQueryData[i].time = this.glQueryData[i]._times / this.glQueryData[i]._numcount;
                this.glQueryData[i].num = this.glQueryData[i]._numcount;

                this.glQueryData[i]._times = 0;
                this.glQueryData[i]._numcount = 0;
                this.glQueryData[i].lastClear = performance.now();
            }
        }
    }

    addHeavyEvent(event, name, info)
    {
        const e = { "event": event, "name": name, "info": info, "date": performance.now() };
        this.heavyEvents.push(e);
        this._cgl.emitEvent("heavyEvent", e);
    }
}




;// CONCATENATED MODULE: ../shared/client/src/helper.js
/**
 * Shared helper methods for cables uis
 */
class Helper
{
    constructor()
    {
        this._simpleIdCounter = 0;
    }


    /**
     * generate a random v4 uuid
     *
     * @return {string}
     */
    uuid()
    {
        let d = new Date().getTime();
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) =>
        {
            const r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c === "x" ? r : (r & 0x3) | 0x8).toString(16);
        });
    }

    /**
     * checks value for !isNan and isFinite
     *
     * @param n
     * @return {boolean}
     */
    isNumeric(n)
    {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }

    /**
     * generate a simple ID using an internal counter
     *
     * @return {Number} new id
     * @static
     */
    simpleId()
    {
        this._simpleIdCounter++;
        return this._simpleIdCounter;
    }

    deletePropertyByPath(obj, path)
    {
        if (!obj || !path)
        {
            return;
        }

        if (typeof path === "string")
        {
            path = path.split(".");
        }

        for (let i = 0; i < path.length - 1; i++)
        {
            obj = obj[path[i]];

            if (typeof obj === "undefined")
            {
                return;
            }
        }

        delete obj[path.pop()];
    }
}
/* harmony default export */ const helper = (new Helper());

;// CONCATENATED MODULE: ../shared/client/src/eventtarget.js



/**
 * add eventlistener functionality to classes
 */
class Events
{
    constructor()
    {
        this._log = new Logger("eventtarget");
        this._eventCallbacks = {};
        this._logName = "";
        this._logEvents = false;
        this._listeners = {};

        this.on = this.addEventListener;
        this.off = this.removeEventListener;
    }

    /**
     * add event listener
     * @param which event name
     * @param cb callback
     * @param {string} idPrefix prefix for id, default empty
     * @return {string} event id
     */
    addEventListener(which, cb, idPrefix = "")
    {
        const event =
            {
                "id": (idPrefix || "") + helper.simpleId(),
                "name": which,
                "cb": cb,
            };
        if (!this._eventCallbacks[which]) this._eventCallbacks[which] = [event];
        else this._eventCallbacks[which].push(event);

        this._listeners[event.id] = event;

        return event.id;
    }

    /**
     * check event listener registration
     * @param id event id
     * @param cb callback - deprecated
     * @return {boolean}
     */
    hasEventListener(id, cb = null)
    {
        if (id && !cb)
        {
            // check by id
            return !!this._listeners[id];
        }
        else
        {
            this._log.warn("old eventtarget function haseventlistener!");
            if (id && cb)
            {
                if (this._eventCallbacks[id])
                {
                    const idx = this._eventCallbacks[id].indexOf(cb);
                    return idx !== -1;
                }
            }
        }
    }

    /**
     * check event listener by name
     * @param eventName event name
     * @return {boolean}
     */
    hasListenerForEventName(eventName)
    {
        return this._eventCallbacks[eventName] && this._eventCallbacks[eventName].length > 0;
    }

    /**
     * rempve event listener registration
     * @param id event id
     * @param cb callback - deprecated
     * @return
     */
    removeEventListener(id, cb = null)
    {
        if (id === null || id === undefined) return;

        if (!cb) // new style, remove by id, not by name/callback
        {
            const event = this._listeners[id];
            if (!event)
            {
                this._log.log("could not find event...", id, this);
                return;
            }

            let found = true;
            while (found)
            {
                found = false;
                let index = -1;
                for (let i = 0; i < this._eventCallbacks[event.name].length; i++)
                {
                    if (this._eventCallbacks[event.name][i].id.indexOf(id) === 0) // this._eventCallbacks[event.name][i].id == which ||
                    {
                        found = true;
                        index = i;
                    }
                }

                if (index !== -1)
                {
                    this._eventCallbacks[event.name].splice(index, 1);
                    delete this._listeners[id];
                }
            }

            return;
        }

        this._log.info("[eventtaget] ", "old function signature: removeEventListener! use listener id");
        this._log.log((new Error()).stack);

        let index = null;
        for (let i = 0; i < this._eventCallbacks[id].length; i++)
            if (this._eventCallbacks[id][i].cb === cb)
                index = i;

        if (index !== null)
        {
            delete this._eventCallbacks[index];
        }
        else this._log.warn("removeEventListener not found " + id);
    }

    /**
     * enable/disable logging of events for the class
     *
     * @param {boolean} enabled
     * @param {string} logName
     */
    logEvents(enabled, logName)
    {
        this._logEvents = enabled;
        this._logName = logName;
    }

    /**
     * emit event
     *
     * @param {string} which event name
     * @param {*} param1
     * @param {*} param2
     * @param {*} param3
     * @param {*} param4
     * @param {*} param5
     * @param {*} param6
     */
    emitEvent(which, param1 = null, param2 = null, param3 = null, param4 = null, param5 = null, param6 = null)
    {
        if (this._logEvents) this._log.log("[event] ", this._logName, which, this._eventCallbacks);

        if (this._eventCallbacks[which])
        {
            for (let i = 0; i < this._eventCallbacks[which].length; i++)
            {
                if (this._eventCallbacks[which][i])
                {
                    this._eventCallbacks[which][i].cb(param1, param2, param3, param4, param5, param6);
                }
            }
        }
        else
        {
            if (this._logEvents) this._log.log("[event] has no event callback", which, this._eventCallbacks);
        }
    }
}


;// CONCATENATED MODULE: ./src/core/cg/cg_canvas.js
class CgCanvas
{
    constructor(options)
    {
        if (!options)
        {
            console.error("CgCanvas no options");
        }
        else
        {
            this._canvasEle = options.canvasEle;
        }

        if (!options.cg)console.error("CgCanvas options has no cg");
        if (!options.canvasEle)console.error("CgCanvas options has no canvasEle");

        this._cg = options.cg;
        this.pixelDensity = 1;
        this.canvasWidth = this.canvasEle.clientWidth;
        this.canvasHeight = this.canvasEle.clientHeight;

        this._oldWidthRp = -1;
        this._oldHeightRp = -1;

        this.setSize(this.canvasWidth, this.canvasHeight);
    }

    get canvasEle() { return this._canvasEle; }


    setSize(w, h, ignorestyle)
    {
        if (this._oldWidthRp != w * this.pixelDensity || this._oldHeightRp != h * this.pixelDensity)
        {
            this._oldWidthRp = this.canvasEle.width = w * this.pixelDensity;
            this._oldHeightRp = this.canvasEle.height = h * this.pixelDensity;

            if (!ignorestyle)
            {
                this.canvasEle.style.width = w + "px";
                this.canvasEle.style.height = h + "px";
            }

            this.updateSize();

            this._cg.emitEvent("resize");
        }
    }

    updateSize()
    {
        this.canvasEle.width = this.canvasWidth = this.canvasEle.clientWidth * this.pixelDensity;
        this.canvasEle.height = this.canvasHeight = this.canvasEle.clientHeight * this.pixelDensity;
    }

    dispose()
    {
        this._canvasEle.remove();
        this._canvasEle = null;
    }
}



;// CONCATENATED MODULE: ./src/core/cg/cg_matrixstack.js

const MatrixStack = function ()
{
    this._arr = [mat4.create()];
    this._index = 0;
    this.stateCounter = 0;
};

MatrixStack.prototype.push = function (m)
{
    this._index++;
    this.stateCounter++;

    if (this._index == this._arr.length)
    {
        const copy = mat4.create();
        this._arr.push(copy);
    }

    mat4.copy(this._arr[this._index], m || this._arr[this._index - 1]);

    return this._arr[this._index];
};

MatrixStack.prototype.pop = function ()
{
    this.stateCounter++;

    this._index--;
    if (this._index < 0) this._index = 0;

    return this._arr[this._index];
};

MatrixStack.prototype.length = function ()
{
    return this._index;
};



;// CONCATENATED MODULE: ./src/core/cg/cg_state.js




class CGState extends Events
{
    constructor(_patch)
    {
        super();
        this.tempData = this.frameStore = this.frameStore || {};
        // this.canvas = null;

        this.fpsCounter = new CABLES.CG.FpsCounter();
        this._identView = vec3.create();
        this._ident = vec3.create();
        vec3.set(this._identView, 0, 0, -2);
        vec3.set(this._ident, 0, 0, 0);

        this.patch = _patch;
        this.autoReSize = true;

        this.DEPTH_COMPARE_FUNC_NEVER = 0;
        this.DEPTH_COMPARE_FUNC_LESS = 1;
        this.DEPTH_COMPARE_FUNC_EQUAL = 2;
        this.DEPTH_COMPARE_FUNC_LESSEQUAL = 3;
        this.DEPTH_COMPARE_FUNC_GREATER = 4;
        this.DEPTH_COMPARE_FUNC_NOTEQUAL = 5;
        this.DEPTH_COMPARE_FUNC_GREATEREQUAL = 6;
        this.DEPTH_COMPARE_FUNC_ALWAYS = 7;


        /**
         * Current projection matrix
         * @memberof Context
         * @instance
         * @type {mat4}
         */
        this.pMatrix = mat4.create();

        /**
         * Current model matrix
         * @memberof Context
         * @instance
         * @type {mat4}
         */
        this.mMatrix = mat4.create();

        /**
         * Current view matrix
         * @memberof Context
         * @instance
         * @type {mat4}
         */
        this.vMatrix = mat4.create();
        this._textureslots = [];

        this._pMatrixStack = new MatrixStack();
        this._mMatrixStack = new MatrixStack();
        this._vMatrixStack = new MatrixStack();

        this.canvasScale = 1;

        mat4.identity(this.mMatrix);
        mat4.identity(this.vMatrix);


        window.matchMedia("screen and (min-resolution: 2dppx)")
            .addEventListener("change", (e) =>
            {
                this.emitEvent("resize");
            });
    }

    get canvasWidth()
    {
        return this.cgCanvas.canvasWidth;
    }

    get canvasHeight()
    {
        return this.cgCanvas.canvasHeight;
    }

    set pixelDensity(p)
    {
        if (this.cgCanvas.pixelDensity != p)
        {
            this.cgCanvas.pixelDensity = p;
            this.cgCanvas.updateSize();
            this.emitEvent("resize");
        }
    }

    get pixelDensity()
    {
        return this.cgCanvas.pixelDensity;
    }


    getGApiName()
    {
        return ["WebGL", "WebGPU"][this.gApi];
    }

    get canvas()
    {
        return this.cgCanvas.canvasEle;
    }



    setCanvas(canvEle)
    {
        if (this.cgCanvas && canvEle == this.cgCanvas.canvasEle) return;
        if (typeof canvEle === "string") canvEle = document.getElementById(canvEle);

        this.cgCanvas = new CgCanvas({ "canvasEle": canvEle, "cg": this });

        canvEle.parentElement.classList.add("cablesContainer");
        if (this._setCanvas) this._setCanvas(canvEle);

        this.updateSize();
    }

    updateSize()
    {
        this.cgCanvas.updateSize();
    }

    setSize(w, h, ignorestyle)
    {
        this.cgCanvas.setSize(w, h, ignorestyle);
    }

    _resizeToWindowSize()
    {
        if (this.autoReSize)
        {
            this.setSize(window.innerWidth, window.innerHeight);
            this.updateSize();
        }
    }

    _resizeToParentSize()
    {
        if (this.autoReSize)
        {
            const p = this.canvas.parentElement;
            if (!p)
            {
                this._log.error("cables: can not resize to container element");
                return;
            }

            this.setSize(p.clientWidth, p.clientHeight);
            this.updateSize();
        }
    }

    setAutoResize(parent)
    {
        window.removeEventListener("resize", this._resizeToWindowSize.bind(this));
        window.removeEventListener("resize", this._resizeToParentSize.bind(this));

        if (parent == "window")
        {
            window.addEventListener("resize", this._resizeToWindowSize.bind(this));
            window.addEventListener("orientationchange", this._resizeToWindowSize.bind(this));
            this._resizeToWindowSize();
        }
        if (parent == "parent")
        {
            window.addEventListener("resize", this._resizeToParentSize.bind(this));
            this._resizeToParentSize();
        }
    }

    /**
     * push a matrix to the projection matrix stack
     * @function pushPMatrix
     * @memberof Context
     * @instance
     */
    pushPMatrix()
    {
        this.pMatrix = this._pMatrixStack.push(this.pMatrix);
    }

    /**
      * pop projection matrix stack
      * @function popPMatrix
      * @memberof Context
      * @instance
      * @returns {mat4} current projectionmatrix
      */
    popPMatrix()
    {
        this.pMatrix = this._pMatrixStack.pop();
        return this.pMatrix;
    }

    getProjectionMatrixStateCount()
    {
        return this._pMatrixStack.stateCounter;
    }

    /**
      * push a matrix to the model matrix stack
      * @function pushModelMatrix
      * @memberof Context
      * @instance
      * @example
      * // see source code of translate op:
      * cgl.pushModelMatrix();
      * mat4.translate(cgl.mMatrix,cgl.mMatrix, vec);
      * trigger.trigger();
      * cgl.popModelMatrix();
      */
    pushModelMatrix()
    {
        this.mMatrix = this._mMatrixStack.push(this.mMatrix);
    }

    /**
      * pop model matrix stack
      * @function popModelMatrix
      * @memberof Context
      * @instance
      * @returns {mat4} current modelmatrix
      */
    popModelMatrix()
    {
        // todo: DEPRECATE
        // if (this._mMatrixStack.length === 0) throw "Invalid modelview popMatrix!";
        this.mMatrix = this._mMatrixStack.pop();
        return this.mMatrix;
    }

    /**
      * get model matrix
      * @function modelMatrix
      * @memberof Context
      * @instance
      * @returns {mat4} current modelmatrix
      */
    modelMatrix()
    {
        return this.mMatrix;
    }


    /**
     * push a matrix to the view matrix stack
     * @function pushviewMatrix
     * @memberof Context
     * @instance
     */
    pushViewMatrix()
    {
        this.vMatrix = this._vMatrixStack.push(this.vMatrix);
    }

    /**
      * pop view matrix stack
      * @function popViewMatrix
      * @memberof Context
      * @instance
      * @returns {mat4} current viewmatrix
      * @function
      */
    popViewMatrix()
    {
        this.vMatrix = this._vMatrixStack.pop();
    }

    getViewMatrixStateCount()
    {
        return this._vMatrixStack.stateCounter;
    }

    _startMatrixStacks(identTranslate, identTranslateView)
    {
        identTranslate = identTranslate || this._ident;
        identTranslateView = identTranslateView || this._identView;

        mat4.perspective(this.pMatrix, 45, this.canvasWidth / this.canvasHeight, 0.1, 1000.0);

        mat4.identity(this.mMatrix);
        mat4.identity(this.vMatrix);
        mat4.translate(this.mMatrix, this.mMatrix, identTranslate);
        mat4.translate(this.vMatrix, this.vMatrix, identTranslateView);

        this.pushPMatrix();
        this.pushModelMatrix();
        this.pushViewMatrix();
    }

    _endMatrixStacks()
    {
        this.popViewMatrix();
        this.popModelMatrix();
        this.popPMatrix();
    }

    dispose()
    {
        this.aborted = true;
        if (this.cgCanvas) this.cgCanvas.dispose();
        if (this._dispose) this._dispose();
    }

    shouldDrawHelpers()
    {
        return false;
    }
}





;// CONCATENATED MODULE: ./src/core/cg/sg_fpscounter.js


class FpsCounter extends Events
{
    constructor()
    {
        super();
        this._timeStartFrame = 0;
        this._timeStartSecond = 0;
        this._fpsCounter = 0;
        this._msCounter = 0;
        this._frameCount = 0;

        this.stats = { "ms": 0, "fps": 0 };
    }

    get frameCount()
    {
        return this._frameCount;
    }

    startFrame()
    {
        this._timeStartFrame = CABLES.now();
    }

    endFrame()
    {
        this._frameCount++;
        this._fpsCounter++;

        const timeFrame = CABLES.now() - this._timeStartFrame;
        this._msCounter += timeFrame;

        if (CABLES.now() - this._timeStartSecond > 1000)
        {
            this.endSecond();
        }
    }

    endSecond()
    {
        this.stats.fps = this._fpsCounter;
        this.stats.ms = Math.round(this._msCounter / this._fpsCounter * 100) / 100;

        this.emitEvent("performance", this.stats);

        // reset
        this._fpsCounter = 0;
        this._msCounter = 0;
        this._timeStartSecond = CABLES.now();
    }
}

;// CONCATENATED MODULE: ./src/core/cg/cg_constants.js





const CG = {

    "GAPI_WEBGL": 0,
    "GAPI_WEBGPU": 1,

    "DEPTH_COMPARE_NEVER": 0,
    "DEPTH_COMPARE_LESS": 1,
    "DEPTH_COMPARE_EQUAL": 2,
    "DEPTH_COMPARE_LESSEQUAL": 3,
    "DEPTH_COMPARE_GREATER": 4,
    "DEPTH_COMPARE_NOTEQUAL": 5,
    "DEPTH_COMPARE_GREATEREQUAL": 6,
    "DEPTH_COMPARE_ALWAYS": 7,

    "CULL_NONE": 0,
    "CULL_BACK": 1,
    "CULL_FRONT": 2,
    "CULL_BOTH": 3,


    "Geometry": Geometry,
    "BoundingBox": BoundingBox,
    "FpsCounter": FpsCounter,

    "CgCanvas": CgCanvas
};




;// CONCATENATED MODULE: ./src/core/cgl/cgl_state.js








/**
 * cables gl context/state manager
 * @class
 * @namespace external:CGL
 * @hideconstructor
 */
// const Context(_patch)
class Context extends CGState
{
    constructor(_patch)
    {
        super(_patch);

        this.gApi = CG.GAPI_WEBGL;
        this.aborted = false;

        this.pushMvMatrix = this.pushModelMatrix; // deprecated and wrong... still used??
        this.popMvMatrix = this.popmMatrix = this.popModelMatrix;// deprecated and wrong... still used??

        this.profileData = new ProfileData(this);
        this._log = new Logger("cgl_context", { "onError": _patch.config.onError });
        this._viewPort = [0, 0, 0, 0];
        this.glVersion = 0;
        this.glUseHalfFloatTex = false;
        this.clearCanvasTransparent = true;
        this.clearCanvasDepth = true;
        this.debugOneFrame = false;
        this.checkGlErrors = false; // true is slow // false should be default...
        this.maxTextureUnits = 0;
        this.maxVaryingVectors = 0;
        this.currentProgram = null;
        this._hadStackError = false;
        this.glSlowRenderer = false;
        this._isSafariCrap = false;

        this.temporaryTexture = null;
        this._onetimeCallbacks = [];
        this.gl = null;

        this._cursor = "auto";
        this._currentCursor = "";

        this._viewPortStack = [];
        this._glFrameBufferStack = [];
        this._frameBufferStack = [];
        this._shaderStack = [];
        this._stackDepthTest = [];
        this.mainloopOp = null;

        this._simpleShader = new Shader(this, "simpleshader");
        this._simpleShader.setModules(["MODULE_VERTEX_POSITION", "MODULE_COLOR", "MODULE_BEGIN_FRAG", "MODULE_VERTEX_MODELVIEW"]);
        this._simpleShader.setSource(Shader.getDefaultVertexShader(), Shader.getDefaultFragmentShader());

        this._currentShader = this._simpleShader;


        this._oldCanvasWidth = -1;
        this._oldCanvasHeight = -1;
        this._enabledExtensions = {};
    }

    // set pixelDensity(p)
    // {
    //     this._pixelDensity = p;
    // }

    // get pixelDensity()
    // {
    //     return this._pixelDensity;
    // }



    get viewPort()
    {
        if (this._viewPortStack.length > 3)
        {
            const l = this._viewPortStack.length;

            return [
                this._viewPortStack[l - 4],
                this._viewPortStack[l - 3],
                this._viewPortStack[l - 2],
                this._viewPortStack[l - 1]
            ];
        }
        else
        {
            // workaround pre viewport stack times / or+and initial value...

            return this._viewPort;
        }
    }



    get mvMatrix() // deprecate
    {
        return this.mMatrix;
    }

    set mvMatrix(m) // deprecate
    {
        this.mMatrix = m;
    }

    _setCanvas(canv)
    {
        if (!canv) this._log.stack("_setCanvas undef");

        if (!this.patch.config.canvas) this.patch.config.canvas = {};
        if (!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer")) this.patch.config.canvas.preserveDrawingBuffer = false;
        if (!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha")) this.patch.config.canvas.premultipliedAlpha = false;
        if (!this.patch.config.canvas.hasOwnProperty("alpha")) this.patch.config.canvas.alpha = false;

        this.patch.config.canvas.stencil = true;

        if (this.patch.config.hasOwnProperty("clearCanvasColor")) this.clearCanvasTransparent = this.patch.config.clearCanvasColor;
        if (this.patch.config.hasOwnProperty("clearCanvasDepth")) this.clearCanvasDepth = this.patch.config.clearCanvasDepth;

        // safari stuff..........
        if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent) && (navigator.userAgent.match(/iPhone/i)))
        {
            this._isSafariCrap = true;
            this.glUseHalfFloatTex = true;
        }

        if (!this.patch.config.canvas.forceWebGl1) this.gl = canv.getContext("webgl2", this.patch.config.canvas);


        if (!this.gl || this.gl.isContextLost())
        {
            this.aborted = true;
            this._log.error("NO_WEBGL", "sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");
            return;
        }

        if (this.gl.getParameter(this.gl.VERSION) != "WebGL 1.0")
        {
            this.glVersion = 2;
        }
        else
        {
            this.gl = canv.getContext("webgl", this.patch.config.canvas) || canv.getContext("experimental-webgl", this.patch.config.canvas);
            this.glVersion = 1;

            // safari
            // if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent) && (navigator.userAgent.match(/iPhone/i)))
            // {
            //     this.glUseHalfFloatTex = true;
            // }

            // ios
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream)
            {
                if (!this.patch.config.canvas.hasOwnProperty("powerPreference")) this.patch.config.canvas.powerPreference = "high-performance";
            }

            this.enableExtension("OES_standard_derivatives");
            // this.enableExtension("GL_OES_standard_derivatives");
            const instancingExt = this.enableExtension("ANGLE_instanced_arrays") || this.gl;
            if (instancingExt.vertexAttribDivisorANGLE)
            {
                this.gl.vertexAttribDivisor = instancingExt.vertexAttribDivisorANGLE.bind(instancingExt);
                this.gl.drawElementsInstanced = instancingExt.drawElementsInstancedANGLE.bind(instancingExt);
            }
        }

        const dbgRenderInfo = this.enableExtension("WEBGL_debug_renderer_info");
        if (dbgRenderInfo)
        {
            this.glRenderer = this.gl.getParameter(dbgRenderInfo.UNMASKED_RENDERER_WEBGL);
            if (this.glRenderer === "Google SwiftShader") this.glSlowRenderer = true;
        }

        this.canvas.addEventListener("webglcontextlost", (event) =>
        {
            if (this.aborted) return this._log.warn("[cgl_state] aborted context lost... can be ignored...");
            this._log.error("canvas lost...", event);
            this.emitEvent("webglcontextlost");
            this.aborted = true;
        });


        this.maxAnisotropic = 0;
        if (this.enableExtension("EXT_texture_filter_anisotropic"))
            this.maxAnisotropic = this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);


        this.maxVaryingVectors = this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);
        this.maxTextureUnits = this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);
        this.maxTexSize = this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);
        this.maxUniformsFrag = this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);
        this.maxUniformsVert = this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);
        this.maxSamples = 0;
        if (this.gl.MAX_SAMPLES) this.maxSamples = this.gl.getParameter(this.gl.MAX_SAMPLES);

        if (this.glVersion == 1)
        {
            this.enableExtension("OES_standard_derivatives");
            const instancingExt = this.enableExtension("ANGLE_instanced_arrays") || this.gl;

            if (instancingExt.vertexAttribDivisorANGLE)
            {
                this.gl.vertexAttribDivisor = instancingExt.vertexAttribDivisorANGLE.bind(instancingExt);
                this.gl.drawElementsInstanced = instancingExt.drawElementsInstancedANGLE.bind(instancingExt);
            }
        }

        this.DEPTH_FUNCS = [
            this.gl.NEVER,
            this.gl.ALWAYS,
            this.gl.LESS,
            this.gl.LEQUAL,
            this.gl.GREATER,
            this.gl.GEQUAL,
            this.gl.EQUAL,
            this.gl.NOTEQUAL
        ];
        this.CULL_MODES = [
            null,
            this.gl.BACK,
            this.gl.FRONT,
            this.gl.FRONT_AND_BACK
        ];
    }

    getInfo()
    {
        return {
            "glVersion": this.glVersion,
            "glRenderer": this.glRenderer,
            "glUseHalfFloatTex": this.glUseHalfFloatTex,
            "maxVaryingVectors": this.maxVaryingVectors,
            "maxTextureUnits": this.maxTextureUnits,
            "maxTexSize": this.maxTexSize,
            "maxUniformsFrag": this.maxUniformsFrag,
            "maxUniformsVert": this.maxUniformsVert,
            "maxSamples": this.maxSamples
        };
    }





    /**
     * @function popViewPort
     * @memberof Context
     * @instance
     * @description pop viewPort stack
     */


    popViewPort()
    {
        this._viewPortStack.pop();
        this._viewPortStack.pop();
        this._viewPortStack.pop();
        this._viewPortStack.pop();

        if (this._viewPortStack.length == 0)
        {
            this.setViewPort(0, 0, this.canvasWidth, this.canvasHeight);
            // this.gl.viewport(this._viewPort[0], this._viewPort[1], this._viewPort[2], this._viewPort[3]);
            // this.setViewPort(this._viewPort[0], this._viewPort[1], this._viewPort[2], this._viewPort[3]);
        }
        else
        {
            // this.viewPort = [this._viewPortStack[this._viewPort.length - 4], this._viewPortStack[this._viewPort.length - 3], this._viewPortStack[this._viewPort.length - 2], this._viewPortStack[this._viewPort.length - 1]];
            // this.gl.viewport(this._viewPortStack[this._viewPort.length - 4], this._viewPortStack[this._viewPort.length - 3], this._viewPortStack[this._viewPort.length - 2], this._viewPortStack[this._viewPort.length - 1]);
            this.setViewPort(this._viewPortStack[this._viewPort.length - 4], this._viewPortStack[this._viewPort.length - 3], this._viewPortStack[this._viewPort.length - 2], this._viewPortStack[this._viewPort.length - 1]);
        }
    }

    /**
     * @function pushViewPort
     * @memberof Context
     * @instance
     * @description push a new viewport onto stack
     * @param {Number} x
     * @param {Number} y
     * @param {Number} w
     * @param {Number} h
     */

    pushViewPort(x, y, w, h)
    {
        this._viewPortStack.push(x, y, w, h);
        this.setViewPort(x, y, w, h);
    }


    // old
    getViewPort()
    {
        return this._viewPort;
    }

    // old
    resetViewPort()
    {
        this.gl.viewport(this._viewPort[0], this._viewPort[1], this._viewPort[2], this._viewPort[3]);
    }

    // old
    setViewPort(x, y, w, h)
    {
        this._viewPort[0] = Math.round(x);
        this._viewPort[1] = Math.round(y);
        this._viewPort[2] = Math.round(w);
        this._viewPort[3] = Math.round(h);
        this.gl.viewport(this._viewPort[0], this._viewPort[1], this._viewPort[2], this._viewPort[3]);
    }


    screenShot(cb, doScreenshotClearAlpha, mimeType, quality)
    {
        if (doScreenshotClearAlpha)
        {
            this.gl.clearColor(1, 1, 1, 1);
            this.gl.colorMask(false, false, false, true);
            this.gl.clear(this.gl.COLOR_BUFFER_BIT);
            this.gl.colorMask(true, true, true, true);
        }

        if (this.canvas && this.canvas.toBlob)
        {
            this.canvas.toBlob((blob) =>
            {
                if (cb) cb(blob);
                else this._log.log("no screenshot callback...");
            }, mimeType, quality);
        }
    }

    endFrame()
    {
        if (this.patch.isEditorMode()) CABLES.GL_MARKER.drawMarkerLayer(this);

        this.setPreviousShader();

        if (this._vMatrixStack.length() > 0) this.logStackError("view matrix stack length !=0 at end of rendering...");
        if (this._mMatrixStack.length() > 0) this.logStackError("mvmatrix stack length !=0 at end of rendering...");
        if (this._pMatrixStack.length() > 0) this.logStackError("pmatrix stack length !=0 at end of rendering...");
        if (this._glFrameBufferStack.length > 0) this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");
        if (this._stackDepthTest.length > 0) this.logStackError("depthtest stack length !=0 at end of rendering...");
        if (this._stackDepthWrite.length > 0) this.logStackError("depthwrite stack length !=0 at end of rendering...");
        if (this._stackDepthFunc.length > 0) this.logStackError("depthfunc stack length !=0 at end of rendering...");
        if (this._stackBlend.length > 0) this.logStackError("blend stack length !=0 at end of rendering...");
        if (this._stackBlendMode.length > 0) this.logStackError("blendMode stack length !=0 at end of rendering...");
        if (this._shaderStack.length > 0) this.logStackError("this._shaderStack length !=0 at end of rendering...");
        if (this._stackCullFace.length > 0) this.logStackError("this._stackCullFace length !=0 at end of rendering...");
        if (this._stackCullFaceFacing.length > 0) this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");
        if (this._viewPortStack.length > 0) this.logStackError("viewport stack length !=0 at end of rendering...");

        this._frameStarted = false;

        if (this._oldCanvasWidth != this.canvasWidth || this._oldCanvasHeight != this.canvasHeight)
        {
            this._oldCanvasWidth = this.canvasWidth;
            this._oldCanvasHeight = this.canvasHeight;
            this.emitEvent("resize");
        }

        if (this._cursor != this._currentCursor)
        {
            this._currentCursor = this.canvas.style.cursor = this._cursor;
        }

        this.emitEvent("endframe");

        this.fpsCounter.endFrame();
    }

    logStackError(str)
    {
        if (!this._hadStackError)
        {
            this._hadStackError = true;
            this._log.warn("[" + this.canvas.id + "]: ", str);
        }
    }

    // shader stack
    getShader()
    {
        if (this._currentShader) if (!this.tempData || ((this.tempData.renderOffscreen === true) == this._currentShader.offScreenPass) === true) return this._currentShader;

        for (let i = this._shaderStack.length - 1; i >= 0; i--) if (this._shaderStack[i]) if (this.tempData.renderOffscreen == this._shaderStack[i].offScreenPass) return this._shaderStack[i];
    }

    getDefaultShader()
    {
        return this._simpleShader;
    }

    /**
     * push a shader to the shader stack
     * @function pushShader
     * @memberof Context
     * @instance
     * @param {Object} shader
     * @function
     */

    pushShader(shader)
    {
        if (this.tempData.forceShaderMods)
        {
            for (let i = 0; i < this.tempData.forceShaderMods.length; i++)
            {
                // if (!currentShader.forcedMod && currentShader != this.tempData.forceShaderMods[i])
                // {
                //     currentShader.forcedMod = this.tempData.forceShaderMods[i];
                shader = this.tempData.forceShaderMods[i].bind(shader, false);
                // }
                // return currentShader;
                // if (this.tempData.forceShaderMods[i].currentShader() && shader != this.tempData.forceShaderMods[i].currentShader().shader)
            }
        }

        this._shaderStack.push(shader);
        this._currentShader = shader;
    }


    /**
     * pop current used shader from shader stack
     * @function popShader
     * @memberof Context
     * @instance
     * @function
     */
    setPreviousShader()
    {
        if (this.tempData.forceShaderMods)
        {
            for (let i = 0; i < this.tempData.forceShaderMods.length; i++)
            {
                // const a =
                this.tempData.forceShaderMods[i].unbind(false);
                // if (a) return;
                // this.popShader();
            }
        }

        if (this._shaderStack.length === 0) throw new Error("Invalid shader stack pop!");
        this._shaderStack.pop();
        this._currentShader = this._shaderStack[this._shaderStack.length - 1];
    }

    /**
     * push a framebuffer to the framebuffer stack
     * @function pushGlFrameBuffer
     * @memberof Context
     * @instance
     * @param {Object} fb framebuffer
     * @function
     */
    pushGlFrameBuffer(fb)
    {
        this._glFrameBufferStack.push(fb);
    }

    /**
     * pop framebuffer stack
     * @function popGlFrameBuffer
     * @memberof Context
     * @instance
     * @returns {Object} current framebuffer or null
     */
    popGlFrameBuffer()
    {
        if (this._glFrameBufferStack.length == 0) return null;
        this._glFrameBufferStack.pop();
        return this._glFrameBufferStack[this._glFrameBufferStack.length - 1];
    }

    /**
     * get current framebuffer
     * @function getCurrentFrameBuffer
     * @memberof Context
     * @instance
     * @returns {Object} current framebuffer or null
     */
    getCurrentGlFrameBuffer()
    {
        if (this._glFrameBufferStack.length === 0) return null;
        return this._glFrameBufferStack[this._glFrameBufferStack.length - 1];
    }

    /**
     * push a framebuffer to the framebuffer stack
     * @function pushGlFrameBuffer
     * @memberof Context
     * @instance
     * @param {Framebuffer} fb framebuffer
     */
    pushFrameBuffer(fb)
    {
        this._frameBufferStack.push(fb);
    }

    /**
     * pop framebuffer stack
     * @function popFrameBuffer
     * @memberof Context
     * @instance
     * @returns {Framebuffer} current framebuffer or null
     */
    popFrameBuffer()
    {
        if (this._frameBufferStack.length == 0) return null;
        this._frameBufferStack.pop();
        return this._frameBufferStack[this._frameBufferStack.length - 1];
    }

    /**
     * get current framebuffer
     * @function getCurrentFrameBuffer
     * @memberof Context
     * @instance
     * @returns {Framebuffer} current framebuffer or null
     */
    getCurrentFrameBuffer()
    {
        if (this._frameBufferStack.length === 0) return null;
        return this._frameBufferStack[this._frameBufferStack.length - 1];
    }


    renderStart(cgl, identTranslate, identTranslateView)
    {
        this.fpsCounter.startFrame();
        this.pushDepthTest(true);
        this.pushDepthWrite(true);
        this.pushDepthFunc(cgl.gl.LEQUAL);
        this.pushCullFaceFacing(cgl.gl.BACK);
        this.pushCullFace(false);

        // if (this.clearCanvasTransparent)
        // {
        //     cgl.gl.clearColor(0, 0, 0, 0);
        //     cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT);
        // }
        // if (this.clearCanvasDepth) cgl.gl.clear(cgl.gl.DEPTH_BUFFER_BIT);

        cgl.setViewPort(0, 0, cgl.canvasWidth, cgl.canvasHeight);

        this._startMatrixStacks(identTranslate, identTranslateView);

        cgl.pushBlendMode(constants_CONSTANTS.BLEND_MODES.BLEND_NORMAL, false);

        for (let i = 0; i < this._textureslots.length; i++) this._textureslots[i] = null;

        this.pushShader(this._simpleShader);

        this._frameStarted = true;

        if (this._onetimeCallbacks.length > 0)
        {
            for (let i = 0; i < this._onetimeCallbacks.length; i++) this._onetimeCallbacks[i]();
            this._onetimeCallbacks.length = 0;
        }

        for (let i = 0; i < this._textureslots.length; i++)
        {
            this.gl.activeTexture(this.gl.TEXTURE0 + i);
            this.gl.bindTexture(this.gl.TEXTURE_2D, null);
            this._textureslots[i] = null;
        }

        this.emitEvent("beginFrame");
    }

    renderEnd(cgl)
    {
        this._endMatrixStacks();

        this.popDepthTest();
        this.popDepthWrite();
        this.popDepthFunc();
        this.popCullFaceFacing();
        this.popCullFace();
        this.popBlend();
        this.popBlendMode();

        cgl.endFrame();

        this.emitEvent("endFrame");
    }

    getTexture(slot)
    {
        return this._textureslots[slot];
    }

    hasFrameStarted()
    {
        return this._frameStarted;
    }

    /**
     * log warning to console if the rendering of one frame has not been started / handy to check for async problems
     * @function checkFrameStarted
     * @memberof Context
     * @param string
     * @instance
     */
    checkFrameStarted(string)
    {
        if (!this._frameStarted)
        {
            this._log.warn("frame not started " + string);
            this.patch.printTriggerStack();
        }
    }


    setTexture(slot, t, type)
    {
        this.checkFrameStarted("cgl setTexture");

        if (t === null) t = CGL.Texture.getEmptyTexture(this).tex;

        if (this._textureslots[slot] != t)
        {
            this.gl.activeTexture(this.gl.TEXTURE0 + slot);
            this.gl.bindTexture(type || this.gl.TEXTURE_2D, t);
            this._textureslots[slot] = t;
        }


        return true;
    }

    fullScreen()
    {
        if (this.canvas.requestFullscreen) this.canvas.requestFullscreen();
        else if (this.canvas.mozRequestFullScreen) this.canvas.mozRequestFullScreen();
        else if (this.canvas.webkitRequestFullscreen) this.canvas.webkitRequestFullscreen();
        else if (this.canvas.msRequestFullscreen) this.canvas.msRequestFullscreen();
    }


    printError(str)
    {
        if (!this.checkGlErrors) return;
        let found = false;
        let error = this.gl.getError();

        if (error != this.gl.NO_ERROR)
        {
            let errStr = "";
            if (error == this.gl.OUT_OF_MEMORY) errStr = "OUT_OF_MEMORY";
            if (error == this.gl.INVALID_ENUM) errStr = "INVALID_ENUM";
            if (error == this.gl.INVALID_OPERATION) errStr = "INVALID_OPERATION";
            if (error == this.gl.INVALID_FRAMEBUFFER_OPERATION) errStr = "INVALID_FRAMEBUFFER_OPERATION";
            if (error == this.gl.INVALID_VALUE) errStr = "INVALID_VALUE";
            if (error == this.gl.CONTEXT_LOST_WEBGL)
            {
                this.aborted = true;
                errStr = "CONTEXT_LOST_WEBGL";
            }
            if (error == this.gl.NO_ERROR) errStr = "NO_ERROR";

            found = true;


            this._log.warn("gl error [" + this.canvas.id + "]: ", str, error, errStr);

            if (this.canvas.id.contains("glGuiCanvas"))
                if (!this._loggedGlError)
                {
                    this.patch.printTriggerStack();
                    this._log.stack("glerror");
                    this._loggedGlError = true;
                }
        }
        error = this.gl.getError();

        return found;
    }

    saveScreenshot(filename, cb, pw, ph, noclearalpha)
    {
        this.patch.renderOneFrame();

        let w = this.canvas.clientWidth * this.pixelDensity;
        let h = this.canvas.clientHeight * this.pixelDensity;

        if (pw)
        {
            this.canvas.width = pw;
            w = pw;
        }
        if (ph)
        {
            this.canvas.height = ph;
            h = ph;
        }

        function padLeft(nr, n, str)
        {
            return Array(n - String(nr).length + 1).join(str || "0") + nr;
        }

        const d = new Date();

        const dateStr = "".concat(String(d.getFullYear()) + String(d.getMonth() + 1) + String(d.getDate()), "_").concat(padLeft(d.getHours(), 2)).concat(padLeft(d.getMinutes(), 2)).concat(padLeft(d.getSeconds(), 2));

        if (!filename) filename = "cables_" + dateStr + ".png";
        else filename += ".png";

        this.patch.cgl.screenShot(function (blob)
        {
            this.canvas.width = w;
            this.canvas.height = h;

            if (blob)
            {
                const anchor = document.createElement("a");

                anchor.download = filename;
                anchor.href = URL.createObjectURL(blob);

                setTimeout(function ()
                {
                    anchor.click();
                    if (cb) cb(blob);
                }, 100);
            }
            else
            {
                this._log.log("screenshot: no blob");
            }
        }.bind(this), noclearalpha);
    }

    _dispose()
    {
        this._simpleShader.dispose();
        this.gl = null;
    }
}


Context.prototype.popShader = Context.prototype.setPreviousShader;
Context.prototype.setShader = Context.prototype.pushShader;

/**
 * execute the callback next frame, once
 * @function addNextFrameOnceCallback
 * @memberof Context
 * @instance
 * @param {function} cb
 */
Context.prototype.addNextFrameOnceCallback = function (cb)
{
    if (cb && this._onetimeCallbacks.indexOf(cb) == -1) this._onetimeCallbacks.push(cb);
};

// state depthtest

/**
 * push depth testing enabled state
 * @function pushDepthTest
 * @param {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype._stackDepthTest = [];
Context.prototype.pushDepthTest = function (b)
{
    this._stackDepthTest.push(b);
    if (!b) this.gl.disable(this.gl.DEPTH_TEST);
    else this.gl.enable(this.gl.DEPTH_TEST);
};
/**
 * current state of depth testing
 * @function stateCullFace
 * @returns {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype.stateDepthTest = function ()
{
    return this._stackDepthTest[this._stackDepthTest.length - 1];
};

/**
 * pop depth testing state
 * @function popCullFace
 * @memberof Context
 * @instance
 */
Context.prototype.popDepthTest = function ()
{
    this._stackDepthTest.pop();

    if (!this._stackDepthTest[this._stackDepthTest.length - 1]) this.gl.disable(this.gl.DEPTH_TEST);
    else this.gl.enable(this.gl.DEPTH_TEST);
};

// --------------------------------------
// state depthwrite

/**
 * push depth write enabled state
 * @function pushDepthTest
 * @param {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype._stackDepthWrite = [];
Context.prototype.pushDepthWrite = function (b)
{
    b = b || false;
    this._stackDepthWrite.push(b);
    this.gl.depthMask(b);
};

/**
 * current state of depth writing
 * @function stateDepthWrite
 * @returns {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype.stateDepthWrite = function ()
{
    return this._stackDepthWrite[this._stackDepthWrite.length - 1];
};

/**
 * pop depth writing state
 * @function popDepthWrite
 * @memberof Context
 * @instance
 */
Context.prototype.popDepthWrite = function ()
{
    this._stackDepthWrite.pop();
    this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length - 1] || false);
};


// --------------------------------------
// state CullFace

Context.prototype._stackCullFace = [];

/**
 * push face culling face enabled state
 * @function pushCullFace
 * @param {Boolean} b enabled
 * @memberof Context
 * @instance
 */
Context.prototype.pushCullFace = function (b)
{
    this._stackCullFace.push(b);

    if (b) this.gl.enable(this.gl.CULL_FACE);
    else this.gl.disable(this.gl.CULL_FACE);
};

/**
 * current state of face culling
 * @function stateCullFace
 * @returns {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype.stateCullFace = function ()
{
    return this._stackCullFace[this._stackCullFace.length - 1];
};

/**
 * pop face culling enabled state
 * @function popCullFace
 * @memberof Context
 * @instance
 */
Context.prototype.popCullFace = function ()
{
    this._stackCullFace.pop();

    if (this._stackCullFace[this._stackCullFace.length - 1]) this.gl.enable(this.gl.CULL_FACE);
    else this.gl.disable(this.gl.CULL_FACE);
};


// --------------------------------------
// state CullFace Facing


/**
 * push face culling face side
 * @function pushCullFaceFacing
 * @param {Number} cgl.gl.FRONT_AND_BACK, cgl.gl.BACK or cgl.gl.FRONT
 * @memberof Context
 * @instance
 */
Context.prototype._stackCullFaceFacing = [];
Context.prototype.pushCullFaceFacing = function (b)
{
    this._stackCullFaceFacing.push(b);
    this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length - 1]);
};

/**
 * current state of face culling side
 * @function stateCullFaceFacing
 * @returns {Boolean} enabled
 * @memberof Context
 * @instance
 */
Context.prototype.stateCullFaceFacing = function ()
{
    return this._stackCullFaceFacing[this._stackCullFaceFacing.length - 1];
};

/**
 * pop face culling face side
 * @function popCullFaceFacing
 * @memberof Context
 * @instance
 */
Context.prototype.popCullFaceFacing = function ()
{
    this._stackCullFaceFacing.pop();
    if (this._stackCullFaceFacing.length > 0) this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length - 1]);
};


// --------------------------------------
// state depthfunc

Context.prototype._stackDepthFunc = [];

/**
 * enable / disable depth testing
 * like `gl.depthFunc(boolean);`
 * @function pushDepthFunc
 * @memberof Context
 * @instance
 * @param {Boolean} f depthtesting
 */
Context.prototype.pushDepthFunc = function (f)
{
    this._stackDepthFunc.push(f);
    this.gl.depthFunc(f);
};

/**
 * current state of blend
 * @function stateDepthFunc
 * @memberof Context
 * @instance
 * @returns {Boolean} depth testing enabled/disabled
 */
Context.prototype.stateDepthFunc = function ()
{
    if (this._stackDepthFunc.length > 0) return this._stackDepthFunc[this._stackDepthFunc.length - 1];
    return false;
};

/**
 * pop depth testing and set the previous state
 * @function popDepthFunc
 * @memberof Context
 * @instance
 */
Context.prototype.popDepthFunc = function ()
{
    this._stackDepthFunc.pop();
    if (this._stackDepthFunc.length > 0) this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length - 1]);
};

// --------------------------------------
// state blending

Context.prototype._stackBlend = [];

/**
 * enable / disable blend
 * like gl.enable(gl.BLEND); / gl.disable(gl.BLEND);
 * @function pushBlend
 * @memberof Context
 * @instance
 * @param {boolean} b blending
 */
Context.prototype.pushBlend = function (b)
{
    this._stackBlend.push(b);
    if (!b) this.gl.disable(this.gl.BLEND);
    else this.gl.enable(this.gl.BLEND);
};

/**
 * pop blend state and set the previous state
 * @function popBlend
 * @memberof Context
 * @instance
 */
Context.prototype.popBlend = function ()
{
    this._stackBlend.pop();

    if (!this._stackBlend[this._stackBlend.length - 1]) this.gl.disable(this.gl.BLEND);
    else this.gl.enable(this.gl.BLEND);
};

/**
 * current state of blend
 * @function stateBlend
 * @returns {boolean} blending enabled/disabled
 * @memberof Context
 * @instance
 */
Context.prototype.stateBlend = function ()
{
    return this._stackBlend[this._stackBlend.length - 1];
};

const BLENDS = {
    "BLEND_NONE": 0,
    "BLEND_NORMAL": 1,
    "BLEND_ADD": 2,
    "BLEND_SUB": 3,
    "BLEND_MUL": 4,
};

Context.prototype._stackBlendMode = [];
Context.prototype._stackBlendModePremul = [];

/**
 * push and switch to predefined blendmode (CONSTANTS.BLEND_MODES.BLEND_NONE,CONSTANTS.BLEND_MODES.BLEND_NORMAL,CONSTANTS.BLEND_MODES.BLEND_ADD,CONSTANTS.BLEND_MODES.BLEND_SUB,CONSTANTS.BLEND_MODES.BLEND_MUL)
 * @function pushBlendMode
 * @memberof Context
 * @instance
 * @param {Number} blendMode
 * @param {Boolean} premul premultiplied mode
 */
Context.prototype.pushBlendMode = function (blendMode, premul)
{
    this._stackBlendMode.push(blendMode);
    this._stackBlendModePremul.push(premul);

    const n = this._stackBlendMode.length - 1;

    this.pushBlend(this._stackBlendMode[n] !== constants_CONSTANTS.BLEND_MODES.BLEND_NONE);
    this._setBlendMode(this._stackBlendMode[n], this._stackBlendModePremul[n]);
};

/**
 * pop predefined blendmode / switch back to previous blendmode
 * @function popBlendMode
 * @memberof Context
 * @instance
 */
Context.prototype.popBlendMode = function ()
{
    this._stackBlendMode.pop();
    this._stackBlendModePremul.pop();

    const n = this._stackBlendMode.length - 1;

    this.popBlend(this._stackBlendMode[n] !== constants_CONSTANTS.BLEND_MODES.BLEND_NONE);

    if (n >= 0) this._setBlendMode(this._stackBlendMode[n], this._stackBlendModePremul[n]);
};


// --------------------------------------
// state stencil

Context.prototype._stackStencil = [];

/**
 * enable / disable stencil testing

* @function pushStencil
 * @memberof Context
 * @instance
 * @param {Boolean} b enable
 */
Context.prototype.pushStencil = function (b)
{
    this._stackStencil.push(b);
    if (!b) this.gl.disable(this.gl.STENCIL_TEST);
    else this.gl.enable(this.gl.STENCIL_TEST);
};

/**
 * pop stencil test state and set the previous state
 * @function popStencil
 * @memberof Context
 * @instance
 */
Context.prototype.popStencil = function ()
{
    this._stackStencil.pop();

    if (!this._stackStencil[this._stackStencil.length - 1]) this.gl.disable(this.gl.STENCIL_TEST);
    else this.gl.enable(this.gl.STENCIL_TEST);
};

// --------------------------------------


Context.prototype.glGetAttribLocation = function (prog, name)
{
    const l = this.gl.getAttribLocation(prog, name);
    // if (l == -1)
    // {
    //     this._log.warn("get attr loc -1 ", name);
    // }
    return l;
};


/**
 * should an op now draw helpermeshes
 * @function shouldDrawHelpers
 * @memberof Context
 * @param op
 * @instance
 */
Context.prototype.shouldDrawHelpers = function (op)
{
    if (this.tempData.shadowPass) return false;
    if (!op.patch.isEditorMode()) return false;

    // const fb = this.getCurrentFrameBuffer();
    // if (fb && fb.getWidth)
    // {
    //     const fbshould = this.canvasWidth / this.canvasHeight == fb.getWidth() / fb.getHeight();
    //     if (!fbshould) return false;
    // }

    return gui.shouldDrawOverlay;// || (CABLES.UI.renderHelperCurrent && op.isCurrentUiOp());
};

Context.prototype._setBlendMode = function (blendMode, premul)
{
    const gl = this.gl;

    if (blendMode == constants_CONSTANTS.BLEND_MODES.BLEND_NONE)
    {
        // this.gl.disable(this.gl.BLEND);
    }
    else if (blendMode == constants_CONSTANTS.BLEND_MODES.BLEND_ADD)
    {
        if (premul)
        {
            gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);
            gl.blendFuncSeparate(gl.ONE, gl.ONE, gl.ONE, gl.ONE);
        }
        else
        {
            gl.blendEquation(gl.FUNC_ADD);
            gl.blendFunc(gl.SRC_ALPHA, gl.ONE);
        }
    }
    else if (blendMode == constants_CONSTANTS.BLEND_MODES.BLEND_SUB)
    {
        if (premul)
        {
            gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);
            gl.blendFuncSeparate(gl.ZERO, gl.ZERO, gl.ONE_MINUS_SRC_COLOR, gl.ONE_MINUS_SRC_ALPHA);
        }
        else
        {
            gl.blendEquation(gl.FUNC_ADD);
            gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);
        }
    }
    else if (blendMode == constants_CONSTANTS.BLEND_MODES.BLEND_MUL)
    {
        if (premul)
        {
            gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);
            gl.blendFuncSeparate(gl.ZERO, gl.SRC_COLOR, gl.ZERO, gl.SRC_ALPHA);
        }
        else
        {
            gl.blendEquation(gl.FUNC_ADD);
            gl.blendFunc(gl.ZERO, gl.SRC_COLOR);
        }
    }
    else if (blendMode == constants_CONSTANTS.BLEND_MODES.BLEND_NORMAL)
    {
        if (premul)
        {
            gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);
            gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
        }
        else
        {
            gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);
            gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
        }
    }
    else
    {
        this._log.log("setblendmode: unknown blendmode");
    }
};

Context.prototype.createMesh = function (geom, options)
{
    if (CABLES.UTILS.isNumeric(options))options = { "glPrimitive": options }; // old constructor fallback...
    return new CGL.Mesh(this, geom, options);
};


/**
 * set cursor
 * @function setCursor
 * @memberof Context
 * @instance
 * @param {String} str css cursor string
 */
Context.prototype.setCursor = function (str)
{
    this._cursor = str;
};

/**
 * enable a webgl extension
 * @function enableExtension
 * @memberof Context
 * @instance
 * @param {String} name extension name
 * @returns {Object} extension object or null
 */
Context.prototype.enableExtension = function (name)
{
    if (!this.gl) return null;

    if (this._enabledExtensions.hasOwnProperty(name))
        return this._enabledExtensions[name];

    const o = this.gl.getExtension(name);
    this._enabledExtensions[name] = o;

    if (!o)
        this._log.warn("[cgl_state] extension not available " + name);
    // else
        // this._log.log("enabled extension", name);

    return o;
};

Context.prototype.checkTextureSize = function (x)
{
    x = x || 1;
    x = Math.floor(x);
    x = Math.min(x, this.maxTexSize);
    x = Math.max(x, 1);
    return x;
};





;// CONCATENATED MODULE: ./src/core/core_variable.js


/**
 * @type {Object}
 * @name PatchVariable
 * @param {String} name
 * @param {String|Number} value
 * @memberof Patch
 * @constructor
 */
class PatchVariable extends Events
{
    constructor(name, val, type)
    {
        super();
        this._name = name;
        this.type = type;
        this.setValue(val);
    }

    /**
     * keeping this for backwards compatibility in older
     * exports before using eventtarget
     *
     * @param cb
     */
    addListener(cb)
    {
        this.on("change", cb, "var");
    }

    /**
     * @function Variable.getValue
     * @memberof PatchVariable
     * @returns {String|Number|Boolean}
     */
    getValue()
    {
        return this._v;
    }

    /**
     * @function getName
     * @memberof PatchVariable
     * @instance
     * @returns {String|Number|Boolean}
     * @function
     */
    getName()
    {
        return this._name;
    }

    /**
     * @function setValue
     * @memberof PatchVariable
     * @instance
     * @param v
     * @returns {String|Number|Boolean}
     * @function
     */
    setValue(v)
    {
        this._v = v;
        this.emitEvent("change", v, this);
    }
}

/* harmony default export */ const core_variable = (PatchVariable);

;// CONCATENATED MODULE: ./src/core/core_patch.js












/**
 * Patch class, contains all operators,values,links etc. manages loading and running of the whole patch
 *
 * see {@link PatchConfig}
 *
 * @namespace external:CABLES#Patch
 * @hideconstructor
 * @param {PatchConfig} cfg The configuration object.
 * @class
 * @example
 * CABLES.patch=new CABLES.Patch(
 * {
 *     patch:pStr,
 *     glCanvasId:'glcanvas',
 *     glCanvasResizeToWindow:true,
 *     canvas:{powerPreference:"high-performance"},
 *     prefixAssetPath:'/assets/',
 *     prefixJsPath:'/js/',
 *     onError:function(e){console.log(e);}
 *     glslPrecision:'highp'
 * });
 */

class Patch extends EventTarget
{
// const Patch(cfg)
    constructor(cfg)
    {
        super();
        // EventTarget.apply(this);

        this._log = new Logger("core_patch", { "onError": cfg.onError });
        this.ops = [];
        this.settings = {};
        this.config = cfg ||
        {
            "glCanvasResizeToWindow": false,
            "prefixAssetPath": "",
            "prefixJsPath": "",
            "silent": true,
            "onError": null,
            "onFinishedLoading": null,
            "onFirstFrameRendered": null,
            "onPatchLoaded": null,
            "fpsLimit": 0
        };
        this.timer = new Timer();
        this.freeTimer = new Timer();
        this.animFrameOps = [];
        this.animFrameCallbacks = [];
        this.gui = false;
        CABLES.logSilent = this.silent = true;
        this.profiler = null;
        this.aborted = false;
        this._crashedOps = [];
        this._renderOneFrame = false;
        this._animReq = null;
        this._opIdCache = {};
        this._triggerStack = [];
        this.storeObjNames = false; // remove after may release

        this.loading = new LoadingStatus(this);

        this._volumeListeners = [];
        this._paused = false;
        this._frameNum = 0;
        this.onOneFrameRendered = null;
        this.namedTriggers = {};

        this._origData = null;
        this._frameNext = 0;
        this._frameInterval = 0;
        this._lastFrameTime = 0;
        this._frameWasdelayed = true;
        this.tempData = this.frameStore = {};
        this.deSerialized = false;
        this.reqAnimTimeStamp = 0;

        this.cgCanvas = null;

        if (!(function () { return !this; }())) console.log("not in strict mode: core patch");

        this._isLocal = document.location.href.indexOf("file:") === 0;

        if (this.config.hasOwnProperty("silent")) this.silent = CABLES.logSilent = this.config.silent;
        if (!this.config.hasOwnProperty("doRequestAnimation")) this.config.doRequestAnimation = true;

        if (!this.config.prefixAssetPath) this.config.prefixAssetPath = "";
        if (!this.config.prefixJsPath) this.config.prefixJsPath = "";
        if (!this.config.masterVolume) this.config.masterVolume = 1.0;

        this._variables = {};
        this._variableListeners = [];
        this.vars = {};
        if (cfg && cfg.vars) this.vars = cfg.vars; // vars is old!

        this.cgl = new Context(this);
        this.cgp = null;

        this._subpatchOpCache = {};

        this.cgl.setCanvas(this.config.glCanvasId || this.config.glCanvas || "glcanvas");
        if (this.config.glCanvasResizeToWindow === true) this.cgl.setAutoResize("window");
        if (this.config.glCanvasResizeToParent === true) this.cgl.setAutoResize("parent");
        this.loading.setOnFinishedLoading(this.config.onFinishedLoading);

        if (this.cgl.aborted) this.aborted = true;
        if (this.cgl.silent) this.silent = true;

        this.freeTimer.play();
        this.exec();

        if (!this.aborted)
        {
            if (this.config.patch)
            {
                this.deSerialize(this.config.patch);
            }
            else if (this.config.patchFile)
            {
                ajax(
                    this.config.patchFile,
                    (err, _data) =>
                    {
                        try
                        {
                            const data = JSON.parse(_data);
                            if (err)
                            {
                                const txt = "";
                                this._log.error("err", err);
                                this._log.error("data", data);
                                this._log.error("data", data.msg);
                                return;
                            }
                            this.deSerialize(data);
                        }
                        catch (e)
                        {
                            this._log.error("could not load/parse patch ", e);
                        }
                    }
                );
            }
            this.timer.play();
        }

    console.log("made with https://cables.gl"); // eslint-disable-line
    }

    isPlaying()
    {
        return !this._paused;
    }

    isRenderingOneFrame()
    {
        return this._renderOneFrame;
    }


    renderOneFrame()
    {
        this._paused = true;
        this._renderOneFrame = true;
        this.exec();
        this._renderOneFrame = false;
    }

    /**
 * current number of frames per second
 * @function getFPS
 * @memberof Patch
 * @instance
 * @return {Number} fps
 */
    getFPS()
    {
        this._log.error("deprecated getfps");
        return 0;
    }

    /**
 * returns true if patch is opened in editor/gui mode
 * @function isEditorMode
 * @memberof Patch
 * @instance
 * @return {Boolean} editor mode
 */
    isEditorMode()
    {
        return this.config.editorMode === true;
    }

    /**
 * pauses patch execution
 * @function pause
 * @memberof Patch
 * @instance
 */
    pause()
    {
        cancelAnimationFrame(this._animReq);
        this.emitEvent("pause");
        this._animReq = null;
        this._paused = true;
        this.freeTimer.pause();
    }

    /**
 * resumes patch execution
 * @function resume
 * @memberof Patch
 * @instance
 */
    resume()
    {
        if (this._paused)
        {
            cancelAnimationFrame(this._animReq);
            this._paused = false;
            this.freeTimer.play();
            this.emitEvent("resume");
            this.exec();
        }
    }

    /**
 * set volume [0-1]
 * @function setVolume
 * @param {Number} v volume
 * @memberof Patch
 * @instance
 */
    setVolume(v)
    {
        this.config.masterVolume = v;
        for (let i = 0; i < this._volumeListeners.length; i++) this._volumeListeners[i].onMasterVolumeChanged(v);
    }


    /**
 * get asset path
 * @function getAssetPath
 * @memberof Patch
 * @param patchId
 * @instance
 */
    getAssetPath(patchId = null)
    {
        if (this.config.hasOwnProperty("assetPath"))
        {
            return this.config.assetPath;
        }
        else if (this.isEditorMode())
        {
            let id = patchId || gui.project()._id;
            return "/assets/" + id + "/";
        }
        else if (document.location.href.indexOf("cables.gl") > 0 || document.location.href.indexOf("cables.local") > 0)
        {
            const parts = document.location.pathname.split("/");
            let id = patchId || parts[parts.length - 1];
            return "/assets/" + id + "/";
        }
        else
        {
            return "assets/";
        }
    }

    /**
 * get js path
 * @function getJsPath
 * @memberof Patch
 * @instance
 */
    getJsPath()
    {
        if (this.config.hasOwnProperty("jsPath"))
        {
            return this.config.jsPath;
        }
        else
        {
            return "js/";
        }
    }

    /**
 * get url/filepath for a filename
 * this uses prefixAssetpath in exported patches
 * @function getFilePath
 * @memberof Patch
 * @instance
 * @param {String} filename
 * @return {String} url
 */
    getFilePath(filename)
    {
        if (!filename) return filename;
        filename = String(filename);
        if (filename.indexOf("https:") === 0 || filename.indexOf("http:") === 0) return filename;
        if (filename.indexOf("data:") === 0) return filename;
        if (filename.indexOf("file:") === 0) return filename;
        filename = filename.replace("//", "/");
        if (filename.startsWith(this.config.prefixAssetPath)) filename = filename.replace(this.config.prefixAssetPath, "");
        return this.config.prefixAssetPath + filename + (this.config.suffixAssetPath || "");
    }

    clear()
    {
        this.emitEvent("patchClearStart");
        this.cgl.TextureEffectMesh = null;
        this.animFrameOps.length = 0;
        this.timer = new Timer();
        while (this.ops.length > 0) this.deleteOp(this.ops[0].id);

        this._opIdCache = {};
        this.emitEvent("patchClearEnd");
    }




    createOp(identifier, id, opName = null)
    {
        let op = null;
        let objName = "";

        try
        {
            if (!identifier)
            {
                console.error("createop identifier false", identifier);
                console.log((new Error()).stack);
                return;
            }
            if (identifier.indexOf("Ops.") === -1)
            {
                // this should be a uuid, not a namespace
                // creating ops by id should be the default way from now on!
                const opId = identifier;



                if (CABLES.OPS[opId])
                {
                    objName = CABLES.OPS[opId].objName;
                    op = new CABLES.OPS[opId].f(this, objName, id, opId);
                    op.opId = opId;
                }
                else
                {
                    if (opName)
                    {
                        identifier = opName;
                        this._log.warn("could not find op by id: " + opId);
                    }
                    else
                    {
                        throw new Error("could not find op by id: " + opId, { "cause": "opId:" + opId });
                    }
                }
            }

            if (!op)
            {
                // fallback: create by objname!
                objName = identifier;
                const parts = identifier.split(".");
                const opObj = Patch.getOpClass(objName);

                if (!opObj)
                {
                    this.emitEvent("criticalError", { "title": "unknown op" + objName, "text": "unknown op: " + objName });

                    this._log.error("unknown op: " + objName);
                    throw new Error("unknown op: " + objName);
                }
                else
                {
                    if (parts.length == 2) op = new window[parts[0]][parts[1]](this, objName, id);
                    else if (parts.length == 3) op = new window[parts[0]][parts[1]][parts[2]](this, objName, id);
                    else if (parts.length == 4) op = new window[parts[0]][parts[1]][parts[2]][parts[3]](this, objName, id);
                    else if (parts.length == 5) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]](this, objName, id);
                    else if (parts.length == 6) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]](this, objName, id);
                    else if (parts.length == 7) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]](this, objName, id);
                    else if (parts.length == 8) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]](this, objName, id);
                    else if (parts.length == 9) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]][parts[8]](this, objName, id);
                    else if (parts.length == 10) op = new window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]][parts[8]][parts[9]](this, objName, id);
                    else console.log("parts.length", parts.length);
                }

                if (op)
                {
                    op.opId = null;
                    for (const i in CABLES.OPS)
                    {
                        if (CABLES.OPS[i].objName == objName) op.opId = i;
                    }
                }
            }
        }
        catch (e)
        {
            this._crashedOps.push(objName);

            this._log.error("[instancing error] " + objName, e);

            if (!this.isEditorMode())
            {
                this._log.error("INSTANCE_ERR", "Instancing Error: " + objName, e);
                // throw new Error("instancing error 1" + objName);
            }
        }

        if (op)
        {
            op._objName = objName;
            op.patch = this;
        }
        else
        {
            this._log.log("no op was created!?", identifier, id);
        }
        return op;
    }

    /**
     * create a new op in patch
     * @function addOp
     * @memberof Patch
     * @instance
     * @param {string} opIdentifier uuid or name, e.g. Ops.Math.Sum
     * @param {Object} uiAttribs Attributes
     * @param {string} id
     * @param {boolean} fromDeserialize
     * @param {string} opName e.g. Ops.Math.Sum
     * @example
     * // add invisible op
     * patch.addOp('Ops.Math.Sum', { showUiAttribs: false });
     */
    addOp(opIdentifier, uiAttribs, id, fromDeserialize, opName)
    {
        const op = this.createOp(opIdentifier, id, opName);

        if (op)
        {
            uiAttribs = uiAttribs || {};
            if (uiAttribs.hasOwnProperty("errors")) delete uiAttribs.errors;
            if (uiAttribs.hasOwnProperty("error")) delete uiAttribs.error;
            uiAttribs.subPatch = uiAttribs.subPatch || 0;

            op.setUiAttribs(uiAttribs);
            if (op.onCreate) op.onCreate();

            if (op.hasOwnProperty("onAnimFrame")) this.addOnAnimFrame(op);
            if (op.hasOwnProperty("onMasterVolumeChanged")) this._volumeListeners.push(op);

            if (this._opIdCache[op.id])
            {
                this._log.warn("opid with id " + op.id + " already exists in patch!");
                this.deleteOp(op.id); // strange with subpatch ops: why is this needed, somehow ops get added twice ???.....
                // return;
            }

            this.ops.push(op);
            this._opIdCache[op.id] = op;

            if (this._subPatchCacheAdd) this._subPatchCacheAdd(uiAttribs.subPatch, op);
            this.emitEvent("onOpAdd", op, fromDeserialize);

            if (op.init) op.init();

            op.emitEvent("init", fromDeserialize);
        }
        else
        {
            this._log.error("addop: op could not be created: ", opIdentifier);
        }

        return op;
    }

    addOnAnimFrame(op)
    {
        for (let i = 0; i < this.animFrameOps.length; i++) if (this.animFrameOps[i] == op) { return; }

        this.animFrameOps.push(op);
    }

    removeOnAnimFrame(op)
    {
        for (let i = 0; i < this.animFrameOps.length; i++)
        {
            if (this.animFrameOps[i] == op)
            {
                this.animFrameOps.splice(i, 1);
                return;
            }
        }
    }

    addOnAnimFrameCallback(cb)
    {
        this.animFrameCallbacks.push(cb);
    }

    removeOnAnimCallback(cb)
    {
        for (let i = 0; i < this.animFrameCallbacks.length; i++)
        {
            if (this.animFrameCallbacks[i] == cb)
            {
                this.animFrameCallbacks.splice(i, 1);
                return;
            }
        }
    }

    deleteOp(opid, tryRelink, reloadingOp)
    {
        let found = false;
        for (const i in this.ops)
        {
            if (this.ops[i].id == opid)
            {
                const op = this.ops[i];
                let reLinkP1 = null;
                let reLinkP2 = null;

                if (op)
                {
                    found = true;
                    if (tryRelink)
                    {
                        if (op.portsIn.length > 0 && op.portsIn[0].isLinked() && (op.portsOut.length > 0 && op.portsOut[0].isLinked()))
                        {
                            if (op.portsIn[0].getType() == op.portsOut[0].getType() && op.portsIn[0].links[0])
                            {
                                reLinkP1 = op.portsIn[0].links[0].getOtherPort(op.portsIn[0]);
                                reLinkP2 = op.portsOut[0].links[0].getOtherPort(op.portsOut[0]);
                            }
                        }
                    }

                    const opToDelete = this.ops[i];
                    opToDelete.removeLinks();

                    if (this.onDelete)
                    {
                        // todo: remove
                        this._log.warn("deprecated this.onDelete", this.onDelete);
                        this.onDelete(opToDelete);
                    }

                    this.ops.splice(i, 1);
                    opToDelete.emitEvent("delete", opToDelete);
                    this.emitEvent("onOpDelete", opToDelete, reloadingOp);

                    if (this.clearSubPatchCache) this.clearSubPatchCache(opToDelete.uiAttribs.subPatch);

                    if (opToDelete.onDelete) opToDelete.onDelete(reloadingOp);
                    opToDelete.cleanUp();

                    if (reLinkP1 !== null && reLinkP2 !== null)
                    {
                        this.link(reLinkP1.op, reLinkP1.getName(), reLinkP2.op, reLinkP2.getName());
                    }

                    delete this._opIdCache[opid];
                    break;
                }
            }
        }

        if (!found) this._log.warn("core patch deleteop: not found...", opid);
    }

    getFrameNum()
    {
        return this._frameNum;
    }

    emitOnAnimFrameEvent(time, delta)
    {
        time = time || this.timer.getTime();

        for (let i = 0; i < this.animFrameCallbacks.length; ++i)
            if (this.animFrameCallbacks[i])
                this.animFrameCallbacks[i](time, this._frameNum, delta);

        for (let i = 0; i < this.animFrameOps.length; ++i)
            if (this.animFrameOps[i].onAnimFrame)
                this.animFrameOps[i].onAnimFrame(time, this._frameNum, delta);
    }

    renderFrame(timestamp)
    {
        this.timer.update(this.reqAnimTimeStamp);
        this.freeTimer.update(this.reqAnimTimeStamp);
        const time = this.timer.getTime();
        const startTime = performance.now();
        this.cgl.frameStartTime = this.timer.getTime();

        const delta = timestamp - this.reqAnimTimeStamp || timestamp;

        this.emitOnAnimFrameEvent(null, delta);

        this.cgl.profileData.profileFrameDelta = delta;
        this.reqAnimTimeStamp = timestamp;
        this.cgl.profileData.profileOnAnimFrameOps = performance.now() - startTime;

        this.emitEvent("onRenderFrame", time);

        this._frameNum++;
        if (this._frameNum == 1)
        {
            if (this.config.onFirstFrameRendered) this.config.onFirstFrameRendered();
        }
    }

    exec(timestamp)
    {
        if (!this._renderOneFrame && (this._paused || this.aborted)) return;
        this.emitEvent("reqAnimFrame");
        cancelAnimationFrame(this._animReq);

        this.config.fpsLimit = this.config.fpsLimit || 0;
        if (this.config.fpsLimit)
        {
            this._frameInterval = 1000 / this.config.fpsLimit;
        }

        const now = CABLES.now();
        const frameDelta = now - this._frameNext;

        if (this.isEditorMode())
        {
            if (!this._renderOneFrame)
            {
                if (now - this._lastFrameTime >= 500 && this._lastFrameTime !== 0 && !this._frameWasdelayed)
                {
                    this._lastFrameTime = 0;
                    setTimeout(this.exec.bind(this), 500);
                    this.emitEvent("renderDelayStart");
                    this._frameWasdelayed = true;
                    return;
                }
            }
        }

        if (this._renderOneFrame || this.config.fpsLimit === 0 || frameDelta > this._frameInterval || this._frameWasdelayed)
        {
            this.renderFrame(timestamp);

            if (this._frameInterval) this._frameNext = now - (frameDelta % this._frameInterval);
        }

        if (this._frameWasdelayed)
        {
            this.emitEvent("renderDelayEnd");
            this._frameWasdelayed = false;
        }

        if (this._renderOneFrame)
        {
            if (this.onOneFrameRendered) this.onOneFrameRendered(); // todo remove everywhere and use propper event...
            this.emitEvent("renderedOneFrame");
            this._renderOneFrame = false;
        }


        if (this.config.doRequestAnimation) this._animReq = this.cgl.canvas.ownerDocument.defaultView.requestAnimationFrame(this.exec.bind(this));
    }

    /**
     * link two ops/ports
     * @function link
     * @memberof Patch
     * @instance
     * @param {Op} op1
     * @param {String} port1Name
     * @param {Op} op2
     * @param {String} port2Name
     * @param {boolean} lowerCase
     * @param {boolean} fromDeserialize
     */
    link(op1, port1Name, op2, port2Name, lowerCase, fromDeserialize)
    {
        if (!op1) return this._log.warn("link: op1 is null ");
        if (!op2) return this._log.warn("link: op2 is null");

        const port1 = op1.getPort(port1Name, lowerCase);
        const port2 = op2.getPort(port2Name, lowerCase);

        if (!port1) return op1._log.warn("port1 not found! " + port1Name + " (" + op1.objName + ")");
        if (!port2) return op1._log.warn("port2 not found! " + port2Name + " of " + op2.name + "(" + op2.objName + ")", op2);

        if (!port1.shouldLink(port1, port2) || !port2.shouldLink(port1, port2)) return false;

        if (Link.canLink(port1, port2))
        {
            const link = new Link(this);
            link.link(port1, port2);

            this.emitEvent("onLink", port1, port2, link, fromDeserialize);
            return link;
        }
    }

    serialize(options)
    {
        const obj = {};

        options = options || {};
        obj.ops = [];
        obj.settings = this.settings;
        for (const i in this.ops)
        {
            const op = this.ops[i];
            if (op && op.getSerialized)obj.ops.push(op.getSerialized());
        }

        cleanJson(obj);

        if (options.asObject) return obj;
        return JSON.stringify(obj);
    }

    getOpsByRefId(refId)
    {
        const perf = CABLES.UI.uiProfiler.start("[corepatchetend] getOpsByRefId");
        const refOps = [];
        const ops = gui.corePatch().ops;
        for (let i = 0; i < ops.length; i++)
            if (ops[i].storage && ops[i].storage.ref == refId) refOps.push(ops[i]);
        perf.finish();
        return refOps;
    }

    getOpById(opid)
    {
        return this._opIdCache[opid];
    }

    getOpsByName(name)
    {
        // TODO: is this still needed ? unclear behaviour....
        const arr = [];
        for (const i in this.ops)
            if (this.ops[i].name == name) arr.push(this.ops[i]);
        return arr;
    }

    getOpsByObjName(name)
    {
        const arr = [];
        for (const i in this.ops)
            if (this.ops[i].objName == name) arr.push(this.ops[i]);
        return arr;
    }

    getOpsByOpId(opid)
    {
        const arr = [];
        for (const i in this.ops)
            if (this.ops[i].opId == opid) arr.push(this.ops[i]);
        return arr;
    }

    loadLib(which)
    {
        ajaxSync(
            "/ui/libs/" + which + ".js",
            (err, res) =>
            {
                const se = document.createElement("script");
                se.type = "text/javascript";
                se.text = res;
                document.getElementsByTagName("head")[0].appendChild(se);
            },
            "GET",
        );
    }

    getSubPatchOpsByName(patchId, objName)
    {
        const arr = [];
        for (const i in this.ops)
            if (this.ops[i].uiAttribs && this.ops[i].uiAttribs.subPatch == patchId && this.ops[i].objName == objName)
                arr.push(this.ops[i]);

        return arr;
    }

    getSubPatchOp(patchId, objName)
    {
        return this.getFirstSubPatchOpByName(patchId, objName);
    }

    getFirstSubPatchOpByName(patchId, objName)
    {
        for (const i in this.ops)
            if (this.ops[i].uiAttribs && this.ops[i].uiAttribs.subPatch == patchId && this.ops[i].objName == objName)
                return this.ops[i];

        return false;
    }

    _addLink(opinid, opoutid, inName, outName)
    {
        return this.link(this.getOpById(opinid), inName, this.getOpById(opoutid), outName, false, true);
    }

    deSerialize(obj, options)
    {
        options = options || { "genIds": false, "createRef": false };
        if (this.aborted) return;
        const newOps = [];
        const loadingId = this.loading.start("core", "deserialize");

        this.namespace = obj.namespace || "";
        this.name = obj.name || "";

        if (typeof obj === "string") obj = JSON.parse(obj);

        this.settings = obj.settings;

        this.emitEvent("patchLoadStart");

        obj.ops = obj.ops || [];

        if (window.logStartup)logStartup("add " + obj.ops.length + " ops... ");

        const addedOps = [];

        // add ops...
        for (let iop = 0; iop < obj.ops.length; iop++)
        {
            const start = CABLES.now();
            const opData = obj.ops[iop];
            let op = null;

            try
            {
                if (opData.opId) op = this.addOp(opData.opId, opData.uiAttribs, opData.id, true, opData.objName);
                else op = this.addOp(opData.objName, opData.uiAttribs, opData.id, true);
            }
            catch (e)
            {
                this._log.error("[instancing error] op data:", opData, e);
                // throw new Error("could not create op by id: <b>" + (opData.objName || opData.opId) + "</b> (" + opData.id + ")");
            }

            if (op)
            {
                addedOps.push(op);
                if (options.genIds) op.id = shortId();
                op.portsInData = opData.portsIn;
                op._origData = JSON.parse(JSON.stringify(opData));
                op.storage = opData.storage;
                // if (opData.hasOwnProperty("disabled"))op.setEnabled(!opData.disabled);

                for (const ipi in opData.portsIn)
                {
                    const objPort = opData.portsIn[ipi];
                    if (objPort && objPort.hasOwnProperty("name"))
                    {
                        const port = op.getPort(objPort.name);

                        if (port && (port.uiAttribs.display == "bool" || port.uiAttribs.type == "bool") && !isNaN(objPort.value)) objPort.value = objPort.value == true ? 1 : 0;
                        if (port && objPort.value !== undefined && port.type != CONSTANTS.OP.OP_PORT_TYPE_TEXTURE) port.set(objPort.value);

                        if (port)
                        {
                            port.deSerializeSettings(objPort);
                        }
                        else
                        {
                            // if (port.uiAttribs.hasOwnProperty("title"))
                            // {
                            //     op.preservedPortTitles = op.preservedPortTitles || {};
                            //     op.preservedPortTitles[port.name] = port.uiAttribs.title;
                            // }
                            op.preservedPortValues = op.preservedPortValues || {};
                            op.preservedPortValues[objPort.name] = objPort.value;
                        }
                    }
                }

                for (const ipo in opData.portsOut)
                {
                    const objPort = opData.portsOut[ipo];
                    if (objPort && objPort.hasOwnProperty("name"))
                    {
                        const port2 = op.getPort(objPort.name);

                        if (port2)
                        {
                            port2.deSerializeSettings(objPort);

                            if (port2.uiAttribs.hasOwnProperty("title"))
                            {
                                op.preservedPortTitles = op.preservedPortTitles || {};
                                op.preservedPortTitles[port2.name] = port2.uiAttribs.title;
                            }


                            if (port2.type != CONSTANTS.OP.OP_PORT_TYPE_TEXTURE && objPort.hasOwnProperty("value"))
                                port2.set(obj.ops[iop].portsOut[ipo].value);

                            if (objPort.expose) port2.setUiAttribs({ "expose": true });
                        }
                    }
                }
                newOps.push(op);
            }

            const timeused = Math.round(100 * (CABLES.now() - start)) / 100;
            if (!this.silent && timeused > 5) console.log("long op init ", obj.ops[iop].objName, timeused);
        }
        if (window.logStartup)logStartup("add ops done");

        for (const i in this.ops)
        {
            if (this.ops[i].onLoadedValueSet)
            {
                this.ops[i].onLoadedValueSet(this.ops[i]._origData);
                this.ops[i].onLoadedValueSet = null;
                this.ops[i]._origData = null;
            }
            this.ops[i].emitEvent("loadedValueSet");
        }

        if (window.logStartup)logStartup("creating links");

        if (options.opsCreated)options.opsCreated(addedOps);
        // create links...
        if (obj.ops)
        {
            for (let iop = 0; iop < obj.ops.length; iop++)
            {
                if (obj.ops[iop].portsIn)
                {
                    for (let ipi2 = 0; ipi2 < obj.ops[iop].portsIn.length; ipi2++)
                    {
                        if (obj.ops[iop].portsIn[ipi2] && obj.ops[iop].portsIn[ipi2].links)
                        {
                            for (let ili = 0; ili < obj.ops[iop].portsIn[ipi2].links.length; ili++)
                            {
                                const l = this._addLink(
                                    obj.ops[iop].portsIn[ipi2].links[ili].objIn,
                                    obj.ops[iop].portsIn[ipi2].links[ili].objOut,
                                    obj.ops[iop].portsIn[ipi2].links[ili].portIn,
                                    obj.ops[iop].portsIn[ipi2].links[ili].portOut);

                                // const took = performance.now - startTime;
                                // if (took > 100)console.log(obj().ops[iop].portsIn[ipi2].links[ili].objIn, obj.ops[iop].portsIn[ipi2].links[ili].objOut, took);
                            }
                        }
                    }
                }
                if (obj.ops[iop].portsOut)
                    for (let ipi2 = 0; ipi2 < obj.ops[iop].portsOut.length; ipi2++)
                        if (obj.ops[iop].portsOut[ipi2] && obj.ops[iop].portsOut[ipi2].links)
                        {
                            for (let ili = 0; ili < obj.ops[iop].portsOut[ipi2].links.length; ili++)
                            {
                                if (obj.ops[iop].portsOut[ipi2].links[ili])
                                {
                                    if (obj.ops[iop].portsOut[ipi2].links[ili].subOpRef)
                                    {
                                        // lost link
                                        const outOp = this.getOpById(obj.ops[iop].portsOut[ipi2].links[ili].objOut);
                                        let dstOp = null;
                                        let theSubPatch = 0;

                                        for (let i = 0; i < this.ops.length; i++)
                                        {
                                            if (
                                                this.ops[i].storage &&
                                                this.ops[i].storage.ref == obj.ops[iop].portsOut[ipi2].links[ili].subOpRef &&
                                                outOp.uiAttribs.subPatch == this.ops[i].uiAttribs.subPatch
                                            )
                                            {
                                                theSubPatch = this.ops[i].patchId.get();
                                                break;
                                            }
                                        }

                                        for (let i = 0; i < this.ops.length; i++)
                                        {
                                            if (
                                                this.ops[i].storage &&
                                                this.ops[i].storage.ref == obj.ops[iop].portsOut[ipi2].links[ili].refOp &&
                                                this.ops[i].uiAttribs.subPatch == theSubPatch)
                                            {
                                                dstOp = this.ops[i];
                                                break;
                                            }
                                        }

                                        if (!dstOp) this._log.warn("could not find op for lost link");
                                        else
                                        {
                                            const l = this._addLink(
                                                dstOp.id,
                                                obj.ops[iop].portsOut[ipi2].links[ili].objOut,

                                                obj.ops[iop].portsOut[ipi2].links[ili].portIn,
                                                obj.ops[iop].portsOut[ipi2].links[ili].portOut);
                                        }
                                    }
                                    else
                                    {
                                        const l = this._addLink(obj.ops[iop].portsOut[ipi2].links[ili].objIn, obj.ops[iop].portsOut[ipi2].links[ili].objOut, obj.ops[iop].portsOut[ipi2].links[ili].portIn, obj.ops[iop].portsOut[ipi2].links[ili].portOut);

                                        if (!l)
                                        {
                                            const op1 = this.getOpById(obj.ops[iop].portsOut[ipi2].links[ili].objIn);
                                            const op2 = this.getOpById(obj.ops[iop].portsOut[ipi2].links[ili].objOut);

                                            if (!op1)console.log("could not find link op1");
                                            if (!op2)console.log("could not find link op2");

                                            const p1Name = obj.ops[iop].portsOut[ipi2].links[ili].portIn;

                                            if (op1 && !op1.getPort(p1Name))
                                            {
                                                // console.log("PRESERVE port 1 not found", p1Name);

                                                op1.preservedPortLinks[p1Name] = op1.preservedPortLinks[p1Name] || [];
                                                op1.preservedPortLinks[p1Name].push(obj.ops[iop].portsOut[ipi2].links[ili]);
                                            }

                                            const p2Name = obj.ops[iop].portsOut[ipi2].links[ili].portOut;
                                            if (op2 && !op2.getPort(p2Name))
                                            {
                                                // console.log("PRESERVE port 2 not found", obj.ops[iop].portsOut[ipi2].links[ili].portOut);
                                                op2.preservedPortLinks[p1Name] = op2.preservedPortLinks[p1Name] || [];
                                                op2.preservedPortLinks[p1Name].push(obj.ops[iop].portsOut[ipi2].links[ili]);
                                            }
                                        }
                                    }
                                }
                            }
                        }
            }
        }

        if (window.logStartup)logStartup("calling ops onloaded");

        for (const i in this.ops)
        {
            if (this.ops[i].onLoaded)
            {
                // TODO: deprecate!!!
                this.ops[i].onLoaded();
                this.ops[i].onLoaded = null;
            }
        }

        if (window.logStartup)logStartup("initializing ops...");
        for (const i in this.ops)
        {
            if (this.ops[i].init)
            {
                try
                {
                    this.ops[i].init();
                    this.ops[i].init = null;
                }
                catch (e)
                {
                    console.error("op.init crash", e);
                }
            }
        }

        if (window.logStartup)logStartup("initializing vars...");

        if (this.config.variables)
            for (const varName in this.config.variables)
                this.setVarValue(varName, this.config.variables[varName]);

        if (window.logStartup)logStartup("initializing var ports");

        for (const i in this.ops)
        {
            this.ops[i].initVarPorts();
            delete this.ops[i].uiAttribs.pasted;
        }

        setTimeout(() => { this.loading.finished(loadingId); }, 100);

        if (this.config.onPatchLoaded) this.config.onPatchLoaded(this);

        this.deSerialized = true;
        this.emitEvent("patchLoadEnd", newOps, obj, options.genIds);
    }

    profile(enable)
    {
        this.profiler = new Profiler(this);
        for (const i in this.ops)
        {
            this.ops[i].profile(enable);
        }
    }

    // ----------------------

    /**
     * set variable value
     * @function setVariable
     * @memberof Patch
     * @instance
     * @param {String} name of variable
     * @param {Number|String|Boolean} val value
     */
    setVariable(name, val)
    {
        // if (this._variables.hasOwnProperty(name))
        if (this._variables[name] !== undefined)
        {
            this._variables[name].setValue(val);
        }
        else
        {
            this._log.warn("variable " + name + " not found!");
        }
    }

    _sortVars()
    {
        if (!this.isEditorMode()) return;
        const ordered = {};
        Object.keys(this._variables).sort(
            (a, b) =>
            { return a.localeCompare(b, "en", { "sensitivity": "base" }); }
        ).forEach((key) =>
        {
            ordered[key] = this._variables[key];
        });
        this._variables = ordered;
    }

    /**
     * has variable
     * @function hasVariable
     * @memberof Patch
     * @instance
     * @param {String} name of variable
     */
    hasVar(name)
    {
        return this._variables[name] !== undefined;

        // return this._variables.hasOwnProperty(name);
    }

    // used internally
    setVarValue(name, val, type)
    {
        if (this.hasVar(name))
        {
            this._variables[name].setValue(val);
        }
        else
        {
            this._variables[name] = new core_variable(name, val, type);
            this._sortVars();
            this.emitEvent("variablesChanged");
        }
        return this._variables[name];
    }

    // old?
    getVarValue(name, val)
    {
        if (this._variables.hasOwnProperty(name)) return this._variables[name].getValue();
    }

    /**
     * @function getVar
     * @memberof Patch
     * @instance
     * @param {String} name
     * @return {Variable} variable
     */
    getVar(name)
    {
        if (this._variables.hasOwnProperty(name)) return this._variables[name];
    }


    deleteVar(name)
    {
        for (let i = 0; i < this.ops.length; i++)
            for (let j = 0; j < this.ops[i].portsIn.length; j++)
                if (this.ops[i].portsIn[j].getVariableName() == name)
                    this.ops[i].portsIn[j].setVariable(null);

        delete this._variables[name];
        this.emitEvent("variableDeleted", name);
        this.emitEvent("variablesChanged");
    }

    /**
     * @function getVars
     * @memberof Patch
     * @instance
     * @param t
     * @return {Array<Variable>} variables
     * @function
     */
    getVars(t)
    {
        if (t === undefined) return this._variables;

        const vars = [];
        if (t == CABLES.OP_PORT_TYPE_STRING) t = "string";
        if (t == CABLES.OP_PORT_TYPE_VALUE) t = "number";
        if (t == CABLES.OP_PORT_TYPE_ARRAY) t = "array";
        if (t == CABLES.OP_PORT_TYPE_OBJECT) t = "object";

        for (const i in this._variables)
        {
            if (!this._variables[i].type || this._variables[i].type == t) vars.push(this._variables[i]);
        }
        return vars;
    }


    /**
     * @function preRenderOps
     * @memberof Patch
     * @instance
     * @description invoke pre rendering of ops
     * @function
     */
    preRenderOps()
    {
        this._log.log("prerendering...");

        for (let i = 0; i < this.ops.length; i++)
        {
            if (this.ops[i].preRender)
            {
                this.ops[i].preRender();
                this._log.log("prerender " + this.ops[i].objName);
            }
        }
    }

    /**
     * @function dispose
     * @memberof Patch
     * @instance
     * @description stop, dispose and cleanup patch
     */
    dispose()
    {
        this.pause();
        this.clear();
        this.cgl.dispose();
    }

    pushTriggerStack(p)
    {
        this._triggerStack.push(p);
    }

    popTriggerStack()
    {
        this._triggerStack.pop();
    }

    printTriggerStack()
    {
        if (this._triggerStack.length == 0)
        {
            // console.log("stack length", this._triggerStack.length); // eslint-disable-line
            return;
        }
        console.groupCollapsed( // eslint-disable-line
            "trigger port stack " + this._triggerStack[this._triggerStack.length - 1].op.objName + "." + this._triggerStack[this._triggerStack.length - 1].name,
        );

        const rows = [];
        for (let i = 0; i < this._triggerStack.length; i++)
        {
            rows.push(i + ". " + this._triggerStack[i].op.objName + " " + this._triggerStack[i].name);
        }

        console.table(rows); // eslint-disable-line
        console.groupEnd(); // eslint-disable-line
    }

    /**
     * returns document object of the patch could be != global document object when opening canvas ina popout window
     * @function getDocument
     * @memberof Patch
     * @instance
     * @return {Object} document
     */
    getDocument()
    {
        return this.cgl.canvas.ownerDocument;
    }
}

Patch.getOpClass = function (objName)
{
    const parts = objName.split(".");
    let opObj = null;

    try
    {
        if (parts.length == 2) opObj = window[parts[0]][parts[1]];
        else if (parts.length == 3) opObj = window[parts[0]][parts[1]][parts[2]];
        else if (parts.length == 4) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]];
        else if (parts.length == 5) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]];
        else if (parts.length == 6) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]];
        else if (parts.length == 7) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]];
        else if (parts.length == 8) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]];
        else if (parts.length == 9) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]][parts[8]];
        else if (parts.length == 10) opObj = window[parts[0]][parts[1]][parts[2]][parts[3]][parts[4]][parts[5]][parts[6]][parts[7]][parts[8]][parts[9]];
        return opObj;
    }
    catch (e)
    {
        return null;
    }
};



Patch.replaceOpIds = function (json, options)
{
    const opids = {};
    for (const i in json.ops)
    {
        opids[json.ops[i].id] = json.ops[i];
    }

    for (const j in json.ops)
    {
        for (const k in json.ops[j].portsOut)
        {
            const links = json.ops[j].portsOut[k].links;
            if (links)
            {
                let l = links.length;

                while (l--)
                {
                    if (links[l] && (!opids[links[l].objIn] || !opids[links[l].objOut]))
                    {
                        if (!options.doNotUnlinkLostLinks)
                        {
                            links.splice(l, 1);
                        }
                        else
                        {
                            if (options.fixLostLinks)
                            {
                                // console.log("lost link...?", links[l]);
                                const op = gui.corePatch().getOpById(links[l].objIn);
                                if (!op) console.log("op not found!");
                                else
                                {
                                    const outerOp = gui.patchView.getSubPatchOuterOp(op.uiAttribs.subPatch);
                                    if (outerOp)
                                    {
                                        op.storage = op.storage || {};
                                        op.storage.ref = op.storage.ref || CABLES.shortId();
                                        links[l].refOp = op.storage.ref;
                                        links[l].subOpRef = outerOp.storage.ref;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }



    for (const i in json.ops)
    {
        const op = json.ops[i];
        const oldId = op.id;
        let newId = CABLES.shortId();

        if (options.prefixHash) newId = prefixedHash(options.prefixHash + oldId);

        else if (options.prefixId) newId = options.prefixId + oldId;
        else if (options.refAsId) // when saving json
        {
            if (op.storage && op.storage.ref)
            {
                newId = op.storage.ref;
                delete op.storage.ref;
            }
            else
            {
                op.storage = op.storage || {};
                op.storage.ref = newId = CABLES.shortId();
            }
        }

        const newID = op.id = newId;

        if (options.oldIdAsRef) // when loading json
        {
            op.storage = op.storage || {};
            op.storage.ref = oldId;
        }

        for (const j in json.ops)
        {
            if (json.ops[j].portsIn)
                for (const k in json.ops[j].portsIn)
                {
                    if (json.ops[j].portsIn[k].links)
                    {
                        let l = json.ops[j].portsIn[k].links.length;

                        while (l--) if (json.ops[j].portsIn[k].links[l] === null) json.ops[j].portsIn[k].links.splice(l, 1);

                        for (l in json.ops[j].portsIn[k].links)
                        {
                            if (json.ops[j].portsIn[k].links[l].objIn === oldId) json.ops[j].portsIn[k].links[l].objIn = newID;
                            if (json.ops[j].portsIn[k].links[l].objOut === oldId) json.ops[j].portsIn[k].links[l].objOut = newID;
                        }
                    }
                }

            if (json.ops[j].portsOut)
                for (const k in json.ops[j].portsOut)
                {
                    if (json.ops[j].portsOut[k].links)
                    {
                        let l = json.ops[j].portsOut[k].links.length;

                        while (l--) if (json.ops[j].portsOut[k].links[l] === null) json.ops[j].portsOut[k].links.splice(l, 1);

                        for (l in json.ops[j].portsOut[k].links)
                        {
                            if (json.ops[j].portsOut[k].links[l].objIn === oldId) json.ops[j].portsOut[k].links[l].objIn = newID;
                            if (json.ops[j].portsOut[k].links[l].objOut === oldId) json.ops[j].portsOut[k].links[l].objOut = newID;
                        }
                    }
                }
        }
    }

    // set correct subpatch
    const subpatchIds = [];
    const fixedSubPatches = [];

    for (let i = 0; i < json.ops.length; i++)
    {
        // if (CABLES.Op.isSubPatchOpName(json.ops[i].objName))
        if (json.ops[i].storage && json.ops[i].storage.subPatchVer)
        {
            for (const k in json.ops[i].portsIn)
            {
                if (json.ops[i].portsIn[k].name === "patchId")
                {
                    let newId = shortId();

                    if (options.prefixHash) newId = prefixedHash(options.prefixHash + json.ops[i].portsIn[k].value);

                    const oldSubPatchId = json.ops[i].portsIn[k].value;
                    const newSubPatchId = json.ops[i].portsIn[k].value = newId;

                    subpatchIds.push(newSubPatchId);

                    for (let j = 0; j < json.ops.length; j++)
                    {
                        // op has no uiAttribs in export, we don't care about subpatches in export though
                        if (json.ops[j].uiAttribs)
                        {
                            if (json.ops[j].uiAttribs.subPatch === oldSubPatchId)
                            {
                                json.ops[j].uiAttribs.subPatch = newSubPatchId;
                                fixedSubPatches.push(json.ops[j].id);
                            }
                        }
                    }
                }
            }
        }
    }

    for (const kk in json.ops)
    {
        let found = false;
        for (let j = 0; j < fixedSubPatches.length; j++)
        {
            if (json.ops[kk].id === fixedSubPatches[j])
            {
                found = true;
                break;
            }
        }
        // op has no uiAttribs in export, we don't care about subpatches in export though
        if (!found && json.ops[kk].uiAttribs && options.parentSubPatchId != null)
            json.ops[kk].uiAttribs.subPatch = options.parentSubPatchId;
    }

    return json;
};
/**
 * remove an eventlistener
 * @instance
 * @function addEventListener
 * @param {String} name of event
 * @param {function} callback
 */

/**
 * remove an eventlistener
 * @instance
 * @function removeEventListener
 * @param {String} name of event
 * @param {function} callback
 */

/**
 * op added to patch event
 * @event onOpAdd
 *
 * @memberof Patch
 * @type {Object}
 * @property {Op} op new op
 */

/**
 * op deleted from patch
 * @event onOpDelete
 * @memberof Patch
 * @type {Object}
 * @property {Op} op that will be deleted
 */

/**
 * link event - two ports will be linked
 * @event onLink
 * @memberof Patch
 * @type {Object}
 * @property {Port} port1
 * @property {Port} port2
 */

/**
 * unlink event - a link was deleted
 * @event onUnLink
 * @memberof Patch
 * @type {Object}
 */

/**
 * variables has been changed / a variable has been added to the patch
 * @event variablesChanged
 * @memberof Patch
 * @type {Object}
 * @property {Port} port1
 * @property {Port} port2
 */

/**
 * configuration object for loading a patch
 * @typedef {Object} PatchConfig
 * @hideconstructor
 * @property {String} [prefixAssetPath=''] prefix for path to assets
 * @property {String} [assetPath=''] path to assets
 * @property {String} [jsPath=''] path to javascript files
 * @property {String} [glCanvasId='glcanvas'] dom element id of canvas element
 * @property {Function} [onError=null] called when an error occurs
 * @property {Function} [onFinishedLoading=null] called when patch finished loading all assets
 * @property {Function} [onFirstFrameRendered=null] called when patch rendered it's first frame
 * @property {Boolean} [glCanvasResizeToWindow=false] resize canvas automatically to window size
 * @property {Boolean} [doRequestAnimation=true] do requestAnimationFrame set to false if you want to trigger exec() from outside (only do if you know what you are doing)
 * @property {Boolean} [clearCanvasColor=true] clear canvas in transparent color every frame
 * @property {Boolean} [clearCanvasDepth=true] clear depth every frame
 * @property {Boolean} [glValidateShader=true] enable/disable validation of shaders *
 * @property {Boolean} [silent=false]
 * @property {Number} [fpsLimit=0] 0 for maximum possible frames per second
 * @property {String} [glslPrecision='mediump'] default precision for glsl shader
 *
 */

/* harmony default export */ const core_patch = (Patch);

;// CONCATENATED MODULE: ./src/core/embedding.js



const EMBED = {};

/**
 * add patch into html element (will create canvas and set size to fill containerElement)
 * @name CABLES.EMBED#addPatch
 * @param {object|string} _element containerElement dom element or id of element
 * @param {object} options patch options
 * @function
 */
EMBED.addPatch = function (_element, options)
{
    let el = _element;
    let id = generateUUID();
    if (typeof _element == "string")
    {
        id = _element;
        el = document.getElementById(id);

        if (!el)
        {
            console.error(id + " Polyshape Container Element not found!");
            return;
        }
    }

    const canvEl = document.createElement("canvas");
    canvEl.id = "glcanvas_" + id;
    canvEl.width = el.clientWidth;
    canvEl.height = el.clientHeight;

    window.addEventListener(
        "resize",
        function ()
        {
            this.setAttribute("width", el.clientWidth);
            this.height = el.clientHeight;
        }.bind(canvEl),
    );

    el.appendChild(canvEl);

    options = options || {};
    options.glCanvasId = canvEl.id;

    if (!options.onError)
    {
        options.onError = function (err)
        {
            console.error(err);
        };
    }

    CABLES.patch = new core_patch(options);
    return canvEl;
};



;// CONCATENATED MODULE: ./src/core/webaudio.js
/** @namespace WEBAUDIO */



const WEBAUDIO = {};

WEBAUDIO.toneJsInitialized = false;

/*
 * External JSDoc definitions
 */

/**
 * Part of the Web Audio API, the AudioBuffer interface represents a short audio asset residing in memory.
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer}
 */

/**
 * Part of the Web Audio API, the AudioNode interface is a generic interface for representing an audio processing module.
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/AudioNode}
 */

/**
 * The AudioContext interface represents an audio-processing graph built from audio modules linked together
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/AudioContext}
 */

/**
 * Checks if a global audio context has been created and creates
 * it if necessary. This audio context can be used for native Web Audio as well as Tone.js ops.
 * Associates the audio context with Tone.js if it is being used
 * @param {CABLES.Op} op - The operator which needs the Audio Context
 */
WEBAUDIO.createAudioContext = function (op)
{
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    if (window.AudioContext)
    {
        if (!window.audioContext)
        {
            window.audioContext = new AudioContext();
        }
        // check if tone.js lib is being used
        if (window.Tone && !WEBAUDIO.toneJsInitialized)
        {
            // set current audio context in tone.js
            Tone.setContext(window.audioContext);
            WEBAUDIO.toneJsInitialized = true;
        }
    }
    else
    {
        if (op.patch.config.onError)op.logError("NO_WEBAUDIO", "Web Audio is not supported in this browser.");
        return;
    }
    return window.audioContext;
};

/**
 * Returns the audio context.
 * Before `createAudioContext` must have been called at least once.
 * It most cases you should use `createAudioContext`, which just returns the audio context
 * when it has been created already.
 */
WEBAUDIO.getAudioContext = function ()
{
    return window.audioContext;
};

/**
 * Creates an audio in port for the op with name `portName`
 * When disconnected it will disconnect the previous connected audio node
 * from the op's audio node.
 * @param {CABLES.Op} op - The operator to create the audio port in
 * @param {string} portName - The name of the port
 * @param {AudioNode} audioNode - The audionode incoming connections should connect to
 * @param {number} [inputChannelIndex=0] - If the audio node has multiple inputs, this is the index of the input channel to connect to
 * @returns {CABLES.Port|undefined} - The newly created audio in port or `undefined` if there was an error
 */
WEBAUDIO.createAudioInPort = function (op, portName, audioNode, inputChannelIndex)
{
    if (!op || !portName || !audioNode)
    {
        const msg = "ERROR: createAudioInPort needs three parameters, op, portName and audioNode";
        op.log(msg);
        throw new Error(msg);
        // return;
    }
    if (!inputChannelIndex)
    {
        inputChannelIndex = 0;
    }
    op.webAudio = op.webAudio || {};
    op.webAudio.audioInPorts = op.webAudio.audioInPorts || [];
    const port = op.inObject(portName);
    port.webAudio = {};
    port.webAudio.previousAudioInNode = null;
    port.webAudio.audioNode = audioNode;

    op.webAudio.audioInPorts[portName] = port;

    port.onChange = function ()
    {
        const audioInNode = port.get();
        // when port disconnected, disconnect audio nodes
        if (!audioInNode)
        {
            if (port.webAudio.previousAudioInNode)
            {
                try
                {
                    if (port.webAudio.previousAudioInNode.disconnect) port.webAudio.previousAudioInNode.disconnect(port.webAudio.audioNode, 0, inputChannelIndex);
                    op.setUiError("audioCtx", null);
                }
                catch (e)
                {
                    try
                    {
                        port.webAudio.previousAudioInNode.disconnect(port.webAudio.audioNode);
                    }
                    catch (er)
                    {
                        op.log(
                            "Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",
                            e,
                        );
                        if (e.printStackTrace)
                        {
                            e.printStackTrace();
                        }
                        throw e;
                    }
                }
            }
        }
        else
        {
            try
            {
                if (audioInNode.connect)
                {
                    audioInNode.connect(port.webAudio.audioNode, 0, inputChannelIndex);
                    op.setUiError("audioCtx", null);
                }
                else op.setUiError("audioCtx", "The passed input is not an audio context. Please make sure you connect an audio context to the input.", 2);
            }
            catch (e)
            {
                op.log("Error: Failed to connect web audio node!", e);
                op.log("port.webAudio.audioNode", port.webAudio.audioNode);
                op.log("audioInNode: ", audioInNode);
                op.log("inputChannelIndex:", inputChannelIndex);
                op.log("audioInNode.connect: ", audioInNode.connect);
                throw e;
            }
        }
        port.webAudio.previousAudioInNode = audioInNode;
    };
    // TODO: Maybe add subtype to audio-node-object?
    return port;
};

/**
 * Sometimes it is necessary to replace a node of a port, if so all
 * connections to this node must be disconnected and connections to the new
 * node must be made.
 * Can be used for both Audio ports as well as AudioParam ports
 * if used with an AudioParam pass e.g. `synth.frequency` as newNode
 * @param {CABLES.Port} port - The port where the audio node needs to be replaced
 * @param oldNode
 * @param newNode
 */
WEBAUDIO.replaceNodeInPort = function (port, oldNode, newNode)
{
    const connectedNode = port.webAudio.previousAudioInNode;
    // check if connected
    if (connectedNode && connectedNode.disconnect)
    {
        try
        {
            connectedNode.disconnect(oldNode);
        }
        catch (e)
        {
            if (e.printStackTrace)
            {
                e.printStackTrace();
            }
            throw new Error("replaceNodeInPort: Could not disconnect old audio node. " + e.name + " " + e.message);
        }
        port.webAudio.audioNode = newNode;
        try
        {
            connectedNode.connect(newNode);
        }
        catch (e)
        {
            if (e.printStackTrace)
            {
                e.printStackTrace();
            }
            throw new Error("replaceNodeInPort: Could not connect to new node. " + e.name + " " + e.message);
        }
    }
};

/**
 * Creates an audio out port which takes care of (dis-)connecting on its own
 * @param {CABLES.op} op - The op to create an audio out port for
 * @param {string} portName - The name of the port to be created
 * @param {AudioNode} audioNode - The audio node to link to the port
 * @returns {(CABLES.Port|undefined)} - The newly created audio out port or `undefined` if there was an error
 */
WEBAUDIO.createAudioOutPort = function (op, portName, audioNode)
{
    if (!op || !portName || !audioNode)
    {
        const msg = "ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";
        op.log(msg);
        throw new Error(msg);
    }

    const port = op.outObject(portName);
    // TODO: Maybe add subtype to audio-node-object?
    port.set(audioNode);
    return port;
};

/**
 * Creates an audio param in port for the op with name portName.
 * The port accepts other audio nodes as signals as well as values (numbers)
 * When the port is disconnected it will disconnect the previous connected audio node
 * from the op's audio node and restore the number value set before.
 * @param {CABLES.Op} op - The operator to create an audio param input port for
 * @param {string} portName - The name of the port to create
 * @param audioNode
 * @param options
 * @param defaultValue
 * @returns {(CABLES.Port|undefined)} - The newly created port, which takes care of (dis-)connecting on its own, or `undefined` if there was an error
 */
WEBAUDIO.createAudioParamInPort = function (op, portName, audioNode, options, defaultValue)
{
    if (!op || !portName || !audioNode)
    {
        op.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode");
        if (op && op.name) op.log("opname: ", op.name);
        op.log("portName", portName);
        op.log("audioNode: ", audioNode);
        return;
    }
    op.webAudio = op.webAudio || {};
    op.webAudio.audioInPorts = op.webAudio.audioInPorts || [];
    // var port = op.inObject(portName);
    const port = op.inDynamic(
        portName,
        [CONSTANTS.OP.OP_PORT_TYPE_VALUE, CONSTANTS.OP.OP_PORT_TYPE_OBJECT],
        options,
        defaultValue,
    );
    port.webAudio = {};
    port.webAudio.previousAudioInNode = null;
    port.webAudio.audioNode = audioNode;

    op.webAudio.audioInPorts[portName] = port;

    // port.onLinkChanged = function() {
    //   op.log("onLinkChanged");
    //   if(port.isLinked()) {
    //
    //       if(port.links[0].portOut.type === CABLES.CONSTANTS.OP.OP_PORT_TYPE_) { // value
    //
    //       } else if(port.links[0].portOut.type === CABLES.CONSTANTS.OP.OP_PORT_TYPE_OBJECT) { // object
    //
    //       }
    //   } else { // unlinked
    //
    //   }
    // };

    port.onChange = function ()
    {
        const audioInNode = port.get();
        const node = port.webAudio.audioNode;
        const audioCtx = WEBAUDIO.getAudioContext();

        if (audioInNode != undefined)
        {
            if (typeof audioInNode === "object" && audioInNode.connect)
            {
                try
                {
                    audioInNode.connect(node);
                }
                catch (e)
                {
                    op.log("Could not connect audio node: ", e);
                    if (e.printStackTrace)
                    {
                        e.printStackTrace();
                    }
                    throw e;
                }
                port.webAudio.previousAudioInNode = audioInNode;
            }
            else
            {
                // tone.js audio param
                if (node._param && node._param.minValue && node._param.maxValue)
                {
                    if (audioInNode >= node._param.minValue && audioInNode <= node._param.maxValue)
                    {
                        try
                        {
                            if (node.setValueAtTime)
                            {
                                node.setValueAtTime(audioInNode, audioCtx.currentTime);
                            }
                            else
                            {
                                node.value = audioInNode;
                            }
                        }
                        catch (e)
                        {
                            op.log("Possible AudioParam problem with tone.js op: ", e);
                            if (e.printStackTrace)
                            {
                                e.printStackTrace();
                            }
                            throw e;
                        }
                    }
                    else
                    {
                        op.log("Warning: The value for an audio parameter is out of range!");
                    }
                } // native Web Audio param
                else if (node.minValue && node.maxValue)
                {
                    if (audioInNode >= node.minValue && audioInNode <= node.maxValue)
                    {
                        try
                        {
                            if (node.setValueAtTime)
                            {
                                node.setValueAtTime(audioInNode, audioCtx.currentTime);
                            }
                            else
                            {
                                node.value = audioInNode;
                            }
                        }
                        catch (e)
                        {
                            op.log(
                                "AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",
                                e,
                            );
                            if (e.printStackTrace)
                            {
                                e.printStackTrace();
                            }
                            throw e;
                        }
                    }
                    else
                    {
                        op.log("Warning: The value for an audio parameter is out of range!");
                    }
                } // no min-max values, try anyway
                else
                {
                    try
                    {
                        if (node.setValueAtTime)
                        {
                            node.setValueAtTime(audioInNode, audioCtx.currentTime);
                        }
                        else
                        {
                            node.value = audioInNode;
                        }
                    }
                    catch (e)
                    {
                        op.log("Possible AudioParam problem (without minValue / maxValue): ", e);
                        if (e.printStackTrace)
                        {
                            e.printStackTrace();
                        }
                        throw e;
                    }
                }

                if (port.webAudio.previousAudioInNode && port.webAudio.previousAudioInNode.disconnect)
                {
                    try
                    {
                        port.webAudio.previousAudioInNode.disconnect(node);
                    }
                    catch (e)
                    {
                        op.log("Could not disconnect previous audio node: ", e);
                        throw e;
                    }
                    port.webAudio.previousAudioInNode = undefined;
                }
            }
        }
        else
        {
            // disconnected
            if (port.webAudio.previousAudioInNode)
            {
            }
        }
    };
    return port;
};


/**
 * Loads an audio file and updates the loading indicators when cables is run in the editor.
 * @param {CABLES.Patch} patch - The cables patch, when called from inside an op this is `op.patch`
 * @param {string} url - The url of the audio file to load
 * @param {function} onFinished - The callback to be called when the loading is finished, passes the AudioBuffer
 * @param {function} onError - The callback when there was an error loading the file, the rror message is passed
 * @param loadingTask
 * @see {@link https://developer.mozilla.org/de/docs/Web/API/AudioContext/decodeAudioData}
 */
WEBAUDIO.loadAudioFile = function (patch, url, onFinished, onError, loadingTask)
{
    const audioContext = WEBAUDIO.createAudioContext();

    if (!audioContext) onError(new Error("No Audiocontext"));

    let loadingId = null;
    if (loadingTask || loadingTask === undefined)
    {
        loadingId = patch.loading.start("audio", url);
        if (patch.isEditorMode()) gui.jobs().start({ "id": "loadaudio" + loadingId, "title": " loading audio (" + url + ")" });
    }
    const request = new XMLHttpRequest();

    if (!url) return;

    request.open("GET", url, true);
    request.responseType = "arraybuffer";

    request.onload = function ()
    {
        patch.loading.finished(loadingId);
        if (patch.isEditorMode()) gui.jobs().finish("loadaudio" + loadingId);

        audioContext.decodeAudioData(request.response, onFinished, onError).catch((e) =>
        {
            onError(e);
        });
    };
    request.send();
};

/**
 * Checks if the passed time is a valid time to be used in any of the Tone.js ops.
 * @param {(string|number)} t - The time to check
 * @returns {boolean} - True if time is valid, false if not
 */
WEBAUDIO.isValidToneTime = function (t)
{
    try
    {
        const time = new Tone.Time(t);
    }
    catch (e)
    {
        return false;
    }
    return true;
};

/**
 * Checks if the passed note is a valid note to be used with Tone.js
 * @param {string} note - The note to be checked, e.g. `"C4"`
 * @returns {boolean} - True if the note is a valid note, false otherwise
 */
WEBAUDIO.isValidToneNote = function (note)
{
    try
    {
        Tone.Frequency(note);
    }
    catch (e)
    {
        return false;
    }
    return true;
};



;// CONCATENATED MODULE: ./src/core/sessionvar.js
// todo: old... remove this from ops...

/**
 * todo: old... remove this from ops...
 *
 * @class
 */
const Variable = function ()
{
    let value = null;
    const changedCallbacks = [];

    this.onChanged = function (f)
    {
        changedCallbacks.push(f);
    };

    this.getValue = function ()
    {
        return value;
    };

    this.setValue = function (v)
    {
        value = v;
        this.emitChanged();
    };

    this.emitChanged = function ()
    {
        for (let i = 0; i < changedCallbacks.length; i++)
        {
            changedCallbacks[i]();
        }
    };
};



;// CONCATENATED MODULE: ./src/core/cgp/cgp_uniform.js



class cgp_uniform_Uniform extends cg_uniform
{
    constructor(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName)
    {
        super(__shader, __type, __name, _value, _port2, _port3, _port4, _structUniformName, _structName, _propertyName);
        this._cgp = __shader._cgp;

        if (!_value)
        {
            // if (this.getType() == "m4") this._value = mat4.create();
            if (this.getType() == "t") this._value = this._cgp.getEmptyTexture();
            // else if (this.getType() == "2f") this._value = [0, 0];
            // else if (this.getType() == "4f") this._value = [0, 1, 0, 1];
            // else if (this.getType() == "3f") this._value = [0, 1, 0];
        }

        this.gpuBuffer = null;
    }


    updateValueF() { }

    updateValueArrayF() {}

    setValueArrayF(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    setValueF(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValue2F() { }

    setValue2F(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValue3F() { }

    setValue3F(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValue4F() { }

    setValue4F(v)
    {
        if (v[0] == undefined)
        {
            this._log.stack("uniform value undefined");
            console.error("uniform value undefined");
        }
        this.needsUpdate = true;
        this._value = v;
    }

    setValueT(v)
    {
        if (this._value != v)
            this._shader.needsPipelineUpdate = "texture changed"; // todo really needed ? change binding instead?

        this.needsUpdate = true;
        this._value = v;
    }

    updateValueM4(v) {}

    setValueM4(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    setValueAny(v)
    {
        this.needsUpdate = true;
        this._value = v;
    }

    updateValueAny() {}

    updateValueT() {}


    setGpuBuffer(b)
    {
        this.gpuBuffer = b;
    }

    copyToBuffer(buff, pos = 0)
    {
        if (this._type == "f")
        {
            buff[pos] = this._value;
        }
        else if (this._type == "t")
        {
        }
        else if (this._type == "4f")
        {
            buff[pos] = this._value[0];
            buff[pos + 1] = this._value[1];
            buff[pos + 2] = this._value[2];
            buff[pos + 3] = this._value[3];
        }
        else if (this._type == "f[]")
        {
            for (let i = 0; i < this._value.length; i++)
                buff[pos + i] = this._value[i];
        }
        else if (this._type == "m4")
        {
            for (let i = 0; i < 16; i++)
                buff[pos + i] = this._value[i];
        }
        else
        {
            this._log.warn("uniform copy to buffer unknown", this._type);
        }
    }

    getWgslTypeStr()
    {
        if (this._type == "m4") return "mat4x4f";
        if (this._type == "4f") return "vec4f";
        if (this._type == "3f") return "vec3f";
        if (this._type == "2f") return "vec2f";
        if (this._type == "f") return "float";
        if (this._type == "f[]") return "array<vec4f>";
        if (this._type == "i") return "int";
        if (this._type == "sampler") return "sampler";
        if (this._type == "t") return "texture_2d<f32>";
        this._log.warn("unknown type getWgslTypeStr", this._type);
        return "???";
    }

    getSizeBytes()
    {
        const bytesPerFloat = 4;
        const bytesPerInt = 4;
        if (this._type == "t") return 4;
        if (this._type == "sampler") return 4;
        if (this._type == "f") return 1 * bytesPerFloat;
        if (this._type == "2f") return 2 * bytesPerFloat;
        if (this._type == "3f") return 3 * bytesPerFloat;
        if (this._type == "4f") return 4 * bytesPerFloat;
        if (this._type == "f[]") return this._value.length * bytesPerFloat;

        if (this._type == "m4") return 4 * 4 * bytesPerFloat;

        if (this._type == "i") return 1 * bytesPerInt;
        if (this._type == "2i") return 2 * bytesPerInt;

        this._log.warn("unknown type getSizeBytes", this._type);
        return 4;
    }

    copy(newShader)
    {
        const uni = new cgp_uniform_Uniform(newShader, this._type, this._name, this._value, this._port2, this._port3, this._port4, this._structUniformName, this._structName, this._propertyName);
        uni.shaderType = this.shaderType;

        console.log(this._name, this._value, uni._value);


        return uni;
    }
}

;// CONCATENATED MODULE: ./src/core/cg/preproc.js
function preproc(str, vars)
{
    const lines = str.split("\n");
    const outLines = [];
    let stack = [];

    for (let i = 0; i < lines.length; i++)
    {
        let line = lines[i].trim();
        let parts = line.split(" ");

        if (line.startsWith("#ifdef "))
        {
            const s = vars[parts[1]];
            stack.push({ "state": s });
            continue;
        }
        if (line.startsWith("#ifndef "))
        {
            const s = vars[parts[1]];
            stack.push({ "state": !s });
            continue;
        }
        if (line.startsWith("#endif"))
        {
            stack.pop();
            continue;
        }
        const state = stack[stack.length - 1];

        if (line.startsWith("#else"))
        {
            state.state = !state.state;
            continue;
        }

        if (!state || state.state)
        {
            outLines.push(lines[i]);
        }
    }

    return outLines.join("\n");
}

;// CONCATENATED MODULE: ./src/core/cgp/cgp_gpubuffer.js


class GPUBuffer extends EventTarget
{
    constructor(cgp, name, data = null, options = {})
    {
        super();

        this.id = CABLES.shortId();

        this._name = name;
        this.floatArr = null;
        this._gpuBuffer = null;

        this.setData([0, 0, 0, 0]);
        this.needsUpdate = true;
        this._length = 0;

        if (options.buffCfg)
        {
            this._buffCfg = options.buffCfg;
        }

        if (data)
            this.setData(data);

        if (options.length) this.setLength(options.length);

        this.updateGpuBuffer(cgp);
    }

    setData(d)
    {
        // console.log((new Error()).stack);

        this.floatArr = new Float32Array(d);
        this.setLength(this.floatArr.length);

        // console.log(this.name, this.floatArr);
        this.needsUpdate = true;
    }

    setLength(s)
    {
        this._length = s;
        if (!this.floatArr || s != this.floatArr.length)
        {
            this.floatArr = new Float32Array(this._length);
            this.needsUpdate = true;
        }
    }

    updateGpuBuffer(cgp)
    {
        if (cgp) this._cgp = cgp;
        if (!this._cgp || !this._cgp.device)
        {
            console.log("no cgp...", this._name, this._cgp);
            return;
        }

        this._cgp.pushErrorScope("updateGpuBuffer");
        if (!this._gpuBuffer)
        {
            this._buffCfg = this._buffCfg || {};
            this._buffCfg.label = "gpuBuffer-" + this._name;
            if (!this._buffCfg.hasOwnProperty("size") && this.floatArr) this._buffCfg.size = this.floatArr.length * 4;
            this._buffCfg.usage = this._buffCfg.usage || (GPUBufferUsage.COPY_DST | GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC);

            this._gpuBuffer = this._cgp.device.createBuffer(this._buffCfg);
        }

        // if (!isNaN(this.floatArr[0]))console.log("shit", this._name);

        if (this.floatArr)
            this._cgp.device.queue.writeBuffer(
                this._gpuBuffer,
                0,
                this.floatArr.buffer,
                this.floatArr.byteOffset,
                this.floatArr.byteLength
            );

        // this._gpuBuffer.unmap();

        this._cgp.popErrorScope();

        this.needsUpdate = false;
    }

    get name()
    {
        return this._name;
    }

    get gpuBuffer()
    {
        if (!this._gpuBuffer || this.needsUpdate) this.updateGpuBuffer();

        return this._gpuBuffer;
    }

    get length()
    {
        return this._length;
    }

    getSizeBytes()
    {
        return this.floatArr.length * 4;
    }

    dispose()
    {
        // setTimeout(() =>
        // {
        //     if (this._gpuBuffer) this._gpuBuffer.destroy();
        // }, 100);
    }
}

;// CONCATENATED MODULE: ./src/core/cgp/cgp_binding.js



class Binding
{
    /**
     * Description
     * @param {any} cgp
     * @param {any} idx
     * @param {string} name
     * @param {any} options={}
     */
    constructor(cgp, name, options = {})
    {
        if (typeof options != "object") this._log.error("binding options is not an object");
        this._index = -1;

        this._name = name;
        this._cgp = cgp;
        this._log = new Logger("cgp_binding");
        this.uniforms = [];
        this.cGpuBuffers = [];
        this._options = options;
        this.shader = null;
        this.bindingInstances = [];
        this.stageStr = options.stage;
        this.bindingType = options.bindingType || "uniform"; // "uniform", "storage", "read-only-storage",

        if (this.stageStr == "frag") this.stage = GPUShaderStage.FRAGMENT;
        else this.stage = GPUShaderStage.VERTEX;
        if (options.hasOwnProperty("index")) this._index = options.index;

        if (options.shader) this.shader = options.shader;

        this._buffer = null;
        this.isValid = true;
        this.changed = 0;

        if (this.shader)
        {
            if (this.stageStr == "frag") this.shader.bindingsFrag.push(this);
            if (this.stageStr == "vert") this.shader.bindingsVert.push(this);
            if (this._index == -1) this._index = this.shader.getNewBindingIndex();
        }

        if (this._index == -1) this._log.warn("binding could not get an index", this._name);

        this._cgp.on("deviceChange", () =>
        {
            // this.reInit();
        });
    }

    isStruct()
    {
        if (this.uniforms.length == 0) return false;

        if (this.uniforms.length == 1)
        {
            if (this.uniforms[0].type == "t" || this.uniforms[0].type == "sampler") return false;
            if (this.bindingType != "uniform") return false;
        }

        return true;
    }

    copy(newShader)
    {
        console.log("copy binding...");
        const options = {};

        for (const i in this._options)
            options[i] = this._options[i];

        options.shader = newShader;

        let binding = new Binding(this._cgp, this._name, options);

        for (let i = 0; i < this.uniforms.length; i++)
        {
            binding.addUniform(newShader.getUniform(this.uniforms[i].name)); // .copy(newShader)
        }




        return binding;
    }

    addUniform(uni)
    {
        this.uniforms.push(uni);
    }

    getSizeBytes()
    {
        let size = 0;
        for (let i = 0; i < this.uniforms.length; i++)
        {
            // console.log("UNIFORM!!!", i, this.uniforms[i], this.uniforms[i].getSizeBytes());
            // console.log("getSizeBytes", this.uniforms[i], this.uniforms[i].getSizeBytes);
            size += this.uniforms[i].getSizeBytes();
        }
        // if (this.uniforms.length == 0)console.log("NO UNIFORMS!!!");
        return size;
    }

    getShaderHeaderCode()
    {
        let str = "";

        let typeStr = "strct_" + this._name;
        let name = this._name;

        if (this.uniforms.length === 0) return "// no uniforms in bindinggroup...?\n";


        str += "// " + this.uniforms.length + " uniforms\n";

        if (this.isStruct())
        {
            str += "struct " + typeStr + "\n";
            str += "{\n";
            for (let i = 0; i < this.uniforms.length; i++)
            {
                str += "    " + this.uniforms[i].name + ": " + this.uniforms[i].getWgslTypeStr();
                if (i != this.uniforms.length - 1)str += ",";
                str += "\n";
            }
            str += "};\n";
        }
        else
        {
            typeStr = this.uniforms[0].getWgslTypeStr();
            name = this.uniforms[0].name;
        }

        str += "@group(0) ";
        str += "@binding(" + this._index + ") ";

        if (this.isStruct())
        {
            str += "var<" + this.bindingType + "> ";
        }
        else if (this.bindingType == "read-only-storage")str += "var<storage,read> ";
        else str += "var ";

        str += name + ": " + typeStr + ";\n";

        return str;
    }


    getBindingGroupLayoutEntry()
    {
        let label = "layout " + this._name + " [";
        for (let i = 0; i < this.uniforms.length; i++) label += this.uniforms[i].getName() + ",";
        label += "]";

        const o = {
            "label": label,
            "binding": this._index,
            "visibility": this.stage,
            "size": this.getSizeBytes()
        };

        if (this.uniforms.length == 1 && this.uniforms[0].getType() == "t")
        {
            o.texture = {};
        }
        else if (this.uniforms.length == 1 && this.uniforms[0].getType() == "sampler")
        {
            o.sampler = {};
        }
        else
        {
            o.buffer = {};
            o.buffer.type = this.bindingType;
        }

        return o;
    }

    getBindingGroupEntry(gpuDevice, inst)
    {
        this.isValid = false;

        const o = {
            "label": this._name + " binding",
            "binding": this._index,
            "size": this.getSizeBytes(),
            "visibility": this.stage,
        };

        if (this.uniforms.length == 0)
        {
            console.log("binding uniforms length 0");
            return;
        }

        if (this.uniforms.length == 1 && this.uniforms[0].getType() == "t")
        {
            if (this.uniforms[0].getValue() && this.uniforms[0].getValue().gpuTexture) o.resource = this.uniforms[0].getValue().gpuTexture.createView();
            else o.resource = this._cgp.getEmptyTexture().createView();// CABLES.emptyCglTexture.createView();
        }
        else if (this.uniforms.length == 1 && this.uniforms[0].getType() == "sampler")
        {
            let smplDesc = {
                "addressModeU": "mirror-repeat",
                "addressModeV": "mirror-repeat",
                "magFilter": "linear",
                "minFilter": "linear",
                "mipmapFilter": "linear",
            };

            if (this.uniforms[0].getValue()) smplDesc = this.uniforms[0].getValue().getSampler();

            const sampler = this.uniforms[0]._cgp.device.createSampler(smplDesc);
            o.resource = sampler;
        }
        else
        {
            this._createCgpuBuffer(inst);

            o.resource = {
                "buffer": this.cGpuBuffers[inst].gpuBuffer,
                "minBindingSize": this.getSizeBytes(),
                "hasDynamicOffset": 0
            };
        }

        this.isValid = true;
        this.bindingInstances[inst] = o;

        return o;
    }

    _createCgpuBuffer(inst)
    {
        let buffCfg = {
            "label": this._name,
            "size": this.getSizeBytes(),
            "usage": GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM,
        };

        if (this.bindingType == "read-only-storage" || this.bindingType == "storage") buffCfg.usage = GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST;

        if (this.cGpuBuffers[inst]) this.cGpuBuffers[inst].dispose();
        this.cGpuBuffers[inst] = new GPUBuffer(this._cgp, this._name + " buff", null, { "buffCfg": buffCfg });

        if (this.uniforms.length > 0 && this.uniforms[0].gpuBuffer) this.cGpuBuffers[inst] = this.uniforms[0].gpuBuffer;
    }



    update(cgp, inst)
    {
        let b = this.bindingInstances[inst];
        if (!b) b = this.getBindingGroupEntry(cgp.device, inst);

        if (this.uniforms.length == 1 && this.uniforms[0].gpuBuffer)
        {
            if (this.uniforms[0].gpuBuffer != this.cGpuBuffers[inst])
            {
                console.log("changed?!");
                this.shader._needsRecompile = true; // TODO this should actually just rebuild the bindinggroup i guess ?
            }

            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("extern uni bind", [this.uniforms[0].getName(), this.cGpuBuffers[inst].floatArr]);
            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();
        }
        else
        if (this.uniforms.length == 1 && this.uniforms[0].getType() == "t")
        {
            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("uni texture");
            if (this.uniforms[0].getValue())
                if (this.uniforms[0].getValue().gpuTexture)
                {
                    this.bindingInstances[inst] = this.getBindingGroupEntry(this.uniforms[0]._cgp.device, inst);
                }
                else
                {
                    console.log("uni t has no gputexture");
                    b.resource = this._cgp.getErrorTexture().createView();
                }

            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();
        }
        else if (this.uniforms.length == 1 && this.uniforms[0].getType() == "sampler")
        {
            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("uni sampler");
            b.resource = this.uniforms[0].getValue();
            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();
        }
        else
        {
            let info = ["stage " + this.stageStr + " / inst " + inst];

            // console.log("B",this.);
            // update uniform values to buffer
            const s = this.getSizeBytes() / 4;

            // if (!this.cGpuBuffers[inst])
            // this._createCgpuBuffer(inst);
            // this.cGpuBuffers[inst] = new GPUBuffer(this._cgp, "buff", null, { "buffCfg": buffCfg });

            this.cGpuBuffers[inst].setLength(s);

            let off = 0;
            for (let i = 0; i < this.uniforms.length; i++)
            {
                info.push(this.uniforms[i].getName() + " " + this.uniforms[i].getValue());
                this.uniforms[i].copyToBuffer(this.cGpuBuffers[inst].floatArr, off); // todo: check if uniform changed?

                // if (isNaN(this.cGpuBuffers[inst].floatArr[0]))
                // {
                // console.log("shitttttttt", this.cGpuBuffers[inst].floatArr[0], this.uniforms[i].getName(), this.cGpuBuffers[inst].name, this.uniforms[i]);
                // }

                off += this.uniforms[i].getSizeBytes() / 4;
            }
            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("uni buff", info);

            // console.log("upodate", inst);

            this.cGpuBuffers[inst].updateGpuBuffer();
            // todo: only if changed...
            // cgp.device.queue.writeBuffer(
            //     b.resource.buffer,
            //     0,
            //     this._buffer.buffer,
            //     this._buffer.byteOffset,
            //     this._buffer.byteLength
            // );

            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();
        }
    }
}

;// CONCATENATED MODULE: ./src/core/cgp/cgp_shader.js






class cgp_shader_Shader extends CgShader
{
    constructor(_cgp, _name, options = {})
    {
        super();
        if (!_cgp) throw new Error("shader constructed without cgp " + _name);
        this._log = new Logger("cgp_shader");
        this._cgp = _cgp;
        this._name = _name;
        this._uniforms = [];
        this.compute = options.compute || false;

        if (!_name) this._log.stack("no shader name given");
        this._name = _name || "unknown";
        this._compileReason = "";
        this.gpuShaderModule = null;
        this._needsRecompile = true;
        this.bindingCounter = 0;
        this.bindCountlastFrame = -1;
        this._bindingIndexCount = 0;

        this.defaultBindingVert = new Binding(_cgp, "vsUniforms", { "stage": "vert", "bindingType": "uniform", "index": this._bindingIndexCount++ });
        this.defaultBindingFrag = new Binding(_cgp, "fsUniforms", { "stage": "frag", "bindingType": "uniform", "index": this._bindingIndexCount++ });
        this.defaultBindingComp = new Binding(_cgp, "computeUniforms", { "bindingType": "uniform", "index": this._bindingIndexCount++ });
        this.bindingsFrag = [this.defaultBindingFrag];
        this.bindingsVert = [this.defaultBindingVert];
        this.bindingsComp = [this.defaultBindingComp];

        if (!this.compute)
        {
            this.uniModelMatrix = this.addUniformVert("m4", "modelMatrix");
            this.uniViewMatrix = this.addUniformVert("m4", "viewMatrix");
            this.uniProjMatrix = this.addUniformVert("m4", "projMatrix");
            this.uniNormalMatrix = this.addUniformVert("m4", "normalMatrix");
            this.uniModelViewMatrix = this.addUniformVert("m4", "modelViewMatrix");
            this._tempNormalMatrix = mat4.create();
            this._tempModelViewMatrix = mat4.create();
        }


        this._src = "";

        this._cgp.on("deviceChange", () =>
        {
            this.gpuShaderModule = null;
            this._needsRecompile = "device changed";
        });
    }

    incBindingCounter()
    {
        if (this.bindCountlastFrame != this._cgp.frame) this.bindingCounter = 0;
        else this.bindingCounter++;
        this.bindCountlastFrame = this._cgp.frame;
    }

    reInit()
    {

    }

    get isValid()
    {
        return this._isValid;
    }

    get uniforms()
    {
        return this._uniforms;
    }

    getName()
    {
        return this._name;
    }

    setWhyCompile(why)
    {
        this._compileReason = why;
    }

    getNewBindingIndex()
    {
        return ++this._bindingIndexCount;
    }


    setSource(src)
    {
        this._src = src;
        this.setWhyCompile("Source changed");
        this._needsRecompile = true;
    }

    _replaceMods(vs)
    {
        let srcHeadVert = "";
        for (let i = 0; i < this._moduleNames.length; i++)
        {
            let srcVert = "";

            for (let j = 0; j < this._modules.length; j++)
            {
                const mod = this._modules[j];
                if (mod.name == this._moduleNames[i])
                {
                    srcHeadVert += "\n//---- MOD: group:" + mod.group + ": idx:" + j + " - prfx:" + mod.prefix + " - " + mod.title + " ------\n";

                    srcVert += "\n\n//---- MOD: " + mod.title + " / " + mod.priority + " ------\n";

                    if (mod.attributes)
                        for (let k = 0; k < mod.attributes.length; k++)
                        {
                            const r = this._getAttrSrc(mod.attributes[k], false);
                            if (r.srcHeadVert)srcHeadVert += r.srcHeadVert;
                            if (r.srcVert)srcVert += r.srcVert;
                        }

                    srcHeadVert += mod.srcHead || "";
                    srcVert += mod.srcBody || "";

                    srcHeadVert += "\n//---- end mod ------\n";

                    srcVert += "\n//---- end mod ------\n";

                    srcVert = srcVert.replace(/{{mod}}/g, mod.prefix);
                    srcHeadVert = srcHeadVert.replace(/{{mod}}/g, mod.prefix);

                    srcVert = srcVert.replace(/MOD_/g, mod.prefix);
                    srcHeadVert = srcHeadVert.replace(/MOD_/g, mod.prefix);
                }
            }

            vs = vs.replace("{{" + this._moduleNames[i] + "}}", srcVert);
        }

        vs = vs.replace("{{MODULES_HEAD}}", srcHeadVert);
        return vs;
    }

    getProcessedSource()
    {
        const defs = {};
        for (let i = 0; i < this._defines.length; i++)
            defs[this._defines[i][0]] = this._defines[i][1] || true;


        let src = preproc(this._src, defs);

        let bindingsHeadVert = "";
        for (let i = 0; i < this.bindingsFrag.length; i++)
            bindingsHeadVert += this.bindingsFrag[i].getShaderHeaderCode();

        let bindingsHeadFrag = "";
        for (let i = 0; i < this.bindingsVert.length; i++)
            bindingsHeadFrag += this.bindingsVert[i].getShaderHeaderCode();



        src = bindingsHeadFrag + "\n\n////////////////\n\n" + bindingsHeadVert + "\n\n////////////////\n\n" + src;
        src = this._replaceMods(src);

        return src;
        // console.log("----------------\n", src, "\n----------------------------");
    }

    compile()
    {
        console.log("compile", this._compileReason);
        this._isValid = true;
        this._cgp.pushErrorScope("cgp_shader " + this._name);
        // console.log(this.getProcessedSource());
        this.gpuShaderModule = this._cgp.device.createShaderModule({ "code": this.getProcessedSource(), "label": this._name });
        this._cgp.popErrorScope(this.error.bind(this));
        this._needsRecompile = false;

        this.emitEvent("compiled");
    }

    error(e)
    {
        this._isValid = false;
    }

    bind()
    {
        if (!this.compute)
        {
            this.uniModelMatrix.setValue(this._cgp.mMatrix);
            this.uniViewMatrix.setValue(this._cgp.vMatrix);
            this.uniProjMatrix.setValue(this._cgp.pMatrix);

            // mat4.invert(this._tempNormalMatrix, this._cgp.mMatrix);
            // mat4.transpose(this._tempNormalMatrix, this._tempNormalMatrix);
            mat4.mul(this._tempModelViewMatrix, this._cgp.vMatrix, this._cgp.mMatrix);



            // mat4.set(this._tempNormalMatrix, this._tempModelViewMatrix);
            mat4.invert(this._tempNormalMatrix, this._tempModelViewMatrix);
            mat4.transpose(this._tempNormalMatrix, this._tempNormalMatrix);


            // cpu billboarding?
            // this._tempModelViewMatrix[0 * 4 + 0] = 1.0;
            // this._tempModelViewMatrix[0 * 4 + 1] = 0.0;
            // this._tempModelViewMatrix[0 * 4 + 2] = 0.0;

            // // #ifndef BILLBOARDING_CYLINDRIC
            // this._tempModelViewMatrix[1 * 4 + 0] = 0.0;
            // this._tempModelViewMatrix[1 * 4 + 1] = 1.0;
            // this._tempModelViewMatrix[1 * 4 + 2] = 0.0;
            // // #endif

            // this._tempModelViewMatrix[2 * 4 + 0] = 0.0;
            // this._tempModelViewMatrix[2 * 4 + 1] = 0.0;
            // this._tempModelViewMatrix[2 * 4 + 2] = 1.0;

            this.uniModelViewMatrix.setValue(this._tempModelViewMatrix);
            this.uniNormalMatrix.setValue(this._tempNormalMatrix);
        }

        if (this._needsRecompile) this.compile();
    }

    /**
     * add a uniform to the fragment shader
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniformFrag
     * @returns {Uniform}
     */
    addUniformFrag(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new cgp_uniform_Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "frag";

        this.defaultBindingFrag.addUniform(uni);
        this.needsPipelineUpdate = "add frag uniform";

        return uni;
    }

    /**
     * add a uniform to the vertex shader
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniformVert
     * @returns {Uniform}
     */
    addUniformVert(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new cgp_uniform_Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "vert";

        this.defaultBindingVert.addUniform(uni);
        this.needsPipelineUpdate = "add ver uniform";

        return uni;
    }

    /**
     * add a uniform to all shader programs
     * @param {String} type ['f','t', etc]
     * @param {String} name
     * @param {any} valueOrPort value or port
     * @param p2
     * @param p3
     * @param p4
     * @memberof Shader
     * @instance
     * @function addUniform
     * @returns {Uniform}
     */
    addUniform(type, name, valueOrPort, p2, p3, p4)
    {
        const uni = new cgp_uniform_Uniform(this, type, name, valueOrPort, p2, p3, p4);
        uni.shaderType = "both";
        return uni;
    }

    _addUniform(uni)
    {
        this._uniforms.push(uni);
        this.setWhyCompile("add uniform " + name);
        this._needsRecompile = true;
    }

    getUniform(name)
    {
        for (let i = 0; i < this._uniforms.length; i++)
        {
            if (this._uniforms[i].getName() == name) return this._uniforms[i];
        }
    }

    /**
     * copy current shader
     * @function copy
     * @memberof Shader
     * @instance
     * @returns newShader
     */
    copy()
    {
        const shader = new cgp_shader_Shader(this._cgp, this._name + " copy");
        shader.setSource(this._src);

        shader._modules = JSON.parse(JSON.stringify(this._modules));
        shader._defines = JSON.parse(JSON.stringify(this._defines));

        shader._modGroupCount = this._modGroupCount;
        shader._moduleNames = this._moduleNames;

        // shader.glPrimitive = this.glPrimitive;
        // shader.offScreenPass = this.offScreenPass;
        // shader._extensions = this._extensions;
        // shader.wireframe = this.wireframe;
        // shader._attributes = this._attributes;

        for (let i = 0; i < this._uniforms.length; i++) this._uniforms[i].copy(shader);

        shader.bindingsFrag = [];
        for (let i = 0; i < this.bindingsFrag.length; i++) this.bindingsFrag[i].copy(shader);
        shader.defaultBindingFrag = this.bindingsFrag[0];

        shader.bindingsVert = [];
        for (let i = 0; i < this.bindingsVert.length; i++) this.bindingsVert[i].copy(shader);
        shader.defaultBindingVert = this.bindingsVert[0];

        shader.bindingsComp = [];
        for (let i = 0; i < this.bindingsComp.length; i++) this.bindingsComp[i].copy(shader);
        shader.defaultBindingComp = this.bindingsComp[0];

        console.log("copyyyyyyyyyy", shader.bindingsVert, this.bindingsVert);

        this.setWhyCompile("copy");
        shader._needsRecompile = true;
        return shader;
    }


    /**
     * copy all uniform values from another shader
     * @function copyUniforms
     * @memberof Shader
     * @instance
     * @param origShader uniform values will be copied from this shader
     */
    copyUniformValues(origShader)
    {
        for (let i = 0; i < origShader._uniforms.length; i++)
        {
            if (!this._uniforms[i])
            {
                this._log.log("unknown uniform?!");
                continue;
            }
            this.getUniform(origShader._uniforms[i].getName()).set(origShader._uniforms[i].getValue());
        }

        // this.popTextures();
        // for (let i = 0; i < origShader._textureStackUni.length; i++)
        // {
        //     this._textureStackUni[i] = origShader._textureStackUni[i];
        //     this._textureStackTex[i] = origShader._textureStackTex[i];
        //     this._textureStackType[i] = origShader._textureStackType[i];
        //     this._textureStackTexCgl[i] = origShader._textureStackTexCgl[i];
        // }
    }
}

;// CONCATENATED MODULE: ./src/core/cgp/cgl_shader_default.wgsl
/* harmony default export */ const cgl_shader_default = ("\nstruct MyVSInput\n{\n    @location(0) position: vec3<f32>,\n    @location(1) normal: vec3<f32>,\n    @location(2) texcoord: vec2<f32>,\n};\n\nstruct MyVSOutput\n{\n    @builtin(position) position: vec4<f32>,\n    @location(0) normal: vec3<f32>,\n    @location(1) texcoord: vec2<f32>,\n};\n\n@vertex\nfn myVSMain(v: MyVSInput) -> MyVSOutput\n{\n    var vsOut: MyVSOutput;\n    var pos =vec4<f32>(v.position, 1.0);\n\n    var mvMatrix=vsUniforms.viewMatrix * vsUniforms.modelMatrix;\n    vsOut.position = vsUniforms.projMatrix * mvMatrix * pos;\n\n    vsOut.normal = v.normal;\n    vsOut.texcoord = v.texcoord;\n    return vsOut;\n}\n\n@fragment\nfn myFSMain(v: MyVSOutput) -> @location(0) vec4<f32>\n{\n    return fsUniforms.color+vec4<f32>(.5,.5,.5,1.0);\n}\n\n");
;// CONCATENATED MODULE: ./src/core/cgp/cgp_texture.js



class cgp_texture_Texture extends CgTexture
{
    constructor(_cgp, options = {})
    {
        super(options);
        if (!_cgp) throw new Error("no cgp");
        this._log = new Logger("cgp_texture");
        this._cgp = _cgp;
        // this.id = CABLES.uuid();
        this.gpuTexture = null;
        this.gpuTextureDescriptor = null;

        options = options || {};

        this.name = options.name || "unknown";

        this.samplerDesc = {
            "addressModeU": options.wrap || options.addressModeU || "clamp-to-edge",
            "addressModeV": options.wrap || options.addressModeV || "clamp-to-edge",
            "magFilter": options.magFilter || options.filter || "linear",
            "minFilter": options.minFilter || options.filter || "linear",
        };


        this._cgp.on("deviceChange", () =>
        {
            // this.reInit();
        });
    }

    /**
     * set texture data from an image/canvas object
     * @function initTexture
     * @memberof Texture
     * @instance
     * @param {Object} img image
     * @param {Number} filter
     */
    initTexture(img, filter)
    {
        this.width = img.width;
        this.height = img.height;

        const textureType = "rgba8unorm";

        this._cgp.pushErrorScope("inittexture", { "logger": this._log });

        this.gpuTextureDescriptor = {

            "size": { "width": img.width, "height": img.height },
            "format": textureType,
            "usage": GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT
        };

        this.gpuTexture = this._cgp.device.createTexture(this.gpuTextureDescriptor);
        this._cgp.device.queue.copyExternalImageToTexture({ "source": img }, { "texture": this.gpuTexture }, this.gpuTextureDescriptor.size);

        this._cgp.popErrorScope();

        return this.gpuTexture;
    }

    dispose()
    {
        console.log("todo dispose");
    }

    getInfo()
    {
        const tex = this;
        const obj = {};

        obj.name = tex.name;
        obj.size = tex.width + " x " + tex.height;

        obj.textureType = tex.textureType;

        return obj;
    }

    createView()
    {
        if (!this.gpuTexture)
        {
            console.log("no gputexture...");
            return null;
        }
        return this.gpuTexture.createView();
    }

    getSampler()
    {
        // "clamp-to-edge"
        // "repeat"
        // "mirror-repeat"

        return this.samplerDesc;
    }

    /**
     * @function initFromData
     * @memberof Texture
     * @instance
     * @description create texturem from rgb data
     * @param {Array<Number>} data rgb color array [r,g,b,a,r,g,b,a,...]
     * @param {Number} w width
     * @param {Number} h height
     * @param {Number} filter
     * @param {Number} wrap
     */
    initFromData(data, w, h, filter, wrap)
    {
        if (!w || !h) this._log.error("texture size is 0");
        this.width = w;
        this.height = h;
        this.gpuTexture = this._cgp.device.createTexture(
            {
                "size": [w, h],
                "format": "rgba8unorm",
                "usage": GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,
            });

        this._cgp.device.queue.writeTexture(
            { "texture": this.gpuTexture },
            data,
            { "bytesPerRow": w * 4 },
            { "width": w, "height": h });
    }


    setWrap(v)
    {
        this.samplerDesc.addressModeU = this.samplerDesc.addressModeV = v;
    }

    setFilter(v)
    {
        this.samplerDesc.minFilter = this.samplerDesc.magFilter = v;
    }
}


/**
 * @function load
 * @static
 * @memberof Texture
 * @description load an image from an url
 * @param {Context} cgp
 * @param {String} url
 * @param {Function} onFinished
 * @param {Object} settings
 * @return {Texture}
 */
cgp_texture_Texture.load = function (cgp, url, onFinished, settings)
{
    fetch(url).then((response) =>
    {
        const texture = new cgp_texture_Texture(cgp, { "name": url });

        response.blob().then((blob) =>
        {
            createImageBitmap(blob).then((imgBitmap) =>
            {
                texture.initTexture(imgBitmap);
                if (onFinished)onFinished(texture);
                else console.log("Texture.load no onFinished callback");
            }).catch((err) =>
            {
                if (onFinished)onFinished(cgp.getErrorTexture());
            });
        });
    });
};

;// CONCATENATED MODULE: ./src/core/cgp/cgp_state.js








// https://github.com/greggman/webgpu-utils
// https://developer.chrome.com/blog/from-webgl-to-webgpu/
// https://gpuweb.github.io/gpuweb/explainer/


/**
 * cables webgpu context/state manager
 * @class
 * @namespace external:CGP
 * @hideconstructor
 */
// const Context = function (_patch)
class WebGpuContext extends CGState
{
    constructor(_patch)
    {
        super();

        this.patch = _patch;

        this.lastErrorMsg = "";

        this._log = new Logger("WebGpuContext");
        this.gApi = CG.GAPI_WEBGPU;
        this._viewport = [0, 0, 256, 256];
        this._shaderStack = [];
        this._simpleShader = null;
        this.frame = 0;
        this.catchErrors = false;

        this._stackCullFaceFacing = [];
        this._stackDepthTest = [];
        this._stackCullFace = [];
        this._stackDepthFunc = [];
        this._stackDepthWrite = [];
        this._stackErrorScope = [];
        this._stackBlend = [];
        this._stackErrorScopeLogs = [];

        this._defaultBlend = {
            "color": {
                "operation": "add",
                "srcFactor": "one",
                "dstFactor": "zero",
            },
            "alpha": {
                "operation": "add",
                "srcFactor": "one",
                "dstFactor": "zero",
            },
        };

        this.DEPTH_FUNCS = [
            "never",
            "always",
            "less",
            "less-equal",
            "greater",
            "greater-equal",
            "equal",
            "not-equal"
        ];

        this.CULL_MODES = [
            "none",
            "back",
            "front",
            "none" // both does not exist in webgpu
        ];
    }


    /// ////////////////////

    // getViewPort()
    // {
    //     return [0, 0, this.canvasWidth, this.canvasHeight];
    // }

    renderStart(cgp, identTranslate, identTranslateView)
    {
        this.frame++;
        this.pushErrorScope("cgpstate internal", "internal");
        this.pushErrorScope("cgpstate out-of-memory", "out-of-memory");

        if (!this._simpleShader)
        {
            this._simpleShader = new cgp_shader_Shader(this, "simple default shader");
            this._simpleShader.setSource(cgl_shader_default);
            this._simpleShader.addUniformFrag("4f", "color", [1, 1, 0, 1]);
        }

        this.fpsCounter.startFrame();

        this._startMatrixStacks(identTranslate, identTranslateView);
        this.setViewPort(0, 0, this.canvasWidth, this.canvasHeight);

        this.pushShader(this._simpleShader);
        this.pushDepthTest(true);
        this.pushDepthWrite(true);
        this.pushDepthFunc("less-equal");


        this.pushBlend(this._defaultBlend);

        this.emitEvent("beginFrame");
    }

    renderEnd()
    {
        this._endMatrixStacks();

        this.popShader();
        this.popDepthFunc();
        this.popDepthWrite();
        this.popDepthTest();

        this.popErrorScope();
        this.popErrorScope();

        if (this._stackErrorScope.length > 0)console.log("scope stack length invalid...");

        this.emitEvent("endFrame");
        this.fpsCounter.endFrame();
    }


    setViewPort(x, y, w, h)
    {
        this._viewport = [x, y, w, h];
    }

    /**
     * @function getViewPort
     * @memberof Context
     * @instance
     * @description get current gl viewport
     * @returns {Array} array [x,y,w,h]
     */
    getViewPort()
    {
        return this._viewPort;
    }

    createMesh(geom, glPrimitive)
    {
        return new CGP.Mesh(this, geom, glPrimitive);
    }

    /**
     * push a shader to the shader stack
     * @function pushShader
     * @memberof Context
     * @instance
     * @param {Object} shader
     * @function
    */
    pushShader(shader)
    {
        this._shaderStack.push(shader);
        // currentShader = shader;
    }

    /**
     * pop current used shader from shader stack
     * @function popShader
     * @memberof Context
     * @instance
     * @function
     */
    popShader()
    {
        if (this._shaderStack.length === 0) throw new Error("Invalid shader stack pop!");
        this._shaderStack.pop();
        // currentShader = this._shaderStack[this._shaderStack.length - 1];
    }

    getShader()
    {
        return this._shaderStack[this._shaderStack.length - 1];
        // if (currentShader) if (!this.frameStore || ((this.frameStore.renderOffscreen === true) == currentShader.offScreenPass) === true) return currentShader;
        // for (let i = this._shaderStack.length - 1; i >= 0; i--) if (this._shaderStack[i]) if (this.frameStore.renderOffscreen == this._shaderStack[i].offScreenPass) return this._shaderStack[i];
    }

    setDevice(device)
    {
        this.device = device;


        if (this._emptyTexture) this._emptyTexture = this._emptyTexture.dispose();
        if (this._defaultTexture) this._defaultTexture = this._defaultTexture.dispose();
        if (this._errorTexture) this._errorTexture = this._errorTexture.dispose();

        this.emitEvent("deviceChange");
    }

    pushErrorScope(name, options = {})
    {
        if (this.catchErrors)
        {
            this._stackErrorScope.push(name);
            this._stackErrorScopeLogs.push(options.logger || null);
            this.device.pushErrorScope(options.scope || "validation");
        }
    }

    popErrorScope(cb)
    {
        if (this.catchErrors)
        {
            const name = this._stackErrorScope.pop();
            const logger = this._stackErrorScopeLogs.pop();
            this.device.popErrorScope().then((error) =>
            {
                if (error)
                {
                    if (this.lastErrorMsg == error.message)
                    {
                        // this._log.warn("last error once more...");
                    }
                    else
                    {
                        (logger || this._log).error(error.constructor.name, "in", name);
                        (logger || this._log).error(error.message);
                    }
                    this.lastErrorMsg = error.message;

                    if (cb)cb(error);
                }
            });
        }
    }

    /**
     * push depth testing enabled state
     * @function pushDepthTest
     * @param {Boolean} b enabled
     * @memberof Context
     * @instance
     */
    pushDepthTest(b)
    {
        this._stackDepthTest.push(b);
    }

    /**
     * current state of depth testing
     * @function stateDepthTest
     * @returns {Boolean} enabled
     * @memberof Context
     * @instance
     */
    stateDepthTest()
    {
        return this._stackDepthTest[this._stackDepthTest.length - 1];
    }

    /**
     * pop depth testing state
     * @function popDepthTest
     * @memberof Context
     * @instance
     */
    popDepthTest()
    {
        this._stackDepthTest.pop();
    }

    // --------------------------------------
    // state depthwrite

    /**
     * push depth write enabled state
     * @function pushDepthWrite
     * @param {Boolean} b enabled
     * @memberof Context
     * @instance
     */
    pushDepthWrite(b)
    {
        b = b || false;
        this._stackDepthWrite.push(b);
    }

    /**
     * current state of depth writing
     * @function stateCullFace
     * @returns {Boolean} enabled
     * @memberof Context
     * @instance
     */
    stateDepthWrite()
    {
        return this._stackDepthWrite[this._stackDepthWrite.length - 1];
    }

    /**
     * pop depth writing state
     * @function popCullFace
     * @memberof Context
     * @instance
     */
    popDepthWrite()
    {
        this._stackDepthWrite.pop();
    }

    // --------------------------------------
    // state depthfunc

    /**
     * @function pushDepthFunc
     * @memberof Context
     * @instance
     * @param {string} f depth compare func
     */
    pushDepthFunc(f)
    {
        this._stackDepthFunc.push(f);
    }

    /**
     * @function stateDepthFunc
     * @memberof Context
     * @instance
     * @returns {string}
     */
    stateDepthFunc()
    {
        if (this._stackDepthFunc.length > 0) return this._stackDepthFunc[this._stackDepthFunc.length - 1];
        return false;
    }

    /**
     * pop depth compare func
     * @function popDepthFunc
     * @memberof Context
     * @instance
     */
    popDepthFunc()
    {
        this._stackDepthFunc.pop();
    }

    // --------------------------------------
    // state CullFace

    /**
     * push face culling face enabled state
     * @function pushCullFace
     * @param {Boolean} b enabled
     * @memberof Context
     * @instance
     */
    pushCullFace(b)
    {
        this._stackCullFace.push(b);
    }

    /**
     * current state of face culling
     * @function stateCullFace
     * @returns {Boolean} enabled
     * @memberof Context
     * @instance
     */
    stateCullFace()
    {
        return this._stackCullFace[this._stackCullFace.length - 1];
    }

    /**
     * pop face culling enabled state
     * @function popCullFace
     * @memberof Context
     * @instance
     */
    popCullFace()
    {
        this._stackCullFace.pop();
    }

    // --------------------------------------
    // state CullFace Facing

    /**
     * push face culling face side
     * @function pushCullFaceFacing
     * @memberof Context
     * @param b
     * @instance
     */
    pushCullFaceFacing(b)
    {
        this._stackCullFaceFacing.push(b);
    }

    /**
     * current state of face culling side
     * @function stateCullFaceFacing
     * @returns {Boolean} enabled
     * @memberof Context
     * @instance
     */
    stateCullFaceFacing()
    {
        return this._stackCullFaceFacing[this._stackCullFaceFacing.length - 1];
    }

    /**
     * pop face culling face side
     * @function popCullFaceFacing
     * @memberof Context
     * @instance
     */
    popCullFaceFacing()
    {
        this._stackCullFaceFacing.pop();
    }

    pushBlend(b)
    {
        this._stackBlend.push(b);
    }

    popBlend()
    {
        this._stackBlend.pop();
    }

    stateBlend()
    {
        return this._stackBlend[this._stackBlend.length - 1];
    }

    getEmptyTexture()
    {
        if (this._emptyTexture) return this._emptyTexture;
        const size = 8;
        this._emptyTexture = new cgp_texture_Texture(this, {});
        this._emptyTexture.initFromData(CgTexture.getDefaultTextureData("empty", size), size, size);
        return this._emptyTexture;
    }

    getErrorTexture()
    {
        // if (this._errorTexture) return this._errorTexture;
        const size = 256;
        this._errorTexture = new cgp_texture_Texture(this, {});
        this._errorTexture.initFromData(CgTexture.getDefaultTextureData("stripes", size, { "r": 1, "g": 0, "b": 0 }), size, size);
        return this._errorTexture;
    }

    getDefaultTexture()
    {
        if (this._defaultTexture) return this._defaultTexture;
        const size = 256;
        this._defaultTexture = new cgp_texture_Texture(this, {});
        this._defaultTexture.initFromData(CgTexture.getDefaultTextureData("stripes", size), size, size);
        return this._defaultTexture;
    }
}


;// CONCATENATED MODULE: ./src/core/cgp/cgp_pipeline.js



class Pipeline
{
    constructor(_cgp, name)
    {
        if (!_cgp) throw new Error("Pipeline constructed without cgp " + name);
        this._name = name;
        this._cgp = _cgp;
        this._isValid = true;
        this._log = new Logger("pipeline");

        this._pipeCfg = null;
        this._renderPipeline = null;

        this._bindGroups = [];

        this._shaderListeners = [];
        this.shaderNeedsPipelineUpdate = false;

        this._old = {};

        this.DEPTH_COMPARE_FUNCS_STRINGS = ["never", "less", "equal", "lessequal", "greater", "notequal", "greaterequal", "always"];

        this._cgp.on("deviceChange", () =>
        {
            this._renderPipeline = null;
        });
    }

    get isValid() { return this._isValid; }

    setName(name)
    {
        this._name = name;
    }

    setShaderListener(oldShader, newShader)
    {
        for (let i = 0; i < this._shaderListeners.length; i++) oldShader.off(this._shaderListeners[i]);

        this._shaderListeners.push(
            newShader.on("compiled", () =>
            {
                // console.log("pipe update shader compileeeeeee");
                // this.needsRebuildReason = "shader changed";
                this.shaderNeedsPipelineUpdate = "shader compiled";
            }));
    }


    getInfo()
    {
        // console.log(this.bindingGroupLayoutEntries);

        const arr = [
            "name: " + this._name,
            "bindgroups: " + this._bindGroups.length

        ];

        if (this.bindingGroupLayoutEntries)arr.push("layouts: " + this.bindingGroupLayoutEntries.length);

        // if (this.bindingGroupLayoutEntries)
        //     for (let i = 0; i < this.bindingGroupLayoutEntries.length; i++)
        //     {
        //         // const lines = JSON.stringify(this.bindingGroupLayoutEntries, 4, true).split(",");
        //         arr.push(...lines);
        //     }

        return arr;
    }

    setPipeline(shader, mesh)
    {
        if (!mesh || !shader)
        {
            console.log("pipeline unknown shader/mesh");
            return;
        }

        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("setPipeline", this.getInfo());

        let needsRebuildReason = "";
        if (!this._renderPipeline) needsRebuildReason = "no renderpipeline";
        if (!this._pipeCfg)needsRebuildReason = "no pipecfg";
        if (this._old.mesh != mesh)needsRebuildReason = "no mesh";
        if (this._old.shader != shader)
        {
            this.setShaderListener(this._old.shader, shader);
            needsRebuildReason = "shader changed";
        }

        if (shader.needsPipelineUpdate)
        {
            needsRebuildReason = "mesh needs update: " + shader.needsPipelineUpdate;
            shader.needsPipelineUpdate = false;
        }
        if (mesh.needsPipelineUpdate)needsRebuildReason = "mesh needs update";
        if (this.shaderNeedsPipelineUpdate)needsRebuildReason = "shader was recompiled: " + this.shaderNeedsPipelineUpdate;

        if (this._pipeCfg)
        {
            if (this._pipeCfg.depthStencil.depthWriteEnabled != this._cgp.stateDepthWrite())
            {
                needsRebuildReason = "depth changed";
                this._pipeCfg.depthStencil.depthWriteEnabled = this._cgp.stateDepthWrite();
            }

            if (this._pipeCfg.fragment.targets[0].blend != this._cgp.stateBlend())
            {
                needsRebuildReason = "blend changed";
                this._pipeCfg.fragment.targets[0].blend = this._cgp.stateBlend();
            }

            // "fragment": {
            //     "module": shader.gpuShaderModule,
            //     "entryPoint": "myFSMain",
            //     "targets": [
            //         {
            //             "format": this._cgp.presentationFormat,
            //             "blend":
            //         },


            if (this._cgp.stateDepthTest() === false)
            {
                if (this._pipeCfg.depthStencil.depthCompare != "never")
                {
                    this._pipeCfg.depthStencil.depthCompare = "never";
                    needsRebuildReason = "depth compare changed";
                }
            }
            else
            if (this._pipeCfg.depthStencil.depthCompare != this._cgp.stateDepthFunc())
            {
                needsRebuildReason = "depth state ";
                this._pipeCfg.depthStencil.depthCompare = this._cgp.stateDepththis._cgp.stateDepthFunc();
            }

            // console.log(this._pipeCfg.primitive.cullMode, this._cgp.stateCullFaceFacing());
            if (this._pipeCfg.primitive.cullMode != this._cgp.stateCullFaceFacing())
            {
                needsRebuildReason = "cullmode change";
                this._pipeCfg.primitive.cullMode = this._cgp.stateCullFaceFacing();
            }
        }

        this._cgp.currentPipeDebug =
        {
            "cfg": this._pipeCfg,
            "bindingGroupEntries": this.bindingGroupEntries,
            "bindingGroupLayoutEntries": this.bindingGroupLayoutEntries
        };


        if (needsRebuildReason != "")
        {
            console.log("rebuild pipe", needsRebuildReason);
            this._cgp.pushErrorScope("createPipeline", { "logger": this._log });

            this._bindGroups = [];

            this._pipeCfg = this.getPipelineObject(shader, mesh);
            this._old.device = this._cgp.device;
            this._old.shader = shader;
            this._old.mesh = mesh;
            this._renderPipeline = this._cgp.device.createRenderPipeline(this._pipeCfg);

            this._cgp.popErrorScope();
        }


        if (this._renderPipeline && this._isValid)
        {
            this._cgp.pushErrorScope("setpipeline", { "logger": this._log });


            this._cgp.passEncoder.setPipeline(this._renderPipeline);

            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("updateUniforms");

            shader.incBindingCounter();

            if (!this._bindGroups[shader.bindingCounter])
            {
                const bindingGroupEntries = [];

                for (let i = 0; i < shader.bindingsVert.length; i++)
                {
                    if (shader.bindingsVert[i].getSizeBytes() > 0)
                    {
                        bindingGroupEntries.push(shader.bindingsVert[i].getBindingGroupEntry(this._cgp.device, shader.bindingCounter));
                    }
                    else console.log("shader defaultBindingVert size 0");
                }
                for (let i = 0; i < shader.bindingsFrag.length; i++)
                {
                    if (shader.bindingsFrag[i].getSizeBytes() > 0)
                    {
                        bindingGroupEntries.push(shader.bindingsFrag[i].getBindingGroupEntry(this._cgp.device, shader.bindingCounter));
                    }
                    else console.log("shader defaultBindingFrag size 0");
                }

                const bg = {
                    "label": "label2",
                    "layout": this.bindGroupLayout,
                    "entries": bindingGroupEntries
                };

                this._bindGroups[shader.bindingCounter] = this._cgp.device.createBindGroup(bg);
            }

            this._bindUniforms(shader, shader.bindingCounter);

            if (this._bindGroups[shader.bindingCounter]) this._cgp.passEncoder.setBindGroup(0, this._bindGroups[shader.bindingCounter]);


            // shader.bindingCounter++;

            if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();

            this._cgp.popErrorScope();
        }
        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();


        this.shaderNeedsPipelineUpdate = false;
    }

    getPipelineObject(shader, mesh)
    {
        this.bindingGroupLayoutEntries = [];

        for (let i = 0; i < shader.bindingsVert.length; i++)
        {
            if (shader.bindingsVert[i].getSizeBytes() > 0)
            {
                this.bindingGroupLayoutEntries.push(shader.bindingsVert[i].getBindingGroupLayoutEntry());
            }
            else console.log("shader defaultBindingVert size 0");
        }

        for (let i = 0; i < shader.bindingsFrag.length; i++)
        {
            if (shader.bindingsFrag[i].getSizeBytes() > 0)
            {
                this.bindingGroupLayoutEntries.push(shader.bindingsFrag[i].getBindingGroupLayoutEntry());
            }
            else console.log("shader defaultBindingFrag size 0");
        }
        // //////////

        this.bindGroupLayout = this._cgp.device.createBindGroupLayout(
            {
                "label": "bg layout " + this._name,
                "entries": this.bindingGroupLayoutEntries,
            });

        const pipelineLayout = this._cgp.device.createPipelineLayout({
            "label": "pipe layout " + this._name,
            "bindGroupLayouts": [this.bindGroupLayout]
        });


        let buffers = [
            // position
            {
                "arrayStride": 3 * 4, // 3 floats, 4 bytes each
                "attributes": [
                    { "shaderLocation": 0, "offset": 0, "format": "float32x3" },
                ],
            },
            // texcoords
            {
                "arrayStride": 2 * 4, // 2 floats, 4 bytes each
                "attributes": [
                    { "shaderLocation": 2, "offset": 0, "format": "float32x2", },
                ],
            },
            // normals
            {
                "arrayStride": 3 * 4, // 3 floats, 4 bytes each
                "attributes": [
                    { "shaderLocation": 1, "offset": 0, "format": "float32x3" },
                ],
            }];



        const pipeCfg = {
            // "layout": "auto",
            "label": this._name,
            "layout": pipelineLayout,
            "vertex": {
                "module": shader.gpuShaderModule,
                "entryPoint": "myVSMain",
                "buffers": buffers

            },
            "fragment": {
                "module": shader.gpuShaderModule,
                "entryPoint": "myFSMain",
                "targets": [
                    {
                        "format": this._cgp.presentationFormat,
                        "blend": this._cgp.stateBlend()
                    },
                ],
            },
            "primitive": {
                "topology": "triangle-list",
                "cullMode": this._cgp.stateCullFaceFacing(), // back/none/front

                // "point-list",
                // "line-list",
                // "line-strip",
                // "triangle-list",
                // "triangle-strip"
            },
            "depthStencil": {
                "depthWriteEnabled": this._cgp.stateDepthTest(),
                "depthCompare": this._cgp.stateDepthFunc(),
                "format": "depth24plus",
            },

        };

        return pipeCfg;
    }


    _bindUniforms(shader, inst)
    {
        // this._cgp.pushErrorScope("pipeline bind uniforms", { "logger": this._log });

        shader.bind();

        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("bind uniforms vert", ["num:" + shader.bindingsVert.length]);
        for (let i = 0; i < shader.bindingsVert.length; i++) shader.bindingsVert[i].update(this._cgp, inst);
        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();

        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("bind uniforms frag", ["num:" + shader.bindingsFrag.length]);
        for (let i = 0; i < shader.bindingsFrag.length; i++) shader.bindingsFrag[i].update(this._cgp, inst);
        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();



        // shader.defaultBindingVert.update(this._cgp);

        // this._cgp.popErrorScope((e) =>
        // {
        //     this._isValid = false;
        // });
    }
}

;// CONCATENATED MODULE: ./src/core/cgp/cgp_mesh.js



class cgp_mesh_Mesh
{
    constructor(_cgp, __geom)
    {
        this._log = new Logger("cgl_mesh");
        this._cgp = _cgp;
        this._geom = null;
        this.numIndex = 0;
        this.instances = 1;

        this._pipe = new Pipeline(this._cgp, "new mesh");
        this._numNonIndexed = 0;
        this._positionBuffer = null;
        this._bufVerticesIndizes = null;
        this._attributes = [];
        this._needsPipelineUpdate = false;

        if (__geom) this.setGeom(__geom);
    }

    _createBuffer(device, data, usage)
    {
        let bo = {
            "size": data.byteLength,
            "usage": usage,
            "mappedAtCreation": true,
        };
        // ifbo.stepMode = "instance";
        const buffer = device.createBuffer(bo);
        const dst = new data.constructor(buffer.getMappedRange());
        dst.set(data);
        buffer.unmap();
        return buffer;
    }

    /**
     * @function setGeom
     * @memberof Mesh
     * @instance
     * @description set geometry for mesh
     * @param {Geometry} geom geometry
     * @param {boolean} removeRef
     */
    setGeom(geom, removeRef)
    {
        this._needsPipelineUpdate = true;
        this._geom = geom;
        this._disposeAttributes();

        this._positionBuffer = this._createBuffer(this._cgp.device, new Float32Array(geom.vertices), GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST);

        let vi = geom.verticesIndices;
        if (!geom.isIndexed()) vi = Array.from(Array(geom.vertices.length / 3).keys());
        this._numIndices = vi.length;
        this._indicesBuffer = this._createBuffer(this._cgp.device, new Uint32Array(vi), GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST);

        if (geom.texCoords && geom.texCoords.length) this.setAttribute("texCoords", geom.texCoords, 2);
        if (geom.vertexNormals && geom.vertexNormals.length) this.setAttribute("normals", geom.vertexNormals, 3);

        this.setAttribute("normals", geom.vertexNormals, 3);
    }


    _disposeAttributes()
    {
        this._needsPipelineUpdate = true;
        for (let i = 0; i < this._attributes.length; i++)
        {
            this._attributes[i].buffer.destroy();
        }
        this._attributes.length = 0;
    }

    dispose()
    {
        this._disposeAttributes();
    }

    /**
     * @function setAttribute
     * @description update attribute
     * @memberof Mesh
     * @instance
     * @param {String} name attribute name
     * @param {Array} array data
     * @param {Number} itemSize
     * @param {Object} options
     */
    setAttribute(name, array, itemSize, options = {})
    {
        if (!array)
        {
            this._log.error("mesh addAttribute - no array given! " + name);
            throw new Error();
        }

        let instanced = false;
        if (options.instanced) instanced = options.instanced;

        const buffer = this._createBuffer(this._cgp.device, new Float32Array(array), GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST);

        const attr = {
            "buffer": buffer,
            "name": name,
            "instanced": instanced,
        };
        this._attributes.push(attr);

        return attr;
    }


    render()
    {
        if (!this._positionBuffer) return;
        if (this.instances <= 0) return;

        const shader = this._cgp.getShader();
        if (shader)shader.bind();

        if (!this._cgp.getShader() || !this._cgp.getShader().isValid)
        {
            // this.status = "shader invalid";
            return;
        }

        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.push("mesh", ["geom " + this._geom.name, "shader " + this._cgp.getShader().getName()]);

        this._pipe.setName("mesh " + this._geom.name + " " + this._cgp.getShader().getName());
        this._pipe.setPipeline(this._cgp.getShader(), this);


        if (this._pipe.isValid)
        {
            this._cgp.passEncoder.setVertexBuffer(0, this._positionBuffer);
            for (let i = 0; i < this._attributes.length; i++)
            {
                this._cgp.passEncoder.setVertexBuffer(i + 1, this._attributes[i].buffer);
            }

            this._cgp.passEncoder.setIndexBuffer(this._indicesBuffer, "uint32");

            if (this._numNonIndexed)
                this._cgp.passEncoder.draw(this._numIndices, this.instances);
            else
                this._cgp.passEncoder.drawIndexed(this._numIndices, this.instances);
        }

        if (this._cgp.frameStore.branchProfiler) this._cgp.frameStore.branchStack.pop();

        // if (shader)shader.unbind();
    }
}

;// CONCATENATED MODULE: ./src/core/cgp/index.js










const cgp_CGP = {
    "Context": WebGpuContext,
    "Shader": cgp_shader_Shader,
    "Mesh": cgp_mesh_Mesh,
    "Pipeline": Pipeline,
    "Texture": cgp_texture_Texture,
    "Binding": Binding,
    "Uniform": cgp_uniform_Uniform,
    "MESHES": MESHES,
    "GPUBuffer": GPUBuffer
};

window.CABLES = window.CABLES || {};
window.CABLES.CGP = cgp_CGP;
window.CGP = cgp_CGP;




;// CONCATENATED MODULE: ./src/core/cgl/cgl_framebuffer.js



// todo: convert to prototyped...

/**
 * a framebuffer
 * @constructor
 * @class
 * @constructs Framebuffer
 * @param {Context} _cgl cgl
 * @param {Number} _w width
 * @param {Number} _h height
 * @param {Object} options
 */
const Framebuffer = function (_cgl, _w, _h, options)
{
    const cgl = _cgl;
    this._log = new Logger("Framebuffer");
    this.valid = true;

    let depthTextureExt = cgl.gl.DEPTH_TEXTURE;
    if (!depthTextureExt) depthTextureExt = cgl.enableExtension("WEBGL_depth_texture");
    if (!depthTextureExt) depthTextureExt = cgl.enableExtension("WEBKIT_WEBGL_depth_texture");
    if (!depthTextureExt) depthTextureExt = cgl.enableExtension("MOZ_WEBGL_depth_texture");

    if (!depthTextureExt)
    {
        this._log.error("NO_DEPTH_TEXTURE", "no depth texture support");
        return;
    }

    let width = _w || 512;
    let height = _h || 512;

    options = options || {
        "isFloatingPointTexture": false,
    };

    if (!options.hasOwnProperty("clear")) options.clear = true;
    if (!options.hasOwnProperty("filter")) options.filter = Texture.FILTER_LINEAR;

    const texture = new Texture(cgl, {
        "isFloatingPointTexture": options.isFloatingPointTexture,
        "filter": options.filter,
        "wrap": options.wrap || Texture.CLAMP_TO_EDGE
    });

    let textureDepth = null;
    if (depthTextureExt)
    {
        textureDepth = new Texture(cgl, {
            "isDepthTexture": true,
        });
    }
    this._options = options;

    const frameBuf = cgl.gl.createFramebuffer();
    const depthBuffer = cgl.gl.createRenderbuffer();

    this.getWidth = function ()
    {
        return width;
    };
    this.getHeight = function ()
    {
        return height;
    };

    /**
     * get native gl framebuffer
     * @function getGlFrameBuffer
     * @memberof Framebuffer
     * @returns {Object} framebuffer
     */
    this.getGlFrameBuffer = function ()
    {
        return frameBuf;
    };

    /**
     * get depth renderbuffer
     * @function getDepthRenderBuffer
     * @memberof Framebuffer
     * @returns {Object} renderbuffer
     */
    this.getDepthRenderBuffer = function ()
    {
        return depthBuffer;
    };

    /**
     * get color texture
     * @function getTextureColor
     * @memberof Framebuffer
     * @returns {Texture} rgba texture
     */
    this.getTextureColor = function ()
    {
        return texture;
    };

    /**
     * get depth texture
     * @function getTextureDepth
     * @memberof Framebuffer
     * @returns {Texture} depth texture
     */
    this.getTextureDepth = function ()
    {
        return textureDepth;
    };

    this.setFilter = function (f)
    {
        texture.filter = f;
        texture.setSize(width, height);
    };

    this.setSize = function (w, h)
    {
        if (w < 2) w = 2;
        if (h < 2) h = 2;

        width = Math.ceil(w);
        height = Math.ceil(h);

        cgl.profileData.profileFrameBuffercreate++;

        cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER, frameBuf);
        cgl.gl.bindRenderbuffer(cgl.gl.RENDERBUFFER, depthBuffer);

        texture.setSize(width, height);
        if (textureDepth) textureDepth.setSize(width, height);

        // if(depthTextureExt) cgl.gl.renderbufferStorage(cgl.gl.RENDERBUFFER, cgl.gl.DEPTH_COMPONENT16, width,height);
        if (depthTextureExt) cgl.gl.renderbufferStorage(cgl.gl.RENDERBUFFER, cgl.gl.DEPTH_COMPONENT16, width, height);

        cgl.gl.framebufferTexture2D(cgl.gl.FRAMEBUFFER, cgl.gl.COLOR_ATTACHMENT0, cgl.gl.TEXTURE_2D, texture.tex, 0);

        if (depthTextureExt)
        {
            cgl.gl.framebufferRenderbuffer(cgl.gl.FRAMEBUFFER, cgl.gl.DEPTH_ATTACHMENT, cgl.gl.RENDERBUFFER, depthBuffer);
            cgl.gl.framebufferTexture2D(
                cgl.gl.FRAMEBUFFER,
                cgl.gl.DEPTH_ATTACHMENT, // safari needs DEPTH_ATTACHMENT NOT DEPTH_ATTACHMENT16
                // cgl.gl.DEPTH_COMPONENT16,
                cgl.gl.TEXTURE_2D,
                textureDepth.tex,
                0,
            );
        }

        if (!cgl.gl.isFramebuffer(frameBuf)) throw new Error("Invalid framebuffer");
        const status = cgl.gl.checkFramebufferStatus(cgl.gl.FRAMEBUFFER);

        switch (status)
        {
        case cgl.gl.FRAMEBUFFER_COMPLETE:
            break;
        case cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...", width, height, texture.tex, depthBuffer);
            this.valid = false;
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
        case cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
            this.valid = false;
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
        case cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
            this.valid = false;
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
        case cgl.gl.FRAMEBUFFER_UNSUPPORTED:
            this._log.warn("FRAMEBUFFER_UNSUPPORTED");
            this.valid = false;
            this._log.warn(width, height, options);

            throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");
        case 0x8CDB:
            this._log.warn("Incomplete: FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER from ext. Or Safari/iOS undefined behaviour.");
            this.valid = false;
            break;
        default:
            this._log.warn("incomplete framebuffer", status);
            this.valid = false;
            throw new Error("Incomplete framebuffer: " + status);
        }

        cgl.gl.bindTexture(cgl.gl.TEXTURE_2D, null);
        cgl.gl.bindRenderbuffer(cgl.gl.RENDERBUFFER, null);
        cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER, null);
    };

    this.renderStart = function ()
    {
        cgl.pushModelMatrix();
        cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER, frameBuf);
        cgl.pushGlFrameBuffer(frameBuf);
        cgl.pushFrameBuffer(this);

        cgl.pushPMatrix();
        cgl.gl.viewport(0, 0, width, height);

        if (this._options.clear)
        {
            cgl.gl.clearColor(0, 0, 0, 0);
            cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT | cgl.gl.DEPTH_BUFFER_BIT);
        }
    };

    this.renderEnd = function ()
    {
        cgl.popPMatrix();
        cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER, cgl.popGlFrameBuffer());
        cgl.popFrameBuffer();

        cgl.popModelMatrix();
        cgl.resetViewPort();
    };


    this.delete = function ()
    {
        texture.delete();
        this.valid = false;
        if (textureDepth) textureDepth.delete();
        cgl.gl.deleteRenderbuffer(depthBuffer);
        cgl.gl.deleteFramebuffer(frameBuf);
    };

    this.dispose = this.delete;

    this.setSize(width, height);
};



;// CONCATENATED MODULE: ./src/core/cgl/cgl_framebuffer2.js
// * see framebuffer1






const Framebuffer2 = function (cgl, w, h, options)
{
    this._log = new Logger("cgl_framebuffer2");
    if (cgl.glVersion == 1) return this._log.error("framebuffer2 used on webgl1");
    this.Framebuffer2DrawTargetsDefault = null;
    this.Framebuffer2BlittingFramebuffer = null;
    this.Framebuffer2FinalFramebuffer = null;
    this._cgl = cgl;

    this._cgl.printError("before framebuffer2 constructor");

    this._width = 0;
    this._height = 0;
    this.valid = true;

    this._depthRenderbuffer = null;
    this._frameBuffer = null;
    this._textureFrameBuffer = null;
    this._colorRenderbuffers = [];
    this._drawTargetArray = [];
    this._disposed = false;

    if (!this.Framebuffer2BlittingFramebuffer) this.Framebuffer2BlittingFramebuffer = cgl.gl.createFramebuffer();
    if (!this.Framebuffer2FinalFramebuffer) this.Framebuffer2FinalFramebuffer = cgl.gl.createFramebuffer();

    if (!this.Framebuffer2DrawTargetsDefault) this.Framebuffer2DrawTargetsDefault = [cgl.gl.COLOR_ATTACHMENT0];

    this._options = options || {
        "isFloatingPointTexture": false,
    };

    // this._cgl.printError("fb2 before");

    this.name = this._options.name || "unknown";

    this._cgl.profileData.addHeavyEvent("framebuffer create", this.name);

    if (!this._options.hasOwnProperty("numRenderBuffers")) this._options.numRenderBuffers = 1;
    if (!this._options.hasOwnProperty("depth")) this._options.depth = true;
    if (!this._options.hasOwnProperty("clear")) this._options.clear = true;
    if (!this._options.hasOwnProperty("multisampling"))
    {
        this._options.multisampling = false;
        this._options.multisamplingSamples = 0;
    }

    if (this._options.multisamplingSamples)
    {
        if (this._cgl.glSlowRenderer) this._options.multisamplingSamples = 0;
        if (!this._cgl.gl.MAX_SAMPLES) this._options.multisamplingSamples = 0;
        else this._options.multisamplingSamples = Math.min(this._cgl.maxSamples, this._options.multisamplingSamples);
    }

    if (!this._options.hasOwnProperty("filter")) this._options.filter = Texture.FILTER_LINEAR;
    if (!this._options.hasOwnProperty("wrap")) this._options.wrap = Texture.WRAP_REPEAT;

    this._numRenderBuffers = this._options.numRenderBuffers;
    this._colorTextures = [];

    this.clearColors = [];
    for (let i = 0; i < this._numRenderBuffers; i++) this.clearColors.push([0, 0, 0, 1]);


    if (!options.pixelFormat)
    {
        if (options.isFloatingPointTexture) this._options.pixelFormat = Texture.PFORMATSTR_RGBA32F;
        else this._options.pixelFormat = Texture.PFORMATSTR_RGBA8UB;
    }

    for (let i = 0; i < this._numRenderBuffers; i++)
    {
        this._colorTextures[i] = new Texture(cgl, {
            "name": "fb2 " + this.name + " " + i,
            "isFloatingPointTexture": this._options.isFloatingPointTexture,
            "anisotropic": this._options.anisotropic || 0,
            "pixelFormat": this._options.pixelFormat,
            "filter": this._options.filter,
            "wrap": this._options.wrap,
        });
    }



    let fil = Texture.FILTER_NEAREST;
    if (this._options.shadowMap) fil = Texture.FILTER_LINEAR;

    const defaultTexSize = 512;

    if (this._options.depth)
    {
        this._textureDepth = new Texture(cgl,
            {
                "name": "fb2 depth " + this.name,
                "isDepthTexture": true,
                "filter": fil,
                "shadowMap": this._options.shadowMap || false,
                "width": w || defaultTexSize,
                "height": h || defaultTexSize,
            });
    }

    if (cgl.aborted) return;

    this.setSize(w || defaultTexSize, h || defaultTexSize);

    this._cgl.printError("framebuffer2 constructor");
};

Framebuffer2.prototype.getWidth = function ()
{
    return this._width;
};
Framebuffer2.prototype.getHeight = function ()
{
    return this._height;
};

Framebuffer2.prototype.getGlFrameBuffer = function ()
{
    return this._frameBuffer;
};

Framebuffer2.prototype.getDepthRenderBuffer = function ()
{
    return this._depthRenderbuffer;
};

Framebuffer2.prototype.getTextureColor = function ()
{
    return this._colorTextures[0];
};

Framebuffer2.prototype.getTextureColorNum = function (i)
{
    return this._colorTextures[i];
};

Framebuffer2.prototype.getTextureDepth = function ()
{
    return this._textureDepth;
};

Framebuffer2.prototype.setFilter = function (f)
{
    for (let i = 0; i < this._numRenderBuffers; i++)
    {
        this._colorTextures[i].filter = f;
        this._colorTextures[i].setSize(this._width, this._height);
    }
};

Framebuffer2.prototype.delete = Framebuffer2.prototype.dispose = function ()
{
    this._disposed = true;
    let i = 0;
    for (i = 0; i < this._numRenderBuffers; i++) this._colorTextures[i].delete();
    // this._texture.delete();
    if (this._textureDepth) this._textureDepth.delete();
    for (i = 0; i < this._numRenderBuffers; i++) this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);
    this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);
    this._cgl.gl.deleteFramebuffer(this._frameBuffer);
    this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer);
};

Framebuffer2.prototype.setSize = function (w, h)
{
    if (this._disposed) return this._log.warn("disposed framebuffer setsize...");
    this._cgl.profileData.addHeavyEvent("framebuffer resize", this.name);

    let i = 0;

    this._width = this._cgl.checkTextureSize(w);
    this._height = this._cgl.checkTextureSize(h);

    this._cgl.profileData.profileFrameBuffercreate++;

    if (this._frameBuffer)
    {
        for (i = 0; i < this._numRenderBuffers; i++) this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);
        // this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffer);
        this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);
        this._cgl.gl.deleteFramebuffer(this._frameBuffer);
        this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer);
    }

    this._frameBuffer = this._cgl.gl.createFramebuffer();
    this._textureFrameBuffer = this._cgl.gl.createFramebuffer();

    const depth = this._options.depth;

    for (i = 0; i < this._numRenderBuffers; i++)
    {
        this._colorTextures[i].setSize(this._width, this._height);
    }

    for (i = 0; i < this._numRenderBuffers; i++)
    {
        const renderBuffer = this._cgl.gl.createRenderbuffer();

        // color renderbuffer

        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuffer);
        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, renderBuffer);

        const info = Texture.setUpGlPixelFormat(this._cgl, this._options.pixelFormat);
        let internFormat = info.glInternalFormat;

        // if (this._options.isFloatingPointTexture)
        // {
        if (CGL.Texture.isPixelFormatHalfFloat(info.pixelFormat))
        {
            if (!this._cgl.enableExtension("OES_texture_float_linear"))
            {
                this._options.filter = Texture.FILTER_NEAREST;
                this.setFilter(this._options.filter);
            }
        }
        else if (CGL.Texture.isPixelFormatFloat(info.pixelFormat))
        {
            if (!this._cgl.enableExtension("OES_texture_float_linear"))
            {
                this._log.warn("no linear pixelformat,using nearest");
                this._options.filter = Texture.FILTER_NEAREST;
                this.setFilter(this._options.filter);
            }
        }
        // else if (info.pixelFormat == Texture.PFORMATSTR_RGBA32F || info.pixelFormat == Texture.PFORMATSTR_R11FG11FB10F
        // else if (info.pixelFormat == Texture.PFORMATSTR_RGBA32F || info.pixelFormat == Texture.PFORMATSTR_R11FG11FB10F
        // else if (info.pixelFormat == Texture.PFORMATSTR_RG16F)
        // {
        //     const extcb = this._cgl.enableExtension("EXT_color_buffer_float");

        //     if (!this._cgl.enableExtension("OES_texture_float_linear"))
        //     {
        //         console.log("no linear pixelformat,switching to nearest");
        //         this._options.filter = Texture.FILTER_NEAREST;
        //         this.setFilter(this._options.filter);
        //     }
        // }
        // }

        if (this._options.multisampling && this._options.multisamplingSamples)
        {
            this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER, this._options.multisamplingSamples, internFormat, this._width, this._height);
        }
        else
        {
            this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER, internFormat, this._width, this._height);
        }



        this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0 + i, this._cgl.gl.RENDERBUFFER, renderBuffer);
        this._colorRenderbuffers[i] = renderBuffer;
    }

    // this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER, this._textureFrameBuffer);
    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._textureFrameBuffer);

    for (i = 0; i < this._numRenderBuffers; i++)
    {
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0 + i, this._cgl.gl.TEXTURE_2D, this._colorTextures[i].tex, 0);
    }

    if (this._options.depth)
    {
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.TEXTURE_2D, this._textureDepth.tex, 0);
    }

    // depth renderbuffer

    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuffer);


    let depthType = this._cgl.gl.DEPTH_COMPONENT32F;

    if (this._cgl.glSlowRenderer) depthType = this._cgl.gl.DEPTH_COMPONENT16;
    if (depth)
    {
        this._textureDepth.setSize(this._width, this._height);
        this._depthRenderbuffer = this._cgl.gl.createRenderbuffer();

        this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, this._depthRenderbuffer);
        if (this._options.isFloatingPointTexture)
        {
            if (this._options.multisampling) this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER, this._options.multisamplingSamples, depthType, this._width, this._height);
            else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER, depthType, this._width, this._height);
        }
        else if (this._options.multisampling)
        {
            this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER, this._options.multisamplingSamples, depthType, this._width, this._height);
            // this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,depthType, this._width, this._height);
        }
        else
        {
            this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER, depthType, this._width, this._height);
        }

        this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.RENDERBUFFER, this._depthRenderbuffer);
    }

    // this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);
    // this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._textureFrameBuffer);

    this._drawTargetArray.length = 0;
    for (i = 0; i < this._numRenderBuffers; i++) this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0 + i);

    // this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);


    if (!this._cgl.gl.isFramebuffer(this._textureFrameBuffer)) this._log.warn("invalid framebuffer");// throw new Error("Invalid framebuffer");
    const status = this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);

    if (status != this._cgl.gl.FRAMEBUFFER_COMPLETE)
    {
        this._log.error("framebuffer incomplete: " + this.name, this);
        this._log.log("options", this._options);
        this._log.log("options pixelformat", this._options.pixelFormat);

        switch (status)
        {
        case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...", this);
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
        case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
        case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:
            this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
        case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:
            this._log.warn("FRAMEBUFFER_UNSUPPORTED");
            throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");
        default:
            this.valid = false;
            this._log.error("incomplete framebuffer", status, this._frameBuffer);
            this._cgl.printError();

            this._frameBuffer = null;
            // debugger;
            throw new Error("Incomplete framebuffer: " + status);

        // throw("Incomplete framebuffer: " + status);
        }
    }

    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);
    this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER, null);

    // this._cgl.printError("fb setsize");
};

Framebuffer2.prototype.renderStart = function ()
{
    if (this._disposed) return this._log.warn("disposed framebuffer renderStart...");
    this._cgl.checkFrameStarted("fb2 renderstart");
    this._cgl.pushModelMatrix(); // needed ??

    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuffer);
    this._cgl.pushGlFrameBuffer(this._frameBuffer);
    this._cgl.pushFrameBuffer(this);

    this._cgl.pushPMatrix();
    this._cgl.pushViewPort(0, 0, this._width, this._height);

    this._cgl.gl.drawBuffers(this._drawTargetArray);

    if (this._options.clear)
    {
        this._cgl.gl.clearColor(0, 0, 0, 0);
        this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT | this._cgl.gl.DEPTH_BUFFER_BIT);
    }
};

Framebuffer2.prototype.clear = function ()
{
    if (this._numRenderBuffers <= 1)
    {
        this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER, this._frameBuffer);
        this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER, this._textureFrameBuffer);
    }
    else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._frameBuffer);

    this._cgl.gl.drawBuffers(this._drawTargetArray);

    for (let i = 0; i < this._numRenderBuffers; i++)
    {
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0 + i, this._cgl.gl.TEXTURE_2D, this._colorTextures[i].tex, 0);
        this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR, i, this.clearColors[i]);
    }
    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);
};

Framebuffer2.prototype.renderEnd = function ()
{
    if (this._disposed) return this._log.warn("disposed framebuffer renderEnd...");
    this._cgl.popPMatrix();

    this._cgl.profileData.profileFramebuffer++;


    if (this._numRenderBuffers <= 1)
    {
        this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER, this._frameBuffer);
        this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER, this._textureFrameBuffer);

        this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR, 0, [0.0, 0.0, 0.0, 1.0]);
        this._cgl.gl.blitFramebuffer(0, 0, this._width, this._height, 0, 0, this._width, this._height, this._cgl.gl.COLOR_BUFFER_BIT | this._cgl.gl.DEPTH_BUFFER_BIT, this._cgl.gl.NEAREST);
    }
    else
    {
        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this.Framebuffer2BlittingFramebuffer);
        this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.RENDERBUFFER, this._depthRenderbuffer);

        this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this.Framebuffer2FinalFramebuffer);
        this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.DEPTH_ATTACHMENT, this._cgl.gl.TEXTURE_2D, this._textureDepth.tex, 0);

        for (let i = 0; i < this._numRenderBuffers; i++)
        {
            this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this.Framebuffer2BlittingFramebuffer);
            this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.RENDERBUFFER, this._colorRenderbuffers[i]);


            this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this.Framebuffer2FinalFramebuffer);
            this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER, this._cgl.gl.COLOR_ATTACHMENT0, this._cgl.gl.TEXTURE_2D, this._colorTextures[i].tex, 0);

            this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, null);

            this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER, this.Framebuffer2BlittingFramebuffer);
            this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER, this.Framebuffer2FinalFramebuffer);

            // this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR, i, [0.0, 0.0, 0.0, 1.0]);



            let flags = this._cgl.gl.COLOR_BUFFER_BIT;
            if (i == 0) flags |= this._cgl.gl.DEPTH_BUFFER_BIT;

            this._cgl.gl.blitFramebuffer(0, 0, this._width, this._height, 0, 0, this._width, this._height, flags, this._cgl.gl.NEAREST);
        }
    }

    this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER, this._cgl.popGlFrameBuffer());
    this._cgl.popFrameBuffer();

    this._cgl.popModelMatrix();
    // this._cgl.resetViewPort();
    this._cgl.popViewPort();


    if (this._colorTextures[0].filter == Texture.FILTER_MIPMAP)
    {
        for (let i = 0; i < this._numRenderBuffers; i++)
        {
            this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, this._colorTextures[i].tex);
            this._colorTextures[i].updateMipMap();
            this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D, null);
        }
    }
};



/// ///////

;// CONCATENATED MODULE: ./src/core/cgl/cgl_marker.js
const Marker = function (_cgl) // deprecated...
{
    this.draw = function (cgl, _size, depthTest) {};
};

const WirePoint = function (cgl) // deprecated...
{
    this.render = function (_cgl, _size) {};
};

const WireCube = function (cgl) // deprecated...
{
    this.render = function (_cgl, sizeX, sizeY, sizeZ) {};
};

;// CONCATENATED MODULE: ./src/core/cgl/cgl_unicolorshader.js


class UniColorShader
{
    constructor(_cgl)
    {
        this.shader = new CGL.Shader(_cgl, "markermaterial");

        const frag = ""
            .endl() + "void main()"
            .endl() + "{"
            .endl() + "    outColor = vec4(color.rgb,1.0);"
            .endl() + "}";


        const vert = ""
            .endl() + "IN vec3 vPosition;"
            .endl() + "UNI mat4 projMatrix;"
            .endl() + "UNI mat4 mvMatrix;"

            .endl() + "void main()"
            .endl() + "{"
            .endl() + "   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);"
            .endl() + "}";

        this.shader.setSource(vert, frag);
        this.coloruni = this.shader.addUniformFrag("4f", "color", [1, 0.777, 1, 1]);
    }

    setColor(r, g, b, a)
    {
        this.coloruni.set(r, g, b, a);
    }
}

;// CONCATENATED MODULE: ./src/core/cgl/index.js






















const cgl_CGL = {
    "Framebuffer": Framebuffer,
    "Framebuffer2": Framebuffer2,
    "Geometry": Geometry,
    "BoundingBox": BoundingBox,
    "Marker": Marker,
    "WirePoint": WirePoint,
    "WireCube": WireCube,
    "MatrixStack": MatrixStack,
    "Mesh": Mesh,
    "MESH": MESH,
    "ShaderLibMods": ShaderLibMods,
    "Shader": Shader,
    "Uniform": Uniform,
    "MESHES": MESHES,
    "Context": Context,
    "Texture": Texture,
    "TextureEffect": TextureEffect,
    "isWindows": isWindows,
    "getWheelSpeed": getWheelSpeed,
    "getWheelDelta": getWheelDelta,
    "onLoadingAssetsFinished": onLoadingAssetsFinished,
    "ProfileData": ProfileData,
    "UniColorShader": UniColorShader,
    ...constants_CONSTANTS.BLEND_MODES,
    ...constants_CONSTANTS.SHADER,
    ...constants_CONSTANTS.MATH,
    ...constants_CONSTANTS.BLEND_MODES,
};

window.CGL = cgl_CGL;





;// CONCATENATED MODULE: ./src/core/index.js

















window.CABLES = window.CABLES || {};

CABLES.CGL = cgl_CGL;
CABLES.CG = CG;
CABLES.CGP = cgp_CGP;
CABLES.EMBED = EMBED;
CABLES.Link = Link;
CABLES.Port = Port;
CABLES.Op = Op;
CABLES.Profiler = Profiler;
CABLES.Patch = core_patch;
CABLES.Timer = Timer;
CABLES.WEBAUDIO = WEBAUDIO;
CABLES.Variable = Variable;
CABLES.LoadingStatus = LoadingStatus;
CABLES.now = now;
CABLES.internalNow = internalNow;



CABLES = Object.assign(CABLES,
    utils_namespaceObject,
    anim_namespaceObject,
    CONSTANTS.PORT,
    CONSTANTS.PACO,
    CONSTANTS.ANIM,
    CONSTANTS.OP
);

/* harmony default export */ const core = (CABLES);

if (!(function () { return !this; }())) console.warn("not in strict mode: index core"); // eslint-disable-line

CABLES = __webpack_exports__["default"];
/******/ })()
;


var CABLES = CABLES || {}; CABLES.build = {"timestamp":1736760273867,"created":"2025-01-13T09:24:33.867Z","git":{"branch":"master","commit":"0e07848fd62e35a0a77f09c4c90a3fcbd6cb9f8f","date":"1736756567","message":"canvasinfo"}};
(()=>{"use strict";var t={d:(n,a)=>{for(var r in a)t.o(a,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:a[r]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{ARRAY_TYPE:()=>f,EPSILON:()=>M,RANDOM:()=>l,equals:()=>d,setMatrixArrayType:()=>v,toRadian:()=>m});var a={};t.r(a),t.d(a,{LDU:()=>j,add:()=>z,adjoint:()=>S,clone:()=>y,copy:()=>p,create:()=>x,determinant:()=>R,equals:()=>Y,exactEquals:()=>Q,frob:()=>V,fromRotation:()=>D,fromScaling:()=>F,fromValues:()=>w,identity:()=>q,invert:()=>P,mul:()=>_,multiply:()=>T,multiplyScalar:()=>X,multiplyScalarAndAdd:()=>Z,rotate:()=>I,scale:()=>E,set:()=>g,str:()=>L,sub:()=>B,subtract:()=>O,transpose:()=>A});var r={};t.r(r),t.d(r,{add:()=>it,clone:()=>k,copy:()=>U,create:()=>N,determinant:()=>J,equals:()=>ft,exactEquals:()=>Mt,frob:()=>ot,fromRotation:()=>at,fromScaling:()=>rt,fromTranslation:()=>ut,fromValues:()=>C,identity:()=>W,invert:()=>H,mul:()=>lt,multiply:()=>K,multiplyScalar:()=>ct,multiplyScalarAndAdd:()=>st,rotate:()=>$,scale:()=>tt,set:()=>G,str:()=>et,sub:()=>vt,subtract:()=>ht,translate:()=>nt});var u={};t.r(u),t.d(u,{add:()=>Yt,adjoint:()=>At,clone:()=>dt,copy:()=>xt,create:()=>bt,determinant:()=>Pt,equals:()=>Nt,exactEquals:()=>Bt,frob:()=>Qt,fromMat2d:()=>Lt,fromMat4:()=>mt,fromQuat:()=>Vt,fromRotation:()=>Dt,fromScaling:()=>Ft,fromTranslation:()=>Et,fromValues:()=>yt,identity:()=>qt,invert:()=>gt,mul:()=>kt,multiply:()=>St,multiplyScalar:()=>Zt,multiplyScalarAndAdd:()=>_t,normalFromMat4:()=>jt,projection:()=>zt,rotate:()=>Tt,scale:()=>It,set:()=>pt,str:()=>Ot,sub:()=>Ut,subtract:()=>Xt,translate:()=>Rt,transpose:()=>wt});var e={};t.r(e),t.d(e,{add:()=>Ln,adjoint:()=>nn,clone:()=>Ct,copy:()=>Gt,create:()=>Wt,determinant:()=>an,equals:()=>Qn,exactEquals:()=>On,frob:()=>Fn,fromQuat:()=>An,fromQuat2:()=>xn,fromRotation:()=>ln,fromRotationTranslation:()=>dn,fromRotationTranslationScale:()=>wn,fromRotationTranslationScaleOrigin:()=>gn,fromScaling:()=>fn,fromTranslation:()=>Mn,fromValues:()=>Ht,fromXRotation:()=>vn,fromYRotation:()=>bn,fromZRotation:()=>mn,frustum:()=>Pn,getRotation:()=>qn,getScaling:()=>pn,getTranslation:()=>yn,identity:()=>Kt,invert:()=>tn,lookAt:()=>In,mul:()=>Yn,multiply:()=>rn,multiplyScalar:()=>jn,multiplyScalarAndAdd:()=>zn,ortho:()=>Tn,perspective:()=>Sn,perspectiveFromFieldOfView:()=>Rn,rotate:()=>on,rotateX:()=>hn,rotateY:()=>cn,rotateZ:()=>sn,scale:()=>en,set:()=>Jt,str:()=>Dn,sub:()=>Xn,subtract:()=>Vn,targetTo:()=>En,translate:()=>un,transpose:()=>$t});var o={};t.r(o),t.d(o,{add:()=>Wn,angle:()=>wa,bezier:()=>va,ceil:()=>Jn,clone:()=>_n,copy:()=>kn,create:()=>Zn,cross:()=>Ma,dist:()=>Da,distance:()=>ua,div:()=>Ea,divide:()=>Hn,dot:()=>sa,equals:()=>Sa,exactEquals:()=>Pa,floor:()=>Kn,forEach:()=>ja,fromValues:()=>Nn,hermite:()=>la,inverse:()=>ha,len:()=>La,length:()=>Bn,lerp:()=>fa,max:()=>ta,min:()=>$n,mul:()=>Ia,multiply:()=>Gn,negate:()=>ia,normalize:()=>ca,random:()=>ba,rotateX:()=>ya,rotateY:()=>pa,rotateZ:()=>qa,round:()=>na,scale:()=>aa,scaleAndAdd:()=>ra,set:()=>Un,sqrDist:()=>Fa,sqrLen:()=>Va,squaredDistance:()=>ea,squaredLength:()=>oa,str:()=>Aa,sub:()=>Ta,subtract:()=>Cn,transformMat3:()=>da,transformMat4:()=>ma,transformQuat:()=>xa,zero:()=>ga});var i={};t.r(i),t.d(i,{add:()=>Za,ceil:()=>ka,clone:()=>Oa,copy:()=>Ya,create:()=>za,cross:()=>or,dist:()=>xr,distance:()=>Ka,div:()=>dr,divide:()=>Na,dot:()=>er,equals:()=>vr,exactEquals:()=>lr,floor:()=>Ua,forEach:()=>wr,fromValues:()=>Qa,inverse:()=>rr,len:()=>pr,length:()=>tr,lerp:()=>ir,max:()=>Ca,min:()=>Wa,mul:()=>mr,multiply:()=>Ba,negate:()=>ar,normalize:()=>ur,random:()=>hr,round:()=>Ga,scale:()=>Ha,scaleAndAdd:()=>Ja,set:()=>Xa,sqrDist:()=>yr,sqrLen:()=>qr,squaredDistance:()=>$a,squaredLength:()=>nr,str:()=>fr,sub:()=>br,subtract:()=>_a,transformMat4:()=>cr,transformQuat:()=>sr,zero:()=>Mr});var h={};t.r(h),t.d(h,{add:()=>$r,calculateW:()=>Fr,clone:()=>Gr,conjugate:()=>Yr,copy:()=>Jr,create:()=>gr,dot:()=>au,equals:()=>su,exactEquals:()=>cu,exp:()=>Lr,fromEuler:()=>Zr,fromMat3:()=>Xr,fromValues:()=>Hr,getAngle:()=>Rr,getAxisAngle:()=>Sr,identity:()=>Ar,invert:()=>Qr,len:()=>eu,length:()=>uu,lerp:()=>ru,ln:()=>Vr,mul:()=>tu,multiply:()=>Tr,normalize:()=>hu,pow:()=>jr,random:()=>Or,rotateX:()=>Ir,rotateY:()=>Er,rotateZ:()=>Dr,rotationTo:()=>Mu,scale:()=>nu,set:()=>Kr,setAxes:()=>lu,setAxisAngle:()=>Pr,slerp:()=>zr,sqlerp:()=>fu,sqrLen:()=>iu,squaredLength:()=>ou,str:()=>_r});var c={};t.r(c),t.d(c,{add:()=>Ou,clone:()=>bu,conjugate:()=>Nu,copy:()=>wu,create:()=>vu,dot:()=>Zu,equals:()=>Ku,exactEquals:()=>Ju,fromMat4:()=>qu,fromRotation:()=>pu,fromRotationTranslation:()=>xu,fromRotationTranslationValues:()=>du,fromTranslation:()=>yu,fromValues:()=>mu,getDual:()=>Su,getReal:()=>Pu,getTranslation:()=>Iu,identity:()=>gu,invert:()=>Bu,len:()=>Uu,length:()=>ku,lerp:()=>_u,mul:()=>Yu,multiply:()=>Qu,normalize:()=>Gu,rotateAroundAxis:()=>zu,rotateByQuatAppend:()=>Vu,rotateByQuatPrepend:()=>ju,rotateX:()=>Du,rotateY:()=>Fu,rotateZ:()=>Lu,scale:()=>Xu,set:()=>Au,setDual:()=>Tu,setReal:()=>Ru,sqrLen:()=>Cu,squaredLength:()=>Wu,str:()=>Hu,translate:()=>Eu});var s={};t.r(s),t.d(s,{add:()=>ue,angle:()=>De,ceil:()=>he,clone:()=>te,copy:()=>ae,create:()=>$u,cross:()=>ge,dist:()=>Xe,distance:()=>be,div:()=>Ye,divide:()=>ie,dot:()=>we,equals:()=>je,exactEquals:()=>Ve,floor:()=>ce,forEach:()=>Be,fromValues:()=>ne,inverse:()=>pe,len:()=>ze,length:()=>de,lerp:()=>Ae,max:()=>Me,min:()=>se,mul:()=>Qe,multiply:()=>oe,negate:()=>ye,normalize:()=>qe,random:()=>Pe,rotate:()=>Ee,round:()=>fe,scale:()=>le,scaleAndAdd:()=>ve,set:()=>re,sqrDist:()=>Ze,sqrLen:()=>_e,squaredDistance:()=>me,squaredLength:()=>xe,str:()=>Le,sub:()=>Oe,subtract:()=>ee,transformMat2:()=>Se,transformMat2d:()=>Re,transformMat3:()=>Te,transformMat4:()=>Ie,zero:()=>Fe});var M=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array,l=Math.random;function v(t){f=t}var b=Math.PI/180;function m(t){return t*b}function d(t,n){return Math.abs(t-n)<=M*Math.max(1,Math.abs(t),Math.abs(n))}function x(){var t=new f(4);return f!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function y(t){var n=new f(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function p(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function q(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function w(t,n,a,r){var u=new f(4);return u[0]=t,u[1]=n,u[2]=a,u[3]=r,u}function g(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function A(t,n){if(t===n){var a=n[1];t[1]=n[2],t[2]=a}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function P(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*e-u*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-u*o,t[3]=a*o,t):null}function S(t,n){var a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t}function R(t){return t[0]*t[3]-t[2]*t[1]}function T(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],h=a[1],c=a[2],s=a[3];return t[0]=r*i+e*h,t[1]=u*i+o*h,t[2]=r*c+e*s,t[3]=u*c+o*s,t}function I(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),h=Math.cos(a);return t[0]=r*h+e*i,t[1]=u*h+o*i,t[2]=r*-i+e*h,t[3]=u*-i+o*h,t}function E(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],h=a[1];return t[0]=r*i,t[1]=u*i,t[2]=e*h,t[3]=o*h,t}function D(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t}function F(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function L(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function V(t){return Math.hypot(t[0],t[1],t[2],t[3])}function j(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]}function z(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function O(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function Q(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function Y(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=n[0],i=n[1],h=n[2],c=n[3];return Math.abs(a-o)<=M*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(r-i)<=M*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-h)<=M*Math.max(1,Math.abs(u),Math.abs(h))&&Math.abs(e-c)<=M*Math.max(1,Math.abs(e),Math.abs(c))}function X(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function Z(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var _=T,B=O;function N(){var t=new f(6);return f!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function k(t){var n=new f(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function U(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function W(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function C(t,n,a,r,u,e){var o=new f(6);return o[0]=t,o[1]=n,o[2]=a,o[3]=r,o[4]=u,o[5]=e,o}function G(t,n,a,r,u,e,o){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t}function H(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=a*e-r*u;return h?(h=1/h,t[0]=e*h,t[1]=-r*h,t[2]=-u*h,t[3]=a*h,t[4]=(u*i-e*o)*h,t[5]=(r*o-a*i)*h,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function K(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return t[0]=r*c+e*s,t[1]=u*c+o*s,t[2]=r*M+e*f,t[3]=u*M+o*f,t[4]=r*l+e*v+i,t[5]=u*l+o*v+h,t}function $(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=Math.sin(a),s=Math.cos(a);return t[0]=r*s+e*c,t[1]=u*s+o*c,t[2]=r*-c+e*s,t[3]=u*-c+o*s,t[4]=i,t[5]=h,t}function tt(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=a[0],s=a[1];return t[0]=r*c,t[1]=u*c,t[2]=e*s,t[3]=o*s,t[4]=i,t[5]=h,t}function nt(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=a[0],s=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=r*c+e*s+i,t[5]=u*c+o*s+h,t}function at(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t}function rt(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function ut(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function et(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ot(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function it(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t}function ht(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}function ct(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t}function st(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t}function Mt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]}function ft(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=t[4],i=t[5],h=n[0],c=n[1],s=n[2],f=n[3],l=n[4],v=n[5];return Math.abs(a-h)<=M*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(r-c)<=M*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(u-s)<=M*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(e-f)<=M*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(o-l)<=M*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-v)<=M*Math.max(1,Math.abs(i),Math.abs(v))}var lt=K,vt=ht;function bt(){var t=new f(9);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function mt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function dt(t){var n=new f(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function xt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function yt(t,n,a,r,u,e,o,i,h){var c=new f(9);return c[0]=t,c[1]=n,c[2]=a,c[3]=r,c[4]=u,c[5]=e,c[6]=o,c[7]=i,c[8]=h,c}function pt(t,n,a,r,u,e,o,i,h,c){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=h,t[8]=c,t}function qt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wt(t,n){if(t===n){var a=n[1],r=n[2],u=n[5];t[1]=n[3],t[2]=n[6],t[3]=a,t[5]=n[7],t[6]=r,t[7]=u}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function gt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=n[6],c=n[7],s=n[8],M=s*o-i*c,f=-s*e+i*h,l=c*e-o*h,v=a*M+r*f+u*l;return v?(v=1/v,t[0]=M*v,t[1]=(-s*r+u*c)*v,t[2]=(i*r-u*o)*v,t[3]=f*v,t[4]=(s*a-u*h)*v,t[5]=(-i*a+u*e)*v,t[6]=l*v,t[7]=(-c*a+r*h)*v,t[8]=(o*a-r*e)*v,t):null}function At(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=n[6],c=n[7],s=n[8];return t[0]=o*s-i*c,t[1]=u*c-r*s,t[2]=r*i-u*o,t[3]=i*h-e*s,t[4]=a*s-u*h,t[5]=u*e-a*i,t[6]=e*c-o*h,t[7]=r*h-a*c,t[8]=a*o-r*e,t}function Pt(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],h=t[7],c=t[8];return n*(c*e-o*h)+a*(-c*u+o*i)+r*(h*u-e*i)}function St(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=n[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],y=a[7],p=a[8];return t[0]=f*r+l*o+v*c,t[1]=f*u+l*i+v*s,t[2]=f*e+l*h+v*M,t[3]=b*r+m*o+d*c,t[4]=b*u+m*i+d*s,t[5]=b*e+m*h+d*M,t[6]=x*r+y*o+p*c,t[7]=x*u+y*i+p*s,t[8]=x*e+y*h+p*M,t}function Rt(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=n[8],f=a[0],l=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=h,t[6]=f*r+l*o+c,t[7]=f*u+l*i+s,t[8]=f*e+l*h+M,t}function Tt(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=n[8],f=Math.sin(a),l=Math.cos(a);return t[0]=l*r+f*o,t[1]=l*u+f*i,t[2]=l*e+f*h,t[3]=l*o-f*r,t[4]=l*i-f*u,t[5]=l*h-f*e,t[6]=c,t[7]=s,t[8]=M,t}function It(t,n,a){var r=a[0],u=a[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=u*n[3],t[4]=u*n[4],t[5]=u*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Et(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Dt(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ft(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Vt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,h=u+u,c=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*h,b=e*o,m=e*i,d=e*h;return t[0]=1-M-v,t[3]=s-d,t[6]=f+m,t[1]=s+d,t[4]=1-c-v,t[7]=l-b,t[2]=f-m,t[5]=l+b,t[8]=1-c-M,t}function jt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=n[6],c=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,y=a*h-u*o,p=a*c-e*o,q=r*h-u*i,w=r*c-e*i,g=u*c-e*h,A=s*b-M*v,P=s*m-f*v,S=s*d-l*v,R=M*m-f*b,T=M*d-l*b,I=f*d-l*m,E=x*I-y*T+p*R+q*S-w*P+g*A;return E?(E=1/E,t[0]=(i*I-h*T+c*R)*E,t[1]=(h*S-o*I-c*P)*E,t[2]=(o*T-i*S+c*A)*E,t[3]=(u*T-r*I-e*R)*E,t[4]=(a*I-u*S+e*P)*E,t[5]=(r*S-a*T-e*A)*E,t[6]=(b*g-m*w+d*q)*E,t[7]=(m*p-v*g-d*y)*E,t[8]=(v*w-b*p+d*x)*E,t):null}function zt(t,n,a){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ot(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Qt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Yt(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t}function Xt(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t}function Zt(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t}function _t(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t}function Bt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function Nt(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=t[4],i=t[5],h=t[6],c=t[7],s=t[8],f=n[0],l=n[1],v=n[2],b=n[3],m=n[4],d=n[5],x=n[6],y=n[7],p=n[8];return Math.abs(a-f)<=M*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(r-l)<=M*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(u-v)<=M*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(e-b)<=M*Math.max(1,Math.abs(e),Math.abs(b))&&Math.abs(o-m)<=M*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(i-d)<=M*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(h-x)<=M*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(c-y)<=M*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(s-p)<=M*Math.max(1,Math.abs(s),Math.abs(p))}var kt=St,Ut=Xt;function Wt(){var t=new f(16);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ct(t){var n=new f(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Gt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function Ht(t,n,a,r,u,e,o,i,h,c,s,M,l,v,b,m){var d=new f(16);return d[0]=t,d[1]=n,d[2]=a,d[3]=r,d[4]=u,d[5]=e,d[6]=o,d[7]=i,d[8]=h,d[9]=c,d[10]=s,d[11]=M,d[12]=l,d[13]=v,d[14]=b,d[15]=m,d}function Jt(t,n,a,r,u,e,o,i,h,c,s,M,f,l,v,b,m){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=h,t[8]=c,t[9]=s,t[10]=M,t[11]=f,t[12]=l,t[13]=v,t[14]=b,t[15]=m,t}function Kt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $t(t,n){if(t===n){var a=n[1],r=n[2],u=n[3],e=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=a,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=e,t[11]=n[14],t[12]=u,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function tn(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=n[6],c=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,y=a*h-u*o,p=a*c-e*o,q=r*h-u*i,w=r*c-e*i,g=u*c-e*h,A=s*b-M*v,P=s*m-f*v,S=s*d-l*v,R=M*m-f*b,T=M*d-l*b,I=f*d-l*m,E=x*I-y*T+p*R+q*S-w*P+g*A;return E?(E=1/E,t[0]=(i*I-h*T+c*R)*E,t[1]=(u*T-r*I-e*R)*E,t[2]=(b*g-m*w+d*q)*E,t[3]=(f*w-M*g-l*q)*E,t[4]=(h*S-o*I-c*P)*E,t[5]=(a*I-u*S+e*P)*E,t[6]=(m*p-v*g-d*y)*E,t[7]=(s*g-f*p+l*y)*E,t[8]=(o*T-i*S+c*A)*E,t[9]=(r*S-a*T-e*A)*E,t[10]=(v*w-b*p+d*x)*E,t[11]=(M*p-s*w-l*x)*E,t[12]=(i*P-o*R-h*A)*E,t[13]=(a*R-r*P+u*A)*E,t[14]=(b*y-v*q-m*x)*E,t[15]=(s*q-M*y+f*x)*E,t):null}function nn(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],h=n[6],c=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15];return t[0]=i*(f*d-l*m)-M*(h*d-c*m)+b*(h*l-c*f),t[1]=-(r*(f*d-l*m)-M*(u*d-e*m)+b*(u*l-e*f)),t[2]=r*(h*d-c*m)-i*(u*d-e*m)+b*(u*c-e*h),t[3]=-(r*(h*l-c*f)-i*(u*l-e*f)+M*(u*c-e*h)),t[4]=-(o*(f*d-l*m)-s*(h*d-c*m)+v*(h*l-c*f)),t[5]=a*(f*d-l*m)-s*(u*d-e*m)+v*(u*l-e*f),t[6]=-(a*(h*d-c*m)-o*(u*d-e*m)+v*(u*c-e*h)),t[7]=a*(h*l-c*f)-o*(u*l-e*f)+s*(u*c-e*h),t[8]=o*(M*d-l*b)-s*(i*d-c*b)+v*(i*l-c*M),t[9]=-(a*(M*d-l*b)-s*(r*d-e*b)+v*(r*l-e*M)),t[10]=a*(i*d-c*b)-o*(r*d-e*b)+v*(r*c-e*i),t[11]=-(a*(i*l-c*M)-o*(r*l-e*M)+s*(r*c-e*i)),t[12]=-(o*(M*m-f*b)-s*(i*m-h*b)+v*(i*f-h*M)),t[13]=a*(M*m-f*b)-s*(r*m-u*b)+v*(r*f-u*M),t[14]=-(a*(i*m-h*b)-o*(r*m-u*b)+v*(r*h-u*i)),t[15]=a*(i*f-h*M)-o*(r*f-u*M)+s*(r*h-u*i),t}function an(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],h=t[7],c=t[8],s=t[9],M=t[10],f=t[11],l=t[12],v=t[13],b=t[14],m=t[15];return(n*o-a*e)*(M*m-f*b)-(n*i-r*e)*(s*m-f*v)+(n*h-u*e)*(s*b-M*v)+(a*i-r*o)*(c*m-f*l)-(a*h-u*o)*(c*b-M*l)+(r*h-u*i)*(c*v-s*l)}function rn(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],b=n[12],m=n[13],d=n[14],x=n[15],y=a[0],p=a[1],q=a[2],w=a[3];return t[0]=y*r+p*i+q*M+w*b,t[1]=y*u+p*h+q*f+w*m,t[2]=y*e+p*c+q*l+w*d,t[3]=y*o+p*s+q*v+w*x,y=a[4],p=a[5],q=a[6],w=a[7],t[4]=y*r+p*i+q*M+w*b,t[5]=y*u+p*h+q*f+w*m,t[6]=y*e+p*c+q*l+w*d,t[7]=y*o+p*s+q*v+w*x,y=a[8],p=a[9],q=a[10],w=a[11],t[8]=y*r+p*i+q*M+w*b,t[9]=y*u+p*h+q*f+w*m,t[10]=y*e+p*c+q*l+w*d,t[11]=y*o+p*s+q*v+w*x,y=a[12],p=a[13],q=a[14],w=a[15],t[12]=y*r+p*i+q*M+w*b,t[13]=y*u+p*h+q*f+w*m,t[14]=y*e+p*c+q*l+w*d,t[15]=y*o+p*s+q*v+w*x,t}function un(t,n,a){var r,u,e,o,i,h,c,s,M,f,l,v,b=a[0],m=a[1],d=a[2];return n===t?(t[12]=n[0]*b+n[4]*m+n[8]*d+n[12],t[13]=n[1]*b+n[5]*m+n[9]*d+n[13],t[14]=n[2]*b+n[6]*m+n[10]*d+n[14],t[15]=n[3]*b+n[7]*m+n[11]*d+n[15]):(r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=h,t[6]=c,t[7]=s,t[8]=M,t[9]=f,t[10]=l,t[11]=v,t[12]=r*b+i*m+M*d+n[12],t[13]=u*b+h*m+f*d+n[13],t[14]=e*b+c*m+l*d+n[14],t[15]=o*b+s*m+v*d+n[15]),t}function en(t,n,a){var r=a[0],u=a[1],e=a[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*u,t[5]=n[5]*u,t[6]=n[6]*u,t[7]=n[7]*u,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function on(t,n,a,r){var u,e,o,i,h,c,s,f,l,v,b,m,d,x,y,p,q,w,g,A,P,S,R,T,I=r[0],E=r[1],D=r[2],F=Math.hypot(I,E,D);return F<M?null:(I*=F=1/F,E*=F,D*=F,u=Math.sin(a),o=1-(e=Math.cos(a)),i=n[0],h=n[1],c=n[2],s=n[3],f=n[4],l=n[5],v=n[6],b=n[7],m=n[8],d=n[9],x=n[10],y=n[11],p=I*I*o+e,q=E*I*o+D*u,w=D*I*o-E*u,g=I*E*o-D*u,A=E*E*o+e,P=D*E*o+I*u,S=I*D*o+E*u,R=E*D*o-I*u,T=D*D*o+e,t[0]=i*p+f*q+m*w,t[1]=h*p+l*q+d*w,t[2]=c*p+v*q+x*w,t[3]=s*p+b*q+y*w,t[4]=i*g+f*A+m*P,t[5]=h*g+l*A+d*P,t[6]=c*g+v*A+x*P,t[7]=s*g+b*A+y*P,t[8]=i*S+f*R+m*T,t[9]=h*S+l*R+d*T,t[10]=c*S+v*R+x*T,t[11]=s*S+b*R+y*T,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function hn(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[4],o=n[5],i=n[6],h=n[7],c=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=e*u+c*r,t[5]=o*u+s*r,t[6]=i*u+M*r,t[7]=h*u+f*r,t[8]=c*u-e*r,t[9]=s*u-o*r,t[10]=M*u-i*r,t[11]=f*u-h*r,t}function cn(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],h=n[3],c=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u-c*r,t[1]=o*u-s*r,t[2]=i*u-M*r,t[3]=h*u-f*r,t[8]=e*r+c*u,t[9]=o*r+s*u,t[10]=i*r+M*u,t[11]=h*r+f*u,t}function sn(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],h=n[3],c=n[4],s=n[5],M=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u+c*r,t[1]=o*u+s*r,t[2]=i*u+M*r,t[3]=h*u+f*r,t[4]=c*u-e*r,t[5]=s*u-o*r,t[6]=M*u-i*r,t[7]=f*u-h*r,t}function Mn(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function fn(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ln(t,n,a){var r,u,e,o=a[0],i=a[1],h=a[2],c=Math.hypot(o,i,h);return c<M?null:(o*=c=1/c,i*=c,h*=c,r=Math.sin(n),e=1-(u=Math.cos(n)),t[0]=o*o*e+u,t[1]=i*o*e+h*r,t[2]=h*o*e-i*r,t[3]=0,t[4]=o*i*e-h*r,t[5]=i*i*e+u,t[6]=h*i*e+o*r,t[7]=0,t[8]=o*h*e+i*r,t[9]=i*h*e-o*r,t[10]=h*h*e+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function vn(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bn(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mn(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dn(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=r+r,h=u+u,c=e+e,s=r*i,M=r*h,f=r*c,l=u*h,v=u*c,b=e*c,m=o*i,d=o*h,x=o*c;return t[0]=1-(l+b),t[1]=M+x,t[2]=f-d,t[3]=0,t[4]=M-x,t[5]=1-(s+b),t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-(s+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function xn(t,n){var a=new f(3),r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=r*r+u*u+e*e+o*o;return M>0?(a[0]=2*(i*o+s*r+h*e-c*u)/M,a[1]=2*(h*o+s*u+c*r-i*e)/M,a[2]=2*(c*o+s*e+i*u-h*r)/M):(a[0]=2*(i*o+s*r+h*e-c*u),a[1]=2*(h*o+s*u+c*r-i*e),a[2]=2*(c*o+s*e+i*u-h*r)),dn(t,n,a),t}function yn(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function pn(t,n){var a=n[0],r=n[1],u=n[2],e=n[4],o=n[5],i=n[6],h=n[8],c=n[9],s=n[10];return t[0]=Math.hypot(a,r,u),t[1]=Math.hypot(e,o,i),t[2]=Math.hypot(h,c,s),t}function qn(t,n){var a=new f(3);pn(a,n);var r=1/a[0],u=1/a[1],e=1/a[2],o=n[0]*r,i=n[1]*u,h=n[2]*e,c=n[4]*r,s=n[5]*u,M=n[6]*e,l=n[8]*r,v=n[9]*u,b=n[10]*e,m=o+s+b,d=0;return m>0?(d=2*Math.sqrt(m+1),t[3]=.25*d,t[0]=(M-v)/d,t[1]=(l-h)/d,t[2]=(i-c)/d):o>s&&o>b?(d=2*Math.sqrt(1+o-s-b),t[3]=(M-v)/d,t[0]=.25*d,t[1]=(i+c)/d,t[2]=(l+h)/d):s>b?(d=2*Math.sqrt(1+s-o-b),t[3]=(l-h)/d,t[0]=(i+c)/d,t[1]=.25*d,t[2]=(M+v)/d):(d=2*Math.sqrt(1+b-o-s),t[3]=(i-c)/d,t[0]=(l+h)/d,t[1]=(M+v)/d,t[2]=.25*d),t}function wn(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3],h=u+u,c=e+e,s=o+o,M=u*h,f=u*c,l=u*s,v=e*c,b=e*s,m=o*s,d=i*h,x=i*c,y=i*s,p=r[0],q=r[1],w=r[2];return t[0]=(1-(v+m))*p,t[1]=(f+y)*p,t[2]=(l-x)*p,t[3]=0,t[4]=(f-y)*q,t[5]=(1-(M+m))*q,t[6]=(b+d)*q,t[7]=0,t[8]=(l+x)*w,t[9]=(b-d)*w,t[10]=(1-(M+v))*w,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function gn(t,n,a,r,u){var e=n[0],o=n[1],i=n[2],h=n[3],c=e+e,s=o+o,M=i+i,f=e*c,l=e*s,v=e*M,b=o*s,m=o*M,d=i*M,x=h*c,y=h*s,p=h*M,q=r[0],w=r[1],g=r[2],A=u[0],P=u[1],S=u[2],R=(1-(b+d))*q,T=(l+p)*q,I=(v-y)*q,E=(l-p)*w,D=(1-(f+d))*w,F=(m+x)*w,L=(v+y)*g,V=(m-x)*g,j=(1-(f+b))*g;return t[0]=R,t[1]=T,t[2]=I,t[3]=0,t[4]=E,t[5]=D,t[6]=F,t[7]=0,t[8]=L,t[9]=V,t[10]=j,t[11]=0,t[12]=a[0]+A-(R*A+E*P+L*S),t[13]=a[1]+P-(T*A+D*P+V*S),t[14]=a[2]+S-(I*A+F*P+j*S),t[15]=1,t}function An(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,h=u+u,c=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*h,b=e*o,m=e*i,d=e*h;return t[0]=1-M-v,t[1]=s+d,t[2]=f-m,t[3]=0,t[4]=s-d,t[5]=1-c-v,t[6]=l+b,t[7]=0,t[8]=f+m,t[9]=l-b,t[10]=1-c-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pn(t,n,a,r,u,e,o){var i=1/(a-n),h=1/(u-r),c=1/(e-o);return t[0]=2*e*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*h,t[6]=0,t[7]=0,t[8]=(a+n)*i,t[9]=(u+r)*h,t[10]=(o+e)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*c,t[15]=0,t}function Sn(t,n,a,r,u){var e,o=1/Math.tan(n/2);return t[0]=o/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(e=1/(r-u),t[10]=(u+r)*e,t[14]=2*u*r*e):(t[10]=-1,t[14]=-2*r),t}function Rn(t,n,a,r){var u=Math.tan(n.upDegrees*Math.PI/180),e=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),i=Math.tan(n.rightDegrees*Math.PI/180),h=2/(o+i),c=2/(u+e);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-i)*h*.5,t[9]=(u-e)*c*.5,t[10]=r/(a-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*a/(a-r),t[15]=0,t}function Tn(t,n,a,r,u,e,o){var i=1/(n-a),h=1/(r-u),c=1/(e-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+a)*i,t[13]=(u+r)*h,t[14]=(o+e)*c,t[15]=1,t}function In(t,n,a,r){var u,e,o,i,h,c,s,f,l,v,b=n[0],m=n[1],d=n[2],x=r[0],y=r[1],p=r[2],q=a[0],w=a[1],g=a[2];return Math.abs(b-q)<M&&Math.abs(m-w)<M&&Math.abs(d-g)<M?Kt(t):(s=b-q,f=m-w,l=d-g,u=y*(l*=v=1/Math.hypot(s,f,l))-p*(f*=v),e=p*(s*=v)-x*l,o=x*f-y*s,(v=Math.hypot(u,e,o))?(u*=v=1/v,e*=v,o*=v):(u=0,e=0,o=0),i=f*o-l*e,h=l*u-s*o,c=s*e-f*u,(v=Math.hypot(i,h,c))?(i*=v=1/v,h*=v,c*=v):(i=0,h=0,c=0),t[0]=u,t[1]=i,t[2]=s,t[3]=0,t[4]=e,t[5]=h,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=l,t[11]=0,t[12]=-(u*b+e*m+o*d),t[13]=-(i*b+h*m+c*d),t[14]=-(s*b+f*m+l*d),t[15]=1,t)}function En(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=r[0],h=r[1],c=r[2],s=u-a[0],M=e-a[1],f=o-a[2],l=s*s+M*M+f*f;l>0&&(s*=l=1/Math.sqrt(l),M*=l,f*=l);var v=h*f-c*M,b=c*s-i*f,m=i*M-h*s;return(l=v*v+b*b+m*m)>0&&(v*=l=1/Math.sqrt(l),b*=l,m*=l),t[0]=v,t[1]=b,t[2]=m,t[3]=0,t[4]=M*m-f*b,t[5]=f*v-s*m,t[6]=s*b-M*v,t[7]=0,t[8]=s,t[9]=M,t[10]=f,t[11]=0,t[12]=u,t[13]=e,t[14]=o,t[15]=1,t}function Dn(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Fn(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ln(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t[9]=n[9]+a[9],t[10]=n[10]+a[10],t[11]=n[11]+a[11],t[12]=n[12]+a[12],t[13]=n[13]+a[13],t[14]=n[14]+a[14],t[15]=n[15]+a[15],t}function Vn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t[9]=n[9]-a[9],t[10]=n[10]-a[10],t[11]=n[11]-a[11],t[12]=n[12]-a[12],t[13]=n[13]-a[13],t[14]=n[14]-a[14],t[15]=n[15]-a[15],t}function jn(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12]*a,t[13]=n[13]*a,t[14]=n[14]*a,t[15]=n[15]*a,t}function zn(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t[9]=n[9]+a[9]*r,t[10]=n[10]+a[10]*r,t[11]=n[11]+a[11]*r,t[12]=n[12]+a[12]*r,t[13]=n[13]+a[13]*r,t[14]=n[14]+a[14]*r,t[15]=n[15]+a[15]*r,t}function On(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function Qn(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=t[4],i=t[5],h=t[6],c=t[7],s=t[8],f=t[9],l=t[10],v=t[11],b=t[12],m=t[13],d=t[14],x=t[15],y=n[0],p=n[1],q=n[2],w=n[3],g=n[4],A=n[5],P=n[6],S=n[7],R=n[8],T=n[9],I=n[10],E=n[11],D=n[12],F=n[13],L=n[14],V=n[15];return Math.abs(a-y)<=M*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(r-p)<=M*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(u-q)<=M*Math.max(1,Math.abs(u),Math.abs(q))&&Math.abs(e-w)<=M*Math.max(1,Math.abs(e),Math.abs(w))&&Math.abs(o-g)<=M*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-A)<=M*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(h-P)<=M*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(c-S)<=M*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(s-R)<=M*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(f-T)<=M*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(l-I)<=M*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(v-E)<=M*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(b-D)<=M*Math.max(1,Math.abs(b),Math.abs(D))&&Math.abs(m-F)<=M*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(d-L)<=M*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(x-V)<=M*Math.max(1,Math.abs(x),Math.abs(V))}var Yn=rn,Xn=Vn;function Zn(){var t=new f(3);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function _n(t){var n=new f(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Bn(t){var n=t[0],a=t[1],r=t[2];return Math.hypot(n,a,r)}function Nn(t,n,a){var r=new f(3);return r[0]=t,r[1]=n,r[2]=a,r}function kn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Un(t,n,a,r){return t[0]=n,t[1]=a,t[2]=r,t}function Wn(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t}function Cn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t}function Gn(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t}function Hn(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t}function Jn(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function Kn(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function $n(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t}function ta(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t}function na(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function aa(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t}function ra(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t}function ua(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return Math.hypot(a,r,u)}function ea(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return a*a+r*r+u*u}function oa(t){var n=t[0],a=t[1],r=t[2];return n*n+a*a+r*r}function ia(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function ha(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function ca(t,n){var a=n[0],r=n[1],u=n[2],e=a*a+r*r+u*u;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function sa(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Ma(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],h=a[2];return t[0]=u*h-e*i,t[1]=e*o-r*h,t[2]=r*i-u*o,t}function fa(t,n,a,r){var u=n[0],e=n[1],o=n[2];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t}function la(t,n,a,r,u,e){var o=e*e,i=o*(2*e-3)+1,h=o*(e-2)+e,c=o*(e-1),s=o*(3-2*e);return t[0]=n[0]*i+a[0]*h+r[0]*c+u[0]*s,t[1]=n[1]*i+a[1]*h+r[1]*c+u[1]*s,t[2]=n[2]*i+a[2]*h+r[2]*c+u[2]*s,t}function va(t,n,a,r,u,e){var o=1-e,i=o*o,h=e*e,c=i*o,s=3*e*i,M=3*h*o,f=h*e;return t[0]=n[0]*c+a[0]*s+r[0]*M+u[0]*f,t[1]=n[1]*c+a[1]*s+r[1]*M+u[1]*f,t[2]=n[2]*c+a[2]*s+r[2]*M+u[2]*f,t}function ba(t,n){n=n||1;var a=2*l()*Math.PI,r=2*l()-1,u=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(a)*u,t[1]=Math.sin(a)*u,t[2]=r*n,t}function ma(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[3]*r+a[7]*u+a[11]*e+a[15];return o=o||1,t[0]=(a[0]*r+a[4]*u+a[8]*e+a[12])/o,t[1]=(a[1]*r+a[5]*u+a[9]*e+a[13])/o,t[2]=(a[2]*r+a[6]*u+a[10]*e+a[14])/o,t}function da(t,n,a){var r=n[0],u=n[1],e=n[2];return t[0]=r*a[0]+u*a[3]+e*a[6],t[1]=r*a[1]+u*a[4]+e*a[7],t[2]=r*a[2]+u*a[5]+e*a[8],t}function xa(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],h=n[1],c=n[2],s=u*c-e*h,M=e*i-r*c,f=r*h-u*i,l=u*f-e*M,v=e*s-r*f,b=r*M-u*s,m=2*o;return s*=m,M*=m,f*=m,l*=2,v*=2,b*=2,t[0]=i+s+l,t[1]=h+M+v,t[2]=c+f+b,t}function ya(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0],e[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),e[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t}function pa(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),e[1]=u[1],e[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t}function qa(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),e[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),e[2]=u[2],t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t}function wa(t,n){var a=Nn(t[0],t[1],t[2]),r=Nn(n[0],n[1],n[2]);ca(a,a),ca(r,r);var u=sa(a,r);return u>1?0:u<-1?Math.PI:Math.acos(u)}function ga(t){return t[0]=0,t[1]=0,t[2]=0,t}function Aa(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Pa(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Sa(t,n){var a=t[0],r=t[1],u=t[2],e=n[0],o=n[1],i=n[2];return Math.abs(a-e)<=M*Math.max(1,Math.abs(a),Math.abs(e))&&Math.abs(r-o)<=M*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(u-i)<=M*Math.max(1,Math.abs(u),Math.abs(i))}var Ra,Ta=Cn,Ia=Gn,Ea=Hn,Da=ua,Fa=ea,La=Bn,Va=oa,ja=(Ra=Zn(),function(t,n,a,r,u,e){var o,i;for(n||(n=3),a||(a=0),i=r?Math.min(r*n+a,t.length):t.length,o=a;o<i;o+=n)Ra[0]=t[o],Ra[1]=t[o+1],Ra[2]=t[o+2],u(Ra,Ra,e),t[o]=Ra[0],t[o+1]=Ra[1],t[o+2]=Ra[2];return t});function za(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Oa(t){var n=new f(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Qa(t,n,a,r){var u=new f(4);return u[0]=t,u[1]=n,u[2]=a,u[3]=r,u}function Ya(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Xa(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function Za(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function _a(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function Ba(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t[3]=n[3]*a[3],t}function Na(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t[3]=n[3]/a[3],t}function ka(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function Ua(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function Wa(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t[3]=Math.min(n[3],a[3]),t}function Ca(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t[3]=Math.max(n[3],a[3]),t}function Ga(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function Ha(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function Ja(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t}function Ka(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return Math.hypot(a,r,u,e)}function $a(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return a*a+r*r+u*u+e*e}function tr(t){var n=t[0],a=t[1],r=t[2],u=t[3];return Math.hypot(n,a,r,u)}function nr(t){var n=t[0],a=t[1],r=t[2],u=t[3];return n*n+a*a+r*r+u*u}function ar(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function rr(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function ur(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=a*o,t[1]=r*o,t[2]=u*o,t[3]=e*o,t}function er(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function or(t,n,a,r){var u=a[0]*r[1]-a[1]*r[0],e=a[0]*r[2]-a[2]*r[0],o=a[0]*r[3]-a[3]*r[0],i=a[1]*r[2]-a[2]*r[1],h=a[1]*r[3]-a[3]*r[1],c=a[2]*r[3]-a[3]*r[2],s=n[0],M=n[1],f=n[2],l=n[3];return t[0]=M*c-f*h+l*i,t[1]=-s*c+f*o-l*e,t[2]=s*h-M*o+l*u,t[3]=-s*i+M*e-f*u,t}function ir(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t[3]=i+r*(a[3]-i),t}function hr(t,n){var a,r,u,e,o,i;n=n||1;do{o=(a=2*l()-1)*a+(r=2*l()-1)*r}while(o>=1);do{i=(u=2*l()-1)*u+(e=2*l()-1)*e}while(i>=1);var h=Math.sqrt((1-o)/i);return t[0]=n*a,t[1]=n*r,t[2]=n*u*h,t[3]=n*e*h,t}function cr(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3];return t[0]=a[0]*r+a[4]*u+a[8]*e+a[12]*o,t[1]=a[1]*r+a[5]*u+a[9]*e+a[13]*o,t[2]=a[2]*r+a[6]*u+a[10]*e+a[14]*o,t[3]=a[3]*r+a[7]*u+a[11]*e+a[15]*o,t}function sr(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],h=a[2],c=a[3],s=c*r+i*e-h*u,M=c*u+h*r-o*e,f=c*e+o*u-i*r,l=-o*r-i*u-h*e;return t[0]=s*c+l*-o+M*-h-f*-i,t[1]=M*c+l*-i+f*-o-s*-h,t[2]=f*c+l*-h+s*-i-M*-o,t[3]=n[3],t}function Mr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function fr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function lr(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function vr(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=n[0],i=n[1],h=n[2],c=n[3];return Math.abs(a-o)<=M*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(r-i)<=M*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-h)<=M*Math.max(1,Math.abs(u),Math.abs(h))&&Math.abs(e-c)<=M*Math.max(1,Math.abs(e),Math.abs(c))}var br=_a,mr=Ba,dr=Na,xr=Ka,yr=$a,pr=tr,qr=nr,wr=function(){var t=za();return function(n,a,r,u,e,o){var i,h;for(a||(a=4),r||(r=0),h=u?Math.min(u*a+r,n.length):n.length,i=r;i<h;i+=a)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],e(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}();function gr(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ar(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Pr(t,n,a){a*=.5;var r=Math.sin(a);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(a),t}function Sr(t,n){var a=2*Math.acos(n[3]),r=Math.sin(a/2);return r>M?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),a}function Rr(t,n){var a=au(t,n);return Math.acos(2*a*a-1)}function Tr(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],h=a[1],c=a[2],s=a[3];return t[0]=r*s+o*i+u*c-e*h,t[1]=u*s+o*h+e*i-r*c,t[2]=e*s+o*c+r*h-u*i,t[3]=o*s-r*i-u*h-e*c,t}function Ir(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),h=Math.cos(a);return t[0]=r*h+o*i,t[1]=u*h+e*i,t[2]=e*h-u*i,t[3]=o*h-r*i,t}function Er(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),h=Math.cos(a);return t[0]=r*h-e*i,t[1]=u*h+o*i,t[2]=e*h+r*i,t[3]=o*h-u*i,t}function Dr(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),h=Math.cos(a);return t[0]=r*h+u*i,t[1]=u*h-r*i,t[2]=e*h+o*i,t[3]=o*h-e*i,t}function Fr(t,n){var a=n[0],r=n[1],u=n[2];return t[0]=a,t[1]=r,t[2]=u,t[3]=Math.sqrt(Math.abs(1-a*a-r*r-u*u)),t}function Lr(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=Math.exp(e),h=o>0?i*Math.sin(o)/o:0;return t[0]=a*h,t[1]=r*h,t[2]=u*h,t[3]=i*Math.cos(o),t}function Vr(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=o>0?Math.atan2(o,e)/o:0;return t[0]=a*i,t[1]=r*i,t[2]=u*i,t[3]=.5*Math.log(a*a+r*r+u*u+e*e),t}function jr(t,n,a){return Vr(t,n),nu(t,t,a),Lr(t,t),t}function zr(t,n,a,r){var u,e,o,i,h,c=n[0],s=n[1],f=n[2],l=n[3],v=a[0],b=a[1],m=a[2],d=a[3];return(e=c*v+s*b+f*m+l*d)<0&&(e=-e,v=-v,b=-b,m=-m,d=-d),1-e>M?(u=Math.acos(e),o=Math.sin(u),i=Math.sin((1-r)*u)/o,h=Math.sin(r*u)/o):(i=1-r,h=r),t[0]=i*c+h*v,t[1]=i*s+h*b,t[2]=i*f+h*m,t[3]=i*l+h*d,t}function Or(t){var n=l(),a=l(),r=l(),u=Math.sqrt(1-n),e=Math.sqrt(n);return t[0]=u*Math.sin(2*Math.PI*a),t[1]=u*Math.cos(2*Math.PI*a),t[2]=e*Math.sin(2*Math.PI*r),t[3]=e*Math.cos(2*Math.PI*r),t}function Qr(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e,i=o?1/o:0;return t[0]=-a*i,t[1]=-r*i,t[2]=-u*i,t[3]=e*i,t}function Yr(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function Xr(t,n){var a,r=n[0]+n[4]+n[8];if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(n[5]-n[7])*a,t[1]=(n[6]-n[2])*a,t[2]=(n[1]-n[3])*a;else{var u=0;n[4]>n[0]&&(u=1),n[8]>n[3*u+u]&&(u=2);var e=(u+1)%3,o=(u+2)%3;a=Math.sqrt(n[3*u+u]-n[3*e+e]-n[3*o+o]+1),t[u]=.5*a,a=.5/a,t[3]=(n[3*e+o]-n[3*o+e])*a,t[e]=(n[3*e+u]+n[3*u+e])*a,t[o]=(n[3*o+u]+n[3*u+o])*a}return t}function Zr(t,n,a,r){var u=.5*Math.PI/180;n*=u,a*=u,r*=u;var e=Math.sin(n),o=Math.cos(n),i=Math.sin(a),h=Math.cos(a),c=Math.sin(r),s=Math.cos(r);return t[0]=e*h*s-o*i*c,t[1]=o*i*s+e*h*c,t[2]=o*h*c-e*i*s,t[3]=o*h*s+e*i*c,t}function _r(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Br,Nr,kr,Ur,Wr,Cr,Gr=Oa,Hr=Qa,Jr=Ya,Kr=Xa,$r=Za,tu=Tr,nu=Ha,au=er,ru=ir,uu=tr,eu=uu,ou=nr,iu=ou,hu=ur,cu=lr,su=vr,Mu=(Br=Zn(),Nr=Nn(1,0,0),kr=Nn(0,1,0),function(t,n,a){var r=sa(n,a);return r<-.999999?(Ma(Br,Nr,n),La(Br)<1e-6&&Ma(Br,kr,n),ca(Br,Br),Pr(t,Br,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ma(Br,n,a),t[0]=Br[0],t[1]=Br[1],t[2]=Br[2],t[3]=1+r,hu(t,t))}),fu=(Ur=gr(),Wr=gr(),function(t,n,a,r,u,e){return zr(Ur,n,u,e),zr(Wr,a,r,e),zr(t,Ur,Wr,2*e*(1-e)),t}),lu=(Cr=bt(),function(t,n,a,r){return Cr[0]=a[0],Cr[3]=a[1],Cr[6]=a[2],Cr[1]=r[0],Cr[4]=r[1],Cr[7]=r[2],Cr[2]=-n[0],Cr[5]=-n[1],Cr[8]=-n[2],hu(t,Xr(t,Cr))});function vu(){var t=new f(8);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function bu(t){var n=new f(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function mu(t,n,a,r,u,e,o,i){var h=new f(8);return h[0]=t,h[1]=n,h[2]=a,h[3]=r,h[4]=u,h[5]=e,h[6]=o,h[7]=i,h}function du(t,n,a,r,u,e,o){var i=new f(8);i[0]=t,i[1]=n,i[2]=a,i[3]=r;var h=.5*u,c=.5*e,s=.5*o;return i[4]=h*r+c*a-s*n,i[5]=c*r+s*t-h*a,i[6]=s*r+h*n-c*t,i[7]=-h*t-c*n-s*a,i}function xu(t,n,a){var r=.5*a[0],u=.5*a[1],e=.5*a[2],o=n[0],i=n[1],h=n[2],c=n[3];return t[0]=o,t[1]=i,t[2]=h,t[3]=c,t[4]=r*c+u*h-e*i,t[5]=u*c+e*o-r*h,t[6]=e*c+r*i-u*o,t[7]=-r*o-u*i-e*h,t}function yu(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t}function pu(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function qu(t,n){var a=gr();qn(a,n);var r=new f(3);return yn(r,n),xu(t,a,r),t}function wu(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}function gu(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Au(t,n,a,r,u,e,o,i,h){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=h,t}var Pu=Jr;function Su(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t}var Ru=Jr;function Tu(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t}function Iu(t,n){var a=n[4],r=n[5],u=n[6],e=n[7],o=-n[0],i=-n[1],h=-n[2],c=n[3];return t[0]=2*(a*c+e*o+r*h-u*i),t[1]=2*(r*c+e*i+u*o-a*h),t[2]=2*(u*c+e*h+a*i-r*o),t}function Eu(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=.5*a[0],h=.5*a[1],c=.5*a[2],s=n[4],M=n[5],f=n[6],l=n[7];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=o*i+u*c-e*h+s,t[5]=o*h+e*i-r*c+M,t[6]=o*c+r*h-u*i+f,t[7]=-r*i-u*h-e*c+l,t}function Du(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=i*o+s*r+h*e-c*u,f=h*o+s*u+c*r-i*e,l=c*o+s*e+i*u-h*r,v=s*o-i*r-h*u-c*e;return Ir(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t}function Fu(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=i*o+s*r+h*e-c*u,f=h*o+s*u+c*r-i*e,l=c*o+s*e+i*u-h*r,v=s*o-i*r-h*u-c*e;return Er(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t}function Lu(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],h=n[5],c=n[6],s=n[7],M=i*o+s*r+h*e-c*u,f=h*o+s*u+c*r-i*e,l=c*o+s*e+i*u-h*r,v=s*o-i*r-h*u-c*e;return Dr(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t}function Vu(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],h=n[1],c=n[2],s=n[3];return t[0]=i*o+s*r+h*e-c*u,t[1]=h*o+s*u+c*r-i*e,t[2]=c*o+s*e+i*u-h*r,t[3]=s*o-i*r-h*u-c*e,i=n[4],h=n[5],c=n[6],s=n[7],t[4]=i*o+s*r+h*e-c*u,t[5]=h*o+s*u+c*r-i*e,t[6]=c*o+s*e+i*u-h*r,t[7]=s*o-i*r-h*u-c*e,t}function ju(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],h=a[1],c=a[2],s=a[3];return t[0]=r*s+o*i+u*c-e*h,t[1]=u*s+o*h+e*i-r*c,t[2]=e*s+o*c+r*h-u*i,t[3]=o*s-r*i-u*h-e*c,i=a[4],h=a[5],c=a[6],s=a[7],t[4]=r*s+o*i+u*c-e*h,t[5]=u*s+o*h+e*i-r*c,t[6]=e*s+o*c+r*h-u*i,t[7]=o*s-r*i-u*h-e*c,t}function zu(t,n,a,r){if(Math.abs(r)<M)return wu(t,n);var u=Math.hypot(a[0],a[1],a[2]);r*=.5;var e=Math.sin(r),o=e*a[0]/u,i=e*a[1]/u,h=e*a[2]/u,c=Math.cos(r),s=n[0],f=n[1],l=n[2],v=n[3];t[0]=s*c+v*o+f*h-l*i,t[1]=f*c+v*i+l*o-s*h,t[2]=l*c+v*h+s*i-f*o,t[3]=v*c-s*o-f*i-l*h;var b=n[4],m=n[5],d=n[6],x=n[7];return t[4]=b*c+x*o+m*h-d*i,t[5]=m*c+x*i+d*o-b*h,t[6]=d*c+x*h+b*i-m*o,t[7]=x*c-b*o-m*i-d*h,t}function Ou(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t}function Qu(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[4],h=a[5],c=a[6],s=a[7],M=n[4],f=n[5],l=n[6],v=n[7],b=a[0],m=a[1],d=a[2],x=a[3];return t[0]=r*x+o*b+u*d-e*m,t[1]=u*x+o*m+e*b-r*d,t[2]=e*x+o*d+r*m-u*b,t[3]=o*x-r*b-u*m-e*d,t[4]=r*s+o*i+u*c-e*h+M*x+v*b+f*d-l*m,t[5]=u*s+o*h+e*i-r*c+f*x+v*m+l*b-M*d,t[6]=e*s+o*c+r*h-u*i+l*x+v*d+M*m-f*b,t[7]=o*s-r*i-u*h-e*c+v*x-M*b-f*m-l*d,t}var Yu=Qu;function Xu(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t}var Zu=au;function _u(t,n,a,r){var u=1-r;return Zu(n,a)<0&&(r=-r),t[0]=n[0]*u+a[0]*r,t[1]=n[1]*u+a[1]*r,t[2]=n[2]*u+a[2]*r,t[3]=n[3]*u+a[3]*r,t[4]=n[4]*u+a[4]*r,t[5]=n[5]*u+a[5]*r,t[6]=n[6]*u+a[6]*r,t[7]=n[7]*u+a[7]*r,t}function Bu(t,n){var a=Wu(n);return t[0]=-n[0]/a,t[1]=-n[1]/a,t[2]=-n[2]/a,t[3]=n[3]/a,t[4]=-n[4]/a,t[5]=-n[5]/a,t[6]=-n[6]/a,t[7]=n[7]/a,t}function Nu(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t}var ku=uu,Uu=ku,Wu=ou,Cu=Wu;function Gu(t,n){var a=Wu(n);if(a>0){a=Math.sqrt(a);var r=n[0]/a,u=n[1]/a,e=n[2]/a,o=n[3]/a,i=n[4],h=n[5],c=n[6],s=n[7],M=r*i+u*h+e*c+o*s;t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=(i-r*M)/a,t[5]=(h-u*M)/a,t[6]=(c-e*M)/a,t[7]=(s-o*M)/a}return t}function Hu(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Ju(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]}function Ku(t,n){var a=t[0],r=t[1],u=t[2],e=t[3],o=t[4],i=t[5],h=t[6],c=t[7],s=n[0],f=n[1],l=n[2],v=n[3],b=n[4],m=n[5],d=n[6],x=n[7];return Math.abs(a-s)<=M*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(r-f)<=M*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(u-l)<=M*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(e-v)<=M*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(o-b)<=M*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-m)<=M*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(h-d)<=M*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(c-x)<=M*Math.max(1,Math.abs(c),Math.abs(x))}function $u(){var t=new f(2);return f!=Float32Array&&(t[0]=0,t[1]=0),t}function te(t){var n=new f(2);return n[0]=t[0],n[1]=t[1],n}function ne(t,n){var a=new f(2);return a[0]=t,a[1]=n,a}function ae(t,n){return t[0]=n[0],t[1]=n[1],t}function re(t,n,a){return t[0]=n,t[1]=a,t}function ue(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t}function ee(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t}function oe(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t}function ie(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t}function he(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function ce(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function se(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t}function Me(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t}function fe(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function le(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t}function ve(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t}function be(t,n){var a=n[0]-t[0],r=n[1]-t[1];return Math.hypot(a,r)}function me(t,n){var a=n[0]-t[0],r=n[1]-t[1];return a*a+r*r}function de(t){var n=t[0],a=t[1];return Math.hypot(n,a)}function xe(t){var n=t[0],a=t[1];return n*n+a*a}function ye(t,n){return t[0]=-n[0],t[1]=-n[1],t}function pe(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function qe(t,n){var a=n[0],r=n[1],u=a*a+r*r;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t}function we(t,n){return t[0]*n[0]+t[1]*n[1]}function ge(t,n,a){var r=n[0]*a[1]-n[1]*a[0];return t[0]=t[1]=0,t[2]=r,t}function Ae(t,n,a,r){var u=n[0],e=n[1];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t}function Pe(t,n){n=n||1;var a=2*l()*Math.PI;return t[0]=Math.cos(a)*n,t[1]=Math.sin(a)*n,t}function Se(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u,t[1]=a[1]*r+a[3]*u,t}function Re(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u+a[4],t[1]=a[1]*r+a[3]*u+a[5],t}function Te(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[3]*u+a[6],t[1]=a[1]*r+a[4]*u+a[7],t}function Ie(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[4]*u+a[12],t[1]=a[1]*r+a[5]*u+a[13],t}function Ee(t,n,a,r){var u=n[0]-a[0],e=n[1]-a[1],o=Math.sin(r),i=Math.cos(r);return t[0]=u*i-e*o+a[0],t[1]=u*o+e*i+a[1],t}function De(t,n){var a=t[0],r=t[1],u=n[0],e=n[1],o=a*a+r*r;o>0&&(o=1/Math.sqrt(o));var i=u*u+e*e;i>0&&(i=1/Math.sqrt(i));var h=(a*u+r*e)*o*i;return h>1?0:h<-1?Math.PI:Math.acos(h)}function Fe(t){return t[0]=0,t[1]=0,t}function Le(t){return"vec2("+t[0]+", "+t[1]+")"}function Ve(t,n){return t[0]===n[0]&&t[1]===n[1]}function je(t,n){var a=t[0],r=t[1],u=n[0],e=n[1];return Math.abs(a-u)<=M*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(r-e)<=M*Math.max(1,Math.abs(r),Math.abs(e))}var ze=de,Oe=ee,Qe=oe,Ye=ie,Xe=be,Ze=me,_e=xe,Be=function(){var t=$u();return function(n,a,r,u,e,o){var i,h;for(a||(a=2),r||(r=0),h=u?Math.min(u*a+r,n.length):n.length,i=r;i<h;i+=a)t[0]=n[i],t[1]=n[i+1],e(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}();window.glMatrix=n,window.mat2=a,window.mat2d=r,window.mat3=u,window.mat4=e,window.quat=h,window.quat2=c,window.vec2=s,window.vec3=o,window.vec4=i})();
//# sourceMappingURL=libs.core.js.map
if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["tvDm1H"]={_id:"67ea7e1610ea7516bc3c11cb",ops:[{id:"gs5gfr4x7",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Base object",portOut:"Result",objIn:"fz9bzrip0",objOut:"gs5gfr4x7"}]},{name:"Valid",value:1}],objName:"Ops.Json.ParseObject_v2"},{id:"guczzk966",uiAttribs:{},portsIn:[{name:"Id",value:"Test"},{name:"Renderer index",value:1},{name:"Renderer",value:"svg"},{name:"Theme index",value:1},{name:"Theme",value:"light"},{name:"Style",value:"position:absolute;\nz-index:100;\nbackground:white;\nfont-size: 0;"},{name:"Visible",value:1}],objName:"Ops.Extension.ECharts.ECharts"},{id:"hc01l1ggd",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Any value",portOut:"Result",objIn:"fz9bzrip0",objOut:"hc01l1ggd"}]},{name:"Valid",value:1}],objName:"Ops.Json.ParseObject_v2"},{id:"4myq0ntf2",uiAttribs:{},portsIn:[{name:"Play Timeline",value:1}],portsOut:[{name:"Finished Initial Loading",value:1},{name:"Loading",value:0},{name:"Progress",value:1},{name:"Trigger Loading Finished ",links:[{portIn:"render",portOut:"Trigger Loading Finished ",objIn:"8h0914384",objOut:"4myq0ntf2"}]}],objName:"Ops.Cables.LoadingStatus_v2"},{id:"gjsh9vzk6",uiAttribs:{},portsIn:[{name:"file",value:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9FHG5acKKhP0nLtM8lYq7qYJEuHlV0J3d0G-5_rEHs714JYLav2HyjoUybS6D5EDthUcscuw1FPg7/pub?gid=0&single=true&output=csv",display:"file",title:"URL"},{name:"body",value:""},{name:"HTTP Method index",value:0},{name:"HTTP Method",value:"GET"},{name:"Content-Type",value:"application/json"},{name:"Content index",value:1},{name:"Content",value:"String",title:"Response Content"},{name:"Auto request",value:"true"},{name:"Send Credentials",value:0}],portsOut:[{name:"Response String",links:[{portIn:"CSV Input",portOut:"Response String",objIn:"zlb4qjcma",objOut:"gjsh9vzk6"}]},{name:"Response Data Url",value:""},{name:"Duration MS",value:2152},{name:"Status Code",value:200},{name:"Is Loading",value:0}],objName:"Ops.Json.HttpRequest_v3"},{id:"zlb4qjcma",uiAttribs:{},portsOut:[{name:"JSON Output",links:[{portIn:"JSON String",portOut:"JSON Output",objIn:"hc01l1ggd",objOut:"zlb4qjcma"}]}],objName:"Ops.Patch.PtvDm1H.CSV_to_JsonSunburst"},{id:"1n49vnrbi",uiAttribs:{},portsIn:[{name:"Max Pixel Density (DPR)",value:2},{name:"FPS Limit",value:0},{name:"Reduce FPS unfocussed",value:0},{name:"Transparent",value:0},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"4myq0ntf2",objOut:"1n49vnrbi"}]},{name:"width",links:[{portIn:"Width",portOut:"width",objIn:"guczzk966",objOut:"1n49vnrbi"}]},{name:"height",links:[{portIn:"Height",portOut:"height",objIn:"guczzk966",objOut:"1n49vnrbi"}]},{name:"Pixel Density",value:1.25}],objName:"Ops.Gl.MainLoop_v2"},{id:"fz9bzrip0",uiAttribs:{},portsIn:[{name:"Path 1",value:"series.0.data"},{name:"Copy obj",value:1}],portsOut:[{name:"Out Object",links:[{portIn:"Chart Object",portOut:"Out Object",objIn:"guczzk966",objOut:"fz9bzrip0"}]}],objName:"Ops.Patch.PtvDm1H.ObjectSetAnyByPath_Kirell_Benzi"},{id:"bopj2sde7",uiAttribs:{},portsIn:[{name:"value",value:'{\r\n    "title": {\r\n        "text": "Echart sunburst"\r\n    },\r\n    "tooltip": {},\r\n    "legend": {\r\n        "data": [\r\n            "DSI"\r\n        ]\r\n    },\r\n    "series": [\r\n        {\r\n            "type": "sunburst",\r\n            "data": [\r\n                \r\n            ],\r\n            "emphasis": {\r\n                "focus": "ancestor",\r\n                "itemStyle": {\r\n                    "color": "red"\r\n                }\r\n            },\r\n            "levels": [\r\n                {},\r\n                {\r\n                    "r0": "5%",\r\n                    "r": "lvlR1%",\r\n                    "itemStyle": {\r\n                        "borderWidth": 1\r\n                    },\r\n                    "label": {\r\n                        "fontSize": "R1FontSize"\r\n                    }\r\n                },\r\n                {\r\n                    "r0": "lvlR1%",\r\n                    "r": "lvlR2%",\r\n                    "label": {\r\n                        "fontSize": "R2FontSize"\r\n                    }\r\n                },\r\n                {\r\n                    "r0": "lvlR2%",\r\n                    "r": "lvlR3%",\r\n                    "label": {\r\n                        "fontSize": "R3FontSize"\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    ]\r\n}'},{name:"Syntax index",value:5},{name:"Syntax",value:"json"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"3bbs5rrt2",objOut:"bopj2sde7"}]}],objName:"Ops.String.StringEditor"},{id:"3bbs5rrt2",uiAttribs:{},portsIn:[{name:"Search For",value:"R1FontSize"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"2xvy8p4qx",objOut:"3bbs5rrt2"}]}],objName:"Ops.String.StringReplace"},{id:"2xvy8p4qx",uiAttribs:{},portsIn:[{name:"Search For",value:"R2FontSize"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"5r4p7an8g",objOut:"2xvy8p4qx"}]}],objName:"Ops.String.StringReplace"},{id:"5r4p7an8g",uiAttribs:{},portsIn:[{name:"Search For",value:"R3FontSize"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"vysuq36uv",objOut:"5r4p7an8g"}]}],objName:"Ops.String.StringReplace"},{id:"78c9rcjqy",uiAttribs:{},portsIn:[{name:"Visible",value:1},{name:"Opacity",value:.9},{name:"Default Minimized",value:1},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:1},{name:"Show Minimize",value:0},{name:"Title",value:"Sidebar"},{name:"Side",value:0},{name:"Default CSS",value:1}],portsOut:[{name:"childs",title:"Children",links:[{portIn:"Number 0",portOut:"childs",objIn:"5rs0cripp",objOut:"78c9rcjqy"}]},{name:"Opfened",value:true,title:"Opened"}],objName:"Ops.Sidebar.Sidebar"},{id:"5rs0cripp",uiAttribs:{},portsOut:[{name:"Output 0",links:[{portIn:"Link",portOut:"Output 0",objIn:"yrndh603f",objOut:"5rs0cripp"}]},{name:"Output 1",links:[{portIn:"Link",portOut:"Output 1",objIn:"79ajk2h1d",objOut:"5rs0cripp"}]},{name:"Output 2",links:[{portIn:"Link",portOut:"Output 2",objIn:"1xsb86m2k",objOut:"5rs0cripp"}]},{name:"Output 7",links:[{portIn:"link",portOut:"Output 7",objIn:"mf4fcx7yp",objOut:"5rs0cripp"}]},{name:"Output 8",links:[{portIn:"link",portOut:"Output 8",objIn:"oijsxwoig",objOut:"5rs0cripp"}]},{name:"Output 9",links:[{portIn:"link",portOut:"Output 9",objIn:"65afopmox",objOut:"5rs0cripp"}]}],objName:"Ops.Json.SequenceObjects"},{id:"1xsb86m2k",uiAttribs:{},portsIn:[{name:"Text",value:"Level 3"},{name:"Input",value:4},{name:"Default",value:0}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"n6a8yo5dr",objOut:"1xsb86m2k"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"79ajk2h1d",uiAttribs:{},portsIn:[{name:"Text",value:"Level 2"},{name:"Input",value:8},{name:"Default",value:0}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"1lbcuk66f",objOut:"79ajk2h1d"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"yrndh603f",uiAttribs:{},portsIn:[{name:"Text",value:"Level 1"},{name:"Input",value:10},{name:"Default",value:0}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"9vy52yxc6",objOut:"yrndh603f"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"n6a8yo5dr",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"5r4p7an8g",objOut:"n6a8yo5dr"}]}],objName:"Ops.String.NumberToString_v2"},{id:"1lbcuk66f",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"2xvy8p4qx",objOut:"1lbcuk66f"}]}],objName:"Ops.String.NumberToString_v2"},{id:"9vy52yxc6",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"3bbs5rrt2",objOut:"9vy52yxc6"}]}],objName:"Ops.String.NumberToString_v2"},{id:"mf4fcx7yp",uiAttribs:{},portsIn:[{name:"Text",value:"Level 1"},{name:"Min",value:5.3},{name:"Max",value:100},{name:"Step",value:1},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:23},{name:"Default",value:23}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"skf9qkxkq",objOut:"mf4fcx7yp"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"oijsxwoig",uiAttribs:{},portsIn:[{name:"Text",value:"Level 2"},{name:"Min",value:0},{name:"Max",value:100},{name:"Step",value:1},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:47},{name:"Default",value:47}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"94w3vj68h",objOut:"oijsxwoig"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"65afopmox",uiAttribs:{},portsIn:[{name:"Text",value:"Level 3"},{name:"Min",value:0},{name:"Max",value:100},{name:"Step",value:1},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:65},{name:"Default",value:65}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"ft3dnnwrc",objOut:"65afopmox"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"skf9qkxkq",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"vysuq36uv",objOut:"skf9qkxkq"}]}],objName:"Ops.String.NumberToString_v2"},{id:"94w3vj68h",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"hxl4uvv9c",objOut:"94w3vj68h"}]}],objName:"Ops.String.NumberToString_v2"},{id:"ft3dnnwrc",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Replace",portOut:"Result",objIn:"xzxiqn6jp",objOut:"ft3dnnwrc"}]}],objName:"Ops.String.NumberToString_v2"},{id:"vysuq36uv",uiAttribs:{},portsIn:[{name:"Search For",value:"lvlR1"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"hxl4uvv9c",objOut:"vysuq36uv"}]}],objName:"Ops.String.StringReplace"},{id:"hxl4uvv9c",uiAttribs:{},portsIn:[{name:"Search For",value:"lvlR2"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"String",portOut:"Result",objIn:"xzxiqn6jp",objOut:"hxl4uvv9c"}]}],objName:"Ops.String.StringReplace"},{id:"xzxiqn6jp",uiAttribs:{},portsIn:[{name:"Search For",value:"lvlR3"},{name:"Replace What index",value:0},{name:"Replace What",value:"All"}],portsOut:[{name:"Result",links:[{portIn:"value",portOut:"Result",objIn:"d412baxwp",objOut:"xzxiqn6jp"}]}],objName:"Ops.String.StringReplace"},{id:"d412baxwp",uiAttribs:{},portsIn:[{name:"Syntax index",value:5},{name:"Syntax",value:"json"}],portsOut:[{name:"Result",links:[{portIn:"JSON String",portOut:"Result",objIn:"gs5gfr4x7",objOut:"d412baxwp"}]}],objName:"Ops.String.StringEditor"},{id:"8h0914384",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Create",portOut:"trigger",objIn:"guczzk966",objOut:"8h0914384"}]}],objName:"Ops.Gl.Matrix.Transform"}],export:{time:"2025-04-22 12:15",service:"html",exportNumber:1}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["tvDm1H"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Json=Ops.Json||{};Ops.Patch=Ops.Patch||{};Ops.Cables=Ops.Cables||{};Ops.String=Ops.String||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Extension=Ops.Extension||{};Ops.Gl.Matrix=Ops.Gl.Matrix||{};Ops.Patch.PtvDm1H=Ops.Patch.PtvDm1H||{};Ops.Extension.ECharts=Ops.Extension.ECharts||{};Ops.Json.ParseObject_v2=function(){CABLES.Op.apply(this,arguments);const s=this;const e=s.attachments={};const l=s.inStringEditor("JSON String","{}","json"),t=s.outObject("Result"),u=s.outBoolNum("Valid");l.onChange=r;r();function r(){if(!l.get()){t.set(null);u.set(false);return}try{const e=JSON.parse(l.get());t.setRef(e);u.set(true);s.setUiError("invalidjson",null)}catch(e){s.logWarn(e);u.set(false);let t="";const r=e.message.split(" ");for(let e=0;e<r.length-1;e++){const i=parseFloat(r[e+1]);if(i&&r[e]=="position"){const n=l.get().substring(i-15,i);const a=l.get().substring(i,i+1);const o=l.get().substring(i+1,i+15);t='<span style="font-family:monospace;background-color:black;">'+n+'<span style="font-weight:bold;background-color:red;">'+a+"</span>"+o+" </span>"}}s.setUiError("invalidjson","INVALID JSON<br/>can not parse string to object:<br/><b> "+e.message+"</b><br/>"+t)}}};Ops.Json.ParseObject_v2.prototype=new CABLES.Op;CABLES.OPS["2ce8a4d3-37d3-4cdc-abd1-a560fbe841ee"]={f:Ops.Json.ParseObject_v2,objName:"Ops.Json.ParseObject_v2"};Ops.Extension.ECharts.ECharts=function(){CABLES.Op.apply(this,arguments);const e=this;const E=e.attachments={};const t=e.inTriggerButton("Create");const r=e.inObject("Parent DOM element");const i=e.inString("Id");const n=e.inInt("Width",640);const a=e.inInt("Height",480);const o=e.inObject("Chart Object");const s=e.inObject("Merge options");const l=e.inSwitch("Renderer",["canvas","svg"],"canvas");const u=e.inSwitch("Theme",["default","light","dark"],"dark");const c=e.inObject("Custom theme obj");const f=e.inObject("Init extra Options");const h=e.inValueEditor("Style","position:absolute;\nz-index:100;\nbackground:white;","inline-css");const p=e.inValueBool("Visible",true);const v=e.outObject("DOM Element");const d=e.outObject("ECharts instance");const g=e.outTrigger("Chart updated");const y=e.outTrigger("Theme changed");const R=0;const z=1;const B=2;let m=false;const x=document.createElement("div");x.dataset.op=e.id;const _=e.patch.cgl.canvas.parentElement;let b=null;let w="block";e.onDelete=G;r.onChange=D;h.onChange=N;p.onChange=O;i.onChange=V;n.onChange=k;a.onChange=k;o.onChange=L;s.onChange=L;u.onChange=T;c.onChange=T;l.onChange=C;function S(e){if(e&&typeof e==="object"&&e!==0&&e!==null)return true;return false}function M(){D();N();m=true;I();k();d.set(b);y.trigger();g.trigger()}function I(){if(!m)return;if(b){b.dispose();b=null}let e=c.get();if(!e){e=u.get()}let t=f.get();if(!S(t)){const r=l.get();t={renderer:r}}b=echarts.init(x,e,t);A()}function C(){I();d.set(b);g.trigger()}function T(){I();d.set(b);y.trigger();g.trigger()}function D(){const e=r.get();if(!e){_.append(x)}else{e.append(x)}}function A(){const e=o.get();const t=s.get();if(!b)return;if(S(e)){if(S(t)){b.setOption(e,t)}else{b.setOption(e,false,true)}}}function L(){A();g.trigger()}function k(){const e=Math.max(0,n.get());const t=Math.max(0,a.get());N();if(b)b.resize(e,t)}function P(e){if(!e){x.style.visibility="hidden";w=x.style.display||"block";x.style.display="none"}else{if(w=="none")w="block";x.style.visibility="visible";x.style.display=w}}function O(){P(p.get())}function V(){x.id=i.get()}function N(){const e=Math.max(0,n.get());const t=Math.max(0,a.get());let r=h.get();if(e>0){r+="width:"+e+"px;"}if(t>0){r+="height:"+t+"px;"}if(r!=x.style){x.setAttribute("style",r);O();v.set(null);v.set(x)}if(!x.parentElement){_.appendChild(x)}}function G(){if(b)b.dispose();if(x)x.remove()}t.onTriggered=M};Ops.Extension.ECharts.ECharts.prototype=new CABLES.Op;CABLES.OPS["576db162-78fc-422d-86df-0d4a4e66a44e"]={f:Ops.Extension.ECharts.ECharts,objName:"Ops.Extension.ECharts.ECharts"};Ops.Cables.LoadingStatus_v2=function(){CABLES.Op.apply(this,arguments);const i=this;const e=i.attachments={};const t=i.inTrigger("exe"),n=i.inBool("Play Timeline",true),r=i.outTrigger("Next"),a=i.outBoolNum("Finished Initial Loading",false),o=i.outBoolNum("Loading"),s=i.outNumber("Progress"),l=i.outArray("Jobs"),u=i.outTrigger("Trigger Loading Finished ");const c=i.patch.cgl;const f=i.patch;let h=false;const p=[];let v=true;let d=0;document.body.classList.add("cables-loading");let g=c.patch.loading.start("loadingStatusInit","loadingStatusInit",i);i.patch.loading.on("finishedTask",y.bind(this));i.patch.loading.on("startTask",y.bind(this));function y(){const e=i.patch.loading.getListJobs();s.set(f.loading.getProgress());let t=e.length===0;const r=!t;if(r){l.set(i.patch.loading.getListJobs())}if(r){if(v){i.patch.timer.setTime(0);if(n.get()){i.patch.timer.play()}else{i.patch.timer.pause()}}v=false;document.body.classList.remove("cables-loading");document.body.classList.add("cables-loaded")}else{h=true;l.set(i.patch.loading.getListJobs());if(f.loading.getProgress()<1){i.patch.timer.setTime(0);i.patch.timer.pause()}}a.set(h);if(o.get()&&t)u.trigger();o.set(r);i.setUiAttribs({loading:r})}t.onTriggered=()=>{y();r.trigger();if(g){c.patch.loading.finished(g);g=null}}};Ops.Cables.LoadingStatus_v2.prototype=new CABLES.Op;CABLES.OPS["e62f7f4c-7436-437e-8451-6bc3c28545f7"]={f:Ops.Cables.LoadingStatus_v2,objName:"Ops.Cables.LoadingStatus_v2"};Ops.Json.HttpRequest_v3=function(){CABLES.Op.apply(this,arguments);const a=this;const e=a.attachments={};const i=a.inUrl("file"),o=a.inObject("headers",{}),s=a.inStringEditor("body",""),l=a.inDropDown("HTTP Method",["GET","POST","PUT","DELETE","PATCH","HEAD","CONNECT","OPTIONS","TRACE"],"GET"),u=a.inString("Content-Type","application/json"),c=a.inSwitch("Content",["JSON","String","Binary","Binary Base64"],"JSON"),f=a.inBool("Auto request",true),h=a.inBool("Send Credentials",false),t=a.inTriggerButton("reload"),p=a.outObject("Response Json Object"),v=a.outString("Response String"),d=a.outString("Response Data Url"),g=a.outNumber("Duration MS",0),y=a.outNumber("Status Code",0),m=a.outBoolNum("Is Loading",false),x=a.outTrigger("Loaded");c.setUiAttribs({title:"Response Content"});i.setUiAttribs({title:"URL"});t.setUiAttribs({buttonTitle:"trigger request"});p.ignoreValueSerialize=true;v.ignoreValueSerialize=true;v.onLinkChanged=d.onLinkChanged=p.onLinkChanged=_;c.onChange=()=>{const e=c.get()==="Binary";l.setUiAttribs({greyout:e});n(false)};f.onChange=i.onChange=o.onChange=l.onChange=()=>{n(false)};t.onTriggered=()=>{n(true)};let r=0;function n(e=false){clearTimeout(r);r=setTimeout(()=>{b(null,e)},100)}a.onFileChanged=e=>{if(i.get()&&i.get().indexOf(e)>-1)b(true)};function _(){if(!i.get())a.setUiError("nourl","URL is empty",1);else a.setUiError("nourl",null)}function b(e,t=false){if(!f.get()&&!t)return;_();if(!i.get()){return}const n=a.patch.loading.start(a.objName,""+i.get(),a);m.set(true);a.setUiAttrib({extendTitle:CABLES.basename(i.get())});a.setUiError("jsonerr",null);a.setUiError("jsonParse",null);let r=a.patch.getFilePath(i.get());if(e)r+="?rnd="+CABLES.generateUUID();a.patch.loading.addAssetLoadingTask(()=>{const e=s.get();const i=performance.now();const t={};if(h.get())t.credentials="include";if(c.get().contains("Binary")){fetch(r,t).then(e=>{g.set(Math.round(performance.now()-i));y.set(e.status);e.blob().then(e=>{d.set(URL.createObjectURL(e));if(c.get().contains("Base64")){const t=new FileReader;t.onloadend=function(){const e=t.result;d.set(e);m.set(false);x.trigger();a.patch.loading.finished(n)};t.readAsDataURL(e)}else{m.set(false);x.trigger();a.patch.loading.finished(n)}}).catch(e=>{a.logError(e);a.setUiError("jsonerr","Problem while loading data:<br/>"+e,1);m.set(false);p.setRef(null);v.set("");x.trigger();a.patch.loading.finished(n)})}).catch(e=>{a.logError(e);a.setUiError("jsonerr","Problem while loading data:<br/>"+e,1);m.set(false);p.setRef(null);v.set("");x.trigger();a.patch.loading.finished(n)})}else{CABLES.ajax(r,(e,t,r)=>{g.set(Math.round(performance.now()-i));y.set(r.status);try{let e=t;if(typeof e==="string"&&c.get()==="JSON"){try{e=JSON.parse(t);p.setRef(e)}catch(e){a.setUiError("jsonParse","could not parse json"+e.message,1);p.setRef({})}}v.set(t);a.uiAttr({error:null});x.trigger();m.set(false);a.patch.loading.finished(n)}catch(e){a.logError(e);a.setUiError("jsonerr","Problem while loading data:<br/>"+e,1);m.set(false);p.setRef(null);v.set("");a.patch.loading.finished(n)}},l.get(),e&&e.length>0?e:null,u.get(),null,o.get()||{},t)}})}};Ops.Json.HttpRequest_v3.prototype=new CABLES.Op;CABLES.OPS["ba2131a6-782d-40fe-9710-57a8e57051bb"]={f:Ops.Json.HttpRequest_v3,objName:"Ops.Json.HttpRequest_v3"};Ops.Patch.PtvDm1H.CSV_to_JsonSunburst=function(){CABLES.Op.apply(this,arguments);const e=this;const t=e.attachments={};const i=e.inString("CSV Input");const n=e.outString("JSON Output");i.onChange=a;let r=i.get();function a(){let e=i.get();if(!e){n.set("");return}let t=o(e);let r=JSON.stringify(t,null,2);n.set(r)}function o(e){const r=e.split("\n");const t=r[0].split(",");const i=[];const n={};function a(e){if(e.length>14){const t=e.indexOf(" ",14);if(t!==-1){return e.slice(0,t)+"\n"+e.slice(t+1)}}return e}function o(e,t){let r=parseInt(e.slice(1),16),i=Math.round(2.55*t),n=(r>>16)+i,a=(r>>8&255)+i,o=(r&255)+i;return`#${(16777216+(n<255?n<1?0:n:255)*65536+(a<255?a<1?0:a:255)*256+(o<255?o<1?0:o:255)).toString(16).slice(1)}`}for(let e=1;e<r.length;e++){const l=r[e].split(",");const u=l[0].trim();const c=a(l[1].trim());const f=a(l[2].trim());const h=l[3].trim();const p=h==="Collaborateur";if(!n[c]){n[c]={name:c,value:0,itemStyle:{color:u},children:[]}}let t=n[c].children.find(e=>e.name===f);if(!t){t={name:f,value:0,itemStyle:{color:o(u,20)},children:[]};n[c].children.push(t)}t.value++;n[c].value++;if(!p){let e=t.children.find(e=>e.name===h);if(!e){e={name:h,value:1,itemStyle:{color:o(t.itemStyle.color,20)}};t.children.push(e)}else{e.value++}}}function s(e){if(e.value>40){e.label={rotate:"tangential"}}if(e.children){e.children.forEach(s)}}for(const c in n){s(n[c]);i.push(n[c])}return i}const s=o(r);console.log(JSON.stringify(s,null,2))};Ops.Patch.PtvDm1H.CSV_to_JsonSunburst.prototype=new CABLES.Op;CABLES.OPS["ac243cf6-ad4e-46d1-8dc0-ff2890872f1a"]={f:Ops.Patch.PtvDm1H.CSV_to_JsonSunburst,objName:"Ops.Patch.PtvDm1H.CSV_to_JsonSunburst"};Ops.Gl.MainLoop_v2=function(){CABLES.Op.apply(this,arguments);const r=this;const e=r.attachments={};const t=r.inFloat("Max Pixel Density (DPR)",2),i=r.inValue("FPS Limit",0),n=r.inValueBool("Reduce FPS unfocussed",false),a=r.inValueBool("Transparent",false),o=r.inValueBool("Active",1),s=r.outTrigger("trigger"),l=r.outNumber("width"),u=r.outNumber("height"),c=r.outNumber("Pixel Density");r.onAnimFrame=M;t.onChange=b;const f=r.patch.cgl;let h=0;let p=0;let v=null;let d=false;if(!r.patch.cgl)r.uiAttr({error:"No webgl cgl context"});const g=vec3.create();vec3.set(g,0,0,0);const y=vec3.create();vec3.set(y,0,0,-2);let m=null;let x=true;let _=true;window.addEventListener("blur",()=>{x=false});window.addEventListener("focus",()=>{x=true});document.addEventListener("visibilitychange",()=>{_=!document.hidden});I();r.patch.tempData.mainloopOp=this;function b(){S();if(CABLES.UI){if(t.get()<1)r.patch.cgl.canvas.style.imageRendering="pixelated"}r.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()}o.onChange=function(){r.patch.removeOnAnimFrame(r);if(o.get()){r.setUiAttrib({extendTitle:""});r.onAnimFrame=M;r.patch.addOnAnimFrame(r);r.log("adding again!")}else{r.setUiAttrib({extendTitle:"Inactive"})}};function w(){if(n.get()){if(!_)return 10;if(!x)return 30}return i.get()}r.onDelete=function(){f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT)};function S(){if(t.get()!=0)r.patch.cgl.pixelDensity=Math.min(t.get(),window.devicePixelRatio);else r.patch.cgl.pixelDensity=window.devicePixelRatio}function M(e){if(!o.get())return;if(f.aborted||f.canvas.clientWidth===0||f.canvas.clientHeight===0)return;r.patch.cg=f;S();const t=performance.now();r.patch.config.fpsLimit=w();if(f.canvasWidth==-1){f.setCanvas(r.patch.config.glCanvasId);return}if(f.canvasWidth!=l.get()||f.canvasHeight!=u.get()){l.set(f.canvasWidth/1);u.set(f.canvasHeight/1)}if(CABLES.now()-p>1e3){CGL.fpsReport=CGL.fpsReport||[];if(r.patch.loading.getProgress()>=1&&p!==0)CGL.fpsReport.push(h);h=0;p=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;f.renderStart(f,g,y);if(!a.get())f.gl.clearColor(0,0,0,1);else f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT);s.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(f);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}f.renderEnd(f);r.patch.cg=null;if(!a.get()){f.gl.clearColor(1,1,1,1);f.gl.colorMask(false,false,false,true);f.gl.clear(f.gl.COLOR_BUFFER_BIT);f.gl.colorMask(true,true,true,true)}if(!f.tempData.phong)f.tempData.phong={};h++;c.set(r.patch.cgl.pixelDensity);r.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function I(){clearTimeout(v);v=setTimeout(()=>{if(r.patch.getOpsByObjName(r.name).length>1){r.setUiError("multimainloop","there should only be one mainloop op!");if(!d)d=r.patch.addEventListener("onOpDelete",I)}else r.setUiError("multimainloop",null,1)},500)}};Ops.Gl.MainLoop_v2.prototype=new CABLES.Op;CABLES.OPS["f1029550-d877-42da-9b1e-63a5163a0350"]={f:Ops.Gl.MainLoop_v2,objName:"Ops.Gl.MainLoop_v2"};Ops.Patch.PtvDm1H.ObjectSetAnyByPath_Kirell_Benzi=function(){CABLES.Op.apply(this,arguments);const e=this;const t=e.attachments={};const i=e.inObject("Base object");const n=e.inString("Path 1");const a=e.addInPort(new CABLES.Port(e,"Any value",CABLES.OP_PORT_TYPE_DYNAMIC));const o=e.inBool("Copy obj",true);const s=e.outObject("Out Object");i.onChange=n.onChange=o.onChange=a.onChange=r;function r(){let e=false;let t=i.get();if(!t){t={};e=true}if(!e&&o.get()){if(t){t=JSON.parse(JSON.stringify(t))}else{t={}}}let r=a.get();s.set(null);if(r){t=L(t,n.get(),r);s.set(t)}}var l=Array.isArray;var u=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/,f=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var h=/^(?:0|[1-9]\d*)$/;const p=9007199254740991;var v=function(e){var n=[];if(e.charCodeAt(0)===46){n.push("")}e.replace(f,function(e,t,r,i){n.push(r?i.replace(reEscapeChar,"$1"):t||e)});return n};function d(e){if(typeof e=="string"){return e}if(l(e)){return arrayMap(e,d)+""}if(b(e)){return symbolToString?symbolToString.call(e):""}var t=e+"";return t=="0"&&1/e==-INFINITY?"-0":t}function g(e){return e==null?"":d(e)}function y(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=undefined;var i=true}catch(e){}var n=nativeObjectToString.call(e);if(i){if(t){e[symToStringTag]=r}else{delete e[symToStringTag]}}return n}function m(e){return nativeObjectToString.call(e)}function x(e){if(e==null){return e===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(e)?y(e):m(e)}function _(e){return e!=null&&typeof e=="object"}function b(e){return typeof e=="symbol"||_(e)&&x(e)==symbolTag}function w(e,t){if(l(e)){return false}var r=typeof e;if(r=="number"||r=="symbol"||r=="boolean"||e==null||b(e)){return true}return c.test(e)||!u.test(e)||t!=null&&e in Object(t)}function S(e,t){if(l(e)){return e}return w(e,t)?[e]:v(g(e))}function M(e){if(typeof e=="string"||b(e)){return e}var t=e+"";return t=="0"&&1/e==-INFINITY?"-0":t}function I(e,t){var r=typeof e;t=t==null?p:t;return!!t&&(r=="number"||r!="symbol"&&h.test(e))&&(e>-1&&e%1==0&&e<t)}function C(e,t,r){if(t=="__proto__"&&defineProperty){defineProperty(e,t,{configurable:true,enumerable:true,value:r,writable:true})}else{e[t]=r}}function T(e,t){return e===t||e!==e&&t!==t}function D(e,t,r){var i=e[t];if(!(hasOwnProperty.call(e,t)&&T(i,r))||r===undefined&&!(t in e)){C(e,t,r)}}function A(e,t,r,i){if(!_(e)){return e}t=S(t,e);var n=-1,a=t.length,o=a-1,s=e;while(s!=null&&++n<a){var l=M(t[n]),u=r;if(n!=o){var c=s[l];u=i?i(c,l,s):undefined;if(u===undefined){u=_(c)?c:I(t[n+1])?[]:{}}}D(s,l,u);s=s[l]}return e}function L(e,t,r){return e==null?e:A(e,t,r)}};Ops.Patch.PtvDm1H.ObjectSetAnyByPath_Kirell_Benzi.prototype=new CABLES.Op;CABLES.OPS["8fb38f31-bbe9-4993-9e8f-3b14fec959f2"]={f:Ops.Patch.PtvDm1H.ObjectSetAnyByPath_Kirell_Benzi,objName:"Ops.Patch.PtvDm1H.ObjectSetAnyByPath_Kirell_Benzi"};Ops.String.StringEditor=function(){CABLES.Op.apply(this,arguments);const e=this;const t=e.attachments={};const r=e.inStringEditor("value",""),i=e.inValueSelect("Syntax",["text","glsl","css","html","xml","json","javascript","inline-css","sql"],"text"),n=e.outString("Result");i.onChange=a;function a(){let e=i.get();if(e=="javascript")e="js";r.setUiAttribs({editorSyntax:e})}r.onChange=function(){n.set(r.get())}};Ops.String.StringEditor.prototype=new CABLES.Op;CABLES.OPS["6468b7c1-f63e-4db4-b809-4b203d27ead3"]={f:Ops.String.StringEditor,objName:"Ops.String.StringEditor"};Ops.String.StringReplace=function(){CABLES.Op.apply(this,arguments);const t=this;const e=t.attachments={};const r=t.inString("String"),i=t.inString("Search For","foo"),n=t.inString("Replace","bar"),a=t.inSwitch("Replace What",["All","First"],"All"),o=t.outString("Result");n.onChange=r.onChange=a.onChange=i.onChange=s;function s(){t.setUiError("exception",null);let e="";try{if(a.get()=="All")e=String(r.get()).replace(new RegExp(i.get(),"g"),n.get());else e=String(r.get()).replace(i.get(),n.get())}catch(e){t.setUiError("exception","exception "+e.message)}o.set(e)}};Ops.String.StringReplace.prototype=new CABLES.Op;CABLES.OPS["4a053e7a-6b00-4e71-bd51-90cdb190994c"]={f:Ops.String.StringReplace,objName:"Ops.String.StringReplace"};Ops.Sidebar.Sidebar=function(){CABLES.Op.apply(this,arguments);const o=this;const r=o.attachments={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables *\n{\n    color: #BBBBBB !important;\n    font-family: Arial;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    width: var(--sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    /*outline-style: solid;*/\n    /*outline-color:red;*/\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n    background-position: -4px -9px;\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input:active\n{\n    background-color: #555 !important;\n}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n    display:block;\n    width:100%;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    /*outline: 0;*/\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n.sidebar__slider input[type=text],\n.sidebar__slider input[type=paddword]\n{\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover\n.sidebar__slider input[type=password]:active,\n.sidebar__slider input[type=password]:focus,\n.sidebar__slider input[type=password]:hover\n{\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=date],\n.sidebar__text-input input[type=datetime-local],\n.sidebar__text-input input[type=text],\n.sidebar__text-input input[type=password] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n\n\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    color-scheme: dark;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n\n\n\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover,\n.sidebar__text-input input[type=password]:active,\n.sidebar__text-input input[type=password]:focus,\n.sidebar__text-input input[type=password]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    /*outline: none;*/\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:inactive {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*.sidebar__select-select option*/\n/*{*/\n/*    background-color: #444444;*/\n/*    color: #bbb;*/\n/*}*/\n\n.sidebar__select-select option:checked\n{\n    background-color: #000;\n    color: #FFF;\n}\n\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n\n.sidebar__text-input-input::focus-visible,\n/*.sidebar__text-input-input:active,*/\n.sidebar__button-input:focus-visible,\n.sidebar__text-input:focus-visible\n/*.sidebar__text-input:active*/\n{\n    outline-style: solid;\n    outline-color:white;\n    outline-width: 1px;\n\n}\n\n"};const i="cables-sidebar-style";const n="cables-sidebar-dynamic-style";const s="sidebar-cables";const l="sidebar"+CABLES.uuid();const u="sidebar__items";const c="sidebar__close-button";const a="";const f="";let h=null;let E=null;let p=null;const e=o.inValueBool("Visible",true);const t=o.inValueSlider("Opacity",1);const v=o.inValueBool("Default Minimized");const d=o.inValueSlider("Minimized Opacity",.5);const g=o.inValueBool("Show undo button",false);const y=o.inValueBool("Show Minimize",false);const m=o.inString("Title","");const x=o.inValueBool("Side");const _=o.inValueBool("Default CSS",true);let b=o.patch.cgl.canvas.ownerDocument;const w=o.outObject("childs");w.setUiAttribs({title:"Children"});const S=o.outBool("Opfened");S.setUiAttribs({title:"Opened"});let M=b.querySelector("."+l);if(!M)M=z();const I=M.querySelector("."+u);w.set({parentElement:I,parentOp:o});L();N();P();_.onChange=()=>{N();P()};e.onChange=R;t.onChange=k;v.onChange=L;d.onChange=C;g.onChange=D;o.onDelete=V;function C(){P()}y.onChange=T;function T(e){if(!e||e.uiAttribs)e=b.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=b.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(y.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}x.onChange=function(){if(!M)return;if(x.get())M.classList.add("sidebar-cables-right");else M.classList.remove("sidebar-cables-right")};function D(){const e=b.querySelector(".sidebar-cables .sidebar__group-header");if(e){A(e)}}function A(e){if(e){const t=b.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!g.get()){t.remove()}}else{if(g.get()){const r=b.createElement("span");r.classList.add("sidebar__group-header-undo");r.classList.add("sidebar-icon-undo");r.addEventListener("click",function(e){e.stopPropagation();const t=b.querySelectorAll(".sidebar-cables .sidebar__reloadable");const r=b.createEvent("MouseEvents");r.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(r)})});e.appendChild(r)}}}T(e)}function L(){if(!h){return}if(v.get()){M.classList.add("sidebar--closed");if(e.get())S.set(false)}else{M.classList.remove("sidebar--closed");if(e.get())S.set(true)}}function k(){const e=t.get();M.style.opacity=e}function R(){if(!M)return;if(e.get()){M.style.display="block";if(!M.classList.contains("sidebar--closed"))S.set(true)}else{M.style.display="none";S.set(false)}}x.onChanged=function(){};function P(){const e=b.querySelectorAll("."+n);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}if(!_.get())return;const t=b.createElement("style");t.classList.add("cablesEle");t.classList.add(n);let r=".sidebar--closed .sidebar__close-button { ";r+="opacity: "+d.get();r+="}";const i=b.createTextNode(r);t.appendChild(i);b.body.appendChild(t)}function z(){const e=b.createElement("div");e.classList.add(s);e.classList.add(l);const t=o.patch.cgl.canvas.parentElement;const r=b.createElement("div");r.classList.add("sidebar__group");e.appendChild(r);const i=b.createElement("div");i.classList.add("sidebar__group-header");e.appendChild(i);const n=b.createElement("span");n.classList.add("sidebar__group-header-title");p=b.createElement("span");p.classList.add("sidebar__group-header-title-text");p.innerHTML=m.get();n.appendChild(p);i.appendChild(n);A(i);T(i);r.appendChild(i);e.appendChild(r);r.addEventListener("click",O);if(!t){o.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const a=b.createElement("div");a.classList.add(u);e.appendChild(a);h=b.createElement("div");h.classList.add(c);h.addEventListener("click",O);e.appendChild(h);return e}m.onChange=function(){if(p)p.innerHTML=m.get()};function B(e){}function O(e){e.stopPropagation();if(!M){o.logError("Sidebar could not be closed...");return}M.classList.toggle("sidebar--closed");const t=e.target;let r=a;if(M.classList.contains("sidebar--closed")){r=f;S.set(false)}else{S.set(true)}}function N(){const e=b.querySelectorAll("."+i);if(e){e.forEach(e=>{e.parentNode.removeChild(e)})}if(!_.get())return;const t=b.createElement("style");t.innerHTML=r.style_css;t.classList.add(i);t.classList.add("cablesEle");b.body.appendChild(t)}function V(){G(M)}function G(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Sidebar.prototype=new CABLES.Op;CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Json.SequenceObjects=function(){CABLES.Op.apply(this,arguments);const t=this;const e=t.attachments={};const r=[];const i=[];for(let e=0;e<16;e++){const n=t.inObject("Number "+e,0);const a=t.outObject("Output "+e);n.changeAlways=true;r.push(a);i.push(n)}for(let e=0;e<i.length;e++){const n=i[e];n.onChange=function(){for(let e=0;e<r.length;e++)r[e].set(n.get())}}};Ops.Json.SequenceObjects.prototype=new CABLES.Op;CABLES.OPS["2ce0a537-cd45-4199-93f7-02a9379e00f2"]={f:Ops.Json.SequenceObjects,objName:"Ops.Json.SequenceObjects"};Ops.Sidebar.NumberInput_v2=function(){CABLES.Op.apply(this,arguments);const r=this;const e=r.attachments={};const t=r.inObject("Link");const i=r.inString("Text","Number");const n=r.inValue("Input",0);const a=r.inTriggerButton("Set Default");const o=r.inValue("Default",0);o.setUiAttribs({hidePort:true,greyout:true});const s=r.outObject("Children");const l=r.outNumber("Result",o.get());const u=document.createElement("div");u.addEventListener("dblclick",function(){l.set(parseFloat(o.get()));n.set(parseFloat(o.get()))});u.dataset.op=r.id;u.classList.add("cablesEle");u.classList.add("sidebar__item");u.classList.add("sidebar__text-input");u.classList.add("sidebar__reloadable");const c=document.createElement("div");c.classList.add("sidebar__item-label");const f=document.createTextNode(i.get());c.appendChild(f);u.appendChild(c);const h=document.createElement("input");h.classList.add("sidebar__text-input-input");h.setAttribute("type","text");h.setAttribute("value",o.get());u.appendChild(h);h.addEventListener("input",d);t.onChange=m;i.onChange=y;o.onChange=g;r.onDelete=b;n.onChange=v;a.onTriggered=p;function p(){o.set(parseFloat(n.get()));r.refreshParams()}function v(){let e=parseFloat(n.get());if(isNaN(e)){e=0}h.value=e;l.set(e)}function d(e){let t=parseFloat(e.target.value);if(isNaN(t)){t=0}l.set(t);n.set(t);r.refreshParams()}function g(){}function y(){const e=i.get();c.textContent=e;if(CABLES.UI)r.setUiAttrib({extendTitle:e})}function m(){s.set(null);const e=t.get();if(e&&e.parentElement){e.parentElement.appendChild(u);s.set(e)}else{if(u.parentElement){u.parentElement.removeChild(u)}}}function x(e){if(e){e.style.display="block"}}function _(e){if(e){e.style.display="none"}}function b(){w(u)}function w(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.NumberInput_v2.prototype=new CABLES.Op;CABLES.OPS["c4f3f1d7-de07-4c06-921e-32baeef4fc68"]={f:Ops.Sidebar.NumberInput_v2,objName:"Ops.Sidebar.NumberInput_v2"};Ops.String.NumberToString_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t=e.attachments={};const r=e.inValue("Number"),i=e.inInt("Decimal Places",4),n=e.outString("Result");let a=false;let o=1;i.onChange=s;r.onChange=l;s();l();function s(){a=i.get()<100;o=Math.pow(10,i.get());l()}function l(){if(a)n.set(String(Math.round(r.get()*o)/o));else n.set(String(r.get()||0))}};Ops.String.NumberToString_v2.prototype=new CABLES.Op;CABLES.OPS["5c6d375a-82db-4366-8013-93f56b4061a9"]={f:Ops.String.NumberToString_v2,objName:"Ops.String.NumberToString_v2"};Ops.Sidebar.Slider_v3=function(){CABLES.Op.apply(this,arguments);const n=this;const E=n.attachments={};const e=1e-5;const t=n.inObject("link");const r=n.inString("Text","Slider");const a=n.inValue("Min",0);const o=n.inValue("Max",1);const i=n.inValue("Step",e);const s=n.inString("Suffix","");const l=n.inBool("Grey Out",false);const u=n.inBool("Visible",true);const c=n.inValue("Input",.5);const f=n.inTriggerButton("Set Default");const h=n.inTriggerButton("Reset");let p=null;const v=n.inValue("Default",.5);v.setUiAttribs({hidePort:true,greyout:true});const d=n.outObject("childs");const g=n.outNumber("Result",v.get());n.toWorkNeedsParent("Ops.Sidebar.Sidebar");n.setPortGroup("Range",[a,o,i]);n.setPortGroup("Display",[l,u]);const y=document.createElement("div");y.addEventListener("dblclick",function(){g.set(parseFloat(v.get()));c.set(parseFloat(v.get()));O(v.get())});y.dataset.op=n.id;y.classList.add("cablesEle");y.classList.add("sidebar__item");y.classList.add("sidebar__slider");y.classList.add("sidebar__reloadable");n.patch.on("sidebarStylesChanged",()=>{L()});const m=document.createElement("div");m.classList.add("sidebar__item-label");const x=document.createElement("div");x.classList.add("sidebar__greyout");y.appendChild(x);x.style.display="none";const _=document.createTextNode(r.get());m.appendChild(_);y.appendChild(m);const b=document.createElement("input");b.value=v.get();b.classList.add("sidebar__text-input-input");b.setAttribute("type","text");b.oninput=C;y.appendChild(b);const w=document.createElement("span");y.appendChild(w);s.onChange=()=>{w.innerHTML=s.get()};const S=document.createElement("div");S.classList.add("sidebar__slider-input-wrapper");y.appendChild(S);const M=document.createElement("div");M.classList.add("sidebar__slider-input-active-track");S.appendChild(M);const I=document.createElement("input");I.classList.add("sidebar__slider-input");I.setAttribute("min",a.get());I.setAttribute("max",o.get());I.setAttribute("type","range");I.setAttribute("step",i.get());I.setAttribute("value",v.get());I.style.display="block";S.appendChild(I);L();I.addEventListener("input",A);t.onChange=V;r.onChange=B;c.onChange=T;v.onChange=z;f.onTriggered=D;a.onChange=k;o.onChange=P;i.onChange=R;n.onDelete=H;n.onLoaded=n.onInit=function(){if(n.patch.config.sidebar){n.patch.config.sidebar[r.get()];g.set(n.patch.config.sidebar[r.get()])}else{g.set(parseFloat(v.get()));c.set(parseFloat(v.get()))}};h.onTriggered=function(){const e=parseFloat(v.get());g.set(e);O(e);N(e);c.set(e);L()};l.onChange=function(){x.style.display=l.get()?"block":"none"};u.onChange=function(){y.style.display=u.get()?"block":"none"};function C(e){let t=parseFloat(e.target.value);if(isNaN(t))t=0;const r=a.get();const i=o.get();if(t<r){t=r}else if(t>i){t=i}g.set(t);L();c.set(t);n.refreshParams()}function T(){let e=parseFloat(c.get());const t=a.get();const r=o.get();if(e>r){e=r}else if(e<t){e=t}N(e);g.set(e);L()}function D(){let e=parseFloat(c.get());const t=a.get();const r=o.get();if(e>r){e=r}else if(e<t){e=t}O(e);N(e);g.set(e);v.set(e);n.refreshParams();L()}function A(e){e.preventDefault();e.stopPropagation();O(e.target.value);const t=parseFloat(e.target.value);g.set(t);c.set(t);n.refreshParams();L();return false}function R(){const e=i.get();I.setAttribute("step",e);L()}function L(e){let t=parseFloat(I.value);if(typeof e!=="undefined")t=e;let r=M.parentElement.getBoundingClientRect().width||220;if(p)r=parseInt(getComputedStyle(p.parentElement).getPropertyValue("--sidebar-width"))-20;const i=CABLES.map(t,parseFloat(I.min),parseFloat(I.max),0,r-16);M.style.width=i+"px"}function k(){const e=a.get();I.setAttribute("min",e);L()}function P(){const e=o.get();I.setAttribute("max",e);L()}function z(){const e=v.get();g.set(parseFloat(e));k();P();N(e);O(e);L(e)}function B(){const e=r.get();m.textContent=e;if(CABLES.UI)n.setUiAttrib({extendTitle:e});b.setAttribute("aria-label","slider "+r.get());I.setAttribute("aria-label","slider "+r.get())}function V(){d.set(null);p=t.get();if(p&&p.parentElement){p.parentElement.appendChild(y);d.set(p)}else if(y.parentElement)y.parentElement.removeChild(y);L()}function O(e){b.value=e}function N(e){I.value=e}function G(e){if(e)e.style.display="block"}function F(e){if(e)e.style.display="none"}function H(){W(y)}function W(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Slider_v3.prototype=new CABLES.Op;CABLES.OPS["74730122-5cba-4d0d-b610-df334ec6220a"]={f:Ops.Sidebar.Slider_v3,objName:"Ops.Sidebar.Slider_v3"};Ops.Gl.Matrix.Transform=function(){CABLES.Op.apply(this,arguments);const r=this;const e=r.attachments={};const t=r.inTrigger("render"),i=r.inValue("posX",0),n=r.inValue("posY",0),a=r.inValue("posZ",0),o=r.inValue("scale",1),s=r.inValue("rotX",0),l=r.inValue("rotY",0),u=r.inValue("rotZ",0),c=r.outTrigger("trigger");r.setPortGroup("Rotation",[s,l,u]);r.setPortGroup("Position",[i,n,a]);r.setPortGroup("Scale",[o]);r.setUiAxisPorts(i,n,a);r.toWorkPortsNeedToBeLinked(t,c);const f=vec3.create();const h=vec3.create();const p=mat4.create();mat4.identity(p);let v=false,d=false,g=true,y=true,m=true;s.onChange=l.onChange=u.onChange=M;i.onChange=n.onChange=a.onChange=w;o.onChange=S;t.onTriggered=function(){let e=false;if(g){_();e=true}if(y){b();e=true}if(m)e=true;if(e)x();const t=r.patch.cg||r.patch.cgl;t.pushModelMatrix();mat4.multiply(t.mMatrix,t.mMatrix,p);c.trigger();t.popModelMatrix();if(CABLES.UI){if(!i.isLinked()&&!n.isLinked()&&!a.isLinked()){gui.setTransform(r.id,i.get(),n.get(),a.get());if(r.isCurrentUiOp())gui.setTransformGizmo({posX:i,posY:n,posZ:a})}}};function x(){mat4.identity(p);if(d)mat4.translate(p,p,f);if(s.get()!==0)mat4.rotateX(p,p,s.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(p,p,l.get()*CGL.DEG2RAD);if(u.get()!==0)mat4.rotateZ(p,p,u.get()*CGL.DEG2RAD);if(v)mat4.scale(p,p,h);m=false}function _(){d=false;if(i.get()!==0||n.get()!==0||a.get()!==0)d=true;vec3.set(f,i.get(),n.get(),a.get());g=false}function b(){v=true;vec3.set(h,o.get(),o.get(),o.get());y=false}function w(){g=true}function S(){y=true}function M(){m=true}x()};Ops.Gl.Matrix.Transform.prototype=new CABLES.Op;CABLES.OPS["650baeb1-db2d-4781-9af6-ab4e9d4277be"]={f:Ops.Gl.Matrix.Transform,objName:"Ops.Gl.Matrix.Transform"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):(e=typeof globalThis!=="undefined"?globalThis:e||self,t(e.echarts={}))})(this,function(e){"use strict";var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return i(e,t)};function d(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var w=function(){w=Object.assign||function e(t){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))t[a]=r[a]}return t};return w.apply(this,arguments)};function o(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),n=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i}var r=function(){function e(){this.firefox=false;this.ie=false;this.edge=false;this.newEdge=false;this.weChat=false}return e}();var n=function(){function e(){this.browser=new r;this.node=false;this.wxa=false;this.worker=false;this.canvasSupported=false;this.svgSupported=false;this.touchEventsSupported=false;this.pointerEventsSupported=false;this.domSupported=false;this.transformSupported=false;this.transform3dSupported=false}return e}();var S=new n;if(typeof wx==="object"&&typeof wx.getSystemInfoSync==="function"){S.wxa=true;S.canvasSupported=true;S.touchEventsSupported=true}else if(typeof document==="undefined"&&typeof self!=="undefined"){S.worker=true;S.canvasSupported=true}else if(typeof navigator==="undefined"){S.node=true;S.canvasSupported=true;S.svgSupported=true}else{a(navigator.userAgent,S)}function a(e,t){var r=t.browser;var i=e.match(/Firefox\/([\d.]+)/);var n=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/);var a=e.match(/Edge?\/([\d.]+)/);var o=/micromessenger/i.test(e);if(i){r.firefox=true;r.version=i[1]}if(n){r.ie=true;r.version=n[1]}if(a){r.edge=true;r.version=a[1];r.newEdge=+a[1].split(".")[0]>18}if(o){r.weChat=true}t.canvasSupported=!!document.createElement("canvas").getContext;t.svgSupported=typeof SVGRect!=="undefined";t.touchEventsSupported="ontouchstart"in window&&!r.ie&&!r.edge;t.pointerEventsSupported="onpointerdown"in window&&(r.edge||r.ie&&+r.version>=11);t.domSupported=typeof document!=="undefined";var s=document.documentElement.style;t.transform3dSupported=(r.ie&&"transition"in s||r.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in s)&&!("OTransition"in s);t.transformSupported=t.transform3dSupported||r.ie&&+r.version>=9}var s={"[object Function]":true,"[object RegExp]":true,"[object Date]":true,"[object Error]":true,"[object CanvasGradient]":true,"[object CanvasPattern]":true,"[object Image]":true,"[object Canvas]":true};var l={"[object Int8Array]":true,"[object Uint8Array]":true,"[object Uint8ClampedArray]":true,"[object Int16Array]":true,"[object Uint16Array]":true,"[object Int32Array]":true,"[object Uint32Array]":true,"[object Float32Array]":true,"[object Float64Array]":true};var u=Object.prototype.toString;var c=Array.prototype;var f=c.forEach;var h=c.filter;var T=c.slice;var q=c.map;var J=function(){}.constructor;var K=J?J.prototype:null;var Q={};function $(e,t){Q[e]=t}var ee=2311;function te(){return ee++}function re(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(typeof console!=="undefined"){console.error.apply(console,e)}}function M(e){if(e==null||typeof e!=="object"){return e}var t=e;var r=u.call(e);if(r==="[object Array]"){if(!De(e)){t=[];for(var i=0,n=e.length;i<n;i++){t[i]=M(e[i])}}}else if(l[r]){if(!De(e)){var a=e.constructor;if(a.from){t=a.from(e)}else{t=new a(e.length);for(var i=0,n=e.length;i<n;i++){t[i]=M(e[i])}}}}else if(!s[r]&&!De(e)&&!ge(e)){t={};for(var o in e){if(e.hasOwnProperty(o)){t[o]=M(e[o])}}}return t}function y(e,t,r){if(!O(t)||!O(e)){return r?M(t):e}for(var i in t){if(t.hasOwnProperty(i)){var n=e[i];var a=t[i];if(O(a)&&O(n)&&!k(a)&&!k(n)&&!ge(a)&&!ge(n)&&!ve(a)&&!ve(n)&&!De(a)&&!De(n)){y(n,a,r)}else if(r||!(i in e)){e[i]=M(t[i])}}}return e}function ie(e,t){var r=e[0];for(var i=1,n=e.length;i<n;i++){r=y(r,e[i],t)}return r}function F(e,t){if(Object.assign){Object.assign(e,t)}else{for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}}return e}function R(e,t,r){var i=L(t);for(var n=0;n<i.length;n++){var a=i[n];if(r?t[a]!=null:e[a]==null){e[a]=t[a]}}return e}var ne=function(){return Q.createCanvas()};Q.createCanvas=function(){return document.createElement("canvas")};function D(e,t){if(e){if(e.indexOf){return e.indexOf(t)}for(var r=0,i=e.length;r<i;r++){if(e[r]===t){return r}}}return-1}function ae(e,t){var r=e.prototype;function i(){}i.prototype=t.prototype;e.prototype=new i;for(var n in r){if(r.hasOwnProperty(n)){e.prototype[n]=r[n]}}e.prototype.constructor=e;e.superClass=t}function oe(e,t,r){e="prototype"in e?e.prototype:e;t="prototype"in t?t.prototype:t;if(Object.getOwnPropertyNames){var i=Object.getOwnPropertyNames(t);for(var n=0;n<i.length;n++){var a=i[n];if(a!=="constructor"){if(r?t[a]!=null:e[a]==null){e[a]=t[a]}}}}else{R(e,t,r)}}function se(e){if(!e){return false}if(typeof e==="string"){return false}return typeof e.length==="number"}function U(e,t,r){if(!(e&&t)){return}if(e.forEach&&e.forEach===f){e.forEach(t,r)}else if(e.length===+e.length){for(var i=0,n=e.length;i<n;i++){t.call(r,e[i],i,e)}}else{for(var a in e){if(e.hasOwnProperty(a)){t.call(r,e[a],a,e)}}}}function A(e,t,r){if(!e){return[]}if(!t){return Se(e)}if(e.map&&e.map===q){return e.map(t,r)}else{var i=[];for(var n=0,a=e.length;n<a;n++){i.push(t.call(r,e[n],n,e))}return i}}function le(e,t,r,i){if(!(e&&t)){return}for(var n=0,a=e.length;n<a;n++){r=t.call(i,r,e[n],n,e)}return r}function ue(e,t,r){if(!e){return[]}if(!t){return Se(e)}if(e.filter&&e.filter===h){return e.filter(t,r)}else{var i=[];for(var n=0,a=e.length;n<a;n++){if(t.call(r,e[n],n,e)){i.push(e[n])}}return i}}function ce(e,t,r){if(!(e&&t)){return}for(var i=0,n=e.length;i<n;i++){if(t.call(r,e[i],i,e)){return e[i]}}}function L(e){if(!e){return[]}if(Object.keys){return Object.keys(e)}var t=[];for(var r in e){if(e.hasOwnProperty(r)){t.push(r)}}return t}function fe(e,t){var r=[];for(var i=2;i<arguments.length;i++){r[i-2]=arguments[i]}return function(){return e.apply(t,r.concat(T.call(arguments)))}}var x=K&&b(K.bind)?K.call.bind(K.bind):fe;function _(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return function(){return e.apply(this,t.concat(T.call(arguments)))}}function k(e){if(Array.isArray){return Array.isArray(e)}return u.call(e)==="[object Array]"}function b(e){return typeof e==="function"}function P(e){return typeof e==="string"}function he(e){return u.call(e)==="[object String]"}function pe(e){return typeof e==="number"}function O(e){var t=typeof e;return t==="function"||!!e&&t==="object"}function ve(e){return!!s[u.call(e)]}function de(e){return!!l[u.call(e)]}function ge(e){return typeof e==="object"&&typeof e.nodeType==="number"&&typeof e.ownerDocument==="object"}function ye(e){return e.colorStops!=null}function me(e){return e.image!=null}function xe(e){return u.call(e)==="[object RegExp]"}function _e(e){return e!==e}function be(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}for(var r=0,i=e.length;r<i;r++){if(e[r]!=null){return e[r]}}}function N(e,t){return e!=null?e:t}function we(e,t,r){return e!=null?e:t!=null?t:r}function Se(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return T.apply(e,t)}function Me(e){if(typeof e==="number"){return[e,e,e,e]}var t=e.length;if(t===2){return[e[0],e[1],e[0],e[1]]}else if(t===3){return[e[0],e[1],e[2],e[1]]}return e}function E(e,t){if(!e){throw new Error(t)}}function Ie(e){if(e==null){return null}else if(typeof e.trim==="function"){return e.trim()}else{return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}var Ce="__ec_primitive__";function Te(e){e[Ce]=true}function De(e){return e[Ce]}var Ae=function(){function n(e){this.data={};var r=k(e);this.data={};var i=this;e instanceof n?e.each(t):e&&U(e,t);function t(e,t){r?i.set(e,t):i.set(t,e)}}n.prototype.get=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null};n.prototype.set=function(e,t){return this.data[e]=t};n.prototype.each=function(e,t){for(var r in this.data){if(this.data.hasOwnProperty(r)){e.call(t,this.data[r],r)}}};n.prototype.keys=function(){return L(this.data)};n.prototype.removeKey=function(e){delete this.data[e]};return n}();function I(e){return new Ae(e)}function Le(e,t){var r=new e.constructor(e.length+t.length);for(var i=0;i<e.length;i++){r[i]=e[i]}var n=e.length;for(var i=0;i<t.length;i++){r[i+n]=t[i]}return r}function ke(e,t){var r;if(Object.create){r=Object.create(e)}else{var i=function(){};i.prototype=e;r=new i}if(t){F(r,t)}return r}function z(e,t){return e.hasOwnProperty(t)}function Pe(){}var Oe=Object.freeze({__proto__:null,$override:$,guid:te,logError:re,clone:M,merge:y,mergeAll:ie,extend:F,defaults:R,createCanvas:ne,indexOf:D,inherits:ae,mixin:oe,isArrayLike:se,each:U,map:A,reduce:le,filter:ue,find:ce,keys:L,bind:x,curry:_,isArray:k,isFunction:b,isString:P,isStringSafe:he,isNumber:pe,isObject:O,isBuiltInObject:ve,isTypedArray:de,isDom:ge,isGradientObject:ye,isImagePatternObject:me,isRegExp:xe,eqNaN:_e,retrieve:be,retrieve2:N,retrieve3:we,slice:Se,normalizeCssArray:Me,assert:E,trim:Ie,setAsPrimitive:Te,isPrimitive:De,HashMap:Ae,createHashMap:I,concatArray:Le,createObject:ke,hasOwn:z,noop:Pe});function Ne(e,t){if(e==null){e=0}if(t==null){t=0}return[e,t]}function Ee(e,t){e[0]=t[0];e[1]=t[1];return e}function Re(e){return[e[0],e[1]]}function ze(e,t,r){e[0]=t;e[1]=r;return e}function Be(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];return e}function Ve(e,t,r,i){e[0]=t[0]+r[0]*i;e[1]=t[1]+r[1]*i;return e}function Ge(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];return e}function Fe(e){return Math.sqrt(We(e))}var He=Fe;function We(e){return e[0]*e[0]+e[1]*e[1]}var je=We;function Ue(e,t,r){e[0]=t[0]*r[0];e[1]=t[1]*r[1];return e}function Ze(e,t,r){e[0]=t[0]/r[0];e[1]=t[1]/r[1];return e}function Ye(e,t){return e[0]*t[0]+e[1]*t[1]}function Xe(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;return e}function qe(e,t){var r=Fe(t);if(r===0){e[0]=0;e[1]=0}else{e[0]=t[0]/r;e[1]=t[1]/r}return e}function Je(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var Ke=Je;function Qe(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var $e=Qe;function et(e,t){e[0]=-t[0];e[1]=-t[1];return e}function tt(e,t,r,i){e[0]=t[0]+i*(r[0]-t[0]);e[1]=t[1]+i*(r[1]-t[1]);return e}function rt(e,t,r){var i=t[0];var n=t[1];e[0]=r[0]*i+r[2]*n+r[4];e[1]=r[1]*i+r[3]*n+r[5];return e}function it(e,t,r){e[0]=Math.min(t[0],r[0]);e[1]=Math.min(t[1],r[1]);return e}function nt(e,t,r){e[0]=Math.max(t[0],r[0]);e[1]=Math.max(t[1],r[1]);return e}var at=Object.freeze({__proto__:null,create:Ne,copy:Ee,clone:Re,set:ze,add:Be,scaleAndAdd:Ve,sub:Ge,len:Fe,length:He,lenSquare:We,lengthSquare:je,mul:Ue,div:Ze,dot:Ye,scale:Xe,normalize:qe,distance:Je,dist:Ke,distanceSquare:Qe,distSquare:$e,negate:et,lerp:tt,applyTransform:rt,min:it,max:nt});var ot=function(){function e(e,t){this.target=e;this.topTarget=t&&t.topTarget}return e}();var st=function(){function e(e){this.handler=e;e.on("mousedown",this._dragStart,this);e.on("mousemove",this._drag,this);e.on("mouseup",this._dragEnd,this)}e.prototype._dragStart=function(e){var t=e.target;while(t&&!t.draggable){t=t.parent}if(t){this._draggingTarget=t;t.dragging=true;this._x=e.offsetX;this._y=e.offsetY;this.handler.dispatchToElement(new ot(t,e),"dragstart",e.event)}};e.prototype._drag=function(e){var t=this._draggingTarget;if(t){var r=e.offsetX;var i=e.offsetY;var n=r-this._x;var a=i-this._y;this._x=r;this._y=i;t.drift(n,a,e);this.handler.dispatchToElement(new ot(t,e),"drag",e.event);var o=this.handler.findHover(r,i,t).target;var s=this._dropTarget;this._dropTarget=o;if(t!==o){if(s&&o!==s){this.handler.dispatchToElement(new ot(s,e),"dragleave",e.event)}if(o&&o!==s){this.handler.dispatchToElement(new ot(o,e),"dragenter",e.event)}}}};e.prototype._dragEnd=function(e){var t=this._draggingTarget;if(t){t.dragging=false}this.handler.dispatchToElement(new ot(t,e),"dragend",e.event);if(this._dropTarget){this.handler.dispatchToElement(new ot(this._dropTarget,e),"drop",e.event)}this._draggingTarget=null;this._dropTarget=null};return e}();var lt=function(){function e(e){if(e){this._$eventProcessor=e}}e.prototype.on=function(e,t,r,i){if(!this._$handlers){this._$handlers={}}var n=this._$handlers;if(typeof t==="function"){i=r;r=t;t=null}if(!r||!e){return this}var a=this._$eventProcessor;if(t!=null&&a&&a.normalizeQuery){t=a.normalizeQuery(t)}if(!n[e]){n[e]=[]}for(var o=0;o<n[e].length;o++){if(n[e][o].h===r){return this}}var s={h:r,query:t,ctx:i||this,callAtLast:r.zrEventfulCallAtLast};var l=n[e].length-1;var u=n[e][l];u&&u.callAtLast?n[e].splice(l,0,s):n[e].push(s);return this};e.prototype.isSilent=function(e){var t=this._$handlers;return!t||!t[e]||!t[e].length};e.prototype.off=function(e,t){var r=this._$handlers;if(!r){return this}if(!e){this._$handlers={};return this}if(t){if(r[e]){var i=[];for(var n=0,a=r[e].length;n<a;n++){if(r[e][n].h!==t){i.push(r[e][n])}}r[e]=i}if(r[e]&&r[e].length===0){delete r[e]}}else{delete r[e]}return this};e.prototype.trigger=function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(!this._$handlers){return this}var i=this._$handlers[e];var n=this._$eventProcessor;if(i){var a=t.length;var o=i.length;for(var s=0;s<o;s++){var l=i[s];if(n&&n.filter&&l.query!=null&&!n.filter(e,l.query)){continue}switch(a){case 0:l.h.call(l.ctx);break;case 1:l.h.call(l.ctx,t[0]);break;case 2:l.h.call(l.ctx,t[0],t[1]);break;default:l.h.apply(l.ctx,t);break}}}n&&n.afterTrigger&&n.afterTrigger(e);return this};e.prototype.triggerWithContext=function(e){if(!this._$handlers){return this}var t=this._$handlers[e];var r=this._$eventProcessor;if(t){var i=arguments;var n=i.length;var a=i[n-1];var o=t.length;for(var s=0;s<o;s++){var l=t[s];if(r&&r.filter&&l.query!=null&&!r.filter(e,l.query)){continue}switch(n){case 0:l.h.call(a);break;case 1:l.h.call(a,i[0]);break;case 2:l.h.call(a,i[0],i[1]);break;default:l.h.apply(a,i.slice(1,n-1));break}}}r&&r.afterTrigger&&r.afterTrigger(e);return this};return e}();var ut=Math.log(2);function ct(e,t,r,i,n,a){var o=i+"-"+n;var s=e.length;if(a.hasOwnProperty(o)){return a[o]}if(t===1){var l=Math.round(Math.log((1<<s)-1&~n)/ut);return e[r][l]}var u=i|1<<r;var c=r+1;while(i&1<<c){c++}var f=0;for(var h=0,p=0;h<s;h++){var v=1<<h;if(!(v&n)){f+=(p%2?-1:1)*e[r][h]*ct(e,t-1,c,u,n|v,a);p++}}a[o]=f;return f}function ft(e,t){var r=[[e[0],e[1],1,0,0,0,-t[0]*e[0],-t[0]*e[1]],[0,0,0,e[0],e[1],1,-t[1]*e[0],-t[1]*e[1]],[e[2],e[3],1,0,0,0,-t[2]*e[2],-t[2]*e[3]],[0,0,0,e[2],e[3],1,-t[3]*e[2],-t[3]*e[3]],[e[4],e[5],1,0,0,0,-t[4]*e[4],-t[4]*e[5]],[0,0,0,e[4],e[5],1,-t[5]*e[4],-t[5]*e[5]],[e[6],e[7],1,0,0,0,-t[6]*e[6],-t[6]*e[7]],[0,0,0,e[6],e[7],1,-t[7]*e[6],-t[7]*e[7]]];var i={};var n=ct(r,8,0,0,0,i);if(n===0){return}var a=[];for(var o=0;o<8;o++){for(var s=0;s<8;s++){a[s]==null&&(a[s]=0);a[s]+=((o+s)%2?-1:1)*ct(r,7,o===0?1:0,1<<o,1<<s,i)/n*t[o]}}return function(e,t,r){var i=t*a[6]+r*a[7]+1;e[0]=(t*a[0]+r*a[1]+a[2])/i;e[1]=(t*a[3]+r*a[4]+a[5])/i}}var ht="___zrEVENTSAVED";var pt=[];function vt(e,t,r,i,n){return dt(pt,t,i,n,true)&&dt(e,r,pt[0],pt[1])}function dt(e,t,r,i,n){if(t.getBoundingClientRect&&S.domSupported&&!mt(t)){var a=t[ht]||(t[ht]={});var o=gt(t,a);var s=yt(o,a,n);if(s){s(e,r,i);return true}}return false}function gt(e,t){var r=t.markers;if(r){return r}r=t.markers=[];var i=["left","right"];var n=["top","bottom"];for(var a=0;a<4;a++){var o=document.createElement("div");var s=o.style;var l=a%2;var u=(a>>1)%2;s.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",i[l]+":0",n[u]+":0",i[1-l]+":auto",n[1-u]+":auto",""].join("!important;");e.appendChild(o);r.push(o)}return r}function yt(e,t,r){var i=r?"invTrans":"trans";var n=t[i];var a=t.srcCoords;var o=[];var s=[];var l=true;for(var u=0;u<4;u++){var c=e[u].getBoundingClientRect();var f=2*u;var h=c.left;var p=c.top;o.push(h,p);l=l&&a&&h===a[f]&&p===a[f+1];s.push(e[u].offsetLeft,e[u].offsetTop)}return l&&n?n:(t.srcCoords=o,t[i]=r?ft(s,o):ft(o,s))}function mt(e){return e.nodeName.toUpperCase()==="CANVAS"}var xt=typeof window!=="undefined"&&!!window.addEventListener;var _t=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;var bt=[];function wt(e,t,r,i){r=r||{};if(i||!S.canvasSupported){St(e,t,r)}else if(S.browser.firefox&&t.layerX!=null&&t.layerX!==t.offsetX){r.zrX=t.layerX;r.zrY=t.layerY}else if(t.offsetX!=null){r.zrX=t.offsetX;r.zrY=t.offsetY}else{St(e,t,r)}return r}function St(e,t,r){if(S.domSupported&&e.getBoundingClientRect){var i=t.clientX;var n=t.clientY;if(mt(e)){var a=e.getBoundingClientRect();r.zrX=i-a.left;r.zrY=n-a.top;return}else{if(dt(bt,e,i,n)){r.zrX=bt[0];r.zrY=bt[1];return}}}r.zrX=r.zrY=0}function Mt(e){return e||window.event}function It(e,t,r){t=Mt(t);if(t.zrX!=null){return t}var i=t.type;var n=i&&i.indexOf("touch")>=0;if(!n){wt(e,t,t,r);var a=Ct(t);t.zrDelta=a?a/120:-(t.detail||0)/3}else{var o=i!=="touchend"?t.targetTouches[0]:t.changedTouches[0];o&&wt(e,o,t,r)}var s=t.button;if(t.which==null&&s!==undefined&&_t.test(t.type)){t.which=s&1?1:s&2?3:s&4?2:0}return t}function Ct(e){var t=e.wheelDelta;if(t){return t}var r=e.deltaX;var i=e.deltaY;if(r==null||i==null){return t}var n=i!==0?Math.abs(i):Math.abs(r);var a=i>0?-1:i<0?1:r>0?-1:1;return 3*n*a}function Tt(e,t,r,i){if(xt){e.addEventListener(t,r,i)}else{e.attachEvent("on"+t,r)}}function Dt(e,t,r,i){if(xt){e.removeEventListener(t,r,i)}else{e.detachEvent("on"+t,r)}}var At=xt?function(e){e.preventDefault();e.stopPropagation();e.cancelBubble=true}:function(e){e.returnValue=false;e.cancelBubble=true};function Lt(e){return e.which===2||e.which===3}var kt=function(){function e(){this._track=[]}e.prototype.recognize=function(e,t,r){this._doTrack(e,t,r);return this._recognize(e)};e.prototype.clear=function(){this._track.length=0;return this};e.prototype._doTrack=function(e,t,r){var i=e.touches;if(!i){return}var n={points:[],touches:[],target:t,event:e};for(var a=0,o=i.length;a<o;a++){var s=i[a];var l=wt(r,s,{});n.points.push([l.zrX,l.zrY]);n.touches.push(s)}this._track.push(n)};e.prototype._recognize=function(e){for(var t in Nt){if(Nt.hasOwnProperty(t)){var r=Nt[t](this._track,e);if(r){return r}}}};return e}();function Pt(e){var t=e[1][0]-e[0][0];var r=e[1][1]-e[0][1];return Math.sqrt(t*t+r*r)}function Ot(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]}var Nt={pinch:function(e,t){var r=e.length;if(!r){return}var i=(e[r-1]||{}).points;var n=(e[r-2]||{}).points||i;if(n&&n.length>1&&i&&i.length>1){var a=Pt(i)/Pt(n);!isFinite(a)&&(a=1);t.pinchScale=a;var o=Ot(i);t.pinchX=o[0];t.pinchY=o[1];return{type:"pinch",target:e[0].target,event:t}}}};var Et="silent";function Rt(e,t,r){return{type:e,event:r,target:t.target,topTarget:t.topTarget,cancelBubble:false,offsetX:r.zrX,offsetY:r.zrY,gestureEvent:r.gestureEvent,pinchX:r.pinchX,pinchY:r.pinchY,pinchScale:r.pinchScale,wheelDelta:r.zrDelta,zrByTouch:r.zrByTouch,which:r.which,stop:zt}}function zt(){At(this.event)}var Bt=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.handler=null;return e}e.prototype.dispose=function(){};e.prototype.setCursor=function(){};return e}(lt);var Vt=function(){function e(e,t){this.x=e;this.y=t}return e}();var Gt=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"];var Ft=function(a){d(e,a);function e(e,t,r,i){var n=a.call(this)||this;n._hovered=new Vt(0,0);n.storage=e;n.painter=t;n.painterRoot=i;r=r||new Bt;n.proxy=null;n.setHandlerProxy(r);n._draggingMgr=new st(n);return n}e.prototype.setHandlerProxy=function(t){if(this.proxy){this.proxy.dispose()}if(t){U(Gt,function(e){t.on&&t.on(e,this[e],this)},this);t.handler=this}this.proxy=t};e.prototype.mousemove=function(e){var t=e.zrX;var r=e.zrY;var i=Wt(this,t,r);var n=this._hovered;var a=n.target;if(a&&!a.__zr){n=this.findHover(n.x,n.y);a=n.target}var o=this._hovered=i?new Vt(t,r):this.findHover(t,r);var s=o.target;var l=this.proxy;l.setCursor&&l.setCursor(s?s.cursor:"default");if(a&&s!==a){this.dispatchToElement(n,"mouseout",e)}this.dispatchToElement(o,"mousemove",e);if(s&&s!==a){this.dispatchToElement(o,"mouseover",e)}};e.prototype.mouseout=function(e){var t=e.zrEventControl;if(t!=="only_globalout"){this.dispatchToElement(this._hovered,"mouseout",e)}if(t!=="no_globalout"){this.trigger("globalout",{type:"globalout",event:e})}};e.prototype.resize=function(){this._hovered=new Vt(0,0)};e.prototype.dispatch=function(e,t){var r=this[e];r&&r.call(this,t)};e.prototype.dispose=function(){this.proxy.dispose();this.storage=null;this.proxy=null;this.painter=null};e.prototype.setCursorStyle=function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)};e.prototype.dispatchToElement=function(e,t,r){e=e||{};var i=e.target;if(i&&i.silent){return}var n="on"+t;var a=Rt(t,e,r);while(i){i[n]&&(a.cancelBubble=!!i[n].call(i,a));i.trigger(t,a);i=i.__hostTarget?i.__hostTarget:i.parent;if(a.cancelBubble){break}}if(!a.cancelBubble){this.trigger(t,a);if(this.painter&&this.painter.eachOtherLayer){this.painter.eachOtherLayer(function(e){if(typeof e[n]==="function"){e[n].call(e,a)}if(e.trigger){e.trigger(t,a)}})}}};e.prototype.findHover=function(e,t,r){var i=this.storage.getDisplayList();var n=new Vt(e,t);for(var a=i.length-1;a>=0;a--){var o=void 0;if(i[a]!==r&&!i[a].ignore&&(o=Ht(i[a],e,t))){!n.topTarget&&(n.topTarget=i[a]);if(o!==Et){n.target=i[a];break}}}return n};e.prototype.processGesture=function(e,t){if(!this._gestureMgr){this._gestureMgr=new kt}var r=this._gestureMgr;t==="start"&&r.clear();var i=r.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);t==="end"&&r.clear();if(i){var n=i.type;e.gestureEvent=n;var a=new Vt;a.target=i.target;this.dispatchToElement(a,n,i.event)}};return e}(lt);U(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(o){Ft.prototype[o]=function(e){var t=e.zrX;var r=e.zrY;var i=Wt(this,t,r);var n;var a;if(o!=="mouseup"||!i){n=this.findHover(t,r);a=n.target}if(o==="mousedown"){this._downEl=a;this._downPoint=[e.zrX,e.zrY];this._upEl=a}else if(o==="mouseup"){this._upEl=a}else if(o==="click"){if(this._downEl!==this._upEl||!this._downPoint||Ke(this._downPoint,[e.zrX,e.zrY])>4){return}this._downPoint=null}this.dispatchToElement(n,o,e)}});function Ht(e,t,r){if(e[e.rectHover?"rectContain":"contain"](t,r)){var i=e;var n=void 0;var a=false;while(i){if(i.ignoreClip){a=true}if(!a){var o=i.getClipPath();if(o&&!o.contain(t,r)){return false}if(i.silent){n=true}}var s=i.__hostTarget;i=s?s:i.parent}return n?Et:true}return false}function Wt(e,t,r){var i=e.painter;return t<0||t>i.getWidth()||r<0||r>i.getHeight()}var jt=32;var Ut=7;function Zt(e){var t=0;while(e>=jt){t|=e&1;e>>=1}return e+t}function Yt(e,t,r,i){var n=t+1;if(n===r){return 1}if(i(e[n++],e[t])<0){while(n<r&&i(e[n],e[n-1])<0){n++}Xt(e,t,n)}else{while(n<r&&i(e[n],e[n-1])>=0){n++}}return n-t}function Xt(e,t,r){r--;while(t<r){var i=e[t];e[t++]=e[r];e[r--]=i}}function qt(e,t,r,i,n){if(i===t){i++}for(;i<r;i++){var a=e[i];var o=t;var s=i;var l;while(o<s){l=o+s>>>1;if(n(a,e[l])<0){s=l}else{o=l+1}}var u=i-o;switch(u){case 3:e[o+3]=e[o+2];case 2:e[o+2]=e[o+1];case 1:e[o+1]=e[o];break;default:while(u>0){e[o+u]=e[o+u-1];u--}}e[o]=a}}function Jt(e,t,r,i,n,a){var o=0;var s=0;var l=1;if(a(e,t[r+n])>0){s=i-n;while(l<s&&a(e,t[r+n+l])>0){o=l;l=(l<<1)+1;if(l<=0){l=s}}if(l>s){l=s}o+=n;l+=n}else{s=n+1;while(l<s&&a(e,t[r+n-l])<=0){o=l;l=(l<<1)+1;if(l<=0){l=s}}if(l>s){l=s}var u=o;o=n-l;l=n-u}o++;while(o<l){var c=o+(l-o>>>1);if(a(e,t[r+c])>0){o=c+1}else{l=c}}return l}function Kt(e,t,r,i,n,a){var o=0;var s=0;var l=1;if(a(e,t[r+n])<0){s=n+1;while(l<s&&a(e,t[r+n-l])<0){o=l;l=(l<<1)+1;if(l<=0){l=s}}if(l>s){l=s}var u=o;o=n-l;l=n-u}else{s=i-n;while(l<s&&a(e,t[r+n+l])>=0){o=l;l=(l<<1)+1;if(l<=0){l=s}}if(l>s){l=s}o+=n;l+=n}o++;while(o<l){var c=o+(l-o>>>1);if(a(e,t[r+c])<0){l=c}else{o=c+1}}return l}function Qt(v,d){var g=Ut;var e=0;var o;var s;var l=0;e=v.length;var y=[];o=[];s=[];function t(e,t){o[l]=e;s[l]=t;l+=1}function r(){while(l>1){var e=l-2;if(e>=1&&s[e-1]<=s[e]+s[e+1]||e>=2&&s[e-2]<=s[e]+s[e-1]){if(s[e-1]<s[e+1]){e--}}else if(s[e]>s[e+1]){break}n(e)}}function i(){while(l>1){var e=l-2;if(e>0&&s[e-1]<s[e+1]){e--}n(e)}}function n(e){var t=o[e];var r=s[e];var i=o[e+1];var n=s[e+1];s[e]=r+n;if(e===l-3){o[e+1]=o[e+2];s[e+1]=s[e+2]}l--;var a=Kt(v[i],v,t,r,0,d);t+=a;r-=a;if(r===0){return}n=Jt(v[t+r-1],v,i,n,n-1,d);if(n===0){return}if(r<=n){u(t,r,i,n)}else{c(t,r,i,n)}}function u(e,t,r,i){var n=0;for(n=0;n<t;n++){y[n]=v[e+n]}var a=0;var o=r;var s=e;v[s++]=v[o++];if(--i===0){for(n=0;n<t;n++){v[s+n]=y[a+n]}return}if(t===1){for(n=0;n<i;n++){v[s+n]=v[o+n]}v[s+i]=y[a];return}var l=g;var u;var c;var f;while(1){u=0;c=0;f=false;do{if(d(v[o],y[a])<0){v[s++]=v[o++];c++;u=0;if(--i===0){f=true;break}}else{v[s++]=y[a++];u++;c=0;if(--t===1){f=true;break}}}while((u|c)<l);if(f){break}do{u=Kt(v[o],y,a,t,0,d);if(u!==0){for(n=0;n<u;n++){v[s+n]=y[a+n]}s+=u;a+=u;t-=u;if(t<=1){f=true;break}}v[s++]=v[o++];if(--i===0){f=true;break}c=Jt(y[a],v,o,i,0,d);if(c!==0){for(n=0;n<c;n++){v[s+n]=v[o+n]}s+=c;o+=c;i-=c;if(i===0){f=true;break}}v[s++]=y[a++];if(--t===1){f=true;break}l--}while(u>=Ut||c>=Ut);if(f){break}if(l<0){l=0}l+=2}g=l;g<1&&(g=1);if(t===1){for(n=0;n<i;n++){v[s+n]=v[o+n]}v[s+i]=y[a]}else if(t===0){throw new Error}else{for(n=0;n<t;n++){v[s+n]=y[a+n]}}}function c(e,t,r,i){var n=0;for(n=0;n<i;n++){y[n]=v[r+n]}var a=e+t-1;var o=i-1;var s=r+i-1;var l=0;var u=0;v[s--]=v[a--];if(--t===0){l=s-(i-1);for(n=0;n<i;n++){v[l+n]=y[n]}return}if(i===1){s-=t;a-=t;u=s+1;l=a+1;for(n=t-1;n>=0;n--){v[u+n]=v[l+n]}v[s]=y[o];return}var c=g;while(true){var f=0;var h=0;var p=false;do{if(d(y[o],v[a])<0){v[s--]=v[a--];f++;h=0;if(--t===0){p=true;break}}else{v[s--]=y[o--];h++;f=0;if(--i===1){p=true;break}}}while((f|h)<c);if(p){break}do{f=t-Kt(y[o],v,e,t,t-1,d);if(f!==0){s-=f;a-=f;t-=f;u=s+1;l=a+1;for(n=f-1;n>=0;n--){v[u+n]=v[l+n]}if(t===0){p=true;break}}v[s--]=y[o--];if(--i===1){p=true;break}h=i-Jt(v[a],y,0,i,i-1,d);if(h!==0){s-=h;o-=h;i-=h;u=s+1;l=o+1;for(n=0;n<h;n++){v[u+n]=y[l+n]}if(i<=1){p=true;break}}v[s--]=v[a--];if(--t===0){p=true;break}c--}while(f>=Ut||h>=Ut);if(p){break}if(c<0){c=0}c+=2}g=c;if(g<1){g=1}if(i===1){s-=t;a-=t;u=s+1;l=a+1;for(n=t-1;n>=0;n--){v[u+n]=v[l+n]}v[s]=y[o]}else if(i===0){throw new Error}else{l=s-(i-1);for(n=0;n<i;n++){v[l+n]=y[n]}}}return{mergeRuns:r,forceMergeRuns:i,pushRun:t}}function $t(e,t,r,i){if(!r){r=0}if(!i){i=e.length}var n=i-r;if(n<2){return}var a=0;if(n<jt){a=Yt(e,r,i,t);qt(e,r,i,r+a,t);return}var o=Qt(e,t);var s=Zt(n);do{a=Yt(e,r,i,t);if(a<s){var l=n;if(l>s){l=s}qt(e,r,r+l,r+a,t);a=l}o.pushRun(r,a);o.mergeRuns();n-=a;r+=a}while(n!==0);o.forceMergeRuns()}var er=1;var tr=2;var rr=4;var ir=false;function nr(){if(ir){return}ir=true;console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors")}function ar(e,t){if(e.zlevel===t.zlevel){if(e.z===t.z){return e.z2-t.z2}return e.z-t.z}return e.zlevel-t.zlevel}var or=function(){function e(){this._roots=[];this._displayList=[];this._displayListLen=0;this.displayableSortFunc=ar}e.prototype.traverse=function(e,t){for(var r=0;r<this._roots.length;r++){this._roots[r].traverse(e,t)}};e.prototype.getDisplayList=function(e,t){t=t||false;var r=this._displayList;if(e||!r.length){this.updateDisplayList(t)}return r};e.prototype.updateDisplayList=function(e){this._displayListLen=0;var t=this._roots;var r=this._displayList;for(var i=0,n=t.length;i<n;i++){this._updateAndAddDisplayable(t[i],null,e)}r.length=this._displayListLen;S.canvasSupported&&$t(r,ar)};e.prototype._updateAndAddDisplayable=function(e,t,r){if(e.ignore&&!r){return}e.beforeUpdate();e.update();e.afterUpdate();var i=e.getClipPath();if(e.ignoreClip){t=null}else if(i){if(t){t=t.slice()}else{t=[]}var n=i;var a=e;while(n){n.parent=a;n.updateTransform();t.push(n);a=n;n=n.getClipPath()}}if(e.childrenRef){var o=e.childrenRef();for(var s=0;s<o.length;s++){var l=o[s];if(e.__dirty){l.__dirty|=er}this._updateAndAddDisplayable(l,t,r)}e.__dirty=0}else{var u=e;if(t&&t.length){u.__clipPaths=t}else if(u.__clipPaths&&u.__clipPaths.length>0){u.__clipPaths=[]}if(isNaN(u.z)){nr();u.z=0}if(isNaN(u.z2)){nr();u.z2=0}if(isNaN(u.zlevel)){nr();u.zlevel=0}this._displayList[this._displayListLen++]=u}var c=e.getDecalElement&&e.getDecalElement();if(c){this._updateAndAddDisplayable(c,t,r)}var f=e.getTextGuideLine();if(f){this._updateAndAddDisplayable(f,t,r)}var h=e.getTextContent();if(h){this._updateAndAddDisplayable(h,t,r)}};e.prototype.addRoot=function(e){if(e.__zr&&e.__zr.storage===this){return}this._roots.push(e)};e.prototype.delRoot=function(e){if(e instanceof Array){for(var t=0,r=e.length;t<r;t++){this.delRoot(e[t])}return}var i=D(this._roots,e);if(i>=0){this._roots.splice(i,1)}};e.prototype.delAllRoots=function(){this._roots=[];this._displayList=[];this._displayListLen=0;return};e.prototype.getRoots=function(){return this._roots};e.prototype.dispose=function(){this._displayList=null;this._roots=null};return e}();var sr;sr=typeof window!=="undefined"&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)};var lr=sr;var ur={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){if((e*=2)<1){return.5*e*e*e}return.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){if((e*=2)<1){return.5*e*e*e*e}return-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){if((e*=2)<1){return.5*e*e*e*e*e}return.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return e===0?0:Math.pow(1024,e-1)},exponentialOut:function(e){return e===1?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){if(e===0){return 0}if(e===1){return 1}if((e*=2)<1){return.5*Math.pow(1024,e-1)}return.5*(-Math.pow(2,-10*(e-1))+2)},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){if((e*=2)<1){return-.5*(Math.sqrt(1-e*e)-1)}return.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t;var r=.1;var i=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=i/4}else{t=i*Math.asin(1/r)/(2*Math.PI)}return-(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i))},elasticOut:function(e){var t;var r=.1;var i=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=i/4}else{t=i*Math.asin(1/r)/(2*Math.PI)}return r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/i)+1},elasticInOut:function(e){var t;var r=.1;var i=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=i/4}else{t=i*Math.asin(1/r)/(2*Math.PI)}if((e*=2)<1){return-.5*(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i))}return r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*.5+1},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},backInOut:function(e){var t=1.70158*1.525;if((e*=2)<1){return.5*(e*e*((t+1)*e-t))}return.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-ur.bounceOut(1-e)},bounceOut:function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.75}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}},bounceInOut:function(e){if(e<.5){return ur.bounceIn(e*2)*.5}return ur.bounceOut(e*2-1)*.5+.5}};var cr=function(){function e(e){this._initialized=false;this._startTime=0;this._pausedTime=0;this._paused=false;this._life=e.life||1e3;this._delay=e.delay||0;this.loop=e.loop==null?false:e.loop;this.gap=e.gap||0;this.easing=e.easing||"linear";this.onframe=e.onframe;this.ondestroy=e.ondestroy;this.onrestart=e.onrestart}e.prototype.step=function(e,t){if(!this._initialized){this._startTime=e+this._delay;this._initialized=true}if(this._paused){this._pausedTime+=t;return}var r=(e-this._startTime-this._pausedTime)/this._life;if(r<0){r=0}r=Math.min(r,1);var i=this.easing;var n=typeof i==="string"?ur[i]:i;var a=typeof n==="function"?n(r):r;this.onframe&&this.onframe(a);if(r===1){if(this.loop){this._restart(e);this.onrestart&&this.onrestart()}else{return true}}return false};e.prototype._restart=function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap;this._pausedTime=0};e.prototype.pause=function(){this._paused=true};e.prototype.resume=function(){this._paused=false};return e}();var fr=function(){function e(e){this.value=e}return e}();var hr=function(){function e(){this._len=0}e.prototype.insert=function(e){var t=new fr(e);this.insertEntry(t);return t};e.prototype.insertEntry=function(e){if(!this.head){this.head=this.tail=e}else{this.tail.next=e;e.prev=this.tail;e.next=null;this.tail=e}this._len++};e.prototype.remove=function(e){var t=e.prev;var r=e.next;if(t){t.next=r}else{this.head=r}if(r){r.prev=t}else{this.tail=t}e.next=e.prev=null;this._len--};e.prototype.len=function(){return this._len};e.prototype.clear=function(){this.head=this.tail=null;this._len=0};return e}();var pr=function(){function e(e){this._list=new hr;this._maxSize=10;this._map={};this._maxSize=e}e.prototype.put=function(e,t){var r=this._list;var i=this._map;var n=null;if(i[e]==null){var a=r.len();var o=this._lastRemovedEntry;if(a>=this._maxSize&&a>0){var s=r.head;r.remove(s);delete i[s.key];n=s.value;this._lastRemovedEntry=s}if(o){o.value=t}else{o=new fr(t)}o.key=e;r.insertEntry(o);i[e]=o}return n};e.prototype.get=function(e){var t=this._map[e];var r=this._list;if(t!=null){if(t!==r.tail){r.remove(t);r.insertEntry(t)}return t.value}};e.prototype.clear=function(){this._list.clear();this._map={}};e.prototype.len=function(){return this._list.len()};return e}();var vr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dr(e){e=Math.round(e);return e<0?0:e>255?255:e}function gr(e){e=Math.round(e);return e<0?0:e>360?360:e}function yr(e){return e<0?0:e>1?1:e}function mr(e){var t=e;if(t.length&&t.charAt(t.length-1)==="%"){return dr(parseFloat(t)/100*255)}return dr(parseInt(t,10))}function xr(e){var t=e;if(t.length&&t.charAt(t.length-1)==="%"){return yr(parseFloat(t)/100)}return yr(parseFloat(t))}function _r(e,t,r){if(r<0){r+=1}else if(r>1){r-=1}if(r*6<1){return e+(t-e)*r*6}if(r*2<1){return t}if(r*3<2){return e+(t-e)*(2/3-r)*6}return e}function br(e,t,r){return e+(t-e)*r}function wr(e,t,r,i,n){e[0]=t;e[1]=r;e[2]=i;e[3]=n;return e}function Sr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}var Mr=new pr(20);var Ir=null;function Cr(e,t){if(Ir){Sr(Ir,t)}Ir=Mr.put(e,Ir||t.slice())}function Tr(e,t){if(!e){return}t=t||[];var r=Mr.get(e);if(r){return Sr(t,r)}e=e+"";var i=e.replace(/ /g,"").toLowerCase();if(i in vr){Sr(t,vr[i]);Cr(e,t);return t}var n=i.length;if(i.charAt(0)==="#"){if(n===4||n===5){var a=parseInt(i.slice(1,4),16);if(!(a>=0&&a<=4095)){wr(t,0,0,0,1);return}wr(t,(a&3840)>>4|(a&3840)>>8,a&240|(a&240)>>4,a&15|(a&15)<<4,n===5?parseInt(i.slice(4),16)/15:1);Cr(e,t);return t}else if(n===7||n===9){var a=parseInt(i.slice(1,7),16);if(!(a>=0&&a<=16777215)){wr(t,0,0,0,1);return}wr(t,(a&16711680)>>16,(a&65280)>>8,a&255,n===9?parseInt(i.slice(7),16)/255:1);Cr(e,t);return t}return}var o=i.indexOf("(");var s=i.indexOf(")");if(o!==-1&&s+1===n){var l=i.substr(0,o);var u=i.substr(o+1,s-(o+1)).split(",");var c=1;switch(l){case"rgba":if(u.length!==4){return u.length===3?wr(t,+u[0],+u[1],+u[2],1):wr(t,0,0,0,1)}c=xr(u.pop());case"rgb":if(u.length!==3){wr(t,0,0,0,1);return}wr(t,mr(u[0]),mr(u[1]),mr(u[2]),c);Cr(e,t);return t;case"hsla":if(u.length!==4){wr(t,0,0,0,1);return}u[3]=xr(u[3]);Dr(u,t);Cr(e,t);return t;case"hsl":if(u.length!==3){wr(t,0,0,0,1);return}Dr(u,t);Cr(e,t);return t;default:return}}wr(t,0,0,0,1);return}function Dr(e,t){var r=(parseFloat(e[0])%360+360)%360/360;var i=xr(e[1]);var n=xr(e[2]);var a=n<=.5?n*(i+1):n+i-n*i;var o=n*2-a;t=t||[];wr(t,dr(_r(o,a,r+1/3)*255),dr(_r(o,a,r)*255),dr(_r(o,a,r-1/3)*255),1);if(e.length===4){t[3]=e[3]}return t}function Ar(e){if(!e){return}var t=e[0]/255;var r=e[1]/255;var i=e[2]/255;var n=Math.min(t,r,i);var a=Math.max(t,r,i);var o=a-n;var s=(a+n)/2;var l;var u;if(o===0){l=0;u=0}else{if(s<.5){u=o/(a+n)}else{u=o/(2-a-n)}var c=((a-t)/6+o/2)/o;var f=((a-r)/6+o/2)/o;var h=((a-i)/6+o/2)/o;if(t===a){l=h-f}else if(r===a){l=1/3+c-h}else if(i===a){l=2/3+f-c}if(l<0){l+=1}if(l>1){l-=1}}var p=[l*360,u,s];if(e[3]!=null){p.push(e[3])}return p}function Lr(e,t){var r=Tr(e);if(r){for(var i=0;i<3;i++){if(t<0){r[i]=r[i]*(1-t)|0}else{r[i]=(255-r[i])*t+r[i]|0}if(r[i]>255){r[i]=255}else if(r[i]<0){r[i]=0}}return Br(r,r.length===4?"rgba":"rgb")}}function kr(e){var t=Tr(e);if(t){return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}}function Pr(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}r=r||[];var i=e*(t.length-1);var n=Math.floor(i);var a=Math.ceil(i);var o=t[n];var s=t[a];var l=i-n;r[0]=dr(br(o[0],s[0],l));r[1]=dr(br(o[1],s[1],l));r[2]=dr(br(o[2],s[2],l));r[3]=yr(br(o[3],s[3],l));return r}var Or=Pr;function Nr(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}var i=e*(t.length-1);var n=Math.floor(i);var a=Math.ceil(i);var o=Tr(t[n]);var s=Tr(t[a]);var l=i-n;var u=Br([dr(br(o[0],s[0],l)),dr(br(o[1],s[1],l)),dr(br(o[2],s[2],l)),yr(br(o[3],s[3],l))],"rgba");return r?{color:u,leftIndex:n,rightIndex:a,value:i}:u}var Er=Nr;function Rr(e,t,r,i){var n=Tr(e);if(e){n=Ar(n);t!=null&&(n[0]=gr(t));r!=null&&(n[1]=xr(r));i!=null&&(n[2]=xr(i));return Br(Dr(n),"rgba")}}function zr(e,t){var r=Tr(e);if(r&&t!=null){r[3]=yr(t);return Br(r,"rgba")}}function Br(e,t){if(!e||!e.length){return}var r=e[0]+","+e[1]+","+e[2];if(t==="rgba"||t==="hsva"||t==="hsla"){r+=","+e[3]}return t+"("+r+")"}function Vr(e,t){var r=Tr(e);return r?(.299*r[0]+.587*r[1]+.114*r[2])*r[3]/255+(1-r[3])*t:0}function Gr(){var e=Math.round(Math.random()*255);var t=Math.round(Math.random()*255);var r=Math.round(Math.random()*255);return"rgb("+e+","+t+","+r+")"}var Fr=Object.freeze({__proto__:null,parse:Tr,lift:Lr,toHex:kr,fastLerp:Pr,fastMapToColor:Or,lerp:Nr,mapToColor:Er,modifyHSL:Rr,modifyAlpha:zr,stringify:Br,lum:Vr,random:Gr});var Hr=Array.prototype.slice;function Wr(e,t,r){return(t-e)*r+e}function jr(e,t,r){return r>.5?t:e}function Ur(e,t,r,i){var n=t.length;for(var a=0;a<n;a++){e[a]=Wr(t[a],r[a],i)}}function Zr(e,t,r,i){var n=t.length;var a=n&&t[0].length;for(var o=0;o<n;o++){if(!e[o]){e[o]=[]}for(var s=0;s<a;s++){e[o][s]=Wr(t[o][s],r[o][s],i)}}}function Yr(e,t,r,i){var n=t.length;for(var a=0;a<n;a++){e[a]=t[a]+r[a]*i}return e}function Xr(e,t,r,i){var n=t.length;var a=n&&t[0].length;for(var o=0;o<n;o++){if(!e[o]){e[o]=[]}for(var s=0;s<a;s++){e[o][s]=t[o][s]+r[o][s]*i}}return e}function qr(e,t,r){var i=e;var n=t;if(!i.push||!n.push){return}var a=i.length;var o=n.length;if(a!==o){var s=a>o;if(s){i.length=o}else{for(var l=a;l<o;l++){i.push(r===1?n[l]:Hr.call(n[l]))}}}var u=i[0]&&i[0].length;for(var l=0;l<i.length;l++){if(r===1){if(isNaN(i[l])){i[l]=n[l]}}else{for(var c=0;c<u;c++){if(isNaN(i[l][c])){i[l][c]=n[l][c]}}}}}function Jr(e,t){var r=e.length;if(r!==t.length){return false}for(var i=0;i<r;i++){if(e[i]!==t[i]){return false}}return true}function Kr(e,t,r,i,n,a,o){var s=(r-e)*.5;var l=(i-t)*.5;return(2*(t-r)+s+l)*o+(-3*(t-r)-2*s-l)*a+s*n+t}function Qr(e,t,r,i,n,a,o,s){var l=t.length;for(var u=0;u<l;u++){e[u]=Kr(t[u],r[u],i[u],n[u],a,o,s)}}function $r(e,t,r,i,n,a,o,s){var l=t.length;var u=t[0].length;for(var c=0;c<l;c++){if(!e[c]){e[1]=[]}for(var f=0;f<u;f++){e[c][f]=Kr(t[c][f],r[c][f],i[c][f],n[c][f],a,o,s)}}}function ei(e){if(se(e)){var t=e.length;if(se(e[0])){var r=[];for(var i=0;i<t;i++){r.push(Hr.call(e[i]))}return r}return Hr.call(e)}return e}function ti(e){e[0]=Math.floor(e[0]);e[1]=Math.floor(e[1]);e[2]=Math.floor(e[2]);return"rgba("+e.join(",")+")"}function ri(e){return se(e&&e[0])?2:1}var ii=[0,0,0,0];var ni=function(){function e(e){this.keyframes=[];this.maxTime=0;this.arrDim=0;this.interpolable=true;this._needsSort=false;this._isAllValueEqual=true;this._lastFrame=0;this._lastFramePercent=0;this.propName=e}e.prototype.isFinished=function(){return this._finished};e.prototype.setFinished=function(){this._finished=true;if(this._additiveTrack){this._additiveTrack.setFinished()}};e.prototype.needsAnimate=function(){return!this._isAllValueEqual&&this.keyframes.length>=2&&this.interpolable};e.prototype.getAdditiveTrack=function(){return this._additiveTrack};e.prototype.addKeyframe=function(e,t){if(e>=this.maxTime){this.maxTime=e}else{this._needsSort=true}var r=this.keyframes;var i=r.length;if(this.interpolable){if(se(t)){var n=ri(t);if(i>0&&this.arrDim!==n){this.interpolable=false;return}if(n===1&&typeof t[0]!=="number"||n===2&&typeof t[0][0]!=="number"){this.interpolable=false;return}if(i>0){var a=r[i-1];if(this._isAllValueEqual){if(n===1){if(!Jr(t,a.value)){this._isAllValueEqual=false}}else{this._isAllValueEqual=false}}}this.arrDim=n}else{if(this.arrDim>0){this.interpolable=false;return}if(typeof t==="string"){var o=Tr(t);if(o){t=o;this.isValueColor=true}else{this.interpolable=false}}else if(typeof t!=="number"||isNaN(t)){this.interpolable=false;return}if(this._isAllValueEqual&&i>0){var a=r[i-1];if(this.isValueColor&&!Jr(a.value,t)){this._isAllValueEqual=false}else if(a.value!==t){this._isAllValueEqual=false}}}}var s={time:e,value:t,percent:0};this.keyframes.push(s);return s};e.prototype.prepare=function(e){var t=this.keyframes;if(this._needsSort){t.sort(function(e,t){return e.time-t.time})}var r=this.arrDim;var i=t.length;var n=t[i-1];for(var a=0;a<i;a++){t[a].percent=t[a].time/this.maxTime;if(r>0&&a!==i-1){qr(t[a].value,n.value,r)}}if(e&&this.needsAnimate()&&e.needsAnimate()&&r===e.arrDim&&this.isValueColor===e.isValueColor&&!e._finished){this._additiveTrack=e;var o=t[0].value;for(var a=0;a<i;a++){if(r===0){if(this.isValueColor){t[a].additiveValue=Yr([],t[a].value,o,-1)}else{t[a].additiveValue=t[a].value-o}}else if(r===1){t[a].additiveValue=Yr([],t[a].value,o,-1)}else if(r===2){t[a].additiveValue=Xr([],t[a].value,o,-1)}}}};e.prototype.step=function(e,t){if(this._finished){return}if(this._additiveTrack&&this._additiveTrack._finished){this._additiveTrack=null}var r=this._additiveTrack!=null;var i=r?"additiveValue":"value";var n=this.keyframes;var a=this.keyframes.length;var o=this.propName;var s=this.arrDim;var l=this.isValueColor;var u;if(t<0){u=0}else if(t<this._lastFramePercent){var c=Math.min(this._lastFrame+1,a-1);for(u=c;u>=0;u--){if(n[u].percent<=t){break}}u=Math.min(u,a-2)}else{for(u=this._lastFrame;u<a;u++){if(n[u].percent>t){break}}u=Math.min(u-1,a-2)}var f=n[u+1];var h=n[u];if(!(h&&f)){return}this._lastFrame=u;this._lastFramePercent=t;var p=f.percent-h.percent;if(p===0){return}var v=(t-h.percent)/p;var d=r?this._additiveValue:l?ii:e[o];if((s>0||l)&&!d){d=this._additiveValue=[]}if(this.useSpline){var g=n[u][i];var y=n[u===0?u:u-1][i];var m=n[u>a-2?a-1:u+1][i];var x=n[u>a-3?a-1:u+2][i];if(s>0){s===1?Qr(d,y,g,m,x,v,v*v,v*v*v):$r(d,y,g,m,x,v,v*v,v*v*v)}else if(l){Qr(d,y,g,m,x,v,v*v,v*v*v);if(!r){e[o]=ti(d)}}else{var _=void 0;if(!this.interpolable){_=m}else{_=Kr(y,g,m,x,v,v*v,v*v*v)}if(r){this._additiveValue=_}else{e[o]=_}}}else{if(s>0){s===1?Ur(d,h[i],f[i],v):Zr(d,h[i],f[i],v)}else if(l){Ur(d,h[i],f[i],v);if(!r){e[o]=ti(d)}}else{var _=void 0;if(!this.interpolable){_=jr(h[i],f[i],v)}else{_=Wr(h[i],f[i],v)}if(r){this._additiveValue=_}else{e[o]=_}}}if(r){this._addToTarget(e)}};e.prototype._addToTarget=function(e){var t=this.arrDim;var r=this.propName;var i=this._additiveValue;if(t===0){if(this.isValueColor){Tr(e[r],ii);Yr(ii,ii,i,1);e[r]=ti(ii)}else{e[r]=e[r]+i}}else if(t===1){Yr(e[r],e[r],i,1)}else if(t===2){Xr(e[r],e[r],i,1)}};return e}();var ai=function(){function e(e,t,r){this._tracks={};this._trackKeys=[];this._delay=0;this._maxTime=0;this._paused=false;this._started=0;this._clip=null;this._target=e;this._loop=t;if(t&&r){re("Can' use additive animation on looped animation.");return}this._additiveAnimators=r}e.prototype.getTarget=function(){return this._target};e.prototype.changeTarget=function(e){this._target=e};e.prototype.when=function(e,t){return this.whenWithKeys(e,t,L(t))};e.prototype.whenWithKeys=function(e,t,r){var i=this._tracks;for(var n=0;n<r.length;n++){var a=r[n];var o=i[a];if(!o){o=i[a]=new ni(a);var s=void 0;var l=this._getAdditiveTrack(a);if(l){var u=l.keyframes[l.keyframes.length-1];s=u&&u.value;if(l.isValueColor&&s){s=ti(s)}}else{s=this._target[a]}if(s==null){continue}if(e!==0){o.addKeyframe(0,ei(s))}this._trackKeys.push(a)}o.addKeyframe(e,ei(t[a]))}this._maxTime=Math.max(this._maxTime,e);return this};e.prototype.pause=function(){this._clip.pause();this._paused=true};e.prototype.resume=function(){this._clip.resume();this._paused=false};e.prototype.isPaused=function(){return!!this._paused};e.prototype._doneCallback=function(){this._setTracksFinished();this._clip=null;var e=this._doneList;if(e){var t=e.length;for(var r=0;r<t;r++){e[r].call(this)}}};e.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation;var t=this._abortedList;if(e){e.removeClip(this._clip)}this._clip=null;if(t){for(var r=0;r<t.length;r++){t[r].call(this)}}};e.prototype._setTracksFinished=function(){var e=this._tracks;var t=this._trackKeys;for(var r=0;r<t.length;r++){e[t[r]].setFinished()}};e.prototype._getAdditiveTrack=function(e){var t;var r=this._additiveAnimators;if(r){for(var i=0;i<r.length;i++){var n=r[i].getTrack(e);if(n){t=n}}}return t};e.prototype.start=function(e,t){if(this._started>0){return}this._started=1;var a=this;var o=[];for(var r=0;r<this._trackKeys.length;r++){var i=this._trackKeys[r];var n=this._tracks[i];var s=this._getAdditiveTrack(i);var l=n.keyframes;n.prepare(s);if(n.needsAnimate()){o.push(n)}else if(!n.interpolable){var u=l[l.length-1];if(u){a._target[n.propName]=u.value}}}if(o.length||t){var c=new cr({life:this._maxTime,loop:this._loop,delay:this._delay,onframe:function(e){a._started=2;var t=a._additiveAnimators;if(t){var r=false;for(var i=0;i<t.length;i++){if(t[i]._clip){r=true;break}}if(!r){a._additiveAnimators=null}}for(var i=0;i<o.length;i++){o[i].step(a._target,e)}var n=a._onframeList;if(n){for(var i=0;i<n.length;i++){n[i](a._target,e)}}},ondestroy:function(){a._doneCallback()}});this._clip=c;if(this.animation){this.animation.addClip(c)}if(e&&e!=="spline"){c.easing=e}}else{this._doneCallback()}return this};e.prototype.stop=function(e){if(!this._clip){return}var t=this._clip;if(e){t.onframe(1)}this._abortedCallback()};e.prototype.delay=function(e){this._delay=e;return this};e.prototype.during=function(e){if(e){if(!this._onframeList){this._onframeList=[]}this._onframeList.push(e)}return this};e.prototype.done=function(e){if(e){if(!this._doneList){this._doneList=[]}this._doneList.push(e)}return this};e.prototype.aborted=function(e){if(e){if(!this._abortedList){this._abortedList=[]}this._abortedList.push(e)}return this};e.prototype.getClip=function(){return this._clip};e.prototype.getTrack=function(e){return this._tracks[e]};e.prototype.stopTracks=function(e,t){if(!e.length||!this._clip){return true}var r=this._tracks;var i=this._trackKeys;for(var n=0;n<e.length;n++){var a=r[e[n]];if(a){if(t){a.step(this._target,1)}else if(this._started===1){a.step(this._target,0)}a.setFinished()}}var o=true;for(var n=0;n<i.length;n++){if(!r[i[n]].isFinished()){o=false;break}}if(o){this._abortedCallback()}return o};e.prototype.saveFinalToTarget=function(e,t){if(!e){return}t=t||this._trackKeys;for(var r=0;r<t.length;r++){var i=t[r];var n=this._tracks[i];if(!n||n.isFinished()){continue}var a=n.keyframes;var o=a[a.length-1];if(o){var s=ei(o.value);if(n.isValueColor){s=ti(s)}e[i]=s}}};e.prototype.__changeFinalValue=function(e,t){t=t||L(e);for(var r=0;r<t.length;r++){var i=t[r];var n=this._tracks[i];if(!n){continue}var a=n.keyframes;if(a.length>1){var o=a.pop();n.addKeyframe(o.time,e[i]);n.prepare(n.getAdditiveTrack())}}};return e}();var oi=function(r){d(e,r);function e(e){var t=r.call(this)||this;t._running=false;t._time=0;t._pausedTime=0;t._pauseStart=0;t._paused=false;e=e||{};t.stage=e.stage||{};t.onframe=e.onframe||function(){};return t}e.prototype.addClip=function(e){if(e.animation){this.removeClip(e)}if(!this._clipsHead){this._clipsHead=this._clipsTail=e}else{this._clipsTail.next=e;e.prev=this._clipsTail;e.next=null;this._clipsTail=e}e.animation=this};e.prototype.addAnimator=function(e){e.animation=this;var t=e.getClip();if(t){this.addClip(t)}};e.prototype.removeClip=function(e){if(!e.animation){return}var t=e.prev;var r=e.next;if(t){t.next=r}else{this._clipsHead=r}if(r){r.prev=t}else{this._clipsTail=t}e.next=e.prev=e.animation=null};e.prototype.removeAnimator=function(e){var t=e.getClip();if(t){this.removeClip(t)}e.animation=null};e.prototype.update=function(e){var t=(new Date).getTime()-this._pausedTime;var r=t-this._time;var i=this._clipsHead;while(i){var n=i.next;var a=i.step(t,r);if(a){i.ondestroy&&i.ondestroy();this.removeClip(i);i=n}else{i=n}}this._time=t;if(!e){this.onframe(r);this.trigger("frame",r);this.stage.update&&this.stage.update()}};e.prototype._startLoop=function(){var e=this;this._running=true;function t(){if(e._running){lr(t);!e._paused&&e.update()}}lr(t)};e.prototype.start=function(){if(this._running){return}this._time=(new Date).getTime();this._pausedTime=0;this._startLoop()};e.prototype.stop=function(){this._running=false};e.prototype.pause=function(){if(!this._paused){this._pauseStart=(new Date).getTime();this._paused=true}};e.prototype.resume=function(){if(this._paused){this._pausedTime+=(new Date).getTime()-this._pauseStart;this._paused=false}};e.prototype.clear=function(){var e=this._clipsHead;while(e){var t=e.next;e.prev=e.next=e.animation=null;e=t}this._clipsHead=this._clipsTail=null};e.prototype.isFinished=function(){return this._clipsHead==null};e.prototype.animate=function(e,t){t=t||{};this.start();var r=new ai(e,t.loop);this.addAnimator(r);return r};return e}(lt);var si=300;var li=S.domSupported;var ui=function(){var e=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"];var t=["touchstart","touchend","touchmove"];var r={pointerdown:1,pointerup:1,pointermove:1,pointerout:1};var i=A(e,function(e){var t=e.replace("mouse","pointer");return r.hasOwnProperty(t)?t:e});return{mouse:e,touch:t,pointer:i}}();var ci={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]};var fi=false;function hi(e){var t=e.pointerType;return t==="pen"||t==="touch"}function pi(e){e.touching=true;if(e.touchTimer!=null){clearTimeout(e.touchTimer);e.touchTimer=null}e.touchTimer=setTimeout(function(){e.touching=false;e.touchTimer=null},700)}function vi(e){e&&(e.zrByTouch=true)}function di(e,t){return It(e.dom,new yi(e,t),true)}function gi(e,t){var r=t;var i=false;while(r&&r.nodeType!==9&&!(i=r.domBelongToZr||r!==t&&r===e.painterRoot)){r=r.parentNode}return i}var yi=function(){function e(e,t){this.stopPropagation=Pe;this.stopImmediatePropagation=Pe;this.preventDefault=Pe;this.type=t.type;this.target=this.currentTarget=e.dom;this.pointerType=t.pointerType;this.clientX=t.clientX;this.clientY=t.clientY}return e}();var mi={mousedown:function(e){e=It(this.dom,e);this.__mayPointerCapture=[e.zrX,e.zrY];this.trigger("mousedown",e)},mousemove:function(e){e=It(this.dom,e);var t=this.__mayPointerCapture;if(t&&(e.zrX!==t[0]||e.zrY!==t[1])){this.__togglePointerCapture(true)}this.trigger("mousemove",e)},mouseup:function(e){e=It(this.dom,e);this.__togglePointerCapture(false);this.trigger("mouseup",e)},mouseout:function(e){e=It(this.dom,e);var t=e.toElement||e.relatedTarget;if(!gi(this,t)){if(this.__pointerCapturing){e.zrEventControl="no_globalout"}this.trigger("mouseout",e)}},wheel:function(e){fi=true;e=It(this.dom,e);this.trigger("mousewheel",e)},mousewheel:function(e){if(fi){return}e=It(this.dom,e);this.trigger("mousewheel",e)},touchstart:function(e){e=It(this.dom,e);vi(e);this.__lastTouchMoment=new Date;this.handler.processGesture(e,"start");mi.mousemove.call(this,e);mi.mousedown.call(this,e)},touchmove:function(e){e=It(this.dom,e);vi(e);this.handler.processGesture(e,"change");mi.mousemove.call(this,e)},touchend:function(e){e=It(this.dom,e);vi(e);this.handler.processGesture(e,"end");mi.mouseup.call(this,e);if(+new Date-+this.__lastTouchMoment<si){mi.click.call(this,e)}},pointerdown:function(e){mi.mousedown.call(this,e)},pointermove:function(e){if(!hi(e)){mi.mousemove.call(this,e)}},pointerup:function(e){mi.mouseup.call(this,e)},pointerout:function(e){if(!hi(e)){mi.mouseout.call(this,e)}}};U(["click","dblclick","contextmenu"],function(t){mi[t]=function(e){e=It(this.dom,e);this.trigger(t,e)}});var xi={pointermove:function(e){if(!hi(e)){xi.mousemove.call(this,e)}},pointerup:function(e){xi.mouseup.call(this,e)},mousemove:function(e){this.trigger("mousemove",e)},mouseup:function(e){var t=this.__pointerCapturing;this.__togglePointerCapture(false);this.trigger("mouseup",e);if(t){e.zrEventControl="only_globalout";this.trigger("mouseout",e)}}};function _i(r,i){var n=i.domHandlers;if(S.pointerEventsSupported){U(ui.pointer,function(t){wi(i,t,function(e){n[t].call(r,e)})})}else{if(S.touchEventsSupported){U(ui.touch,function(t){wi(i,t,function(e){n[t].call(r,e);pi(i)})})}U(ui.mouse,function(t){wi(i,t,function(e){e=Mt(e);if(!i.touching){n[t].call(r,e)}})})}}function bi(r,i){if(S.pointerEventsSupported){U(ci.pointer,e)}else if(!S.touchEventsSupported){U(ci.mouse,e)}function e(t){function e(e){e=Mt(e);if(!gi(r,e.target)){e=di(r,e);i.domHandlers[t].call(r,e)}}wi(i,t,e,{capture:true})}}function wi(e,t,r,i){e.mounted[t]=r;e.listenerOpts[t]=i;Tt(e.domTarget,t,r,i)}function Si(e){var t=e.mounted;for(var r in t){if(t.hasOwnProperty(r)){Dt(e.domTarget,r,t[r],e.listenerOpts[r])}}e.mounted={}}var Mi=function(){function e(e,t){this.mounted={};this.listenerOpts={};this.touching=false;this.domTarget=e;this.domHandlers=t}return e}();var Ii=function(i){d(e,i);function e(e,t){var r=i.call(this)||this;r.__pointerCapturing=false;r.dom=e;r.painterRoot=t;r._localHandlerScope=new Mi(e,mi);if(li){r._globalHandlerScope=new Mi(document,xi)}_i(r,r._localHandlerScope);return r}e.prototype.dispose=function(){Si(this._localHandlerScope);if(li){Si(this._globalHandlerScope)}};e.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")};e.prototype.__togglePointerCapture=function(e){this.__mayPointerCapture=null;if(li&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var t=this._globalHandlerScope;e?bi(this,t):Si(t)}};return e}(lt);var Ci=1;if(typeof window!=="undefined"){Ci=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1)}var Ti=Ci;var Di=.4;var Ai="#333";var Li="#ccc";var ki="#eee";function Pi(){return[1,0,0,1,0,0]}function Oi(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Ni(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Ei(e,t,r){var i=t[0]*r[0]+t[2]*r[1];var n=t[1]*r[0]+t[3]*r[1];var a=t[0]*r[2]+t[2]*r[3];var o=t[1]*r[2]+t[3]*r[3];var s=t[0]*r[4]+t[2]*r[5]+t[4];var l=t[1]*r[4]+t[3]*r[5]+t[5];e[0]=i;e[1]=n;e[2]=a;e[3]=o;e[4]=s;e[5]=l;return e}function Ri(e,t,r){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4]+r[0];e[5]=t[5]+r[1];return e}function zi(e,t,r){var i=t[0];var n=t[2];var a=t[4];var o=t[1];var s=t[3];var l=t[5];var u=Math.sin(r);var c=Math.cos(r);e[0]=i*c+o*u;e[1]=-i*u+o*c;e[2]=n*c+s*u;e[3]=-n*u+c*s;e[4]=c*a+u*l;e[5]=c*l-u*a;return e}function Bi(e,t,r){var i=r[0];var n=r[1];e[0]=t[0]*i;e[1]=t[1]*n;e[2]=t[2]*i;e[3]=t[3]*n;e[4]=t[4]*i;e[5]=t[5]*n;return e}function Vi(e,t){var r=t[0];var i=t[2];var n=t[4];var a=t[1];var o=t[3];var s=t[5];var l=r*o-a*i;if(!l){return null}l=1/l;e[0]=o*l;e[1]=-a*l;e[2]=-i*l;e[3]=r*l;e[4]=(i*s-o*n)*l;e[5]=(a*n-r*s)*l;return e}function Gi(e){var t=Pi();Ni(t,e);return t}var Fi=Object.freeze({__proto__:null,create:Pi,identity:Oi,copy:Ni,mul:Ei,translate:Ri,rotate:zi,scale:Bi,invert:Vi,clone:Gi});var Hi=Oi;var Wi=5e-5;function ji(e){return e>Wi||e<-Wi}var Ui=[];var Zi=[];var Yi=Pi();var Xi=Math.abs;var qi=function(){function t(){}t.prototype.setPosition=function(e){this.x=e[0];this.y=e[1]};t.prototype.setScale=function(e){this.scaleX=e[0];this.scaleY=e[1]};t.prototype.setSkew=function(e){this.skewX=e[0];this.skewY=e[1]};t.prototype.setOrigin=function(e){this.originX=e[0];this.originY=e[1]};t.prototype.needLocalTransform=function(){return ji(this.rotation)||ji(this.x)||ji(this.y)||ji(this.scaleX-1)||ji(this.scaleY-1)};t.prototype.updateTransform=function(){var e=this.parent;var t=e&&e.transform;var r=this.needLocalTransform();var i=this.transform;if(!(r||t)){i&&Hi(i);return}i=i||Pi();if(r){this.getLocalTransform(i)}else{Hi(i)}if(t){if(r){Ei(i,e.transform,i)}else{Ni(i,e.transform)}}this.transform=i;this._resolveGlobalScaleRatio(i)};t.prototype._resolveGlobalScaleRatio=function(e){var t=this.globalScaleRatio;if(t!=null&&t!==1){this.getGlobalScale(Ui);var r=Ui[0]<0?-1:1;var i=Ui[1]<0?-1:1;var n=((Ui[0]-r)*t+r)/Ui[0]||0;var a=((Ui[1]-i)*t+i)/Ui[1]||0;e[0]*=n;e[1]*=n;e[2]*=a;e[3]*=a}this.invTransform=this.invTransform||Pi();Vi(this.invTransform,e)};t.prototype.getLocalTransform=function(e){return t.getLocalTransform(this,e)};t.prototype.getComputedTransform=function(){var e=this;var t=[];while(e){t.push(e);e=e.parent}while(e=t.pop()){e.updateTransform()}return this.transform};t.prototype.setLocalTransform=function(e){if(!e){return}var t=e[0]*e[0]+e[1]*e[1];var r=e[2]*e[2]+e[3]*e[3];var i=Math.atan2(e[1],e[0]);var n=Math.PI/2+i-Math.atan2(e[3],e[2]);r=Math.sqrt(r)*Math.cos(n);t=Math.sqrt(t);this.skewX=n;this.skewY=0;this.rotation=-i;this.x=+e[4];this.y=+e[5];this.scaleX=t;this.scaleY=r;this.originX=0;this.originY=0};t.prototype.decomposeTransform=function(){if(!this.transform){return}var e=this.parent;var t=this.transform;if(e&&e.transform){Ei(Zi,e.invTransform,t);t=Zi}var r=this.originX;var i=this.originY;if(r||i){Yi[4]=r;Yi[5]=i;Ei(Zi,t,Yi);Zi[4]-=r;Zi[5]-=i;t=Zi}this.setLocalTransform(t)};t.prototype.getGlobalScale=function(e){var t=this.transform;e=e||[];if(!t){e[0]=1;e[1]=1;return e}e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]);e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]);if(t[0]<0){e[0]=-e[0]}if(t[3]<0){e[1]=-e[1]}return e};t.prototype.transformCoordToLocal=function(e,t){var r=[e,t];var i=this.invTransform;if(i){rt(r,r,i)}return r};t.prototype.transformCoordToGlobal=function(e,t){var r=[e,t];var i=this.transform;if(i){rt(r,r,i)}return r};t.prototype.getLineScale=function(){var e=this.transform;return e&&Xi(e[0]-1)>1e-10&&Xi(e[3]-1)>1e-10?Math.sqrt(Xi(e[0]*e[3]-e[2]*e[1])):1};t.getLocalTransform=function(e,t){t=t||[];var r=e.originX||0;var i=e.originY||0;var n=e.scaleX;var a=e.scaleY;var o=e.rotation||0;var s=e.x;var l=e.y;var u=e.skewX?Math.tan(e.skewX):0;var c=e.skewY?Math.tan(-e.skewY):0;if(r||i){t[4]=-r*n-u*i*a;t[5]=-i*a-c*r*n}else{t[4]=t[5]=0}t[0]=n;t[3]=a;t[1]=c*n;t[2]=u*a;o&&zi(t,t,o);t[4]+=r+s;t[5]+=i+l;return t};t.initDefaultProps=function(){var e=t.prototype;e.x=0;e.y=0;e.scaleX=1;e.scaleY=1;e.originX=0;e.originY=0;e.skewX=0;e.skewY=0;e.rotation=0;e.globalScaleRatio=1}();return t}();var Z=function(){function e(e,t){this.x=e||0;this.y=t||0}e.prototype.copy=function(e){this.x=e.x;this.y=e.y;return this};e.prototype.clone=function(){return new e(this.x,this.y)};e.prototype.set=function(e,t){this.x=e;this.y=t;return this};e.prototype.equal=function(e){return e.x===this.x&&e.y===this.y};e.prototype.add=function(e){this.x+=e.x;this.y+=e.y;return this};e.prototype.scale=function(e){this.x*=e;this.y*=e};e.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t;this.y+=e.y*t};e.prototype.sub=function(e){this.x-=e.x;this.y-=e.y;return this};e.prototype.dot=function(e){return this.x*e.x+this.y*e.y};e.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};e.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y};e.prototype.normalize=function(){var e=this.len();this.x/=e;this.y/=e;return this};e.prototype.distance=function(e){var t=this.x-e.x;var r=this.y-e.y;return Math.sqrt(t*t+r*r)};e.prototype.distanceSquare=function(e){var t=this.x-e.x;var r=this.y-e.y;return t*t+r*r};e.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};e.prototype.transform=function(e){if(!e){return}var t=this.x;var r=this.y;this.x=e[0]*t+e[2]*r+e[4];this.y=e[1]*t+e[3]*r+e[5];return this};e.prototype.toArray=function(e){e[0]=this.x;e[1]=this.y;return e};e.prototype.fromArray=function(e){this.x=e[0];this.y=e[1]};e.set=function(e,t,r){e.x=t;e.y=r};e.copy=function(e,t){e.x=t.x;e.y=t.y};e.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};e.lenSquare=function(e){return e.x*e.x+e.y*e.y};e.dot=function(e,t){return e.x*t.x+e.y*t.y};e.add=function(e,t,r){e.x=t.x+r.x;e.y=t.y+r.y};e.sub=function(e,t,r){e.x=t.x-r.x;e.y=t.y-r.y};e.scale=function(e,t,r){e.x=t.x*r;e.y=t.y*r};e.scaleAndAdd=function(e,t,r,i){e.x=t.x+r.x*i;e.y=t.y+r.y*i};e.lerp=function(e,t,r,i){var n=1-i;e.x=n*t.x+i*r.x;e.y=n*t.y+i*r.y};return e}();var Ji=Math.min;var Ki=Math.max;var Qi=new Z;var $i=new Z;var en=new Z;var tn=new Z;var rn=new Z;var nn=new Z;var B=function(){function _(e,t,r,i){if(r<0){e=e+r;r=-r}if(i<0){t=t+i;i=-i}this.x=e;this.y=t;this.width=r;this.height=i}_.prototype.union=function(e){var t=Ji(e.x,this.x);var r=Ji(e.y,this.y);if(isFinite(this.x)&&isFinite(this.width)){this.width=Ki(e.x+e.width,this.x+this.width)-t}else{this.width=e.width}if(isFinite(this.y)&&isFinite(this.height)){this.height=Ki(e.y+e.height,this.y+this.height)-r}else{this.height=e.height}this.x=t;this.y=r};_.prototype.applyTransform=function(e){_.applyTransform(this,this,e)};_.prototype.calculateTransform=function(e){var t=this;var r=e.width/t.width;var i=e.height/t.height;var n=Pi();Ri(n,n,[-t.x,-t.y]);Bi(n,n,[r,i]);Ri(n,n,[e.x,e.y]);return n};_.prototype.intersect=function(e,t){if(!e){return false}if(!(e instanceof _)){e=_.create(e)}var r=this;var i=r.x;var n=r.x+r.width;var a=r.y;var o=r.y+r.height;var s=e.x;var l=e.x+e.width;var u=e.y;var c=e.y+e.height;var f=!(n<s||l<i||o<u||c<a);if(t){var h=Infinity;var p=0;var v=Math.abs(n-s);var d=Math.abs(l-i);var g=Math.abs(o-u);var y=Math.abs(c-a);var m=Math.min(v,d);var x=Math.min(g,y);if(n<s||l<i){if(m>p){p=m;if(v<d){Z.set(nn,-v,0)}else{Z.set(nn,d,0)}}}else{if(m<h){h=m;if(v<d){Z.set(rn,v,0)}else{Z.set(rn,-d,0)}}}if(o<u||c<a){if(x>p){p=x;if(g<y){Z.set(nn,0,-g)}else{Z.set(nn,0,y)}}}else{if(m<h){h=m;if(g<y){Z.set(rn,0,g)}else{Z.set(rn,0,-y)}}}}if(t){Z.copy(t,f?rn:nn)}return f};_.prototype.contain=function(e,t){var r=this;return e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height};_.prototype.clone=function(){return new _(this.x,this.y,this.width,this.height)};_.prototype.copy=function(e){_.copy(this,e)};_.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};_.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)};_.prototype.isZero=function(){return this.width===0||this.height===0};_.create=function(e){return new _(e.x,e.y,e.width,e.height)};_.copy=function(e,t){e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height};_.applyTransform=function(e,t,r){if(!r){if(e!==t){_.copy(e,t)}return}if(r[1]<1e-5&&r[1]>-1e-5&&r[2]<1e-5&&r[2]>-1e-5){var i=r[0];var n=r[3];var a=r[4];var o=r[5];e.x=t.x*i+a;e.y=t.y*n+o;e.width=t.width*i;e.height=t.height*n;if(e.width<0){e.x+=e.width;e.width=-e.width}if(e.height<0){e.y+=e.height;e.height=-e.height}return}Qi.x=en.x=t.x;Qi.y=tn.y=t.y;$i.x=tn.x=t.x+t.width;$i.y=en.y=t.y+t.height;Qi.transform(r);tn.transform(r);$i.transform(r);en.transform(r);e.x=Ji(Qi.x,$i.x,en.x,tn.x);e.y=Ji(Qi.y,$i.y,en.y,tn.y);var s=Ki(Qi.x,$i.x,en.x,tn.x);var l=Ki(Qi.y,$i.y,en.y,tn.y);e.width=s-e.x;e.height=l-e.y};return _}();var an={};var on="12px sans-serif";var sn;var ln;function un(e,t){if(!sn){sn=ne().getContext("2d")}if(ln!==t){ln=sn.font=t||on}return sn.measureText(e)}var cn={measureText:un};function fn(e,t){t=t||on;var r=an[t];if(!r){r=an[t]=new pr(500)}var i=r.get(e);if(i==null){i=cn.measureText(e,t).width;r.put(e,i)}return i}function hn(e,t,r,i){var n=fn(e,t);var a=gn(t);var o=vn(0,n,r);var s=dn(0,a,i);var l=new B(o,s,n,a);return l}function pn(e,t,r,i){var n=((e||"")+"").split("\n");var a=n.length;if(a===1){return hn(n[0],t,r,i)}else{var o=new B(0,0,0,0);for(var s=0;s<n.length;s++){var l=hn(n[s],t,r,i);s===0?o.copy(l):o.union(l)}return o}}function vn(e,t,r){if(r==="right"){e-=t}else if(r==="center"){e-=t/2}return e}function dn(e,t,r){if(r==="middle"){e-=t/2}else if(r==="bottom"){e-=t}return e}function gn(e){return fn("",e)}function yn(e,t){if(typeof e==="string"){if(e.lastIndexOf("%")>=0){return parseFloat(e)/100*t}return parseFloat(e)}return e}function mn(e,t,r){var i=t.position||"inside";var n=t.distance!=null?t.distance:5;var a=r.height;var o=r.width;var s=a/2;var l=r.x;var u=r.y;var c="left";var f="top";if(i instanceof Array){l+=yn(i[0],r.width);u+=yn(i[1],r.height);c=null;f=null}else{switch(i){case"left":l-=n;u+=s;c="right";f="middle";break;case"right":l+=n+o;u+=s;f="middle";break;case"top":l+=o/2;u-=n;c="center";f="bottom";break;case"bottom":l+=o/2;u+=a+n;c="center";break;case"inside":l+=o/2;u+=s;c="center";f="middle";break;case"insideLeft":l+=n;u+=s;f="middle";break;case"insideRight":l+=o-n;u+=s;c="right";f="middle";break;case"insideTop":l+=o/2;u+=n;c="center";break;case"insideBottom":l+=o/2;u+=a-n;c="center";f="bottom";break;case"insideTopLeft":l+=n;u+=n;break;case"insideTopRight":l+=o-n;u+=n;c="right";break;case"insideBottomLeft":l+=n;u+=a-n;f="bottom";break;case"insideBottomRight":l+=o-n;u+=a-n;c="right";f="bottom";break}}e=e||{};e.x=l;e.y=u;e.align=c;e.verticalAlign=f;return e}var xn="__zr_normal__";var _n=["x","y","scaleX","scaleY","originX","originY","rotation","ignore"];var bn={x:true,y:true,scaleX:true,scaleY:true,originX:true,originY:true,rotation:true,ignore:false};var wn={};var Sn=new B(0,0,0,0);var Mn=function(){function r(e){this.id=te();this.animators=[];this.currentStates=[];this.states={};this._init(e)}r.prototype._init=function(e){this.attr(e)};r.prototype.drift=function(e,t,r){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0;break}var i=this.transform;if(!i){i=this.transform=[1,0,0,1,0,0]}i[4]+=e;i[5]+=t;this.decomposeTransform();this.markRedraw()};r.prototype.beforeUpdate=function(){};r.prototype.afterUpdate=function(){};r.prototype.update=function(){this.updateTransform();if(this.__dirty){this.updateInnerText()}};r.prototype.updateInnerText=function(e){var t=this._textContent;if(t&&(!t.ignore||e)){if(!this.textConfig){this.textConfig={}}var r=this.textConfig;var i=r.local;var n=t.attachedTransform;var a=void 0;var o=void 0;var s=false;if(i){n.parent=this}else{n.parent=null}var l=false;n.x=t.x;n.y=t.y;n.originX=t.originX;n.originY=t.originY;n.rotation=t.rotation;n.scaleX=t.scaleX;n.scaleY=t.scaleY;if(r.position!=null){var u=Sn;if(r.layoutRect){u.copy(r.layoutRect)}else{u.copy(this.getBoundingRect())}if(!i){u.applyTransform(this.transform)}if(this.calculateTextPosition){this.calculateTextPosition(wn,r,u)}else{mn(wn,r,u)}n.x=wn.x;n.y=wn.y;a=wn.align;o=wn.verticalAlign;var c=r.origin;if(c&&r.rotation!=null){var f=void 0;var h=void 0;if(c==="center"){f=u.width*.5;h=u.height*.5}else{f=yn(c[0],u.width);h=yn(c[1],u.height)}l=true;n.originX=-n.x+f+(i?0:u.x);n.originY=-n.y+h+(i?0:u.y)}}if(r.rotation!=null){n.rotation=r.rotation}var p=r.offset;if(p){n.x+=p[0];n.y+=p[1];if(!l){n.originX=-p[0];n.originY=-p[1]}}var v=r.inside==null?typeof r.position==="string"&&r.position.indexOf("inside")>=0:r.inside;var d=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={});var g=void 0;var y=void 0;var m=void 0;if(v&&this.canBeInsideText()){g=r.insideFill;y=r.insideStroke;if(g==null||g==="auto"){g=this.getInsideTextFill()}if(y==null||y==="auto"){y=this.getInsideTextStroke(g);m=true}}else{g=r.outsideFill;y=r.outsideStroke;if(g==null||g==="auto"){g=this.getOutsideFill()}if(y==null||y==="auto"){y=this.getOutsideStroke(g);m=true}}g=g||"#000";if(g!==d.fill||y!==d.stroke||m!==d.autoStroke||a!==d.align||o!==d.verticalAlign){s=true;d.fill=g;d.stroke=y;d.autoStroke=m;d.align=a;d.verticalAlign=o;t.setDefaultTextStyle(d)}t.__dirty|=er;if(s){t.dirtyStyle(true)}}};r.prototype.canBeInsideText=function(){return true};r.prototype.getInsideTextFill=function(){return"#fff"};r.prototype.getInsideTextStroke=function(e){return"#000"};r.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?Li:Ai};r.prototype.getOutsideStroke=function(e){var t=this.__zr&&this.__zr.getBackgroundColor();var r=typeof t==="string"&&Tr(t);if(!r){r=[255,255,255,1]}var i=r[3];var n=this.__zr.isDarkMode();for(var a=0;a<3;a++){r[a]=r[a]*i+(n?0:255)*(1-i)}r[3]=1;return Br(r,"rgba")};r.prototype.traverse=function(e,t){};r.prototype.attrKV=function(e,t){if(e==="textConfig"){this.setTextConfig(t)}else if(e==="textContent"){this.setTextContent(t)}else if(e==="clipPath"){this.setClipPath(t)}else if(e==="extra"){this.extra=this.extra||{};F(this.extra,t)}else{this[e]=t}};r.prototype.hide=function(){this.ignore=true;this.markRedraw()};r.prototype.show=function(){this.ignore=false;this.markRedraw()};r.prototype.attr=function(e,t){if(typeof e==="string"){this.attrKV(e,t)}else if(O(e)){var r=e;var i=L(r);for(var n=0;n<i.length;n++){var a=i[n];this.attrKV(a,e[a])}}this.markRedraw();return this};r.prototype.saveCurrentToNormalState=function(e){this._innerSaveToNormal(e);var t=this._normalState;for(var r=0;r<this.animators.length;r++){var i=this.animators[r];var n=i.__fromStateTransition;if(n&&n!==xn){continue}var a=i.targetName;var o=a?t[a]:t;i.saveFinalToTarget(o)}};r.prototype._innerSaveToNormal=function(e){var t=this._normalState;if(!t){t=this._normalState={}}if(e.textConfig&&!t.textConfig){t.textConfig=this.textConfig}this._savePrimaryToNormal(e,t,_n)};r.prototype._savePrimaryToNormal=function(e,t,r){for(var i=0;i<r.length;i++){var n=r[i];if(e[n]!=null&&!(n in t)){t[n]=this[n]}}};r.prototype.hasState=function(){return this.currentStates.length>0};r.prototype.getState=function(e){return this.states[e]};r.prototype.ensureState=function(e){var t=this.states;if(!t[e]){t[e]={}}return t[e]};r.prototype.clearStates=function(e){this.useState(xn,false,e)};r.prototype.useState=function(e,t,r,i){var n=e===xn;var a=this.hasState();if(!a&&n){return}var o=this.currentStates;var s=this.stateTransition;if(D(o,e)>=0&&(t||o.length===1)){return}var l;if(this.stateProxy&&!n){l=this.stateProxy(e)}if(!l){l=this.states&&this.states[e]}if(!l&&!n){re("State "+e+" not exists.");return}if(!n){this.saveCurrentToNormalState(l)}var u=!!(l&&l.hoverLayer||i);if(u){this._toggleHoverLayerFlag(true)}this._applyStateObj(e,l,this._normalState,t,!r&&!this.__inHover&&s&&s.duration>0,s);var c=this._textContent;var f=this._textGuide;if(c){c.useState(e,t,r,u)}if(f){f.useState(e,t,r,u)}if(n){this.currentStates=[];this._normalState={}}else{if(!t){this.currentStates=[e]}else{this.currentStates.push(e)}}this._updateAnimationTargets();this.markRedraw();if(!u&&this.__inHover){this._toggleHoverLayerFlag(false);this.__dirty&=~er}return l};r.prototype.useStates=function(e,t,r){if(!e.length){this.clearStates()}else{var i=[];var n=this.currentStates;var a=e.length;var o=a===n.length;if(o){for(var s=0;s<a;s++){if(e[s]!==n[s]){o=false;break}}}if(o){return}for(var s=0;s<a;s++){var l=e[s];var u=void 0;if(this.stateProxy){u=this.stateProxy(l,e)}if(!u){u=this.states[l]}if(u){i.push(u)}}var c=i[a-1];var f=!!(c&&c.hoverLayer||r);if(f){this._toggleHoverLayerFlag(true)}var h=this._mergeStates(i);var p=this.stateTransition;this.saveCurrentToNormalState(h);this._applyStateObj(e.join(","),h,this._normalState,false,!t&&!this.__inHover&&p&&p.duration>0,p);var v=this._textContent;var d=this._textGuide;if(v){v.useStates(e,t,f)}if(d){d.useStates(e,t,f)}this._updateAnimationTargets();this.currentStates=e.slice();this.markRedraw();if(!f&&this.__inHover){this._toggleHoverLayerFlag(false);this.__dirty&=~er}}};r.prototype._updateAnimationTargets=function(){for(var e=0;e<this.animators.length;e++){var t=this.animators[e];if(t.targetName){t.changeTarget(this[t.targetName])}}};r.prototype.removeState=function(e){var t=D(this.currentStates,e);if(t>=0){var r=this.currentStates.slice();r.splice(t,1);this.useStates(r)}};r.prototype.replaceState=function(e,t,r){var i=this.currentStates.slice();var n=D(i,e);var a=D(i,t)>=0;if(n>=0){if(!a){i[n]=t}else{i.splice(n,1)}}else if(r&&!a){i.push(t)}this.useStates(i)};r.prototype.toggleState=function(e,t){if(t){this.useState(e,true)}else{this.removeState(e)}};r.prototype._mergeStates=function(e){var t={};var r;for(var i=0;i<e.length;i++){var n=e[i];F(t,n);if(n.textConfig){r=r||{};F(r,n.textConfig)}}if(r){t.textConfig=r}return t};r.prototype._applyStateObj=function(e,t,r,i,n,a){var o=!(t&&i);if(t&&t.textConfig){this.textConfig=F({},i?this.textConfig:r.textConfig);F(this.textConfig,t.textConfig)}else if(o){if(r.textConfig){this.textConfig=r.textConfig}}var s={};var l=false;for(var u=0;u<_n.length;u++){var c=_n[u];var f=n&&bn[c];if(t&&t[c]!=null){if(f){l=true;s[c]=t[c]}else{this[c]=t[c]}}else if(o){if(r[c]!=null){if(f){l=true;s[c]=r[c]}else{this[c]=r[c]}}}}if(!n){for(var u=0;u<this.animators.length;u++){var h=this.animators[u];var p=h.targetName;h.__changeFinalValue(p?(t||r)[p]:t||r)}}if(l){this._transitionState(e,s,a)}};r.prototype._attachComponent=function(e){if(e.__zr&&!e.__hostTarget){throw new Error("Text element has been added to zrender.")}if(e===this){throw new Error("Recursive component attachment.")}var t=this.__zr;if(t){e.addSelfToZr(t)}e.__zr=t;e.__hostTarget=this};r.prototype._detachComponent=function(e){if(e.__zr){e.removeSelfFromZr(e.__zr)}e.__zr=null;e.__hostTarget=null};r.prototype.getClipPath=function(){return this._clipPath};r.prototype.setClipPath=function(e){if(this._clipPath&&this._clipPath!==e){this.removeClipPath()}this._attachComponent(e);this._clipPath=e;this.markRedraw()};r.prototype.removeClipPath=function(){var e=this._clipPath;if(e){this._detachComponent(e);this._clipPath=null;this.markRedraw()}};r.prototype.getTextContent=function(){return this._textContent};r.prototype.setTextContent=function(e){var t=this._textContent;if(t===e){return}if(t&&t!==e){this.removeTextContent()}if(e.__zr&&!e.__hostTarget){throw new Error("Text element has been added to zrender.")}e.attachedTransform=new qi;this._attachComponent(e);this._textContent=e;this.markRedraw()};r.prototype.setTextConfig=function(e){if(!this.textConfig){this.textConfig={}}F(this.textConfig,e);this.markRedraw()};r.prototype.removeTextConfig=function(){this.textConfig=null;this.markRedraw()};r.prototype.removeTextContent=function(){var e=this._textContent;if(e){e.attachedTransform=null;this._detachComponent(e);this._textContent=null;this._innerTextDefaultStyle=null;this.markRedraw()}};r.prototype.getTextGuideLine=function(){return this._textGuide};r.prototype.setTextGuideLine=function(e){if(this._textGuide&&this._textGuide!==e){this.removeTextGuideLine()}this._attachComponent(e);this._textGuide=e;this.markRedraw()};r.prototype.removeTextGuideLine=function(){var e=this._textGuide;if(e){this._detachComponent(e);this._textGuide=null;this.markRedraw()}};r.prototype.markRedraw=function(){this.__dirty|=er;var e=this.__zr;if(e){if(this.__inHover){e.refreshHover()}else{e.refresh()}}if(this.__hostTarget){this.__hostTarget.markRedraw()}};r.prototype.dirty=function(){this.markRedraw()};r.prototype._toggleHoverLayerFlag=function(e){this.__inHover=e;var t=this._textContent;var r=this._textGuide;if(t){t.__inHover=e}if(r){r.__inHover=e}};r.prototype.addSelfToZr=function(e){this.__zr=e;var t=this.animators;if(t){for(var r=0;r<t.length;r++){e.animation.addAnimator(t[r])}}if(this._clipPath){this._clipPath.addSelfToZr(e)}if(this._textContent){this._textContent.addSelfToZr(e)}if(this._textGuide){this._textGuide.addSelfToZr(e)}};r.prototype.removeSelfFromZr=function(e){this.__zr=null;var t=this.animators;if(t){for(var r=0;r<t.length;r++){e.animation.removeAnimator(t[r])}}if(this._clipPath){this._clipPath.removeSelfFromZr(e)}if(this._textContent){this._textContent.removeSelfFromZr(e)}if(this._textGuide){this._textGuide.removeSelfFromZr(e)}};r.prototype.animate=function(e,t){var r=e?this[e]:this;if(!r){re('Property "'+e+'" is not existed in element '+this.id);return}var i=new ai(r,t);this.addAnimator(i,e);return i};r.prototype.addAnimator=function(r,e){var t=this.__zr;var i=this;r.during(function(){i.updateDuringAnimation(e)}).done(function(){var e=i.animators;var t=D(e,r);if(t>=0){e.splice(t,1)}});this.animators.push(r);if(t){t.animation.addAnimator(r)}t&&t.wakeUp()};r.prototype.updateDuringAnimation=function(e){this.markRedraw()};r.prototype.stopAnimation=function(e,t){var r=this.animators;var i=r.length;var n=[];for(var a=0;a<i;a++){var o=r[a];if(!e||e===o.scope){o.stop(t)}else{n.push(o)}}this.animators=n;return this};r.prototype.animateTo=function(e,t,r){In(this,e,t,r)};r.prototype.animateFrom=function(e,t,r){In(this,e,t,r,true)};r.prototype._transitionState=function(e,t,r,i){var n=In(this,t,r,i);for(var a=0;a<n.length;a++){n[a].__fromStateTransition=e}};r.prototype.getBoundingRect=function(){return null};r.prototype.getPaintRect=function(){return null};r.initDefaultProps=function(){var e=r.prototype;e.type="element";e.name="";e.ignore=false;e.silent=false;e.isGroup=false;e.draggable=false;e.dragging=false;e.ignoreClip=false;e.__inHover=false;e.__dirty=er;var i={};function o(e,t,r){if(!i[e+t+r]){console.warn("DEPRECATED: '"+e+"' has been deprecated. use '"+t+"', '"+r+"' instead");i[e+t+r]=true}}function t(t,r,i,n){Object.defineProperty(e,t,{get:function(){o(t,i,n);if(!this[r]){var e=this[r]=[];a(this,e)}return this[r]},set:function(e){o(t,i,n);this[i]=e[0];this[n]=e[1];this[r]=e;a(this,e)}});function a(t,e){Object.defineProperty(e,0,{get:function(){return t[i]},set:function(e){t[i]=e}});Object.defineProperty(e,1,{get:function(){return t[n]},set:function(e){t[n]=e}})}}if(Object.defineProperty&&(!S.browser.ie||S.browser.version>8)){t("position","_legacyPos","x","y");t("scale","_legacyScale","scaleX","scaleY");t("origin","_legacyOrigin","originX","originY")}}();return r}();oe(Mn,lt);oe(Mn,qi);function In(e,t,r,i,n){r=r||{};var a=[];An(e,"",e,t,r,i,a,n);var o=a.length;var s=false;var l=r.done;var u=r.aborted;var c=function(){s=true;o--;if(o<=0){s?l&&l():u&&u()}};var f=function(){o--;if(o<=0){s?l&&l():u&&u()}};if(!o){l&&l()}if(a.length>0&&r.during){a[0].during(function(e,t){r.during(t)})}for(var h=0;h<a.length;h++){var p=a[h];if(c){p.done(c)}if(f){p.aborted(f)}p.start(r.easing,r.force)}return a}function Cn(e,t,r){for(var i=0;i<r;i++){e[i]=t[i]}}function Tn(e){return se(e[0])}function Dn(e,t,r){if(se(t[r])){if(!se(e[r])){e[r]=[]}if(de(t[r])){var i=t[r].length;if(e[r].length!==i){e[r]=new t[r].constructor(i);Cn(e[r],t[r],i)}}else{var n=t[r];var a=e[r];var o=n.length;if(Tn(n)){var s=n[0].length;for(var l=0;l<o;l++){if(!a[l]){a[l]=Array.prototype.slice.call(n[l])}else{Cn(a[l],n[l],s)}}}else{Cn(a,n,o)}a.length=n.length}}else{e[r]=t[r]}}function An(e,t,r,i,n,a,o,s){var l=[];var u=[];var c=L(i);var f=n.duration;var h=n.delay;var p=n.additive;var v=n.setToFinal;var d=!O(a);for(var g=0;g<c.length;g++){var y=c[g];if(r[y]!=null&&i[y]!=null&&(d||a[y])){if(O(i[y])&&!se(i[y])){if(t){if(!s){r[y]=i[y];e.updateDuringAnimation(t)}continue}An(e,y,r[y],i[y],n,a&&a[y],o,s)}else{l.push(y);u.push(y)}}else if(!s){r[y]=i[y];e.updateDuringAnimation(t);u.push(y)}}var m=l.length;if(m>0||n.force&&!o.length){var x=e.animators;var _=[];for(var b=0;b<x.length;b++){if(x[b].targetName===t){_.push(x[b])}}if(!p&&_.length){for(var b=0;b<_.length;b++){var w=_[b].stopTracks(u);if(w){var S=D(x,_[b]);x.splice(S,1)}}}var M=void 0;var I=void 0;var C=void 0;if(s){I={};if(v){M={}}for(var b=0;b<m;b++){var y=l[b];I[y]=r[y];if(v){M[y]=i[y]}else{r[y]=i[y]}}}else if(v){C={};for(var b=0;b<m;b++){var y=l[b];C[y]=ei(r[y]);Dn(r,i,y)}}var T=new ai(r,false,p?_:null);T.targetName=t;if(n.scope){T.scope=n.scope}if(v&&M){T.whenWithKeys(0,M,l)}if(C){T.whenWithKeys(0,C,l)}T.whenWithKeys(f==null?500:f,s?I:i,l).delay(h||0);e.addAnimator(T,t);o.push(T)}}var H=function(i){d(e,i);function e(e){var t=i.call(this)||this;t.isGroup=true;t._children=[];t.attr(e);return t}e.prototype.childrenRef=function(){return this._children};e.prototype.children=function(){return this._children.slice()};e.prototype.childAt=function(e){return this._children[e]};e.prototype.childOfName=function(e){var t=this._children;for(var r=0;r<t.length;r++){if(t[r].name===e){return t[r]}}};e.prototype.childCount=function(){return this._children.length};e.prototype.add=function(e){if(e){if(e!==this&&e.parent!==this){this._children.push(e);this._doAdd(e)}if(e.__hostTarget){throw"This elemenet has been used as an attachment"}}return this};e.prototype.addBefore=function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var r=this._children;var i=r.indexOf(t);if(i>=0){r.splice(i,0,e);this._doAdd(e)}}return this};e.prototype.replaceAt=function(e,t){var r=this._children;var i=r[t];if(e&&e!==this&&e.parent!==this&&e!==i){r[t]=e;i.parent=null;var n=this.__zr;if(n){i.removeSelfFromZr(n)}this._doAdd(e)}return this};e.prototype._doAdd=function(e){if(e.parent){e.parent.remove(e)}e.parent=this;var t=this.__zr;if(t&&t!==e.__zr){e.addSelfToZr(t)}t&&t.refresh()};e.prototype.remove=function(e){var t=this.__zr;var r=this._children;var i=D(r,e);if(i<0){return this}r.splice(i,1);e.parent=null;if(t){e.removeSelfFromZr(t)}t&&t.refresh();return this};e.prototype.removeAll=function(){var e=this._children;var t=this.__zr;for(var r=0;r<e.length;r++){var i=e[r];if(t){i.removeSelfFromZr(t)}i.parent=null}e.length=0;return this};e.prototype.eachChild=function(e,t){var r=this._children;for(var i=0;i<r.length;i++){var n=r[i];e.call(t,n,i)}return this};e.prototype.traverse=function(e,t){for(var r=0;r<this._children.length;r++){var i=this._children[r];var n=e.call(t,i);if(i.isGroup&&!n){i.traverse(e,t)}}return this};e.prototype.addSelfToZr=function(e){i.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++){var r=this._children[t];r.addSelfToZr(e)}};e.prototype.removeSelfFromZr=function(e){i.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++){var r=this._children[t];r.removeSelfFromZr(e)}};e.prototype.getBoundingRect=function(e){var t=new B(0,0,0,0);var r=e||this._children;var i=[];var n=null;for(var a=0;a<r.length;a++){var o=r[a];if(o.ignore||o.invisible){continue}var s=o.getBoundingRect();var l=o.getLocalTransform(i);if(l){B.applyTransform(t,s,l);n=n||t.clone();n.union(t)}else{n=n||s.clone();n.union(s)}}return n||t};return e}(Mn);H.prototype.type="group";var Ln=!S.canvasSupported;var kn={};var Pn={};function On(e){delete Pn[e]}function Nn(e){if(!e){return false}if(typeof e==="string"){return Vr(e,1)<Di}else if(e.colorStops){var t=e.colorStops;var r=0;var i=t.length;for(var n=0;n<i;n++){r+=Vr(t[n].color,1)}r/=i;return r<Di}return false}var En=function(){function e(e,t,r){var i=this;this._sleepAfterStill=10;this._stillFrameAccum=0;this._needsRefresh=true;this._needsRefreshHover=true;this._darkMode=false;r=r||{};this.dom=t;this.id=e;var n=new or;var a=r.renderer||"canvas";if(Ln){throw new Error("IE8 support has been dropped since 5.0")}if(!kn[a]){a=L(kn)[0]}if(!kn[a]){throw new Error("Renderer '"+a+"' is not imported. Please import it first.")}r.useDirtyRect=r.useDirtyRect==null?false:r.useDirtyRect;var o=new kn[a](t,n,r,e);this.storage=n;this.painter=o;var s=!S.node&&!S.worker?new Ii(o.getViewportRoot(),o.root):null;this.handler=new Ft(n,o,s,o.root);this.animation=new oi({stage:{update:function(){return i._flush(true)}}});this.animation.start()}e.prototype.add=function(e){if(!e){return}this.storage.addRoot(e);e.addSelfToZr(this);this.refresh()};e.prototype.remove=function(e){if(!e){return}this.storage.delRoot(e);e.removeSelfFromZr(this);this.refresh()};e.prototype.configLayer=function(e,t){if(this.painter.configLayer){this.painter.configLayer(e,t)}this.refresh()};e.prototype.setBackgroundColor=function(e){if(this.painter.setBackgroundColor){this.painter.setBackgroundColor(e)}this.refresh();this._backgroundColor=e;this._darkMode=Nn(e)};e.prototype.getBackgroundColor=function(){return this._backgroundColor};e.prototype.setDarkMode=function(e){this._darkMode=e};e.prototype.isDarkMode=function(){return this._darkMode};e.prototype.refreshImmediately=function(e){if(!e){this.animation.update(true)}this._needsRefresh=false;this.painter.refresh();this._needsRefresh=false};e.prototype.refresh=function(){this._needsRefresh=true;this.animation.start()};e.prototype.flush=function(){this._flush(false)};e.prototype._flush=function(e){var t;var r=(new Date).getTime();if(this._needsRefresh){t=true;this.refreshImmediately(e)}if(this._needsRefreshHover){t=true;this.refreshHoverImmediately()}var i=(new Date).getTime();if(t){this._stillFrameAccum=0;this.trigger("rendered",{elapsedTime:i-r})}else if(this._sleepAfterStill>0){this._stillFrameAccum++;if(this._stillFrameAccum>this._sleepAfterStill){this.animation.stop()}}};e.prototype.setSleepAfterStill=function(e){this._sleepAfterStill=e};e.prototype.wakeUp=function(){this.animation.start();this._stillFrameAccum=0};e.prototype.addHover=function(e){};e.prototype.removeHover=function(e){};e.prototype.clearHover=function(){};e.prototype.refreshHover=function(){this._needsRefreshHover=true};e.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=false;if(this.painter.refreshHover&&this.painter.getType()==="canvas"){this.painter.refreshHover()}};e.prototype.resize=function(e){e=e||{};this.painter.resize(e.width,e.height);this.handler.resize()};e.prototype.clearAnimation=function(){this.animation.clear()};e.prototype.getWidth=function(){return this.painter.getWidth()};e.prototype.getHeight=function(){return this.painter.getHeight()};e.prototype.pathToImage=function(e,t){if(this.painter.pathToImage){return this.painter.pathToImage(e,t)}};e.prototype.setCursorStyle=function(e){this.handler.setCursorStyle(e)};e.prototype.findHover=function(e,t){return this.handler.findHover(e,t)};e.prototype.on=function(e,t,r){this.handler.on(e,t,r);return this};e.prototype.off=function(e,t){this.handler.off(e,t)};e.prototype.trigger=function(e,t){this.handler.trigger(e,t)};e.prototype.clear=function(){var e=this.storage.getRoots();for(var t=0;t<e.length;t++){if(e[t]instanceof H){e[t].removeSelfFromZr(this)}}this.storage.delAllRoots();this.painter.clear()};e.prototype.dispose=function(){this.animation.stop();this.clear();this.storage.dispose();this.painter.dispose();this.handler.dispose();this.animation=this.storage=this.painter=this.handler=null;On(this.id)};return e}();function Rn(e,t){var r=new En(te(),e,t);Pn[r.id]=r;return r}function zn(e){e.dispose()}function Bn(){for(var e in Pn){if(Pn.hasOwnProperty(e)){Pn[e].dispose()}}Pn={}}function Vn(e){return Pn[e]}function Gn(e,t){kn[e]=t}var Fn="5.1.1";var Hn=Object.freeze({__proto__:null,init:Rn,dispose:zn,disposeAll:Bn,getInstance:Vn,registerPainter:Gn,version:Fn});var Wn=1e-4;var jn=20;function Un(e){return e.replace(/^\s+|\s+$/g,"")}function V(e,t,r,i){var n=t[0];var a=t[1];var o=r[0];var s=r[1];var l=a-n;var u=s-o;if(l===0){return u===0?o:(o+s)/2}if(i){if(l>0){if(e<=n){return o}else if(e>=a){return s}}else{if(e>=n){return o}else if(e<=a){return s}}}else{if(e===n){return o}if(e===a){return s}}return(e-n)/l*u+o}function Y(e,t){switch(e){case"center":case"middle":e="50%";break;case"left":case"top":e="0%";break;case"right":case"bottom":e="100%";break}if(typeof e==="string"){if(Un(e).match(/%$/)){return parseFloat(e)/100*t}return parseFloat(e)}return e==null?NaN:+e}function Zn(e,t,r){if(t==null){t=10}t=Math.min(Math.max(0,t),jn);e=(+e).toFixed(t);return r?e:+e}function Yn(e){e.sort(function(e,t){return e-t});return e}function Xn(e){e=+e;if(isNaN(e)){return 0}if(e>1e-14){var t=1;for(var r=0;r<15;r++,t*=10){if(Math.round(e*t)/t===e){return r}}}return qn(e)}function qn(e){var t=e.toString().toLowerCase();var r=t.indexOf("e");var i=r>0?+t.slice(r+1):0;var n=r>0?r:t.length;var a=t.indexOf(".");var o=a<0?0:n-1-a;return Math.max(0,o-i)}function Jn(e,t){var r=Math.log;var i=Math.LN10;var n=Math.floor(r(e[1]-e[0])/i);var a=Math.round(r(Math.abs(t[1]-t[0]))/i);var o=Math.min(Math.max(-n+a,0),20);return!isFinite(o)?20:o}function Kn(e,t,r){if(!e[t]){return 0}var i=le(e,function(e,t){return e+(isNaN(t)?0:t)},0);if(i===0){return 0}var n=Math.pow(10,r);var a=A(e,function(e){return(isNaN(e)?0:e)/i*n*100});var o=n*100;var s=A(a,function(e){return Math.floor(e)});var l=le(s,function(e,t){return e+t},0);var u=A(a,function(e,t){return e-s[t]});while(l<o){var c=Number.NEGATIVE_INFINITY;var f=null;for(var h=0,p=u.length;h<p;++h){if(u[h]>c){c=u[h];f=h}}++s[f];u[f]=0;++l}return s[t]/n}function Qn(e,t){var r=Math.max(Xn(e),Xn(t));var i=e+t;return r>jn?i:Zn(i,r)}var $n=9007199254740991;function ea(e){var t=Math.PI*2;return(e%t+t)%t}function ta(e){return e>-Wn&&e<Wn}var ra=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function ia(e){if(e instanceof Date){return e}else if(typeof e==="string"){var t=ra.exec(e);if(!t){return new Date(NaN)}if(!t[8]){return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,+t[7]||0)}else{var r=+t[4]||0;if(t[8].toUpperCase()!=="Z"){r-=+t[8].slice(0,3)}return new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,r,+(t[5]||0),+t[6]||0,+t[7]||0))}}else if(e==null){return new Date(NaN)}return new Date(Math.round(e))}function na(e){return Math.pow(10,aa(e))}function aa(e){if(e===0){return 0}var t=Math.floor(Math.log(e)/Math.LN10);if(e/Math.pow(10,t)>=10){t++}return t}function oa(e,t){var r=aa(e);var i=Math.pow(10,r);var n=e/i;var a;if(t){if(n<1.5){a=1}else if(n<2.5){a=2}else if(n<4){a=3}else if(n<7){a=5}else{a=10}}else{if(n<1){a=1}else if(n<2){a=2}else if(n<3){a=3}else if(n<5){a=5}else{a=10}}e=a*i;return r>=-20?+e.toFixed(r<0?-r:0):e}function sa(e,t){var r=(e.length-1)*t+1;var i=Math.floor(r);var n=+e[i-1];var a=r-i;return a?n+a*(e[i]-n):n}function la(e){e.sort(function(e,t){return s(e,t,0)?-1:1});var t=-Infinity;var r=1;for(var i=0;i<e.length;){var n=e[i].interval;var a=e[i].close;for(var o=0;o<2;o++){if(n[o]<=t){n[o]=t;a[o]=!o?1-r:1}t=n[o];r=a[o]}if(n[0]===n[1]&&a[0]*a[1]!==1){e.splice(i,1)}else{i++}}return e;function s(e,t,r){return e.interval[r]<t.interval[r]||e.interval[r]===t.interval[r]&&(e.close[r]-t.close[r]===(!r?1:-1)||!r&&s(e,t,1))}}function ua(e){var t=parseFloat(e);return t==e&&(t!==0||typeof e!=="string"||e.indexOf("x")<=0)?t:NaN}function ca(e){return!isNaN(ua(e))}function fa(){return Math.round(Math.random()*9)}function ha(e,t){if(t===0){return e}return ha(t,e%t)}function pa(e,t){if(e==null){return t}if(t==null){return e}return e*t/ha(e,t)}var va="[ECharts] ";var da={};var ga=typeof console!=="undefined"&&console.warn&&console.log;function ya(e){if(ga){console.warn(va+e)}}function ma(e){if(ga){console.error(va+e)}}function xa(e){if("development"!=="production"){if(da[e]){return}if(ga){da[e]=true;console.warn(va+"DEPRECATED: "+e)}}}function _a(e,t,r){if("development"!=="production"){xa((r?"["+r+"]":"")+(e+" is deprecated, use "+t+" instead."))}}function ba(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if("development"!=="production"){if(typeof console!=="undefined"&&console.log){console.log.apply(console,e)}}}function wa(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="";if("development"!=="production"){var i=function(e){return e===void 0?"undefined":e===Infinity?"Infinity":e===-Infinity?"-Infinity":_e(e)?"NaN":e instanceof Date?"Date("+e.toISOString()+")":b(e)?"function () { ... }":xe(e)?e+"":null};r=A(e,function(e){if(P(e)){return e}else{var t=i(e);if(t!=null){return t}else if(typeof JSON!=="undefined"&&JSON.stringify){try{return JSON.stringify(e,function(e,t){var r=i(t);return r==null?t:r})}catch(e){return"?"}}else{return"?"}}}).join(" ")}return r}function g(e){throw new Error(e)}var Sa="series\0";var Ma="\0_ec_\0";function Ia(e){return e instanceof Array?e:e==null?[]:[e]}function Ca(e,t,r){if(e){e[t]=e[t]||{};e.emphasis=e.emphasis||{};e.emphasis[t]=e.emphasis[t]||{};for(var i=0,n=r.length;i<n;i++){var a=r[i];if(!e.emphasis[t].hasOwnProperty(a)&&e[t].hasOwnProperty(a)){e.emphasis[t][a]=e[t][a]}}}}var Ta=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function Da(e){return O(e)&&!k(e)&&!(e instanceof Date)?e.value:e}function Aa(e){return O(e)&&!(e instanceof Array)}function La(e,r,t){var i=t==="normalMerge";var n=t==="replaceMerge";var a=t==="replaceAll";e=e||[];r=(r||[]).slice();var o=I();U(r,function(e,t){if(!O(e)){r[t]=null;return}if("development"!=="production"){if(e.id!=null&&!Fa(e.id)){Ga(e.id)}if(e.name!=null&&!Fa(e.name)){Ga(e.name)}}});var s=ka(e,o,t);if(i||n){Pa(s,e,o,r)}if(i){Oa(s,r)}if(i||n){Na(s,r,n)}else if(a){Ea(s,r)}Ra(s);return s}function ka(e,t,r){var i=[];if(r==="replaceAll"){return i}for(var n=0;n<e.length;n++){var a=e[n];if(a&&a.id!=null){t.set(a.id,n)}i.push({existing:r==="replaceMerge"||Wa(a)?null:a,newOption:null,keyInfo:null,brandNew:null})}return i}function Pa(a,o,s,l){U(l,function(e,t){if(!e||e.id==null){return}var r=Ba(e.id);var i=s.get(r);if(i!=null){var n=a[i];E(!n.newOption,'Duplicated option on id "'+r+'".');n.newOption=e;n.existing=o[i];l[t]=null}})}function Oa(n,a){U(a,function(e,t){if(!e||e.name==null){return}for(var r=0;r<n.length;r++){var i=n[r].existing;if(!n[r].newOption&&i&&(i.id==null||e.id==null)&&!Wa(e)&&!Wa(i)&&za("name",i,e)){n[r].newOption=e;a[t]=null;return}}})}function Na(i,e,n){U(e,function(e){if(!e){return}var t;var r=0;while((t=i[r])&&(t.newOption||Wa(t.existing)||t.existing&&e.id!=null&&!za("id",e,t.existing))){r++}if(t){t.newOption=e;t.brandNew=n}else{i.push({newOption:e,brandNew:n,existing:null,keyInfo:null})}r++})}function Ea(t,e){U(e,function(e){t.push({newOption:e,brandNew:true,existing:null,keyInfo:null})})}function Ra(e){var o=I();U(e,function(e){var t=e.existing;t&&o.set(t.id,e)});U(e,function(e){var t=e.newOption;E(!t||t.id==null||!o.get(t.id)||o.get(t.id)===e,"id duplicates: "+(t&&t.id));t&&t.id!=null&&o.set(t.id,e);!e.keyInfo&&(e.keyInfo={})});U(e,function(e,t){var r=e.existing;var i=e.newOption;var n=e.keyInfo;if(!O(i)){return}n.name=i.name!=null?Ba(i.name):r?r.name:Sa+t;if(r){n.id=Ba(r.id)}else if(i.id!=null){n.id=Ba(i.id)}else{var a=0;do{n.id="\0"+n.name+"\0"+a++}while(o.get(n.id))}o.set(n.id,e)})}function za(e,t,r){var i=Va(t[e],null);var n=Va(r[e],null);return i!=null&&n!=null&&i===n}function Ba(e){if("development"!=="production"){if(e==null){throw new Error}}return Va(e,"")}function Va(e,t){if(e==null){return t}var r=typeof e;return r==="string"?e:r==="number"||he(e)?e+"":t}function Ga(e){if("development"!=="production"){ya("`"+e+"` is invalid id or name. Must be a string or number.")}}function Fa(e){return he(e)||ca(e)}function Ha(e){var t=e.name;return!!(t&&t.indexOf(Sa))}function Wa(e){return e&&e.id!=null&&Ba(e.id).indexOf(Ma)===0}function ja(e){return Ma+e}function Ua(e,r,i){U(e,function(e){var t=e.newOption;if(O(t)){e.keyInfo.mainType=r;e.keyInfo.subType=Za(r,t,e.existing,i)}})}function Za(e,t,r,i){var n=t.type?t.type:r?r.subType:i.determineSubType(e,t);return n}function Ya(e,t){var r={};var i={};n(e||[],r);n(t||[],i,r);return[a(r),a(i)];function n(e,t,r){for(var i=0,n=e.length;i<n;i++){var a=Va(e[i].seriesId,null);if(a==null){return}var o=Ia(e[i].dataIndex);var s=r&&r[a];for(var l=0,u=o.length;l<u;l++){var c=o[l];if(s&&s[c]){s[c]=null}else{(t[a]||(t[a]={}))[c]=1}}}}function a(e,t){var r=[];for(var i in e){if(e.hasOwnProperty(i)&&e[i]!=null){if(t){r.push(+i)}else{var n=a(e[i],true);n.length&&r.push({seriesId:i,dataIndex:n})}}}return r}}function Xa(t,e){if(e.dataIndexInside!=null){return e.dataIndexInside}else if(e.dataIndex!=null){return k(e.dataIndex)?A(e.dataIndex,function(e){return t.indexOfRawIndex(e)}):t.indexOfRawIndex(e.dataIndex)}else if(e.name!=null){return k(e.name)?A(e.name,function(e){return t.indexOfName(e)}):t.indexOfName(e.name)}}function qa(){var t="__ec_inner_"+Ja++;return function(e){return e[t]||(e[t]={})}}var Ja=fa();function Ka(i,e,n){var t=Qa(e,n),r=t.mainTypeSpecified,a=t.queryOptionMap,o=t.others;var s=o;var l=n?n.defaultMainType:null;if(!r&&l){a.set(l,{})}a.each(function(e,t){var r=to(i,t,e,{useDefault:l===t,enableAll:n&&n.enableAll!=null?n.enableAll:true,enableNone:n&&n.enableNone!=null?n.enableNone:true});s[t+"Models"]=r.models;s[t+"Model"]=r.models[0]});return s}function Qa(e,o){var t;if(P(e)){var r={};r[e+"Index"]=0;t=r}else{t=e}var s=I();var l={};var u=false;U(t,function(e,t){if(t==="dataIndex"||t==="dataIndexInside"){l[t]=e;return}var r=t.match(/^(\w+)(Index|Id|Name)$/)||[];var i=r[1];var n=(r[2]||"").toLowerCase();if(!i||!n||o&&o.includeMainTypes&&D(o.includeMainTypes,i)<0){return}u=u||!!i;var a=s.get(i)||s.set(i,{});a[n]=e});return{mainTypeSpecified:u,queryOptionMap:s,others:l}}var $a={useDefault:true,enableAll:false,enableNone:false};var eo={useDefault:false,enableAll:true,enableNone:true};function to(e,t,r,i){i=i||$a;var n=r.index;var a=r.id;var o=r.name;var s={models:null,specified:n!=null||a!=null||o!=null};if(!s.specified){var l=void 0;s.models=i.useDefault&&(l=e.getComponent(t))?[l]:[];return s}if(n==="none"||n===false){E(i.enableNone,'`"none"` or `false` is not a valid value on index option.');s.models=[];return s}if(n==="all"){E(i.enableAll,'`"all"` is not a valid value on index option.');n=a=o=null}s.models=e.queryComponents({mainType:t,index:n,id:a,name:o});return s}function ro(e,t,r){e.setAttribute?e.setAttribute(t,r):e[t]=r}function io(e,t){return e.getAttribute?e.getAttribute(t):e[t]}function no(e){if(e==="auto"){return S.domSupported?"html":"richText"}else{return e||"html"}}function ao(e,r){var i=I();var n=[];U(e,function(e){var t=r(e);(i.get(t)||(n.push(t),i.set(t,[]))).push(e)});return{keys:n,buckets:i}}function oo(e,t,r,i,n){var a=t==null||t==="auto";if(i==null){return i}if(typeof i==="number"){var o=Wr(r||0,i,n);return Zn(o,a?Math.max(Xn(r||0),Xn(i)):t)}else if(typeof i==="string"){return n<1?r:i}else{var s=[];var l=r;var u=i;var c=Math.max(l?l.length:0,u.length);for(var f=0;f<c;++f){var h=e.getDimensionInfo(f);if(h.type==="ordinal"){s[f]=(n<1&&l?l:u)[f]}else{var p=l&&l[f]?l[f]:0;var v=u[f];var o=Wr(p,v,n);s[f]=Zn(o,a?Math.max(Xn(p),Xn(v)):t)}}return s}}var so=".";var lo="___EC__COMPONENT__CONTAINER___";var uo="___EC__EXTENDED_CLASS___";function co(e){var t={main:"",sub:""};if(e){var r=e.split(so);t.main=r[0]||"";t.sub=r[1]||""}return t}function fo(e){E(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(e),'componentType "'+e+'" illegal')}function ho(e){return!!(e&&e[uo])}function po(e,t){e.$constructor=e;e.extend=function(i){if("development"!=="production"){U(t,function(e){if(!i[e]){console.warn("Method `"+e+"` should be implemented"+(i.type?" in "+i.type:"")+".")}})}var n=this;function a(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(!i.$constructor){if(!vo(n)){n.apply(this,arguments)}else{var r=ke(a.prototype,new(n.bind.apply(n,o([void 0],e))));return r}}else{i.$constructor.apply(this,arguments)}}a[uo]=true;F(a.prototype,i);a.extend=this.extend;a.superCall=xo;a.superApply=_o;ae(a,this);a.superClass=n;return a}}function vo(e){return typeof e==="function"&&/^class\s/.test(Function.prototype.toString.call(e))}function go(e,t){e.extend=t.extend}var yo=Math.round(Math.random()*10);function mo(e){var t=["__\0is_clz",yo++].join("_");e.prototype[t]=true;if("development"!=="production"){E(!e.isInstance,'The method "is" can not be defined.')}e.isInstance=function(e){return!!(e&&e[t])}}function xo(e,t){var r=[];for(var i=2;i<arguments.length;i++){r[i-2]=arguments[i]}return this.superClass.prototype[t].apply(e,r)}function _o(e,t,r){return this.superClass.prototype[t].apply(e,r)}function bo(e){var n={};e.registerClass=function(e){var t=e.type||e.prototype.type;if(t){fo(t);e.prototype.type=t;var r=co(t);if(!r.sub){if("development"!=="production"){if(n[r.main]){console.warn(r.main+" exists.")}}n[r.main]=e}else if(r.sub!==lo){var i=a(r);i[r.sub]=e}}return e};e.getClass=function(e,t,r){var i=n[e];if(i&&i[lo]){i=t?i[t]:null}if(r&&!i){throw new Error(!t?e+"."+"type should be specified.":"Component "+e+"."+(t||"")+" is used but not imported.")}return i};e.getClassesByMainType=function(e){var t=co(e);var r=[];var i=n[t.main];if(i&&i[lo]){U(i,function(e,t){t!==lo&&r.push(e)})}else{r.push(i)}return r};e.hasClass=function(e){var t=co(e);return!!n[t.main]};e.getAllClassMainTypes=function(){var r=[];U(n,function(e,t){r.push(t)});return r};e.hasSubTypes=function(e){var t=co(e);var r=n[t.main];return r&&r[lo]};function a(e){var t=n[e.main];if(!t||!t[lo]){t=n[e.main]={};t[lo]=true}return t}}function wo(s,l){for(var e=0;e<s.length;e++){if(!s[e][1]){s[e][1]=s[e][0]}}l=l||false;return function(e,t,r){var i={};for(var n=0;n<s.length;n++){var a=s[n][1];if(t&&D(t,a)>=0||r&&D(r,a)<0){continue}var o=e.getShallow(a,l);if(o!=null){i[s[n][0]]=o}}return i}}var So=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]];var Mo=wo(So);var Io=function(){function e(){}e.prototype.getAreaStyle=function(e,t){return Mo(this,e,t)};return e}();var Co=new pr(50);function To(e){if(typeof e==="string"){var t=Co.get(e);return t&&t.image}else{return e}}function Do(e,t,r,i,n){if(!e){return t}else if(typeof e==="string"){if(t&&t.__zrImageSrc===e||!r){return t}var a=Co.get(e);var o={hostEl:r,cb:i,cbPayload:n};if(a){t=a.image;!Lo(t)&&a.pending.push(o)}else{t=new Image;t.onload=t.onerror=Ao;Co.put(e,t.__cachedImgObj={image:t,pending:[o]});t.src=t.__zrImageSrc=e}return t}else{return e}}function Ao(){var e=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t];var i=r.cb;i&&i(this,r.cbPayload);r.hostEl.dirty()}e.pending.length=0}function Lo(e){return e&&e.width&&e.height}var ko=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Po(e,t,r,i,n){if(!t){return""}var a=(e+"").split("\n");n=Oo(t,r,i,n);for(var o=0,s=a.length;o<s;o++){a[o]=No(a[o],n)}return a.join("\n")}function Oo(e,t,r,i){i=i||{};var n=F({},i);n.font=t;r=N(r,"...");n.maxIterations=N(i.maxIterations,2);var a=n.minChar=N(i.minChar,0);n.cnCharWidth=fn("",t);var o=n.ascCharWidth=fn("a",t);n.placeholder=N(i.placeholder,"");var s=e=Math.max(0,e-1);for(var l=0;l<a&&s>=o;l++){s-=o}var u=fn(r,t);if(u>s){r="";u=0}s=e-u;n.ellipsis=r;n.ellipsisWidth=u;n.contentWidth=s;n.containerWidth=e;return n}function No(e,t){var r=t.containerWidth;var i=t.font;var n=t.contentWidth;if(!r){return""}var a=fn(e,i);if(a<=r){return e}for(var o=0;;o++){if(a<=n||o>=t.maxIterations){e+=t.ellipsis;break}var s=o===0?Eo(e,n,t.ascCharWidth,t.cnCharWidth):a>0?Math.floor(e.length*n/a):0;e=e.substr(0,s);a=fn(e,i)}if(e===""){e=t.placeholder}return e}function Eo(e,t,r,i){var n=0;var a=0;for(var o=e.length;a<o&&n<t;a++){var s=e.charCodeAt(a);n+=0<=s&&s<=127?r:i}return a}function Ro(e,t){e!=null&&(e+="");var r=t.overflow;var i=t.padding;var n=t.font;var a=r==="truncate";var o=gn(n);var s=N(t.lineHeight,o);var l=t.lineOverflow==="truncate";var u=t.width;var c;if(u!=null&&r==="break"||r==="breakAll"){c=e?Uo(e,t.font,u,r==="breakAll",0).lines:[]}else{c=e?e.split("\n"):[]}var f=c.length*s;var h=N(t.height,f);if(f>h&&l){var p=Math.floor(h/s);c=c.slice(0,p)}var v=h;var d=u;if(i){v+=i[0]+i[2];if(d!=null){d+=i[1]+i[3]}}if(e&&a&&d!=null){var g=Oo(u,n,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder});for(var y=0;y<c.length;y++){c[y]=No(c[y],g)}}if(u==null){var m=0;for(var y=0;y<c.length;y++){m=Math.max(fn(c[y],n),m)}u=m}return{lines:c,height:h,outerHeight:v,lineHeight:s,calculatedLineHeight:o,contentHeight:f,width:u}}var zo=function(){function e(){}return e}();var Bo=function(){function e(e){this.tokens=[];if(e){this.tokens=e}}return e}();var Vo=function(){function e(){this.width=0;this.height=0;this.contentWidth=0;this.contentHeight=0;this.outerWidth=0;this.outerHeight=0;this.lines=[]}return e}();function Go(e,t){var r=new Vo;e!=null&&(e+="");if(!e){return r}var i=t.width;var n=t.height;var a=t.overflow;var o=(a==="break"||a==="breakAll")&&i!=null?{width:i,accumWidth:0,breakAll:a==="breakAll"}:null;var s=ko.lastIndex=0;var l;while((l=ko.exec(e))!=null){var u=l.index;if(u>s){Fo(r,e.substring(s,u),t,o)}Fo(r,l[2],t,o,l[1]);s=ko.lastIndex}if(s<e.length){Fo(r,e.substring(s,e.length),t,o)}var c=[];var f=0;var h=0;var p=t.padding;var v=a==="truncate";var d=t.lineOverflow==="truncate";function g(e,t,r){e.width=t;e.lineHeight=r;f+=r;h=Math.max(h,t)}e:for(var y=0;y<r.lines.length;y++){var m=r.lines[y];var x=0;var _=0;for(var b=0;b<m.tokens.length;b++){var w=m.tokens[b];var S=w.styleName&&t.rich[w.styleName]||{};var M=w.textPadding=S.padding;var I=M?M[1]+M[3]:0;var C=w.font=S.font||t.font;w.contentHeight=gn(C);var T=N(S.height,w.contentHeight);w.innerHeight=T;M&&(T+=M[0]+M[2]);w.height=T;w.lineHeight=we(S.lineHeight,t.lineHeight,T);w.align=S&&S.align||t.align;w.verticalAlign=S&&S.verticalAlign||"middle";if(d&&n!=null&&f+w.lineHeight>n){if(b>0){m.tokens=m.tokens.slice(0,b);g(m,_,x);r.lines=r.lines.slice(0,y+1)}else{r.lines=r.lines.slice(0,y)}break e}var D=S.width;var A=D==null||D==="auto";if(typeof D==="string"&&D.charAt(D.length-1)==="%"){w.percentWidth=D;c.push(w);w.contentWidth=fn(w.text,C)}else{if(A){var L=S.backgroundColor;var k=L&&L.image;if(k){k=To(k);if(Lo(k)){w.width=Math.max(w.width,k.width*T/k.height)}}}var P=v&&i!=null?i-_:null;if(P!=null&&P<w.width){if(!A||P<I){w.text="";w.width=w.contentWidth=0}else{w.text=Po(w.text,P-I,C,t.ellipsis,{minChar:t.truncateMinChar});w.width=w.contentWidth=fn(w.text,C)}}else{w.contentWidth=fn(w.text,C)}}w.width+=I;_+=w.width;S&&(x=Math.max(x,w.lineHeight))}g(m,_,x)}r.outerWidth=r.width=N(i,h);r.outerHeight=r.height=N(n,f);r.contentHeight=f;r.contentWidth=h;if(p){r.outerWidth+=p[1]+p[3];r.outerHeight+=p[0]+p[2]}for(var y=0;y<c.length;y++){var w=c[y];var O=w.percentWidth;w.width=parseInt(O,10)/100*r.width}return r}function Fo(e,t,r,i,n){var a=t==="";var o=n&&r.rich[n]||{};var s=e.lines;var l=o.font||r.font;var u=false;var c;var f;if(i){var h=o.padding;var p=h?h[1]+h[3]:0;if(o.width!=null&&o.width!=="auto"){var v=yn(o.width,i.width)+p;if(s.length>0){if(v+i.accumWidth>i.width){c=t.split("\n");u=true}}i.accumWidth=v}else{var d=Uo(t,l,i.width,i.breakAll,i.accumWidth);i.accumWidth=d.accumWidth+p;f=d.linesWidths;c=d.lines}}else{c=t.split("\n")}for(var g=0;g<c.length;g++){var y=c[g];var m=new zo;m.styleName=n;m.text=y;m.isLineHolder=!y&&!a;if(typeof o.width==="number"){m.width=o.width}else{m.width=f?f[g]:fn(y,l)}if(!g&&!u){var x=(s[s.length-1]||(s[0]=new Bo)).tokens;var _=x.length;_===1&&x[0].isLineHolder?x[0]=m:(y||!_||a)&&x.push(m)}else{s.push(new Bo([m]))}}}function Ho(e){var t=e.charCodeAt(0);return t>=33&&t<=255}var Wo=le(",&?/;] ".split(""),function(e,t){e[t]=true;return e},{});function jo(e){if(Ho(e)){if(Wo[e]){return true}return false}return true}function Uo(e,t,r,i,n){var a=[];var o=[];var s="";var l="";var u=0;var c=0;for(var f=0;f<e.length;f++){var h=e.charAt(f);if(h==="\n"){if(l){s+=l;c+=u}a.push(s);o.push(c);s="";l="";u=0;c=0;continue}var p=fn(h,t);var v=i?false:!jo(h);if(!a.length?n+c+p>r:c+p>r){if(!c){if(v){a.push(l);o.push(u);l=h;u=p}else{a.push(h);o.push(p)}}else if(s||l){if(v){if(!s){s=l;l="";u=0;c=u}a.push(s);o.push(c-u);l+=h;u+=p;s="";c=u}else{if(l){s+=l;c+=u;l="";u=0}a.push(s);o.push(c);s=h;c=p}}continue}c+=p;if(v){l+=h;u+=p}else{if(l){s+=l;l="";u=0}s+=h}}if(!a.length&&!s){s=e;l="";u=0}if(l){s+=l}if(s){a.push(s);o.push(c)}if(a.length===1){c+=n}return{accumWidth:c,lines:a,linesWidths:o}}var Zo="__zr_style_"+Math.round(Math.random()*10);var Yo={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"};var Xo={style:{shadowBlur:true,shadowOffsetX:true,shadowOffsetY:true,shadowColor:true,opacity:true}};Yo[Zo]=true;var qo=["z","z2","invisible"];var Jo=["invisible"];var Ko=function(v){d(t,v);function t(e){return v.call(this,e)||this}t.prototype._init=function(e){var t=L(e);for(var r=0;r<t.length;r++){var i=t[r];if(i==="style"){this.useStyle(e[i])}else{v.prototype.attrKV.call(this,i,e[i])}}if(!this.style){this.useStyle({})}};t.prototype.beforeBrush=function(){};t.prototype.afterBrush=function(){};t.prototype.innerBeforeBrush=function(){};t.prototype.innerAfterBrush=function(){};t.prototype.shouldBePainted=function(e,t,r,i){var n=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&es(this,e,t)||n&&!n[0]&&!n[3]){return false}if(r&&this.__clipPaths){for(var a=0;a<this.__clipPaths.length;++a){if(this.__clipPaths[a].isZeroArea()){return false}}}if(i&&this.parent){var o=this.parent;while(o){if(o.ignore){return false}o=o.parent}}return true};t.prototype.contain=function(e,t){return this.rectContain(e,t)};t.prototype.traverse=function(e,t){e.call(t,this)};t.prototype.rectContain=function(e,t){var r=this.transformCoordToLocal(e,t);var i=this.getBoundingRect();return i.contain(r[0],r[1])};t.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var t=this.transform;var r=this.getBoundingRect();var i=this.style;var n=i.shadowBlur||0;var a=i.shadowOffsetX||0;var o=i.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new B(0,0,0,0));if(t){B.applyTransform(e,r,t)}else{e.copy(r)}if(n||a||o){e.width+=n*2+Math.abs(a);e.height+=n*2+Math.abs(o);e.x=Math.min(e.x,e.x+a-n);e.y=Math.min(e.y,e.y+o-n)}var s=this.dirtyRectTolerance;if(!e.isZero()){e.x=Math.floor(e.x-s);e.y=Math.floor(e.y-s);e.width=Math.ceil(e.width+1+s*2);e.height=Math.ceil(e.height+1+s*2)}}return e};t.prototype.setPrevPaintRect=function(e){if(e){this._prevPaintRect=this._prevPaintRect||new B(0,0,0,0);this._prevPaintRect.copy(e)}else{this._prevPaintRect=null}};t.prototype.getPrevPaintRect=function(){return this._prevPaintRect};t.prototype.animateStyle=function(e){return this.animate("style",e)};t.prototype.updateDuringAnimation=function(e){if(e==="style"){this.dirtyStyle()}else{this.markRedraw()}};t.prototype.attrKV=function(e,t){if(e!=="style"){v.prototype.attrKV.call(this,e,t)}else{if(!this.style){this.useStyle(t)}else{this.setStyle(t)}}};t.prototype.setStyle=function(e,t){if(typeof e==="string"){this.style[e]=t}else{F(this.style,e)}this.dirtyStyle();return this};t.prototype.dirtyStyle=function(e){if(!e){this.markRedraw()}this.__dirty|=tr;if(this._rect){this._rect=null}};t.prototype.dirty=function(){this.dirtyStyle()};t.prototype.styleChanged=function(){return!!(this.__dirty&tr)};t.prototype.styleUpdated=function(){this.__dirty&=~tr};t.prototype.createStyle=function(e){return ke(Yo,e)};t.prototype.useStyle=function(e){if(!e[Zo]){e=this.createStyle(e)}if(this.__inHover){this.__hoverStyle=e}else{this.style=e}this.dirtyStyle()};t.prototype.isStyleObject=function(e){return e[Zo]};t.prototype._innerSaveToNormal=function(e){v.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;if(e.style&&!t.style){t.style=this._mergeStyle(this.createStyle(),this.style)}this._savePrimaryToNormal(e,t,qo)};t.prototype._applyStateObj=function(e,t,r,i,n,a){v.prototype._applyStateObj.call(this,e,t,r,i,n,a);var o=!(t&&i);var s;if(t&&t.style){if(n){if(i){s=t.style}else{s=this._mergeStyle(this.createStyle(),r.style);this._mergeStyle(s,t.style)}}else{s=this._mergeStyle(this.createStyle(),i?this.style:r.style);this._mergeStyle(s,t.style)}}else if(o){s=r.style}if(s){if(n){var l=this.style;this.style=this.createStyle(o?{}:l);if(o){var u=L(l);for(var c=0;c<u.length;c++){var f=u[c];if(f in s){s[f]=s[f];this.style[f]=l[f]}}}var h=L(s);for(var c=0;c<h.length;c++){var f=h[c];this.style[f]=this.style[f]}this._transitionState(e,{style:s},a,this.getAnimationStyleProps())}else{this.useStyle(s)}}var p=this.__inHover?Jo:qo;for(var c=0;c<p.length;c++){var f=p[c];if(t&&t[f]!=null){this[f]=t[f]}else if(o){if(r[f]!=null){this[f]=r[f]}}}};t.prototype._mergeStates=function(e){var t=v.prototype._mergeStates.call(this,e);var r;for(var i=0;i<e.length;i++){var n=e[i];if(n.style){r=r||{};this._mergeStyle(r,n.style)}}if(r){t.style=r}return t};t.prototype._mergeStyle=function(e,t){F(e,t);return e};t.prototype.getAnimationStyleProps=function(){return Xo};t.initDefaultProps=function(){var e=t.prototype;e.type="displayable";e.invisible=false;e.z=0;e.z2=0;e.zlevel=0;e.culling=false;e.cursor="pointer";e.rectHover=false;e.incremental=false;e._rect=null;e.dirtyRectTolerance=0;e.__dirty=er|tr}();return t}(Mn);var Qo=new B(0,0,0,0);var $o=new B(0,0,0,0);function es(e,t,r){Qo.copy(e.getBoundingRect());if(e.transform){Qo.applyTransform(e.transform)}$o.width=t;$o.height=r;return!Qo.intersect($o)}var ts=Math.pow;var rs=Math.sqrt;var is=1e-8;var ns=1e-4;var as=rs(3);var os=1/3;var ss=Ne();var ls=Ne();var us=Ne();function cs(e){return e>-is&&e<is}function fs(e){return e>is||e<-is}function hs(e,t,r,i,n){var a=1-n;return a*a*(a*e+3*n*t)+n*n*(n*i+3*a*r)}function ps(e,t,r,i,n){var a=1-n;return 3*(((t-e)*a+2*(r-t)*n)*a+(i-r)*n*n)}function vs(e,t,r,i,n,a){var o=i+3*(t-r)-e;var s=3*(r-t*2+e);var l=3*(t-e);var u=e-n;var c=s*s-3*o*l;var f=s*l-9*o*u;var h=l*l-3*s*u;var p=0;if(cs(c)&&cs(f)){if(cs(s)){a[0]=0}else{var v=-l/s;if(v>=0&&v<=1){a[p++]=v}}}else{var d=f*f-4*c*h;if(cs(d)){var g=f/c;var v=-s/o+g;var y=-g/2;if(v>=0&&v<=1){a[p++]=v}if(y>=0&&y<=1){a[p++]=y}}else if(d>0){var m=rs(d);var x=c*s+1.5*o*(-f+m);var _=c*s+1.5*o*(-f-m);if(x<0){x=-ts(-x,os)}else{x=ts(x,os)}if(_<0){_=-ts(-_,os)}else{_=ts(_,os)}var v=(-s-(x+_))/(3*o);if(v>=0&&v<=1){a[p++]=v}}else{var b=(2*c*s-3*o*f)/(2*rs(c*c*c));var w=Math.acos(b)/3;var S=rs(c);var M=Math.cos(w);var v=(-s-2*S*M)/(3*o);var y=(-s+S*(M+as*Math.sin(w)))/(3*o);var I=(-s+S*(M-as*Math.sin(w)))/(3*o);if(v>=0&&v<=1){a[p++]=v}if(y>=0&&y<=1){a[p++]=y}if(I>=0&&I<=1){a[p++]=I}}}return p}function ds(e,t,r,i,n){var a=6*r-12*t+6*e;var o=9*t+3*i-3*e-9*r;var s=3*t-3*e;var l=0;if(cs(o)){if(fs(a)){var u=-s/a;if(u>=0&&u<=1){n[l++]=u}}}else{var c=a*a-4*o*s;if(cs(c)){n[0]=-a/(2*o)}else if(c>0){var f=rs(c);var u=(-a+f)/(2*o);var h=(-a-f)/(2*o);if(u>=0&&u<=1){n[l++]=u}if(h>=0&&h<=1){n[l++]=h}}}return l}function gs(e,t,r,i,n,a){var o=(t-e)*n+e;var s=(r-t)*n+t;var l=(i-r)*n+r;var u=(s-o)*n+o;var c=(l-s)*n+s;var f=(c-u)*n+u;a[0]=e;a[1]=o;a[2]=u;a[3]=f;a[4]=f;a[5]=c;a[6]=l;a[7]=i}function ys(e,t,r,i,n,a,o,s,l,u,c){var f;var h=.005;var p=Infinity;var v;var d;var g;var y;ss[0]=l;ss[1]=u;for(var m=0;m<1;m+=.05){ls[0]=hs(e,r,n,o,m);ls[1]=hs(t,i,a,s,m);g=$e(ss,ls);if(g<p){f=m;p=g}}p=Infinity;for(var x=0;x<32;x++){if(h<ns){break}v=f-h;d=f+h;ls[0]=hs(e,r,n,o,v);ls[1]=hs(t,i,a,s,v);g=$e(ls,ss);if(v>=0&&g<p){f=v;p=g}else{us[0]=hs(e,r,n,o,d);us[1]=hs(t,i,a,s,d);y=$e(us,ss);if(d<=1&&y<p){f=d;p=y}else{h*=.5}}}if(c){c[0]=hs(e,r,n,o,f);c[1]=hs(t,i,a,s,f)}return rs(p)}function ms(e,t,r,i,n,a,o,s,l){var u=e;var c=t;var f=0;var h=1/l;for(var p=1;p<=l;p++){var v=p*h;var d=hs(e,r,n,o,v);var g=hs(t,i,a,s,v);var y=d-u;var m=g-c;f+=Math.sqrt(y*y+m*m);u=d;c=g}return f}function xs(e,t,r,i){var n=1-i;return n*(n*e+2*i*t)+i*i*r}function _s(e,t,r,i){return 2*((1-i)*(t-e)+i*(r-t))}function bs(e,t,r,i,n){var a=e-2*t+r;var o=2*(t-e);var s=e-i;var l=0;if(cs(a)){if(fs(o)){var u=-s/o;if(u>=0&&u<=1){n[l++]=u}}}else{var c=o*o-4*a*s;if(cs(c)){var u=-o/(2*a);if(u>=0&&u<=1){n[l++]=u}}else if(c>0){var f=rs(c);var u=(-o+f)/(2*a);var h=(-o-f)/(2*a);if(u>=0&&u<=1){n[l++]=u}if(h>=0&&h<=1){n[l++]=h}}}return l}function ws(e,t,r){var i=e+r-2*t;if(i===0){return.5}else{return(e-t)/i}}function Ss(e,t,r,i,n){var a=(t-e)*i+e;var o=(r-t)*i+t;var s=(o-a)*i+a;n[0]=e;n[1]=a;n[2]=s;n[3]=s;n[4]=o;n[5]=r}function Ms(e,t,r,i,n,a,o,s,l){var u;var c=.005;var f=Infinity;ss[0]=o;ss[1]=s;for(var h=0;h<1;h+=.05){ls[0]=xs(e,r,n,h);ls[1]=xs(t,i,a,h);var p=$e(ss,ls);if(p<f){u=h;f=p}}f=Infinity;for(var v=0;v<32;v++){if(c<ns){break}var d=u-c;var g=u+c;ls[0]=xs(e,r,n,d);ls[1]=xs(t,i,a,d);var p=$e(ls,ss);if(d>=0&&p<f){u=d;f=p}else{us[0]=xs(e,r,n,g);us[1]=xs(t,i,a,g);var y=$e(us,ss);if(g<=1&&y<f){u=g;f=y}else{c*=.5}}}if(l){l[0]=xs(e,r,n,u);l[1]=xs(t,i,a,u)}return rs(f)}function Is(e,t,r,i,n,a,o){var s=e;var l=t;var u=0;var c=1/o;for(var f=1;f<=o;f++){var h=f*c;var p=xs(e,r,n,h);var v=xs(t,i,a,h);var d=p-s;var g=v-l;u+=Math.sqrt(d*d+g*g);s=p;l=v}return u}var Cs=Math.min;var Ts=Math.max;var Ds=Math.sin;var As=Math.cos;var Ls=Math.PI*2;var ks=Ne();var Ps=Ne();var Os=Ne();function Ns(e,t,r){if(e.length===0){return}var i=e[0];var n=i[0];var a=i[0];var o=i[1];var s=i[1];for(var l=1;l<e.length;l++){i=e[l];n=Cs(n,i[0]);a=Ts(a,i[0]);o=Cs(o,i[1]);s=Ts(s,i[1])}t[0]=n;t[1]=o;r[0]=a;r[1]=s}function Es(e,t,r,i,n,a){n[0]=Cs(e,r);n[1]=Cs(t,i);a[0]=Ts(e,r);a[1]=Ts(t,i)}var Rs=[];var zs=[];function Bs(e,t,r,i,n,a,o,s,l,u){var c=ds;var f=hs;var h=c(e,r,n,o,Rs);l[0]=Infinity;l[1]=Infinity;u[0]=-Infinity;u[1]=-Infinity;for(var p=0;p<h;p++){var v=f(e,r,n,o,Rs[p]);l[0]=Cs(v,l[0]);u[0]=Ts(v,u[0])}h=c(t,i,a,s,zs);for(var p=0;p<h;p++){var d=f(t,i,a,s,zs[p]);l[1]=Cs(d,l[1]);u[1]=Ts(d,u[1])}l[0]=Cs(e,l[0]);u[0]=Ts(e,u[0]);l[0]=Cs(o,l[0]);u[0]=Ts(o,u[0]);l[1]=Cs(t,l[1]);u[1]=Ts(t,u[1]);l[1]=Cs(s,l[1]);u[1]=Ts(s,u[1])}function Vs(e,t,r,i,n,a,o,s){var l=ws;var u=xs;var c=Ts(Cs(l(e,r,n),1),0);var f=Ts(Cs(l(t,i,a),1),0);var h=u(e,r,n,c);var p=u(t,i,a,f);o[0]=Cs(e,n,h);o[1]=Cs(t,a,p);s[0]=Ts(e,n,h);s[1]=Ts(t,a,p)}function Gs(e,t,r,i,n,a,o,s,l){var u=it;var c=nt;var f=Math.abs(n-a);if(f%Ls<1e-4&&f>1e-4){s[0]=e-r;s[1]=t-i;l[0]=e+r;l[1]=t+i;return}ks[0]=As(n)*r+e;ks[1]=Ds(n)*i+t;Ps[0]=As(a)*r+e;Ps[1]=Ds(a)*i+t;u(s,ks,Ps);c(l,ks,Ps);n=n%Ls;if(n<0){n=n+Ls}a=a%Ls;if(a<0){a=a+Ls}if(n>a&&!o){a+=Ls}else if(n<a&&o){n+=Ls}if(o){var h=a;a=n;n=h}for(var p=0;p<a;p+=Math.PI/2){if(p>n){Os[0]=As(p)*r+e;Os[1]=Ds(p)*i+t;u(s,Os,s);c(l,Os,l)}}}var Fs={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7};var Hs=[];var Ws=[];var js=[];var Us=[];var Zs=[];var Ys=[];var Xs=Math.min;var qs=Math.max;var Js=Math.cos;var Ks=Math.sin;var Qs=Math.sqrt;var $s=Math.abs;var el=Math.PI;var tl=el*2;var rl=typeof Float32Array!=="undefined";var il=[];function nl(e){var t=Math.round(e/el*1e8)/1e8;return t%2*el}function al(e,t){var r=nl(e[0]);if(r<0){r+=tl}var i=r-e[0];var n=e[1];n+=i;if(!t&&n-r>=tl){n=r+tl}else if(t&&r-n>=tl){n=r-tl}else if(!t&&r>n){n=r+(tl-nl(r-n))}else if(t&&r<n){n=r-(tl-nl(n-r))}e[0]=r;e[1]=n}var ol=function(){function t(e){this.dpr=1;this._xi=0;this._yi=0;this._x0=0;this._y0=0;this._len=0;if(e){this._saveData=false}if(this._saveData){this.data=[]}}t.prototype.increaseVersion=function(){this._version++};t.prototype.getVersion=function(){return this._version};t.prototype.setScale=function(e,t,r){r=r||0;if(r>0){this._ux=$s(r/Ti/e)||0;this._uy=$s(r/Ti/t)||0}};t.prototype.setDPR=function(e){this.dpr=e};t.prototype.setContext=function(e){this._ctx=e};t.prototype.getContext=function(){return this._ctx};t.prototype.beginPath=function(){this._ctx&&this._ctx.beginPath();this.reset();return this};t.prototype.reset=function(){if(this._saveData){this._len=0}if(this._lineDash){this._lineDash=null;this._dashOffset=0}if(this._pathSegLen){this._pathSegLen=null;this._pathLen=0}this._version++};t.prototype.moveTo=function(e,t){this._drawPendingPt();this.addData(Fs.M,e,t);this._ctx&&this._ctx.moveTo(e,t);this._x0=e;this._y0=t;this._xi=e;this._yi=t;return this};t.prototype.lineTo=function(e,t){var r=$s(e-this._xi);var i=$s(t-this._yi);var n=r>this._ux||i>this._uy;this.addData(Fs.L,e,t);if(this._ctx&&n){this._needsDash?this._dashedLineTo(e,t):this._ctx.lineTo(e,t)}if(n){this._xi=e;this._yi=t;this._pendingPtDist=0}else{var a=r*r+i*i;if(a>this._pendingPtDist){this._pendingPtX=e;this._pendingPtY=t;this._pendingPtDist=a}}return this};t.prototype.bezierCurveTo=function(e,t,r,i,n,a){this.addData(Fs.C,e,t,r,i,n,a);if(this._ctx){this._needsDash?this._dashedBezierTo(e,t,r,i,n,a):this._ctx.bezierCurveTo(e,t,r,i,n,a)}this._xi=n;this._yi=a;return this};t.prototype.quadraticCurveTo=function(e,t,r,i){this.addData(Fs.Q,e,t,r,i);if(this._ctx){this._needsDash?this._dashedQuadraticTo(e,t,r,i):this._ctx.quadraticCurveTo(e,t,r,i)}this._xi=r;this._yi=i;return this};t.prototype.arc=function(e,t,r,i,n,a){il[0]=i;il[1]=n;al(il,a);i=il[0];n=il[1];var o=n-i;this.addData(Fs.A,e,t,r,r,i,o,0,a?0:1);this._ctx&&this._ctx.arc(e,t,r,i,n,a);this._xi=Js(n)*r+e;this._yi=Ks(n)*r+t;return this};t.prototype.arcTo=function(e,t,r,i,n){if(this._ctx){this._ctx.arcTo(e,t,r,i,n)}return this};t.prototype.rect=function(e,t,r,i){this._ctx&&this._ctx.rect(e,t,r,i);this.addData(Fs.R,e,t,r,i);return this};t.prototype.closePath=function(){this._drawPendingPt();this.addData(Fs.Z);var e=this._ctx;var t=this._x0;var r=this._y0;if(e){this._needsDash&&this._dashedLineTo(t,r);e.closePath()}this._xi=t;this._yi=r;return this};t.prototype.fill=function(e){e&&e.fill();this.toStatic()};t.prototype.stroke=function(e){e&&e.stroke();this.toStatic()};t.prototype.setLineDash=function(e){if(e instanceof Array){this._lineDash=e;this._dashIdx=0;var t=0;for(var r=0;r<e.length;r++){t+=e[r]}this._dashSum=t;this._needsDash=true}else{this._lineDash=null;this._needsDash=false}return this};t.prototype.setLineDashOffset=function(e){this._dashOffset=e;return this};t.prototype.len=function(){return this._len};t.prototype.setData=function(e){var t=e.length;if(!(this.data&&this.data.length===t)&&rl){this.data=new Float32Array(t)}for(var r=0;r<t;r++){this.data[r]=e[r]}this._len=t};t.prototype.appendPath=function(e){if(!(e instanceof Array)){e=[e]}var t=e.length;var r=0;var i=this._len;for(var n=0;n<t;n++){r+=e[n].len()}if(rl&&this.data instanceof Float32Array){this.data=new Float32Array(i+r)}for(var n=0;n<t;n++){var a=e[n].data;for(var o=0;o<a.length;o++){this.data[i++]=a[o]}}this._len=i};t.prototype.addData=function(e,t,r,i,n,a,o,s,l){if(!this._saveData){return}var u=this.data;if(this._len+arguments.length>u.length){this._expandData();u=this.data}for(var c=0;c<arguments.length;c++){u[this._len++]=arguments[c]}};t.prototype._drawPendingPt=function(){if(this._pendingPtDist>0){this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY);this._pendingPtDist=0}};t.prototype._expandData=function(){if(!(this.data instanceof Array)){var e=[];for(var t=0;t<this._len;t++){e[t]=this.data[t]}this.data=e}};t.prototype._dashedLineTo=function(e,t){var r=this._dashSum;var i=this._lineDash;var n=this._ctx;var a=this._dashOffset;var o=this._xi;var s=this._yi;var l=e-o;var u=t-s;var c=Qs(l*l+u*u);var f=o;var h=s;var p=i.length;var v;var d;l/=c;u/=c;if(a<0){a=r+a}a%=r;f-=a*l;h-=a*u;while(l>0&&f<=e||l<0&&f>=e||l===0&&(u>0&&h<=t||u<0&&h>=t)){d=this._dashIdx;v=i[d];f+=l*v;h+=u*v;this._dashIdx=(d+1)%p;if(l>0&&f<o||l<0&&f>o||u>0&&h<s||u<0&&h>s){continue}n[d%2?"moveTo":"lineTo"](l>=0?Xs(f,e):qs(f,e),u>=0?Xs(h,t):qs(h,t))}l=f-e;u=h-t;this._dashOffset=-Qs(l*l+u*u)};t.prototype._dashedBezierTo=function(e,t,r,i,n,a){var o=this._ctx;var s=this._dashSum;var l=this._dashOffset;var u=this._lineDash;var c=this._xi;var f=this._yi;var h=0;var p=this._dashIdx;var v=u.length;var d;var g;var y;var m;var x;var _=0;if(l<0){l=s+l}l%=s;for(d=0;d<1;d+=.1){g=hs(c,e,r,n,d+.1)-hs(c,e,r,n,d);y=hs(f,t,i,a,d+.1)-hs(f,t,i,a,d);h+=Qs(g*g+y*y)}for(;p<v;p++){_+=u[p];if(_>l){break}}d=(_-l)/h;while(d<=1){m=hs(c,e,r,n,d);x=hs(f,t,i,a,d);p%2?o.moveTo(m,x):o.lineTo(m,x);d+=u[p]/h;p=(p+1)%v}p%2!==0&&o.lineTo(n,a);g=n-m;y=a-x;this._dashOffset=-Qs(g*g+y*y)};t.prototype._dashedQuadraticTo=function(e,t,r,i){var n=r;var a=i;r=(r+2*e)/3;i=(i+2*t)/3;e=(this._xi+2*e)/3;t=(this._yi+2*t)/3;this._dashedBezierTo(e,t,r,i,n,a)};t.prototype.toStatic=function(){if(!this._saveData){return}this._drawPendingPt();var e=this.data;if(e instanceof Array){e.length=this._len;if(rl&&this._len>11){this.data=new Float32Array(e)}}};t.prototype.getBoundingRect=function(){js[0]=js[1]=Zs[0]=Zs[1]=Number.MAX_VALUE;Us[0]=Us[1]=Ys[0]=Ys[1]=-Number.MAX_VALUE;var e=this.data;var t=0;var r=0;var i=0;var n=0;var a;for(a=0;a<this._len;){var o=e[a++];var s=a===1;if(s){t=e[a];r=e[a+1];i=t;n=r}switch(o){case Fs.M:t=i=e[a++];r=n=e[a++];Zs[0]=i;Zs[1]=n;Ys[0]=i;Ys[1]=n;break;case Fs.L:Es(t,r,e[a],e[a+1],Zs,Ys);t=e[a++];r=e[a++];break;case Fs.C:Bs(t,r,e[a++],e[a++],e[a++],e[a++],e[a],e[a+1],Zs,Ys);t=e[a++];r=e[a++];break;case Fs.Q:Vs(t,r,e[a++],e[a++],e[a],e[a+1],Zs,Ys);t=e[a++];r=e[a++];break;case Fs.A:var l=e[a++];var u=e[a++];var c=e[a++];var f=e[a++];var h=e[a++];var p=e[a++]+h;a+=1;var v=!e[a++];if(s){i=Js(h)*c+l;n=Ks(h)*f+u}Gs(l,u,c,f,h,p,v,Zs,Ys);t=Js(p)*c+l;r=Ks(p)*f+u;break;case Fs.R:i=t=e[a++];n=r=e[a++];var d=e[a++];var g=e[a++];Es(i,n,i+d,n+g,Zs,Ys);break;case Fs.Z:t=i;r=n;break}it(js,js,Zs);nt(Us,Us,Ys)}if(a===0){js[0]=js[1]=Us[0]=Us[1]=0}return new B(js[0],js[1],Us[0]-js[0],Us[1]-js[1])};t.prototype._calculateLength=function(){var e=this.data;var t=this._len;var r=this._ux;var i=this._uy;var n=0;var a=0;var o=0;var s=0;if(!this._pathSegLen){this._pathSegLen=[]}var l=this._pathSegLen;var u=0;var c=0;for(var f=0;f<t;){var h=e[f++];var p=f===1;if(p){n=e[f];a=e[f+1];o=n;s=a}var v=-1;switch(h){case Fs.M:n=o=e[f++];a=s=e[f++];break;case Fs.L:{var d=e[f++];var g=e[f++];var y=d-n;var m=g-a;if($s(y)>r||$s(m)>i||f===t-1){v=Math.sqrt(y*y+m*m);n=d;a=g}break}case Fs.C:{var x=e[f++];var _=e[f++];var d=e[f++];var g=e[f++];var b=e[f++];var w=e[f++];v=ms(n,a,x,_,d,g,b,w,10);n=b;a=w;break}case Fs.Q:{var x=e[f++];var _=e[f++];var d=e[f++];var g=e[f++];v=Is(n,a,x,_,d,g,10);n=d;a=g;break}case Fs.A:var S=e[f++];var M=e[f++];var I=e[f++];var C=e[f++];var T=e[f++];var D=e[f++];var A=D+T;f+=1;var L=!e[f++];if(p){o=Js(T)*I+S;s=Ks(T)*C+M}v=qs(I,C)*Xs(tl,Math.abs(D));n=Js(A)*I+S;a=Ks(A)*C+M;break;case Fs.R:{o=n=e[f++];s=a=e[f++];var k=e[f++];var P=e[f++];v=k*2+P*2;break}case Fs.Z:{var y=o-n;var m=s-a;v=Math.sqrt(y*y+m*m);n=o;a=s;break}}if(v>=0){l[c++]=v;u+=v}}this._pathLen=u;return u};t.prototype.rebuildPath=function(e,R){var t=this.data;var z=this._ux;var B=this._uy;var V=this._len;var r;var i;var n;var a;var o;var s;var l=R<1;var u;var G;var c=0;var f=0;var h;var p=0;var v;var d;if(l){if(!this._pathSegLen){this._calculateLength()}u=this._pathSegLen;G=this._pathLen;h=R*G;if(!h){return}}e:for(var g=0;g<V;){var F=t[g++];var H=g===1;if(H){n=t[g];a=t[g+1];r=n;i=a}switch(F){case Fs.M:if(p>0){e.lineTo(v,d);p=0}r=n=t[g++];i=a=t[g++];e.moveTo(n,a);break;case Fs.L:{o=t[g++];s=t[g++];var y=$s(o-n);var m=$s(s-a);if(y>z||m>B){if(l){var x=u[f++];if(c+x>h){var _=(h-c)/x;e.lineTo(n*(1-_)+o*_,a*(1-_)+s*_);break e}c+=x}e.lineTo(o,s);n=o;a=s;p=0}else{var W=y*y+m*m;if(W>p){v=o;d=s;p=W}}break}case Fs.C:{var b=t[g++];var w=t[g++];var S=t[g++];var M=t[g++];var I=t[g++];var C=t[g++];if(l){var x=u[f++];if(c+x>h){var _=(h-c)/x;gs(n,b,S,I,_,Hs);gs(a,w,M,C,_,Ws);e.bezierCurveTo(Hs[1],Ws[1],Hs[2],Ws[2],Hs[3],Ws[3]);break e}c+=x}e.bezierCurveTo(b,w,S,M,I,C);n=I;a=C;break}case Fs.Q:{var b=t[g++];var w=t[g++];var S=t[g++];var M=t[g++];if(l){var x=u[f++];if(c+x>h){var _=(h-c)/x;Ss(n,b,S,_,Hs);Ss(a,w,M,_,Ws);e.quadraticCurveTo(Hs[1],Ws[1],Hs[2],Ws[2]);break e}c+=x}e.quadraticCurveTo(b,w,S,M);n=S;a=M;break}case Fs.A:var T=t[g++];var D=t[g++];var A=t[g++];var L=t[g++];var k=t[g++];var j=t[g++];var U=t[g++];var Z=!t[g++];var Y=A>L?A:L;var X=$s(A-L)>.001;var P=k+j;var q=false;if(l){var x=u[f++];if(c+x>h){P=k+j*(h-c)/x;q=true}c+=x}if(X&&e.ellipse){e.ellipse(T,D,A,L,U,k,P,Z)}else{e.arc(T,D,Y,k,P,Z)}if(q){break e}if(H){r=Js(k)*A+T;i=Ks(k)*L+D}n=Js(P)*A+T;a=Ks(P)*L+D;break;case Fs.R:r=n=t[g];i=a=t[g+1];o=t[g++];s=t[g++];var O=t[g++];var N=t[g++];if(l){var x=u[f++];if(c+x>h){var E=h-c;e.moveTo(o,s);e.lineTo(o+Xs(E,O),s);E-=O;if(E>0){e.lineTo(o+O,s+Xs(E,N))}E-=N;if(E>0){e.lineTo(o+qs(O-E,0),s+N)}E-=O;if(E>0){e.lineTo(o,s+qs(N-E,0))}break e}c+=x}e.rect(o,s,O,N);break;case Fs.Z:if(p>0){e.lineTo(v,d);p=0}if(l){var x=u[f++];if(c+x>h){var _=(h-c)/x;e.lineTo(n*(1-_)+r*_,a*(1-_)+i*_);break e}c+=x}e.closePath();n=r;a=i}}};t.CMD=Fs;t.initDefaultProps=function(){var e=t.prototype;e._saveData=true;e._needsDash=false;e._dashOffset=0;e._dashIdx=0;e._dashSum=0;e._ux=0;e._uy=0;e._pendingPtDist=0;e._version=0}();return t}();function sl(e,t,r,i,n,a,o){if(n===0){return false}var s=n;var l=0;var u=e;if(o>t+s&&o>i+s||o<t-s&&o<i-s||a>e+s&&a>r+s||a<e-s&&a<r-s){return false}if(e!==r){l=(t-i)/(e-r);u=(e*i-r*t)/(e-r)}else{return Math.abs(a-e)<=s/2}var c=l*a-o+u;var f=c*c/(l*l+1);return f<=s/2*s/2}function ll(e,t,r,i,n,a,o,s,l,u,c){if(l===0){return false}var f=l;if(c>t+f&&c>i+f&&c>a+f&&c>s+f||c<t-f&&c<i-f&&c<a-f&&c<s-f||u>e+f&&u>r+f&&u>n+f&&u>o+f||u<e-f&&u<r-f&&u<n-f&&u<o-f){return false}var h=ys(e,t,r,i,n,a,o,s,u,c,null);return h<=f/2}function ul(e,t,r,i,n,a,o,s,l){if(o===0){return false}var u=o;if(l>t+u&&l>i+u&&l>a+u||l<t-u&&l<i-u&&l<a-u||s>e+u&&s>r+u&&s>n+u||s<e-u&&s<r-u&&s<n-u){return false}var c=Ms(e,t,r,i,n,a,s,l,null);return c<=u/2}var cl=Math.PI*2;function fl(e){e%=cl;if(e<0){e+=cl}return e}var hl=Math.PI*2;function pl(e,t,r,i,n,a,o,s,l){if(o===0){return false}var u=o;s-=e;l-=t;var c=Math.sqrt(s*s+l*l);if(c-u>r||c+u<r){return false}if(Math.abs(i-n)%hl<1e-4){return true}if(a){var f=i;i=fl(n);n=fl(f)}else{i=fl(i);n=fl(n)}if(i>n){n+=hl}var h=Math.atan2(l,s);if(h<0){h+=hl}return h>=i&&h<=n||h+hl>=i&&h+hl<=n}function vl(e,t,r,i,n,a){if(a>t&&a>i||a<t&&a<i){return 0}if(i===t){return 0}var o=(a-t)/(i-t);var s=i<t?1:-1;if(o===1||o===0){s=i<t?.5:-.5}var l=o*(r-e)+e;return l===n?Infinity:l>n?s:0}var dl=ol.CMD;var gl=Math.PI*2;var yl=1e-4;function ml(e,t){return Math.abs(e-t)<yl}var xl=[-1,-1,-1];var _l=[-1,-1];function bl(){var e=_l[0];_l[0]=_l[1];_l[1]=e}function wl(e,t,r,i,n,a,o,s,l,u){if(u>t&&u>i&&u>a&&u>s||u<t&&u<i&&u<a&&u<s){return 0}var c=vs(t,i,a,s,u,xl);if(c===0){return 0}else{var f=0;var h=-1;var p=void 0;var v=void 0;for(var d=0;d<c;d++){var g=xl[d];var y=g===0||g===1?.5:1;var m=hs(e,r,n,o,g);if(m<l){continue}if(h<0){h=ds(t,i,a,s,_l);if(_l[1]<_l[0]&&h>1){bl()}p=hs(t,i,a,s,_l[0]);if(h>1){v=hs(t,i,a,s,_l[1])}}if(h===2){if(g<_l[0]){f+=p<t?y:-y}else if(g<_l[1]){f+=v<p?y:-y}else{f+=s<v?y:-y}}else{if(g<_l[0]){f+=p<t?y:-y}else{f+=s<p?y:-y}}}return f}}function Sl(e,t,r,i,n,a,o,s){if(s>t&&s>i&&s>a||s<t&&s<i&&s<a){return 0}var l=bs(t,i,a,s,xl);if(l===0){return 0}else{var u=ws(t,i,a);if(u>=0&&u<=1){var c=0;var f=xs(t,i,a,u);for(var h=0;h<l;h++){var p=xl[h]===0||xl[h]===1?.5:1;var v=xs(e,r,n,xl[h]);if(v<o){continue}if(xl[h]<u){c+=f<t?p:-p}else{c+=a<f?p:-p}}return c}else{var p=xl[0]===0||xl[0]===1?.5:1;var v=xs(e,r,n,xl[0]);if(v<o){return 0}return a<t?p:-p}}}function Ml(e,t,r,i,n,a,o,s){s-=t;if(s>r||s<-r){return 0}var l=Math.sqrt(r*r-s*s);xl[0]=-l;xl[1]=l;var u=Math.abs(i-n);if(u<1e-4){return 0}if(u>=gl-1e-4){i=0;n=gl;var c=a?1:-1;if(o>=xl[0]+e&&o<=xl[1]+e){return c}else{return 0}}if(i>n){var f=i;i=n;n=f}if(i<0){i+=gl;n+=gl}var h=0;for(var p=0;p<2;p++){var v=xl[p];if(v+e>o){var d=Math.atan2(s,v);var c=a?1:-1;if(d<0){d=gl+d}if(d>=i&&d<=n||d+gl>=i&&d+gl<=n){if(d>Math.PI/2&&d<Math.PI*1.5){c=-c}h+=c}}}return h}function Il(e,t,r,i,n){var a=e.data;var o=e.len();var s=0;var l=0;var u=0;var c=0;var f=0;var h;var p;for(var v=0;v<o;){var d=a[v++];var g=v===1;if(d===dl.M&&v>1){if(!r){s+=vl(l,u,c,f,i,n)}}if(g){l=a[v];u=a[v+1];c=l;f=u}switch(d){case dl.M:c=a[v++];f=a[v++];l=c;u=f;break;case dl.L:if(r){if(sl(l,u,a[v],a[v+1],t,i,n)){return true}}else{s+=vl(l,u,a[v],a[v+1],i,n)||0}l=a[v++];u=a[v++];break;case dl.C:if(r){if(ll(l,u,a[v++],a[v++],a[v++],a[v++],a[v],a[v+1],t,i,n)){return true}}else{s+=wl(l,u,a[v++],a[v++],a[v++],a[v++],a[v],a[v+1],i,n)||0}l=a[v++];u=a[v++];break;case dl.Q:if(r){if(ul(l,u,a[v++],a[v++],a[v],a[v+1],t,i,n)){return true}}else{s+=Sl(l,u,a[v++],a[v++],a[v],a[v+1],i,n)||0}l=a[v++];u=a[v++];break;case dl.A:var y=a[v++];var m=a[v++];var x=a[v++];var _=a[v++];var b=a[v++];var w=a[v++];v+=1;var S=!!(1-a[v++]);h=Math.cos(b)*x+y;p=Math.sin(b)*_+m;if(!g){s+=vl(l,u,h,p,i,n)}else{c=h;f=p}var M=(i-y)*_/x+y;if(r){if(pl(y,m,_,b,b+w,S,t,M,n)){return true}}else{s+=Ml(y,m,_,b,b+w,S,M,n)}l=Math.cos(b+w)*x+y;u=Math.sin(b+w)*_+m;break;case dl.R:c=l=a[v++];f=u=a[v++];var I=a[v++];var C=a[v++];h=c+I;p=f+C;if(r){if(sl(c,f,h,f,t,i,n)||sl(h,f,h,p,t,i,n)||sl(h,p,c,p,t,i,n)||sl(c,p,c,f,t,i,n)){return true}}else{s+=vl(h,f,h,p,i,n);s+=vl(c,p,c,f,i,n)}break;case dl.Z:if(r){if(sl(l,u,c,f,t,i,n)){return true}}else{s+=vl(l,u,c,f,i,n)}l=c;u=f;break}}if(!r&&!ml(u,f)){s+=vl(l,u,c,f,i,n)||0}return s!==0}function Cl(e,t,r){return Il(e,0,false,t,r)}function Tl(e,t,r,i){return Il(e,t,true,r,i)}var Dl=R({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:false,strokeFirst:false},Yo);var Al={style:R({fill:true,stroke:true,strokePercent:true,fillOpacity:true,strokeOpacity:true,lineDashOffset:true,lineWidth:true,miterLimit:true},Xo.style)};var Ll=["x","y","rotation","scaleX","scaleY","originX","originY","invisible","culling","z","z2","zlevel","parent"];var m=function(h){d(o,h);function o(e){return h.call(this,e)||this}o.prototype.update=function(){var t=this;h.prototype.update.call(this);var e=this.style;if(e.decal){var r=this._decalEl=this._decalEl||new o;if(r.buildPath===o.prototype.buildPath){r.buildPath=function(e){t.buildPath(e,t.shape)}}r.silent=true;var i=r.style;for(var n in e){if(i[n]!==e[n]){i[n]=e[n]}}i.fill=e.fill?e.decal:null;i.decal=null;i.shadowColor=null;e.strokeFirst&&(i.stroke=null);for(var a=0;a<Ll.length;++a){r[Ll[a]]=this[Ll[a]]}r.__dirty|=er}else if(this._decalEl){this._decalEl=null}};o.prototype.getDecalElement=function(){return this._decalEl};o.prototype._init=function(e){var t=L(e);this.shape=this.getDefaultShape();var r=this.getDefaultStyle();if(r){this.useStyle(r)}for(var i=0;i<t.length;i++){var n=t[i];var a=e[n];if(n==="style"){if(!this.style){this.useStyle(a)}else{F(this.style,a)}}else if(n==="shape"){F(this.shape,a)}else{h.prototype.attrKV.call(this,n,a)}}if(!this.style){this.useStyle({})}};o.prototype.getDefaultStyle=function(){return null};o.prototype.getDefaultShape=function(){return{}};o.prototype.canBeInsideText=function(){return this.hasFill()};o.prototype.getInsideTextFill=function(){var e=this.style.fill;if(e!=="none"){if(P(e)){var t=Vr(e,0);if(t>.5){return Ai}else if(t>.2){return ki}return Li}else if(e){return Li}}return Ai};o.prototype.getInsideTextStroke=function(e){var t=this.style.fill;if(P(t)){var r=this.__zr;var i=!!(r&&r.isDarkMode());var n=Vr(e,0)<Di;if(i===n){return t}}};o.prototype.buildPath=function(e,t,r){};o.prototype.pathUpdated=function(){this.__dirty&=~rr};o.prototype.createPathProxy=function(){this.path=new ol(false)};o.prototype.hasStroke=function(){var e=this.style;var t=e.stroke;return!(t==null||t==="none"||!(e.lineWidth>0))};o.prototype.hasFill=function(){var e=this.style;var t=e.fill;return t!=null&&t!=="none"};o.prototype.getBoundingRect=function(){var e=this._rect;var t=this.style;var r=!e;if(r){var i=false;if(!this.path){i=true;this.createPathProxy()}var n=this.path;if(i||this.__dirty&rr){n.beginPath();this.buildPath(n,this.shape,false);this.pathUpdated()}e=n.getBoundingRect()}this._rect=e;if(this.hasStroke()&&this.path&&this.path.len()>0){var a=this._rectWithStroke||(this._rectWithStroke=e.clone());if(this.__dirty||r){a.copy(e);var o=t.strokeNoScale?this.getLineScale():1;var s=t.lineWidth;if(!this.hasFill()){var l=this.strokeContainThreshold;s=Math.max(s,l==null?4:l)}if(o>1e-10){a.width+=s/o;a.height+=s/o;a.x-=s/o/2;a.y-=s/o/2}}return a}return e};o.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);var i=this.getBoundingRect();var n=this.style;e=r[0];t=r[1];if(i.contain(e,t)){var a=this.path;if(this.hasStroke()){var o=n.lineWidth;var s=n.strokeNoScale?this.getLineScale():1;if(s>1e-10){if(!this.hasFill()){o=Math.max(o,this.strokeContainThreshold)}if(Tl(a,o/s,e,t)){return true}}}if(this.hasFill()){return Cl(a,e,t)}}return false};o.prototype.dirtyShape=function(){this.__dirty|=rr;if(this._rect){this._rect=null}if(this._decalEl){this._decalEl.dirtyShape()}this.markRedraw()};o.prototype.dirty=function(){this.dirtyStyle();this.dirtyShape()};o.prototype.animateShape=function(e){return this.animate("shape",e)};o.prototype.updateDuringAnimation=function(e){if(e==="style"){this.dirtyStyle()}else if(e==="shape"){this.dirtyShape()}else{this.markRedraw()}};o.prototype.attrKV=function(e,t){if(e==="shape"){this.setShape(t)}else{h.prototype.attrKV.call(this,e,t)}};o.prototype.setShape=function(e,t){var r=this.shape;if(!r){r=this.shape={}}if(typeof e==="string"){r[e]=t}else{F(r,e)}this.dirtyShape();return this};o.prototype.shapeChanged=function(){return!!(this.__dirty&rr)};o.prototype.createStyle=function(e){return ke(Dl,e)};o.prototype._innerSaveToNormal=function(e){h.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;if(e.shape&&!t.shape){t.shape=F({},this.shape)}};o.prototype._applyStateObj=function(e,t,r,i,n,a){h.prototype._applyStateObj.call(this,e,t,r,i,n,a);var o=!(t&&i);var s;if(t&&t.shape){if(n){if(i){s=t.shape}else{s=F({},r.shape);F(s,t.shape)}}else{s=F({},i?this.shape:r.shape);F(s,t.shape)}}else if(o){s=r.shape}if(s){if(n){this.shape=F({},this.shape);var l={};var u=L(s);for(var c=0;c<u.length;c++){var f=u[c];if(typeof s[f]==="object"){this.shape[f]=s[f]}else{l[f]=s[f]}}this._transitionState(e,{shape:l},a)}else{this.shape=s;this.dirtyShape()}}};o.prototype._mergeStates=function(e){var t=h.prototype._mergeStates.call(this,e);var r;for(var i=0;i<e.length;i++){var n=e[i];if(n.shape){r=r||{};this._mergeStyle(r,n.shape)}}if(r){t.shape=r}return t};o.prototype.getAnimationStyleProps=function(){return Al};o.prototype.isZeroArea=function(){return false};o.extend=function(i){var e=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;i.init&&i.init.call(t,e);return t}e.prototype.getDefaultStyle=function(){return M(i.style)};e.prototype.getDefaultShape=function(){return M(i.shape)};return e}(o);for(var t in i){if(typeof i[t]==="function"){e.prototype[t]=i[t]}}return e};o.initDefaultProps=function(){var e=o.prototype;e.type="path";e.strokeContainThreshold=5;e.segmentIgnoreThreshold=0;e.subPixelOptimize=false;e.autoBatch=false;e.__dirty=er|tr|rr}();return o}(Ko);var kl=R({strokeFirst:true,font:on,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Dl);var Pl=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.hasStroke=function(){var e=this.style;var t=e.stroke;return t!=null&&t!=="none"&&e.lineWidth>0};t.prototype.hasFill=function(){var e=this.style;var t=e.fill;return t!=null&&t!=="none"};t.prototype.createStyle=function(e){return ke(kl,e)};t.prototype.setBoundingRect=function(e){this._rect=e};t.prototype.getBoundingRect=function(){var e=this.style;if(!this._rect){var t=e.text;t!=null?t+="":t="";var r=pn(t,e.font,e.textAlign,e.textBaseline);r.x+=e.x||0;r.y+=e.y||0;if(this.hasStroke()){var i=e.lineWidth;r.x-=i/2;r.y-=i/2;r.width+=i;r.height+=i}this._rect=r}return this._rect};t.initDefaultProps=function(){var e=t.prototype;e.dirtyRectTolerance=10}();return t}(Ko);Pl.prototype.type="tspan";var Ol=R({x:0,y:0},Yo);var Nl={style:R({x:true,y:true,width:true,height:true,sx:true,sy:true,sWidth:true,sHeight:true},Xo.style)};function El(e){return!!(e&&typeof e!=="string"&&e.width&&e.height)}var Rl=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.createStyle=function(e){return ke(Ol,e)};t.prototype._getSize=function(e){var t=this.style;var r=t[e];if(r!=null){return r}var i=El(t.image)?t.image:this.__image;if(!i){return 0}var n=e==="width"?"height":"width";var a=t[n];if(a==null){return i[e]}else{return i[e]/i[n]*a}};t.prototype.getWidth=function(){return this._getSize("width")};t.prototype.getHeight=function(){return this._getSize("height")};t.prototype.getAnimationStyleProps=function(){return Nl};t.prototype.getBoundingRect=function(){var e=this.style;if(!this._rect){this._rect=new B(e.x||0,e.y||0,this.getWidth(),this.getHeight())}return this._rect};return t}(Ko);Rl.prototype.type="image";function zl(e,t){var r=t.x;var i=t.y;var n=t.width;var a=t.height;var o=t.r;var s;var l;var u;var c;if(n<0){r=r+n;n=-n}if(a<0){i=i+a;a=-a}if(typeof o==="number"){s=l=u=c=o}else if(o instanceof Array){if(o.length===1){s=l=u=c=o[0]}else if(o.length===2){s=u=o[0];l=c=o[1]}else if(o.length===3){s=o[0];l=c=o[1];u=o[2]}else{s=o[0];l=o[1];u=o[2];c=o[3]}}else{s=l=u=c=0}var f;if(s+l>n){f=s+l;s*=n/f;l*=n/f}if(u+c>n){f=u+c;u*=n/f;c*=n/f}if(l+u>a){f=l+u;l*=a/f;u*=a/f}if(s+c>a){f=s+c;s*=a/f;c*=a/f}e.moveTo(r+s,i);e.lineTo(r+n-l,i);l!==0&&e.arc(r+n-l,i+l,l,-Math.PI/2,0);e.lineTo(r+n,i+a-u);u!==0&&e.arc(r+n-u,i+a-u,u,0,Math.PI/2);e.lineTo(r+c,i+a);c!==0&&e.arc(r+c,i+a-c,c,Math.PI/2,Math.PI);e.lineTo(r,i+s);s!==0&&e.arc(r+s,i+s,s,Math.PI,Math.PI*1.5)}var Bl=Math.round;function Vl(e,t,r){if(!t){return}var i=t.x1;var n=t.x2;var a=t.y1;var o=t.y2;e.x1=i;e.x2=n;e.y1=a;e.y2=o;var s=r&&r.lineWidth;if(!s){return e}if(Bl(i*2)===Bl(n*2)){e.x1=e.x2=Fl(i,s,true)}if(Bl(a*2)===Bl(o*2)){e.y1=e.y2=Fl(a,s,true)}return e}function Gl(e,t,r){if(!t){return}var i=t.x;var n=t.y;var a=t.width;var o=t.height;e.x=i;e.y=n;e.width=a;e.height=o;var s=r&&r.lineWidth;if(!s){return e}e.x=Fl(i,s,true);e.y=Fl(n,s,true);e.width=Math.max(Fl(i+a,s,false)-e.x,a===0?0:1);e.height=Math.max(Fl(n+o,s,false)-e.y,o===0?0:1);return e}function Fl(e,t,r){if(!t){return e}var i=Bl(e*2);return(i+Bl(t))%2===0?i/2:(i+(r?1:-1))/2}var Hl=function(){function e(){this.x=0;this.y=0;this.width=0;this.height=0}return e}();var Wl={};var G=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new Hl};e.prototype.buildPath=function(e,t){var r;var i;var n;var a;if(this.subPixelOptimize){var o=Gl(Wl,t,this.style);r=o.x;i=o.y;n=o.width;a=o.height;o.r=t.r;t=o}else{r=t.x;i=t.y;n=t.width;a=t.height}if(!t.r){e.rect(r,i,n,a)}else{zl(e,t)}};e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height};return e}(m);G.prototype.type="rect";var jl={fill:"#000"};var Ul=2;var Zl={style:R({fill:true,stroke:true,fillOpacity:true,strokeOpacity:true,lineWidth:true,fontSize:true,lineHeight:true,width:true,height:true,textShadowColor:true,textShadowBlur:true,textShadowOffsetX:true,textShadowOffsetY:true,backgroundColor:true,padding:true,borderColor:true,borderWidth:true,borderRadius:true},Xo.style)};var W=function(n){d(e,n);function e(e){var t=n.call(this)||this;t.type="text";t._children=[];t._defaultStyle=jl;t.attr(e);return t}e.prototype.childrenRef=function(){return this._children};e.prototype.update=function(){if(this.styleChanged()){this._updateSubTexts()}for(var e=0;e<this._children.length;e++){var t=this._children[e];t.zlevel=this.zlevel;t.z=this.z;t.z2=this.z2;t.culling=this.culling;t.cursor=this.cursor;t.invisible=this.invisible}var r=this.attachedTransform;if(r){r.updateTransform();var i=r.transform;if(i){this.transform=this.transform||[];Ni(this.transform,i)}else{this.transform=null}}else{n.prototype.update.call(this)}};e.prototype.getComputedTransform=function(){if(this.__hostTarget){this.__hostTarget.getComputedTransform();this.__hostTarget.updateInnerText(true)}return this.attachedTransform?this.attachedTransform.getComputedTransform():n.prototype.getComputedTransform.call(this)};e.prototype._updateSubTexts=function(){this._childCursor=0;ql(this.style);this.style.rich?this._updateRichTexts():this._updatePlainTexts();this._children.length=this._childCursor;this.styleUpdated()};e.prototype.addSelfToZr=function(e){n.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++){this._children[t].__zr=e}};e.prototype.removeSelfFromZr=function(e){n.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++){this._children[t].__zr=null}};e.prototype.getBoundingRect=function(){if(this.styleChanged()){this._updateSubTexts()}if(!this._rect){var e=new B(0,0,0,0);var t=this._children;var r=[];var i=null;for(var n=0;n<t.length;n++){var a=t[n];var o=a.getBoundingRect();var s=a.getLocalTransform(r);if(s){e.copy(o);e.applyTransform(s);i=i||e.clone();i.union(e)}else{i=i||o.clone();i.union(o)}}this._rect=i||e}return this._rect};e.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||jl};e.prototype.setTextContent=function(e){throw new Error("Can't attach text on another text")};e.prototype._mergeStyle=function(e,t){if(!t){return e}var r=t.rich;var i=e.rich||r&&{};F(e,t);if(r&&i){this._mergeRich(i,r);e.rich=i}else if(i){e.rich=i}return e};e.prototype._mergeRich=function(e,t){var r=L(t);for(var i=0;i<r.length;i++){var n=r[i];e[n]=e[n]||{};F(e[n],t[n])}};e.prototype.getAnimationStyleProps=function(){return Zl};e.prototype._getOrCreateChild=function(e){var t=this._children[this._childCursor];if(!t||!(t instanceof e)){t=new e}this._children[this._childCursor++]=t;t.__zr=this.__zr;t.parent=this;return t};e.prototype._updatePlainTexts=function(){var e=this.style;var t=e.font||on;var r=e.padding;var i=eu(e);var n=Ro(i,e);var a=tu(e);var o=!!e.backgroundColor;var s=n.outerHeight;var l=n.lines;var u=n.lineHeight;var c=this._defaultStyle;var f=e.x||0;var h=e.y||0;var p=e.align||c.align||"left";var v=e.verticalAlign||c.verticalAlign||"top";var d=f;var g=dn(h,n.contentHeight,v);if(a||r){var y=n.width;r&&(y+=r[1]+r[3]);var m=vn(f,y,p);var x=dn(h,s,v);a&&this._renderBackground(e,e,m,x,y,s)}g+=u/2;if(r){d=$l(f,p,r);if(v==="top"){g+=r[0]}else if(v==="bottom"){g-=r[2]}}var _=0;var b=false;var w=Ql("fill"in e?e.fill:(b=true,c.fill));var S=Kl("stroke"in e?e.stroke:!o&&(!c.autoStroke||b)?(_=Ul,c.stroke):null);var M=e.textShadowBlur>0;var I=e.width!=null&&(e.overflow==="truncate"||e.overflow==="break"||e.overflow==="breakAll");var C=n.calculatedLineHeight;for(var T=0;T<l.length;T++){var D=this._getOrCreateChild(Pl);var A=D.createStyle();D.useStyle(A);A.text=l[T];A.x=d;A.y=g;if(p){A.textAlign=p}A.textBaseline="middle";A.opacity=e.opacity;A.strokeFirst=true;if(M){A.shadowBlur=e.textShadowBlur||0;A.shadowColor=e.textShadowColor||"transparent";A.shadowOffsetX=e.textShadowOffsetX||0;A.shadowOffsetY=e.textShadowOffsetY||0}if(S){A.stroke=S;A.lineWidth=e.lineWidth||_;A.lineDash=e.lineDash;A.lineDashOffset=e.lineDashOffset||0}if(w){A.fill=w}A.font=t;g+=u;if(I){D.setBoundingRect(new B(vn(A.x,e.width,A.textAlign),dn(A.y,C,A.textBaseline),e.width,C))}}};e.prototype._updateRichTexts=function(){var e=this.style;var t=eu(e);var r=Go(t,e);var i=r.width;var n=r.outerWidth;var a=r.outerHeight;var o=e.padding;var s=e.x||0;var l=e.y||0;var u=this._defaultStyle;var c=e.align||u.align;var f=e.verticalAlign||u.verticalAlign;var h=vn(s,n,c);var p=dn(l,a,f);var v=h;var d=p;if(o){v+=o[3];d+=o[0]}var g=v+i;if(tu(e)){this._renderBackground(e,e,h,p,n,a)}var y=!!e.backgroundColor;for(var m=0;m<r.lines.length;m++){var x=r.lines[m];var _=x.tokens;var b=_.length;var w=x.lineHeight;var S=x.width;var M=0;var I=v;var C=g;var T=b-1;var D=void 0;while(M<b&&(D=_[M],!D.align||D.align==="left")){this._placeToken(D,e,w,d,I,"left",y);S-=D.width;I+=D.width;M++}while(T>=0&&(D=_[T],D.align==="right")){this._placeToken(D,e,w,d,C,"right",y);S-=D.width;C-=D.width;T--}I+=(i-(I-v)-(g-C)-S)/2;while(M<=T){D=_[M];this._placeToken(D,e,w,d,I+D.width/2,"center",y);I+=D.width;M++}d+=w}};e.prototype._placeToken=function(e,t,r,i,n,a,o){var s=t.rich[e.styleName]||{};s.text=e.text;var l=e.verticalAlign;var u=i+r/2;if(l==="top"){u=i+e.height/2}else if(l==="bottom"){u=i+r-e.height/2}var c=!e.isLineHolder&&tu(s);c&&this._renderBackground(s,t,a==="right"?n-e.width:a==="center"?n-e.width/2:n,u-e.height/2,e.width,e.height);var f=!!s.backgroundColor;var h=e.textPadding;if(h){n=$l(n,a,h);u-=e.height/2-h[0]-e.innerHeight/2}var p=this._getOrCreateChild(Pl);var v=p.createStyle();p.useStyle(v);var d=this._defaultStyle;var g=false;var y=0;var m=Kl("fill"in s?s.fill:"fill"in t?t.fill:(g=true,d.fill));var x=Kl("stroke"in s?s.stroke:"stroke"in t?t.stroke:!f&&!o&&(!d.autoStroke||g)?(y=Ul,d.stroke):null);var _=s.textShadowBlur>0||t.textShadowBlur>0;v.text=e.text;v.x=n;v.y=u;if(_){v.shadowBlur=s.textShadowBlur||t.textShadowBlur||0;v.shadowColor=s.textShadowColor||t.textShadowColor||"transparent";v.shadowOffsetX=s.textShadowOffsetX||t.textShadowOffsetX||0;v.shadowOffsetY=s.textShadowOffsetY||t.textShadowOffsetY||0}v.textAlign=a;v.textBaseline="middle";v.font=e.font||on;v.opacity=we(s.opacity,t.opacity,1);if(x){v.lineWidth=we(s.lineWidth,t.lineWidth,y);v.lineDash=N(s.lineDash,t.lineDash);v.lineDashOffset=t.lineDashOffset||0;v.stroke=x}if(m){v.fill=m}var b=e.contentWidth;var w=e.contentHeight;p.setBoundingRect(new B(vn(v.x,b,v.textAlign),dn(v.y,w,v.textBaseline),b,w))};e.prototype._renderBackground=function(e,t,r,i,n,a){var o=e.backgroundColor;var s=e.borderWidth;var l=e.borderColor;var u=o&&o.image;var c=o&&!u;var f=e.borderRadius;var h=this;var p;var v;if(c||s&&l){p=this._getOrCreateChild(G);p.useStyle(p.createStyle());p.style.fill=null;var d=p.shape;d.x=r;d.y=i;d.width=n;d.height=a;d.r=f;p.dirtyShape()}if(c){var g=p.style;g.fill=o||null;g.fillOpacity=N(e.fillOpacity,1)}else if(u){v=this._getOrCreateChild(Rl);v.onload=function(){h.dirtyStyle()};var y=v.style;y.image=o.image;y.x=r;y.y=i;y.width=n;y.height=a}if(s&&l){var g=p.style;g.lineWidth=s;g.stroke=l;g.strokeOpacity=N(e.strokeOpacity,1);g.lineDash=e.borderDash;g.lineDashOffset=e.borderDashOffset||0;p.strokeContainThreshold=0;if(p.hasFill()&&p.hasStroke()){g.strokeFirst=true;g.lineWidth*=2}}var m=(p||v).style;m.shadowBlur=e.shadowBlur||0;m.shadowColor=e.shadowColor||"transparent";m.shadowOffsetX=e.shadowOffsetX||0;m.shadowOffsetY=e.shadowOffsetY||0;m.opacity=we(e.opacity,t.opacity,1)};e.makeFont=function(e){var t="";if(e.fontSize||e.fontFamily||e.fontWeight){var r="";if(typeof e.fontSize==="string"&&(e.fontSize.indexOf("px")!==-1||e.fontSize.indexOf("rem")!==-1||e.fontSize.indexOf("em")!==-1)){r=e.fontSize}else if(!isNaN(+e.fontSize)){r=e.fontSize+"px"}else{r="12px"}t=[e.fontStyle,e.fontWeight,r,e.fontFamily||"sans-serif"].join(" ")}return t&&Ie(t)||e.textFont||e.font};return e}(Ko);var Yl={left:true,right:1,center:1};var Xl={top:1,bottom:1,middle:1};function ql(e){Jl(e);U(e.rich,Jl);return e}function Jl(e){if(e){e.font=W.makeFont(e);var t=e.align;t==="middle"&&(t="center");e.align=t==null||Yl[t]?t:"left";var r=e.verticalAlign;r==="center"&&(r="middle");e.verticalAlign=r==null||Xl[r]?r:"top";var i=e.padding;if(i){e.padding=Me(e.padding)}}}function Kl(e,t){return e==null||t<=0||e==="transparent"||e==="none"?null:e.image||e.colorStops?"#000":e}function Ql(e){return e==null||e==="none"?null:e.image||e.colorStops?"#000":e}function $l(e,t,r){return t==="right"?e-r[1]:t==="center"?e+r[3]/2-r[1]/2:e+r[3]}function eu(e){var t=e.text;t!=null&&(t+="");return t}function tu(e){return!!(e.backgroundColor||e.borderWidth&&e.borderColor)}var j=qa();var ru=1;var iu={};var nu=qa();var au=0;var ou=1;var su=2;var lu=["emphasis","blur","select"];var uu=["normal","emphasis","blur","select"];var cu=10;var fu=9;var hu="highlight";var pu="downplay";var vu="select";var du="unselect";var gu="toggleSelect";function yu(e){return e!=null&&e!=="none"}var mu=new pr(100);function xu(e){if(typeof e!=="string"){return e}var t=mu.get(e);if(!t){t=Lr(e,-.1);mu.put(e,t)}return t}function _u(e,t,r){if(e.onHoverStateChange&&(e.hoverState||0)!==r){e.onHoverStateChange(t)}e.hoverState=r}function bu(e){_u(e,"emphasis",su)}function wu(e){if(e.hoverState===su){_u(e,"normal",au)}}function Su(e){_u(e,"blur",ou)}function Mu(e){if(e.hoverState===ou){_u(e,"normal",au)}}function Iu(e){e.selected=true}function Cu(e){e.selected=false}function Tu(e,t,r){t(e,r)}function Du(e,t,r){Tu(e,t,r);e.isGroup&&e.traverse(function(e){Tu(e,t,r)})}function Au(e,t){switch(t){case"emphasis":e.hoverState=su;break;case"normal":e.hoverState=au;break;case"blur":e.hoverState=ou;break;case"select":e.selected=true}}function Lu(e,t,r,i){var n=e.style;var a={};for(var o=0;o<t.length;o++){var s=t[o];var l=n[s];a[s]=l==null?i&&i[s]:l}for(var o=0;o<e.animators.length;o++){var u=e.animators[o];if(u.__fromStateTransition&&u.__fromStateTransition.indexOf(r)<0&&u.targetName==="style"){u.saveFinalToTarget(a,t)}}return a}function ku(e,t,r,i){var n=r&&D(r,"select")>=0;var a=false;if(e instanceof m){var o=nu(e);var s=n?o.selectFill||o.normalFill:o.normalFill;var l=n?o.selectStroke||o.normalStroke:o.normalStroke;if(yu(s)||yu(l)){i=i||{};var u=i.style||{};if(!yu(u.fill)&&yu(s)){a=true;i=F({},i);u=F({},u);u.fill=xu(s)}else if(!yu(u.stroke)&&yu(l)){if(!a){i=F({},i);u=F({},u)}u.stroke=xu(l)}i.style=u}}if(i){if(i.z2==null){if(!a){i=F({},i)}var c=e.z2EmphasisLift;i.z2=e.z2+(c!=null?c:cu)}}return i}function Pu(e,t,r){if(r){if(r.z2==null){r=F({},r);var i=e.z2SelectLift;r.z2=e.z2+(i!=null?i:fu)}}return r}function Ou(e,t,r){var i=D(e.currentStates,t)>=0;var n=e.style.opacity;var a=!i?Lu(e,["opacity"],t,{opacity:1}):null;r=r||{};var o=r.style||{};if(o.opacity==null){r=F({},r);o=F({opacity:i?n:a.opacity*.1},o);r.style=o}return r}function Nu(e,t){var r=this.states[e];if(this.style){if(e==="emphasis"){return ku(this,e,t,r)}else if(e==="blur"){return Ou(this,e,r)}else if(e==="select"){return Pu(this,e,r)}}return r}function Eu(e){e.stateProxy=Nu;var t=e.getTextContent();var r=e.getTextGuideLine();if(t){t.stateProxy=Nu}if(r){r.stateProxy=Nu}}function Ru(e,t){!ju(e,t)&&!e.__highByOuter&&Du(e,bu)}function zu(e,t){!ju(e,t)&&!e.__highByOuter&&Du(e,wu)}function Bu(e,t){e.__highByOuter|=1<<(t||0);Du(e,bu)}function Vu(e,t){!(e.__highByOuter&=~(1<<(t||0)))&&Du(e,wu)}function Gu(e){Du(e,Su)}function Fu(e){Du(e,Mu)}function Hu(e){Du(e,Iu)}function Wu(e){Du(e,Cu)}function ju(e,t){return e.__highDownSilentOnTouch&&t.zrByTouch}function Uu(i){var e=i.getModel();e.eachComponent(function(e,t){var r=e==="series"?i.getViewOfSeriesModel(t):i.getViewOfComponentModel(t);r.group.traverse(function(e){Mu(e)})})}function Zu(e,s,l,u){var i=u.getModel();l=l||"coordinateSystem";function c(e,t){for(var r=0;r<t.length;r++){var i=e.getItemGraphicEl(t[r]);i&&Fu(i)}}if(e==null){return}if(!s||s==="none"){return}var f=i.getSeriesByIndex(e);var h=f.coordinateSystem;if(h&&h.master){h=h.master}var p=[];i.eachSeries(function(e){var t=f===e;var r=e.coordinateSystem;if(r&&r.master){r=r.master}var i=r&&h?r===h:t;if(!(l==="series"&&!t||l==="coordinateSystem"&&!i||s==="series"&&t)){var n=u.getViewOfSeriesModel(e);n.group.traverse(function(e){Su(e)});if(se(s)){c(e.getData(),s)}else if(O(s)){var a=L(s);for(var o=0;o<a.length;o++){c(e.getData(a[o]),s[a[o]])}}p.push(e)}});i.eachComponent(function(e,t){if(e==="series"){return}var r=u.getViewOfComponentModel(t);if(r&&r.blurSeries){r.blurSeries(p,i)}})}function Yu(e,t,r){if(e==null||t==null){return}var i=r.getModel().getComponent(e,t);if(!i){return}var n=r.getViewOfComponentModel(i);if(!n||!n.focusBlurEnabled){return}n.group.traverse(function(e){Su(e)})}function Xu(e,t,r){var i=e.seriesIndex;var n=e.getData(t.dataType);var a=Xa(n,t);a=(k(a)?a[0]:a)||0;var o=n.getItemGraphicEl(a);if(!o){var s=n.count();var l=0;while(!o&&l<s){o=n.getItemGraphicEl(l++)}}if(o){var u=j(o);Zu(i,u.focus,u.blurScope,r)}else{var c=e.get(["emphasis","focus"]);var f=e.get(["emphasis","blurScope"]);if(c!=null){Zu(i,c,f,r)}}}function qu(e,t,r,i){var n={focusSelf:false,dispatchers:null};if(e==null||e==="series"||t==null||r==null){return n}var a=i.getModel().getComponent(e,t);if(!a){return n}var o=i.getViewOfComponentModel(a);if(!o||!o.findHighDownDispatchers){return n}var s=o.findHighDownDispatchers(r);var l;for(var u=0;u<s.length;u++){if("development"!=="production"&&!sc(s[u])){ma("param should be highDownDispatcher")}if(j(s[u]).focus==="self"){l=true;break}}return{focusSelf:l,dispatchers:s}}function Ju(e,t,r){if("development"!=="production"&&!sc(e)){ma("param should be highDownDispatcher")}var i=j(e);var n=qu(i.componentMainType,i.componentIndex,i.componentHighDownName,r),a=n.dispatchers,o=n.focusSelf;if(a){if(o){Yu(i.componentMainType,i.componentIndex,r)}U(a,function(e){return Ru(e,t)})}else{Zu(i.seriesIndex,i.focus,i.blurScope,r);if(i.focus==="self"){Yu(i.componentMainType,i.componentIndex,r)}Ru(e,t)}}function Ku(e,t,r){if("development"!=="production"&&!sc(e)){ma("param should be highDownDispatcher")}Uu(r);var i=j(e);var n=qu(i.componentMainType,i.componentIndex,i.componentHighDownName,r).dispatchers;if(n){U(n,function(e){return zu(e,t)})}else{zu(e,t)}}function Qu(e,t,r){if(!cc(t)){return}var i=t.dataType;var n=e.getData(i);var a=Xa(n,t);if(!k(a)){a=[a]}e[t.type===gu?"toggleSelect":t.type===vu?"select":"unselect"](a,i)}function $u(i){var e=i.getAllData();U(e,function(e){var t=e.data,r=e.type;t.eachItemGraphicEl(function(e,t){i.isSelected(t,r)?Hu(e):Wu(e)})})}function ec(e){var o=[];e.eachSeries(function(a){var e=a.getAllData();U(e,function(e){var t=e.data,r=e.type;var i=a.getSelectedDataIndices();if(i.length>0){var n={dataIndex:i,seriesIndex:a.seriesIndex};if(r!=null){n.dataType=r}o.push(n)}})});return o}function tc(e,t,r){oc(e,true);Du(e,Eu);rc(e,t,r)}function rc(e,t,r){var i=j(e);if(t!=null){i.focus=t;i.blurScope=r}else if(i.focus){i.focus=null}}var ic=["emphasis","blur","select"];var nc={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function ac(e,t,r,i){r=r||"itemStyle";for(var n=0;n<ic.length;n++){var a=ic[n];var o=t.getModel([a,r]);var s=e.ensureState(a);s.style=i?i(o):o[nc[r]]()}}function oc(e,t){var r=t===false;var i=e;if(e.highDownSilentOnTouch){i.__highDownSilentOnTouch=e.highDownSilentOnTouch}if(!r||i.__highDownDispatcher){i.__highByOuter=i.__highByOuter||0;i.__highDownDispatcher=!r}}function sc(e){return!!(e&&e.__highDownDispatcher)}function lc(e,t,r){var i=j(e);i.componentMainType=t.mainType;i.componentIndex=t.componentIndex;i.componentHighDownName=r}function uc(e){var t=iu[e];if(t==null&&ru<=32){t=iu[e]=ru++}return t}function cc(e){var t=e.type;return t===vu||t===du||t===gu}function fc(e){var t=e.type;return t===hu||t===pu}function hc(e){var t=nu(e);t.normalFill=e.style.fill;t.normalStroke=e.style.stroke;var r=e.states.select||{};t.selectFill=r.style&&r.style.fill||null;t.selectStroke=r.style&&r.style.stroke||null}var pc=ol.CMD;var vc=[[],[],[]];var dc=Math.sqrt;var gc=Math.atan2;function yc(e,t){var r=e.data;var i=e.len();var n;var a;var o;var s;var l;var u;var c=pc.M;var f=pc.C;var h=pc.L;var p=pc.R;var v=pc.A;var d=pc.Q;for(o=0,s=0;o<i;){n=r[o++];s=o;a=0;switch(n){case c:a=1;break;case h:a=1;break;case f:a=3;break;case d:a=2;break;case v:var g=t[4];var y=t[5];var m=dc(t[0]*t[0]+t[1]*t[1]);var x=dc(t[2]*t[2]+t[3]*t[3]);var _=gc(-t[1]/x,t[0]/m);r[o]*=m;r[o++]+=g;r[o]*=x;r[o++]+=y;r[o++]*=m;r[o++]*=x;r[o++]+=_;r[o++]+=_;o+=2;s=o;break;case p:u[0]=r[o++];u[1]=r[o++];rt(u,u,t);r[s++]=u[0];r[s++]=u[1];u[0]+=r[o++];u[1]+=r[o++];rt(u,u,t);r[s++]=u[0];r[s++]=u[1]}for(l=0;l<a;l++){var b=vc[l];b[0]=r[o++];b[1]=r[o++];rt(b,b,t);r[s++]=b[0];r[s++]=b[1]}}e.increaseVersion()}var mc=Math.sqrt;var xc=Math.sin;var _c=Math.cos;var bc=Math.PI;function wc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Sc(e,t){return(e[0]*t[0]+e[1]*t[1])/(wc(e)*wc(t))}function Mc(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Sc(e,t))}function Ic(e,t,r,i,n,a,o,s,l,u,c){var f=l*(bc/180);var h=_c(f)*(e-r)/2+xc(f)*(t-i)/2;var p=-1*xc(f)*(e-r)/2+_c(f)*(t-i)/2;var v=h*h/(o*o)+p*p/(s*s);if(v>1){o*=mc(v);s*=mc(v)}var d=(n===a?-1:1)*mc((o*o*(s*s)-o*o*(p*p)-s*s*(h*h))/(o*o*(p*p)+s*s*(h*h)))||0;var g=d*o*p/s;var y=d*-s*h/o;var m=(e+r)/2+_c(f)*g-xc(f)*y;var x=(t+i)/2+xc(f)*g+_c(f)*y;var _=Mc([1,0],[(h-g)/o,(p-y)/s]);var b=[(h-g)/o,(p-y)/s];var w=[(-1*h-g)/o,(-1*p-y)/s];var S=Mc(b,w);if(Sc(b,w)<=-1){S=bc}if(Sc(b,w)>=1){S=0}if(S<0){var M=Math.round(S/bc*1e6)/1e6;S=bc*2+M%2*bc}c.addData(u,m,x,o,s,_,S,f,a)}var Cc=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi;var Tc=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function Dc(e){var t=new ol;if(!e){return t}var r=0;var i=0;var n=r;var a=i;var o;var s=ol.CMD;var l=e.match(Cc);if(!l){return t}for(var u=0;u<l.length;u++){var c=l[u];var f=c.charAt(0);var h=void 0;var p=c.match(Tc)||[];var v=p.length;for(var d=0;d<v;d++){p[d]=parseFloat(p[d])}var g=0;while(g<v){var y=void 0;var m=void 0;var x=void 0;var _=void 0;var b=void 0;var w=void 0;var S=void 0;var M=r;var I=i;var C=void 0;var T=void 0;switch(f){case"l":r+=p[g++];i+=p[g++];h=s.L;t.addData(h,r,i);break;case"L":r=p[g++];i=p[g++];h=s.L;t.addData(h,r,i);break;case"m":r+=p[g++];i+=p[g++];h=s.M;t.addData(h,r,i);n=r;a=i;f="l";break;case"M":r=p[g++];i=p[g++];h=s.M;t.addData(h,r,i);n=r;a=i;f="L";break;case"h":r+=p[g++];h=s.L;t.addData(h,r,i);break;case"H":r=p[g++];h=s.L;t.addData(h,r,i);break;case"v":i+=p[g++];h=s.L;t.addData(h,r,i);break;case"V":i=p[g++];h=s.L;t.addData(h,r,i);break;case"C":h=s.C;t.addData(h,p[g++],p[g++],p[g++],p[g++],p[g++],p[g++]);r=p[g-2];i=p[g-1];break;case"c":h=s.C;t.addData(h,p[g++]+r,p[g++]+i,p[g++]+r,p[g++]+i,p[g++]+r,p[g++]+i);r+=p[g-2];i+=p[g-1];break;case"S":y=r;m=i;C=t.len();T=t.data;if(o===s.C){y+=r-T[C-4];m+=i-T[C-3]}h=s.C;M=p[g++];I=p[g++];r=p[g++];i=p[g++];t.addData(h,y,m,M,I,r,i);break;case"s":y=r;m=i;C=t.len();T=t.data;if(o===s.C){y+=r-T[C-4];m+=i-T[C-3]}h=s.C;M=r+p[g++];I=i+p[g++];r+=p[g++];i+=p[g++];t.addData(h,y,m,M,I,r,i);break;case"Q":M=p[g++];I=p[g++];r=p[g++];i=p[g++];h=s.Q;t.addData(h,M,I,r,i);break;case"q":M=p[g++]+r;I=p[g++]+i;r+=p[g++];i+=p[g++];h=s.Q;t.addData(h,M,I,r,i);break;case"T":y=r;m=i;C=t.len();T=t.data;if(o===s.Q){y+=r-T[C-4];m+=i-T[C-3]}r=p[g++];i=p[g++];h=s.Q;t.addData(h,y,m,r,i);break;case"t":y=r;m=i;C=t.len();T=t.data;if(o===s.Q){y+=r-T[C-4];m+=i-T[C-3]}r+=p[g++];i+=p[g++];h=s.Q;t.addData(h,y,m,r,i);break;case"A":x=p[g++];_=p[g++];b=p[g++];w=p[g++];S=p[g++];M=r,I=i;r=p[g++];i=p[g++];h=s.A;Ic(M,I,r,i,w,S,x,_,b,h,t);break;case"a":x=p[g++];_=p[g++];b=p[g++];w=p[g++];S=p[g++];M=r,I=i;r+=p[g++];i+=p[g++];h=s.A;Ic(M,I,r,i,w,S,x,_,b,h,t);break}}if(f==="z"||f==="Z"){h=s.Z;t.addData(h);r=n;i=a}o=h}t.toStatic();return t}var Ac=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.applyTransform=function(e){};return t}(m);function Lc(e){return e.setData!=null}function kc(e,t){var r=Dc(e);var i=F({},t);i.buildPath=function(e){if(Lc(e)){e.setData(r.data);var t=e.getContext();if(t){e.rebuildPath(t,1)}}else{var t=e;r.rebuildPath(t,1)}};i.applyTransform=function(e){yc(r,e);this.dirtyShape()};return i}function Pc(e,t){return new Ac(kc(e,t))}function Oc(e,t){var i=kc(e,t);var r=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.applyTransform=i.applyTransform;t.buildPath=i.buildPath;return t}return e}(Ac);return r}function Nc(e,t){var r=[];var i=e.length;for(var n=0;n<i;n++){var a=e[n];if(!a.path){a.createPathProxy()}if(a.shapeChanged()){a.buildPath(a.path,a.shape,true)}r.push(a.path)}var o=new m(t);o.createPathProxy();o.buildPath=function(e){if(Lc(e)){e.appendPath(r);var t=e.getContext();if(t){e.rebuildPath(t,1)}}};return o}var Ec=function(){function e(){this.cx=0;this.cy=0;this.r=0}return e}();var Rc=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new Ec};e.prototype.buildPath=function(e,t,r){if(r){e.moveTo(t.cx+t.r,t.cy)}e.arc(t.cx,t.cy,t.r,0,Math.PI*2)};return e}(m);Rc.prototype.type="circle";var zc=function(){function e(){this.cx=0;this.cy=0;this.rx=0;this.ry=0}return e}();var Bc=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new zc};e.prototype.buildPath=function(e,t){var r=.5522848;var i=t.cx;var n=t.cy;var a=t.rx;var o=t.ry;var s=a*r;var l=o*r;e.moveTo(i-a,n);e.bezierCurveTo(i-a,n-l,i-s,n-o,i,n-o);e.bezierCurveTo(i+s,n-o,i+a,n-l,i+a,n);e.bezierCurveTo(i+a,n+l,i+s,n+o,i,n+o);e.bezierCurveTo(i-s,n+o,i-a,n+l,i-a,n);e.closePath()};return e}(m);Bc.prototype.type="ellipse";var Vc=Math.PI;var Gc=Vc*2;var Fc=Math.sin;var Hc=Math.cos;var Wc=Math.acos;var jc=Math.atan2;var Uc=Math.abs;var Zc=Math.sqrt;var Yc=Math.max;var Xc=Math.min;var qc=1e-4;function Jc(e,t,r,i,n,a,o,s){var l=r-e;var u=i-t;var c=o-n;var f=s-a;var h=f*l-c*u;if(h*h<qc){return}h=(c*(t-a)-f*(e-n))/h;return[e+h*l,t+h*u]}function Kc(e,t,r,i,n,a,o){var s=e-r;var l=t-i;var u=(o?a:-a)/Zc(s*s+l*l);var c=u*l;var f=-u*s;var h=e+c;var p=t+f;var v=r+c;var d=i+f;var g=(h+v)/2;var y=(p+d)/2;var m=v-h;var x=d-p;var _=m*m+x*x;var b=n-a;var w=h*d-v*p;var S=(x<0?-1:1)*Zc(Yc(0,b*b*_-w*w));var M=(w*x-m*S)/_;var I=(-w*m-x*S)/_;var C=(w*x+m*S)/_;var T=(-w*m+x*S)/_;var D=M-g;var A=I-y;var L=C-g;var k=T-y;if(D*D+A*A>L*L+k*k){M=C;I=T}return{cx:M,cy:I,x01:-c,y01:-f,x11:M*(n/b-1),y11:I*(n/b-1)}}function Qc(e,t){var r=Yc(t.r,0);var i=Yc(t.r0||0,0);var n=r>0;var a=i>0;if(!n&&!a){return}if(!n){r=i;i=0}if(i>r){var o=r;r=i;i=o}var s=!!t.clockwise;var l=t.startAngle;var u=t.endAngle;var c;if(l===u){c=0}else{var f=[l,u];al(f,!s);c=Uc(f[0]-f[1])}var h=t.cx;var p=t.cy;var R=t.cornerRadius||0;var z=t.innerCornerRadius||0;if(!(r>qc)){e.moveTo(h,p)}else if(c>Gc-qc){e.moveTo(h+r*Hc(l),p+r*Fc(l));e.arc(h,p,r,l,u,!s);if(i>qc){e.moveTo(h+i*Hc(u),p+i*Fc(u));e.arc(h,p,i,u,l,s)}}else{var v=Uc(r-i)/2;var d=Xc(v,R);var g=Xc(v,z);var y=g;var m=d;var x=r*Hc(l);var _=r*Fc(l);var b=i*Hc(u);var w=i*Fc(u);var S=void 0;var M=void 0;var I=void 0;var C=void 0;if(d>qc||g>qc){S=r*Hc(u);M=r*Fc(u);I=i*Hc(l);C=i*Fc(l);if(c<Vc){var T=Jc(x,_,I,C,S,M,b,w);if(T){var D=x-T[0];var A=_-T[1];var L=S-T[0];var k=M-T[1];var P=1/Fc(Wc((D*L+A*k)/(Zc(D*D+A*A)*Zc(L*L+k*k)))/2);var O=Zc(T[0]*T[0]+T[1]*T[1]);y=Xc(g,(i-O)/(P-1));m=Xc(d,(r-O)/(P+1))}}}if(!(c>qc)){e.moveTo(h+x,p+_)}else if(m>qc){var N=Kc(I,C,x,_,r,m,s);var E=Kc(S,M,b,w,r,m,s);e.moveTo(h+N.cx+N.x01,p+N.cy+N.y01);if(m<d){e.arc(h+N.cx,p+N.cy,m,jc(N.y01,N.x01),jc(E.y01,E.x01),!s)}else{e.arc(h+N.cx,p+N.cy,m,jc(N.y01,N.x01),jc(N.y11,N.x11),!s);e.arc(h,p,r,jc(N.cy+N.y11,N.cx+N.x11),jc(E.cy+E.y11,E.cx+E.x11),!s);e.arc(h+E.cx,p+E.cy,m,jc(E.y11,E.x11),jc(E.y01,E.x01),!s)}}else{e.moveTo(h+x,p+_);e.arc(h,p,r,l,u,!s)}if(!(i>qc)||!(c>qc)){e.lineTo(h+b,p+w)}else if(y>qc){var N=Kc(b,w,S,M,i,-y,s);var E=Kc(x,_,I,C,i,-y,s);e.lineTo(h+N.cx+N.x01,p+N.cy+N.y01);if(y<g){e.arc(h+N.cx,p+N.cy,y,jc(N.y01,N.x01),jc(E.y01,E.x01),!s)}else{e.arc(h+N.cx,p+N.cy,y,jc(N.y01,N.x01),jc(N.y11,N.x11),!s);e.arc(h,p,i,jc(N.cy+N.y11,N.cx+N.x11),jc(E.cy+E.y11,E.cx+E.x11),s);e.arc(h+E.cx,p+E.cy,y,jc(E.y11,E.x11),jc(E.y01,E.x01),!s)}}else{e.lineTo(h+b,p+w);e.arc(h,p,i,u,l,s)}}e.closePath()}var $c=function(){function e(){this.cx=0;this.cy=0;this.r0=0;this.r=0;this.startAngle=0;this.endAngle=Math.PI*2;this.clockwise=true;this.cornerRadius=0;this.innerCornerRadius=0}return e}();var ef=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new $c};e.prototype.buildPath=function(e,t){Qc(e,t)};e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0};return e}(m);ef.prototype.type="sector";var tf=function(){function e(){this.cx=0;this.cy=0;this.r=0;this.r0=0}return e}();var rf=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new tf};e.prototype.buildPath=function(e,t){var r=t.cx;var i=t.cy;var n=Math.PI*2;e.moveTo(r+t.r,i);e.arc(r,i,t.r,0,n,false);e.moveTo(r+t.r0,i);e.arc(r,i,t.r0,0,n,true)};return e}(m);rf.prototype.type="ring";function nf(e,t,r,i,n,a,o){var s=(r-e)*.5;var l=(i-t)*.5;return(2*(t-r)+s+l)*o+(-3*(t-r)-2*s-l)*a+s*n+t}function af(e,t){var r=e.length;var i=[];var n=0;for(var a=1;a<r;a++){n+=Je(e[a-1],e[a])}var o=n/2;o=o<r?r:o;for(var a=0;a<o;a++){var s=a/(o-1)*(t?r:r-1);var l=Math.floor(s);var u=s-l;var c=void 0;var f=e[l%r];var h=void 0;var p=void 0;if(!t){c=e[l===0?l:l-1];h=e[l>r-2?r-1:l+1];p=e[l>r-3?r-1:l+2]}else{c=e[(l-1+r)%r];h=e[(l+1)%r];p=e[(l+2)%r]}var v=u*u;var d=u*v;i.push([nf(c[0],f[0],h[0],p[0],u,v,d),nf(c[1],f[1],h[1],p[1],u,v,d)])}return i}function of(e,t,r,i){var n=[];var a=[];var o=[];var s=[];var l;var u;var c;var f;if(i){c=[Infinity,Infinity];f=[-Infinity,-Infinity];for(var h=0,p=e.length;h<p;h++){it(c,c,e[h]);nt(f,f,e[h])}it(c,c,i[0]);nt(f,f,i[1])}for(var h=0,p=e.length;h<p;h++){var v=e[h];if(r){l=e[h?h-1:p-1];u=e[(h+1)%p]}else{if(h===0||h===p-1){n.push(Re(e[h]));continue}else{l=e[h-1];u=e[h+1]}}Ge(a,u,l);Xe(a,a,t);var d=Je(v,l);var g=Je(v,u);var y=d+g;if(y!==0){d/=y;g/=y}Xe(o,a,-d);Xe(s,a,g);var m=Be([],v,o);var x=Be([],v,s);if(i){nt(m,m,c);it(m,m,f);nt(x,x,c);it(x,x,f)}n.push(m);n.push(x)}if(r){n.push(n.shift())}return n}function sf(e,t,r){var i=t.smooth;var n=t.points;if(n&&n.length>=2){if(i&&i!=="spline"){var a=of(n,i,r,t.smoothConstraint);e.moveTo(n[0][0],n[0][1]);var o=n.length;for(var s=0;s<(r?o:o-1);s++){var l=a[s*2];var u=a[s*2+1];var c=n[(s+1)%o];e.bezierCurveTo(l[0],l[1],u[0],u[1],c[0],c[1])}}else{if(i==="spline"){n=af(n,r)}e.moveTo(n[0][0],n[0][1]);for(var s=1,f=n.length;s<f;s++){e.lineTo(n[s][0],n[s][1])}}r&&e.closePath()}}var lf=function(){function e(){this.points=null;this.smooth=0;this.smoothConstraint=null}return e}();var uf=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new lf};e.prototype.buildPath=function(e,t){sf(e,t,true)};return e}(m);uf.prototype.type="polygon";var cf=function(){function e(){this.points=null;this.percent=1;this.smooth=0;this.smoothConstraint=null}return e}();var ff=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new cf};e.prototype.buildPath=function(e,t){sf(e,t,false)};return e}(m);ff.prototype.type="polyline";var hf={};var pf=function(){function e(){this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.percent=1}return e}();var vf=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new pf};e.prototype.buildPath=function(e,t){var r;var i;var n;var a;if(this.subPixelOptimize){var o=Vl(hf,t,this.style);r=o.x1;i=o.y1;n=o.x2;a=o.y2}else{r=t.x1;i=t.y1;n=t.x2;a=t.y2}var s=t.percent;if(s===0){return}e.moveTo(r,i);if(s<1){n=r*(1-s)+n*s;a=i*(1-s)+a*s}e.lineTo(n,a)};e.prototype.pointAt=function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]};return e}(m);vf.prototype.type="line";var df=[];var gf=function(){function e(){this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.cpx1=0;this.cpy1=0;this.percent=1}return e}();function yf(e,t,r){var i=e.cpx2;var n=e.cpy2;if(i===null||n===null){return[(r?ps:hs)(e.x1,e.cpx1,e.cpx2,e.x2,t),(r?ps:hs)(e.y1,e.cpy1,e.cpy2,e.y2,t)]}else{return[(r?_s:xs)(e.x1,e.cpx1,e.x2,t),(r?_s:xs)(e.y1,e.cpy1,e.y2,t)]}}var mf=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new gf};e.prototype.buildPath=function(e,t){var r=t.x1;var i=t.y1;var n=t.x2;var a=t.y2;var o=t.cpx1;var s=t.cpy1;var l=t.cpx2;var u=t.cpy2;var c=t.percent;if(c===0){return}e.moveTo(r,i);if(l==null||u==null){if(c<1){Ss(r,o,n,c,df);o=df[1];n=df[2];Ss(i,s,a,c,df);s=df[1];a=df[2]}e.quadraticCurveTo(o,s,n,a)}else{if(c<1){gs(r,o,l,n,c,df);o=df[1];l=df[2];n=df[3];gs(i,s,u,a,c,df);s=df[1];u=df[2];a=df[3]}e.bezierCurveTo(o,s,l,u,n,a)}};e.prototype.pointAt=function(e){return yf(this.shape,e,false)};e.prototype.tangentAt=function(e){var t=yf(this.shape,e,true);return qe(t,t)};return e}(m);mf.prototype.type="bezier-curve";var xf=function(){function e(){this.cx=0;this.cy=0;this.r=0;this.startAngle=0;this.endAngle=Math.PI*2;this.clockwise=true}return e}();var _f=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new xf};e.prototype.buildPath=function(e,t){var r=t.cx;var i=t.cy;var n=Math.max(t.r,0);var a=t.startAngle;var o=t.endAngle;var s=t.clockwise;var l=Math.cos(a);var u=Math.sin(a);e.moveTo(l*n+r,u*n+i);e.arc(r,i,n,a,o,!s)};return e}(m);_f.prototype.type="arc";var bf=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="compound";return e}e.prototype._updatePathDirty=function(){var e=this.shape.paths;var t=this.shapeChanged();for(var r=0;r<e.length;r++){t=t||e[r].shapeChanged()}if(t){this.dirtyShape()}};e.prototype.beforeBrush=function(){this._updatePathDirty();var e=this.shape.paths||[];var t=this.getGlobalScale();for(var r=0;r<e.length;r++){if(!e[r].path){e[r].createPathProxy()}e[r].path.setScale(t[0],t[1],e[r].segmentIgnoreThreshold)}};e.prototype.buildPath=function(e,t){var r=t.paths||[];for(var i=0;i<r.length;i++){r[i].buildPath(e,r[i].shape,true)}};e.prototype.afterBrush=function(){var e=this.shape.paths||[];for(var t=0;t<e.length;t++){e[t].pathUpdated()}};e.prototype.getBoundingRect=function(){this._updatePathDirty.call(this);return m.prototype.getBoundingRect.call(this)};return e}(m);var wf=function(){function e(e){this.colorStops=e||[]}e.prototype.addColorStop=function(e,t){this.colorStops.push({offset:e,color:t})};return e}();var Sf=function(s){d(e,s);function e(e,t,r,i,n,a){var o=s.call(this,n)||this;o.x=e==null?0:e;o.y=t==null?0:t;o.x2=r==null?1:r;o.y2=i==null?0:i;o.type="linear";o.global=a||false;return o}return e}(wf);var Mf=function(o){d(e,o);function e(e,t,r,i,n){var a=o.call(this,i)||this;a.x=e==null?.5:e;a.y=t==null?.5:t;a.r=r==null?.5:r;a.type="radial";a.global=n||false;return a}return e}(wf);var If=[0,0];var Cf=[0,0];var Tf=new Z;var Df=new Z;var Af=function(){function e(e,t){this._corners=[];this._axes=[];this._origin=[0,0];for(var r=0;r<4;r++){this._corners[r]=new Z}for(var r=0;r<2;r++){this._axes[r]=new Z}if(e){this.fromBoundingRect(e,t)}}e.prototype.fromBoundingRect=function(e,t){var r=this._corners;var i=this._axes;var n=e.x;var a=e.y;var o=n+e.width;var s=a+e.height;r[0].set(n,a);r[1].set(o,a);r[2].set(o,s);r[3].set(n,s);if(t){for(var l=0;l<4;l++){r[l].transform(t)}}Z.sub(i[0],r[1],r[0]);Z.sub(i[1],r[3],r[0]);i[0].normalize();i[1].normalize();for(var l=0;l<2;l++){this._origin[l]=i[l].dot(r[0])}};e.prototype.intersect=function(e,t){var r=true;var i=!t;Tf.set(Infinity,Infinity);Df.set(0,0);if(!this._intersectCheckOneSide(this,e,Tf,Df,i,1)){r=false;if(i){return r}}if(!this._intersectCheckOneSide(e,this,Tf,Df,i,-1)){r=false;if(i){return r}}if(!i){Z.copy(t,r?Tf:Df)}return r};e.prototype._intersectCheckOneSide=function(e,t,r,i,n,a){var o=true;for(var s=0;s<2;s++){var l=this._axes[s];this._getProjMinMaxOnAxis(s,e._corners,If);this._getProjMinMaxOnAxis(s,t._corners,Cf);if(If[1]<Cf[0]||If[0]>Cf[1]){o=false;if(n){return o}var u=Math.abs(Cf[0]-If[1]);var c=Math.abs(If[0]-Cf[1]);if(Math.min(u,c)>i.len()){if(u<c){Z.scale(i,l,-u*a)}else{Z.scale(i,l,c*a)}}}else if(r){var u=Math.abs(Cf[0]-If[1]);var c=Math.abs(If[0]-Cf[1]);if(Math.min(u,c)<r.len()){if(u<c){Z.scale(r,l,u*a)}else{Z.scale(r,l,-c*a)}}}}return o};e.prototype._getProjMinMaxOnAxis=function(e,t,r){var i=this._axes[e];var n=this._origin;var a=t[0].dot(i)+n[e];var o=a;var s=a;for(var l=1;l<t.length;l++){var u=t[l].dot(i)+n[e];o=Math.min(u,o);s=Math.max(u,s)}r[0]=o;r[1]=s};return e}();var Lf=[];var kf=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.notClear=true;e.incremental=true;e._displayables=[];e._temporaryDisplayables=[];e._cursor=0;return e}e.prototype.traverse=function(e,t){e.call(t,this)};e.prototype.useStyle=function(){this.style={}};e.prototype.getCursor=function(){return this._cursor};e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length};e.prototype.clearDisplaybles=function(){this._displayables=[];this._temporaryDisplayables=[];this._cursor=0;this.markRedraw();this.notClear=false};e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]};e.prototype.addDisplayable=function(e,t){if(t){this._temporaryDisplayables.push(e)}else{this._displayables.push(e)}this.markRedraw()};e.prototype.addDisplayables=function(e,t){t=t||false;for(var r=0;r<e.length;r++){this.addDisplayable(e[r],t)}};e.prototype.getDisplayables=function(){return this._displayables};e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables};e.prototype.eachPendingDisplayable=function(e){for(var t=this._cursor;t<this._displayables.length;t++){e&&e(this._displayables[t])}for(var t=0;t<this._temporaryDisplayables.length;t++){e&&e(this._temporaryDisplayables[t])}};e.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var t=this._displayables[e];t.parent=this;t.update();t.parent=null}for(var e=0;e<this._temporaryDisplayables.length;e++){var t=this._temporaryDisplayables[e];t.parent=this;t.update();t.parent=null}};e.prototype.getBoundingRect=function(){if(!this._rect){var e=new B(Infinity,Infinity,-Infinity,-Infinity);for(var t=0;t<this._displayables.length;t++){var r=this._displayables[t];var i=r.getBoundingRect().clone();if(r.needLocalTransform()){i.applyTransform(r.getLocalTransform(Lf))}e.union(i)}this._rect=e}return this._rect};e.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);var i=this.getBoundingRect();if(i.contain(r[0],r[1])){for(var n=0;n<this._displayables.length;n++){var a=this._displayables[n];if(a.contain(e,t)){return true}}}return false};return e}(Ko);var Pf=Math.max;var Of=Math.min;var Nf={};function Ef(e){return m.extend(e)}var Rf=Oc;function zf(e,t){return Rf(e,t)}function Bf(e,t){Nf[e]=t}function Vf(e){if(Nf.hasOwnProperty(e)){return Nf[e]}}function Gf(e,t,r,i){var n=Pc(e,t);if(r){if(i==="center"){r=Hf(r,n.getBoundingRect())}jf(n,r)}return n}function Ff(e,r,i){var n=new Rl({style:{image:e,x:r.x,y:r.y,width:r.width,height:r.height},onload:function(e){if(i==="center"){var t={width:e.width,height:e.height};n.setStyle(Hf(r,t))}}});return n}function Hf(e,t){var r=t.width/t.height;var i=e.height*r;var n;if(i<=e.width){n=e.height}else{i=e.width;n=i/r}var a=e.x+e.width/2;var o=e.y+e.height/2;return{x:a-i/2,y:o-n/2,width:i,height:n}}var Wf=Nc;function jf(e,t){if(!e.applyTransform){return}var r=e.getBoundingRect();var i=r.calculateTransform(t);e.applyTransform(i)}function Uf(e){Vl(e.shape,e.shape,e.style);return e}function Zf(e){Gl(e.shape,e.shape,e.style);return e}var Yf=Fl;function Xf(e,t,r,i,n,a,o){var s=false;var l;if(typeof n==="function"){o=a;a=n;n=null}else if(O(n)){a=n.cb;o=n.during;s=n.isFrom;l=n.removeOpt;n=n.dataIndex}var u=e==="update";var c=e==="remove";var f;if(i&&i.ecModel){var h=i.ecModel.getUpdatePayload();f=h&&h.animation}var p=i&&i.isAnimationEnabled();if(!c){t.stopAnimation("remove")}if(p){var v=void 0;var d=void 0;var g=void 0;if(f){v=f.duration||0;d=f.easing||"cubicOut";g=f.delay||0}else if(c){l=l||{};v=N(l.duration,200);d=N(l.easing,"cubicOut");g=0}else{v=i.getShallow(u?"animationDurationUpdate":"animationDuration");d=i.getShallow(u?"animationEasingUpdate":"animationEasing");g=i.getShallow(u?"animationDelayUpdate":"animationDelay")}if(typeof g==="function"){g=g(n,i.getAnimationDelayParams?i.getAnimationDelayParams(t,n):null)}if(typeof v==="function"){v=v(n)}v>0?s?t.animateFrom(r,{duration:v,delay:g||0,easing:d,done:a,force:!!a||!!o,scope:e,during:o}):t.animateTo(r,{duration:v,delay:g||0,easing:d,done:a,force:!!a||!!o,setToFinal:true,scope:e,during:o}):(t.stopAnimation(),!s&&t.attr(r),a&&a())}else{t.stopAnimation();!s&&t.attr(r);o&&o(1);a&&a()}}function X(e,t,r,i,n,a){Xf("update",e,t,r,i,n,a)}function qf(e,t,r,i,n,a){Xf("init",e,t,r,i,n,a)}function Jf(e,t,r,i,n,a){if($f(e)){return}Xf("remove",e,t,r,i,n,a)}function Kf(e,t,r,i){e.removeTextContent();e.removeTextGuideLine();Jf(e,{style:{opacity:0}},t,r,i)}function Qf(e,t,r){function i(){e.parent&&e.parent.remove(e)}if(!e.isGroup){Kf(e,t,r,i)}else{e.traverse(function(e){if(!e.isGroup){Kf(e,t,r,i)}})}}function $f(e){if(!e.__zr){return true}for(var t=0;t<e.animators.length;t++){var r=e.animators[t];if(r.scope==="remove"){return true}}return false}function eh(e,t){var r=Oi([]);while(e&&e!==t){Ei(r,e.getLocalTransform(),r);e=e.parent}return r}function th(e,t,r){if(t&&!se(t)){t=qi.getLocalTransform(t)}if(r){t=Vi([],t)}return rt([],e,t)}function rh(e,t,r){var i=t[4]===0||t[5]===0||t[0]===0?1:Math.abs(2*t[4]/t[0]);var n=t[4]===0||t[5]===0||t[2]===0?1:Math.abs(2*t[4]/t[2]);var a=[e==="left"?-i:e==="right"?i:0,e==="top"?-n:e==="bottom"?n:0];a=th(a,t,r);return Math.abs(a[0])>Math.abs(a[1])?a[0]>0?"right":"left":a[1]>0?"bottom":"top"}function ih(e){return!e.isGroup}function nh(e){return e.shape!=null}function ah(e,t,i){if(!e||!t){return}function r(e){var t={};e.traverse(function(e){if(ih(e)&&e.anid){t[e.anid]=e}});return t}function n(e){var t={x:e.x,y:e.y,rotation:e.rotation};if(nh(e)){t.shape=F({},e.shape)}return t}var a=r(e);t.traverse(function(e){if(ih(e)&&e.anid){var t=a[e.anid];if(t){var r=n(e);e.attr(n(t));X(e,r,i,j(e).dataIndex)}}})}function oh(e,i){return A(e,function(e){var t=e[0];t=Pf(t,i.x);t=Of(t,i.x+i.width);var r=e[1];r=Pf(r,i.y);r=Of(r,i.y+i.height);return[t,r]})}function sh(e,t){var r=Pf(e.x,t.x);var i=Of(e.x+e.width,t.x+t.width);var n=Pf(e.y,t.y);var a=Of(e.y+e.height,t.y+t.height);if(i>=r&&a>=n){return{x:r,y:n,width:i-r,height:a-n}}}function lh(e,t,r){var i=F({rectHover:true},t);var n=i.style={strokeNoScale:true};r=r||{x:-1,y:-1,width:2,height:2};if(e){return e.indexOf("image://")===0?(n.image=e.slice(8),R(n,r),new Rl(i)):Gf(e.replace("path://",""),i,r,"center")}}function uh(e,t,r,i,n){for(var a=0,o=n[n.length-1];a<n.length;a++){var s=n[a];if(ch(e,t,r,i,s[0],s[1],o[0],o[1])){return true}o=s}}function ch(e,t,r,i,n,a,o,s){var l=r-e;var u=i-t;var c=o-n;var f=s-a;var h=fh(c,f,l,u);if(hh(h)){return false}var p=e-n;var v=t-a;var d=fh(p,v,l,u)/h;if(d<0||d>1){return false}var g=fh(p,v,c,f)/h;if(g<0||g>1){return false}return true}function fh(e,t,r,i){return e*i-r*t}function hh(e){return e<=1e-6&&e>=-1e-6}function ph(e){var t=e.itemTooltipOption;var r=e.componentModel;var i=e.itemName;var n=P(t)?{formatter:t}:t;var a=r.mainType;var o=r.componentIndex;var s={componentType:a,name:i,$vars:["name"]};s[a+"Index"]=o;var l=e.formatterParamsExtra;if(l){U(L(l),function(e){if(!z(s,e)){s[e]=l[e];s.$vars.push(e)}})}var u=j(e.el);u.componentMainType=a;u.componentIndex=o;u.tooltipConfig={name:i,option:R({content:i,formatterParams:s},n)}}Bf("circle",Rc);Bf("ellipse",Bc);Bf("sector",ef);Bf("ring",rf);Bf("polygon",uf);Bf("polyline",ff);Bf("rect",G);Bf("line",vf);Bf("bezierCurve",mf);Bf("arc",_f);var vh=Object.freeze({__proto__:null,extendShape:Ef,extendPath:zf,registerShape:Bf,getShapeClass:Vf,makePath:Gf,makeImage:Ff,mergePath:Wf,resizePath:jf,subPixelOptimizeLine:Uf,subPixelOptimizeRect:Zf,subPixelOptimize:Yf,updateProps:X,initProps:qf,removeElement:Jf,removeElementWithFadeOut:Qf,isElementRemoved:$f,getTransform:eh,applyTransform:th,transformDirection:rh,groupTransition:ah,clipPointsByRect:oh,clipRectByRect:sh,createIcon:lh,linePolygonIntersect:uh,lineLineIntersect:ch,setTooltipConfig:ph,Group:H,Image:Rl,Text:W,Circle:Rc,Ellipse:Bc,Sector:ef,Ring:rf,Polygon:uf,Polyline:ff,Rect:G,Line:vf,BezierCurve:mf,Arc:_f,IncrementalDisplayable:kf,CompoundPath:bf,LinearGradient:Sf,RadialGradient:Mf,BoundingRect:B,OrientedBoundingRect:Af,Point:Z,Path:m});var dh={};function gh(e,t){for(var r=0;r<lu.length;r++){var i=lu[r];var n=t[i];var a=e.ensureState(i);a.style=a.style||{};a.style.text=n}var o=e.currentStates.slice();e.clearStates(true);e.setStyle({text:t.normal});e.useStates(o,true)}function yh(e,t,r){var i=e.labelFetcher;var n=e.labelDataIndex;var a=e.labelDimIndex;var o=t.normal;var s;if(i){s=i.getFormattedLabel(n,"normal",null,a,o&&o.get("formatter"),r!=null?{interpolatedValue:r}:null)}if(s==null){s=b(e.defaultText)?e.defaultText(n,e,r):e.defaultText}var l={normal:s};for(var u=0;u<lu.length;u++){var c=lu[u];var f=t[c];l[c]=N(i?i.getFormattedLabel(n,c,null,a,f&&f.get("formatter")):null,s)}return l}function mh(e,r,i,t){i=i||dh;var n=e instanceof W;var a=false;for(var o=0;o<uu.length;o++){var s=r[uu[o]];if(s&&s.getShallow("show")){a=true;break}}var l=n?e:e.getTextContent();if(a){if(!n){if(!l){l=new W;e.setTextContent(l)}if(e.stateProxy){l.stateProxy=e.stateProxy}}var u=yh(i,r);var c=r.normal;var f=!!c.getShallow("show");var h=_h(c,t&&t.normal,i,false,!n);h.text=u.normal;if(!n){e.setTextConfig(bh(c,i,false))}for(var o=0;o<lu.length;o++){var p=lu[o];var s=r[p];if(s){var v=l.ensureState(p);var d=!!N(s.getShallow("show"),f);if(d!==f){v.ignore=!d}v.style=_h(s,t&&t[p],i,true,!n);v.style.text=u[p];if(!n){var g=e.ensureState(p);g.textConfig=bh(s,i,true)}}}l.silent=!!c.getShallow("silent");if(l.style.x!=null){h.x=l.style.x}if(l.style.y!=null){h.y=l.style.y}l.ignore=!f;l.useStyle(h);l.dirty();if(i.enableTextSetter){Ah(l).setLabelText=function(e){var t=yh(i,r,e);gh(l,t)}}}else if(l){l.ignore=true}e.dirty()}function xh(e,t){t=t||"label";var r={normal:e.getModel(t)};for(var i=0;i<lu.length;i++){var n=lu[i];r[n]=e.getModel([n,t])}return r}function _h(e,t,r,i,n){var a={};wh(a,e,r,i,n);t&&F(a,t);return a}function bh(e,t,r){t=t||{};var i={};var n;var a=e.getShallow("rotate");var o=N(e.getShallow("distance"),r?null:5);var s=e.getShallow("offset");n=e.getShallow("position")||(r?null:"inside");n==="outside"&&(n=t.defaultOutsidePosition||"top");if(n!=null){i.position=n}if(s!=null){i.offset=s}if(a!=null){a*=Math.PI/180;i.rotation=a}if(o!=null){i.distance=o}i.outsideFill=e.get("color")==="inherit"?t.inheritColor||null:"auto";return i}function wh(e,t,r,i,n){r=r||dh;var a=t.ecModel;var o=a&&a.option.textStyle;var s=Sh(t);var l;if(s){l={};for(var u in s){if(s.hasOwnProperty(u)){var c=t.getModel(["rich",u]);Th(l[u]={},c,o,r,i,n,false,true)}}}if(l){e.rich=l}var f=t.get("overflow");if(f){e.overflow=f}var h=t.get("minMargin");if(h!=null){e.margin=h}Th(e,t,o,r,i,n,true,false)}function Sh(e){var t;while(e&&e!==e.ecModel){var r=(e.option||dh).rich;if(r){t=t||{};var i=L(r);for(var n=0;n<i.length;n++){var a=i[n];t[a]=1}}e=e.parentModel}return t}var Mh=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"];var Ih=["align","lineHeight","width","height","tag","verticalAlign"];var Ch=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function Th(e,t,r,i,n,a,o,s){r=!n&&r||dh;var l=i&&i.inheritColor;var u=t.getShallow("color");var c=t.getShallow("textBorderColor");var f=N(t.getShallow("opacity"),r.opacity);if(u==="inherit"||u==="auto"){if("development"!=="production"){if(u==="auto"){_a("color: 'auto'","color: 'inherit'")}}if(l){u=l}else{u=null}}if(c==="inherit"||c==="auto"){if("development"!=="production"){if(c==="auto"){_a("color: 'auto'","color: 'inherit'")}}if(l){c=l}else{c=null}}if(!a){u=u||r.color;c=c||r.textBorderColor}if(u!=null){e.fill=u}if(c!=null){e.stroke=c}var h=N(t.getShallow("textBorderWidth"),r.textBorderWidth);if(h!=null){e.lineWidth=h}var p=N(t.getShallow("textBorderType"),r.textBorderType);if(p!=null){e.lineDash=p}var v=N(t.getShallow("textBorderDashOffset"),r.textBorderDashOffset);if(v!=null){e.lineDashOffset=v}if(!n&&f==null&&!s){f=i&&i.defaultOpacity}if(f!=null){e.opacity=f}if(!n&&!a){if(e.fill==null&&i.inheritColor){e.fill=i.inheritColor}}for(var d=0;d<Mh.length;d++){var g=Mh[d];var y=N(t.getShallow(g),r[g]);if(y!=null){e[g]=y}}for(var d=0;d<Ih.length;d++){var g=Ih[d];var y=t.getShallow(g);if(y!=null){e[g]=y}}if(e.verticalAlign==null){var m=t.getShallow("baseline");if(m!=null){e.verticalAlign=m}}if(!o||!i.disableBox){for(var d=0;d<Ch.length;d++){var g=Ch[d];var y=t.getShallow(g);if(y!=null){e[g]=y}}var x=t.getShallow("borderType");if(x!=null){e.borderDash=x}if((e.backgroundColor==="auto"||e.backgroundColor==="inherit")&&l){if("development"!=="production"){if(e.backgroundColor==="auto"){_a("backgroundColor: 'auto'","backgroundColor: 'inherit'")}}e.backgroundColor=l}if((e.borderColor==="auto"||e.borderColor==="inherit")&&l){if("development"!=="production"){if(e.borderColor==="auto"){_a("borderColor: 'auto'","borderColor: 'inherit'")}}e.borderColor=l}}}function Dh(e,t){var r=t&&t.getModel("textStyle");return Ie([e.fontStyle||r&&r.getShallow("fontStyle")||"",e.fontWeight||r&&r.getShallow("fontWeight")||"",(e.fontSize||r&&r.getShallow("fontSize")||12)+"px",e.fontFamily||r&&r.getShallow("fontFamily")||"sans-serif"].join(" "))}var Ah=qa();function Lh(e,t,r,i){if(!e){return}var n=Ah(e);n.prevValue=n.value;n.value=r;var a=t.normal;n.valueAnimation=a.get("valueAnimation");if(n.valueAnimation){n.precision=a.get("precision");n.defaultInterpolatedText=i;n.statesModels=t}}function kh(i,n,a,e,o){var s=Ah(i);if(!s.valueAnimation){return}var l=s.defaultInterpolatedText;var u=N(s.interpolatedValue,s.prevValue);var c=s.value;function t(e){var t=oo(a,s.precision,u,c,e);s.interpolatedValue=e===1?null:t;var r=yh({labelDataIndex:n,labelFetcher:o,defaultText:l?l(t):t+""},s.statesModels,t);gh(i,r)}(u==null?qf:X)(i,{},e,n,null,t)}var Ph=["textStyle","color"];var Oh=new W;var Nh=function(){function e(){}e.prototype.getTextColor=function(e){var t=this.ecModel;return this.getShallow("color")||(!e&&t?t.get(Ph):null)};e.prototype.getFont=function(){return Dh({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)};e.prototype.getTextRect=function(e){Oh.useStyle({text:e,fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily"),verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline"),padding:this.getShallow("padding"),lineHeight:this.getShallow("lineHeight"),rich:this.getShallow("rich")});Oh.update();return Oh.getBoundingRect()};return e}();var Eh=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]];var Rh=wo(Eh);var zh=function(){function e(){}e.prototype.getLineStyle=function(e){return Rh(this,e)};return e}();var Bh=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]];var Vh=wo(Bh);var Gh=function(){function e(){}e.prototype.getItemStyle=function(e,t){return Vh(this,e,t)};return e}();var C=function(){function a(e,t,r){this.parentModel=t;this.ecModel=r;this.option=e}a.prototype.init=function(e,t,r){var i=[];for(var n=3;n<arguments.length;n++){i[n-3]=arguments[n]}};a.prototype.mergeOption=function(e,t){y(this.option,e,true)};a.prototype.get=function(e,t){if(e==null){return this.option}return this._doGet(this.parsePath(e),!t&&this.parentModel)};a.prototype.getShallow=function(e,t){var r=this.option;var i=r==null?r:r[e];if(i==null&&!t){var n=this.parentModel;if(n){i=n.getShallow(e)}}return i};a.prototype.getModel=function(e,t){var r=e!=null;var i=r?this.parsePath(e):null;var n=r?this._doGet(i):this.option;t=t||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(i));return new a(n,t,this.ecModel)};a.prototype.isEmpty=function(){return this.option==null};a.prototype.restoreData=function(){};a.prototype.clone=function(){var e=this.constructor;return new e(M(this.option))};a.prototype.parsePath=function(e){if(typeof e==="string"){return e.split(".")}return e};a.prototype.resolveParentPath=function(e){return e};a.prototype.isAnimationEnabled=function(){if(!S.node&&this.option){if(this.option.animation!=null){return!!this.option.animation}else if(this.parentModel){return this.parentModel.isAnimationEnabled()}}};a.prototype._doGet=function(e,t){var r=this.option;if(!e){return r}for(var i=0;i<e.length;i++){if(!e[i]){continue}r=r&&typeof r==="object"?r[e[i]]:null;if(r==null){break}}if(r==null&&t){r=t._doGet(this.resolveParentPath(e),t.parentModel)}return r};return a}();po(C);mo(C);oe(C,zh);oe(C,Gh);oe(C,Io);oe(C,Nh);var Fh=Math.round(Math.random()*10);function Hh(e){return[e||"",Fh++].join("_")}function Wh(n){var a={};n.registerSubTypeDefaulter=function(e,t){var r=co(e);a[r.main]=t};n.determineSubType=function(e,t){var r=t.type;if(!r){var i=co(e).main;if(n.hasSubTypes(e)&&a[i]){r=a[i](t)}}return r}}function jh(e,s){e.topologicalTravel=function(t,r,e,i){if(!t.length){return}var n=p(r);var a=n.graph;var o=n.noEntryList;var s={};U(t,function(e){s[e]=true});while(o.length){var l=o.pop();var u=a[l];var c=!!s[l];if(c){e.call(i,l,u.originalDeps.slice());delete s[l]}U(u.successor,c?h:f)}U(s,function(){var e="";if("development"!=="production"){e=wa("Circular dependency may exists: ",s,t,r)}throw new Error(e)});function f(e){a[e].entryCount--;if(a[e].entryCount===0){o.push(e)}}function h(e){s[e]=true;f(e)}};function p(n){var a={};var o=[];U(n,function(r){var i=l(a,r);var e=i.originalDeps=s(r);var t=u(e,n);i.entryCount=t.length;if(i.entryCount===0){o.push(r)}U(t,function(e){if(D(i.predecessor,e)<0){i.predecessor.push(e)}var t=l(a,e);if(D(t.successor,e)<0){t.successor.push(r)}})});return{graph:a,noEntryList:o}}function l(e,t){if(!e[t]){e[t]={predecessor:[],successor:[]}}return e[t]}function u(e,t){var r=[];U(e,function(e){D(t,e)>=0&&r.push(e)});return r}}function Uh(e,t){return y(y({},e,true),t,true)}var Zh={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}};var Yh={time:{month:["","","","","","","","","","","",""],monthAbbr:["1","2","3","4","5","6","7","8","9","10","11","12"],dayOfWeek:["","","","","","",""],dayOfWeekAbbr:["","","","","","",""]},legend:{selector:{all:"",inverse:""}},toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}};var Xh="ZH";var qh="EN";var Jh=qh;var Kh={};var Qh={};var $h=!S.domSupported?Jh:function(){var e=(document.documentElement.lang||navigator.language||navigator.browserLanguage).toUpperCase();return e.indexOf(Xh)>-1?Xh:Jh}();function ep(e,t){e=e.toUpperCase();Qh[e]=new C(t);Kh[e]=t}function tp(e){if(P(e)){var t=Kh[e.toUpperCase()]||{};if(e===Xh||e===qh){return M(t)}else{return y(M(t),M(Kh[Jh]),false)}}else{return y(M(e),M(Kh[Jh]),false)}}function rp(e){return Qh[e]}function ip(){return Qh[Jh]}ep(qh,Zh);ep(Xh,Yh);var np=1e3;var ap=np*60;var op=ap*60;var sp=op*24;var lp=sp*365;var up={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{hh}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {hh}:{mm}:{ss} {SSS}"};var cp="{yyyy}-{MM}-{dd}";var fp={year:"{yyyy}",month:"{yyyy}-{MM}",day:cp,hour:cp+" "+up.hour,minute:cp+" "+up.minute,second:cp+" "+up.second,millisecond:up.none};var hp=["year","month","day","hour","minute","second","millisecond"];var pp=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function vp(e,t){e+="";return"0000".substr(0,t-e.length)+e}function dp(e){switch(e){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return e}}function gp(e){return e===dp(e)}function yp(e){switch(e){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function mp(e,t,r,i){var n=ia(e);var a=n[wp(r)]();var o=n[Sp(r)]()+1;var s=Math.floor((o-1)/4)+1;var l=n[Mp(r)]();var u=n["get"+(r?"UTC":"")+"Day"]();var c=n[Ip(r)]();var f=(c-1)%12+1;var h=n[Cp(r)]();var p=n[Tp(r)]();var v=n[Dp(r)]();var d=i instanceof C?i:rp(i||$h)||ip();var g=d.getModel("time");var y=g.get("month");var m=g.get("monthAbbr");var x=g.get("dayOfWeek");var _=g.get("dayOfWeekAbbr");return(t||"").replace(/{yyyy}/g,a+"").replace(/{yy}/g,a%100+"").replace(/{Q}/g,s+"").replace(/{MMMM}/g,y[o-1]).replace(/{MMM}/g,m[o-1]).replace(/{MM}/g,vp(o,2)).replace(/{M}/g,o+"").replace(/{dd}/g,vp(l,2)).replace(/{d}/g,l+"").replace(/{eeee}/g,x[u]).replace(/{ee}/g,_[u]).replace(/{e}/g,u+"").replace(/{HH}/g,vp(c,2)).replace(/{H}/g,c+"").replace(/{hh}/g,vp(f+"",2)).replace(/{h}/g,f+"").replace(/{mm}/g,vp(h,2)).replace(/{m}/g,h+"").replace(/{ss}/g,vp(p,2)).replace(/{s}/g,p+"").replace(/{SSS}/g,vp(v,3)).replace(/{S}/g,v+"")}function xp(e,t,r,i,n){var a=null;if(typeof r==="string"){a=r}else if(typeof r==="function"){a=r(e.value,t,{level:e.level})}else{var o=F({},up);if(e.level>0){for(var s=0;s<hp.length;++s){o[hp[s]]="{primary|"+o[hp[s]]+"}"}}var l=r?r.inherit===false?r:R(r,o):o;var u=_p(e.value,n);if(l[u]){a=l[u]}else if(l.inherit){var c=pp.indexOf(u);for(var s=c-1;s>=0;--s){if(l[u]){a=l[u];break}}a=a||o.none}if(k(a)){var f=e.level==null?0:e.level>=0?e.level:a.length+e.level;f=Math.min(f,a.length-1);a=a[f]}}return mp(new Date(e.value),a,n,i)}function _p(e,t){var r=ia(e);var i=r[Sp(t)]()+1;var n=r[Mp(t)]();var a=r[Ip(t)]();var o=r[Cp(t)]();var s=r[Tp(t)]();var l=r[Dp(t)]();var u=l===0;var c=u&&s===0;var f=c&&o===0;var h=f&&a===0;var p=h&&n===1;var v=p&&i===1;if(v){return"year"}else if(p){return"month"}else if(h){return"day"}else if(f){return"hour"}else if(c){return"minute"}else if(u){return"second"}else{return"millisecond"}}function bp(e,t,r){var i=typeof e==="number"?ia(e):e;t=t||_p(e,r);switch(t){case"year":return i[wp(r)]();case"half-year":return i[Sp(r)]()>=6?1:0;case"quarter":return Math.floor((i[Sp(r)]()+1)/4);case"month":return i[Sp(r)]();case"day":return i[Mp(r)]();case"half-day":return i[Ip(r)]()/24;case"hour":return i[Ip(r)]();case"minute":return i[Cp(r)]();case"second":return i[Tp(r)]();case"millisecond":return i[Dp(r)]()}}function wp(e){return e?"getUTCFullYear":"getFullYear"}function Sp(e){return e?"getUTCMonth":"getMonth"}function Mp(e){return e?"getUTCDate":"getDate"}function Ip(e){return e?"getUTCHours":"getHours"}function Cp(e){return e?"getUTCMinutes":"getMinutes"}function Tp(e){return e?"getUTCSeconds":"getSeconds"}function Dp(e){return e?"getUTCSeconds":"getSeconds"}function Ap(e){return e?"setUTCFullYear":"setFullYear"}function Lp(e){return e?"setUTCMonth":"setMonth"}function kp(e){return e?"setUTCDate":"setDate"}function Pp(e){return e?"setUTCHours":"setHours"}function Op(e){return e?"setUTCMinutes":"setMinutes"}function Np(e){return e?"setUTCSeconds":"setSeconds"}function Ep(e){return e?"setUTCSeconds":"setSeconds"}function Rp(e,t,r,i,n,a,o,s){xa("getTextRect is deprecated.");var l=new W({style:{text:e,font:t,align:r,verticalAlign:i,padding:n,rich:a,overflow:o?"truncate":null,lineHeight:s}});return l.getBoundingRect()}function zp(e){if(!ca(e)){return P(e)?e:"-"}var t=(e+"").split(".");return t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(t.length>1?"."+t[1]:"")}function Bp(e,t){e=(e||"").toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()});if(t&&e){e=e.charAt(0).toUpperCase()+e.slice(1)}return e}var Vp=Me;var Gp=/([&<>"'])/g;var Fp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Hp(e){return e==null?"":(e+"").replace(Gp,function(e,t){return Fp[t]})}function Wp(e,t,r){var i="{yyyy}-{MM}-{dd} {hh}:{mm}:{ss}";function n(e){return e&&Ie(e)?e:"-"}function a(e){return!!(e!=null&&!isNaN(e)&&isFinite(e))}var o=t==="time";var s=e instanceof Date;if(o||s){var l=o?ia(e):e;if(!isNaN(+l)){return mp(l,i,r)}else if(s){return"-"}}if(t==="ordinal"){return he(e)?n(e):pe(e)?a(e)?e+"":"-":"-"}var u=ua(e);return a(u)?zp(u):he(e)?n(e):"-"}var jp=["a","b","c","d","e","f","g"];var Up=function(e,t){return"{"+e+(t==null?"":t)+"}"};function Zp(e,t,r){if(!k(t)){t=[t]}var i=t.length;if(!i){return""}var n=t[0].$vars||[];for(var a=0;a<n.length;a++){var o=jp[a];e=e.replace(Up(o),Up(o,0))}for(var s=0;s<i;s++){for(var l=0;l<n.length;l++){var u=t[s][n[l]];e=e.replace(Up(jp[l],s),r?Hp(u):u)}}return e}function Yp(r,e,i){U(e,function(e,t){r=r.replace("{"+t+"}",i?Hp(e):e)});return r}function Xp(e,t){var r=P(e)?{color:e,extraCssText:t}:e||{};var i=r.color;var n=r.type;t=r.extraCssText;var a=r.renderMode||"html";if(!i){return""}if(a==="html"){return n==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;'+"border-radius:4px;width:4px;height:4px;background-color:"+Hp(i)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;'+"border-radius:10px;width:10px;height:10px;background-color:"+Hp(i)+";"+(t||"")+'"></span>'}else{var o=r.markerId||"markerX";return{renderMode:a,content:"{"+o+"|}  ",style:n==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:i}:{width:10,height:10,borderRadius:5,backgroundColor:i}}}}function qp(e,t,r){if("development"!=="production"){_a("echarts.format.formatTime","echarts.time.format")}if(e==="week"||e==="month"||e==="quarter"||e==="half-year"||e==="year"){e="MM-dd\nyyyy"}var i=ia(t);var n=r?"UTC":"";var a=i["get"+n+"FullYear"]();var o=i["get"+n+"Month"]()+1;var s=i["get"+n+"Date"]();var l=i["get"+n+"Hours"]();var u=i["get"+n+"Minutes"]();var c=i["get"+n+"Seconds"]();var f=i["get"+n+"Milliseconds"]();e=e.replace("MM",vp(o,2)).replace("M",o).replace("yyyy",a).replace("yy",a%100+"").replace("dd",vp(s,2)).replace("d",s).replace("hh",vp(l,2)).replace("h",l).replace("mm",vp(u,2)).replace("m",u).replace("ss",vp(c,2)).replace("s",c).replace("SSS",vp(f,3));return e}function Jp(e){return e?e.charAt(0).toUpperCase()+e.substr(1):e}function Kp(e,t){t=t||"transparent";return P(e)?e:O(e)?e.colorStops&&(e.colorStops[0]||{}).color||t:t}function Qp(e,t){if(t==="_blank"||t==="blank"){var r=window.open();r.opener=null;r.location.href=e}else{window.open(e,t)}}var $p=U;var ev=["left","right","top","bottom","width","height"];var tv=[["width","left","right"],["height","top","bottom"]];function rv(u,c,f,h,p){var v=0;var d=0;if(h==null){h=Infinity}if(p==null){p=Infinity}var g=0;c.eachChild(function(e,t){var r=e.getBoundingRect();var i=c.childAt(t+1);var n=i&&i.getBoundingRect();var a;var o;if(u==="horizontal"){var s=r.width+(n?-n.x+r.x:0);a=v+s;if(a>h||e.newline){v=0;a=s;d+=g+f;g=r.height}else{g=Math.max(g,r.height)}}else{var l=r.height+(n?-n.y+r.y:0);o=d+l;if(o>p||e.newline){v+=g+f;d=0;o=l;g=r.width}else{g=Math.max(g,r.width)}}if(e.newline){return}e.x=v;e.y=d;e.markRedraw();u==="horizontal"?v=a+f:d=o+f})}var iv=rv;var nv=_(rv,"vertical");var av=_(rv,"horizontal");function ov(e,t,r){var i=t.width;var n=t.height;var a=Y(e.left,i);var o=Y(e.top,n);var s=Y(e.right,i);var l=Y(e.bottom,n);(isNaN(a)||isNaN(parseFloat(e.left)))&&(a=0);(isNaN(s)||isNaN(parseFloat(e.right)))&&(s=i);(isNaN(o)||isNaN(parseFloat(e.top)))&&(o=0);(isNaN(l)||isNaN(parseFloat(e.bottom)))&&(l=n);r=Vp(r||0);return{width:Math.max(s-a-r[1]-r[3],0),height:Math.max(l-o-r[0]-r[2],0)}}function sv(e,t,r){r=Vp(r||0);var i=t.width;var n=t.height;var a=Y(e.left,i);var o=Y(e.top,n);var s=Y(e.right,i);var l=Y(e.bottom,n);var u=Y(e.width,i);var c=Y(e.height,n);var f=r[2]+r[0];var h=r[1]+r[3];var p=e.aspect;if(isNaN(u)){u=i-s-h-a}if(isNaN(c)){c=n-l-f-o}if(p!=null){if(isNaN(u)&&isNaN(c)){if(p>i/n){u=i*.8}else{c=n*.8}}if(isNaN(u)){u=p*c}if(isNaN(c)){c=u/p}}if(isNaN(a)){a=i-s-u-h}if(isNaN(o)){o=n-l-c-f}switch(e.left||e.right){case"center":a=i/2-u/2-r[3];break;case"right":a=i-u-h;break}switch(e.top||e.bottom){case"middle":case"center":o=n/2-c/2-r[0];break;case"bottom":o=n-c-f;break}a=a||0;o=o||0;if(isNaN(u)){u=i-h-a-(s||0)}if(isNaN(c)){c=n-f-o-(l||0)}var v=new B(a+r[3],o+r[0],u,c);v.margin=r;return v}function lv(e,t,r,i,n){var a=!n||!n.hv||n.hv[0];var o=!n||!n.hv||n.hv[1];var s=n&&n.boundingMode||"all";if(!a&&!o){return}var l;if(s==="raw"){l=e.type==="group"?new B(0,0,+t.width||0,+t.height||0):e.getBoundingRect()}else{l=e.getBoundingRect();if(e.needLocalTransform()){var u=e.getLocalTransform();l=l.clone();l.applyTransform(u)}}var c=sv(R({width:l.width,height:l.height},t),r,i);var f=a?c.x-l.x:0;var h=o?c.y-l.y:0;if(s==="raw"){e.x=f;e.y=h}else{e.x+=f;e.y+=h}e.markRedraw()}function uv(e,t){return e[tv[t][0]]!=null||e[tv[t][1]]!=null&&e[tv[t][2]]!=null}function cv(e){var t=e.layoutMode||e.constructor.layoutMode;return O(t)?t:t?{type:t}:null}function fv(u,c,e){var f=e&&e.ignoreSize;!k(f)&&(f=[f,f]);var t=i(tv[0],0);var r=i(tv[1],1);n(tv[0],u,t);n(tv[1],u,r);function i(e,t){var r={};var i=0;var n={};var a=0;var o=2;$p(e,function(e){n[e]=u[e]});$p(e,function(e){h(c,e)&&(r[e]=n[e]=c[e]);p(r,e)&&i++;p(n,e)&&a++});if(f[t]){if(p(c,e[1])){n[e[2]]=null}else if(p(c,e[2])){n[e[1]]=null}return n}if(a===o||!i){return n}else if(i>=o){return r}else{for(var s=0;s<e.length;s++){var l=e[s];if(!h(r,l)&&h(u,l)){r[l]=u[l];break}}return r}}function h(e,t){return e.hasOwnProperty(t)}function p(e,t){return e[t]!=null&&e[t]!=="auto"}function n(e,t,r){$p(e,function(e){t[e]=r[e]})}}function hv(e){return pv({},e)}function pv(t,r){r&&t&&$p(ev,function(e){r.hasOwnProperty(e)&&(t[e]=r[e])});return t}var vv=qa();var p=function(n){d(t,n);function t(e,t,r){var i=n.call(this,e,t,r)||this;i.uid=Hh("ec_cpt_model");return i}t.prototype.init=function(e,t,r){this.mergeDefaultAndTheme(e,r)};t.prototype.mergeDefaultAndTheme=function(e,t){var r=cv(this);var i=r?hv(e):{};var n=t.getTheme();y(e,n.get(this.mainType));y(e,this.getDefaultOption());if(r){fv(e,i,r)}};t.prototype.mergeOption=function(e,t){y(this.option,e,true);var r=cv(this);if(r){fv(this.option,e,r)}};t.prototype.optionUpdated=function(e,t){};t.prototype.getDefaultOption=function(){var e=this.constructor;if(!ho(e)){return e.defaultOption}var t=vv(this);if(!t.defaultOption){var r=[];var i=e;while(i){var n=i.prototype.defaultOption;n&&r.push(n);i=i.superClass}var a={};for(var o=r.length-1;o>=0;o--){a=y(a,r[o],true)}t.defaultOption=a}return t.defaultOption};t.prototype.getReferringComponents=function(e,t){var r=e+"Index";var i=e+"Id";return to(this.ecModel,e,{index:this.get(r,true),id:this.get(i,true)},t)};t.prototype.getBoxLayoutParams=function(){var e=this;return{left:e.get("left"),top:e.get("top"),right:e.get("right"),bottom:e.get("bottom"),width:e.get("width"),height:e.get("height")}};t.protoInitialize=function(){var e=t.prototype;e.type="component";e.id="";e.name="";e.mainType="";e.subType="";e.componentIndex=0}();return t}(C);go(p,C);bo(p);Wh(p);jh(p,dv);function dv(e){var t=[];U(p.getClassesByMainType(e),function(e){t=t.concat(e.dependencies||e.prototype.dependencies||[])});t=A(t,function(e){return co(e).main});if(e!=="dataset"&&D(t,"dataset")<=0){t.unshift("dataset")}return t}var gv="";if(typeof navigator!=="undefined"){gv=navigator.platform||""}var yv="rgba(0, 0, 0, 0.2)";var mv={darkMode:"auto",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:yv,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:yv,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:yv,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:yv,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:yv,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:yv,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:gv.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:false};var xv=I(["tooltip","label","itemName","itemId","seriesName"]);var _v="original";var bv="arrayRows";var wv="objectRows";var Sv="keyedColumns";var Mv="typedArray";var Iv="unknown";var Cv="column";var Tv="row";var Dv={Must:1,Might:2,Not:3};var Av=qa();function Lv(e){Av(e).datasetMap=I()}function kv(i,e,t){var a={};var r=Ov(e);if(!r||!i){return a}var o=[];var s=[];var n=e.ecModel;var l=Av(n).datasetMap;var u=r.uid+"_"+t.seriesLayoutBy;var c;var f;i=i.slice();U(i,function(e,t){var r=O(e)?e:i[t]={name:e};if(r.type==="ordinal"&&c==null){c=t;f=v(r)}a[r.name]=[]});var h=l.get(u)||l.set(u,{categoryWayDim:f,valueWayDim:0});U(i,function(e,t){var r=e.name;var i=v(e);if(c==null){var n=h.valueWayDim;p(a[r],n,i);p(s,n,i);h.valueWayDim+=i}else if(c===t){p(a[r],0,i);p(o,0,i)}else{var n=h.categoryWayDim;p(a[r],n,i);p(s,n,i);h.categoryWayDim+=i}});function p(e,t,r){for(var i=0;i<r;i++){e.push(t+i)}}function v(e){var t=e.dimsDef;return t?t.length:1}o.length&&(a.itemName=o);s.length&&(a.seriesName=s);return a}function Pv(e,l,u){var t={};var r=Ov(e);if(!r){return t}var c=l.sourceFormat;var f=l.dimensionsDefine;var h;if(c===wv||c===Sv){U(f,function(e,t){if((O(e)?e.name:e)==="name"){h=t}})}var i=function(){var e={};var t={};var r=[];for(var i=0,n=Math.min(5,u);i<n;i++){var a=Rv(l.data,c,l.seriesLayoutBy,f,l.startIndex,i);r.push(a);var o=a===Dv.Not;if(o&&e.v==null&&i!==h){e.v=i}if(e.n==null||e.n===e.v||!o&&r[e.n]===Dv.Not){e.n=i}if(s(e)&&r[e.n]!==Dv.Not){return e}if(!o){if(a===Dv.Might&&t.v==null&&i!==h){t.v=i}if(t.n==null||t.n===t.v){t.n=i}}}function s(e){return e.v!=null&&e.n!=null}return s(e)?e:s(t)?t:null}();if(i){t.value=[i.v];var n=h!=null?h:i.n;t.itemName=[n];t.seriesName=[n]}return t}function Ov(e){var t=e.get("data",true);if(!t){return to(e.ecModel,"dataset",{index:e.get("datasetIndex",true),id:e.get("datasetId",true)},$a).models[0]}}function Nv(e){if(!e.get("transform",true)&&!e.get("fromTransformResult",true)){return[]}return to(e.ecModel,"dataset",{index:e.get("fromDatasetIndex",true),id:e.get("fromDatasetId",true)},$a).models}function Ev(e,t){return Rv(e.data,e.sourceFormat,e.seriesLayoutBy,e.dimensionsDefine,e.startIndex,t)}function Rv(e,t,r,i,n,a){var o;var s=5;if(de(e)){return Dv.Not}var l;var u;if(i){var c=i[a];if(O(c)){l=c.name;u=c.type}else if(P(c)){l=c}}if(u!=null){return u==="ordinal"?Dv.Must:Dv.Not}if(t===bv){var f=e;if(r===Tv){var h=f[a];for(var p=0;p<(h||[]).length&&p<s;p++){if((o=_(h[n+p]))!=null){return o}}}else{for(var p=0;p<f.length&&p<s;p++){var v=f[n+p];if(v&&(o=_(v[a]))!=null){return o}}}}else if(t===wv){var d=e;if(!l){return Dv.Not}for(var p=0;p<d.length&&p<s;p++){var g=d[p];if(g&&(o=_(g[l]))!=null){return o}}}else if(t===Sv){var y=e;if(!l){return Dv.Not}var h=y[l];if(!h||de(h)){return Dv.Not}for(var p=0;p<h.length&&p<s;p++){if((o=_(h[p]))!=null){return o}}}else if(t===_v){var m=e;for(var p=0;p<m.length&&p<s;p++){var g=m[p];var x=Da(g);if(!k(x)){return Dv.Not}if((o=_(x[a]))!=null){return o}}}function _(e){var t=P(e);if(e!=null&&isFinite(e)&&e!==""){return t?Dv.Might:Dv.Not}else if(t&&e!=="-"){return Dv.Must}}return Dv.Not}var zv=I();function Bv(e,t){E(zv.get(e)==null&&t);zv.set(e,t)}function Vv(e,t,r){var i=zv.get(t);if(!i){return r}var n=i(e);if(!n){return r}if("development"!=="production"){for(var a=0;a<n.length;a++){E(Wa(n[a]))}}return r.concat(n)}var Gv=qa();var Fv=qa();var Hv=function(){function e(){}e.prototype.getColorFromPalette=function(e,t,r){var i=Ia(this.get("color",true));var n=this.get("colorLayer",true);return Uv(this,Gv,i,n,e,t,r)};e.prototype.clearColorPalette=function(){Zv(this,Gv)};return e}();function Wv(e,t,r,i){var n=Ia(e.get(["aria","decal","decals"]));return Uv(e,Fv,n,null,t,r,i)}function jv(e,t){var r=e.length;for(var i=0;i<r;i++){if(e[i].length>t){return e[i]}}return e[r-1]}function Uv(e,t,r,i,n,a,o){a=a||e;var s=t(a);var l=s.paletteIdx||0;var u=s.paletteNameMap=s.paletteNameMap||{};if(u.hasOwnProperty(n)){return u[n]}var c=o==null||!i?r:jv(i,o);c=c||r;if(!c||!c.length){return}var f=c[l];if(n){u[n]=f}s.paletteIdx=(l+1)%c.length;return f}function Zv(e,t){t(e).paletteIdx=0;t(e).paletteNameMap={}}var Yv;var Xv;var qv;var Jv="\0_ec_inner";var Kv=1;var Qv={grid:"GridComponent",polar:"PolarComponent",geo:"GeoComponent",singleAxis:"SingleAxisComponent",parallel:"ParallelComponent",calendar:"CalendarComponent",graphic:"GraphicComponent",toolbox:"ToolboxComponent",tooltip:"TooltipComponent",axisPointer:"AxisPointerComponent",brush:"BrushComponent",title:"TitleComponent",timeline:"TimelineComponent",markPoint:"MarkPointComponent",markLine:"MarkLineComponent",markArea:"MarkAreaComponent",legend:"LegendComponent",dataZoom:"DataZoomComponent",visualMap:"VisualMapComponent",xAxis:"GridComponent",yAxis:"GridComponent",angleAxis:"PolarComponent",radiusAxis:"PolarComponent"};var $v={line:"LineChart",bar:"BarChart",pie:"PieChart",scatter:"ScatterChart",radar:"RadarChart",map:"MapChart",tree:"TreeChart",treemap:"TreemapChart",graph:"GraphChart",gauge:"GaugeChart",funnel:"FunnelChart",parallel:"ParallelChart",sankey:"SankeyChart",boxplot:"BoxplotChart",candlestick:"CandlestickChart",effectScatter:"EffectScatterChart",lines:"LinesChart",heatmap:"HeatmapChart",pictorialBar:"PictorialBarChart",themeRiver:"ThemeRiverChart",sunburst:"SunburstChart",custom:"CustomChart"};var ed={};function td(e){U(e,function(e,t){if(!p.hasClass(t)){var r=Qv[t];if(r&&!ed[r]){ma("Component "+t+" is used but not imported.\nimport { "+r+" } from 'echarts/components';\necharts.use(["+r+"]);");ed[r]=true}}})}var rd=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(e,t,r,i,n,a){i=i||{};this.option=null;this._theme=new C(i);this._locale=new C(n);this._optionManager=a};t.prototype.setOption=function(e,t,r){if("development"!=="production"){E(e!=null,"option is null/undefined");E(e[Jv]!==Kv,"please use chart.getOption()")}var i=sd(t);this._optionManager.setOption(e,r,i);this._resetOption(null,i)};t.prototype.resetOption=function(e,t){return this._resetOption(e,sd(t))};t.prototype._resetOption=function(e,t){var r=false;var i=this._optionManager;if(!e||e==="recreate"){var n=i.mountOption(e==="recreate");if("development"!=="production"){td(n)}if(!this.option||e==="recreate"){qv(this,n)}else{this.restoreData();this._mergeOption(n,t)}r=true}if(e==="timeline"||e==="media"){this.restoreData()}if(!e||e==="recreate"||e==="timeline"){var a=i.getTimelineOption(this);if(a){r=true;this._mergeOption(a,t)}}if(!e||e==="recreate"||e==="media"){var o=i.getMediaOption(this);if(o.length){U(o,function(e){r=true;this._mergeOption(e,t)},this)}}return r};t.prototype.mergeOption=function(e){this._mergeOption(e,null)};t.prototype._mergeOption=function(n,e){var a=this.option;var o=this._componentsMap;var s=this._componentsCount;var r=[];var i=I();var l=e&&e.replaceMergeMainTypeMap;Lv(this);U(n,function(e,t){if(e==null){return}if(!p.hasClass(t)){a[t]=a[t]==null?M(e):y(a[t],e,true)}else if(t){r.push(t);i.set(t,true)}});if(l){l.each(function(e,t){if(p.hasClass(t)&&!i.get(t)){r.push(t);i.set(t,true)}})}p.topologicalTravel(r,p.getAllClassMainTypes(),t,this);function t(u){var e=Vv(this,u,Ia(n[u]));var t=o.get(u);var r=!t?"replaceAll":l&&l.get(u)?"replaceMerge":"normalMerge";var i=La(t,e,r);Ua(i,u,p);a[u]=null;o.set(u,null);s.set(u,0);var c=[];var f=[];var h=0;U(i,function(e,t){var r=e.existing;var i=e.newOption;if(!i){if(r){r.mergeOption({},this);r.optionUpdated({},false)}}else{var n=u==="series";var a=p.getClass(u,e.keyInfo.subType,!n);if(!a){if("development"!=="production"){var o=e.keyInfo.subType;var s=$v[o];if(!ed[o]){ed[o]=true;if(s){ma("Series "+o+" is used but not imported.\nimport { "+s+" } from 'echarts/charts';\necharts.use(["+s+"]);")}else{ma("Unkown series "+o)}}}return}if(r&&r.constructor===a){r.name=e.keyInfo.name;r.mergeOption(i,this);r.optionUpdated(i,false)}else{var l=F({componentIndex:t},e.keyInfo);r=new a(i,this,this,l);F(r,l);if(e.brandNew){r.__requireNewView=true}r.init(i,this,this);r.optionUpdated(null,true)}}if(r){c.push(r.option);f.push(r);h++}else{c.push(void 0);f.push(void 0)}},this);a[u]=c;o.set(u,f);s.set(u,h);if(u==="series"){Yv(this)}}if(!this._seriesIndices){Yv(this)}};t.prototype.getOption=function(){var o=M(this.option);U(o,function(e,t){if(p.hasClass(t)){var r=Ia(e);var i=r.length;var n=false;for(var a=i-1;a>=0;a--){if(r[a]&&!Wa(r[a])){n=true}else{r[a]=null;!n&&i--}}r.length=i;o[t]=r}});delete o[Jv];return o};t.prototype.getTheme=function(){return this._theme};t.prototype.getLocaleModel=function(){return this._locale};t.prototype.getLocale=function(e){var t=this.getLocaleModel();return t.get(e)};t.prototype.setUpdatePayload=function(e){this._payload=e};t.prototype.getUpdatePayload=function(){return this._payload};t.prototype.getComponent=function(e,t){var r=this._componentsMap.get(e);if(r){var i=r[t||0];if(i){return i}else if(t==null){for(var n=0;n<r.length;n++){if(r[n]){return r[n]}}}}};t.prototype.queryComponents=function(e){var t=e.mainType;if(!t){return[]}var r=e.index;var i=e.id;var n=e.name;var a=this._componentsMap.get(t);if(!a||!a.length){return[]}var o;if(r!=null){o=[];U(Ia(r),function(e){a[e]&&o.push(a[e])})}else if(i!=null){o=ad("id",i,a)}else if(n!=null){o=ad("name",n,a)}else{o=ue(a,function(e){return!!e})}return od(o,e)};t.prototype.findComponents=function(t){var e=t.query;var n=t.mainType;var r=a(e);var i=r?this.queryComponents(r):ue(this._componentsMap.get(n),function(e){return!!e});return o(od(i,t));function a(e){var t=n+"Index";var r=n+"Id";var i=n+"Name";return e&&(e[t]!=null||e[r]!=null||e[i]!=null)?{mainType:n,index:e[t],id:e[r],name:e[i]}:null}function o(e){return t.filter?ue(e,t.filter):e}};t.prototype.eachComponent=function(e,t,r){var i=this._componentsMap;if(b(e)){var n=t;var a=e;i.each(function(e,t){for(var r=0;e&&r<e.length;r++){var i=e[r];i&&a.call(n,t,i,i.componentIndex)}})}else{var o=P(e)?i.get(e):O(e)?this.findComponents(e):null;for(var s=0;o&&s<o.length;s++){var l=o[s];l&&t.call(r,l,l.componentIndex)}}};t.prototype.getSeriesByName=function(e){var t=Va(e,null);return ue(this._componentsMap.get("series"),function(e){return!!e&&t!=null&&e.name===t})};t.prototype.getSeriesByIndex=function(e){return this._componentsMap.get("series")[e]};t.prototype.getSeriesByType=function(t){return ue(this._componentsMap.get("series"),function(e){return!!e&&e.subType===t})};t.prototype.getSeries=function(){return ue(this._componentsMap.get("series").slice(),function(e){return!!e})};t.prototype.getSeriesCount=function(){return this._componentsCount.get("series")};t.prototype.eachSeries=function(r,i){Xv(this);U(this._seriesIndices,function(e){var t=this._componentsMap.get("series")[e];r.call(i,t,e)},this)};t.prototype.eachRawSeries=function(t,r){U(this._componentsMap.get("series"),function(e){e&&t.call(r,e,e.componentIndex)})};t.prototype.eachSeriesByType=function(r,i,n){Xv(this);U(this._seriesIndices,function(e){var t=this._componentsMap.get("series")[e];if(t.subType===r){i.call(n,t,e)}},this)};t.prototype.eachRawSeriesByType=function(e,t,r){return U(this.getSeriesByType(e),t,r)};t.prototype.isSeriesFiltered=function(e){Xv(this);return this._seriesIndicesMap.get(e.componentIndex)==null};t.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()};t.prototype.filterSeries=function(r,i){Xv(this);var n=[];U(this._seriesIndices,function(e){var t=this._componentsMap.get("series")[e];r.call(i,t,e)&&n.push(e)},this);this._seriesIndices=n;this._seriesIndicesMap=I(n)};t.prototype.restoreData=function(r){Yv(this);var e=this._componentsMap;var i=[];e.each(function(e,t){if(p.hasClass(t)){i.push(t)}});p.topologicalTravel(i,p.getAllClassMainTypes(),function(t){U(e.get(t),function(e){if(e&&(t!=="series"||!id(e,r))){e.restoreData()}})})};t.internalField=function(){Yv=function(e){var t=e._seriesIndices=[];U(e._componentsMap.get("series"),function(e){e&&t.push(e.componentIndex)});e._seriesIndicesMap=I(t)};Xv=function(e){if("development"!=="production"){if(!e._seriesIndices){throw new Error("Option should contains series.")}}};qv=function(e,t){e.option={};e.option[Jv]=Kv;e._componentsMap=I({series:[]});e._componentsCount=I();var r=t.aria;if(O(r)&&r.enabled==null){r.enabled=true}nd(t,e._theme.option);y(t,mv,false);e._mergeOption(t,null)}}();return t}(C);function id(e,t){if(t){var r=t.seriesIndex;var i=t.seriesId;var n=t.seriesName;return r!=null&&e.componentIndex!==r||i!=null&&e.id!==i||n!=null&&e.name!==n}}function nd(r,e){var i=r.color&&!r.colorLayer;U(e,function(e,t){if(t==="colorLayer"&&i){return}if(!p.hasClass(t)){if(typeof e==="object"){r[t]=!r[t]?M(e):y(r[t],e,false)}else{if(r[t]==null){r[t]=e}}}})}function ad(t,e,r){if(k(e)){var i=I();U(e,function(e){if(e!=null){var t=Va(e,null);t!=null&&i.set(e,true)}});return ue(r,function(e){return e&&i.get(e[t])})}else{var n=Va(e,null);return ue(r,function(e){return e&&n!=null&&e[t]===n})}}function od(e,t){return t.hasOwnProperty("subType")?ue(e,function(e){return e&&e.subType===t.subType}):e}function sd(e){var t=I();e&&U(Ia(e.replaceMerge),function(e){if("development"!=="production"){E(p.hasClass(e),'"'+e+'" is not valid component main type in "replaceMerge"')}t.set(e,true)});return{replaceMergeMainTypeMap:t}}oe(rd,Hv);var ld=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"];var ud=function(){function e(t){U(ld,function(e){this[e]=x(t[e],t)},this)}return e}();var cd={};var fd=function(){function e(){this._coordinateSystems=[]}e.prototype.create=function(i,n){var a=[];U(cd,function(e,t){var r=e.create(i,n);a=a.concat(r||[])});this._coordinateSystems=a};e.prototype.update=function(t,r){U(this._coordinateSystems,function(e){e.update&&e.update(t,r)})};e.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()};e.register=function(e,t){cd[e]=t};e.get=function(e){return cd[e]};return e}();var hd=/^(min|max)?(.+)$/;var pd=function(){function e(e){this._timelineOptions=[];this._mediaList=[];this._currentMediaIndices=[];this._api=e}e.prototype.setOption=function(e,t,r){if(e){U(Ia(e.series),function(e){e&&e.data&&de(e.data)&&Te(e.data)});U(Ia(e.dataset),function(e){e&&e.source&&de(e.source)&&Te(e.source)})}e=M(e);var i=this._optionBackup;var n=vd(e,t,!i);this._newBaseOption=n.baseOption;if(i){if(n.timelineOptions.length){i.timelineOptions=n.timelineOptions}if(n.mediaList.length){i.mediaList=n.mediaList}if(n.mediaDefault){i.mediaDefault=n.mediaDefault}}else{this._optionBackup=n}};e.prototype.mountOption=function(e){var t=this._optionBackup;this._timelineOptions=t.timelineOptions;this._mediaList=t.mediaList;this._mediaDefault=t.mediaDefault;this._currentMediaIndices=[];return M(e?t.baseOption:this._newBaseOption)};e.prototype.getTimelineOption=function(e){var t;var r=this._timelineOptions;if(r.length){var i=e.getComponent("timeline");if(i){t=M(r[i.getCurrentIndex()])}}return t};e.prototype.getMediaOption=function(e){var t=this._api.getWidth();var r=this._api.getHeight();var i=this._mediaList;var n=this._mediaDefault;var a=[];var o=[];if(!i.length&&!n){return o}for(var s=0,l=i.length;s<l;s++){if(dd(i[s].query,t,r)){a.push(s)}}if(!a.length&&n){a=[-1]}if(a.length&&!yd(a,this._currentMediaIndices)){o=A(a,function(e){return M(e===-1?n.option:i[e].option)})}this._currentMediaIndices=a;return o};return e}();function vd(e,r,i){var t=[];var n;var a;var o=e.baseOption;var s=e.timeline;var l=e.options;var u=e.media;var c=!!e.media;var f=!!(l||s||o&&o.timeline);if(o){a=o;if(!a.timeline){a.timeline=s}}else{if(f||c){e.options=e.media=null}a=e}if(c){if(k(u)){U(u,function(e){if("development"!=="production"){if(e&&!e.option&&O(e.query)&&O(e.query.option)){ma("Illegal media option. Must be like { media: [ { query: {}, option: {} } ] }")}}if(e&&e.option){if(e.query){t.push(e)}else if(!n){n=e}}})}else{if("development"!=="production"){ma("Illegal media option. Must be an array. Like { media: [ {...}, {...} ] }")}}}h(a);U(l,function(e){return h(e)});U(t,function(e){return h(e.option)});function h(t){U(r,function(e){e(t,i)})}return{baseOption:a,timelineOptions:l||[],mediaDefault:n,mediaList:t}}function dd(e,t,r){var a={width:t,height:r,aspectratio:t/r};var o=true;U(e,function(e,t){var r=t.match(hd);if(!r||!r[1]||!r[2]){return}var i=r[1];var n=r[2].toLowerCase();if(!gd(a[n],e,i)){o=false}});return o}function gd(e,t,r){if(r==="min"){return e>=t}else if(r==="max"){return e<=t}else{return e===t}}function yd(e,t){return e.join(",")===t.join(",")}var md=U;var xd=O;var _d=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function bd(e){var t=e&&e.itemStyle;if(!t){return}for(var r=0,i=_d.length;r<i;r++){var n=_d[r];var a=t.normal;var o=t.emphasis;if(a&&a[n]){if("development"!=="production"){_a("itemStyle.normal."+n,n)}e[n]=e[n]||{};if(!e[n].normal){e[n].normal=a[n]}else{y(e[n].normal,a[n])}a[n]=null}if(o&&o[n]){if("development"!=="production"){_a("itemStyle.emphasis."+n,"emphasis."+n)}e[n]=e[n]||{};if(!e[n].emphasis){e[n].emphasis=o[n]}else{y(e[n].emphasis,o[n])}o[n]=null}}}function wd(e,t,r){if(e&&e[t]&&(e[t].normal||e[t].emphasis)){var i=e[t].normal;var n=e[t].emphasis;if(i){if("development"!=="production"){xa("'normal' hierarchy in "+t+" has been removed since 4.0. All style properties are configured in "+t+" directly now.")}if(r){e[t].normal=e[t].emphasis=null;R(e[t],i)}else{e[t]=i}}if(n){if("development"!=="production"){xa(t+".emphasis has been changed to emphasis."+t+" since 4.0")}e.emphasis=e.emphasis||{};e.emphasis[t]=n;if(n.focus){e.emphasis.focus=n.focus}if(n.blurScope){e.emphasis.blurScope=n.blurScope}}}}function Sd(e){wd(e,"itemStyle");wd(e,"lineStyle");wd(e,"areaStyle");wd(e,"label");wd(e,"labelLine");wd(e,"upperLabel");wd(e,"edgeLabel")}function Md(e,t){var r=xd(e)&&e[t];var i=xd(r)&&r.textStyle;if(i){if("development"!=="production"){xa("textStyle hierarchy in "+t+" has been removed since 4.0. All textStyle properties are configured in "+t+" directly now.")}for(var n=0,a=Ta.length;n<a;n++){var o=Ta[n];if(i.hasOwnProperty(o)){r[o]=i[o]}}}}function Id(e){if(e){Sd(e);Md(e,"label");e.emphasis&&Md(e.emphasis,"label")}}function Cd(e){if(!xd(e)){return}bd(e);Sd(e);Md(e,"label");Md(e,"upperLabel");Md(e,"edgeLabel");if(e.emphasis){Md(e.emphasis,"label");Md(e.emphasis,"upperLabel");Md(e.emphasis,"edgeLabel")}var t=e.markPoint;if(t){bd(t);Id(t)}var r=e.markLine;if(r){bd(r);Id(r)}var i=e.markArea;if(i){Id(i)}var n=e.data;if(e.type==="graph"){n=n||e.nodes;var a=e.links||e.edges;if(a&&!de(a)){for(var o=0;o<a.length;o++){Id(a[o])}}U(e.categories,function(e){Sd(e)})}if(n&&!de(n)){for(var o=0;o<n.length;o++){Id(n[o])}}t=e.markPoint;if(t&&t.data){var s=t.data;for(var o=0;o<s.length;o++){Id(s[o])}}r=e.markLine;if(r&&r.data){var l=r.data;for(var o=0;o<l.length;o++){if(k(l[o])){Id(l[o][0]);Id(l[o][1])}else{Id(l[o])}}}if(e.type==="gauge"){Md(e,"axisLabel");Md(e,"title");Md(e,"detail")}else if(e.type==="treemap"){wd(e.breadcrumb,"itemStyle");U(e.levels,function(e){Sd(e)})}else if(e.type==="tree"){Sd(e.leaves)}}function Td(e){return k(e)?e:e?[e]:[]}function Dd(e){return(k(e)?e[0]:e)||{}}function Ad(t,e){md(Td(t.series),function(e){xd(e)&&Cd(e)});var r=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];e&&r.push("valueAxis","categoryAxis","logAxis","timeAxis");md(r,function(e){md(Td(t[e]),function(e){if(e){Md(e,"axisLabel");Md(e.axisPointer,"label")}})});md(Td(t.parallel),function(e){var t=e&&e.parallelAxisDefault;Md(t,"axisLabel");Md(t&&t.axisPointer,"label")});md(Td(t.calendar),function(e){wd(e,"itemStyle");Md(e,"dayLabel");Md(e,"monthLabel");Md(e,"yearLabel")});md(Td(t.radar),function(e){Md(e,"name");if(e.name&&e.axisName==null){e.axisName=e.name;delete e.name;if("development"!=="production"){xa("name property in radar component has been changed to axisName")}}if(e.nameGap!=null&&e.axisNameGap==null){e.axisNameGap=e.nameGap;delete e.nameGap;if("development"!=="production"){xa("nameGap property in radar component has been changed to axisNameGap")}}});md(Td(t.geo),function(e){if(xd(e)){Id(e);md(Td(e.regions),function(e){Id(e)})}});md(Td(t.timeline),function(e){Id(e);wd(e,"label");wd(e,"itemStyle");wd(e,"controlStyle",true);var t=e.data;k(t)&&U(t,function(e){if(O(e)){wd(e,"label");wd(e,"itemStyle")}})});md(Td(t.toolbox),function(e){wd(e,"iconStyle");md(e.feature,function(e){wd(e,"iconStyle")})});Md(Dd(t.axisPointer),"label");Md(Dd(t.tooltip).axisPointer,"label")}function Ld(e,t){var r=t.split(",");var i=e;for(var n=0;n<r.length;n++){i=i&&i[r[n]];if(i==null){break}}return i}function kd(e,t,r,i){var n=t.split(",");var a=e;var o;var s=0;for(;s<n.length-1;s++){o=n[s];if(a[o]==null){a[o]={}}a=a[o]}if(i||a[n[s]]==null){a[n[s]]=r}}function Pd(t){t&&U(Od,function(e){if(e[0]in t&&!(e[1]in t)){t[e[1]]=t[e[0]]}})}var Od=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]];var Nd=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"];var Ed=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function Rd(e){var t=e&&e.itemStyle;if(t){for(var r=0;r<Ed.length;r++){var i=Ed[r][1];var n=Ed[r][0];if(t[i]!=null){t[n]=t[i];if("development"!=="production"){_a(i,n)}}}}}function zd(e){if(!e){return}if(e.alignTo==="edge"&&e.margin!=null&&e.edgeDistance==null){if("development"!=="production"){_a("label.margin","label.edgeDistance","pie")}e.edgeDistance=e.margin}}function Bd(e){if(!e){return}if(e.downplay&&!e.blur){e.blur=e.downplay;if("development"!=="production"){_a("downplay","blur","sunburst")}}}function Vd(e){if(!e){return}if(e.focusNodeAdjacency!=null){e.emphasis=e.emphasis||{};if(e.emphasis.focus==null){if("development"!=="production"){_a("focusNodeAdjacency","emphasis: { focus: 'adjacency'}","graph/sankey")}e.emphasis.focus="adjacency"}}}function Gd(e,t){if(e){for(var r=0;r<e.length;r++){t(e[r]);e[r]&&Gd(e[r].children,t)}}}function Fd(r,e){Ad(r,e);r.series=Ia(r.series);U(r.series,function(e){if(!O(e)){return}var t=e.type;if(t==="line"){if(e.clipOverflow!=null){e.clip=e.clipOverflow;if("development"!=="production"){_a("clipOverflow","clip","line")}}}else if(t==="pie"||t==="gauge"){if(e.clockWise!=null){e.clockwise=e.clockWise;if("development"!=="production"){_a("clockWise","clockwise")}}zd(e.label);var r=e.data;if(r&&!de(r)){for(var i=0;i<r.length;i++){zd(r[i])}}if(e.hoverOffset!=null){e.emphasis=e.emphasis||{};if(e.emphasis.scaleSize=null){if("development"!=="production"){_a("hoverOffset","emphasis.scaleSize")}e.emphasis.scaleSize=e.hoverOffset}}}else if(t==="gauge"){var n=Ld(e,"pointer.color");n!=null&&kd(e,"itemStyle.color",n)}else if(t==="bar"){Rd(e);Rd(e.backgroundStyle);Rd(e.emphasis);var r=e.data;if(r&&!de(r)){for(var i=0;i<r.length;i++){if(typeof r[i]==="object"){Rd(r[i]);Rd(r[i]&&r[i].emphasis)}}}}else if(t==="sunburst"){var a=e.highlightPolicy;if(a){e.emphasis=e.emphasis||{};if(!e.emphasis.focus){e.emphasis.focus=a;if("development"!=="production"){_a("highlightPolicy","emphasis.focus","sunburst")}}}Bd(e);Gd(e.data,Bd)}else if(t==="graph"||t==="sankey"){Vd(e)}else if(t==="map"){if(e.mapType&&!e.map){if("development"!=="production"){_a("mapType","map","map")}e.map=e.mapType}if(e.mapLocation){if("development"!=="production"){xa("`mapLocation` is not used anymore.")}R(e,e.mapLocation)}}if(e.hoverAnimation!=null){e.emphasis=e.emphasis||{};if(e.emphasis&&e.emphasis.scale==null){if("development"!=="production"){_a("hoverAnimation","emphasis.scale")}e.emphasis.scale=e.hoverAnimation}}Pd(e)});if(r.dataRange){r.visualMap=r.dataRange}U(Nd,function(e){var t=r[e];if(t){if(!k(t)){t=[t]}U(t,function(e){Pd(e)})}})}function Hd(e){var a=I();e.eachSeries(function(e){var t=e.get("stack");if(t){var r=a.get(t)||a.set(t,[]);var i=e.getData();var n={stackResultDimension:i.getCalculationInfo("stackResultDimension"),stackedOverDimension:i.getCalculationInfo("stackedOverDimension"),stackedDimension:i.getCalculationInfo("stackedDimension"),stackedByDimension:i.getCalculationInfo("stackedByDimension"),isStackedByIndex:i.getCalculationInfo("isStackedByIndex"),data:i,seriesModel:e};if(!n.stackedDimension||!(n.isStackedByIndex||n.stackedByDimension)){return}r.length&&i.setCalculationInfo("stackedOnSeries",r[r.length-1].seriesModel);r.push(n)}});a.each(Wd)}function Wd(g){U(g,function(c,f){var h=[];var p=[NaN,NaN];var e=[c.stackResultDimension,c.stackedOverDimension];var v=c.data;var d=c.isStackedByIndex;var t=v.map(e,function(e,t,r){var i=v.get(c.stackedDimension,r);if(isNaN(i)){return p}var n;var a;if(d){a=v.getRawIndex(r)}else{n=v.get(c.stackedByDimension,r)}var o=NaN;for(var s=f-1;s>=0;s--){var l=g[s];if(!d){a=l.data.rawIndexOf(l.stackedByDimension,n)}if(a>=0){var u=l.data.getByRawIndex(l.stackResultDimension,a);if(i>=0&&u>0||i<=0&&u<0){i=Qn(i,u);o=u;break}}}h[0]=i;h[1]=o;return h});v.hostModel.setData(t);c.data=t})}var jd=function(){function e(e){this.data=e.data||(e.sourceFormat===Sv?{}:[]);this.sourceFormat=e.sourceFormat||Iv;this.seriesLayoutBy=e.seriesLayoutBy||Cv;this.startIndex=e.startIndex||0;this.dimensionsDefine=e.dimensionsDefine;this.dimensionsDetectedCount=e.dimensionsDetectedCount;this.encodeDefine=e.encodeDefine;this.metaRawOption=e.metaRawOption}return e}();function Ud(e){return e instanceof jd}function Zd(e,t,r,i){r=r||Jd(e);var n=t.seriesLayoutBy;var a=Kd(e,r,n,t.sourceHeader,t.dimensions);var o=new jd({data:e,sourceFormat:r,seriesLayoutBy:n,dimensionsDefine:a.dimensionsDefine,startIndex:a.startIndex,dimensionsDetectedCount:a.dimensionsDetectedCount,encodeDefine:qd(i),metaRawOption:M(t)});return o}function Yd(e){return new jd({data:e,sourceFormat:de(e)?Mv:_v})}function Xd(e){return new jd({data:e.data,sourceFormat:e.sourceFormat,seriesLayoutBy:e.seriesLayoutBy,dimensionsDefine:M(e.dimensionsDefine),startIndex:e.startIndex,dimensionsDetectedCount:e.dimensionsDetectedCount,encodeDefine:qd(e.encodeDefine)})}function qd(e){return e?I(e):null}function Jd(e){var t=Iv;if(de(e)){t=Mv}else if(k(e)){if(e.length===0){t=bv}for(var r=0,i=e.length;r<i;r++){var n=e[r];if(n==null){continue}else if(k(n)){t=bv;break}else if(O(n)){t=wv;break}}}else if(O(e)){for(var a in e){if(z(e,a)&&se(e[a])){t=Sv;break}}}return t}function Kd(e,t,r,i,n){var a;var o;if(!e){return{dimensionsDefine:$d(n),startIndex:o,dimensionsDetectedCount:a}}if(t===bv){var s=e;if(i==="auto"||i==null){eg(function(e){if(e!=null&&e!=="-"){if(P(e)){o==null&&(o=1)}else{o=0}}},r,s,10)}else{o=pe(i)?i:i?1:0}if(!n&&o===1){n=[];eg(function(e,t){n[t]=e!=null?e+"":""},r,s,Infinity)}a=n?n.length:r===Tv?s.length:s[0]?s[0].length:null}else if(t===wv){if(!n){n=Qd(e)}}else if(t===Sv){if(!n){n=[];U(e,function(e,t){n.push(t)})}}else if(t===_v){var l=Da(e[0]);a=k(l)&&l.length||1}else if(t===Mv){if("development"!=="production"){E(!!n,"dimensions must be given if data is TypedArray.")}}return{startIndex:o,dimensionsDefine:$d(n),dimensionsDetectedCount:a}}function Qd(e){var t=0;var r;while(t<e.length&&!(r=e[t++])){}if(r){var i=[];U(r,function(e,t){i.push(t)});return i}}function $d(e){if(!e){return}var n=I();return A(e,function(e,t){e=O(e)?e:{name:e};var r={name:e.name,displayName:e.displayName,type:e.type};if(r.name==null){return r}r.name+="";if(r.displayName==null){r.displayName=r.name}var i=n.get(r.name);if(!i){n.set(r.name,{count:1})}else{r.name+="-"+i.count++}return r})}function eg(e,t,r,i){if(t===Tv){for(var n=0;n<r.length&&n<i;n++){e(r[n]?r[n][0]:null,n)}}else{var a=r[0]||[];for(var n=0;n<a.length&&n<i;n++){e(a[n],n)}}}var tg,rg,ig;var ng;var ag;var og=function(){function t(e,t){var r=!Ud(e)?Yd(e):e;this._source=r;var i=this._data=r.data;if(r.sourceFormat===Mv){if("development"!=="production"){if(t==null){throw new Error("Typed array data must specify dimension size")}}this._offset=0;this._dimSize=t;this._data=i}ag(this,i,r)}t.prototype.getSource=function(){return this._source};t.prototype.count=function(){return 0};t.prototype.getItem=function(e,t){return};t.prototype.appendData=function(e){};t.prototype.clean=function(){};t.protoInitialize=function(){var e=t.prototype;e.pure=false;e.persistent=true}();t.internalField=function(){var e;ag=function(e,t,r){var i=r.sourceFormat;var n=r.seriesLayoutBy;var a=r.startIndex;var o=r.dimensionsDefine;var s=ng[gg(i,n)];if("development"!=="production"){E(s,"Invalide sourceFormat: "+i)}F(e,s);if(i===Mv){e.getItem=c;e.count=h;e.fillStorage=f}else{var l=ug(i,n);e.getItem=x(l,null,t,a,o);var u=hg(i,n);e.count=x(u,null,t,a,o)}};var c=function(e,t){e=e-this._offset;t=t||[];var r=this._data;var i=this._dimSize;var n=i*e;for(var a=0;a<i;a++){t[a]=r[n+a]}return t};var f=function(e,t,r,i){var n=this._data;var a=this._dimSize;for(var o=0;o<a;o++){var s=i[o];var l=s[0]==null?Infinity:s[0];var u=s[1]==null?-Infinity:s[1];var c=t-e;var f=r[o];for(var h=0;h<c;h++){var p=n[h*a+o];f[e+h]=p;p<l&&(l=p);p>u&&(u=p)}s[0]=l;s[1]=u}};var h=function(){return this._data?this._data.length/this._dimSize:0};ng=(e={},e[bv+"_"+Cv]={pure:true,appendData:t},e[bv+"_"+Tv]={pure:true,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},e[wv]={pure:true,appendData:t},e[Sv]={pure:true,appendData:function(e){var n=this._data;U(e,function(e,t){var r=n[t]||(n[t]=[]);for(var i=0;i<(e||[]).length;i++){r.push(e[i])}})}},e[_v]={appendData:t},e[Mv]={persistent:false,pure:true,appendData:function(e){if("development"!=="production"){E(de(e),"Added data must be TypedArray if data in initialization is TypedArray")}this._data=e},clean:function(){this._offset+=this.count();this._data=null}},e);function t(e){for(var t=0;t<e.length;t++){this._data.push(e[t])}}}();return t}();var sg=function(e,t,r,i){return e[i]};var lg=(tg={},tg[bv+"_"+Cv]=function(e,t,r,i){return e[i+t]},tg[bv+"_"+Tv]=function(e,t,r,i){i+=t;var n=[];var a=e;for(var o=0;o<a.length;o++){var s=a[o];n.push(s?s[i]:null)}return n},tg[wv]=sg,tg[Sv]=function(e,t,r,i){var n=[];for(var a=0;a<r.length;a++){var o=r[a].name;if("development"!=="production"){if(o==null){throw new Error}}var s=e[o];n.push(s?s[i]:null)}return n},tg[_v]=sg,tg);function ug(e,t){var r=lg[gg(e,t)];if("development"!=="production"){E(r,'Do not suppport get item on "'+e+'", "'+t+'".')}return r}var cg=function(e,t,r){return e.length};var fg=(rg={},rg[bv+"_"+Cv]=function(e,t,r){return Math.max(0,e.length-t)},rg[bv+"_"+Tv]=function(e,t,r){var i=e[0];return i?Math.max(0,i.length-t):0},rg[wv]=cg,rg[Sv]=function(e,t,r){var i=r[0].name;if("development"!=="production"){if(i==null){throw new Error}}var n=e[i];return n?n.length:0},rg[_v]=cg,rg);function hg(e,t){var r=fg[gg(e,t)];if("development"!=="production"){E(r,'Do not suppport count on "'+e+'", "'+t+'".')}return r}var pg=function(e,t,r){return t!=null?e[t]:e};var vg=(ig={},ig[bv]=pg,ig[wv]=function(e,t,r){return t!=null?e[r]:e},ig[Sv]=pg,ig[_v]=function(e,t,r){var i=Da(e);return t==null||!(i instanceof Array)?i:i[t]},ig[Mv]=pg,ig);function dg(e){var t=vg[e];if("development"!=="production"){E(t,'Do not suppport get value on "'+e+'".')}return t}function gg(e,t){return e===bv?e+"_"+t:e}function yg(e,t,r){if(!e){return}var i=e.getRawDataItem(t);if(i==null){return}var n=e.getProvider().getSource().sourceFormat;var a;var o;var s=e.getDimensionInfo(r);if(s){a=s.name;o=s.index}return dg(n)(i,o,a)}var mg=/\{@(.+?)\}/g;var xg=function(){function e(){}e.prototype.getDataParams=function(e,t){var r=this.getData(t);var i=this.getRawValue(e,t);var n=r.getRawIndex(e);var a=r.getName(e);var o=r.getRawDataItem(e);var s=r.getItemVisual(e,"style");var l=s&&s[r.getItemVisual(e,"drawType")||"fill"];var u=s&&s.stroke;var c=this.mainType;var f=c==="series";var h=r.userOutput;return{componentType:c,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:f?this.subType:null,seriesIndex:this.seriesIndex,seriesId:f?this.id:null,seriesName:f?this.name:null,name:a,dataIndex:n,data:o,dataType:t,value:i,color:l,borderColor:u,dimensionNames:h?h.dimensionNames:null,encode:h?h.encode:null,$vars:["seriesName","name","value"]}};e.prototype.getFormattedLabel=function(o,e,t,r,i,s){e=e||"normal";var l=this.getData(t);var n=this.getDataParams(o,t);if(s){n.value=s.interpolatedValue}if(r!=null&&k(n.value)){n.value=n.value[r]}if(!i){var a=l.getItemModel(o);i=a.get(e==="normal"?["label","formatter"]:[e,"label","formatter"])}if(typeof i==="function"){n.status=e;n.dimensionIndex=r;return i(n)}else if(typeof i==="string"){var u=Zp(i,n);return u.replace(mg,function(e,t){var r=t.length;var i=t.charAt(0)==="["&&t.charAt(r-1)==="]"?+t.slice(1,r-1):t;var n=yg(l,o,i);if(s&&k(s.interpolatedValue)){var a=l.getDimensionInfo(i);if(a){n=s.interpolatedValue[a.index]}}return n!=null?n+"":""})}};e.prototype.getRawValue=function(e,t){return yg(this.getData(t),e)};e.prototype.formatTooltip=function(e,t,r){return};return e}();function _g(e){var t;var r;if(O(e)){if(e.type){r=e}else{if("development"!=="production"){console.warn("The return type of `formatTooltip` is not supported: "+wa(e))}}}else{t=e}return{markupText:t,markupFragment:r}}function bg(e){return new wg(e)}var wg=function(){function e(e){e=e||{};this._reset=e.reset;this._plan=e.plan;this._count=e.count;this._onDirty=e.onDirty;this._dirty=true}e.prototype.perform=function(e){var t=this._upstream;var r=e&&e.skip;if(this._dirty&&t){var i=this.context;i.data=i.outputData=t.context.outputData}if(this.__pipeline){this.__pipeline.currentTask=this}var n;if(this._plan&&!r){n=this._plan(this.context)}var a=u(this._modBy);var o=this._modDataCount||0;var s=u(e&&e.modBy);var l=e&&e.modDataCount||0;if(a!==s||o!==l){n="reset"}function u(e){!(e>=1)&&(e=1);return e}var c;if(this._dirty||n==="reset"){this._dirty=false;c=this._doReset(r)}this._modBy=s;this._modDataCount=l;var f=e&&e.step;if(t){if("development"!=="production"){E(t._outputDueEnd!=null)}this._dueEnd=t._outputDueEnd}else{if("development"!=="production"){E(!this._progress||this._count)}this._dueEnd=this._count?this._count(this.context):Infinity}if(this._progress){var h=this._dueIndex;var p=Math.min(f!=null?this._dueIndex+f:Infinity,this._dueEnd);if(!r&&(c||h<p)){var v=this._progress;if(k(v)){for(var d=0;d<v.length;d++){this._doProgress(v[d],h,p,s,l)}}else{this._doProgress(v,h,p,s,l)}}this._dueIndex=p;var g=this._settedOutputEnd!=null?this._settedOutputEnd:p;if("development"!=="production"){E(g>=this._outputDueEnd)}this._outputDueEnd=g}else{this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd}return this.unfinished()};e.prototype.dirty=function(){this._dirty=true;this._onDirty&&this._onDirty(this.context)};e.prototype._doProgress=function(e,t,r,i,n){Sg.reset(t,r,i,n);this._callingProgress=e;this._callingProgress({start:t,end:r,count:r-t,next:Sg.next},this.context)};e.prototype._doReset=function(e){this._dueIndex=this._outputDueEnd=this._dueEnd=0;this._settedOutputEnd=null;var t;var r;if(!e&&this._reset){t=this._reset(this.context);if(t&&t.progress){r=t.forceFirstProgress;t=t.progress}if(k(t)&&!t.length){t=null}}this._progress=t;this._modBy=this._modDataCount=null;var i=this._downstream;i&&i.dirty();return r};e.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd};e.prototype.pipe=function(e){if("development"!=="production"){E(e&&!e._disposed&&e!==this)}if(this._downstream!==e||this._dirty){this._downstream=e;e._upstream=this;e.dirty()}};e.prototype.dispose=function(){if(this._disposed){return}this._upstream&&(this._upstream._downstream=null);this._downstream&&(this._downstream._upstream=null);this._dirty=false;this._disposed=true};e.prototype.getUpstream=function(){return this._upstream};e.prototype.getDownstream=function(){return this._downstream};e.prototype.setOutputEnd=function(e){this._outputDueEnd=this._settedOutputEnd=e};return e}();var Sg=function(){var n;var a;var o;var s;var l;var u={reset:function(e,t,r,i){a=e;n=t;o=r;s=i;l=Math.ceil(s/o);u.next=o>1&&s>0?f:c}};return u;function c(){return a<n?a++:null}function f(){var e=a%l*o+Math.ceil(a/l);var t=a>=n?null:e<s?e:a;a++;return t}}();function Mg(e,t){var r=t&&t.type;if(r==="ordinal"){var i=t&&t.ordinalMeta;return i?i.parseAndCollect(e):e}if(r==="time"&&typeof e!=="number"&&e!=null&&e!=="-"){e=+ia(e)}return e==null||e===""?NaN:+e}var Ig=I({number:function(e){return parseFloat(e)},time:function(e){return+ia(e)},trim:function(e){return typeof e==="string"?Ie(e):e}});function Cg(e){return Ig.get(e)}var Tg={lt:function(e,t){return e<t},lte:function(e,t){return e<=t},gt:function(e,t){return e>t},gte:function(e,t){return e>=t}};var Dg=function(){function e(e,t){if(typeof t!=="number"){var r="";if("development"!=="production"){r='rvalue of "<", ">", "<=", ">=" can only be number in filter.'}g(r)}this._opFn=Tg[e];this._rvalFloat=ua(t)}e.prototype.evaluate=function(e){return typeof e==="number"?this._opFn(e,this._rvalFloat):this._opFn(ua(e),this._rvalFloat)};return e}();var Ag=function(){function e(e,t){var r=e==="desc";this._resultLT=r?1:-1;if(t==null){t=r?"min":"max"}this._incomparable=t==="min"?-Infinity:Infinity}e.prototype.evaluate=function(e,t){var r=typeof e;var i=typeof t;var n=r==="number"?e:ua(e);var a=i==="number"?t:ua(t);var o=isNaN(n);var s=isNaN(a);if(o){n=this._incomparable}if(s){a=this._incomparable}if(o&&s){var l=r==="string";var u=i==="string";if(l){n=u?e:0}if(u){a=l?t:0}}return n<a?this._resultLT:n>a?-this._resultLT:0};return e}();var Lg=function(){function e(e,t){this._rval=t;this._isEQ=e;this._rvalTypeof=typeof t;this._rvalFloat=ua(t)}e.prototype.evaluate=function(e){var t=e===this._rval;if(!t){var r=typeof e;if(r!==this._rvalTypeof&&(r==="number"||this._rvalTypeof==="number")){t=ua(e)===this._rvalFloat}}return this._isEQ?t:!t};return e}();function kg(e,t){return e==="eq"||e==="ne"?new Lg(e==="eq",t):z(Tg,e)?new Dg(e,t):null}var Pg=function(){function e(){}e.prototype.getRawData=function(){throw new Error("not supported")};e.prototype.getRawDataItem=function(e){throw new Error("not supported")};e.prototype.cloneRawData=function(){return};e.prototype.getDimensionInfo=function(e){return};e.prototype.cloneAllDimensionInfo=function(){return};e.prototype.count=function(){return};e.prototype.retrieveValue=function(e,t){return};e.prototype.retrieveValueFromItem=function(e,t){return};e.prototype.convertValue=function(e,t){return Mg(e,t)};return e}();function Og(e,t){var r=new Pg;var i=e.data;var n=r.sourceFormat=e.sourceFormat;var a=e.startIndex;var o="";if(e.seriesLayoutBy!==Cv){if("development"!=="production"){o='`seriesLayoutBy` of upstream dataset can only be "column" in data transform.'}g(o)}var s=[];var l={};var u=e.dimensionsDefine;if(u){U(u,function(e,t){var r=e.name;var i={index:t,name:r,displayName:e.displayName};s.push(i);if(r!=null){var n="";if(z(l,r)){if("development"!=="production"){n='dimension name "'+r+'" duplicated.'}g(n)}l[r]=i}})}else{for(var c=0;c<e.dimensionsDetectedCount||0;c++){s.push({index:c})}}var f=ug(n,Cv);if(t.__isBuiltIn){r.getRawDataItem=function(e){return f(i,a,s,e)};r.getRawData=x(Ng,null,e)}r.cloneRawData=x(Eg,null,e);var h=hg(n,Cv);r.count=x(h,null,i,a,s);var p=dg(n);r.retrieveValue=function(e,t){var r=f(i,a,s,e);return v(r,t)};var v=r.retrieveValueFromItem=function(e,t){if(e==null){return}var r=s[t];if(r){return p(e,t,r.name)}};r.getDimensionInfo=x(Rg,null,s,l);r.cloneAllDimensionInfo=x(zg,null,s);return r}function Ng(e){var t=e.sourceFormat;if(!Hg(t)){var r="";if("development"!=="production"){r="`getRawData` is not supported in source format "+t}g(r)}return e.data}function Eg(e){var t=e.sourceFormat;var r=e.data;if(!Hg(t)){var i="";if("development"!=="production"){i="`cloneRawData` is not supported in source format "+t}g(i)}if(t===bv){var n=[];for(var a=0,o=r.length;a<o;a++){n.push(r[a].slice())}return n}else if(t===wv){var n=[];for(var a=0,o=r.length;a<o;a++){n.push(F({},r[a]))}return n}}function Rg(e,t,r){if(r==null){return}if(typeof r==="number"||!isNaN(r)&&!z(t,r)){return e[r]}else if(z(t,r)){return t[r]}}function zg(e){return M(e)}var Bg=I();function Vg(e){e=M(e);var t=e.type;var r="";if(!t){if("development"!=="production"){r="Must have a `type` when `registerTransform`."}g(r)}var i=t.split(":");if(i.length!==2){if("development"!=="production"){r='Name must include namespace like "ns:regression".'}g(r)}var n=false;if(i[0]==="echarts"){t=i[1];n=true}e.__isBuiltIn=n;Bg.set(t,e)}function Gg(e,t,r){var i=Ia(e);var n=i.length;var a="";if(!n){if("development"!=="production"){a="If `transform` declared, it should at least contain one transform."}g(a)}for(var o=0,s=n;o<s;o++){var l=i[o];t=Fg(l,t,r,n===1?null:o);if(o!==s-1){t.length=Math.max(t.length,1)}}return t}function Fg(e,s,r,i){var t="";if(!s.length){if("development"!=="production"){t="Must have at least one upstream dataset."}g(t)}if(!O(e)){if("development"!=="production"){t="transform declaration must be an object rather than "+typeof e+"."}g(t)}var n=e.type;var a=Bg.get(n);if(!a){if("development"!=="production"){t='Can not find transform on type "'+n+'".'}g(t)}var o=A(s,function(e){return Og(e,a)});var l=Ia(a.transform({upstream:o[0],upstreamList:o,config:M(e.config)}));if("development"!=="production"){if(e.print){var u=A(l,function(e){var t=i!=null?" === pipe index: "+i:"";return["=== dataset index: "+r.datasetIndex+t+" ===","- transform result data:",wa(e.data),"- transform result dimensions:",wa(e.dimensions)].join("\n")}).join("\n");ba(u)}}return A(l,function(e,t){var r="";if(!O(e)){if("development"!=="production"){r="A transform should not return some empty results."}g(r)}if(!e.data){if("development"!=="production"){r="Transform result data should be not be null or undefined"}g(r)}var i=Jd(e.data);if(!Hg(i)){if("development"!=="production"){r="Transform result data should be array rows or object rows."}g(r)}var n;var a=s[0];if(a&&t===0&&!e.dimensions){var o=a.startIndex;if(o){e.data=a.data.slice(0,o).concat(e.data)}n={seriesLayoutBy:Cv,sourceHeader:o,dimensions:a.metaRawOption.dimensions}}else{n={seriesLayoutBy:Cv,sourceHeader:0,dimensions:e.dimensions}}return Zd(e.data,n,null,null)})}function Hg(e){return e===bv||e===wv}var Wg=function(){function e(e){this._sourceList=[];this._upstreamSignList=[];this._versionSignBase=0;this._sourceHost=e}e.prototype.dirty=function(){this._setLocalSource([],[])};e.prototype._setLocalSource=function(e,t){this._sourceList=e;this._upstreamSignList=t;this._versionSignBase++;if(this._versionSignBase>9e10){this._versionSignBase=0}};e.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase};e.prototype.prepareSource=function(){if(this._isDirty()){this._createSource()}};e.prototype._createSource=function(){this._setLocalSource([],[]);var e=this._sourceHost;var t=this._getUpstreamSourceManagers();var r=!!t.length;var i;var n;if(Ug(e)){var a=e;var o=void 0;var s=void 0;var l=void 0;if(r){var u=t[0];u.prepareSource();l=u.getSource();o=l.data;s=l.sourceFormat;n=[u._getVersionSign()]}else{o=a.get("data",true);s=de(o)?Mv:_v;n=[]}var c=this._getSourceMetaRawOption();var f=l?l.metaRawOption:null;var h=N(c.seriesLayoutBy,f?f.seriesLayoutBy:null);var p=N(c.sourceHeader,f?f.sourceHeader:null);var v=N(c.dimensions,f?f.dimensions:null);i=[Zd(o,{seriesLayoutBy:h,sourceHeader:p,dimensions:v},s,a.get("encode",true))]}else{var d=e;if(r){var g=this._applyTransform(t);i=g.sourceList;n=g.upstreamSignList}else{var y=d.get("source",true);i=[Zd(y,this._getSourceMetaRawOption(),null,null)];n=[]}}if("development"!=="production"){E(i&&n)}this._setLocalSource(i,n)};e.prototype._applyTransform=function(e){var t=this._sourceHost;var r=t.get("transform",true);var i=t.get("fromTransformResult",true);if("development"!=="production"){E(i!=null||r!=null)}if(i!=null){var n="";if(e.length!==1){if("development"!=="production"){n="When using `fromTransformResult`, there should be only one upstream dataset"}Zg(n)}}var a;var o=[];var s=[];U(e,function(e){e.prepareSource();var t=e.getSource(i||0);var r="";if(i!=null&&!t){if("development"!=="production"){r="Can not retrieve result by `fromTransformResult`: "+i}Zg(r)}o.push(t);s.push(e._getVersionSign())});if(r){a=Gg(r,o,{datasetIndex:t.componentIndex})}else if(i!=null){a=[Xd(o[0])]}return{sourceList:a,upstreamSignList:s}};e.prototype._isDirty=function(){var e=this._sourceList;if(!e.length){return true}var t=this._getUpstreamSourceManagers();for(var r=0;r<t.length;r++){var i=t[r];if(i._isDirty()||this._upstreamSignList[r]!==i._getVersionSign()){return true}}};e.prototype.getSource=function(e){return this._sourceList[e||0]};e.prototype._getUpstreamSourceManagers=function(){var e=this._sourceHost;if(Ug(e)){var t=Ov(e);return!t?[]:[t.getSourceManager()]}else{return A(Nv(e),function(e){return e.getSourceManager()})}};e.prototype._getSourceMetaRawOption=function(){var e=this._sourceHost;var t;var r;var i;if(Ug(e)){t=e.get("seriesLayoutBy",true);r=e.get("sourceHeader",true);i=e.get("dimensions",true)}else if(!this._getUpstreamSourceManagers().length){var n=e;t=n.get("seriesLayoutBy",true);r=n.get("sourceHeader",true);i=n.get("dimensions",true)}return{seriesLayoutBy:t,sourceHeader:r,dimensions:i}};return e}();function jg(e){var t=e.option.transform;t&&Te(e.option.transform)}function Ug(e){return e.mainType==="series"}function Zg(e){throw new Error(e)}var Yg="line-height:1";function Xg(e,t){var r=e.color||"#6e7079";var i=e.fontSize||12;var n=e.fontWeight||"400";var a=e.color||"#464646";var o=e.fontSize||14;var s=e.fontWeight||"900";if(t==="html"){return{nameStyle:"font-size:"+Hp(i+"")+"px;color:"+Hp(r)+";font-weight:"+Hp(n+""),valueStyle:"font-size:"+Hp(o+"")+"px;color:"+Hp(a)+";font-weight:"+Hp(s+"")}}else{return{nameStyle:{fontSize:i,fill:r,fontWeight:n},valueStyle:{fontSize:o,fill:a,fontWeight:s}}}}var qg=[0,10,20,30];var Jg=["","\n","\n\n","\n\n\n"];function Kg(e,t){t.type=e;return t}function Qg(e){return z($g,e.type)&&$g[e.type]}var $g={section:{planLayout:function(e){var t=e.blocks.length;var r=t>1||t>0&&!e.noHeader;var i=0;U(e.blocks,function(e){Qg(e).planLayout(e);var t=e.__gapLevelBetweenSubBlocks;if(t>=i){i=t+(r&&(!t||e.type==="section"&&!e.noHeader)?1:0)}});e.__gapLevelBetweenSubBlocks=i},build:function(e,t,r,i){var n=t.noHeader;var a=ry(t);var o=ey(e,t,n?r:a.html,i);if(n){return o}var s=Wp(t.header,"ordinal",e.useUTC);var l=Xg(i,e.renderMode).nameStyle;if(e.renderMode==="richText"){return oy(e,s,l)+a.richText+o}else{return iy('<div style="'+l+";"+Yg+';">'+Hp(s)+"</div>"+o,r)}}},nameValue:{planLayout:function(e){e.__gapLevelBetweenSubBlocks=0},build:function(e,t,r,i){var n=e.renderMode;var a=t.noName;var o=t.noValue;var s=!t.markerType;var l=t.name;var u=t.value;var c=e.useUTC;if(a&&o){return}var f=s?"":e.markupStyleCreator.makeTooltipMarker(t.markerType,t.markerColor||"#333",n);var h=a?"":Wp(l,"ordinal",c);var p=t.valueType;var v=o?[]:k(u)?A(u,function(e,t){return Wp(e,k(p)?p[t]:p,c)}):[Wp(u,k(p)?p[0]:p,c)];var d=!s||!a;var g=!s&&a;var y=Xg(i,n),m=y.nameStyle,x=y.valueStyle;return n==="richText"?(s?"":f)+(a?"":oy(e,h,m))+(o?"":sy(e,v,d,g,x)):iy((s?"":f)+(a?"":ny(h,!s,m))+(o?"":ay(v,d,g,x)),r)}}};function ey(i,e,t,n){var a=[];var r=e.blocks||[];E(!r||k(r));r=r||[];var o=i.orderMode;if(e.sortBlocks&&o){r=r.slice();var s={valueAsc:"asc",valueDesc:"desc"};if(z(s,o)){var l=new Ag(s[o],null);r.sort(function(e,t){return l.evaluate(e.sortParam,t.sortParam)})}else if(o==="seriesDesc"){r.reverse()}}var u=ry(e);U(r,function(e,t){var r=Qg(e).build(i,e,t>0?u.html:0,n);r!=null&&a.push(r)});if(!a.length){return}return i.renderMode==="richText"?a.join(u.richText):iy(a.join(""),t)}function ty(e,t,r,i,n,a){if(!e){return}var o=Qg(e);o.planLayout(e);var s={useUTC:n,renderMode:r,orderMode:i,markupStyleCreator:t};return o.build(s,e,0,a)}function ry(e){var t=e.__gapLevelBetweenSubBlocks;return{html:qg[t],richText:Jg[t]}}function iy(e,t){var r='<div style="clear:both"></div>';var i="margin: "+t+"px 0 0";return'<div style="'+i+";"+Yg+';">'+e+r+"</div>"}function ny(e,t,r){var i=t?"margin-left:2px":"";return'<span style="'+r+";"+i+'">'+Hp(e)+"</span>"}function ay(e,t,r,i){var n=r?"10px":"20px";var a=t?"float:right;margin-left:"+n:"";return'<span style="'+a+";"+i+'">'+A(e,function(e){return Hp(e)}).join("&nbsp;&nbsp;")+"</span>"}function oy(e,t,r){return e.markupStyleCreator.wrapRichTextStyle(t,r)}function sy(e,t,r,i,n){var a=[n];var o=i?10:20;r&&a.push({padding:[0,0,0,o],align:"right"});return e.markupStyleCreator.wrapRichTextStyle(t.join("  "),a)}function ly(e,t){var r=e.getData().getItemVisual(t,"style");var i=r[e.visualDrawType];return Kp(i)}function uy(e,t){var r=e.get("padding");return r!=null?r:t==="richText"?[8,10]:10}var cy=function(){function e(){this.richTextStyles={};this._nextStyleNameId=fa()}e.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++};e.prototype.makeTooltipMarker=function(e,t,r){var i=r==="richText"?this._generateStyleName():null;var n=Xp({color:t,type:e,renderMode:r,markerId:i});if(P(n)){return n}else{if("development"!=="production"){E(i)}this.richTextStyles[i]=n.style;return n.content}};e.prototype.wrapRichTextStyle=function(e,t){var r={};if(k(t)){U(t,function(e){return F(r,e)})}else{F(r,t)}var i=this._generateStyleName();this.richTextStyles[i]=r;return"{"+i+"|"+e+"}"};return e}();function fy(e){var t=e.series;var r=e.dataIndex;var i=e.multipleSeries;var n=t.getData();var a=n.mapDimensionsAll("defaultedTooltip");var o=a.length;var s=t.getRawValue(r);var l=k(s);var u=ly(t,r);var c;var f;var h;var p;if(o>1||l&&!o){var v=hy(s,t,r,a,u);c=v.inlineValues;f=v.inlineValueTypes;h=v.blocks;p=v.inlineValues[0]}else if(o){var d=n.getDimensionInfo(a[0]);p=c=yg(n,r,a[0]);f=d.type}else{p=c=l?s[0]:s}var g=Ha(t);var y=g&&t.name||"";var m=n.getName(r);var x=i?y:m;return Kg("section",{header:y,noHeader:i||!g,sortParam:p,blocks:[Kg("nameValue",{markerType:"item",markerColor:u,name:x,noName:!Ie(x),value:c,valueType:f})].concat(h||[])})}function hy(e,t,r,i,n){var a=t.getData();var o=le(e,function(e,t,r){var i=a.getDimensionInfo(r);return e=e||i&&i.tooltip!==false&&i.displayName!=null},false);var s=[];var l=[];var u=[];i.length?U(i,function(e){c(yg(a,r,e),e)}):U(e,c);function c(e,t){var r=a.getDimensionInfo(t);if(!r||r.otherDims.tooltip===false){return}if(o){u.push(Kg("nameValue",{markerType:"subItem",markerColor:n,name:r.displayName,value:e,valueType:r.type}))}else{s.push(e);l.push(r.type)}}return{inlineValues:s,inlineValueTypes:l,blocks:u}}var py=qa();function vy(e,t){return e.getName(t)||e.getId(t)}var dy=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e._selectedDataIndicesMap={};return e}r.prototype.init=function(e,t,r){this.seriesIndex=this.componentIndex;this.dataTask=bg({count:my,reset:xy});this.dataTask.context={model:this};this.mergeDefaultAndTheme(e,r);var i=py(this).sourceManager=new Wg(this);i.prepareSource();var n=this.getInitialData(e,r);by(n,this);this.dataTask.context.data=n;if("development"!=="production"){E(n,"getInitialData returned invalid data.")}py(this).dataBeforeProcessed=n;gy(this);this._initSelectedMapFromData(n)};r.prototype.mergeDefaultAndTheme=function(e,t){var r=cv(this);var i=r?hv(e):{};var n=this.subType;if(p.hasClass(n)){n+="Series"}y(e,t.getTheme().get(this.subType));y(e,this.getDefaultOption());Ca(e,"label",["show"]);this.fillDataTextStyle(e.data);if(r){fv(e,i,r)}};r.prototype.mergeOption=function(e,t){e=y(this.option,e,true);this.fillDataTextStyle(e.data);var r=cv(this);if(r){fv(this.option,e,r)}var i=py(this).sourceManager;i.dirty();i.prepareSource();var n=this.getInitialData(e,t);by(n,this);this.dataTask.dirty();this.dataTask.context.data=n;py(this).dataBeforeProcessed=n;gy(this);this._initSelectedMapFromData(n)};r.prototype.fillDataTextStyle=function(e){if(e&&!de(e)){var t=["show"];for(var r=0;r<e.length;r++){if(e[r]&&e[r].label){Ca(e[r],"label",t)}}}};r.prototype.getInitialData=function(e,t){return};r.prototype.appendData=function(e){var t=this.getRawData();t.appendData(e.data)};r.prototype.getData=function(e){var t=Sy(this);if(t){var r=t.context.data;return e==null?r:r.getLinkedData(e)}else{return py(this).data}};r.prototype.getAllData=function(){var e=this.getData();return e&&e.getLinkedDataAll?e.getLinkedDataAll():[{data:e}]};r.prototype.setData=function(e){var t=Sy(this);if(t){var r=t.context;r.outputData=e;if(t!==this.dataTask){r.data=e}}py(this).data=e};r.prototype.getSource=function(){return py(this).sourceManager.getSource()};r.prototype.getRawData=function(){return py(this).dataBeforeProcessed};r.prototype.getBaseAxis=function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()};r.prototype.formatTooltip=function(e,t,r){return fy({series:this,dataIndex:e,multipleSeries:t})};r.prototype.isAnimationEnabled=function(){if(S.node){return false}var e=this.getShallow("animation");if(e){if(this.getData().count()>this.getShallow("animationThreshold")){e=false}}return!!e};r.prototype.restoreData=function(){this.dataTask.dirty()};r.prototype.getColorFromPalette=function(e,t,r){var i=this.ecModel;var n=Hv.prototype.getColorFromPalette.call(this,e,t,r);if(!n){n=i.getColorFromPalette(e,t,r)}return n};r.prototype.coordDimToDataDim=function(e){return this.getRawData().mapDimensionsAll(e)};r.prototype.getProgressive=function(){return this.get("progressive")};r.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")};r.prototype.select=function(e,t){this._innerSelect(this.getData(t),e)};r.prototype.unselect=function(e,t){var r=this.option.selectedMap;if(!r){return}var i=this.getData(t);for(var n=0;n<e.length;n++){var a=e[n];var o=vy(i,a);r[o]=false;this._selectedDataIndicesMap[o]=-1}};r.prototype.toggleSelect=function(e,t){var r=[];for(var i=0;i<e.length;i++){r[0]=e[i];this.isSelected(e[i],t)?this.unselect(r,t):this.select(r,t)}};r.prototype.getSelectedDataIndices=function(){var e=this._selectedDataIndicesMap;var t=L(e);var r=[];for(var i=0;i<t.length;i++){var n=e[t[i]];if(n>=0){r.push(n)}}return r};r.prototype.isSelected=function(e,t){var r=this.option.selectedMap;if(!r){return false}var i=this.getData(t);var n=vy(i,e);return r[n]||false};r.prototype._innerSelect=function(e,t){var r,i;var n=this.option.selectedMode;var a=t.length;if(!n||!a){return}if(n==="multiple"){var o=this.option.selectedMap||(this.option.selectedMap={});for(var s=0;s<a;s++){var l=t[s];var u=vy(e,l);o[u]=true;this._selectedDataIndicesMap[u]=e.getRawIndex(l)}}else if(n==="single"||n===true){var c=t[a-1];var u=vy(e,c);this.option.selectedMap=(r={},r[u]=true,r);this._selectedDataIndicesMap=(i={},i[u]=e.getRawIndex(c),i)}};r.prototype._initSelectedMapFromData=function(r){if(this.option.selectedMap){return}var i=[];if(r.hasItemOption){r.each(function(e){var t=r.getRawDataItem(e);if(t&&t.selected){i.push(e)}})}if(i.length>0){this._innerSelect(r,i)}};r.registerClass=function(e){return p.registerClass(e)};r.protoInitialize=function(){var e=r.prototype;e.type="series.__base__";e.seriesIndex=0;e.useColorPaletteOnData=false;e.ignoreStyleOnData=false;e.hasSymbolVisual=false;e.defaultSymbol="circle";e.visualStyleAccessPath="itemStyle";e.visualDrawType="fill"}();return r}(p);oe(dy,xg);oe(dy,Hv);go(dy,p);function gy(e){var t=e.name;if(!Ha(e)){e.name=yy(e)||t}}function yy(e){var r=e.getRawData();var t=r.mapDimensionsAll("seriesName");var i=[];U(t,function(e){var t=r.getDimensionInfo(e);t.displayName&&i.push(t.displayName)});return i.join(" ")}function my(e){return e.model.getRawData().count()}function xy(e){var t=e.model;t.setData(t.getRawData().cloneShallow());return _y}function _y(e,t){if(t.outputData&&e.end>t.outputData.count()){t.model.getRawData().cloneShallow(t.outputData)}}function by(t,r){U(o(t.CHANGABLE_METHODS,t.DOWNSAMPLE_METHODS),function(e){t.wrapMethod(e,_(wy,r))})}function wy(e,t){var r=Sy(e);if(r){r.setOutputEnd((t||this).count())}return t}function Sy(e){var t=(e.ecModel||{}).scheduler;var r=t&&t.getPipeline(e.uid);if(r){var i=r.currentTask;if(i){var n=i.agentStubMap;if(n){i=n.get(e.uid)}}return i}}var My=function(){function e(){this.group=new H;this.uid=Hh("viewComponent")}e.prototype.init=function(e,t){};e.prototype.render=function(e,t,r,i){};e.prototype.dispose=function(e,t){};e.prototype.updateView=function(e,t,r,i){};e.prototype.updateLayout=function(e,t,r,i){};e.prototype.updateVisual=function(e,t,r,i){};e.prototype.blurSeries=function(e,t){};return e}();po(My);bo(My);function Iy(){var s=qa();return function(e){var t=s(e);var r=e.pipelineContext;var i=!!t.large;var n=!!t.progressiveRender;var a=t.large=!!(r&&r.large);var o=t.progressiveRender=!!(r&&r.progressiveRender);return!!(i!==a||n!==o)&&"reset"}}var Cy=qa();var Ty=Iy();var v=function(){function t(){this.group=new H;this.uid=Hh("viewChart");this.renderTask=bg({plan:Ly,reset:ky});this.renderTask.context={view:this}}t.prototype.init=function(e,t){};t.prototype.render=function(e,t,r,i){};t.prototype.highlight=function(e,t,r,i){Ay(e.getData(),i,"emphasis")};t.prototype.downplay=function(e,t,r,i){Ay(e.getData(),i,"normal")};t.prototype.remove=function(e,t){this.group.removeAll()};t.prototype.dispose=function(e,t){};t.prototype.updateView=function(e,t,r,i){this.render(e,t,r,i)};t.prototype.updateLayout=function(e,t,r,i){this.render(e,t,r,i)};t.prototype.updateVisual=function(e,t,r,i){this.render(e,t,r,i)};t.markUpdateMethod=function(e,t){Cy(e).updateMethod=t};t.protoInitialize=function(){var e=t.prototype;e.type="chart"}();return t}();function Dy(e,t,r){if(e){(t==="emphasis"?Bu:Vu)(e,r)}}function Ay(t,e,r){var i=Xa(t,e);var n=e&&e.highlightKey!=null?uc(e.highlightKey):null;if(i!=null){U(Ia(i),function(e){Dy(t.getItemGraphicEl(e),r,n)})}else{t.eachItemGraphicEl(function(e){Dy(e,r,n)})}}po(v,["dispose"]);bo(v);function Ly(e){return Ty(e.model)}function ky(e){var t=e.model;var r=e.ecModel;var i=e.api;var n=e.payload;var a=t.pipelineContext.progressiveRender;var o=e.view;var s=n&&Cy(n).updateMethod;var l=a?"incrementalPrepareRender":s&&o[s]?s:"render";if(l!=="render"){o[l](t,r,i,n)}return Py[l]}var Py={incrementalPrepareRender:{progress:function(e,t){t.view.incrementalRender(e,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:true,progress:function(e,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}};var Oy="\0__throttleOriginMethod";var Ny="\0__throttleRate";var Ey="\0__throttleType";function Ry(e,n,a){var o;var s=0;var l=0;var u=null;var c;var f;var h;var p;n=n||0;function v(){l=(new Date).getTime();u=null;e.apply(f,h||[])}var t=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}o=(new Date).getTime();f=this;h=e;var r=p||n;var i=p||a;p=null;c=o-(i?s:l)-r;clearTimeout(u);if(i){u=setTimeout(v,r)}else{if(c>=0){v()}else{u=setTimeout(v,-c)}}s=o};t.clear=function(){if(u){clearTimeout(u);u=null}};t.debounceNextCall=function(e){p=e};return t}function zy(e,t,r,i){var n=e[t];if(!n){return}var a=n[Oy]||n;var o=n[Ey];var s=n[Ny];if(s!==r||o!==i){if(r==null||!i){return e[t]=a}n=e[t]=Ry(a,r,i==="debounce");n[Oy]=a;n[Ey]=i;n[Ny]=r}return n}function By(e,t){var r=e[t];if(r&&r[Oy]){e[t]=r[Oy]}}var Vy=qa();var Gy={itemStyle:wo(Bh,true),lineStyle:wo(Eh,true)};var Fy={lineStyle:"stroke",itemStyle:"fill"};function Hy(e,t){var r=e.visualStyleMapper||Gy[t];if(!r){console.warn("Unkown style type '"+t+"'.");return Gy.itemStyle}return r}function Wy(e,t){var r=e.visualDrawType||Fy[t];if(!r){console.warn("Unkown style type '"+t+"'.");return"fill"}return r}var jy={createOnAllSeries:true,performRawSeries:true,reset:function(n,e){var t=n.getData();var r=n.visualStyleAccessPath||"itemStyle";var i=n.getModel(r);var a=Hy(n,r);var o=a(i);var s=i.getShallow("decal");if(s){t.setVisual("decal",s);s.dirty=true}var l=Wy(n,r);var u=o[l];var c=b(u)?u:null;var f=o.fill==="auto"||o.stroke==="auto";if(!o[l]||c||f){var h=n.getColorFromPalette(n.name,null,e.getSeriesCount());if(!o[l]){o[l]=h;t.setVisual("colorFromPalette",true)}o.fill=o.fill==="auto"||typeof o.fill==="function"?h:o.fill;o.stroke=o.stroke==="auto"||typeof o.stroke==="function"?h:o.stroke}t.setVisual("style",o);t.setVisual("drawType",l);if(!e.isSeriesFiltered(n)&&c){t.setVisual("colorFromPalette",false);return{dataEach:function(e,t){var r=n.getDataParams(t);var i=F({},o);i[l]=c(r);e.setItemVisual(t,"style",i)}}}}};var Uy=new C;var Zy={createOnAllSeries:true,performRawSeries:true,reset:function(e,t){if(e.ignoreStyleOnData||t.isSeriesFiltered(e)){return}var r=e.getData();var a=e.visualStyleAccessPath||"itemStyle";var o=Hy(e,a);var s=r.getVisual("drawType");return{dataEach:r.hasItemOption?function(e,t){var r=e.getRawDataItem(t);if(r&&r[a]){Uy.option=r[a];var i=o(Uy);var n=e.ensureUniqueItemVisual(t,"style");F(n,i);if(Uy.option.decal){e.setItemVisual(t,"decal",Uy.option.decal);Uy.option.decal.dirty=true}if(s in i){e.setItemVisual(t,"colorFromPalette",false)}}}:null}}};var Yy={performRawSeries:true,overallReset:function(t){var r=I();t.eachSeries(function(e){if(!e.useColorPaletteOnData){return}var t=r.get(e.type);if(!t){t={};r.set(e.type,t)}Vy(e).scope=t});t.eachSeries(function(o){if(!o.useColorPaletteOnData||t.isSeriesFiltered(o)){return}var s=o.getRawData();var l={};var u=o.getData();var c=Vy(o).scope;var e=o.visualStyleAccessPath||"itemStyle";var f=Wy(o,e);u.each(function(e){var t=u.getRawIndex(e);l[t]=e});s.each(function(e){var t=l[e];var r=u.getItemVisual(t,"colorFromPalette");if(r){var i=u.ensureUniqueItemVisual(t,"style");var n=s.getName(e)||e+"";var a=s.count();i[f]=o.getColorFromPalette(n,c,a)}})})}};var Xy=Math.PI;function qy(n,a){a=a||{};R(a,{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:true,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var e=new H;var o=new G({style:{fill:a.maskColor},zlevel:a.zlevel,z:1e4});e.add(o);var s=new W({style:{text:a.text,fill:a.textColor,fontSize:a.fontSize,fontWeight:a.fontWeight,fontStyle:a.fontStyle,fontFamily:a.fontFamily},zlevel:a.zlevel,z:10001});var l=new G({style:{fill:"none"},textContent:s,textConfig:{position:"right",distance:10},zlevel:a.zlevel,z:10001});e.add(l);var u;if(a.showSpinner){u=new _f({shape:{startAngle:-Xy/2,endAngle:-Xy/2+.1,r:a.spinnerRadius},style:{stroke:a.color,lineCap:"round",lineWidth:a.lineWidth},zlevel:a.zlevel,z:10001});u.animateShape(true).when(1e3,{endAngle:Xy*3/2}).start("circularInOut");u.animateShape(true).when(1e3,{startAngle:Xy*3/2}).delay(300).start("circularInOut");e.add(u)}e.resize=function(){var e=s.getBoundingRect().width;var t=a.showSpinner?a.spinnerRadius:0;var r=(n.getWidth()-t*2-(a.showSpinner&&e?10:0)-e)/2-(a.showSpinner&&e?0:5+e/2)+(a.showSpinner?0:e/2)+(e?0:t);var i=n.getHeight()/2;a.showSpinner&&u.setShape({cx:r,cy:i});l.setShape({x:r-t,y:i-t,width:t*2,height:t*2});o.setShape({x:0,y:0,width:n.getWidth(),height:n.getHeight()})};e.resize();return e}var Jy=function(){function e(e,t,r,i){this._stageTaskMap=I();this.ecInstance=e;this.api=t;r=this._dataProcessorHandlers=r.slice();i=this._visualHandlers=i.slice();this._allHandlers=r.concat(i)}e.prototype.restoreData=function(e,t){e.restoreData(t);this._stageTaskMap.each(function(e){var t=e.overallTask;t&&t.dirty()})};e.prototype.getPerformArgs=function(e,t){if(!e.__pipeline){return}var r=this._pipelineMap.get(e.__pipeline.id);var i=r.context;var n=!t&&r.progressiveEnabled&&(!i||i.progressiveRender)&&e.__idxInPipeline>r.blockIndex;var a=n?r.step:null;var o=i&&i.modDataCount;var s=o!=null?Math.ceil(o/a):null;return{step:a,modBy:s,modDataCount:o}};e.prototype.getPipeline=function(e){return this._pipelineMap.get(e)};e.prototype.updateStreamModes=function(e,t){var r=this._pipelineMap.get(e.uid);var i=e.getData();var n=i.count();var a=r.progressiveEnabled&&t.incrementalPrepareRender&&n>=r.threshold;var o=e.get("large")&&n>=e.get("largeThreshold");var s=e.get("progressiveChunkMode")==="mod"?n:null;e.pipelineContext=r.context={progressiveRender:a,modDataCount:s,large:o}};e.prototype.restorePipelines=function(e){var i=this;var n=i._pipelineMap=I();e.eachSeries(function(e){var t=e.getProgressive();var r=e.uid;n.set(r,{id:r,head:null,tail:null,threshold:e.getProgressiveThreshold(),progressiveEnabled:t&&!(e.preventIncremental&&e.preventIncremental()),blockIndex:-1,step:Math.round(t||700),count:0});i._pipe(e,e.dataTask)})};e.prototype.prepareStageTasks=function(){var i=this._stageTaskMap;var n=this.api.getModel();var a=this.api;U(this._allHandlers,function(e){var t=i.get(e.uid)||i.set(e.uid,{});var r="";if("development"!=="production"){r='"reset" and "overallReset" must not be both specified.'}E(!(e.reset&&e.overallReset),r);e.reset&&this._createSeriesStageTask(e,t,n,a);e.overallReset&&this._createOverallStageTask(e,t,n,a)},this)};e.prototype.prepareView=function(e,t,r,i){var n=e.renderTask;var a=n.context;a.model=t;a.ecModel=r;a.api=i;n.__block=!e.incrementalPrepareRender;this._pipe(t,n)};e.prototype.performDataProcessorTasks=function(e,t){this._performStageTasks(this._dataProcessorHandlers,e,t,{block:true})};e.prototype.performVisualTasks=function(e,t,r){this._performStageTasks(this._visualHandlers,e,t,r)};e.prototype._performStageTasks=function(e,l,u,c){c=c||{};var f=false;var h=this;U(e,function(i,e){if(c.visualType&&c.visualType!==i.visualType){return}var t=h._stageTaskMap.get(i.uid);var r=t.seriesTaskMap;var n=t.overallTask;if(n){var a;var o=n.agentStubMap;o.each(function(e){if(p(c,e)){e.dirty();a=true}});a&&n.dirty();h.updatePayload(n,u);var s=h.getPerformArgs(n,c.block);o.each(function(e){e.perform(s)});if(n.perform(s)){f=true}}else if(r){r.each(function(e,t){if(p(c,e)){e.dirty()}var r=h.getPerformArgs(e,c.block);r.skip=!i.performRawSeries&&l.isSeriesFiltered(e.context.model);h.updatePayload(e,u);if(e.perform(r)){f=true}})}});function p(e,t){return e.setDirty&&(!e.dirtyMap||e.dirtyMap.get(t.__pipeline.id))}this.unfinished=f||this.unfinished};e.prototype.performSeriesTasks=function(e){var t;e.eachSeries(function(e){t=e.dataTask.perform()||t});this.unfinished=t||this.unfinished};e.prototype.plan=function(){this._pipelineMap.each(function(e){var t=e.tail;do{if(t.__block){e.blockIndex=t.__idxInPipeline;break}t=t.getUpstream()}while(t)})};e.prototype.updatePayload=function(e,t){t!=="remain"&&(e.context.payload=t)};e.prototype._createSeriesStageTask=function(i,e,n,a){var o=this;var s=e.seriesTaskMap;var l=e.seriesTaskMap=I();var t=i.seriesType;var r=i.getTargetSeries;if(i.createOnAllSeries){n.eachRawSeries(u)}else if(t){n.eachRawSeriesByType(t,u)}else if(r){r(n,a).each(u)}function u(e){var t=e.uid;var r=l.set(t,s&&s.get(t)||bg({plan:tm,reset:rm,count:am}));r.context={model:e,ecModel:n,api:a,useClearVisual:i.isVisual&&!i.isLayout,plan:i.plan,reset:i.reset,scheduler:o};o._pipe(e,r)}};e.prototype._createOverallStageTask=function(e,t,r,i){var n=this;var a=t.overallTask=t.overallTask||bg({reset:Ky});a.context={ecModel:r,api:i,overallReset:e.overallReset,scheduler:n};var o=a.agentStubMap;var s=a.agentStubMap=I();var l=e.seriesType;var u=e.getTargetSeries;var c=true;var f=false;var h="";if("development"!=="production"){h='"createOnAllSeries" do not supported for "overallReset", '+"becuase it will block all streams."}E(!e.createOnAllSeries,h);if(l){r.eachRawSeriesByType(l,p)}else if(u){u(r,i).each(p)}else{c=false;U(r.getSeries(),p)}function p(e){var t=e.uid;var r=s.set(t,o&&o.get(t)||(f=true,bg({reset:Qy,onDirty:em})));r.context={model:e,overallProgress:c};r.agent=a;r.__block=c;n._pipe(e,r)}if(f){a.dirty()}};e.prototype._pipe=function(e,t){var r=e.uid;var i=this._pipelineMap.get(r);!i.head&&(i.head=t);i.tail&&i.tail.pipe(t);i.tail=t;t.__idxInPipeline=i.count++;t.__pipeline=i};e.wrapStageHandler=function(e,t){if(b(e)){e={overallReset:e,seriesType:om(e)}}e.uid=Hh("stageHandler");t&&(e.visualType=t);return e};return e}();function Ky(e){e.overallReset(e.ecModel,e.api,e.payload)}function Qy(e){return e.overallProgress&&$y}function $y(){this.agent.dirty();this.getDownstream().dirty()}function em(){this.agent&&this.agent.dirty()}function tm(e){return e.plan?e.plan(e.model,e.ecModel,e.api,e.payload):null}function rm(e){if(e.useClearVisual){e.data.clearAllVisual()}var t=e.resetDefines=Ia(e.reset(e.model,e.ecModel,e.api,e.payload));return t.length>1?A(t,function(e,t){return nm(t)}):im}var im=nm(0);function nm(a){return function(e,t){var r=t.data;var i=t.resetDefines[a];if(i&&i.dataEach){for(var n=e.start;n<e.end;n++){i.dataEach(r,n)}}else if(i&&i.progress){i.progress(e,r)}}}function am(e){return e.data.count()}function om(e){um=null;try{e(sm,lm)}catch(e){}return um}var sm={};var lm={};var um;cm(sm,rd);cm(lm,ud);sm.eachSeriesByType=sm.eachRawSeriesByType=function(e){um=e};sm.eachComponent=function(e){if(e.mainType==="series"&&e.subType){um=e.subType}};function cm(e,t){for(var r in t.prototype){e[r]=Pe}}var fm=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"];var hm={color:fm,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],fm]};var pm="#B9B8CE";var vm="#100C2A";var dm=function(){return{axisLine:{lineStyle:{color:pm}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}}};var gm=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"];var ym={darkMode:true,color:gm,backgroundColor:vm,axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:pm}},textStyle:{color:pm},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:pm}},dataZoom:{borderColor:"#71708A",textStyle:{color:pm},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:pm}},timeline:{lineStyle:{color:pm},label:{color:pm},controlStyle:{color:pm,borderColor:pm}},calendar:{itemStyle:{color:vm},dayLabel:{color:pm},monthLabel:{color:pm},yearLabel:{color:pm}},timeAxis:dm(),logAxis:dm(),valueAxis:dm(),categoryAxis:dm(),line:{symbol:"circle"},graph:{color:gm},gauge:{title:{color:pm},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:pm},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};ym.categoryAxis.splitLine.show=false;var mm=function(){function e(){}e.prototype.normalizeQuery=function(e){var s={};var l={};var u={};if(P(e)){var t=co(e);s.mainType=t.main||null;s.subType=t.sub||null}else{var c=["Index","Name","Id"];var f={name:1,dataIndex:1,dataType:1};U(e,function(e,t){var r=false;for(var i=0;i<c.length;i++){var n=c[i];var a=t.lastIndexOf(n);if(a>0&&a===t.length-n.length){var o=t.slice(0,a);if(o!=="data"){s.mainType=o;s[n.toLowerCase()]=e;r=true}}}if(f.hasOwnProperty(t)){l[t]=e;r=true}if(!r){u[t]=e}})}return{cptQuery:s,dataQuery:l,otherQuery:u}};e.prototype.filter=function(e,t){var r=this.eventInfo;if(!r){return true}var i=r.targetEl;var n=r.packedEvent;var a=r.model;var o=r.view;if(!a||!o){return true}var s=t.cptQuery;var l=t.dataQuery;return u(s,a,"mainType")&&u(s,a,"subType")&&u(s,a,"index","componentIndex")&&u(s,a,"name")&&u(s,a,"id")&&u(l,n,"name")&&u(l,n,"dataIndex")&&u(l,n,"dataType")&&(!o.filterForExposedEvent||o.filterForExposedEvent(e,t.otherQuery,i,n));function u(e,t,r,i){return e[r]==null||t[i||r]===e[r]}};e.prototype.afterTrigger=function(){this.eventInfo=null};return e}();var xm={createOnAllSeries:true,performRawSeries:true,reset:function(n,e){var t=n.getData();if(n.legendIcon){t.setVisual("legendIcon",n.legendIcon)}if(!n.hasSymbolVisual){return}var a=n.get("symbol");var o=n.get("symbolSize");var r=n.get("symbolKeepAspect");var s=n.get("symbolRotate");var l=n.get("symbolOffset");var u=b(a);var c=b(o);var f=b(s);var h=b(l);var i=u||c||f||h;var p=!u&&a?a:n.defaultSymbol;var v=!c?o:null;var d=!f?s:null;var g=!h?l:null;t.setVisual({legendIcon:n.legendIcon||p,symbol:p,symbolSize:v,symbolKeepAspect:r,symbolRotate:d,symbolOffset:g});if(e.isSeriesFiltered(n)){return}function y(e,t){var r=n.getRawValue(t);var i=n.getDataParams(t);u&&e.setItemVisual(t,"symbol",a(r,i));c&&e.setItemVisual(t,"symbolSize",o(r,i));f&&e.setItemVisual(t,"symbolRotate",s(r,i));h&&e.setItemVisual(t,"symbolOffset",l(r,i))}return{dataEach:i?y:null}}};var _m={createOnAllSeries:true,performRawSeries:true,reset:function(e,t){if(!e.hasSymbolVisual){return}if(t.isSeriesFiltered(e)){return}var r=e.getData();function i(e,t){var r=e.getItemModel(t);var i=r.getShallow("symbol",true);var n=r.getShallow("symbolSize",true);var a=r.getShallow("symbolRotate",true);var o=r.getShallow("symbolOffset",true);var s=r.getShallow("symbolKeepAspect",true);if(i!=null){e.setItemVisual(t,"symbol",i)}if(n!=null){e.setItemVisual(t,"symbolSize",n)}if(a!=null){e.setItemVisual(t,"symbolRotate",a)}if(o!=null){e.setItemVisual(t,"symbolOffset",o)}if(s!=null){e.setItemVisual(t,"symbolKeepAspect",s)}}return{dataEach:r.hasItemOption?i:null}}};function bm(e,t,r){switch(r){case"color":var i=e.getItemVisual(t,"style");return i[e.getVisual("drawType")];case"opacity":return e.getItemVisual(t,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return e.getItemVisual(t,r);default:if("development"!=="production"){console.warn("Unknown visual type "+r)}}}function wm(e,t){switch(t){case"color":var r=e.getVisual("style");return r[e.getVisual("drawType")];case"opacity":return e.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return e.getVisual(t);default:if("development"!=="production"){console.warn("Unknown visual type "+t)}}}function Sm(e,t,r,i){switch(r){case"color":var n=e.ensureUniqueItemVisual(t,"style");n[e.getVisual("drawType")]=i;e.setItemVisual(t,"colorFromPalette",false);break;case"opacity":e.ensureUniqueItemVisual(t,"style").opacity=i;break;case"symbol":case"symbolSize":case"liftZ":e.setItemVisual(t,r,i);break;default:if("development"!=="production"){console.warn("Unknown visual type "+r)}}}var Mm=Math.PI*2;var Im=ol.CMD;var Cm=["top","right","bottom","left"];function Tm(e,t,r,i,n){var a=r.width;var o=r.height;switch(e){case"top":i.set(r.x+a/2,r.y-t);n.set(0,-1);break;case"bottom":i.set(r.x+a/2,r.y+o+t);n.set(0,1);break;case"left":i.set(r.x-t,r.y+o/2);n.set(-1,0);break;case"right":i.set(r.x+a+t,r.y+o/2);n.set(1,0);break}}function Dm(e,t,r,i,n,a,o,s,l){o-=e;s-=t;var u=Math.sqrt(o*o+s*s);o/=u;s/=u;var c=o*r+e;var f=s*r+t;if(Math.abs(i-n)%Mm<1e-4){l[0]=c;l[1]=f;return u-r}if(a){var h=i;i=fl(n);n=fl(h)}else{i=fl(i);n=fl(n)}if(i>n){n+=Mm}var p=Math.atan2(s,o);if(p<0){p+=Mm}if(p>=i&&p<=n||p+Mm>=i&&p+Mm<=n){l[0]=c;l[1]=f;return u-r}var v=r*Math.cos(i)+e;var d=r*Math.sin(i)+t;var g=r*Math.cos(n)+e;var y=r*Math.sin(n)+t;var m=(v-o)*(v-o)+(d-s)*(d-s);var x=(g-o)*(g-o)+(y-s)*(y-s);if(m<x){l[0]=v;l[1]=d;return Math.sqrt(m)}else{l[0]=g;l[1]=y;return Math.sqrt(x)}}function Am(e,t,r,i,n,a,o,s){var l=n-e;var u=a-t;var c=r-e;var f=i-t;var h=Math.sqrt(c*c+f*f);c/=h;f/=h;var p=l*c+u*f;var v=p/h;if(s){v=Math.min(Math.max(v,0),1)}v*=h;var d=o[0]=e+v*c;var g=o[1]=t+v*f;return Math.sqrt((d-n)*(d-n)+(g-a)*(g-a))}function Lm(e,t,r,i,n,a,o){if(r<0){e=e+r;r=-r}if(i<0){t=t+i;i=-i}var s=e+r;var l=t+i;var u=o[0]=Math.min(Math.max(n,e),s);var c=o[1]=Math.min(Math.max(a,t),l);return Math.sqrt((u-n)*(u-n)+(c-a)*(c-a))}var km=[];function Pm(e,t,r){var i=Lm(t.x,t.y,t.width,t.height,e.x,e.y,km);r.set(km[0],km[1]);return i}function Om(e,t,r){var i=0;var n=0;var a=0;var o=0;var s;var l;var u=Infinity;var c=t.data;var f=e.x;var h=e.y;for(var p=0;p<c.length;){var v=c[p++];if(p===1){i=c[p];n=c[p+1];a=i;o=n}var d=u;switch(v){case Im.M:a=c[p++];o=c[p++];i=a;n=o;break;case Im.L:d=Am(i,n,c[p],c[p+1],f,h,km,true);i=c[p++];n=c[p++];break;case Im.C:d=ys(i,n,c[p++],c[p++],c[p++],c[p++],c[p],c[p+1],f,h,km);i=c[p++];n=c[p++];break;case Im.Q:d=Ms(i,n,c[p++],c[p++],c[p],c[p+1],f,h,km);i=c[p++];n=c[p++];break;case Im.A:var g=c[p++];var y=c[p++];var m=c[p++];var x=c[p++];var _=c[p++];var b=c[p++];p+=1;var w=!!(1-c[p++]);s=Math.cos(_)*m+g;l=Math.sin(_)*x+y;if(p<=1){a=s;o=l}var S=(f-g)*x/m+g;d=Dm(g,y,x,_,_+b,w,S,h,km);i=Math.cos(_+b)*m+g;n=Math.sin(_+b)*x+y;break;case Im.R:a=i=c[p++];o=n=c[p++];var M=c[p++];var I=c[p++];d=Lm(a,o,M,I,f,h,km);break;case Im.Z:d=Am(i,n,a,o,f,h,km,true);i=a;n=o;break}if(d<u){u=d;r.set(km[0],km[1])}}return u}var Nm=new Z;var Em=new Z;var Rm=new Z;var zm=new Z;var Bm=new Z;function Vm(e,t){if(!e){return}var r=e.getTextGuideLine();var i=e.getTextContent();if(!(i&&r)){return}var n=e.textGuideLineConfig||{};var a=[[0,0],[0,0],[0,0]];var o=n.candidates||Cm;var s=i.getBoundingRect().clone();s.applyTransform(i.getComputedTransform());var l=Infinity;var u=n.anchor;var c=e.getComputedTransform();var f=c&&Vi([],c);var h=t.get("length2")||0;if(u){Rm.copy(u)}for(var p=0;p<o.length;p++){var v=o[p];Tm(v,0,s,Nm,zm);Z.scaleAndAdd(Em,Nm,zm,h);Em.transform(f);var d=e.getBoundingRect();var g=u?u.distance(Em):e instanceof m?Om(Em,e.path,Rm):Pm(Em,d,Rm);if(g<l){l=g;Em.transform(c);Rm.transform(c);Rm.toArray(a[0]);Em.toArray(a[1]);Nm.toArray(a[2])}}Hm(a,t.get("minTurnAngle"));r.setShape({points:a})}var Gm=[];var Fm=new Z;function Hm(e,t){if(!(t<=180&&t>0)){return}t=t/180*Math.PI;Nm.fromArray(e[0]);Em.fromArray(e[1]);Rm.fromArray(e[2]);Z.sub(zm,Nm,Em);Z.sub(Bm,Rm,Em);var r=zm.len();var i=Bm.len();if(r<.001||i<.001){return}zm.scale(1/r);Bm.scale(1/i);var n=zm.dot(Bm);var a=Math.cos(t);if(a<n){var o=Am(Em.x,Em.y,Rm.x,Rm.y,Nm.x,Nm.y,Gm,false);Fm.fromArray(Gm);Fm.scaleAndAdd(Bm,o/Math.tan(Math.PI-t));var s=Rm.x!==Em.x?(Fm.x-Em.x)/(Rm.x-Em.x):(Fm.y-Em.y)/(Rm.y-Em.y);if(isNaN(s)){return}if(s<0){Z.copy(Fm,Em)}else if(s>1){Z.copy(Fm,Rm)}Fm.toArray(e[1])}}function Wm(e,t,r){if(!(r<=180&&r>0)){return}r=r/180*Math.PI;Nm.fromArray(e[0]);Em.fromArray(e[1]);Rm.fromArray(e[2]);Z.sub(zm,Em,Nm);Z.sub(Bm,Rm,Em);var i=zm.len();var n=Bm.len();if(i<.001||n<.001){return}zm.scale(1/i);Bm.scale(1/n);var a=zm.dot(t);var o=Math.cos(r);if(a<o){var s=Am(Em.x,Em.y,Rm.x,Rm.y,Nm.x,Nm.y,Gm,false);Fm.fromArray(Gm);var l=Math.PI/2;var u=Math.acos(Bm.dot(t));var c=l+u-r;if(c>=l){Z.copy(Fm,Rm)}else{Fm.scaleAndAdd(Bm,s/Math.tan(Math.PI/2-c));var f=Rm.x!==Em.x?(Fm.x-Em.x)/(Rm.x-Em.x):(Fm.y-Em.y)/(Rm.y-Em.y);if(isNaN(f)){return}if(f<0){Z.copy(Fm,Em)}else if(f>1){Z.copy(Fm,Rm)}}Fm.toArray(e[1])}}function jm(e,t,r,i){var n=r==="normal";var a=n?e:e.ensureState(r);a.ignore=t;var o=i.get("smooth");if(o&&o===true){o=.3}a.shape=a.shape||{};if(o>0){a.shape.smooth=o}var s=i.getModel("lineStyle").getLineStyle();n?e.useStyle(s):a.style=s}function Um(e,t){var r=t.smooth;var i=t.points;if(!i){return}e.moveTo(i[0][0],i[0][1]);if(r>0&&i.length>=3){var n=Ke(i[0],i[1]);var a=Ke(i[1],i[2]);if(!n||!a){e.lineTo(i[1][0],i[1][1]);e.lineTo(i[2][0],i[2][1]);return}var o=Math.min(n,a)*r;var s=tt([],i[1],i[0],o/n);var l=tt([],i[1],i[2],o/a);var u=tt([],s,l,.5);e.bezierCurveTo(s[0],s[1],s[0],s[1],u[0],u[1]);e.bezierCurveTo(l[0],l[1],l[0],l[1],i[2][0],i[2][1])}else{for(var c=1;c<i.length;c++){e.lineTo(i[c][0],i[c][1])}}}function Zm(e,t,r){var i=e.getTextGuideLine();var n=e.getTextContent();if(!n){if(i){e.removeTextGuideLine()}return}var a=t.normal;var o=a.get("show");var s=n.ignore;for(var l=0;l<uu.length;l++){var u=uu[l];var c=t[u];var f=u==="normal";if(c){var h=c.get("show");var p=f?s:N(n.states[u]&&n.states[u].ignore,s);if(p||!N(h,o)){var v=f?i:i&&i.states.normal;if(v){v.ignore=true}continue}if(!i){i=new ff;e.setTextGuideLine(i);if(!f&&(s||!o)){jm(i,true,"normal",t.normal)}if(e.stateProxy){i.stateProxy=e.stateProxy}}jm(i,false,u,c)}}if(i){R(i.style,r);i.style.fill=null;var d=a.get("showAbove");var g=e.textGuideLineConfig=e.textGuideLineConfig||{};g.showAbove=d||false;i.buildPath=Um}}function Ym(e,t){t=t||"labelLine";var r={normal:e.getModel(t)};for(var i=0;i<lu.length;i++){var n=lu[i];r[n]=e.getModel([n,t])}return r}function Xm(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.defaultAttr.ignore){continue}var n=i.label;var a=n.getComputedTransform();var o=n.getBoundingRect();var s=!a||a[1]<1e-5&&a[2]<1e-5;var l=n.style.margin||0;var u=o.clone();u.applyTransform(a);u.x-=l/2;u.y-=l/2;u.width+=l;u.height+=l;var c=s?new Af(o,a):null;t.push({label:n,labelLine:i.labelLine,rect:u,localRect:o,obb:c,priority:i.priority,defaultAttr:i.defaultAttr,layoutOption:i.computedLayoutOption,axisAligned:s,transform:a})}return t}function qm(u,c,f,e,t,r){var h=u.length;if(h<2){return}u.sort(function(e,t){return e.rect[c]-t.rect[c]});var i=0;var n;var o=false;var a=0;for(var s=0;s<h;s++){var l=u[s];var p=l.rect;n=p[c]-i;if(n<0){p[c]-=n;l.label[c]-=n;o=true}var v=Math.max(-n,0);a+=v;i=p[c]+p[f]}if(a>0&&r){b(-a/h,0,h)}var d=u[0];var g=u[h-1];var y;var m;x();y<0&&w(-y,.8);m<0&&w(m,.8);x();_(y,m,1);_(m,y,-1);x();if(y<0){S(-y)}if(m<0){S(m)}function x(){y=d.rect[c]-e;m=t-g.rect[c]-g.rect[f]}function _(e,t,r){if(e<0){var i=Math.min(t,-e);if(i>0){b(i*r,0,h);var n=i+e;if(n<0){w(-n*r,1)}}else{w(-e*r,1)}}}function b(e,t,r){if(e!==0){o=true}for(var i=t;i<r;i++){var n=u[i];var a=n.rect;a[c]+=e;n.label[c]+=e}}function w(e,t){var r=[];var i=0;for(var n=1;n<h;n++){var a=u[n-1].rect;var o=Math.max(u[n].rect[c]-a[c]-a[f],0);r.push(o);i+=o}if(!i){return}var s=Math.min(Math.abs(e)/i,t);if(e>0){for(var n=0;n<h-1;n++){var l=r[n]*s;b(l,0,n+1)}}else{for(var n=h-1;n>0;n--){var l=r[n-1]*s;b(-l,n,h)}}}function S(e){var t=e<0?-1:1;e=Math.abs(e);var r=Math.ceil(e/(h-1));for(var i=0;i<h-1;i++){if(t>0){b(r,0,i+1)}else{b(-r,h-i-1,h)}e-=r;if(e<=0){return}}}return o}function Jm(e,t,r,i){return qm(e,"x","width",t,r,i)}function Km(e,t,r,i){return qm(e,"y","height",t,r,i)}function Qm(e){var t=[];e.sort(function(e,t){return t.priority-e.priority});var r=new B(0,0,0,0);function i(e){if(!e.ignore){var t=e.ensureState("emphasis");if(t.ignore==null){t.ignore=false}}e.ignore=true}for(var n=0;n<e.length;n++){var a=e[n];var o=a.axisAligned;var s=a.localRect;var l=a.transform;var u=a.label;var c=a.labelLine;r.copy(a.rect);r.width-=.1;r.height-=.1;r.x+=.05;r.y+=.05;var f=a.obb;var h=false;for(var p=0;p<t.length;p++){var v=t[p];if(!r.intersect(v.rect)){continue}if(o&&v.axisAligned){h=true;break}if(!v.obb){v.obb=new Af(v.localRect,v.transform)}if(!f){f=new Af(s,l)}if(f.intersect(v.obb)){h=true;break}}if(h){i(u);c&&i(c)}else{u.attr("ignore",a.defaultAttr.ignore);c&&c.attr("ignore",a.defaultAttr.labelGuideIgnore);t.push(a)}}}function $m(e){if(e){var t=[];for(var r=0;r<e.length;r++){t.push(e[r].slice())}return t}}function e0(e,t){var r=e.label;var i=t&&t.getTextGuideLine();return{dataIndex:e.dataIndex,dataType:e.dataType,seriesIndex:e.seriesModel.seriesIndex,text:e.label.style.text,rect:e.hostRect,labelRect:e.rect,align:r.style.align,verticalAlign:r.style.verticalAlign,labelLinePoints:$m(i&&i.shape.points)}}var t0=["align","verticalAlign","width","height","fontSize"];var r0=new qi;var i0=qa();var n0=qa();function a0(e,t,r){for(var i=0;i<r.length;i++){var n=r[i];if(t[n]!=null){e[n]=t[n]}}}var o0=["x","y","rotation"];var s0=function(){function e(){this._labelList=[];this._chartViewList=[]}e.prototype.clearLabels=function(){this._labelList=[];this._chartViewList=[]};e.prototype._addLabel=function(e,t,r,i,n){var a=i.style;var o=i.__hostTarget;var s=o.textConfig||{};var l=i.getComputedTransform();var u=i.getBoundingRect().plain();B.applyTransform(u,u,l);if(l){r0.setLocalTransform(l)}else{r0.x=r0.y=r0.rotation=r0.originX=r0.originY=0;r0.scaleX=r0.scaleY=1}var c=i.__hostTarget;var f;if(c){f=c.getBoundingRect().plain();var h=c.getComputedTransform();B.applyTransform(f,f,h)}var p=f&&c.getTextGuideLine();this._labelList.push({label:i,labelLine:p,seriesModel:r,dataIndex:e,dataType:t,layoutOption:n,computedLayoutOption:null,rect:u,hostRect:f,priority:f?f.width*f.height:0,defaultAttr:{ignore:i.ignore,labelGuideIgnore:p&&p.ignore,x:r0.x,y:r0.y,scaleX:r0.scaleX,scaleY:r0.scaleY,rotation:r0.rotation,style:{x:a.x,y:a.y,align:a.align,verticalAlign:a.verticalAlign,width:a.width,height:a.height,fontSize:a.fontSize},cursor:i.cursor,attachedPos:s.position,attachedRot:s.rotation}})};e.prototype.addLabelsOfSeries=function(e){var i=this;this._chartViewList.push(e);var n=e.__model;var a=n.get("labelLayout");if(!(b(a)||L(a).length)){return}e.group.traverse(function(e){if(e.ignore){return true}var t=e.getTextContent();var r=j(e);if(t&&!t.disableLabelLayout){i._addLabel(r.dataIndex,r.dataType,n,t,a)}})};e.prototype.updateLayoutConfig=function(e){var t=e.getWidth();var r=e.getHeight();function i(e,t){return function(){Vm(e,t)}}for(var n=0;n<this._labelList.length;n++){var a=this._labelList[n];var o=a.label;var s=o.__hostTarget;var l=a.defaultAttr;var u=void 0;if(typeof a.layoutOption==="function"){u=a.layoutOption(e0(a,s))}else{u=a.layoutOption}u=u||{};a.computedLayoutOption=u;var c=Math.PI/180;if(s){s.setTextConfig({local:false,position:u.x!=null||u.y!=null?null:l.attachedPos,rotation:u.rotate!=null?u.rotate*c:l.attachedRot,offset:[u.dx||0,u.dy||0]})}var f=false;if(u.x!=null){o.x=Y(u.x,t);o.setStyle("x",0);f=true}else{o.x=l.x;o.setStyle("x",l.style.x)}if(u.y!=null){o.y=Y(u.y,r);o.setStyle("y",0);f=true}else{o.y=l.y;o.setStyle("y",l.style.y)}if(u.labelLinePoints){var h=s.getTextGuideLine();if(h){h.setShape({points:u.labelLinePoints});f=false}}var p=i0(o);p.needsUpdateLabelLine=f;o.rotation=u.rotate!=null?u.rotate*c:l.rotation;o.scaleX=l.scaleX;o.scaleY=l.scaleY;for(var v=0;v<t0.length;v++){var d=t0[v];o.setStyle(d,u[d]!=null?u[d]:l.style[d])}if(u.draggable){o.draggable=true;o.cursor="move";if(s){var g=a.seriesModel;if(a.dataIndex!=null){var y=a.seriesModel.getData(a.dataType);g=y.getItemModel(a.dataIndex)}o.on("drag",i(s,g.getModel("labelLine")))}}else{o.off("drag");o.cursor=l.cursor}}};e.prototype.layout=function(e){var t=e.getWidth();var r=e.getHeight();var i=Xm(this._labelList);var n=ue(i,function(e){return e.layoutOption.moveOverlap==="shiftX"});var a=ue(i,function(e){return e.layoutOption.moveOverlap==="shiftY"});Jm(n,0,t);Km(a,0,r);var o=ue(i,function(e){return e.layoutOption.hideOverlap});Qm(o)};e.prototype.processLabelsOverall=function(){var o=this;U(this._chartViewList,function(e){var i=e.__model;var n=e.ignoreLabelLineUpdate;var a=i.isAnimationEnabled();e.group.traverse(function(e){if(e.ignore){return true}var t=!n;var r=e.getTextContent();if(!t&&r){t=i0(r).needsUpdateLabelLine}if(t){o._updateLabelLine(e,i)}if(a){o._animateLabels(e,i)}})})};e.prototype._updateLabelLine=function(e,t){var r=e.getTextContent();var i=j(e);var n=i.dataIndex;if(r&&n!=null){var a=t.getData(i.dataType);var o=a.getItemModel(n);var s={};var l=a.getItemVisual(n,"style");var u=a.getVisual("drawType");s.stroke=l[u];var c=o.getModel("labelLine");Zm(e,Ym(o),s);Vm(e,c)}};e.prototype._animateLabels=function(e,t){var r=e.getTextContent();var i=e.getTextGuideLine();if(r&&!r.ignore&&!r.invisible&&!e.disableLabelAnimation&&!$f(e)){var n=i0(r);var a=n.oldLayout;var o=j(e);var s=o.dataIndex;var l={x:r.x,y:r.y,rotation:r.rotation};var u=t.getData(o.dataType);if(!a){r.attr(l);if(!Ah(r).valueAnimation){var c=N(r.style.opacity,1);r.style.opacity=0;qf(r,{style:{opacity:c}},t,s)}}else{r.attr(a);var f=e.prevStates;if(f){if(D(f,"select")>=0){r.attr(n.oldLayoutSelect)}if(D(f,"emphasis")>=0){r.attr(n.oldLayoutEmphasis)}}X(r,l,t,s)}n.oldLayout=l;if(r.states.select){var h=n.oldLayoutSelect={};a0(h,l,o0);a0(h,r.states.select,o0)}if(r.states.emphasis){var p=n.oldLayoutEmphasis={};a0(p,l,o0);a0(p,r.states.emphasis,o0)}kh(r,s,u,t,t)}if(i&&!i.ignore&&!i.invisible){var n=n0(i);var a=n.oldLayout;var v={points:i.shape.points};if(!a){i.setShape(v);i.style.strokePercent=0;qf(i,{style:{strokePercent:1}},t)}else{i.attr({shape:a});X(i,{shape:v},t)}n.oldLayout=v}};return e}();function l0(i,e){function n(e,t){var r=[];e.eachComponent({mainType:"series",subType:i,query:t},function(e){r.push(e.seriesIndex)});return r}U([[i+"ToggleSelect","toggleSelect"],[i+"Select","select"],[i+"UnSelect","unselect"]],function(i){e(i[0],function(e,t,r){e=F({},e);if("development"!=="production"){_a(e.type,i[1])}r.dispatchAction(F(e,{type:i[1],seriesIndex:n(t,e)}))})})}function u0(e,t,o,r,s){var l=e+t;if(!o.isSilent(l)){if("development"!=="production"){xa("event "+l+" is deprecated.")}r.eachComponent({mainType:"series",subType:"pie"},function(e){var t=e.seriesIndex;var r=s.selected;for(var i=0;i<r.length;i++){if(r[i].seriesIndex===t){var n=e.getData();var a=Xa(n,s.fromActionPayload);o.trigger(l,{type:l,seriesId:e.id,name:k(a)?n.getName(a[0]):n.getName(a),selected:F({},e.option.selectedMap)})}}})}}function c0(e,r,i){e.on("selectchanged",function(e){var t=i.getModel();if(e.isFromClick){u0("map","selectchanged",r,t,e);u0("pie","selectchanged",r,t,e)}else if(e.fromAction==="select"){u0("map","selected",r,t,e);u0("pie","selected",r,t,e)}else if(e.fromAction==="unselect"){u0("map","unselected",r,t,e);u0("pie","unselected",r,t,e)}})}function f0(e,t,r){var i;while(e){if(t(e)){i=e;if(r){break}}e=e.__hostTarget||e.parent}return i}var h0=Math.round(Math.random()*9);var p0=function(){function e(){this._id="__ec_inner_"+h0++}e.prototype.get=function(e){return this._guard(e)[this._id]};e.prototype.set=function(e,t){var r=this._guard(e);if(typeof Object.defineProperty==="function"){Object.defineProperty(r,this._id,{value:t,enumerable:false,configurable:true})}else{r[this._id]=t}return this};e.prototype["delete"]=function(e){if(this.has(e)){delete this._guard(e)[this._id];return true}return false};e.prototype.has=function(e){return!!this._guard(e)[this._id]};e.prototype._guard=function(e){if(e!==Object(e)){throw TypeError("Value of WeakMap is not a non-null object.")}return e};return e}();var v0=m.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx;var i=t.cy;var n=t.width/2;var a=t.height/2;e.moveTo(r,i-a);e.lineTo(r+n,i+a);e.lineTo(r-n,i+a);e.closePath()}});var d0=m.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx;var i=t.cy;var n=t.width/2;var a=t.height/2;e.moveTo(r,i-a);e.lineTo(r+n,i);e.lineTo(r,i+a);e.lineTo(r-n,i);e.closePath()}});var g0=m.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x;var i=t.y;var n=t.width/5*3;var a=Math.max(n,t.height);var o=n/2;var s=o*o/(a-o);var l=i-a+o+s;var u=Math.asin(s/o);var c=Math.cos(u)*o;var f=Math.sin(u);var h=Math.cos(u);var p=o*.6;var v=o*.7;e.moveTo(r-c,l+s);e.arc(r,l,o,Math.PI-u,Math.PI*2+u);e.bezierCurveTo(r+c-f*p,l+s+h*p,r,i-v,r,i);e.bezierCurveTo(r,i-v,r-c+f*p,l+s+h*p,r-c,l+s);e.closePath()}});var y0=m.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.height;var i=t.width;var n=t.x;var a=t.y;var o=i/3*2;e.moveTo(n,a);e.lineTo(n+o,a+r);e.lineTo(n,a+r/4*3);e.lineTo(n-o,a+r);e.lineTo(n,a);e.closePath()}});var m0={line:vf,rect:G,roundRect:G,square:G,circle:Rc,diamond:d0,pin:g0,arrow:y0,triangle:v0};var x0={line:function(e,t,r,i,n){n.x1=e;n.y1=t+i/2;n.x2=e+r;n.y2=t+i/2},rect:function(e,t,r,i,n){n.x=e;n.y=t;n.width=r;n.height=i},roundRect:function(e,t,r,i,n){n.x=e;n.y=t;n.width=r;n.height=i;n.r=Math.min(r,i)/4},square:function(e,t,r,i,n){var a=Math.min(r,i);n.x=e;n.y=t;n.width=a;n.height=a},circle:function(e,t,r,i,n){n.cx=e+r/2;n.cy=t+i/2;n.r=Math.min(r,i)/2},diamond:function(e,t,r,i,n){n.cx=e+r/2;n.cy=t+i/2;n.width=r;n.height=i},pin:function(e,t,r,i,n){n.x=e+r/2;n.y=t+i/2;n.width=r;n.height=i},arrow:function(e,t,r,i,n){n.x=e+r/2;n.y=t+i/2;n.width=r;n.height=i},triangle:function(e,t,r,i,n){n.cx=e+r/2;n.cy=t+i/2;n.width=r;n.height=i}};var _0={};U(m0,function(e,t){_0[t]=new e});var b0=m.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(e,t,r){var i=mn(e,t,r);var n=this.shape;if(n&&n.symbolType==="pin"&&t.position==="inside"){i.y=r.y+r.height*.4}return i},buildPath:function(e,t,r){var i=t.symbolType;if(i!=="none"){var n=_0[i];if(!n){i="rect";n=_0[i]}x0[i](t.x,t.y,t.width,t.height,n.shape);n.buildPath(e,n.shape,r)}}});function w0(e,t){if(this.type!=="image"){var r=this.style;if(this.__isEmptyBrush){r.stroke=e;r.fill=t||"#fff";r.lineWidth=2}else if(this.shape.symbolType==="line"){r.stroke=e}else{r.fill=e}this.markRedraw()}}function S0(e,t,r,i,n,a,o){var s=e.indexOf("empty")===0;if(s){e=e.substr(5,1).toLowerCase()+e.substr(6)}var l;if(e.indexOf("image://")===0){l=Ff(e.slice(8),new B(t,r,i,n),o?"center":"cover")}else if(e.indexOf("path://")===0){l=Gf(e.slice(7),{},new B(t,r,i,n),o?"center":"cover")}else{l=new b0({shape:{symbolType:e,x:t,y:r,width:i,height:n}})}l.__isEmptyBrush=s;l.setColor=w0;if(a){l.setColor(a)}return l}function M0(e,t,r){var i=t.x==null?0:t.x;var n=t.x2==null?1:t.x2;var a=t.y==null?0:t.y;var o=t.y2==null?0:t.y2;if(!t.global){i=i*r.width+r.x;n=n*r.width+r.x;a=a*r.height+r.y;o=o*r.height+r.y}i=isNaN(i)?0:i;n=isNaN(n)?1:n;a=isNaN(a)?0:a;o=isNaN(o)?0:o;var s=e.createLinearGradient(i,a,n,o);return s}function I0(e,t,r){var i=r.width;var n=r.height;var a=Math.min(i,n);var o=t.x==null?.5:t.x;var s=t.y==null?.5:t.y;var l=t.r==null?.5:t.r;if(!t.global){o=o*i+r.x;s=s*n+r.y;l=l*a}var u=e.createRadialGradient(o,s,0,o,s,l);return u}function C0(e,t,r){var i=t.type==="radial"?I0(e,t,r):M0(e,t,r);var n=t.colorStops;for(var a=0;a<n.length;a++){i.addColorStop(n[a].offset,n[a].color)}return i}function T0(e,t){if(e===t||!e&&!t){return false}if(!e||!t||e.length!==t.length){return true}for(var r=0;r<e.length;r++){if(e[r]!==t[r]){return true}}return false}function D0(e,t){if(!e||e==="solid"||!(t>0)){return null}t=t||1;return e==="dashed"?[4*t,2*t]:e==="dotted"?[t]:pe(e)?[e]:k(e)?e:null}var A0=new ol(true);function L0(e){var t=e.stroke;return!(t==null||t==="none"||!(e.lineWidth>0))}function k0(e){var t=e.fill;return t!=null&&t!=="none"}function P0(e,t){if(t.fillOpacity!=null&&t.fillOpacity!==1){var r=e.globalAlpha;e.globalAlpha=t.fillOpacity*t.opacity;e.fill();e.globalAlpha=r}else{e.fill()}}function O0(e,t){if(t.strokeOpacity!=null&&t.strokeOpacity!==1){var r=e.globalAlpha;e.globalAlpha=t.strokeOpacity*t.opacity;e.stroke();e.globalAlpha=r}else{e.stroke()}}function N0(e,t,r){var i=Do(t.image,t.__image,r);if(Lo(i)){var n=e.createPattern(i,t.repeat||"repeat");if(typeof DOMMatrix==="function"&&n.setTransform){var a=new DOMMatrix;a.rotateSelf(0,0,(t.rotation||0)/Math.PI*180);a.scaleSelf(t.scaleX||1,t.scaleY||1);a.translateSelf(t.x||0,t.y||0);n.setTransform(a)}return n}}function E0(e,t,r,i){var n=L0(r);var a=k0(r);var o=r.strokePercent;var s=o<1;var l=!t.path;if((!t.silent||s)&&l){t.createPathProxy()}var u=t.path||A0;if(!i){var c=r.fill;var f=r.stroke;var h=a&&!!c.colorStops;var p=n&&!!f.colorStops;var v=a&&!!c.image;var d=n&&!!f.image;var g=void 0;var y=void 0;var m=void 0;var x=void 0;var _=void 0;if(h||p){_=t.getBoundingRect()}if(h){g=t.__dirty?C0(e,c,_):t.__canvasFillGradient;t.__canvasFillGradient=g}if(p){y=t.__dirty?C0(e,f,_):t.__canvasStrokeGradient;t.__canvasStrokeGradient=y}if(v){m=t.__dirty||!t.__canvasFillPattern?N0(e,c,t):t.__canvasFillPattern;t.__canvasFillPattern=m}if(d){x=t.__dirty||!t.__canvasStrokePattern?N0(e,f,t):t.__canvasStrokePattern;t.__canvasStrokePattern=m}if(h){e.fillStyle=g}else if(v){if(m){e.fillStyle=m}else{a=false}}if(p){e.strokeStyle=y}else if(d){if(x){e.strokeStyle=x}else{n=false}}}var b=r.lineDash&&r.lineWidth>0&&D0(r.lineDash,r.lineWidth);var w=r.lineDashOffset;var S=!!e.setLineDash;var M=t.getGlobalScale();u.setScale(M[0],M[1],t.segmentIgnoreThreshold);if(b){var I=r.strokeNoScale&&t.getLineScale?t.getLineScale():1;if(I&&I!==1){b=A(b,function(e){return e/I});w/=I}}var C=true;if(l||t.__dirty&rr||b&&!S&&n){u.setDPR(e.dpr);if(s){u.setContext(null)}else{u.setContext(e);C=false}u.reset();if(b&&!S){u.setLineDash(b);u.setLineDashOffset(w)}t.buildPath(u,t.shape,i);u.toStatic();t.pathUpdated()}if(C){u.rebuildPath(e,s?o:1)}if(b&&S){e.setLineDash(b);e.lineDashOffset=w}if(!i){if(r.strokeFirst){if(n){O0(e,r)}if(a){P0(e,r)}}else{if(a){P0(e,r)}if(n){O0(e,r)}}}if(b&&S){e.setLineDash([])}}function R0(e,t,r){var i=t.__image=Do(r.image,t.__image,t,t.onload);if(!i||!Lo(i)){return}var n=r.x||0;var a=r.y||0;var o=t.getWidth();var s=t.getHeight();var l=i.width/i.height;if(o==null&&s!=null){o=s*l}else if(s==null&&o!=null){s=o/l}else if(o==null&&s==null){o=i.width;s=i.height}if(r.sWidth&&r.sHeight){var u=r.sx||0;var c=r.sy||0;e.drawImage(i,u,c,r.sWidth,r.sHeight,n,a,o,s)}else if(r.sx&&r.sy){var u=r.sx;var c=r.sy;var f=o-u;var h=s-c;e.drawImage(i,u,c,f,h,n,a,o,s)}else{e.drawImage(i,n,a,o,s)}}function z0(e,t,r){var i=r.text;i!=null&&(i+="");if(i){e.font=r.font||on;e.textAlign=r.textAlign;e.textBaseline=r.textBaseline;var n=void 0;if(e.setLineDash){var a=r.lineDash&&r.lineWidth>0&&D0(r.lineDash,r.lineWidth);var o=r.lineDashOffset;if(a){var s=r.strokeNoScale&&t.getLineScale?t.getLineScale():1;if(s&&s!==1){a=A(a,function(e){return e/s});o/=s}e.setLineDash(a);e.lineDashOffset=o;n=true}}if(r.strokeFirst){if(L0(r)){e.strokeText(i,r.x,r.y)}if(k0(r)){e.fillText(i,r.x,r.y)}}else{if(k0(r)){e.fillText(i,r.x,r.y)}if(L0(r)){e.strokeText(i,r.x,r.y)}}if(n){e.setLineDash([])}}}var B0=["shadowBlur","shadowOffsetX","shadowOffsetY"];var V0=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function G0(e,t,r,i,n){var a=false;if(!i){r=r||{};if(t===r){return false}}if(i||t.opacity!==r.opacity){if(!a){K0(e,n);a=true}var o=Math.max(Math.min(t.opacity,1),0);e.globalAlpha=isNaN(o)?Yo.opacity:o}if(i||t.blend!==r.blend){if(!a){K0(e,n);a=true}e.globalCompositeOperation=t.blend||Yo.blend}for(var s=0;s<B0.length;s++){var l=B0[s];if(i||t[l]!==r[l]){if(!a){K0(e,n);a=true}e[l]=e.dpr*(t[l]||0)}}if(i||t.shadowColor!==r.shadowColor){if(!a){K0(e,n);a=true}e.shadowColor=t.shadowColor||Yo.shadowColor}return a}function F0(e,t,r,i,n){var a=Q0(t,n.inHover);var o=i?null:r&&Q0(r,n.inHover)||{};if(a===o){return false}var s=G0(e,a,o,i,n);if(i||a.fill!==o.fill){if(!s){K0(e,n);s=true}e.fillStyle=a.fill}if(i||a.stroke!==o.stroke){if(!s){K0(e,n);s=true}e.strokeStyle=a.stroke}if(i||a.opacity!==o.opacity){if(!s){K0(e,n);s=true}e.globalAlpha=a.opacity==null?1:a.opacity}if(t.hasStroke()){var l=a.lineWidth;var u=l/(a.strokeNoScale&&t&&t.getLineScale?t.getLineScale():1);if(e.lineWidth!==u){if(!s){K0(e,n);s=true}e.lineWidth=u}}for(var c=0;c<V0.length;c++){var f=V0[c];var h=f[0];if(i||a[h]!==o[h]){if(!s){K0(e,n);s=true}e[h]=a[h]||f[1]}}return s}function H0(e,t,r,i,n){return G0(e,Q0(t,n.inHover),r&&Q0(r,n.inHover),i,n)}function W0(e,t){var r=t.transform;var i=e.dpr||1;if(r){e.setTransform(i*r[0],i*r[1],i*r[2],i*r[3],i*r[4],i*r[5])}else{e.setTransform(i,0,0,i,0,0)}}function j0(e,t,r){var i=false;for(var n=0;n<e.length;n++){var a=e[n];i=i||a.isZeroArea();W0(t,a);t.beginPath();a.buildPath(t,a.shape);t.clip()}r.allClipped=i}function U0(e,t){if(e&&t){return e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]}else if(!e&&!t){return false}return true}var Z0=1;var Y0=2;var X0=3;var q0=4;function J0(e){var t=k0(e);var r=L0(e);return!(e.lineDash||!(+t^+r)||t&&typeof e.fill!=="string"||r&&typeof e.stroke!=="string"||e.strokePercent<1||e.strokeOpacity<1||e.fillOpacity<1)}function K0(e,t){t.batchFill&&e.fill();t.batchStroke&&e.stroke();t.batchFill="";t.batchStroke=""}function Q0(e,t){return t?e.__hoverStyle||e.style:e.style}function $0(e,t){ex(e,t,{inHover:false,viewWidth:0,viewHeight:0},true)}function ex(e,t,r,i){var n=t.transform;if(!t.shouldBePainted(r.viewWidth,r.viewHeight,false,false)){t.__dirty&=~er;t.__isRendered=false;return}var a=t.__clipPaths;var o=r.prevElClipPaths;var s=false;var l=false;if(!o||T0(a,o)){if(o&&o.length){K0(e,r);e.restore();l=s=true;r.prevElClipPaths=null;r.allClipped=false;r.prevEl=null}if(a&&a.length){K0(e,r);e.save();j0(a,e,r);s=true}r.prevElClipPaths=a}if(r.allClipped){t.__isRendered=false;return}t.beforeBrush&&t.beforeBrush();t.innerBeforeBrush();var u=r.prevEl;if(!u){l=s=true}var c=t instanceof m&&t.autoBatch&&J0(t.style);if(s||U0(n,u.transform)){K0(e,r);W0(e,t)}else if(!c){K0(e,r)}var f=Q0(t,r.inHover);if(t instanceof m){if(r.lastDrawType!==Z0){l=true;r.lastDrawType=Z0}F0(e,t,u,l,r);if(!c||!r.batchFill&&!r.batchStroke){e.beginPath()}E0(e,t,f,c);if(c){r.batchFill=f.fill||"";r.batchStroke=f.stroke||""}}else{if(t instanceof Pl){if(r.lastDrawType!==X0){l=true;r.lastDrawType=X0}F0(e,t,u,l,r);z0(e,t,f)}else if(t instanceof Rl){if(r.lastDrawType!==Y0){l=true;r.lastDrawType=Y0}H0(e,t,u,l,r);R0(e,t,f)}else if(t instanceof kf){if(r.lastDrawType!==q0){l=true;r.lastDrawType=q0}tx(e,t,r)}}if(c&&i){K0(e,r)}t.innerAfterBrush();t.afterBrush&&t.afterBrush();r.prevEl=t;t.__dirty=0;t.__isRendered=true}function tx(e,t,r){var i=t.getDisplayables();var n=t.getTemporalDisplayables();e.save();var a={prevElClipPaths:null,prevEl:null,allClipped:false,viewWidth:r.viewWidth,viewHeight:r.viewHeight,inHover:r.inHover};var o;var s;for(o=t.getCursor(),s=i.length;o<s;o++){var l=i[o];l.beforeBrush&&l.beforeBrush();l.innerBeforeBrush();ex(e,l,a,o===s-1);l.innerAfterBrush();l.afterBrush&&l.afterBrush();a.prevEl=l}for(var u=0,c=n.length;u<c;u++){var l=n[u];l.beforeBrush&&l.beforeBrush();l.innerBeforeBrush();ex(e,l,a,u===c-1);l.innerAfterBrush();l.afterBrush&&l.afterBrush();a.prevEl=l}t.clearTemporalDisplayables();t.notClear=true;e.restore()}var rx=new p0;var ix=new pr(100);var nx=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function ax(e,t){if(e==="none"){return null}var C=t.getDevicePixelRatio();var T=t.getZr();var D=T.painter.type==="svg";if(e.dirty){rx["delete"](e)}var r=rx.get(e);if(r){return r}var A=R(e,{symbol:"rect",symbolSize:1,symbolKeepAspect:true,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});if(A.backgroundColor==="none"){A.backgroundColor=null}var i={repeat:"repeat"};n(i);i.rotation=A.rotation;i.scaleX=i.scaleY=D?1:1/C;rx.set(e,i);e.dirty=false;return i;function n(e){var t=[C];var r=true;for(var i=0;i<nx.length;++i){var n=A[nx[i]];var a=typeof n;if(n!=null&&!k(n)&&a!=="string"&&a!=="number"&&a!=="boolean"){r=false;break}t.push(n)}var o;if(r){o=t.join(",")+(D?"-svg":"");var s=ix.get(o);if(s){D?e.svgElement=s:e.image=s}}var m=sx(A.dashArrayX);var x=lx(A.dashArrayY);var _=ox(A.symbol);var l=ux(m);var b=cx(x);var w=!D&&ne();var S=D&&T.painter.createSVGElement("g");var M=u();var I;if(w){w.width=M.width*C;w.height=M.height*C;I=w.getContext("2d")}c();if(r){ix.put(o,w||S)}e.image=w;e.svgElement=S;e.svgWidth=M.width;e.svgHeight=M.height;function u(){var e=1;for(var t=0,r=l.length;t<r;++t){e=pa(e,l[t])}var i=1;for(var t=0,r=_.length;t<r;++t){i=pa(i,_[t].length)}e*=i;var n=b*l.length*_.length;if("development"!=="production"){var a=function(e){console.warn("Calculated decal size is greater than "+e+" due to decal option settings so "+e+" is used for the decal size. Please consider changing the decal option to make a smaller decal or set "+e+" to be larger to avoid incontinuity.")};if(e>A.maxTileWidth){a("maxTileWidth")}if(n>A.maxTileHeight){a("maxTileHeight")}}return{width:Math.max(1,Math.min(e,A.maxTileWidth)),height:Math.max(1,Math.min(n,A.maxTileHeight))}}function c(){if(I){I.clearRect(0,0,w.width,w.height);if(A.backgroundColor){I.fillStyle=A.backgroundColor;I.fillRect(0,0,w.width,w.height)}}var e=0;for(var t=0;t<x.length;++t){e+=x[t]}if(e<=0){return}var r=-b;var i=0;var n=0;var a=0;while(r<M.height){if(i%2===0){var o=n/2%_.length;var s=0;var l=0;var u=0;while(s<M.width*2){var c=0;for(var t=0;t<m[a].length;++t){c+=m[a][t]}if(c<=0){break}if(l%2===0){var f=(1-A.symbolSize)*.5;var h=s+m[a][l]*f;var p=r+x[i]*f;var v=m[a][l]*A.symbolSize;var d=x[i]*A.symbolSize;var g=u/2%_[o].length;y(h,p,v,d,_[o][g])}s+=m[a][l];++u;++l;if(l===m[a].length){l=0}}++a;if(a===m.length){a=0}}r+=x[i];++n;++i;if(i===x.length){i=0}}function y(e,t,r,i,n){var a=D?1:C;var o=S0(n,e*a,t*a,r*a,i*a,A.color,A.symbolKeepAspect);if(D){S.appendChild(T.painter.paintOne(o))}else{$0(I,o)}}}}}function ox(e){if(!e||e.length===0){return[["rect"]]}if(typeof e==="string"){return[[e]]}var t=true;for(var r=0;r<e.length;++r){if(typeof e[r]!=="string"){t=false;break}}if(t){return ox([e])}var i=[];for(var r=0;r<e.length;++r){if(typeof e[r]==="string"){i.push([e[r]])}else{i.push(e[r])}}return i}function sx(e){if(!e||e.length===0){return[[0,0]]}if(typeof e==="number"){var t=Math.ceil(e);return[[t,t]]}var r=true;for(var i=0;i<e.length;++i){if(typeof e[i]!=="number"){r=false;break}}if(r){return sx([e])}var n=[];for(var i=0;i<e.length;++i){if(typeof e[i]==="number"){var t=Math.ceil(e[i]);n.push([t,t])}else{var t=A(e[i],function(e){return Math.ceil(e)});if(t.length%2===1){n.push(t.concat(t))}else{n.push(t)}}}return n}function lx(e){if(!e||typeof e==="object"&&e.length===0){return[0,0]}if(typeof e==="number"){var t=Math.ceil(e);return[t,t]}var r=A(e,function(e){return Math.ceil(e)});return e.length%2?r.concat(r):r}function ux(e){return A(e,function(e){return cx(e)})}function cx(e){var t=0;for(var r=0;r<e.length;++r){t+=e[r]}if(e.length%2===1){return t*2}return t}function fx(n,a){n.eachRawSeries(function(e){if(n.isSeriesFiltered(e)){return}var i=e.getData();if(i.hasItemVisual()){i.each(function(e){var t=i.getItemVisual(e,"decal");if(t){var r=i.ensureUniqueItemVisual(e,"style");r.decal=ax(t,a)}})}var t=i.getVisual("decal");if(t){var r=i.getVisual("style");r.decal=ax(t,a)}})}function hx(e){if(P(e)){var t=new DOMParser;e=t.parseFromString(e,"text/xml")}var r=e;if(r.nodeType===9){r=r.firstChild}while(r.nodeName.toLowerCase()!=="svg"||r.nodeType!==1){r=r.nextSibling}return r}var px;var vx={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"};var dx=L(vx);var gx={"alignment-baseline":"textBaseline","stop-color":"stopColor"};var yx=L(gx);var mx=function(){function e(){this._defs={};this._root=null}e.prototype.parse=function(e,t){t=t||{};var r=hx(e);if(!r){throw new Error("Illegal svg")}this._defsUsePending=[];var i=new H;this._root=i;var n=[];var a=r.getAttribute("viewBox")||"";var o=parseFloat(r.getAttribute("width")||t.width);var s=parseFloat(r.getAttribute("height")||t.height);isNaN(o)&&(o=null);isNaN(s)&&(s=null);Ix(r,i,null,true,false);var l=r.firstChild;while(l){this._parseNode(l,i,n,null,false,false);l=l.nextSibling}Ax(this._defs,this._defsUsePending);this._defsUsePending=[];var u;var c;if(a){var f=kx(a);if(f.length>=4){u={x:parseFloat(f[0]||0),y:parseFloat(f[1]||0),width:parseFloat(f[2]),height:parseFloat(f[3])}}}if(u&&o!=null&&s!=null){c=Bx(u,{x:0,y:0,width:o,height:s});if(!t.ignoreViewBox){var h=i;i=new H;i.add(h);h.scaleX=h.scaleY=c.scale;h.x=c.x;h.y=c.y}}if(!t.ignoreRootClip&&o!=null&&s!=null){i.setClipPath(new G({shape:{x:0,y:0,width:o,height:s}}))}return{root:i,width:o,height:s,viewBoxRect:u,viewBoxTransform:c,named:n}};e.prototype._parseNode=function(e,t,r,i,n,a){var o=e.nodeName.toLowerCase();var s;var l=i;if(o==="defs"){n=true}if(o==="text"){a=true}if(o==="defs"||o==="switch"){s=t}else{if(!n){var u=px[o];if(u&&z(px,o)){s=u.call(this,e,t);var c=e.getAttribute("name");if(c){var f={name:c,namedFrom:null,svgNodeTagLower:o,el:s};r.push(f);if(o==="g"){l=f}}else if(i){r.push({name:i.name,namedFrom:i,svgNodeTagLower:o,el:s})}t.add(s)}}var h=xx[o];if(h&&z(xx,o)){var p=h.call(this,e);var v=e.getAttribute("id");if(v){this._defs[v]=p}}}if(s&&s.isGroup){var d=e.firstChild;while(d){if(d.nodeType===1){this._parseNode(d,s,r,l,n,a)}else if(d.nodeType===3&&a){this._parseText(d,s)}d=d.nextSibling}}};e.prototype._parseText=function(e,t){var r=new Pl({style:{text:e.textContent},silent:true,x:this._textX||0,y:this._textY||0});Sx(t,r);Ix(e,r,this._defsUsePending,false,false);Cx(r,t);var i=r.style;var n=i.fontSize;if(n&&n<9){i.fontSize=9;r.scaleX*=n/9;r.scaleY*=n/9}var a=(i.fontSize||i.fontFamily)&&[i.fontStyle,i.fontWeight,(i.fontSize||12)+"px",i.fontFamily||"sans-serif"].join(" ");i.font=a;var o=r.getBoundingRect();this._textX+=o.width;t.add(r);return r};e.internalField=function(){px={g:function(e,t){var r=new H;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);return r},rect:function(e,t){var r=new G;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);r.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")});r.silent=true;return r},circle:function(e,t){var r=new Rc;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")});r.silent=true;return r},line:function(e,t){var r=new vf;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);r.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")});r.silent=true;return r},ellipse:function(e,t){var r=new Bc;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")});r.silent=true;return r},polygon:function(e,t){var r=e.getAttribute("points");var i;if(r){i=Mx(r)}var n=new uf({shape:{points:i||[]},silent:true});Sx(t,n);Ix(e,n,this._defsUsePending,false,false);return n},polyline:function(e,t){var r=e.getAttribute("points");var i;if(r){i=Mx(r)}var n=new ff({shape:{points:i||[]},silent:true});Sx(t,n);Ix(e,n,this._defsUsePending,false,false);return n},image:function(e,t){var r=new Rl;Sx(t,r);Ix(e,r,this._defsUsePending,false,false);r.setStyle({image:e.getAttribute("xlink:href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")});r.silent=true;return r},text:function(e,t){var r=e.getAttribute("x")||"0";var i=e.getAttribute("y")||"0";var n=e.getAttribute("dx")||"0";var a=e.getAttribute("dy")||"0";this._textX=parseFloat(r)+parseFloat(n);this._textY=parseFloat(i)+parseFloat(a);var o=new H;Sx(t,o);Ix(e,o,this._defsUsePending,false,true);return o},tspan:function(e,t){var r=e.getAttribute("x");var i=e.getAttribute("y");if(r!=null){this._textX=parseFloat(r)}if(i!=null){this._textY=parseFloat(i)}var n=e.getAttribute("dx")||"0";var a=e.getAttribute("dy")||"0";var o=new H;Sx(t,o);Ix(e,o,this._defsUsePending,false,true);this._textX+=parseFloat(n);this._textY+=parseFloat(a);return o},path:function(e,t){var r=e.getAttribute("d")||"";var i=Pc(r);Sx(t,i);Ix(e,i,this._defsUsePending,false,false);i.silent=true;return i}}}();return e}();var xx={lineargradient:function(e){var t=parseInt(e.getAttribute("x1")||"0",10);var r=parseInt(e.getAttribute("y1")||"0",10);var i=parseInt(e.getAttribute("x2")||"10",10);var n=parseInt(e.getAttribute("y2")||"0",10);var a=new Sf(t,r,i,n);_x(e,a);bx(e,a);return a},radialgradient:function(e){var t=parseInt(e.getAttribute("cx")||"0",10);var r=parseInt(e.getAttribute("cy")||"0",10);var i=parseInt(e.getAttribute("r")||"0",10);var n=new Mf(t,r,i);_x(e,n);bx(e,n);return n}};function _x(e,t){var r=e.getAttribute("gradientUnits");if(r==="userSpaceOnUse"){t.global=true}}function bx(e,t){var r=e.firstChild;while(r){if(r.nodeType===1&&r.nodeName.toLocaleLowerCase()==="stop"){var i=r.getAttribute("offset");var n=void 0;if(i&&i.indexOf("%")>0){n=parseInt(i,10)/100}else if(i){n=parseFloat(i)}else{n=0}var a={};Rx(r,a,a);var o=a.stopColor||r.getAttribute("stop-color")||"#000000";t.colorStops.push({offset:n,color:o})}r=r.nextSibling}}function Sx(e,t){if(e&&e.__inheritedStyle){if(!t.__inheritedStyle){t.__inheritedStyle={}}R(t.__inheritedStyle,e.__inheritedStyle)}}function Mx(e){var t=kx(e);var r=[];for(var i=0;i<t.length;i+=2){var n=parseFloat(t[i]);var a=parseFloat(t[i+1]);r.push([n,a])}return r}function Ix(e,t,r,i,n){var a=t;var o=a.__inheritedStyle=a.__inheritedStyle||{};var s={};if(e.nodeType===1){Nx(e,t);Rx(e,o,s);if(!i){zx(e,o,s)}}a.style=a.style||{};if(o.fill!=null){a.style.fill=Dx(a,"fill",o.fill,r)}if(o.stroke!=null){a.style.stroke=Dx(a,"stroke",o.stroke,r)}U(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(e){if(o[e]!=null){a.style[e]=parseFloat(o[e])}});U(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(e){if(o[e]!=null){a.style[e]=o[e]}});if(n){a.__selfStyle=s}if(o.lineDash){a.style.lineDash=A(kx(o.lineDash),function(e){return parseFloat(e)})}if(o.visibility==="hidden"||o.visibility==="collapse"){a.invisible=true}if(o.display==="none"){a.ignore=true}}function Cx(e,t){var r=t.__selfStyle;if(r){var i=r.textBaseline;var n=i;if(!i||i==="auto"){n="alphabetic"}else if(i==="baseline"){n="alphabetic"}else if(i==="before-edge"||i==="text-before-edge"){n="top"}else if(i==="after-edge"||i==="text-after-edge"){n="bottom"}else if(i==="central"||i==="mathematical"){n="middle"}e.style.textBaseline=n}var a=t.__inheritedStyle;if(a){var o=a.textAlign;var s=o;if(o){if(o==="middle"){s="center"}e.style.textAlign=s}}}var Tx=/^url\(\s*#(.*?)\)/;function Dx(e,t,r,i){var n=r&&r.match(Tx);if(n){var a=Ie(n[1]);i.push([e,t,a]);return}if(r==="none"){r=null}return r}function Ax(e,t){for(var r=0;r<t.length;r++){var i=t[r];i[0].style[i[1]]=e[i[2]]}}var Lx=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function kx(e){return e.match(Lx)||[]}var Px=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g;var Ox=Math.PI/180;function Nx(e,t){var r=e.getAttribute("transform");if(r){r=r.replace(/,/g," ");var i=[];var n=null;r.replace(Px,function(e,t,r){i.push(t,r);return""});for(var a=i.length-1;a>0;a-=2){var o=i[a];var s=i[a-1];var l=kx(o);n=n||Pi();switch(s){case"translate":Ri(n,n,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":Bi(n,n,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":zi(n,n,-parseFloat(l[0])*Ox);break;case"skewX":var u=Math.tan(parseFloat(l[0])*Ox);Ei(n,[1,0,u,1,0,0],n);break;case"skewY":var c=Math.tan(parseFloat(l[0])*Ox);Ei(n,[1,c,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(l[0]);n[1]=parseFloat(l[1]);n[2]=parseFloat(l[2]);n[3]=parseFloat(l[3]);n[4]=parseFloat(l[4]);n[5]=parseFloat(l[5]);break}}t.setLocalTransform(n)}}var Ex=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Rx(e,t,r){var i=e.getAttribute("style");if(!i){return}Ex.lastIndex=0;var n;while((n=Ex.exec(i))!=null){var a=n[1];var o=z(vx,a)?vx[a]:null;if(o){t[o]=n[2]}var s=z(gx,a)?gx[a]:null;if(s){r[s]=n[2]}}}function zx(e,t,r){for(var i=0;i<dx.length;i++){var n=dx[i];var a=e.getAttribute(n);if(a!=null){t[vx[n]]=a}}for(var i=0;i<yx.length;i++){var n=yx[i];var a=e.getAttribute(n);if(a!=null){r[gx[n]]=a}}}function Bx(e,t){var r=t.width/e.width;var i=t.height/e.height;var n=Math.min(r,i);return{scale:n,x:-(e.x+e.width/2)*n+(t.x+t.width/2),y:-(e.y+e.height/2)*n+(t.y+t.height/2)}}function Vx(e,t){var r=new mx;return r.parse(e,t)}var Gx=1e-8;function Fx(e,t){return Math.abs(e-t)<Gx}function Hx(e,t,r){var i=0;var n=e[0];if(!n){return false}for(var a=1;a<e.length;a++){var o=e[a];i+=vl(n[0],n[1],o[0],o[1],t,r);n=o}var s=e[0];if(!Fx(n[0],s[0])||!Fx(n[1],s[1])){i+=vl(n[0],n[1],s[0],s[1],t,r)}return i!==0}var Wx=[];var jx=function(){function e(e){this.name=e}e.prototype.getCenter=function(){return};return e}();var Ux=function(a){d(r,a);function r(e,t,r){var i=a.call(this,e)||this;i.type="geoJSON";i.geometries=t;if(!r){var n=i.getBoundingRect();r=[n.x+n.width/2,n.y+n.height/2]}else{r=[r[0],r[1]]}i._center=r;return i}r.prototype.getBoundingRect=function(){var e=this._rect;if(e){return e}var t=Number.MAX_VALUE;var r=[t,t];var i=[-t,-t];var n=[];var a=[];var o=this.geometries;var s=0;for(;s<o.length;s++){if(o[s].type!=="polygon"){continue}var l=o[s].exterior;Ns(l,n,a);it(r,r,n);nt(i,i,a)}if(s===0){r[0]=r[1]=i[0]=i[1]=0}return this._rect=new B(r[0],r[1],i[0]-r[0],i[1]-r[1])};r.prototype.contain=function(e){var t=this.getBoundingRect();var r=this.geometries;if(!t.contain(e[0],e[1])){return false}e:for(var i=0,n=r.length;i<n;i++){if(r[i].type!=="polygon"){continue}var a=r[i].exterior;var o=r[i].interiors;if(Hx(a,e[0],e[1])){for(var s=0;s<(o?o.length:0);s++){if(Hx(o[s],e[0],e[1])){continue e}}return true}}return false};r.prototype.transformTo=function(e,t,r,i){var n=this.getBoundingRect();var a=n.width/n.height;if(!r){r=a*i}else if(!i){i=r/a}var o=new B(e,t,r,i);var s=n.calculateTransform(o);var l=this.geometries;for(var u=0;u<l.length;u++){if(l[u].type!=="polygon"){continue}var c=l[u].exterior;var f=l[u].interiors;for(var h=0;h<c.length;h++){rt(c[h],c[h],s)}for(var p=0;p<(f?f.length:0);p++){for(var h=0;h<f[p].length;h++){rt(f[p][h],f[p][h],s)}}}n=this._rect;n.copy(o);this._center=[n.x+n.width/2,n.y+n.height/2]};r.prototype.cloneShallow=function(e){e==null&&(e=this.name);var t=new r(e,this.geometries,this._center);t._rect=this._rect;t.transformTo=null;return t};r.prototype.getCenter=function(){return this._center};r.prototype.setCenter=function(e){this._center=e};return r}(jx);var Zx=function(i){d(e,i);function e(e,t){var r=i.call(this,e)||this;r.type="geoSVG";r._elOnlyForCalculate=t;return r}e.prototype.getCenter=function(){var e=this._center;if(!e){e=this._center=this._calculateCenter()}return e};e.prototype._calculateCenter=function(){var e=this._elOnlyForCalculate;var t=e.getBoundingRect();var r=[t.x+t.width/2,t.y+t.height/2];var i=Oi(Wx);var n=e;while(n&&!n.isGeoSVGGraphicRoot){Ei(i,n.getLocalTransform(),i);n=n.parent}Vi(i,i);rt(r,r,i);return r};return e}(jx);var Yx=I(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]);var Xx=function(){function e(e,t){this.type="geoSVG";this._usedGraphicMap=I();this._freedGraphics=[];this._mapName=e;this._parsedXML=hx(t)}e.prototype.load=function(){var e=this._firstGraphic;if(!e){e=this._firstGraphic=this._buildGraphic(this._parsedXML);this._freedGraphics.push(e);this._boundingRect=this._firstGraphic.boundingRect.clone();var t=Jx(e.named),r=t.regions,i=t.regionsMap;this._regions=r;this._regionsMap=i}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}};e.prototype._buildGraphic=function(e){var t;var r;try{t=e&&Vx(e,{ignoreViewBox:true,ignoreRootClip:true})||{};r=t.root;E(r!=null)}catch(e){throw new Error("Invalid svg format\n"+e.message)}var i=new H;i.add(r);i.isGeoSVGGraphicRoot=true;var n=t.width;var a=t.height;var o=t.viewBoxRect;var s=this._boundingRect;if(!s){var l=void 0;var u=void 0;var c=void 0;var f=void 0;if(n!=null){l=0;c=n}else if(o){l=o.x;c=o.width}if(a!=null){u=0;f=a}else if(o){u=o.y;f=o.height}if(l==null||u==null){var h=r.getBoundingRect();if(l==null){l=h.x;c=h.width}if(u==null){u=h.y;f=h.height}}s=this._boundingRect=new B(l,u,c,f)}if(o){var p=Bx(o,s);r.scaleX=r.scaleY=p.scale;r.x=p.x;r.y=p.y}i.setClipPath(new G({shape:s.plain()}));var v=[];U(t.named,function(e){if(Yx.get(e.svgNodeTagLower)!=null){v.push(e);qx(e.el)}});return{root:i,boundingRect:s,named:v}};e.prototype.useGraphic=function(e){var t=this._usedGraphicMap;var r=t.get(e);if(r){return r}r=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML);t.set(e,r);return r};e.prototype.freeGraphic=function(e){var t=this._usedGraphicMap;var r=t.get(e);if(r){t.removeKey(e);this._freedGraphics.push(r)}};return e}();function qx(e){e.silent=false;if(e.isGroup){e.traverse(function(e){e.silent=false})}}function Jx(e){var r=[];var i=I();U(e,function(e){if(e.namedFrom!=null){return}var t=new Zx(e.name,e.el);r.push(t);i.set(e.name,t)});return{regions:r,regionsMap:i}}function Kx(e){if(!e.UTF8Encoding){return e}var t=e;var r=t.UTF8Scale;if(r==null){r=1024}var i=t.features;for(var n=0;n<i.length;n++){var a=i[n];var o=a.geometry;if(o.type==="Polygon"){var s=o.coordinates;for(var l=0;l<s.length;l++){s[l]=Qx(s[l],o.encodeOffsets[l],r)}}else if(o.type==="MultiPolygon"){var s=o.coordinates;for(var l=0;l<s.length;l++){var u=s[l];for(var c=0;c<u.length;c++){u[c]=Qx(u[c],o.encodeOffsets[l][c],r)}}}}t.UTF8Encoding=false;return t}function Qx(e,t,r){var i=[];var n=t[0];var a=t[1];for(var o=0;o<e.length;o+=2){var s=e.charCodeAt(o)-64;var l=e.charCodeAt(o+1)-64;s=s>>1^-(s&1);l=l>>1^-(l&1);s+=n;l+=a;n=s;a=l;i.push([s/r,l/r])}return i}function $x(e,o){e=Kx(e);return A(ue(e.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var t=e.properties;var r=e.geometry;var i=[];if(r.type==="Polygon"){var n=r.coordinates;i.push({type:"polygon",exterior:n[0],interiors:n.slice(1)})}if(r.type==="MultiPolygon"){var n=r.coordinates;U(n,function(e){if(e[0]){i.push({type:"polygon",exterior:e[0],interiors:e.slice(1)})}})}var a=new Ux(t[o||"name"],i,t.cp);a.properties=t;return a})}var e_=[126,25];var t_="";var r_=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]];for(var i_=0;i_<r_.length;i_++){for(var n_=0;n_<r_[i_].length;n_++){r_[i_][n_][0]/=10.5;r_[i_][n_][1]/=-10.5/.75;r_[i_][n_][0]+=e_[0];r_[i_][n_][1]+=e_[1]}}function a_(e,t){if(e==="china"){for(var r=0;r<t.length;r++){if(t[r].name===t_){return}}t.push(new Ux(t_,A(r_,function(e){return{type:"polygon",exterior:e}}),e_))}}var o_={"":[32,80],"":[0,-10],"":[10,5],"":[-10,10],"":[5,5]};function s_(e,t){if(e==="china"){var r=o_[t.name];if(r){var i=t.getCenter();i[0]+=r[0]/10.5;i[1]+=-r[1]/(10.5/.75);t.setCenter(i)}}}var l_={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};function u_(e,t){if(e==="world"){var r=l_[t.name];if(r){var i=[r[0],r[1]];t.setCenter(i)}}}var c_=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];function f_(e,t){if(e==="china"&&t.name===""){t.geometries.push({type:"polygon",exterior:c_[0]})}}var h_="name";var p_=function(){function e(e,t,r){this.type="geoJSON";this._parsedMap=I();this._mapName=e;this._specialAreas=r;this._geoJSON=d_(t)}e.prototype.load=function(r,e){e=e||h_;var t=this._parsedMap.get(e);if(!t){var i=this._parseToRegions(e);t=this._parsedMap.set(e,{regions:i,boundingRect:v_(i)})}var n=I();var a=[];U(t.regions,function(e){var t=e.name;if(r&&r.hasOwnProperty(t)){e=e.cloneShallow(t=r[t])}a.push(e);n.set(t,e)});return{regions:a,boundingRect:t.boundingRect||new B(0,0,0,0),regionsMap:n}};e.prototype._parseToRegions=function(e){var i=this._mapName;var t=this._geoJSON;var r;try{r=t?$x(t,e):[]}catch(e){throw new Error("Invalid geoJson format\n"+e.message)}a_(i,r);U(r,function(e){var t=e.name;s_(i,e);u_(i,e);f_(i,e);var r=this._specialAreas&&this._specialAreas[t];if(r){e.transformTo(r.left,r.top,r.width,r.height)}},this);return r};e.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}};return e}();function v_(e){var t;for(var r=0;r<e.length;r++){var i=e[r].getBoundingRect();t=t||i.clone();t.union(i)}return t}function d_(e){return!P(e)?e:typeof JSON!=="undefined"&&JSON.parse?JSON.parse(e):new Function("return ("+e+");")()}var g_=I();var y_={registerMap:function(e,t,r){if(t.svg){var i=new Xx(e,t.svg);g_.set(e,i)}else{var n=t.geoJson||t.geoJSON;if(n&&!t.features){r=t.specialAreas}else{n=t}var i=new p_(e,n,r);g_.set(e,i)}},getGeoResource:function(e){return g_.get(e)},getMapForUser:function(e){var t=g_.get(e);return t&&t.type==="geoJSON"&&t.getMapForUser()},load:function(e,t,r){var i=g_.get(e);if(!i){if("development"!=="production"){console.error("Map "+e+" not exists. The GeoJSON of the map must be provided.")}return}return i.load(t,r)}};var m_=E;var x_=U;var __=b;var b_=O;var w_=D;var S_=typeof window!=="undefined";var M_="5.1.2";var I_={zrender:"5.1.1"};var C_=1;var T_=800;var D_=900;var A_=1e3;var L_=2e3;var k_=5e3;var P_=1e3;var O_=1100;var N_=2e3;var E_=3e3;var R_=4e3;var z_=4500;var B_=4600;var V_=5e3;var G_=6e3;var F_=7e3;var H_={PROCESSOR:{FILTER:A_,SERIES_FILTER:T_,STATISTIC:k_},VISUAL:{LAYOUT:P_,PROGRESSIVE_LAYOUT:O_,GLOBAL:N_,CHART:E_,POST_CHART_LAYOUT:B_,COMPONENT:R_,BRUSH:V_,CHART_ITEM:z_,ARIA:G_,DECAL:F_}};var W_="__flagInMainProcess";var j_="__optionUpdated";var U_="__needsUpdateStatus";var Z_=/^[a-zA-Z0-9_]+$/;var Y_="__connectUpdateStatus";var X_=0;var q_=1;var J_=2;function K_(r){return function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(this.isDisposed()){C1(this.id);return}return $_(this,r,e)}}function Q_(r){return function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return $_(this,r,e)}}function $_(e,t,r){r[0]=r[0]&&r[0].toLowerCase();return lt.prototype[t].apply(e,r)}var e1=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(lt);var t1=e1.prototype;t1.on=Q_("on");t1.off=Q_("off");var r1;var i1;var n1;var a1;var o1;var s1;var l1;var u1;var c1;var f1;var h1;var p1;var v1;var d1;var g1;var y1;var m1;var x1;var _1;var b1;var w1;var S1=function(f){d(e,f);function e(e,t,r){var i=f.call(this,new mm)||this;i._chartsViews=[];i._chartsMap={};i._componentsViews=[];i._componentsMap={};i._pendingActions=[];r=r||{};if(typeof t==="string"){t=N1[t]}i._dom=e;var n="canvas";var a=false;if("development"!=="production"){var o=S_?window:global;n=o.__ECHARTS__DEFAULT__RENDERER__||n;var s=o.__ECHARTS__DEFAULT__USE_DIRTY_RECT__;a=s==null?a:s}var l=i._zr=Rn(e,{renderer:r.renderer||n,devicePixelRatio:r.devicePixelRatio,width:r.width,height:r.height,useDirtyRect:r.useDirtyRect==null?a:r.useDirtyRect});i._throttledZrFlush=Ry(x(l.flush,l),17);t=M(t);t&&Fd(t,true);i._theme=t;i._locale=tp(r.locale||$h);i._coordSysMgr=new fd;var u=i._api=m1(i);function c(e,t){return e.__prio-t.__prio}$t(O1,c);$t(A1,c);i._scheduler=new Jy(i,u,A1,O1);i._messageCenter=new e1;i._labelManager=new s0;i._initEvents();i.resize=x(i.resize,i);l.animation.on("frame",i._onframe,i);f1(l,i);h1(l,i);Te(i);return i}e.prototype._onframe=function(){if(this._disposed){return}w1(this);var e=this._scheduler;if(this[j_]){var t=this[j_].silent;this[W_]=true;r1(this);a1.update.call(this);this._zr.flush();this[W_]=false;this[j_]=false;u1.call(this,t);c1.call(this,t)}else if(e.unfinished){var r=C_;var i=this._model;var n=this._api;e.unfinished=false;do{var a=+new Date;e.performSeriesTasks(i);e.performDataProcessorTasks(i);s1(this,i);e.performVisualTasks(i);g1(this,this._model,n,"remain");r-=+new Date-a}while(r>0&&e.unfinished);if(!e.unfinished){this._zr.flush()}}};e.prototype.getDom=function(){return this._dom};e.prototype.getId=function(){return this.id};e.prototype.getZr=function(){return this._zr};e.prototype.setOption=function(e,t,r){if("development"!=="production"){m_(!this[W_],"`setOption` should not be called during main process.")}if(this._disposed){C1(this.id);return}var i;var n;var a;if(b_(t)){r=t.lazyUpdate;i=t.silent;n=t.replaceMerge;a=t.transition;t=t.notMerge}this[W_]=true;if(!this._model||t){var o=new pd(this._api);var s=this._theme;var l=this._model=new rd;l.scheduler=this._scheduler;l.init(null,null,null,s,this._locale,o)}this._model.setOption(e,{replaceMerge:n},L1);_1(this,a);if(r){this[j_]={silent:i};this[W_]=false;this.getZr().wakeUp()}else{r1(this);a1.update.call(this);this._zr.flush();this[j_]=false;this[W_]=false;u1.call(this,i);c1.call(this,i)}};e.prototype.setTheme=function(){console.error("ECharts#setTheme() is DEPRECATED in ECharts 3.0")};e.prototype.getModel=function(){return this._model};e.prototype.getOption=function(){return this._model&&this._model.getOption()};e.prototype.getWidth=function(){return this._zr.getWidth()};e.prototype.getHeight=function(){return this._zr.getHeight()};e.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||S_&&window.devicePixelRatio||1};e.prototype.getRenderedCanvas=function(e){if(!S.canvasSupported){return}e=e||{};return this._zr.painter.getRenderedCanvas({backgroundColor:e.backgroundColor||this._model.get("backgroundColor"),pixelRatio:e.pixelRatio||this.getDevicePixelRatio()})};e.prototype.getSvgDataURL=function(){if(!S.svgSupported){return}var e=this._zr;var t=e.storage.getDisplayList();U(t,function(e){e.stopAnimation(null,true)});return e.painter.toDataURL()};e.prototype.getDataURL=function(e){if(this._disposed){C1(this.id);return}e=e||{};var t=e.excludeComponents;var r=this._model;var i=[];var n=this;x_(t,function(e){r.eachComponent({mainType:e},function(e){var t=n._componentsMap[e.__viewId];if(!t.group.ignore){i.push(t);t.group.ignore=true}})});var a=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.getRenderedCanvas(e).toDataURL("image/"+(e&&e.type||"png"));x_(i,function(e){e.group.ignore=false});return a};e.prototype.getConnectedDataURL=function(n){if(this._disposed){C1(this.id);return}if(!S.canvasSupported){return}var a=n.type==="svg";var o=this.group;var s=Math.min;var l=Math.max;var e=Infinity;if(z1[o]){var u=e;var c=e;var f=-e;var h=-e;var p=[];var r=n&&n.pixelRatio||this.getDevicePixelRatio();U(R1,function(e,t){if(e.group===o){var r=a?e.getZr().painter.getSvgDom().innerHTML:e.getRenderedCanvas(M(n));var i=e.getDom().getBoundingClientRect();u=s(i.left,u);c=s(i.top,c);f=l(i.right,f);h=l(i.bottom,h);p.push({dom:r,left:i.left,top:i.top})}});u*=r;c*=r;f*=r;h*=r;var t=f-u;var i=h-c;var v=ne();var d=Rn(v,{renderer:a?"svg":"canvas"});d.resize({width:t,height:i});if(a){var g="";x_(p,function(e){var t=e.left-u;var r=e.top-c;g+='<g transform="translate('+t+","+r+')">'+e.dom+"</g>"});d.painter.getSvgRoot().innerHTML=g;if(n.connectedBackgroundColor){d.painter.setBackgroundColor(n.connectedBackgroundColor)}d.refreshImmediately();return d.painter.toDataURL()}else{if(n.connectedBackgroundColor){d.add(new G({shape:{x:0,y:0,width:t,height:i},style:{fill:n.connectedBackgroundColor}}))}x_(p,function(e){var t=new Rl({style:{x:e.left*r-u,y:e.top*r-c,image:e.dom}});d.add(t)});d.refreshImmediately();return v.toDataURL("image/"+(n&&n.type||"png"))}}else{return this.getDataURL(n)}};e.prototype.convertToPixel=function(e,t){return o1(this,"convertToPixel",e,t)};e.prototype.convertFromPixel=function(e,t){return o1(this,"convertFromPixel",e,t)};e.prototype.containPixel=function(e,n){if(this._disposed){C1(this.id);return}var t=this._model;var a;var r=Ka(t,e);U(r,function(e,i){i.indexOf("Models")>=0&&U(e,function(e){var t=e.coordinateSystem;if(t&&t.containPoint){a=a||!!t.containPoint(n)}else if(i==="seriesModels"){var r=this._chartsMap[e.__viewId];if(r&&r.containPoint){a=a||r.containPoint(n,e)}else{if("development"!=="production"){console.warn(i+": "+(r?"The found component do not support containPoint.":"No view mapping to the found component."))}}}else{if("development"!=="production"){console.warn(i+": containPoint is not supported")}}},this)},this);return!!a};e.prototype.getVisual=function(e,t){var r=this._model;var i=Ka(r,e,{defaultMainType:"series"});var n=i.seriesModel;if("development"!=="production"){if(!n){console.warn("There is no specified seires model")}}var a=n.getData();var o=i.hasOwnProperty("dataIndexInside")?i.dataIndexInside:i.hasOwnProperty("dataIndex")?a.indexOfRawIndex(i.dataIndex):null;return o!=null?bm(a,o,t):wm(a,t)};e.prototype.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]};e.prototype.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]};e.prototype._initEvents=function(){var c=this;x_(I1,function(u){var e=function(e){var i=c.getModel();var t=e.target;var n;var r=u==="globalout";if(r){n={}}else{t&&f0(t,function(e){var t=j(e);if(t&&t.dataIndex!=null){var r=t.dataModel||i.getSeriesByIndex(t.seriesIndex);n=r&&r.getDataParams(t.dataIndex,t.dataType)||{};return true}else if(t.eventData){n=F({},t.eventData);return true}},true)}if(n){var a=n.componentType;var o=n.componentIndex;if(a==="markLine"||a==="markPoint"||a==="markArea"){a="series";o=n.seriesIndex}var s=a&&o!=null&&i.getComponent(a,o);var l=s&&c[s.mainType==="series"?"_chartsMap":"_componentsMap"][s.__viewId];if("development"!=="production"){if(!r&&!(s&&l)){console.warn("model or view can not be found by params")}}n.event=e;n.type=u;c._$eventProcessor.eventInfo={targetEl:t,packedEvent:n,model:s,view:l};c.trigger(u,n)}};e.zrEventfulCallAtLast=true;c._zr.on(u,e,c)});x_(D1,function(e,t){c._messageCenter.on(t,function(e){this.trigger(t,e)},c)});x_(["selectchanged"],function(t){c._messageCenter.on(t,function(e){this.trigger(t,e)},c)});c0(this._messageCenter,this,this._api)};e.prototype.isDisposed=function(){return this._disposed};e.prototype.clear=function(){if(this._disposed){C1(this.id);return}this.setOption({series:[]},true)};e.prototype.dispose=function(){if(this._disposed){C1(this.id);return}this._disposed=true;ro(this.getDom(),G1,"");var t=this._api;var r=this._model;x_(this._componentsViews,function(e){e.dispose(r,t)});x_(this._chartsViews,function(e){e.dispose(r,t)});this._zr.dispose();delete R1[this.id]};e.prototype.resize=function(e){if("development"!=="production"){m_(!this[W_],"`resize` should not be called during main process.")}if(this._disposed){C1(this.id);return}this._zr.resize(e);var t=this._model;this._loadingFX&&this._loadingFX.resize();if(!t){return}var r=t.resetOption("media");var i=e&&e.silent;if(this[j_]){if(i==null){i=this[j_].silent}r=true;this[j_]=false}this[W_]=true;r&&r1(this);a1.update.call(this,{type:"resize",animation:F({duration:0},e&&e.animation)});this[W_]=false;u1.call(this,i);c1.call(this,i)};e.prototype.showLoading=function(e,t){if(this._disposed){C1(this.id);return}if(b_(e)){t=e;e=""}e=e||"default";this.hideLoading();if(!E1[e]){if("development"!=="production"){console.warn("Loading effects "+e+" not exists.")}return}var r=E1[e](this._api,t);var i=this._zr;this._loadingFX=r;i.add(r)};e.prototype.hideLoading=function(){if(this._disposed){C1(this.id);return}this._loadingFX&&this._zr.remove(this._loadingFX);this._loadingFX=null};e.prototype.makeActionFromEvent=function(e){var t=F({},e);t.type=D1[e.type];return t};e.prototype.dispatchAction=function(e,t){if(this._disposed){C1(this.id);return}if(!b_(t)){t={silent:!!t}}if(!T1[e.type]){return}if(!this._model){return}if(this[W_]){this._pendingActions.push(e);return}var r=t.silent;l1.call(this,e,r);var i=t.flush;if(i){this._zr.flush()}else if(i!==false&&S.browser.weChat){this._throttledZrFlush()}u1.call(this,r);c1.call(this,r)};e.prototype.updateLabelLayout=function(){var e=this._labelManager;e.updateLayoutConfig(this._api);e.layout(this._api);e.processLabelsOverall()};e.prototype.appendData=function(e){if(this._disposed){C1(this.id);return}var t=e.seriesIndex;var r=this.getModel();var i=r.getSeriesByIndex(t);if("development"!=="production"){m_(e.data&&i)}i.appendData(e);this._scheduler.unfinished=true;this.getZr().wakeUp()};e.internalField=function(){r1=function(e){var t=e._scheduler;t.restorePipelines(e._model);t.prepareStageTasks();i1(e,true);i1(e,false);t.plan()};i1=function(e,o){var s=e._model;var l=e._scheduler;var u=o?e._componentsViews:e._chartsViews;var c=o?e._componentsMap:e._chartsMap;var f=e._zr;var h=e._api;for(var t=0;t<u.length;t++){u[t].__alive=false}o?s.eachComponent(function(e,t){e!=="series"&&r(t)}):s.eachSeries(r);function r(e){var t=e.__requireNewView;e.__requireNewView=false;var r="_ec_"+e.id+"_"+e.type;var i=!t&&c[r];if(!i){var n=co(e.type);var a=o?My.getClass(n.main,n.sub):v.getClass(n.sub);if("development"!=="production"){m_(a,n.sub+" does not exist.")}i=new a;i.init(s,h);c[r]=i;u.push(i);f.add(i.group)}e.__viewId=i.__id=r;i.__alive=true;i.__model=e;i.group.__ecComponentInfo={mainType:e.mainType,index:e.componentIndex};!o&&l.prepareView(i,e,s,h)}for(var t=0;t<u.length;){var i=u[t];if(!i.__alive){!o&&i.renderTask.dispose();f.remove(i.group);i.dispose(s,h);u.splice(t,1);if(c[i.__id]===i){delete c[i.__id]}i.__id=i.group.__ecComponentInfo=null}else{t++}}};n1=function(n,t,a,o,e){var r=n._model;r.setUpdatePayload(a);if(!o){x_([].concat(n._componentsViews).concat(n._chartsViews),c);return}var i={};i[o+"Id"]=a[o+"Id"];i[o+"Index"]=a[o+"Index"];i[o+"Name"]=a[o+"Name"];var s={mainType:o,query:i};e&&(s.subType=e);var l=a.excludeSeriesId;var u;if(l!=null){u=I();x_(Ia(l),function(e){var t=Va(e,null);if(t!=null){u.set(t,true)}})}if(fc(a)){Uu(n._api)}r&&r.eachComponent(s,function(e){if(!u||u.get(e.id)==null){if(fc(a)){if(e instanceof dy){if(a.type===hu&&!a.notBlur){Xu(e,a,n._api)}}else{var t=qu(e.mainType,e.componentIndex,a.name,n._api),r=t.focusSelf,i=t.dispatchers;if(a.type===hu&&r&&!a.notBlur){Yu(e.mainType,e.componentIndex,n._api)}if(i){x_(i,function(e){a.type===hu?Bu(e):Vu(e)})}}}else if(cc(a)){if(e instanceof dy){Qu(e,a,n._api);$u(e);b1(n)}}c(n[o==="series"?"_chartsMap":"_componentsMap"][e.__viewId])}},n);function c(e){e&&e.__alive&&e[t]&&e[t](e.__model,r,n._api,a)}};a1={prepareAndUpdate:function(e){r1(this);a1.update.call(this,e)},update:function(e){var t=this._model;var r=this._api;var i=this._zr;var n=this._coordSysMgr;var a=this._scheduler;if(!t){return}t.setUpdatePayload(e);a.restoreData(t,e);a.performSeriesTasks(t);n.create(t,r);a.performDataProcessorTasks(t,e);s1(this,t);n.update(t,r);p1(t);a.performVisualTasks(t,e);v1(this,t,r,e);var o=t.get("backgroundColor")||"transparent";var s=t.get("darkMode");if(!S.canvasSupported){var l=Tr(o);o=Br(l,"rgb");if(l[3]===0){o="transparent"}}else{i.setBackgroundColor(o);if(s!=null&&s!=="auto"){i.setDarkMode(s)}}y1(t,r)},updateTransform:function(n){var a=this;var o=this._model;var s=this._api;if(!o){return}o.setUpdatePayload(n);var l=[];o.eachComponent(function(e,t){if(e==="series"){return}var r=a.getViewOfComponentModel(t);if(r&&r.__alive){if(r.updateTransform){var i=r.updateTransform(t,o,s,n);i&&i.update&&l.push(r)}else{l.push(r)}}});var i=I();o.eachSeries(function(e){var t=a._chartsMap[e.__viewId];if(t.updateTransform){var r=t.updateTransform(e,o,s,n);r&&r.update&&i.set(e.uid,1)}else{i.set(e.uid,1)}});p1(o);this._scheduler.performVisualTasks(o,n,{setDirty:true,dirtyMap:i});g1(this,o,s,n,i);y1(o,this._api)},updateView:function(e){var t=this._model;if(!t){return}t.setUpdatePayload(e);v.markUpdateMethod(e,"updateView");p1(t);this._scheduler.performVisualTasks(t,e,{setDirty:true});v1(this,this._model,this._api,e);y1(t,this._api)},updateVisual:function(i){var n=this;var a=this._model;if(!a){return}a.setUpdatePayload(i);a.eachSeries(function(e){e.getData().clearAllVisual()});v.markUpdateMethod(i,"updateVisual");p1(a);this._scheduler.performVisualTasks(a,i,{visualType:"visual",setDirty:true});a.eachComponent(function(e,t){if(e!=="series"){var r=n.getViewOfComponentModel(t);r&&r.__alive&&r.updateVisual(t,a,n._api,i)}});a.eachSeries(function(e){var t=n._chartsMap[e.__viewId];t.updateVisual(e,a,n._api,i)});y1(a,this._api)},updateLayout:function(e){a1.update.call(this,e)}};o1=function(e,t,r,i){if(e._disposed){C1(e.id);return}var n=e._model;var a=e._coordSysMgr.getCoordinateSystems();var o;var s=Ka(n,r);for(var l=0;l<a.length;l++){var u=a[l];if(u[t]&&(o=u[t](n,s,i))!=null){return o}}if("development"!=="production"){console.warn("No coordinate system that supports "+t+" found by the given finder.")}};s1=function(e,t){var r=e._chartsMap;var i=e._scheduler;t.eachSeries(function(e){i.updateStreamModes(e,r[e.__viewId])})};l1=function(a,e){var o=this;var t=this.getModel();var r=a.type;var i=a.escapeConnect;var s=T1[r];var l=s.actionInfo;var n=(l.update||"update").split(":");var u=n.pop();var c=n[0]!=null&&co(n[0]);this[W_]=true;var f=[a];var h=false;if(a.batch){h=true;f=A(a.batch,function(e){e=R(F({},e),a);e.batch=null;return e})}var p=[];var v;var d=cc(a);var g=fc(a);x_(f,function(e){v=s.action(e,o._model,o._api);v=v||F({},e);v.type=l.event||v.type;p.push(v);if(g){var t=Qa(a),r=t.queryOptionMap,i=t.mainTypeSpecified;var n=i?r.keys()[0]:"series";n1(o,u,e,n);b1(o)}else if(d){n1(o,u,e,"series");b1(o)}else if(c){n1(o,u,e,c.main,c.sub)}});if(u!=="none"&&!g&&!d&&!c){if(this[j_]){r1(this);a1.update.call(this,a);this[j_]=false}else{a1[u].call(this,a)}}if(h){v={type:l.event||r,escapeConnect:i,batch:p}}else{v=p[0]}this[W_]=false;if(!e){var y=this._messageCenter;y.trigger(v.type,v);if(d){var m={type:"selectchanged",escapeConnect:i,selected:ec(t),isFromClick:a.isFromClick||false,fromAction:a.type,fromActionPayload:a};y.trigger(m.type,m)}}};u1=function(e){var t=this._pendingActions;while(t.length){var r=t.shift();l1.call(this,r,e)}};c1=function(e){!e&&this.trigger("updated")};f1=function(t,r){t.on("rendered",function(e){r.trigger("rendered",e);if(t.animation.isFinished()&&!r[j_]&&!r._scheduler.unfinished&&!r._pendingActions.length){r.trigger("finished")}})};h1=function(e,a){e.on("mouseover",function(e){var t=e.target;var r=f0(t,sc);if(r){Ju(r,e,a._api);b1(a)}}).on("mouseout",function(e){var t=e.target;var r=f0(t,sc);if(r){Ku(r,e,a._api);b1(a)}}).on("click",function(e){var t=e.target;var r=f0(t,function(e){return j(e).dataIndex!=null},true);if(r){var i=r.selected?"unselect":"select";var n=j(r);a._api.dispatchAction({type:i,dataType:n.dataType,dataIndexInside:n.dataIndex,seriesIndex:n.seriesIndex,isFromClick:true})}})};p1=function(e){e.clearColorPalette();e.eachSeries(function(e){e.clearColorPalette()})};v1=function(e,t,r,i){d1(e,t,r,i);x_(e._chartsViews,function(e){e.__alive=false});g1(e,t,r,i);x_(e._chartsViews,function(e){if(!e.__alive){e.remove(t,r)}})};d1=function(e,r,i,n,t){x_(t||e._componentsViews,function(e){var t=e.__model;h(t,e);e.render(t,r,i,n);c(t,e);p(t,e)})};g1=function(i,e,t,n,a){var o=i._scheduler;var s=i._labelManager;s.clearLabels();var l=false;e.eachSeries(function(e){var t=i._chartsMap[e.__viewId];t.__alive=true;var r=t.renderTask;o.updatePayload(r,n);h(e,t);if(a&&a.get(e.uid)){r.dirty()}if(r.perform(o.getPerformArgs(r))){l=true}e.__transientTransitionOpt=null;t.group.silent=!!e.get("silent");u(e,t);$u(e);s.addLabelsOfSeries(t)});o.unfinished=l||o.unfinished;s.updateLayoutConfig(t);s.layout(t);s.processLabelsOverall();e.eachSeries(function(e){var t=i._chartsMap[e.__viewId];c(e,t);p(e,t)});r(i,e)};y1=function(t,r){x_(P1,function(e){e(t,r)})};b1=function(e){e[U_]=true;e.getZr().wakeUp()};w1=function(e){if(!e[U_]){return}e.getZr().storage.traverse(function(e){if($f(e)){return}o(e)});e[U_]=false};function o(e){var t=[];var r=e.currentStates;for(var i=0;i<r.length;i++){var n=r[i];if(!(n==="emphasis"||n==="blur"||n==="select")){t.push(n)}}if(e.selected&&e.states.select){t.push("select")}if(e.hoverState===su&&e.states.emphasis){t.push("emphasis")}else if(e.hoverState===ou&&e.states.blur){t.push("blur")}e.useStates(t)}function r(r,e){var t=r._zr;var i=t.storage;var n=0;i.traverse(function(e){if(!e.isGroup){n++}});if(n>e.get("hoverLayerThreshold")&&!S.node&&!S.worker){e.eachSeries(function(e){if(e.preventUsingHoverLayer){return}var t=r._chartsMap[e.__viewId];if(t.__alive){t.group.traverse(function(e){if(e.states.emphasis){e.states.emphasis.hoverLayer=true}})}})}}function u(e,t){var r=e.get("blendMode")||null;if("development"!=="production"){if(!S.canvasSupported&&r&&r!=="source-over"){console.warn("Only canvas support blendMode")}}t.group.traverse(function(e){if(!e.isGroup){e.style.blend=r}if(e.eachPendingDisplayable){e.eachPendingDisplayable(function(e){e.style.blend=r})}})}function c(e,t){if(e.preventAutoZ){return}f(t.group,e.get("z")||0,e.get("zlevel")||0,-Infinity)}function f(e,t,r,i){var n=e.getTextContent();var a=e.getTextGuideLine();var o=e.isGroup;if(o){var s=e.childrenRef();for(var l=0;l<s.length;l++){i=Math.max(f(s[l],t,r,i),i)}}else{e.z=t;e.zlevel=r;i=Math.max(e.z2,i)}if(n){n.z=t;n.zlevel=r;isFinite(i)&&(n.z2=i+2)}if(a){var u=e.textGuideLineConfig;a.z=t;a.zlevel=r;isFinite(i)&&(a.z2=i+(u&&u.showAbove?1:-1))}return i}function h(e,t){t.group.traverse(function(e){if($f(e)){return}var t=e.getTextContent();var r=e.getTextGuideLine();if(e.stateTransition){e.stateTransition=null}if(t&&t.stateTransition){t.stateTransition=null}if(r&&r.stateTransition){r.stateTransition=null}if(e.hasState()){e.prevStates=e.currentStates;e.clearStates()}else if(e.prevStates){e.prevStates=null}})}function p(e,t){var r=e.getModel("stateAnimation");var n=e.isAnimationEnabled();var i=r.get("duration");var a=i>0?{duration:i,delay:r.get("delay"),easing:r.get("easing")}:null;t.group.traverse(function(e){if(e.states&&e.states.emphasis){if($f(e)){return}if(e instanceof m){hc(e)}if(e.__dirty){var t=e.prevStates;if(t){e.useStates(t)}}if(n){e.stateTransition=a;var r=e.getTextContent();var i=e.getTextGuideLine();if(r){r.stateTransition=a}if(i){i.stateTransition=a}}if(e.__dirty){o(e)}}})}m1=function(r){return new(function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getCoordinateSystems=function(){return r._coordSysMgr.getCoordinateSystems()};t.prototype.getComponentByElement=function(e){while(e){var t=e.__ecComponentInfo;if(t!=null){return r._model.getComponent(t.mainType,t.index)}e=e.parent}};t.prototype.enterEmphasis=function(e,t){Bu(e,t);b1(r)};t.prototype.leaveEmphasis=function(e,t){Vu(e,t);b1(r)};t.prototype.enterBlur=function(e){Gu(e);b1(r)};t.prototype.leaveBlur=function(e){Fu(e);b1(r)};t.prototype.enterSelect=function(e){Hu(e);b1(r)};t.prototype.leaveSelect=function(e){Wu(e);b1(r)};t.prototype.getModel=function(){return r.getModel()};t.prototype.getViewOfComponentModel=function(e){return r.getViewOfComponentModel(e)};t.prototype.getViewOfSeriesModel=function(e){return r.getViewOfSeriesModel(e)};return t}(ud))(r)};x1=function(i){function n(e,t){for(var r=0;r<e.length;r++){var i=e[r];i[Y_]=t}}x_(D1,function(e,t){i._messageCenter.on(t,function(e){if(z1[i.group]&&i[Y_]!==X_){if(e&&e.escapeConnect){return}var t=i.makeActionFromEvent(e);var r=[];x_(R1,function(e){if(e!==i&&e.group===i.group){r.push(e)}});n(r,X_);x_(r,function(e){if(e[Y_]!==q_){e.dispatchAction(t)}});n(r,J_)}})})};_1=function(e,t){var l=e._model;U(Ia(t),function(e){var t;var r=e.from;var i=e.to;if(i==null){if("development"!=="production"){t="`transition.to` must be specified."}g(t)}var n={includeMainTypes:["series"],enableAll:false,enableNone:false};var a=r?Ka(l,r,n):null;var o=Ka(l,i,n);var s=o.seriesModel;if(s==null){t="";if("development"!=="production"){t="`transition` is only supported on series."}}if(a&&a.seriesModel!==s){t="";if("development"!=="production"){t="`transition.from` and `transition.to` must be specified to the same series."}}if(t!=null){g(t)}s.__transientTransitionOpt={from:r?r.dimension:null,to:i.dimension,dividingMethod:e.dividingMethod}})}}();return e}(lt);var M1=S1.prototype;M1.on=K_("on");M1.off=K_("off");M1.one=function(r,i,e){var n=this;xa("ECharts#one is deprecated.");function a(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}i&&i.apply&&i.apply(this,e);n.off(r,a)}this.on.call(this,r,a,e)};var I1=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];function C1(e){if("development"!=="production"){console.warn("Instance "+e+" has been disposed")}}var T1={};var D1={};var A1=[];var L1=[];var k1=[];var P1=[];var O1=[];var N1={};var E1={};var R1={};var z1={};var B1=+new Date-0;var V1=+new Date-0;var G1="_echarts_instance_";function F1(e,t,r){if("development"!=="production"){if(!e){throw new Error("Initialize failed: invalid dom.")}}var i=Z1(e);if(i){if("development"!=="production"){console.warn("There is a chart instance already initialized on the dom.")}return i}if("development"!=="production"){if(ge(e)&&e.nodeName.toUpperCase()!=="CANVAS"&&(!e.clientWidth&&(!r||r.width==null)||!e.clientHeight&&(!r||r.height==null))){console.warn("Can't get DOM width or height. Please check "+"dom.clientWidth and dom.clientHeight. They should not be 0."+"For example, you may need to call this in the callback "+"of window.onload.")}}var n=new S1(e,t,r);n.id="ec_"+B1++;R1[n.id]=n;ro(e,G1,n.id);x1(n);x_(k1,function(e){e(n)});return n}function H1(t){if(k(t)){var e=t;t=null;x_(e,function(e){if(e.group!=null){t=e.group}});t=t||"g_"+V1++;x_(e,function(e){e.group=t})}z1[t]=true;return t}function W1(e){z1[e]=false}var j1=W1;function U1(e){if(typeof e==="string"){e=R1[e]}else if(!(e instanceof S1)){e=Z1(e)}if(e instanceof S1&&!e.isDisposed()){e.dispose()}}function Z1(e){return R1[io(e,G1)]}function Y1(e){return R1[e]}function X1(e,t){N1[e]=t}function q1(e){if(w_(L1,e)<0){L1.push(e)}}function J1(e,t){ab(A1,e,t,L_)}function K1(e){if(w_(k1,e)<0){e&&k1.push(e)}}function Q1(e){if(w_(P1,e)<0){e&&P1.push(e)}}function $1(e,t,r){if(typeof t==="function"){r=t;t=""}var i=b_(e)?e.type:[e,e={event:t}][0];e.event=(e.event||i).toLowerCase();t=e.event;if(D1[t]){return}m_(Z_.test(i)&&Z_.test(t));if(!T1[i]){T1[i]={action:r,actionInfo:e}}D1[t]=i}function eb(e,t){fd.register(e,t)}function tb(e){var t=fd.get(e);if(t){return t.getDimensionsInfo?t.getDimensionsInfo():t.dimensions.slice()}}function rb(e,t){ab(O1,e,t,P_,"layout")}function ib(e,t){ab(O1,e,t,E_,"visual")}var nb=[];function ab(e,t,r,i,n){if(__(t)||b_(t)){r=t;t=i}if("development"!=="production"){if(isNaN(t)||t==null){throw new Error("Illegal priority")}x_(e,function(e){m_(e.__raw!==r)})}if(w_(nb,r)>=0){return}nb.push(r);var a=Jy.wrapStageHandler(r,n);a.__prio=t;a.__raw=r;e.push(a)}function ob(e,t){E1[e]=t}function sb(e){$("createCanvas",e)}function lb(e,t,r){y_.registerMap(e,t,r)}function ub(e){return y_.getMapForUser(e)}var cb=Vg;ib(N_,jy);ib(z_,Zy);ib(z_,Yy);ib(N_,xm);ib(z_,_m);ib(F_,fx);q1(Fd);J1(D_,Hd);ob("default",qy);$1({type:hu,event:hu,update:hu},Pe);$1({type:pu,event:pu,update:pu},Pe);$1({type:vu,event:vu,update:vu},Pe);$1({type:du,event:du,update:du},Pe);$1({type:gu,event:gu,update:gu},Pe);X1("light",hm);X1("dark",ym);var fb={};var hb=[];var pb={registerPreprocessor:q1,registerProcessor:J1,registerPostInit:K1,registerPostUpdate:Q1,registerAction:$1,registerCoordinateSystem:eb,registerLayout:rb,registerVisual:ib,registerTransform:cb,registerLoading:ob,registerMap:lb,PRIORITY:H_,ComponentModel:p,ComponentView:My,SeriesModel:dy,ChartView:v,registerComponentModel:function(e){p.registerClass(e)},registerComponentView:function(e){My.registerClass(e)},registerSeriesModel:function(e){dy.registerClass(e)},registerChartView:function(e){v.registerClass(e)},registerSubTypeDefaulter:function(e,t){p.registerSubTypeDefaulter(e,t)},registerPainter:function(e,t){Gn(e,t)}};function t(e){if(k(e)){U(e,function(e){t(e)});return}if(D(hb,e)>=0){return}hb.push(e);if(b(e)){e={install:e}}e.install(pb)}function vb(e){return e==null?0:e.length||1}function db(e){return e}var gb=function(){function e(e,t,r,i,n,a){this._old=e;this._new=t;this._oldKeyGetter=r||db;this._newKeyGetter=i||db;this.context=n;this._diffModeMultiple=a==="multiple"}e.prototype.add=function(e){this._add=e;return this};e.prototype.update=function(e){this._update=e;return this};e.prototype.updateManyToOne=function(e){this._updateManyToOne=e;return this};e.prototype.updateOneToMany=function(e){this._updateOneToMany=e;return this};e.prototype.remove=function(e){this._remove=e;return this};e.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()};e.prototype._executeOneToOne=function(){var e=this._old;var t=this._new;var r={};var i=new Array(e.length);var n=new Array(t.length);this._initIndexMap(e,null,i,"_oldKeyGetter");this._initIndexMap(t,r,n,"_newKeyGetter");for(var a=0;a<e.length;a++){var o=i[a];var s=r[o];var l=vb(s);if(l>1){var u=s.shift();if(s.length===1){r[o]=s[0]}this._update&&this._update(u,a)}else if(l===1){r[o]=null;this._update&&this._update(s,a)}else{this._remove&&this._remove(a)}}this._performRestAdd(n,r)};e.prototype._executeMultiple=function(){var e=this._old;var t=this._new;var r={};var i={};var n=[];var a=[];this._initIndexMap(e,r,n,"_oldKeyGetter");this._initIndexMap(t,i,a,"_newKeyGetter");for(var o=0;o<n.length;o++){var s=n[o];var l=r[s];var u=i[s];var c=vb(l);var f=vb(u);if(c>1&&f===1){this._updateManyToOne&&this._updateManyToOne(u,l);i[s]=null}else if(c===1&&f>1){this._updateOneToMany&&this._updateOneToMany(u,l);i[s]=null}else if(c===1&&f===1){this._update&&this._update(u,l);i[s]=null}else if(c>1){for(var h=0;h<c;h++){this._remove&&this._remove(l[h])}}else{this._remove&&this._remove(l)}}this._performRestAdd(a,i)};e.prototype._performRestAdd=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];var n=t[i];var a=vb(n);if(a>1){for(var o=0;o<a;o++){this._add&&this._add(n[o])}}else if(a===1){this._add&&this._add(n)}t[i]=null}};e.prototype._initIndexMap=function(e,t,r,i){var n=this._diffModeMultiple;for(var a=0;a<e.length;a++){var o="_ec_"+this[i](e[a],a);if(!n){r[a]=o}if(!t){continue}var s=t[o];var l=vb(s);if(l===0){t[o]=a;if(n){r.push(o)}}else if(l===1){t[o]=[s,a]}else{s.push(a)}}};return e}();function yb(i){var e={};var a=e.encode={};var o=I();var s=[];var l=[];var u=e.userOutput={dimensionNames:i.dimensions.slice(),encode:{}};U(i.dimensions,function(e){var n=i.getDimensionInfo(e);var t=n.coordDim;if(t){if("development"!=="production"){E(xv.get(t)==null)}var r=n.coordDimIndex;mb(a,t)[r]=e;if(!n.isExtraCoord){o.set(t,1);if(_b(n.type)){s[0]=e}mb(u.encode,t)[r]=n.index}if(n.defaultTooltip){l.push(e)}}xv.each(function(e,t){var r=mb(a,t);var i=n.otherDims[t];if(i!=null&&i!==false){r[i]=n.name}})});var n=[];var c={};o.each(function(e,t){var r=a[t];c[t]=r[0];n=n.concat(r)});e.dataDimsOnCoord=n;e.encodeFirstDimNotExtra=c;var t=a.label;if(t&&t.length){s=t.slice()}var r=a.tooltip;if(r&&r.length){l=r.slice()}else if(!l.length){l=s.slice()}a.defaultedLabel=s;a.defaultedTooltip=l;return e}function mb(e,t){if(!e.hasOwnProperty(t)){e[t]=[]}return e[t]}function xb(e){return e==="category"?"ordinal":e==="time"?"time":"float"}function _b(e){return!(e==="ordinal"||e==="time")}var bb=function(){function e(e){this.otherDims={};if(e!=null){F(this,e)}}return e}();var wb=Math.floor;var Sb=O;var Mb=A;var Ib="undefined";var Cb=-1;var Tb="e\0\0";var Db={float:typeof Float64Array===Ib?Array:Float64Array,int:typeof Int32Array===Ib?Array:Int32Array,ordinal:Array,number:Array,time:Array};var Ab=typeof Uint32Array===Ib?Array:Uint32Array;var Lb=typeof Int32Array===Ib?Array:Int32Array;var kb=typeof Uint16Array===Ib?Array:Uint16Array;var Pb=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx","_nameRepeatCount"];var Ob=["_extent","_approximateExtent","_rawExtent"];var Nb;var Eb;var Rb;var zb;var Bb;var Vb;var Gb;var Fb;var Hb;var Wb;var jb;var Ub;var Zb;var Yb;var Xb;var qb=function(){function c(e,t){this.type="list";this._count=0;this._rawCount=0;this._storage={};this._storageArr=[];this._nameList=[];this._idList=[];this._visual={};this._layout={};this._itemVisuals=[];this._itemLayouts=[];this._graphicEls=[];this._rawExtent={};this._extent={};this._approximateExtent={};this._calculationInfo={};this.hasItemOption=true;this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"];this.CHANGABLE_METHODS=["filterSelf","selectRange"];this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];this.getRawIndex=Bb;e=e||["x","y"];var r={};var i=[];var n={};for(var a=0;a<e.length;a++){var o=e[a];var s=P(o)?new bb({name:o}):!(o instanceof bb)?new bb(o):o;var l=s.name;s.type=s.type||"float";if(!s.coordDim){s.coordDim=l;s.coordDimIndex=0}var u=s.otherDims=s.otherDims||{};i.push(l);r[l]=s;s.index=a;if(s.createInvertedIndices){n[l]=[]}if(u.itemName===0){this._nameDimIdx=a;this._nameOrdinalMeta=s.ordinalMeta}if(u.itemId===0){this._idDimIdx=a;this._idOrdinalMeta=s.ordinalMeta}}this.dimensions=i;this._dimensionInfos=r;this.hostModel=t;this._dimensionsSummary=yb(this);this._invertedIndicesMap=n;this.userOutput=this._dimensionsSummary.userOutput}c.prototype.getDimension=function(e){if(typeof e==="number"||!isNaN(e)&&!this._dimensionInfos.hasOwnProperty(e)){e=this.dimensions[e]}return e};c.prototype.getDimensionInfo=function(e){return this._dimensionInfos[this.getDimension(e)]};c.prototype.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()};c.prototype.mapDimension=function(e,t){var r=this._dimensionsSummary;if(t==null){return r.encodeFirstDimNotExtra[e]}var i=r.encode[e];return i?i[t]:null};c.prototype.mapDimensionsAll=function(e){var t=this._dimensionsSummary;var r=t.encode[e];return(r||[]).slice()};c.prototype.initData=function(e,t,r){var i=Ud(e)||se(e);var n=i?new og(e,this.dimensions.length):e;if("development"!=="production"){E(i||b(n.getItem)&&b(n.count),"Inavlid data provider.")}this._rawData=n;var a=n.getSource().sourceFormat;this._storage={};this._indices=null;this._dontMakeIdFromName=this._idDimIdx!=null||a===Mv||!!n.fillStorage;this._nameList=(t||[]).slice();this._idList=[];this._nameRepeatCount={};if(!r){this.hasItemOption=false}this.defaultDimValueGetter=Nb[a];this._dimValueGetter=r=r||this.defaultDimValueGetter;this._dimValueGetterArrayRows=Nb.arrayRows;this._rawExtent={};this._initDataFromProvider(0,n.count());if(n.pure){this.hasItemOption=false}};c.prototype.getProvider=function(){return this._rawData};c.prototype.appendData=function(e){if("development"!=="production"){E(!this._indices,"appendData can only be called on raw data.")}var t=this._rawData;var r=this.count();t.appendData(e);var i=t.count();if(!t.persistent){i+=r}this._initDataFromProvider(r,i,true)};c.prototype.appendValues=function(e,t){var r=this._storage;var i=this.dimensions;var n=i.length;var a=this._rawExtent;var o=this.count();var s=o+Math.max(e.length,t?t.length:0);for(var l=0;l<n;l++){var u=i[l];if(!a[u]){a[u]=Zb()}zb(r,this._dimensionInfos[u],s,true)}var c=Mb(i,function(e){return a[e]});var f=this._storageArr=Mb(i,function(e){return r[e]});var h=[];for(var p=o;p<s;p++){var v=p-o;for(var d=0;d<n;d++){var u=i[d];var g=this._dimValueGetterArrayRows(e[v]||h,u,v,d);f[d][p]=g;var y=c[d];g<y[0]&&(y[0]=g);g>y[1]&&(y[1]=g)}if(t){this._nameList[p]=t[v];if(!this._dontMakeIdFromName){Hb(this,p)}}}this._rawCount=this._count=s;this._extent={};Eb(this)};c.prototype._initDataFromProvider=function(e,t,r){if(e>=t){return}var i=this._rawData;var n=this._storage;var a=this.dimensions;var o=a.length;var s=this._dimensionInfos;var l=this._nameList;var u=this._idList;var c=this._rawExtent;var f=i.getSource().sourceFormat;var h=f===_v;for(var p=0;p<o;p++){var v=a[p];if(!c[v]){c[v]=Zb()}zb(n,s[v],t,r)}var d=this._storageArr=Mb(a,function(e){return n[e]});var g=Mb(a,function(e){return c[e]});if(i.fillStorage){i.fillStorage(e,t,d,g)}else{var y=[];for(var m=e;m<t;m++){y=i.getItem(m,y);for(var x=0;x<o;x++){var v=a[x];var _=d[x];var b=this._dimValueGetter(y,v,m,x);_[m]=b;var w=g[x];b<w[0]&&(w[0]=b);b>w[1]&&(w[1]=b)}if(h&&!i.pure&&y){var S=y.name;if(l[m]==null&&S!=null){l[m]=Va(S,null)}var M=y.id;if(u[m]==null&&M!=null){u[m]=Va(M,null)}}if(!this._dontMakeIdFromName){Hb(this,m)}}}if(!i.persistent&&i.clean){i.clean()}this._rawCount=this._count=t;this._extent={};Eb(this)};c.prototype.count=function(){return this._count};c.prototype.getIndices=function(){var e;var t=this._indices;if(t){var r=t.constructor;var i=this._count;if(r===Array){e=new r(i);for(var n=0;n<i;n++){e[n]=t[n]}}else{e=new r(t.buffer,0,i)}}else{var r=Rb(this);e=new r(this.count());for(var n=0;n<e.length;n++){e[n]=n}}return e};c.prototype.getByDimIdx=function(e,t){if(!(t>=0&&t<this._count)){return NaN}var r=this._storageArr[e];return r?r[this.getRawIndex(t)]:NaN};c.prototype.get=function(e,t){if(!(t>=0&&t<this._count)){return NaN}var r=this._storage[e];return r?r[this.getRawIndex(t)]:NaN};c.prototype.getByRawIndex=function(e,t){if(!(t>=0&&t<this._rawCount)){return NaN}var r=this._storage[e];return r?r[t]:NaN};c.prototype.getValues=function(e,t){var r=[];if(!k(e)){t=e;e=this.dimensions}for(var i=0,n=e.length;i<n;i++){r.push(this.get(e[i],t))}return r};c.prototype.hasValue=function(e){var t=this._dimensionsSummary.dataDimsOnCoord;for(var r=0,i=t.length;r<i;r++){if(isNaN(this.get(t[r],e))){return false}}return true};c.prototype.getDataExtent=function(e){e=this.getDimension(e);var t=this._storage[e];var r=Zb();if(!t){return r}var i=this.count();var n=!this._indices;var a;if(n){return this._rawExtent[e].slice()}a=this._extent[e];if(a){return a.slice()}a=r;var o=a[0];var s=a[1];for(var l=0;l<i;l++){var u=this.getRawIndex(l);var c=t[u];c<o&&(o=c);c>s&&(s=c)}a=[o,s];this._extent[e]=a;return a};c.prototype.getApproximateExtent=function(e){e=this.getDimension(e);return this._approximateExtent[e]||this.getDataExtent(e)};c.prototype.setApproximateExtent=function(e,t){t=this.getDimension(t);this._approximateExtent[t]=e.slice()};c.prototype.getCalculationInfo=function(e){return this._calculationInfo[e]};c.prototype.setCalculationInfo=function(e,t){Sb(e)?F(this._calculationInfo,e):this._calculationInfo[e]=t};c.prototype.getSum=function(e){var t=this._storage[e];var r=0;if(t){for(var i=0,n=this.count();i<n;i++){var a=this.get(e,i);if(!isNaN(a)){r+=a}}}return r};c.prototype.getMedian=function(e){var t=[];this.each(e,function(e){if(!isNaN(e)){t.push(e)}});var r=t.sort(function(e,t){return e-t});var i=this.count();return i===0?0:i%2===1?r[(i-1)/2]:(r[i/2]+r[i/2-1])/2};c.prototype.rawIndexOf=function(e,t){var r=e&&this._invertedIndicesMap[e];if("development"!=="production"){if(!r){throw new Error("Do not supported yet")}}var i=r[t];if(i==null||isNaN(i)){return Cb}return i};c.prototype.indexOfName=function(e){for(var t=0,r=this.count();t<r;t++){if(this.getName(t)===e){return t}}return-1};c.prototype.indexOfRawIndex=function(e){if(e>=this._rawCount||e<0){return-1}if(!this._indices){return e}var t=this._indices;var r=t[e];if(r!=null&&r<this._count&&r===e){return e}var i=0;var n=this._count-1;while(i<=n){var a=(i+n)/2|0;if(t[a]<e){i=a+1}else if(t[a]>e){n=a-1}else{return a}}return-1};c.prototype.indicesOfNearest=function(e,t,r){var i=this._storage;var n=i[e];var a=[];if(!n){return a}if(r==null){r=Infinity}var o=Infinity;var s=-1;var l=0;for(var u=0,c=this.count();u<c;u++){var f=this.getRawIndex(u);var h=t-n[f];var p=Math.abs(h);if(p<=r){if(p<o||p===o&&h>=0&&s<0){o=p;s=h;l=0}if(h===s){a[l++]=u}}}a.length=l;return a};c.prototype.getRawDataItem=function(e){if(!this._rawData.persistent){var t=[];for(var r=0;r<this.dimensions.length;r++){var i=this.dimensions[r];t.push(this.get(i,e))}return t}else{return this._rawData.getItem(this.getRawIndex(e))}};c.prototype.getName=function(e){var t=this.getRawIndex(e);var r=this._nameList[t];if(r==null&&this._nameDimIdx!=null){r=Fb(this,this._nameDimIdx,this._nameOrdinalMeta,t)}if(r==null){r=""}return r};c.prototype.getId=function(e){return Gb(this,this.getRawIndex(e))};c.prototype.each=function(e,t,r,i){var n=this;if(!this._count){return}if(typeof e==="function"){i=r;r=t;t=e;e=[]}var a=r||i||this;var o=Mb(Wb(e),this.getDimension,this);if("development"!=="production"){jb(this,o)}var s=o.length;var l=Mb(o,function(e){return n._dimensionInfos[e].index});var u=this._storageArr;for(var c=0,f=this.count();c<f;c++){var h=this.getRawIndex(c);switch(s){case 0:t.call(a,c);break;case 1:t.call(a,u[l[0]][h],c);break;case 2:t.call(a,u[l[0]][h],u[l[1]][h],c);break;default:var p=0;var v=[];for(;p<s;p++){v[p]=u[l[p]][h]}v[p]=c;t.apply(a,v)}}};c.prototype.filterSelf=function(e,t,r,i){var n=this;if(!this._count){return}if(typeof e==="function"){i=r;r=t;t=e;e=[]}var a=r||i||this;var o=Mb(Wb(e),this.getDimension,this);if("development"!=="production"){jb(this,o)}var s=this.count();var l=Rb(this);var u=new l(s);var c=[];var f=o.length;var h=0;var p=Mb(o,function(e){return n._dimensionInfos[e].index});var v=p[0];var d=this._storageArr;for(var g=0;g<s;g++){var y=void 0;var m=this.getRawIndex(g);if(f===0){y=t.call(a,g)}else if(f===1){var x=d[v][m];y=t.call(a,x,g)}else{var _=0;for(;_<f;_++){c[_]=d[p[_]][m]}c[_]=g;y=t.apply(a,c)}if(y){u[h++]=m}}if(h<s){this._indices=u}this._count=h;this._extent={};this.getRawIndex=this._indices?Vb:Bb;return this};c.prototype.selectRange=function(e){var t=this;var r=this._count;if(!r){return}var i=[];for(var n in e){if(e.hasOwnProperty(n)){i.push(n)}}if("development"!=="production"){jb(this,i)}var a=i.length;if(!a){return}var o=this.count();var s=Rb(this);var l=new s(o);var u=0;var c=i[0];var f=Mb(i,function(e){return t._dimensionInfos[e].index});var h=e[c][0];var p=e[c][1];var v=this._storageArr;var d=false;if(!this._indices){var g=0;if(a===1){var y=v[f[0]];for(var m=0;m<r;m++){var x=y[m];if(x>=h&&x<=p||isNaN(x)){l[u++]=g}g++}d=true}else if(a===2){var y=v[f[0]];var _=v[f[1]];var b=e[i[1]][0];var w=e[i[1]][1];for(var m=0;m<r;m++){var x=y[m];var S=_[m];if((x>=h&&x<=p||isNaN(x))&&(S>=b&&S<=w||isNaN(S))){l[u++]=g}g++}d=true}}if(!d){if(a===1){for(var m=0;m<o;m++){var M=this.getRawIndex(m);var x=v[f[0]][M];if(x>=h&&x<=p||isNaN(x)){l[u++]=M}}}else{for(var m=0;m<o;m++){var I=true;var M=this.getRawIndex(m);for(var C=0;C<a;C++){var T=i[C];var x=v[f[C]][M];if(x<e[T][0]||x>e[T][1]){I=false}}if(I){l[u++]=this.getRawIndex(m)}}}}if(u<o){this._indices=l}this._count=u;this._extent={};this.getRawIndex=this._indices?Vb:Bb;return this};c.prototype.mapArray=function(e,t,r,i){if(typeof e==="function"){i=r;r=t;t=e;e=[]}r=r||i||this;var n=[];this.each(e,function(){n.push(t&&t.apply(this,arguments))},r);return n};c.prototype.map=function(e,t,r,i){var n=r||i||this;var a=Mb(Wb(e),this.getDimension,this);if("development"!=="production"){jb(this,a)}var o=Ub(this,a);var s=o._storage;o._indices=this._indices;o.getRawIndex=o._indices?Vb:Bb;var l=[];var u=a.length;var c=this.count();var f=[];var h=o._rawExtent;for(var p=0;p<c;p++){for(var v=0;v<u;v++){f[v]=this.get(a[v],p)}f[u]=p;var d=t&&t.apply(n,f);if(d!=null){if(typeof d!=="object"){l[0]=d;d=l}var g=this.getRawIndex(p);for(var y=0;y<d.length;y++){var m=a[y];var x=d[y];var _=h[m];var b=s[m];if(b){b[g]=x}if(x<_[0]){_[0]=x}if(x>_[1]){_[1]=x}}}}return o};c.prototype.downSample=function(e,t,r,i){var n=Ub(this,[e]);var a=n._storage;var o=[];var s=wb(1/t);var l=a[e];var u=this.count();var c=n._rawExtent[e];var f=new(Rb(this))(u);var h=0;for(var p=0;p<u;p+=s){if(s>u-p){s=u-p;o.length=s}for(var v=0;v<s;v++){var d=this.getRawIndex(p+v);o[v]=l[d]}var g=r(o);var y=this.getRawIndex(Math.min(p+i(o,g)||0,u-1));l[y]=g;if(g<c[0]){c[0]=g}if(g>c[1]){c[1]=g}f[h++]=y}n._count=h;n._indices=f;n.getRawIndex=Vb;return n};c.prototype.lttbDownSample=function(e,t){var r=Ub(this,[]);var i=r._storage;var n=i[e];var a=this.count();var o=new(Rb(this))(a);var s=0;var l=wb(1/t);var u=this.getRawIndex(0);var c;var f;var h;o[s++]=u;for(var p=1;p<a-1;p+=l){var v=Math.min(p+l,a-1);var d=Math.min(p+l*2,a);var g=(d+v)/2;var y=0;for(var m=v;m<d;m++){var x=this.getRawIndex(m);var _=n[x];if(isNaN(_)){continue}y+=_}y/=d-v;var b=p;var w=Math.min(p+l,a);var S=p-1;var M=n[u];c=-1;h=b;for(var m=b;m<w;m++){var x=this.getRawIndex(m);var _=n[x];if(isNaN(_)){continue}f=Math.abs((S-g)*(_-M)-(S-m)*(y-M));if(f>c){c=f;h=x}}o[s++]=h;u=h}o[s++]=this.getRawIndex(a-1);r._count=s;r._indices=o;r.getRawIndex=Vb;return r};c.prototype.getItemModel=function(e){var t=this.hostModel;var r=this.getRawDataItem(e);return new C(r,t,t&&t.ecModel)};c.prototype.diff=function(t){var r=this;return new gb(t?t.getIndices():[],this.getIndices(),function(e){return Gb(t,e)},function(e){return Gb(r,e)})};c.prototype.getVisual=function(e){var t=this._visual;return t&&t[e]};c.prototype.setVisual=function(e,t){this._visual=this._visual||{};if(Sb(e)){F(this._visual,e)}else{this._visual[e]=t}};c.prototype.getItemVisual=function(e,t){var r=this._itemVisuals[e];var i=r&&r[t];if(i==null){return this.getVisual(t)}return i};c.prototype.hasItemVisual=function(){return this._itemVisuals.length>0};c.prototype.ensureUniqueItemVisual=function(e,t){var r=this._itemVisuals;var i=r[e];if(!i){i=r[e]={}}var n=i[t];if(n==null){n=this.getVisual(t);if(k(n)){n=n.slice()}else if(Sb(n)){n=F({},n)}i[t]=n}return n};c.prototype.setItemVisual=function(e,t,r){var i=this._itemVisuals[e]||{};this._itemVisuals[e]=i;if(Sb(t)){F(i,t)}else{i[t]=r}};c.prototype.clearAllVisual=function(){this._visual={};this._itemVisuals=[]};c.prototype.setLayout=function(e,t){if(Sb(e)){for(var r in e){if(e.hasOwnProperty(r)){this.setLayout(r,e[r])}}return}this._layout[e]=t};c.prototype.getLayout=function(e){return this._layout[e]};c.prototype.getItemLayout=function(e){return this._itemLayouts[e]};c.prototype.setItemLayout=function(e,t,r){this._itemLayouts[e]=r?F(this._itemLayouts[e]||{},t):t};c.prototype.clearItemLayouts=function(){this._itemLayouts.length=0};c.prototype.setItemGraphicEl=function(e,t){var r=this.hostModel;if(t){var i=j(t);i.dataIndex=e;i.dataType=this.dataType;i.seriesIndex=r&&r.seriesIndex;if(t.type==="group"){t.traverse(Yb,t)}}this._graphicEls[e]=t};c.prototype.getItemGraphicEl=function(e){return this._graphicEls[e]};c.prototype.eachItemGraphicEl=function(r,i){U(this._graphicEls,function(e,t){if(e){r&&r.call(i,e,t)}})};c.prototype.cloneShallow=function(e){if(!e){var t=Mb(this.dimensions,this.getDimensionInfo,this);e=new c(t,this.hostModel)}e._storage=this._storage;e._storageArr=this._storageArr;Xb(e,this);if(this._indices){var r=this._indices.constructor;if(r===Array){var i=this._indices.length;e._indices=new r(i);for(var n=0;n<i;n++){e._indices[n]=this._indices[n]}}else{e._indices=new r(this._indices)}}else{e._indices=null}e.getRawIndex=e._indices?Vb:Bb;return e};c.prototype.wrapMethod=function(e,t){var r=this[e];if(typeof r!=="function"){return}this.__wrappedMethods=this.__wrappedMethods||[];this.__wrappedMethods.push(e);this[e]=function(){var e=r.apply(this,arguments);return t.apply(this,[e].concat(Se(arguments)))}};c.internalField=function(){Nb={arrayRows:e,objectRows:function(e,t,r,i){return Mg(e[t],this._dimensionInfos[t])},keyedColumns:e,original:function(e,t,r,i){var n=e&&(e.value==null?e:e.value);if(!this._rawData.pure&&Aa(e)){this.hasItemOption=true}return Mg(n instanceof Array?n[i]:n,this._dimensionInfos[t])},typedArray:function(e,t,r,i){return e[i]}};function e(e,t,r,i){return Mg(e[i],this._dimensionInfos[t])}Eb=function(a){var o=a._invertedIndicesMap;U(o,function(e,t){var r=a._dimensionInfos[t];var i=r.ordinalMeta;if(i){e=o[t]=new Lb(i.categories.length);for(var n=0;n<e.length;n++){e[n]=Cb}for(var n=0;n<a._count;n++){e[a.get(t,n)]=n}}})};Fb=function(e,t,r,i){var n;var a=e._storageArr[t];if(a){n=a[i];if(r&&r.categories.length){n=r.categories[n]}}return Va(n,null)};Rb=function(e){return e._rawCount>65535?Ab:kb};zb=function(e,t,r,i){var n=Db[t.type];var a=t.name;if(i){var o=e[a];var s=o&&o.length;if(!(s===r)){var l=new n(r);for(var u=0;u<s;u++){l[u]=o[u]}e[a]=l}}else{e[a]=new n(r)}};Bb=function(e){return e};Vb=function(e){if(e<this._count&&e>=0){return this._indices[e]}return-1};Gb=function(e,t){var r=e._idList[t];if(r==null&&e._idDimIdx!=null){r=Fb(e,e._idDimIdx,e._idOrdinalMeta,t)}if(r==null){r=Tb+t}return r};Wb=function(e){if(!k(e)){e=e!=null?[e]:[]}return e};jb=function(e,t){for(var r=0;r<t.length;r++){if(!e._dimensionInfos[t[r]]){console.error("Unkown dimension "+t[r])}}};Ub=function(e,t){var r=e.dimensions;var i=new c(Mb(r,e.getDimensionInfo,e),e.hostModel);Xb(i,e);var n=i._storage={};var a=e._storage;var o=i._storageArr=[];for(var s=0;s<r.length;s++){var l=r[s];if(a[l]){if(D(t,l)>=0){n[l]=u(a[l]);i._rawExtent[l]=Zb();i._extent[l]=null}else{n[l]=a[l]}o.push(n[l])}}return i};function u(e){var t=e.constructor;return t===Array?e.slice():new t(e)}Zb=function(){return[Infinity,-Infinity]};Yb=function(e){var t=j(e);var r=j(this);t.seriesIndex=r.seriesIndex;t.dataIndex=r.dataIndex;t.dataType=r.dataType};Xb=function(t,r){U(Pb.concat(r.__wrappedMethods||[]),function(e){if(r.hasOwnProperty(e)){t[e]=r[e]}});t.__wrappedMethods=r.__wrappedMethods;U(Ob,function(e){t[e]=M(r[e])});t._calculationInfo=F({},r._calculationInfo)};Hb=function(e,t){var r=e._nameList;var i=e._idList;var n=e._nameDimIdx;var a=e._idDimIdx;var o=r[t];var s=i[t];if(o==null&&n!=null){r[t]=o=Fb(e,n,e._nameOrdinalMeta,t)}if(s==null&&a!=null){i[t]=s=Fb(e,a,e._idOrdinalMeta,t)}if(s==null&&o!=null){var l=e._nameRepeatCount;var u=l[o]=(l[o]||0)+1;s=o;if(u>1){s+="__ec__"+u}i[t]=s}}}();return c}();function Jb(e,t,r){if(!Ud(t)){t=Yd(t)}r=r||{};e=(e||[]).slice();var i=(r.dimsDef||[]).slice();var a=I();var n=I();var l=[];var o=Kb(t,e,i,r.dimCount);for(var s=0;s<o;s++){var u=i[s];var c=i[s]=F({},O(u)?u:{name:u});var f=c.name;var h=l[s]=new bb;if(f!=null&&a.get(f)==null){h.name=h.displayName=f;a.set(f,s)}c.type!=null&&(h.type=c.type);c.displayName!=null&&(h.displayName=c.displayName)}var p=r.encodeDef;if(!p&&r.encodeDefaulter){p=r.encodeDefaulter(t,o)}var v=I(p);v.each(function(e,i){var t=Ia(e).slice();if(t.length===1&&!P(t[0])&&t[0]<0){v.set(i,false);return}var n=v.set(i,[]);U(t,function(e,t){var r=P(e)?a.get(e):e;if(r!=null&&r<o){n[t]=r;g(l[r],i,t)}})});var d=0;U(e,function(e){var n;var a;var o;var s;if(P(e)){n=e;s={}}else{s=e;n=s.name;var t=s.ordinalMeta;s.ordinalMeta=null;s=M(s);s.ordinalMeta=t;a=s.dimsDef;o=s.otherDims;s.name=s.coordDim=s.coordDimIndex=s.dimsDef=s.otherDims=null}var r=v.get(n);if(r===false){return}r=Ia(r);if(!r.length){for(var i=0;i<(a&&a.length||1);i++){while(d<l.length&&l[d].coordDim!=null){d++}d<l.length&&r.push(d++)}}U(r,function(e,t){var r=l[e];g(R(r,s),n,t);if(r.name==null&&a){var i=a[t];!O(i)&&(i={name:i});r.name=r.displayName=i.name;r.defaultTooltip=i.defaultTooltip}o&&R(r.otherDims,o)})});function g(e,t,r){if(xv.get(t)!=null){e.otherDims[t]=r}else{e.coordDim=t;e.coordDimIndex=r;n.set(t,true)}}var y=r.generateCoord;var m=r.generateCoordCount;var x=m!=null;m=y?m||1:0;var _=y||"value";for(var b=0;b<o;b++){var h=l[b]=l[b]||new bb;var w=h.coordDim;if(w==null){h.coordDim=Qb(_,n,x);h.coordDimIndex=0;if(!y||m<=0){h.isExtraCoord=true}m--}h.name==null&&(h.name=Qb(h.coordDim,a,false));if(h.type==null&&(Ev(t,b)===Dv.Must||h.isExtraCoord&&(h.otherDims.itemName!=null||h.otherDims.seriesName!=null))){h.type="ordinal"}}return l}function Kb(e,t,r,i){var n=Math.max(e.dimensionsDetectedCount||1,t.length,r.length,i||0);U(t,function(e){var t;if(O(e)&&(t=e.dimsDef)){n=Math.max(n,t.length)}});return n}function Qb(e,t,r){if(r||t.get(e)!=null){var i=0;while(t.get(e+i)!=null){i++}e+=i}t.set(e,true);return e}function $b(e,t){t=t||{};return Jb(t.coordDimensions||[],e,{dimsDef:t.dimensionsDefine||e.dimensionsDefine,encodeDef:t.encodeDefine||e.encodeDefine,dimCount:t.dimensionsCount,encodeDefaulter:t.encodeDefaulter,generateCoord:t.generateCoord,generateCoordCount:t.generateCoordCount})}var ew=function(){function e(e){this.coordSysDims=[];this.axisMap=I();this.categoryAxisMap=I();this.coordSysName=e}return e}();function tw(e){var t=e.get("coordinateSystem");var r=new ew(t);var i=rw[t];if(i){i(e,r,r.axisMap,r.categoryAxisMap);return r}}var rw={cartesian2d:function(e,t,r,i){var n=e.getReferringComponents("xAxis",$a).models[0];var a=e.getReferringComponents("yAxis",$a).models[0];if("development"!=="production"){if(!n){throw new Error('xAxis "'+be(e.get("xAxisIndex"),e.get("xAxisId"),0)+'" not found')}if(!a){throw new Error('yAxis "'+be(e.get("xAxisIndex"),e.get("yAxisId"),0)+'" not found')}}t.coordSysDims=["x","y"];r.set("x",n);r.set("y",a);if(iw(n)){i.set("x",n);t.firstCategoryDimIndex=0}if(iw(a)){i.set("y",a);t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1)}},singleAxis:function(e,t,r,i){var n=e.getReferringComponents("singleAxis",$a).models[0];if("development"!=="production"){if(!n){throw new Error("singleAxis should be specified.")}}t.coordSysDims=["single"];r.set("single",n);if(iw(n)){i.set("single",n);t.firstCategoryDimIndex=0}},polar:function(e,t,r,i){var n=e.getReferringComponents("polar",$a).models[0];var a=n.findAxisModel("radiusAxis");var o=n.findAxisModel("angleAxis");if("development"!=="production"){if(!o){throw new Error("angleAxis option not found")}if(!a){throw new Error("radiusAxis option not found")}}t.coordSysDims=["radius","angle"];r.set("radius",a);r.set("angle",o);if(iw(a)){i.set("radius",a);t.firstCategoryDimIndex=0}if(iw(o)){i.set("angle",o);t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1)}},geo:function(e,t,r,i){t.coordSysDims=["lng","lat"]},parallel:function(e,n,a,o){var s=e.ecModel;var t=s.getComponent("parallel",e.get("parallelIndex"));var l=n.coordSysDims=t.dimensions.slice();U(t.parallelAxisIndex,function(e,t){var r=s.getComponent("parallelAxis",e);var i=l[t];a.set(i,r);if(iw(r)){o.set(i,r);if(n.firstCategoryDimIndex==null){n.firstCategoryDimIndex=t}}})}};function iw(e){return e.get("type")==="category"}function nw(e,r,t){t=t||{};var i=t.byIndex;var n=t.stackedCoordDimension;var a=!!(e&&e.get("stack"));var o;var s;var l;var u;U(r,function(e,t){if(P(e)){r[t]=e={name:e}}if(a&&!e.isExtraCoord){if(!i&&!o&&e.ordinalMeta){o=e}if(!s&&e.type!=="ordinal"&&e.type!=="time"&&(!n||n===e.coordDim)){s=e}}});if(s&&!i&&!o){i=true}if(s){l="__\0ecstackresult";u="__\0ecstackedover";if(o){o.createInvertedIndices=true}var c=s.coordDim;var f=s.type;var h=0;U(r,function(e){if(e.coordDim===c){h++}});r.push({name:l,coordDim:c,coordDimIndex:h,type:f,isExtraCoord:true,isCalculationCoord:true});h++;r.push({name:u,coordDim:u,coordDimIndex:h,type:f,isExtraCoord:true,isCalculationCoord:true})}return{stackedDimension:s&&s.name,stackedByDimension:o&&o.name,isStackedByIndex:i,stackedOverDimension:u,stackResultDimension:l}}function aw(e,t){return!!t&&t===e.getCalculationInfo("stackedDimension")}function ow(e,t){return aw(e,t)?e.getCalculationInfo("stackResultDimension"):t}function sw(e,t,n){n=n||{};if(!Ud(e)){e=Yd(e)}var r=t.get("coordinateSystem");var i=fd.get(r);var a=tw(t);var o;if(a&&a.coordSysDims){o=A(a.coordSysDims,function(e){var t={name:e};var r=a.axisMap.get(e);if(r){var i=r.get("type");t.type=xb(i)}return t})}if(!o){o=i&&(i.getDimensionsInfo?i.getDimensionsInfo():i.dimensions.slice())||["x","y"]}var s=n.useEncodeDefaulter;var l=$b(e,{coordDimensions:o,generateCoord:n.generateCoord,encodeDefaulter:b(s)?s:s?_(kv,o,t):null});var u;var c;a&&U(l,function(e,t){var r=e.coordDim;var i=a.categoryAxisMap.get(r);if(i){if(u==null){u=t}e.ordinalMeta=i.getOrdinalMeta();if(n.createInvertedIndices){e.createInvertedIndices=true}}if(e.otherDims.itemName!=null){c=true}});if(!c&&u!=null){l[u].otherDims.itemName=0}var f=nw(t,l);var h=new qb(l,t);h.setCalculationInfo(f);var p=u!=null&&lw(e)?function(e,t,r,i){return i===u?r:this.defaultDimValueGetter(e,t,r,i)}:null;h.hasItemOption=false;h.initData(e,null,p);return h}function lw(e){if(e.sourceFormat===_v){var t=uw(e.data||[]);return t!=null&&!k(Da(t))}}function uw(e){var t=0;while(t<e.length&&e[t]==null){t++}return e[t]}var cw=function(){function e(e){this._setting=e||{};this._extent=[Infinity,-Infinity]}e.prototype.getSetting=function(e){return this._setting[e]};e.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]);e[1]>t[1]&&(t[1]=e[1])};e.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))};e.prototype.getExtent=function(){return this._extent.slice()};e.prototype.setExtent=function(e,t){var r=this._extent;if(!isNaN(e)){r[0]=e}if(!isNaN(t)){r[1]=t}};e.prototype.isInExtentRange=function(e){return this._extent[0]<=e&&this._extent[1]>=e};e.prototype.isBlank=function(){return this._isBlank};e.prototype.setBlank=function(e){this._isBlank=e};return e}();bo(cw);var fw=function(){function n(e){this.categories=e.categories||[];this._needCollect=e.needCollect;this._deduplication=e.deduplication}n.createByAxisModel=function(e){var t=e.option;var r=t.data;var i=r&&A(r,hw);return new n({categories:i,needCollect:!i,deduplication:t.dedplication!==false})};n.prototype.getOrdinal=function(e){return this._getOrCreateMap().get(e)};n.prototype.parseAndCollect=function(e){var t;var r=this._needCollect;if(typeof e!=="string"&&!r){return e}if(r&&!this._deduplication){t=this.categories.length;this.categories[t]=e;return t}var i=this._getOrCreateMap();t=i.get(e);if(t==null){if(r){t=this.categories.length;this.categories[t]=e;i.set(e,t)}else{t=NaN}}return t};n.prototype._getOrCreateMap=function(){return this._map||(this._map=I(this.categories))};return n}();function hw(e){if(O(e)&&e.value!=null){return e.value}else{return e+""}}var pw=Zn;function vw(e,t,r,i){var n={};var a=e[1]-e[0];var o=n.interval=oa(a/t,true);if(r!=null&&o<r){o=n.interval=r}if(i!=null&&o>i){o=n.interval=i}var s=n.intervalPrecision=dw(o);var l=n.niceTickExtent=[pw(Math.ceil(e[0]/o)*o,s),pw(Math.floor(e[1]/o)*o,s)];yw(l,e);return n}function dw(e){return Xn(e)+2}function gw(e,t,r){e[t]=Math.max(Math.min(e[t],r[1]),r[0])}function yw(e,t){!isFinite(e[0])&&(e[0]=t[0]);!isFinite(e[1])&&(e[1]=t[1]);gw(e,0,t);gw(e,1,t);if(e[0]>e[1]){e[0]=e[1]}}function mw(e,t){return e>=t[0]&&e<=t[1]}function xw(e,t){if(t[1]===t[0]){return.5}return(e-t[0])/(t[1]-t[0])}function _w(e,t){return e*(t[1]-t[0])+t[0]}var bw=function(i){d(e,i);function e(e){var t=i.call(this,e)||this;t.type="ordinal";var r=t.getSetting("ordinalMeta");if(!r){r=new fw({})}if(k(r)){r=new fw({categories:A(r,function(e){return O(e)?e.value:e})})}t._ordinalMeta=r;t._extent=t.getSetting("extent")||[0,r.categories.length-1];return t}e.prototype.parse=function(e){return typeof e==="string"?this._ordinalMeta.getOrdinal(e):Math.round(e)};e.prototype.contain=function(e){e=this.parse(e);return mw(e,this._extent)&&this._ordinalMeta.categories[e]!=null};e.prototype.normalize=function(e){e=this._getTickNumber(this.parse(e));return xw(e,this._extent)};e.prototype.scale=function(e){e=Math.round(_w(e,this._extent));return this.getRawOrdinalNumber(e)};e.prototype.getTicks=function(){var e=[];var t=this._extent;var r=t[0];while(r<=t[1]){e.push({value:r});r++}return e};e.prototype.getMinorTicks=function(e){return};e.prototype.setSortInfo=function(e){if(e==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}var t=e.ordinalNumbers;var r=this._ordinalNumbersByTick=[];var i=this._ticksByOrdinalNumber=[];var n=0;var a=this._ordinalMeta.categories.length;for(var o=Math.min(a,t.length);n<o;++n){var s=t[n];r[n]=s;i[s]=n}var l=0;for(;n<a;++n){while(i[l]!=null){l++}r.push(l);i[l]=n}};e.prototype._getTickNumber=function(e){var t=this._ticksByOrdinalNumber;return t&&e>=0&&e<t.length?t[e]:e};e.prototype.getRawOrdinalNumber=function(e){var t=this._ordinalNumbersByTick;return t&&e>=0&&e<t.length?t[e]:e};e.prototype.getLabel=function(e){if(!this.isBlank()){var t=this.getRawOrdinalNumber(e.value);var r=this._ordinalMeta.categories[t];return r==null?"":r+""}};e.prototype.count=function(){return this._extent[1]-this._extent[0]+1};e.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))};e.prototype.isInExtentRange=function(e){e=this._getTickNumber(e);return this._extent[0]<=e&&this._extent[1]>=e};e.prototype.getOrdinalMeta=function(){return this._ordinalMeta};e.prototype.niceTicks=function(){};e.prototype.niceExtent=function(){};e.type="ordinal";return e}(cw);cw.registerClass(bw);var ww=Zn;var Sw=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="interval";e._interval=0;e._intervalPrecision=2;return e}e.prototype.parse=function(e){return e};e.prototype.contain=function(e){return mw(e,this._extent)};e.prototype.normalize=function(e){return xw(e,this._extent)};e.prototype.scale=function(e){return _w(e,this._extent)};e.prototype.setExtent=function(e,t){var r=this._extent;if(!isNaN(e)){r[0]=parseFloat(e)}if(!isNaN(t)){r[1]=parseFloat(t)}};e.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]);e[1]>t[1]&&(t[1]=e[1]);this.setExtent(t[0],t[1])};e.prototype.getInterval=function(){return this._interval};e.prototype.setInterval=function(e){this._interval=e;this._niceExtent=this._extent.slice();this._intervalPrecision=dw(e)};e.prototype.getTicks=function(e){var t=this._interval;var r=this._extent;var i=this._niceExtent;var n=this._intervalPrecision;var a=[];if(!t){return a}var o=1e4;if(r[0]<i[0]){if(e){a.push({value:ww(i[0]-t,n)})}else{a.push({value:r[0]})}}var s=i[0];while(s<=i[1]){a.push({value:s});s=ww(s+t,n);if(s===a[a.length-1].value){break}if(a.length>o){return[]}}var l=a.length?a[a.length-1].value:i[1];if(r[1]>l){if(e){a.push({value:ww(l+t,n)})}else{a.push({value:r[1]})}}return a};e.prototype.getMinorTicks=function(e){var t=this.getTicks(true);var r=[];var i=this.getExtent();for(var n=1;n<t.length;n++){var a=t[n];var o=t[n-1];var s=0;var l=[];var u=a.value-o.value;var c=u/e;while(s<e-1){var f=ww(o.value+(s+1)*c);if(f>i[0]&&f<i[1]){l.push(f)}s++}r.push(l)}return r};e.prototype.getLabel=function(e,t){if(e==null){return""}var r=t&&t.precision;if(r==null){r=Xn(e.value)||0}else if(r==="auto"){r=this._intervalPrecision}var i=ww(e.value,r,true);return zp(i)};e.prototype.niceTicks=function(e,t,r){e=e||5;var i=this._extent;var n=i[1]-i[0];if(!isFinite(n)){return}if(n<0){n=-n;i.reverse()}var a=vw(i,e,t,r);this._intervalPrecision=a.intervalPrecision;this._interval=a.interval;this._niceExtent=a.niceTickExtent};e.prototype.niceExtent=function(e){var t=this._extent;if(t[0]===t[1]){if(t[0]!==0){var r=t[0];if(!e.fixMax){t[1]+=r/2;t[0]-=r/2}else{t[0]-=r/2}}else{t[1]=1}}var i=t[1]-t[0];if(!isFinite(i)){t[0]=0;t[1]=1}this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval);var n=this._interval;if(!e.fixMin){t[0]=ww(Math.floor(t[0]/n)*n)}if(!e.fixMax){t[1]=ww(Math.ceil(t[1]/n)*n)}};e.type="interval";return e}(cw);cw.registerClass(Sw);var Mw="__ec_stack_";var Iw=.5;var Cw=typeof Float32Array!=="undefined"?Float32Array:Array;function Tw(e){return e.get("stack")||Mw+e.seriesIndex}function Dw(e){return e.dim+e.index}function Aw(e){var t=[];var r=e.axis;var i="axis0";if(r.type!=="category"){return}var n=r.getBandWidth();for(var a=0;a<e.count||0;a++){t.push(R({bandWidth:n,axisKey:i,stackId:Mw+a},e))}var o=Ow(t);var s=[];for(var a=0;a<e.count;a++){var l=o[i][Mw+a];l.offsetCenter=l.offset+l.width/2;s.push(l)}return s}function Lw(e,t){var r=[];t.eachSeriesByType(e,function(e){if(zw(e)&&!Bw(e)){r.push(e)}});return r}function kw(e){var u={};U(e,function(e){var t=e.coordinateSystem;var r=t.getBaseAxis();if(r.type!=="time"&&r.type!=="value"){return}var i=e.getData();var n=r.dim+"_"+r.index;var a=i.mapDimension(r.dim);for(var o=0,s=i.count();o<s;++o){var l=i.get(a,o);if(!u[n]){u[n]=[l]}else{u[n].push(l)}}});var t={};for(var r in u){if(u.hasOwnProperty(r)){var i=u[r];if(i){i.sort(function(e,t){return e-t});var n=null;for(var a=1;a<i.length;++a){var o=i[a]-i[a-1];if(o>0){n=n===null?o:Math.min(n,o)}}t[r]=n}}}return t}function Pw(e){var g=kw(e);var y=[];U(e,function(e){var t=e.coordinateSystem;var r=t.getBaseAxis();var i=r.getExtent();var n;if(r.type==="category"){n=r.getBandWidth()}else if(r.type==="value"||r.type==="time"){var a=r.dim+"_"+r.index;var o=g[a];var s=Math.abs(i[1]-i[0]);var l=r.scale.getExtent();var u=Math.abs(l[1]-l[0]);n=o?s/u*o:s}else{var c=e.getData();n=Math.abs(i[1]-i[0])/c.count()}var f=Y(e.get("barWidth"),n);var h=Y(e.get("barMaxWidth"),n);var p=Y(e.get("barMinWidth")||1,n);var v=e.get("barGap");var d=e.get("barCategoryGap");y.push({bandWidth:n,barWidth:f,barMaxWidth:h,barMinWidth:p,barGap:v,barCategoryGap:d,axisKey:Dw(r),stackId:Tw(e)})});return Ow(y)}function Ow(e){var h={};U(e,function(e,t){var r=e.axisKey;var i=e.bandWidth;var n=h[r]||{bandWidth:i,remainedWidth:i,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}};var a=n.stacks;h[r]=n;var o=e.stackId;if(!a[o]){n.autoWidthCount++}a[o]=a[o]||{width:0,maxWidth:0};var s=e.barWidth;if(s&&!a[o].width){a[o].width=s;s=Math.min(n.remainedWidth,s);n.remainedWidth-=s}var l=e.barMaxWidth;l&&(a[o].maxWidth=l);var u=e.barMinWidth;u&&(a[o].minWidth=u);var c=e.barGap;c!=null&&(n.gap=c);var f=e.barCategoryGap;f!=null&&(n.categoryGap=f)});var v={};U(h,function(e,r){v[r]={};var t=e.stacks;var i=e.bandWidth;var n=e.categoryGap;if(n==null){var a=L(t).length;n=Math.max(35-a*4,15)+"%"}var o=Y(n,i);var s=Y(e.gap,1);var l=e.remainedWidth;var u=e.autoWidthCount;var c=(l-o)/(u+(u-1)*s);c=Math.max(c,0);U(t,function(e){var t=e.maxWidth;var r=e.minWidth;if(!e.width){var i=c;if(t&&t<i){i=Math.min(t,l)}if(r&&r>i){i=r}if(i!==c){e.width=i;l-=i+s*i;u--}}else{var i=e.width;if(t){i=Math.min(i,t)}if(r){i=Math.max(i,r)}e.width=i;l-=i+s*i;u--}});c=(l-o)/(u+(u-1)*s);c=Math.max(c,0);var f=0;var h;U(t,function(e,t){if(!e.width){e.width=c}h=e;f+=e.width*(1+s)});if(h){f-=h.width*s}var p=-f/2;U(t,function(e,t){v[r][t]=v[r][t]||{bandWidth:i,offset:p,width:e.width};p+=e.width*(1+s)})});return v}function Nw(e,t,r){if(e&&t){var i=e[Dw(t)];if(i!=null&&r!=null){return i[Tw(r)]}return i}}function Ew(e,t){var r=Lw(e,t);var C=Pw(r);var T={};U(r,function(e){var t=e.getData();var r=e.coordinateSystem;var i=r.getBaseAxis();var n=Tw(e);var a=C[Dw(i)][n];var o=a.offset;var s=a.width;var l=r.getOtherAxis(i);var u=e.get("barMinHeight")||0;T[n]=T[n]||[];t.setLayout({bandWidth:a.bandWidth,offset:o,size:s});var c=t.mapDimension(l.dim);var f=t.mapDimension(i.dim);var h=aw(t,c);var p=l.isHorizontal();var v=Vw(i,l);for(var d=0,g=t.count();d<g;d++){var y=t.get(c,d);var m=t.get(f,d);var x=y>=0?"p":"n";var _=v;if(h){if(!T[n][m]){T[n][m]={p:v,n:v}}_=T[n][m][x]}var b=void 0;var w=void 0;var S=void 0;var M=void 0;if(p){var I=r.dataToPoint([y,m]);b=_;w=I[1]+o;S=I[0]-v;M=s;if(Math.abs(S)<u){S=(S<0?-1:1)*u}if(!isNaN(S)){h&&(T[n][m][x]+=S)}}else{var I=r.dataToPoint([m,y]);b=I[0]+o;w=_;S=s;M=I[1]-v;if(Math.abs(M)<u){M=(M<=0?-1:1)*u}if(!isNaN(M)){h&&(T[n][m][x]+=M)}}t.setItemLayout(d,{x:b,y:w,width:S,height:M})}})}var Rw={seriesType:"bar",plan:Iy(),reset:function(e){if(!zw(e)||!Bw(e)){return}var t=e.getData();var f=e.coordinateSystem;var h=f.master.getRect();var p=f.getBaseAxis();var v=f.getOtherAxis(p);var d=t.mapDimension(v.dim);var g=t.mapDimension(p.dim);var y=v.isHorizontal();var m=y?0:1;var x=Nw(Pw([e]),p,e).width;if(!(x>Iw)){x=Iw}return{progress:function(e,t){var r=e.count;var i=new Cw(r*2);var n=new Cw(r*2);var a=new Cw(r);var o;var s=[];var l=[];var u=0;var c=0;while((o=e.next())!=null){l[m]=t.get(d,o);l[1-m]=t.get(g,o);s=f.dataToPoint(l,null);n[u]=y?h.x+h.width:s[0];i[u++]=s[0];n[u]=y?s[1]:h.y+h.height;i[u++]=s[1];a[c++]=o}t.setLayout({largePoints:i,largeDataIndices:a,largeBackgroundPoints:n,barWidth:x,valueAxisStart:Vw(p,v),backgroundStart:y?h.x:h.y,valueAxisHorizontal:y})}}}};function zw(e){return e.coordinateSystem&&e.coordinateSystem.type==="cartesian2d"}function Bw(e){return e.pipelineContext&&e.pipelineContext.large}function Vw(e,t,r){return t.toGlobalCoord(t.dataToCoord(t.type==="log"?1:0))}var Gw=function(e,t,r,i){while(r<i){var n=r+i>>>1;if(e[n][1]<t){r=n+1}else{i=n}}return r};var Fw=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="time";return t}e.prototype.getLabel=function(e){var t=this.getSetting("useUTC");return mp(e.value,fp[yp(dp(this._minLevelUnit))]||fp.second,t,this.getSetting("locale"))};e.prototype.getFormattedLabel=function(e,t,r){var i=this.getSetting("useUTC");var n=this.getSetting("locale");return xp(e,t,r,n,i)};e.prototype.getTicks=function(e){var t=this._interval;var r=this._extent;var i=[];if(!t){return i}i.push({value:r[0],level:0});var n=this.getSetting("useUTC");var a=Jw(this._minLevelUnit,this._approxInterval,n,r);i=i.concat(a);i.push({value:r[1],level:0});return i};e.prototype.niceExtent=function(e){var t=this._extent;if(t[0]===t[1]){t[0]-=sp;t[1]+=sp}if(t[1]===-Infinity&&t[0]===Infinity){var r=new Date;t[1]=+new Date(r.getFullYear(),r.getMonth(),r.getDate());t[0]=t[1]-sp}this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval)};e.prototype.niceTicks=function(e,t,r){e=e||10;var i=this._extent;var n=i[1]-i[0];this._approxInterval=n/e;if(t!=null&&this._approxInterval<t){this._approxInterval=t}if(r!=null&&this._approxInterval>r){this._approxInterval=r}var a=Hw.length;var o=Math.min(Gw(Hw,this._approxInterval,0,a),a-1);this._interval=Hw[o][1];this._minLevelUnit=Hw[Math.max(o-1,0)][0]};e.prototype.parse=function(e){return typeof e==="number"?e:+ia(e)};e.prototype.contain=function(e){return mw(this.parse(e),this._extent)};e.prototype.normalize=function(e){return xw(this.parse(e),this._extent)};e.prototype.scale=function(e){return _w(e,this._extent)};e.type="time";return e}(Sw);var Hw=[["second",np],["minute",ap],["hour",op],["quarter-day",op*6],["half-day",op*12],["day",sp*1.2],["half-week",sp*3.5],["week",sp*7],["month",sp*31],["quarter",sp*95],["half-year",lp/2],["year",lp]];function Ww(e,t,r,i){var n=ia(t);var a=ia(r);var o=function(e){return bp(n,e,i)===bp(a,e,i)};var s=function(){return o("year")};var l=function(){return s()&&o("month")};var u=function(){return l()&&o("day")};var c=function(){return u()&&o("hour")};var f=function(){return c()&&o("minute")};var h=function(){return f()&&o("second")};var p=function(){return h()&&o("millisecond")};switch(e){case"year":return s();case"month":return l();case"day":return u();case"hour":return c();case"minute":return f();case"second":return h();case"millisecond":return p()}}function jw(e,t){e/=sp;return e>16?16:e>7.5?7:e>3.5?4:e>1.5?2:1}function Uw(e){var t=30*sp;e/=t;return e>6?6:e>3?3:e>2?2:1}function Zw(e){e/=op;return e>12?12:e>6?6:e>3.5?4:e>2?2:1}function Yw(e,t){e/=t?ap:np;return e>30?30:e>20?20:e>15?15:e>10?10:e>5?5:e>2?2:1}function Xw(e){return oa(e,true)}function qw(e,t,r){var i=new Date(e);switch(dp(t)){case"year":case"month":i[Lp(r)](0);case"day":i[kp(r)](1);case"hour":i[Pp(r)](0);case"minute":i[Op(r)](0);case"second":i[Np(r)](0);i[Ep(r)](0)}return i.getTime()}function Jw(e,h,p,v){var t=1e4;var r=pp;var i=0;function d(e,t,r,i,n,a,o){var s=new Date(t);var l=t;var u=s[i]();while(l<r&&l<=v[1]){o.push({value:l});u+=e;s[n](u);l=s.getTime()}o.push({value:l,notAdd:true})}function n(e,t,r){var i=[];var n=!t.length;if(Ww(dp(e),v[0],v[1],p)){return}if(n){t=[{value:qw(new Date(v[0]),e,p)},{value:v[1]}]}for(var a=0;a<t.length-1;a++){var o=t[a].value;var s=t[a+1].value;if(o===s){continue}var l=void 0;var u=void 0;var c=void 0;var f=false;switch(e){case"year":l=Math.max(1,Math.round(h/sp/365));u=wp(p);c=Ap(p);break;case"half-year":case"quarter":case"month":l=Uw(h);u=Sp(p);c=Lp(p);break;case"week":case"half-week":case"day":l=jw(h);u=Mp(p);c=kp(p);f=true;break;case"half-day":case"quarter-day":case"hour":l=Zw(h);u=Ip(p);c=Pp(p);break;case"minute":l=Yw(h,true);u=Cp(p);c=Op(p);break;case"second":l=Yw(h,false);u=Tp(p);c=Np(p);break;case"millisecond":l=Xw(h);u=Dp(p);c=Ep(p);break}d(l,o,s,u,c,f,i);if(e==="year"&&r.length>1&&a===0){r.unshift({value:r[0].value-l})}}for(var a=0;a<i.length;a++){r.push(i[a])}return i}var a=[];var o=[];var s=0;var l=0;for(var u=0;u<r.length&&i++<t;++u){var c=dp(r[u]);if(!gp(r[u])){continue}n(r[u],a[a.length-1]||[],o);var f=r[u+1]?dp(r[u+1]):null;if(c!==f){if(o.length){l=s;o.sort(function(e,t){return e.value-t.value});var g=[];for(var y=0;y<o.length;++y){var m=o[y].value;if(y===0||o[y-1].value!==m){g.push(o[y]);if(m>=v[0]&&m<=v[1]){s++}}}var x=(v[1]-v[0])/h;if(s>x*1.5&&l>x/1.5){break}a.push(g);if(s>x||e===r[u]){break}}o=[]}}if("development"!=="production"){if(i>=t){ya("Exceed safe limit.")}}var _=ue(A(a,function(e){return ue(e,function(e){return e.value>=v[0]&&e.value<=v[1]&&!e.notAdd})}),function(e){return e.length>0});var b=[];var w=_.length-1;for(var u=0;u<_.length;++u){var S=_[u];for(var M=0;M<S.length;++M){b.push({value:S[M].value,level:w-u})}}b.sort(function(e,t){return e.value-t.value});var I=[];for(var u=0;u<b.length;++u){if(u===0||b[u].value!==b[u-1].value){I.push(b[u])}}return I}cw.registerClass(Fw);var Kw=cw.prototype;var Qw=Sw.prototype;var $w=Zn;var eS=Math.floor;var tS=Math.ceil;var rS=Math.pow;var iS=Math.log;var nS=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="log";e.base=10;e._originalScale=new Sw;e._interval=0;return e}e.prototype.getTicks=function(e){var t=this._originalScale;var i=this._extent;var n=t.getExtent();var r=Qw.getTicks.call(this,e);return A(r,function(e){var t=e.value;var r=Zn(rS(this.base,t));r=t===i[0]&&this._fixMin?oS(r,n[0]):r;r=t===i[1]&&this._fixMax?oS(r,n[1]):r;return{value:r}},this)};e.prototype.setExtent=function(e,t){var r=this.base;e=iS(e)/iS(r);t=iS(t)/iS(r);Qw.setExtent.call(this,e,t)};e.prototype.getExtent=function(){var e=this.base;var t=Kw.getExtent.call(this);t[0]=rS(e,t[0]);t[1]=rS(e,t[1]);var r=this._originalScale;var i=r.getExtent();this._fixMin&&(t[0]=oS(t[0],i[0]));this._fixMax&&(t[1]=oS(t[1],i[1]));return t};e.prototype.unionExtent=function(e){this._originalScale.unionExtent(e);var t=this.base;e[0]=iS(e[0])/iS(t);e[1]=iS(e[1])/iS(t);Kw.unionExtent.call(this,e)};e.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))};e.prototype.niceTicks=function(e){e=e||10;var t=this._extent;var r=t[1]-t[0];if(r===Infinity||r<=0){return}var i=na(r);var n=e/r*i;if(n<=.5){i*=10}while(!isNaN(i)&&Math.abs(i)<1&&Math.abs(i)>0){i*=10}var a=[Zn(tS(t[0]/i)*i),Zn(eS(t[1]/i)*i)];this._interval=i;this._niceExtent=a};e.prototype.niceExtent=function(e){Qw.niceExtent.call(this,e);this._fixMin=e.fixMin;this._fixMax=e.fixMax};e.prototype.parse=function(e){return e};e.prototype.contain=function(e){e=iS(e)/iS(this.base);return mw(e,this._extent)};e.prototype.normalize=function(e){e=iS(e)/iS(this.base);return xw(e,this._extent)};e.prototype.scale=function(e){e=_w(e,this._extent);return rS(this.base,e)};e.type="log";return e}(cw);var aS=nS.prototype;aS.getMinorTicks=Qw.getMinorTicks;aS.getLabel=Qw.getLabel;function oS(e,t){return $w(e,Xn(t))}cw.registerClass(nS);var sS=function(){function e(e,t,r){this._prepareParams(e,t,r)}e.prototype._prepareParams=function(e,t,r){if(r[1]<r[0]){r=[NaN,NaN]}this._dataMin=r[0];this._dataMax=r[1];var i=this._isOrdinal=e.type==="ordinal";this._needCrossZero=t.getNeedCrossZero&&t.getNeedCrossZero();var n=this._modelMinRaw=t.get("min",true);if(b(n)){this._modelMinNum=fS(e,n({min:r[0],max:r[1]}))}else if(n!=="dataMin"){this._modelMinNum=fS(e,n)}var a=this._modelMaxRaw=t.get("max",true);if(b(a)){this._modelMaxNum=fS(e,a({min:r[0],max:r[1]}))}else if(a!=="dataMax"){this._modelMaxNum=fS(e,a)}if(i){this._axisDataLen=t.getCategories().length}else{var o=t.get("boundaryGap");var s=k(o)?o:[o||0,o||0];if(typeof s[0]==="boolean"||typeof s[1]==="boolean"){if("development"!=="production"){console.warn("Boolean type for boundaryGap is only "+"allowed for ordinal axis. Please use string in "+'percentage instead, e.g., "20%". Currently, '+"boundaryGap is set to be 0.")}this._boundaryGapInner=[0,0]}else{this._boundaryGapInner=[yn(s[0],1),yn(s[1],1)]}}};e.prototype.calculate=function(){var e=this._isOrdinal;var t=this._dataMin;var r=this._dataMax;var i=this._axisDataLen;var n=this._boundaryGapInner;var a=!e?r-t||Math.abs(t):null;var o=this._modelMinRaw==="dataMin"?t:this._modelMinNum;var s=this._modelMaxRaw==="dataMax"?r:this._modelMaxNum;var l=o!=null;var u=s!=null;if(o==null){o=e?i?0:NaN:t-n[0]*a}if(s==null){s=e?i?i-1:NaN:r+n[1]*a}(o==null||!isFinite(o))&&(o=NaN);(s==null||!isFinite(s))&&(s=NaN);if(o>s){o=NaN;s=NaN}var c=_e(o)||_e(s)||e&&!i;if(this._needCrossZero){if(o>0&&s>0&&!l){o=0}if(o<0&&s<0&&!u){s=0}}var f=this._determinedMin;var h=this._determinedMax;if(f!=null){o=f;l=true}if(h!=null){s=h;u=true}return{min:o,max:s,minFixed:l,maxFixed:u,isBlank:c}};e.prototype.modifyDataMinMax=function(e,t){if("development"!=="production"){E(!this.frozen)}this[uS[e]]=t};e.prototype.setDeterminedMinMax=function(e,t){var r=lS[e];if("development"!=="production"){E(!this.frozen&&this[r]==null)}this[r]=t};e.prototype.freeze=function(){this.frozen=true};return e}();var lS={min:"_determinedMin",max:"_determinedMax"};var uS={min:"_dataMin",max:"_dataMax"};function cS(e,t,r){var i=e.rawExtentInfo;if(i){return i}i=new sS(e,t,r);e.rawExtentInfo=i;return i}function fS(e,t){return t==null?null:_e(t)?NaN:e.parse(t)}function hS(e,t){var r=e.type;var i=cS(e,t,e.getExtent()).calculate();e.setBlank(i.isBlank);var n=i.min;var a=i.max;var o=t.ecModel;if(o&&r==="time"){var s=Lw("bar",o);var l=false;U(s,function(e){l=l||e.getBaseAxis()===t.axis});if(l){var u=Pw(s);var c=pS(n,a,t,u);n=c.min;a=c.max}}return{extent:[n,a],fixMin:i.minFixed,fixMax:i.maxFixed}}function pS(e,t,r,i){var n=r.axis.getExtent();var a=n[1]-n[0];var o=Nw(i,r.axis);if(o===undefined){return{min:e,max:t}}var s=Infinity;U(o,function(e){s=Math.min(e.offset,s)});var l=-Infinity;U(o,function(e){l=Math.max(e.offset+e.width,l)});s=Math.abs(s);l=Math.abs(l);var u=s+l;var c=t-e;var f=1-(s+l)/a;var h=c/f-c;t+=h*(l/u);e-=h*(s/u);return{min:e,max:t}}function vS(e,t){var r=hS(e,t);var i=r.extent;var n=t.get("splitNumber");if(e instanceof nS){e.base=t.get("logBase")}var a=e.type;e.setExtent(i[0],i[1]);e.niceExtent({splitNumber:n,fixMin:r.fixMin,fixMax:r.fixMax,minInterval:a==="interval"||a==="time"?t.get("minInterval"):null,maxInterval:a==="interval"||a==="time"?t.get("maxInterval"):null});var o=t.get("interval");if(o!=null){e.setInterval&&e.setInterval(o)}}function dS(e,t){t=t||e.get("type");if(t){switch(t){case"category":return new bw({ordinalMeta:e.getOrdinalMeta?e.getOrdinalMeta():e.getCategories(),extent:[Infinity,-Infinity]});case"time":return new Fw({locale:e.ecModel.getLocaleModel(),useUTC:e.ecModel.get("useUTC")});default:return new(cw.getClass(t)||Sw)}}}function gS(e){var t=e.scale.getExtent();var r=t[0];var i=t[1];return!(r>0&&i>0||r<0&&i<0)}function yS(n){var e=n.getLabelModel().get("formatter");var i=n.type==="category"?n.scale.getExtent()[0]:null;if(n.scale.type==="time"){return function(r){return function(e,t){return n.scale.getFormattedLabel(e,t,r)}}(e)}else if(typeof e==="string"){return function(i){return function(e){var t=n.scale.getLabel(e);var r=i.replace("{value}",t!=null?t:"");return r}}(e)}else if(typeof e==="function"){return function(r){return function(e,t){if(i!=null){t=e.value-i}return r(mS(n,e),t,e.level!=null?{level:e.level}:null)}}(e)}else{return function(e){return n.scale.getLabel(e)}}}function mS(e,t){return e.type==="category"?e.scale.getLabel(t):t.value}function xS(e){var t=e.model;var r=e.scale;if(!t.get(["axisLabel","show"])||r.isBlank()){return}var i;var n;var a=r.getExtent();if(r instanceof bw){n=r.count()}else{i=r.getTicks();n=i.length}var o=e.getLabelModel();var s=yS(e);var l;var u=1;if(n>40){u=Math.ceil(n/40)}for(var c=0;c<n;c+=u){var f=i?i[c]:{value:a[0]+c};var h=s(f,c);var p=o.getTextRect(h);var v=_S(p,o.get("rotate")||0);l?l.union(v):l=v}return l}function _S(e,t){var r=t*Math.PI/180;var i=e.width;var n=e.height;var a=i*Math.abs(Math.cos(r))+Math.abs(n*Math.sin(r));var o=i*Math.abs(Math.sin(r))+Math.abs(n*Math.cos(r));var s=new B(e.x,e.y,a,o);return s}function bS(e){var t=e.get("interval");return t==null?"auto":t}function wS(e){return e.type==="category"&&bS(e.getLabelModel())===0}function SS(t,e){var r={};U(t.mapDimensionsAll(e),function(e){r[ow(t,e)]=true});return L(r)}function MS(r,i,e){if(i){U(SS(i,e),function(e){var t=i.getApproximateExtent(e);t[0]<r[0]&&(r[0]=t[0]);t[1]>r[1]&&(r[1]=t[1])})}}var IS=function(){function e(){}e.prototype.getNeedCrossZero=function(){var e=this.option;return!e.scale};e.prototype.getCoordSysModel=function(){return};return e}();function CS(e){return sw(e.getSource(),e)}var TS={isDimensionStacked:aw,enableDataStack:nw,getStackedDimension:ow};function DS(e,t){var r=t;if(!(t instanceof C)){r=new C(t)}var i=dS(r);i.setExtent(e[0],e[1]);vS(i,r);return i}function AS(e){oe(e,IS)}function LS(e,t){t=t||{};return _h(e,null,null,t.state!=="normal")}var kS=Object.freeze({__proto__:null,createList:CS,getLayoutRect:sv,dataStack:TS,createScale:DS,mixinAxisModelCommonMethods:AS,getECData:j,createTextStyle:LS,createDimensions:$b,createSymbol:S0,enableHoverEmphasis:tc});var PS=Object.freeze({__proto__:null,linearMap:V,round:Zn,asc:Yn,getPrecision:Xn,getPrecisionSafe:qn,getPixelPrecision:Jn,getPercentWithPrecision:Kn,MAX_SAFE_INTEGER:$n,remRadian:ea,isRadianAroundZero:ta,parseDate:ia,quantity:na,quantityExponent:aa,nice:oa,quantile:sa,reformIntervals:la,isNumeric:ca,numericToNumber:ua});var OS=Object.freeze({__proto__:null,parse:ia,format:mp});var NS=Object.freeze({__proto__:null,extendShape:Ef,extendPath:zf,makePath:Gf,makeImage:Ff,mergePath:Wf,resizePath:jf,createIcon:lh,updateProps:X,initProps:qf,getTransform:eh,clipPointsByRect:oh,clipRectByRect:sh,registerShape:Bf,getShapeClass:Vf,Group:H,Image:Rl,Text:W,Circle:Rc,Ellipse:Bc,Sector:ef,Ring:rf,Polygon:uf,Polyline:ff,Rect:G,Line:vf,BezierCurve:mf,Arc:_f,IncrementalDisplayable:kf,CompoundPath:bf,LinearGradient:Sf,RadialGradient:Mf,BoundingRect:B});var ES=Object.freeze({__proto__:null,addCommas:zp,toCamelCase:Bp,normalizeCssArray:Vp,encodeHTML:Hp,formatTpl:Zp,getTooltipMarker:Xp,formatTime:qp,capitalFirst:Jp,truncateText:Po,getTextRect:Rp});var RS=Object.freeze({__proto__:null,map:A,each:U,indexOf:D,inherits:ae,reduce:le,filter:ue,bind:x,curry:_,isArray:k,isString:P,isObject:O,isFunction:b,extend:F,defaults:R,clone:M,merge:y});var zS=qa();function BS(e){return e.type==="category"?GS(e):WS(e)}function VS(e,t){return e.type==="category"?HS(e,t):{ticks:A(e.scale.getTicks(),function(e){return e.value})}}function GS(e){var t=e.getLabelModel();var r=FS(e,t);return!t.get("show")||e.scale.isBlank()?{labels:[],labelCategoryInterval:r.labelCategoryInterval}:r}function FS(e,t){var r=jS(e,"labels");var i=bS(t);var n=US(r,i);if(n){return n}var a;var o;if(b(i)){a=KS(e,i)}else{o=i==="auto"?YS(e):i;a=JS(e,o)}return ZS(r,i,{labels:a,labelCategoryInterval:o})}function HS(e,t){var r=jS(e,"ticks");var i=bS(t);var n=US(r,i);if(n){return n}var a;var o;if(!t.get("show")||e.scale.isBlank()){a=[]}if(b(i)){a=KS(e,i,true)}else if(i==="auto"){var s=FS(e,e.getLabelModel());o=s.labelCategoryInterval;a=A(s.labels,function(e){return e.tickValue})}else{o=i;a=JS(e,o,true)}return ZS(r,i,{ticks:a,tickCategoryInterval:o})}function WS(r){var e=r.scale.getTicks();var i=yS(r);return{labels:A(e,function(e,t){return{formattedLabel:i(e,t),rawLabel:r.scale.getLabel(e),tickValue:e.value}})}}function jS(e,t){return zS(e)[t]||(zS(e)[t]=[])}function US(e,t){for(var r=0;r<e.length;r++){if(e[r].key===t){return e[r].value}}}function ZS(e,t,r){e.push({key:t,value:r});return r}function YS(e){var t=zS(e).autoInterval;return t!=null?t:zS(e).autoInterval=e.calculateCategoryInterval()}function XS(e){var t=qS(e);var r=yS(e);var i=(t.axisRotate-t.labelRotate)/180*Math.PI;var n=e.scale;var a=n.getExtent();var o=n.count();if(a[1]-a[0]<1){return 0}var s=1;if(o>40){s=Math.max(1,Math.floor(o/40))}var l=a[0];var u=e.dataToCoord(l+1)-e.dataToCoord(l);var c=Math.abs(u*Math.cos(i));var f=Math.abs(u*Math.sin(i));var h=0;var p=0;for(;l<=a[1];l+=s){var v=0;var d=0;var g=pn(r({value:l}),t.font,"center","top");v=g.width*1.3;d=g.height*1.3;h=Math.max(h,v,7);p=Math.max(p,d,7)}var y=h/c;var m=p/f;isNaN(y)&&(y=Infinity);isNaN(m)&&(m=Infinity);var x=Math.max(0,Math.floor(Math.min(y,m)));var _=zS(e.model);var b=e.getExtent();var w=_.lastAutoInterval;var S=_.lastTickCount;if(w!=null&&S!=null&&Math.abs(w-x)<=1&&Math.abs(S-o)<=1&&w>x&&_.axisExtent0===b[0]&&_.axisExtent1===b[1]){x=w}else{_.lastTickCount=o;_.lastAutoInterval=x;_.axisExtent0=b[0];_.axisExtent1=b[1]}return x}function qS(e){var t=e.getLabelModel();return{axisRotate:e.getRotate?e.getRotate():e.isHorizontal&&!e.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function JS(e,t,r){var i=yS(e);var n=e.scale;var a=n.getExtent();var o=e.getLabelModel();var s=[];var l=Math.max((t||0)+1,1);var u=a[0];var c=n.count();if(u!==0&&l>1&&c/l>2){u=Math.round(Math.ceil(u/l)*l)}var f=wS(e);var h=o.get("showMinLabel")||f;var p=o.get("showMaxLabel")||f;if(h&&u!==a[0]){d(a[0])}var v=u;for(;v<=a[1];v+=l){d(v)}if(p&&v-l!==a[1]){d(a[1])}function d(e){var t={value:e};s.push(r?e:{formattedLabel:i(t),rawLabel:n.getLabel(t),tickValue:e})}return s}function KS(e,i,n){var a=e.scale;var o=yS(e);var s=[];U(a.getTicks(),function(e){var t=a.getLabel(e);var r=e.value;if(i(e.value,t)){s.push(n?r:{formattedLabel:o(e),rawLabel:t,tickValue:r})}});return s}var QS=[0,1];var $S=function(){function e(e,t,r){this.onBand=false;this.inverse=false;this.dim=e;this.scale=t;this._extent=r||[0,0]}e.prototype.contain=function(e){var t=this._extent;var r=Math.min(t[0],t[1]);var i=Math.max(t[0],t[1]);return e>=r&&e<=i};e.prototype.containData=function(e){return this.scale.contain(e)};e.prototype.getExtent=function(){return this._extent.slice()};e.prototype.getPixelPrecision=function(e){return Jn(e||this.scale.getExtent(),this._extent)};e.prototype.setExtent=function(e,t){var r=this._extent;r[0]=e;r[1]=t};e.prototype.dataToCoord=function(e,t){var r=this._extent;var i=this.scale;e=i.normalize(e);if(this.onBand&&i.type==="ordinal"){r=r.slice();eM(r,i.count())}return V(e,QS,r,t)};e.prototype.coordToData=function(e,t){var r=this._extent;var i=this.scale;if(this.onBand&&i.type==="ordinal"){r=r.slice();eM(r,i.count())}var n=V(e,r,QS,t);return this.scale.scale(n)};e.prototype.pointToData=function(e,t){return};e.prototype.getTicksCoords=function(e){e=e||{};var t=e.tickModel||this.getTickModel();var r=VS(this,t);var i=r.ticks;var n=A(i,function(e){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(e):e),tickValue:e}},this);var a=t.get("alignWithLabel");tM(this,n,a,e.clamp);return n};e.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal"){return[]}var e=this.model.getModel("minorTick");var t=e.get("splitNumber");if(!(t>0&&t<100)){t=5}var r=this.scale.getMinorTicks(t);var i=A(r,function(e){return A(e,function(e){return{coord:this.dataToCoord(e),tickValue:e}},this)},this);return i};e.prototype.getViewLabels=function(){return BS(this).labels};e.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")};e.prototype.getTickModel=function(){return this.model.getModel("axisTick")};e.prototype.getBandWidth=function(){var e=this._extent;var t=this.scale.getExtent();var r=t[1]-t[0]+(this.onBand?1:0);r===0&&(r=1);var i=Math.abs(e[1]-e[0]);return Math.abs(i)/r};e.prototype.calculateCategoryInterval=function(){return XS(this)};return e}();function eM(e,t){var r=e[1]-e[0];var i=t;var n=r/i/2;e[0]+=n;e[1]-=n}function tM(e,t,r,i){var n=t.length;if(!e.onBand||r||!n){return}var a=e.getExtent();var o;var s;if(n===1){t[0].coord=a[0];o=t[1]={coord:a[0]}}else{var l=t[n-1].tickValue-t[0].tickValue;var u=(t[n-1].coord-t[0].coord)/l;U(t,function(e){e.coord-=u/2});var c=e.scale.getExtent();s=1+c[1]-t[n-1].tickValue;o={coord:t[n-1].coord+u*s};t.push(o)}var f=a[0]>a[1];if(h(t[0].coord,a[0])){i?t[0].coord=a[0]:t.shift()}if(i&&h(a[0],t[0].coord)){t.unshift({coord:a[0]})}if(h(a[1],o.coord)){i?o.coord=a[1]:t.pop()}if(i&&h(o.coord,a[1])){t.push({coord:a[1]})}function h(e,t){e=Zn(e);t=Zn(t);return f?e>t:e<t}}function rM(e){var t=p.extend(e);p.registerClass(t);return t}function iM(e){var t=My.extend(e);My.registerClass(t);return t}function nM(e){var t=dy.extend(e);dy.registerClass(t);return t}function aM(e){var t=v.extend(e);v.registerClass(t);return t}function oM(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function sM(s,l,u){if(!u){u=function(e,t){return e===t}}s=s.slice();l=l.slice();var c=l.length;var f=s.length;var h=1;var e=c+f;var p=[{newPos:-1,components:[]}];var t=lM(p[0],l,s,0,u);if(p[0].newPos+1>=c&&t+1>=f){var r=[];for(var i=0;i<l.length;i++){r.push(i)}return[{indices:r,count:l.length,added:false,removed:false}]}function n(){for(var e=-1*h;e<=h;e+=2){var t;var r=p[e-1];var i=p[e+1];var n=(i?i.newPos:0)-e;if(r){p[e-1]=undefined}var a=r&&r.newPos+1<c;var o=i&&0<=n&&n<f;if(!a&&!o){p[e]=undefined;continue}if(!a||o&&r.newPos<i.newPos){t=fM(i);uM(t.components,false,true)}else{t=r;t.newPos++;uM(t.components,true,false)}n=lM(t,l,s,e,u);if(t.newPos+1>=c&&n+1>=f){return cM(t.components)}else{p[e]=t}}h++}while(h<=e){var a=n();if(a){return a}}}function lM(e,t,r,i,n){var a=t.length;var o=r.length;var s=e.newPos;var l=s-i;var u=0;while(s+1<a&&l+1<o&&n(t[s+1],r[l+1])){s++;l++;u++}if(u){e.components.push({count:u,added:false,removed:false,indices:[]})}e.newPos=s;return l}function uM(e,t,r){var i=e[e.length-1];if(i&&i.added===t&&i.removed===r){e[e.length-1]={count:i.count+1,added:t,removed:r,indices:[]}}else{e.push({count:1,added:t,removed:r,indices:[]})}}function cM(e){var t=0;var r=e.length;var i=0;var n=0;for(;t<r;t++){var a=e[t];if(!a.removed){var o=[];for(var s=i;s<i+a.count;s++){o.push(s)}a.indices=o;i+=a.count;if(!a.added){n+=a.count}}else{for(var s=n;s<n+a.count;s++){a.indices.push(s)}n+=a.count}}return e}function fM(e){return{newPos:e.newPos,components:e.components.slice(0)}}function hM(e,t,r){return sM(e,t,r)}var pM="none";var vM=Math.round;var dM=Math.sin;var gM=Math.cos;var yM=Math.PI;var mM=Math.PI*2;var xM=180/yM;var _M=1e-4;function bM(e){return vM(e*1e3)/1e3}function wM(e){return vM(e*1e4)/1e4}function SM(e){return e<_M&&e>-_M}function MM(e){var t=e.fill;return t!=null&&t!==pM}function IM(e){var t=e.stroke;return t!=null&&t!==pM}function CM(e,t){if(t){TM(e,"transform","matrix("+bM(t[0])+","+bM(t[1])+","+bM(t[2])+","+bM(t[3])+","+wM(t[4])+","+wM(t[5])+")")}}function TM(e,t,r){if(!r||r.type!=="linear"&&r.type!=="radial"){e.setAttribute(t,r)}}function DM(e,t,r){e.setAttributeNS("http://www.w3.org/1999/xlink",t,r)}function AM(e,t,r){e.setAttributeNS("http://www.w3.org/XML/1998/namespace",t,r)}function LM(e,t,r){var i=t.opacity==null?1:t.opacity;if(r instanceof Rl){e.style.opacity=i+"";return}if(MM(t)){var n=t.fill;n=n==="transparent"?pM:n;TM(e,"fill",n);TM(e,"fill-opacity",(t.fillOpacity!=null?t.fillOpacity*i:i)+"")}else{TM(e,"fill",pM)}if(IM(t)){var a=t.stroke;a=a==="transparent"?pM:a;TM(e,"stroke",a);var o=t.lineWidth;var s=t.strokeNoScale?r.getLineScale():1;TM(e,"stroke-width",(s?o/s:0)+"");TM(e,"paint-order",t.strokeFirst?"stroke":"fill");TM(e,"stroke-opacity",(t.strokeOpacity!=null?t.strokeOpacity*i:i)+"");var l=t.lineDash&&o>0&&D0(t.lineDash,o);if(l){var u=t.lineDashOffset;if(s&&s!==1){l=A(l,function(e){return e/s});if(u){u/=s;u=vM(u)}}TM(e,"stroke-dasharray",l.join(","));TM(e,"stroke-dashoffset",(u||0)+"")}else{TM(e,"stroke-dasharray","")}t.lineCap&&TM(e,"stroke-linecap",t.lineCap);t.lineJoin&&TM(e,"stroke-linejoin",t.lineJoin);t.miterLimit&&TM(e,"stroke-miterlimit",t.miterLimit+"")}else{TM(e,"stroke",pM)}}var kM=function(){function e(){}e.prototype.reset=function(){this._d=[];this._str=""};e.prototype.moveTo=function(e,t){this._add("M",e,t)};e.prototype.lineTo=function(e,t){this._add("L",e,t)};e.prototype.bezierCurveTo=function(e,t,r,i,n,a){this._add("C",e,t,r,i,n,a)};e.prototype.quadraticCurveTo=function(e,t,r,i){this._add("Q",e,t,r,i)};e.prototype.arc=function(e,t,r,i,n,a){this.ellipse(e,t,r,r,0,i,n,a)};e.prototype.ellipse=function(e,t,r,i,n,a,o,s){var l=this._d.length===0;var u=o-a;var c=!s;var f=Math.abs(u);var h=SM(f-mM)||(c?u>=mM:-u>=mM);var p=u>0?u%mM:u%mM+mM;var v=false;if(h){v=true}else if(SM(f)){v=false}else{v=p>=yM===!!c}var d=wM(e+r*gM(a));var g=wM(t+i*dM(a));if(h){if(c){u=mM-1e-4}else{u=-mM+1e-4}v=true;if(l){this._d.push("M",d,g)}}var y=wM(e+r*gM(a+u));var m=wM(t+i*dM(a+u));if(isNaN(d)||isNaN(g)||isNaN(r)||isNaN(i)||isNaN(n)||isNaN(xM)||isNaN(y)||isNaN(m)){return""}this._d.push("A",wM(r),wM(i),vM(n*xM),+v,+c,y,m)};e.prototype.rect=function(e,t,r,i){this._add("M",e,t);this._add("L",e+r,t);this._add("L",e+r,t+i);this._add("L",e,t+i);this._add("L",e,t)};e.prototype.closePath=function(){if(this._d.length>0){this._add("Z")}};e.prototype._add=function(e,t,r,i,n,a,o,s,l){this._d.push(e);for(var u=1;u<arguments.length;u++){var c=arguments[u];if(isNaN(c)){this._invalid=true;return}this._d.push(wM(c))}};e.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(" ");this._d=[]};e.prototype.getStr=function(){return this._str};return e}();var PM={brush:function(e){var t=e.style;var r=e.__svgEl;if(!r){r=oM("path");e.__svgEl=r}if(!e.path){e.createPathProxy()}var i=e.path;if(e.shapeChanged()){i.beginPath();e.buildPath(i,e.shape);e.pathUpdated()}var n=i.getVersion();var a=e;var o=a.__svgPathBuilder;if(a.__svgPathVersion!==n||!o||e.style.strokePercent<1){if(!o){o=a.__svgPathBuilder=new kM}o.reset();i.rebuildPath(o,e.style.strokePercent);o.generateStr();a.__svgPathVersion=n}TM(r,"d",o.getStr());LM(r,t,e);CM(r,e.transform)}};var OM={brush:function(e){var t=e.style;var r=t.image;if(r instanceof HTMLImageElement){r=r.src}else if(r instanceof HTMLCanvasElement){r=r.toDataURL()}if(!r){return}var i=t.x||0;var n=t.y||0;var a=t.width;var o=t.height;var s=e.__svgEl;if(!s){s=oM("image");e.__svgEl=s}if(r!==e.__imageSrc){DM(s,"href",r);e.__imageSrc=r}TM(s,"width",a+"");TM(s,"height",o+"");TM(s,"x",i+"");TM(s,"y",n+"");LM(s,t,e);CM(s,e.transform)}};var NM={left:"start",right:"end",center:"middle",middle:"middle"};function EM(e,t,r){if(r==="top"){e+=t/2}else if(r==="bottom"){e-=t/2}return e}var RM={brush:function(e){var t=e.style;var r=t.text;r!=null&&(r+="");if(!r||isNaN(t.x)||isNaN(t.y)){return}var i=e.__svgEl;if(!i){i=oM("text");AM(i,"xml:space","preserve");e.__svgEl=i}var n=t.font||on;var a=i.style;a.font=n;i.textContent=r;LM(i,t,e);CM(i,e.transform);var o=t.x||0;var s=EM(t.y||0,gn(n),t.textBaseline);var l=NM[t.textAlign]||t.textAlign;TM(i,"dominant-baseline","central");TM(i,"text-anchor",l);TM(i,"x",o+"");TM(i,"y",s+"")}};var zM="0";var BM="1";var VM=function(){function e(e,t,r,i,n){this.nextId=0;this._domName="_dom";this.createElement=oM;this._zrId=e;this._svgRoot=t;this._tagNames=typeof r==="string"?[r]:r;this._markLabel=i;if(n){this._domName=n}}e.prototype.getDefs=function(e){var t=this._svgRoot;var r=this._svgRoot.getElementsByTagName("defs");if(r.length===0){if(e){var i=t.insertBefore(this.createElement("defs"),t.firstChild);if(!i.contains){i.contains=function(e){var t=i.children;if(!t){return false}for(var r=t.length-1;r>=0;--r){if(t[r]===e){return true}}return false}}return i}else{return null}}else{return r[0]}};e.prototype.doUpdate=function(e,t){if(!e){return}var r=this.getDefs(false);if(e[this._domName]&&r.contains(e[this._domName])){if(typeof t==="function"){t(e)}}else{var i=this.add(e);if(i){e[this._domName]=i}}};e.prototype.add=function(e){return null};e.prototype.addDom=function(e){var t=this.getDefs(true);if(e.parentNode!==t){t.appendChild(e)}};e.prototype.removeDom=function(e){var t=this.getDefs(false);if(t&&e[this._domName]){t.removeChild(e[this._domName]);e[this._domName]=null}};e.prototype.getDoms=function(){var i=this.getDefs(false);if(!i){return[]}var n=[];U(this._tagNames,function(e){var t=i.getElementsByTagName(e);for(var r=0;r<t.length;r++){n.push(t[r])}});return n};e.prototype.markAllUnused=function(){var e=this.getDoms();var t=this;U(e,function(e){e[t._markLabel]=zM})};e.prototype.markDomUsed=function(e){e&&(e[this._markLabel]=BM)};e.prototype.markDomUnused=function(e){e&&(e[this._markLabel]=zM)};e.prototype.isDomUnused=function(e){return e&&e[this._markLabel]!==BM};e.prototype.removeUnused=function(){var t=this;var r=this.getDefs(false);if(!r){return}var e=this.getDoms();U(e,function(e){if(t.isDomUnused(e)){r.removeChild(e)}})};e.prototype.getSvgProxy=function(e){if(e instanceof m){return PM}else if(e instanceof Rl){return OM}else if(e instanceof Pl){return RM}else{return PM}};e.prototype.getSvgElement=function(e){return e.__svgEl};return e}();function GM(e){return e.type==="linear"}function FM(e){return e.type==="radial"}function HM(e){return e&&(e.type==="linear"||e.type==="radial")}var WM=function(r){d(e,r);function e(e,t){return r.call(this,e,t,["linearGradient","radialGradient"],"__gradient_in_use__")||this}e.prototype.addWithoutUpdate=function(o,s){if(s&&s.style){var l=this;U(["fill","stroke"],function(e){var t=s.style[e];if(HM(t)){var r=t;var i=l.getDefs(true);var n=void 0;if(r.__dom){n=r.__dom;if(!i.contains(r.__dom)){l.addDom(n)}}else{n=l.add(r)}l.markUsed(s);var a=n.getAttribute("id");o.setAttribute(e,"url(#"+a+")")}})}};e.prototype.add=function(e){var t;if(GM(e)){t=this.createElement("linearGradient")}else if(FM(e)){t=this.createElement("radialGradient")}else{re("Illegal gradient type.");return null}e.id=e.id||this.nextId++;t.setAttribute("id","zr"+this._zrId+"-gradient-"+e.id);this.updateDom(e,t);this.addDom(t);return t};e.prototype.update=function(i){if(!HM(i)){return}var n=this;this.doUpdate(i,function(){var e=i.__dom;if(!e){return}var t=e.tagName;var r=i.type;if(r==="linear"&&t==="linearGradient"||r==="radial"&&t==="radialGradient"){n.updateDom(i,i.__dom)}else{n.removeDom(i);n.add(i)}})};e.prototype.updateDom=function(e,t){if(GM(e)){t.setAttribute("x1",e.x+"");t.setAttribute("y1",e.y+"");t.setAttribute("x2",e.x2+"");t.setAttribute("y2",e.y2+"")}else if(FM(e)){t.setAttribute("cx",e.x+"");t.setAttribute("cy",e.y+"");t.setAttribute("r",e.r+"")}else{re("Illegal gradient type.");return}if(e.global){t.setAttribute("gradientUnits","userSpaceOnUse")}else{t.setAttribute("gradientUnits","objectBoundingBox")}t.innerHTML="";var r=e.colorStops;for(var i=0,n=r.length;i<n;++i){var a=this.createElement("stop");a.setAttribute("offset",r[i].offset*100+"%");var o=r[i].color;if(o.indexOf("rgba")>-1){var s=Tr(o)[3];var l=kr(o);a.setAttribute("stop-color","#"+l);a.setAttribute("stop-opacity",s+"")}else{a.setAttribute("stop-color",r[i].color)}t.appendChild(a)}e.__dom=t};e.prototype.markUsed=function(e){if(e.style){var t=e.style.fill;if(t&&t.__dom){r.prototype.markDomUsed.call(this,t.__dom)}t=e.style.stroke;if(t&&t.__dom){r.prototype.markDomUsed.call(this,t.__dom)}}};return e}(VM);function jM(e){return e&&(!!e.image||!!e.svgElement)}var UM=new p0;var ZM=function(r){d(e,r);function e(e,t){return r.call(this,e,t,["pattern"],"__pattern_in_use__")||this}e.prototype.addWithoutUpdate=function(a,o){if(o&&o.style){var s=this;U(["fill","stroke"],function(e){var t=o.style[e];if(jM(t)){var r=s.getDefs(true);var i=UM.get(t);if(i){if(!r.contains(i)){s.addDom(i)}}else{i=s.add(t)}s.markUsed(o);var n=i.getAttribute("id");a.setAttribute(e,"url(#"+n+")")}})}};e.prototype.add=function(e){if(!jM(e)){return}var t=this.createElement("pattern");e.id=e.id==null?this.nextId++:e.id;t.setAttribute("id","zr"+this._zrId+"-pattern-"+e.id);t.setAttribute("x","0");t.setAttribute("y","0");t.setAttribute("patternUnits","userSpaceOnUse");this.updateDom(e,t);this.addDom(t);return t};e.prototype.update=function(t){if(!jM(t)){return}var r=this;this.doUpdate(t,function(){var e=UM.get(t);r.updateDom(t,e)})};e.prototype.updateDom=function(e,t){var r=e.svgElement;if(r instanceof SVGElement){if(r.parentNode!==t){t.innerHTML="";t.appendChild(r);t.setAttribute("width",e.svgWidth+"");t.setAttribute("height",e.svgHeight+"")}}else{var i=void 0;var n=t.getElementsByTagName("image");if(n.length){if(e.image){i=n[0]}else{t.removeChild(n[0]);return}}else if(e.image){i=this.createElement("image")}if(i){var a=void 0;var o=e.image;if(typeof o==="string"){a=o}else if(o instanceof HTMLImageElement){a=o.src}else if(o instanceof HTMLCanvasElement){a=o.toDataURL()}if(a){i.setAttribute("href",a);i.setAttribute("x","0");i.setAttribute("y","0");var s={dirty:function(){}};var l=Do(a,i,s,function(e){t.setAttribute("width",e.width+"");t.setAttribute("height",e.height+"")});if(l&&l.width&&l.height){t.setAttribute("width",l.width+"");t.setAttribute("height",l.height+"")}t.appendChild(i)}}}var u=e.x||0;var c=e.y||0;var f=(e.rotation||0)/Math.PI*180;var h=e.scaleX||1;var p=e.scaleY||1;var v="translate("+u+", "+c+") rotate("+f+") scale("+h+", "+p+")";t.setAttribute("patternTransform",v);UM.set(e,t)};e.prototype.markUsed=function(e){if(e.style){if(jM(e.style.fill)){r.prototype.markDomUsed.call(this,UM.get(e.style.fill))}if(jM(e.style.stroke)){r.prototype.markDomUsed.call(this,UM.get(e.style.stroke))}}};return e}(VM);function YM(e){var t=[];if(e){for(var r=0;r<e.length;r++){var i=e[r];t.push(i.id)}}return t.join(",")}function XM(e){var t=e.__clipPaths;return t&&t.length>0}var qM=function(i){d(e,i);function e(e,t){var r=i.call(this,e,t,"clipPath","__clippath_in_use__")||this;r._refGroups={};r._keyDuplicateCount={};return r}e.prototype.markAllUnused=function(){i.prototype.markAllUnused.call(this);for(var e in this._refGroups){this.markDomUnused(this._refGroups[e])}this._keyDuplicateCount={}};e.prototype._getClipPathGroup=function(e,t){if(!XM(e)){return}var r=e.__clipPaths;var i=this._keyDuplicateCount;var n=YM(r);if(T0(r,t&&t.__clipPaths)){i[n]=i[n]||0;i[n]&&(n+="-"+i[n]);i[n]++}return this._refGroups[n]||(this._refGroups[n]=this.createElement("g"))};e.prototype.update=function(e,t){var r=this._getClipPathGroup(e,t);if(r){this.markDomUsed(r);this.updateDom(r,e.__clipPaths)}return r};e.prototype.updateDom=function(e,t){if(t&&t.length>0){var r=this.getDefs(true);var i=t[0];var n=void 0;var a=void 0;if(i._dom){a=i._dom.getAttribute("id");n=i._dom;if(!r.contains(n)){r.appendChild(n)}}else{a="zr"+this._zrId+"-clip-"+this.nextId;++this.nextId;n=this.createElement("clipPath");n.setAttribute("id",a);r.appendChild(n);i._dom=n}var o=this.getSvgProxy(i);o.brush(i);var s=this.getSvgElement(i);n.innerHTML="";n.appendChild(s);e.setAttribute("clip-path","url(#"+a+")");if(t.length>1){this.updateDom(n,t.slice(1))}}else{if(e){e.setAttribute("clip-path","none")}}};e.prototype.markUsed=function(e){var t=this;if(e.__clipPaths){U(e.__clipPaths,function(e){if(e._dom){i.prototype.markDomUsed.call(t,e._dom)}})}};e.prototype.removeUnused=function(){i.prototype.removeUnused.call(this);var e={};for(var t in this._refGroups){var r=this._refGroups[t];if(!this.isDomUnused(r)){e[t]=r}else if(r.parentNode){r.parentNode.removeChild(r)}}this._refGroups=e};return e}(VM);var JM=function(i){d(e,i);function e(e,t){var r=i.call(this,e,t,["filter"],"__filter_in_use__","_shadowDom")||this;r._shadowDomMap={};r._shadowDomPool=[];return r}e.prototype._getFromPool=function(){var e=this._shadowDomPool.pop();if(!e){e=this.createElement("filter");e.setAttribute("id","zr"+this._zrId+"-shadow-"+this.nextId++);var t=this.createElement("feDropShadow");e.appendChild(t);this.addDom(e)}return e};e.prototype.update=function(e,t){var r=t.style;if(KM(r)){var i=QM(t);var n=t._shadowDom=this._shadowDomMap[i];if(!n){n=this._getFromPool();this._shadowDomMap[i]=n}this.updateDom(e,t,n)}else{this.remove(e,t)}};e.prototype.remove=function(e,t){if(t._shadowDom!=null){t._shadowDom=null;e.style.filter=""}};e.prototype.updateDom=function(e,t,r){var i=r.children[0];var n=t.style;var a=t.getGlobalScale();var o=a[0];var s=a[1];if(!o||!s){return}var l=n.shadowOffsetX||0;var u=n.shadowOffsetY||0;var c=n.shadowBlur;var f=n.shadowColor;i.setAttribute("dx",l/o+"");i.setAttribute("dy",u/s+"");i.setAttribute("flood-color",f);var h=c/2/o;var p=c/2/s;var v=h+" "+p;i.setAttribute("stdDeviation",v);r.setAttribute("x","-100%");r.setAttribute("y","-100%");r.setAttribute("width","300%");r.setAttribute("height","300%");t._shadowDom=r;var d=r.getAttribute("id");e.style.filter="url(#"+d+")"};e.prototype.removeUnused=function(){var e=this.getDefs(false);if(!e){return}var t=this._shadowDomPool;for(var r in this._shadowDomMap){var i=this._shadowDomMap[r];t.push(i)}this._shadowDomMap={}};return e}(VM);function KM(e){return e&&(e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)}function QM(e){var t=e.style;var r=e.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),r[0],r[1]].join(",")}function $M(e){return parseInt(e,10)}function eI(e){if(e instanceof m){return PM}else if(e instanceof Rl){return OM}else if(e instanceof Pl){return RM}else{return PM}}function tI(e,t){return t&&e&&t.parentNode!==e}function rI(e,t,r){if(tI(e,t)&&r){var i=r.nextSibling;i?e.insertBefore(t,i):e.appendChild(t)}}function iI(e,t){if(tI(e,t)){var r=e.firstChild;r?e.insertBefore(t,r):e.appendChild(t)}}function nI(e,t){if(t&&e&&t.parentNode===e){e.removeChild(t)}}function aI(e){if(e&&e.parentNode){e.parentNode.removeChild(e)}}function oI(e){return e.__svgEl}var sI=function(){function e(e,t,r,i){this.type="svg";this.refreshHover=lI("refreshHover");this.pathToImage=lI("pathToImage");this.configLayer=lI("configLayer");this.root=e;this.storage=t;this._opts=r=F({},r||{});var n=oM("svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");n.setAttribute("version","1.1");n.setAttribute("baseProfile","full");n.style.cssText="user-select:none;position:absolute;left:0;top:0;";var a=oM("g");n.appendChild(a);var o=oM("g");n.appendChild(o);this._gradientManager=new WM(i,o);this._patternManager=new ZM(i,o);this._clipPathManager=new qM(i,o);this._shadowManager=new JM(i,o);var s=document.createElement("div");s.style.cssText="overflow:hidden;position:relative";this._svgDom=n;this._svgRoot=o;this._backgroundRoot=a;this._viewport=s;e.appendChild(s);s.appendChild(n);this.resize(r.width,r.height);this._visibleList=[]}e.prototype.getType=function(){return"svg"};e.prototype.getViewportRoot=function(){return this._viewport};e.prototype.getSvgDom=function(){return this._svgDom};e.prototype.getSvgRoot=function(){return this._svgRoot};e.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e){return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}}};e.prototype.refresh=function(){var e=this.storage.getDisplayList(true);this._paintList(e)};e.prototype.setBackgroundColor=function(e){if(this._backgroundRoot&&this._backgroundNode){this._backgroundRoot.removeChild(this._backgroundNode)}var t=oM("rect");t.setAttribute("width",this.getWidth());t.setAttribute("height",this.getHeight());t.setAttribute("x",0);t.setAttribute("y",0);t.setAttribute("id",0);t.style.fill=e;this._backgroundRoot.appendChild(t);this._backgroundNode=t};e.prototype.createSVGElement=function(e){return oM(e)};e.prototype.paintOne=function(e){var t=eI(e);t&&t.brush(e);return oI(e)};e.prototype._paintList=function(e){var t=this._gradientManager;var r=this._patternManager;var i=this._clipPathManager;var n=this._shadowManager;t.markAllUnused();r.markAllUnused();i.markAllUnused();n.markAllUnused();var a=this._svgRoot;var o=this._visibleList;var s=e.length;var l=[];for(var u=0;u<s;u++){var c=e[u];var f=eI(c);var h=oI(c);if(!c.invisible){if(c.__dirty||!h){f&&f.brush(c);h=oI(c);if(h&&c.style){t.update(c.style.fill);t.update(c.style.stroke);r.update(c.style.fill);r.update(c.style.stroke);n.update(h,c)}c.__dirty=0}if(h){l.push(c)}}}var p=hM(o,l);var v;var d;for(var u=0;u<p.length;u++){var g=p[u];if(g.removed){for(var y=0;y<g.count;y++){var c=o[g.indices[y]];var h=oI(c);XM(c)?aI(h):nI(a,h)}}}var m;var x;for(var u=0;u<p.length;u++){var g=p[u];if(g.removed){continue}for(var y=0;y<g.count;y++){var c=l[g.indices[y]];var _=i.update(c,m);if(_!==x){v=d;if(_){v?rI(a,_,v):iI(a,_);d=_;v=null}x=_}var h=oI(c);v?rI(x||a,h,v):iI(x||a,h);v=h||v;if(!x){d=v}t.markUsed(c);t.addWithoutUpdate(h,c);r.markUsed(c);r.addWithoutUpdate(h,c);i.markUsed(c);m=c}}t.removeUnused();r.removeUnused();i.removeUnused();n.removeUnused();this._visibleList=l};e.prototype.resize=function(e,t){var r=this._viewport;r.style.display="none";var i=this._opts;e!=null&&(i.width=e);t!=null&&(i.height=t);e=this._getSize(0);t=this._getSize(1);r.style.display="";if(this._width!==e||this._height!==t){this._width=e;this._height=t;var n=r.style;n.width=e+"px";n.height=t+"px";var a=this._svgDom;a.setAttribute("width",e+"");a.setAttribute("height",t+"")}if(this._backgroundNode){this._backgroundNode.setAttribute("width",e);this._backgroundNode.setAttribute("height",t)}};e.prototype.getWidth=function(){return this._width};e.prototype.getHeight=function(){return this._height};e.prototype._getSize=function(e){var t=this._opts;var r=["width","height"][e];var i=["clientWidth","clientHeight"][e];var n=["paddingLeft","paddingTop"][e];var a=["paddingRight","paddingBottom"][e];if(t[r]!=null&&t[r]!=="auto"){return parseFloat(t[r])}var o=this.root;var s=document.defaultView.getComputedStyle(o);return(o[i]||$M(s[r])||$M(o.style[r]))-($M(s[n])||0)-($M(s[a])||0)|0};e.prototype.dispose=function(){this.root.innerHTML="";this._svgRoot=this._backgroundRoot=this._svgDom=this._backgroundNode=this._viewport=this.storage=null};e.prototype.clear=function(){var e=this._viewport;if(e&&e.parentNode){e.parentNode.removeChild(e)}};e.prototype.toDataURL=function(){this.refresh();var e=this._svgDom;var t=e.outerHTML||(e.parentNode&&e.parentNode).innerHTML;var r=encodeURIComponent(t.replace(/></g,">\n\r<"));return"data:image/svg+xml;charset=UTF-8,"+r};return e}();function lI(e){return function(){re('In SVG mode painter not support method "'+e+'"')}}function uI(e){e.registerPainter("svg",sI)}function cI(){return false}function fI(e,t,r){var i=ne();var n=t.getWidth();var a=t.getHeight();var o=i.style;if(o){o.position="absolute";o.left="0";o.top="0";o.width=n+"px";o.height=a+"px";i.setAttribute("data-zr-dom-id",e)}i.width=n*r;i.height=a*r;return i}var hI=function(o){d(e,o);function e(e,t,r){var i=o.call(this)||this;i.motionBlur=false;i.lastFrameAlpha=.7;i.dpr=1;i.virtual=false;i.config={};i.incremental=false;i.zlevel=0;i.maxRepaintRectCount=5;i.__dirty=true;i.__firstTimePaint=true;i.__used=false;i.__drawIndex=0;i.__startIndex=0;i.__endIndex=0;i.__prevStartIndex=null;i.__prevEndIndex=null;var n;r=r||Ti;if(typeof e==="string"){n=fI(e,t,r)}else if(O(e)){n=e;e=n.id}i.id=e;i.dom=n;var a=n.style;if(a){n.onselectstart=cI;a.webkitUserSelect="none";a.userSelect="none";a.webkitTapHighlightColor="rgba(0,0,0,0)";a["-webkit-touch-callout"]="none";a.padding="0";a.margin="0";a.borderWidth="0"}i.domBack=null;i.ctxBack=null;i.painter=t;i.config=null;i.dpr=r;return i}e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex};e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex;this.__prevEndIndex=this.__endIndex};e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d");this.ctx.dpr=this.dpr};e.prototype.setUnpainted=function(){this.__firstTimePaint=true};e.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=fI("back-"+this.id,this.painter,e);this.ctxBack=this.domBack.getContext("2d");if(e!==1){this.ctxBack.scale(e,e)}};e.prototype.createRepaintRects=function(e,t,r,i){if(this.__firstTimePaint){this.__firstTimePaint=false;return null}var h=[];var p=this.maxRepaintRectCount;var v=false;var d=new B(0,0,0,0);function n(e){if(!e.isFinite()||e.isZero()){return}if(h.length===0){var t=new B(0,0,0,0);t.copy(e);h.push(t)}else{var r=false;var i=Infinity;var n=0;for(var a=0;a<h.length;++a){var o=h[a];if(o.intersect(e)){var s=new B(0,0,0,0);s.copy(o);s.union(e);h[a]=s;r=true;break}else if(v){d.copy(e);d.union(o);var l=e.width*e.height;var u=o.width*o.height;var c=d.width*d.height;var f=c-l-u;if(f<i){i=f;n=a}}}if(v){h[n].union(e);r=true}if(!r){var t=new B(0,0,0,0);t.copy(e);h.push(t)}if(!v){v=h.length>=p}}}for(var a=this.__startIndex;a<this.__endIndex;++a){var o=e[a];if(o){var s=o.shouldBePainted(r,i,true,true);var l=o.__isRendered&&(o.__dirty&er||!s)?o.getPrevPaintRect():null;if(l){n(l)}var u=s&&(o.__dirty&er||!o.__isRendered)?o.getPaintRect():null;if(u){n(u)}}}for(var a=this.__prevStartIndex;a<this.__prevEndIndex;++a){var o=t[a];var s=o.shouldBePainted(r,i,true,true);if(o&&(!s||!o.__zr)&&o.__isRendered){var l=o.getPrevPaintRect();if(l){n(l)}}}var c;do{c=false;for(var a=0;a<h.length;){if(h[a].isZero()){h.splice(a,1);continue}for(var f=a+1;f<h.length;){if(h[a].intersect(h[f])){c=true;h[a].union(h[f]);h.splice(f,1)}else{f++}}a++}}while(c);this._paintRects=h;return h};e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()};e.prototype.resize=function(e,t){var r=this.dpr;var i=this.dom;var n=i.style;var a=this.domBack;if(n){n.width=e+"px";n.height=t+"px"}i.width=e*r;i.height=t*r;if(a){a.width=e*r;a.height=t*r;if(r!==1){this.ctxBack.scale(r,r)}}};e.prototype.clear=function(e,a,t){var r=this.dom;var o=this.ctx;var i=r.width;var n=r.height;a=a||this.clearColor;var s=this.motionBlur&&!e;var l=this.lastFrameAlpha;var u=this.dpr;var c=this;if(s){if(!this.domBack){this.createBackBuffer()}this.ctxBack.globalCompositeOperation="copy";this.ctxBack.drawImage(r,0,0,i/u,n/u)}var f=this.domBack;function h(e,t,r,i){o.clearRect(e,t,r,i);if(a&&a!=="transparent"){var n=void 0;if(ye(a)){n=a.__canvasGradient||C0(o,a,{x:0,y:0,width:r,height:i});a.__canvasGradient=n}else if(me(a)){n=N0(o,a,{dirty:function(){c.setUnpainted();c.__painter.refresh()}})}o.save();o.fillStyle=n||a;o.fillRect(e,t,r,i);o.restore()}if(s){o.save();o.globalAlpha=l;o.drawImage(f,e,t,r,i);o.restore()}}if(!t||s){h(0,0,i,n)}else if(t.length){U(t,function(e){h(e.x*u,e.y*u,e.width*u,e.height*u)})}};return e}(lt);var pI=1e5;var vI=314159;var dI=.01;var gI=.001;function yI(e){return parseInt(e,10)}function mI(e){if(!e){return false}if(e.__builtin__){return true}if(typeof e.resize!=="function"||typeof e.refresh!=="function"){return false}return true}function xI(e,t){var r=document.createElement("div");r.style.cssText=["position:relative","width:"+e+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";";return r}var _I=function(){function e(e,t,r,i){this.type="canvas";this._zlevelList=[];this._prevDisplayList=[];this._layers={};this._layerConfig={};this._needsManuallyCompositing=false;this.type="canvas";var n=!e.nodeName||e.nodeName.toUpperCase()==="CANVAS";this._opts=r=F({},r||{});this.dpr=r.devicePixelRatio||Ti;this._singleCanvas=n;this.root=e;var a=e.style;if(a){a.webkitTapHighlightColor="transparent";a.webkitUserSelect="none";a.userSelect="none";a["-webkit-touch-callout"]="none";e.innerHTML=""}this.storage=t;var o=this._zlevelList;this._prevDisplayList=[];var s=this._layers;if(!n){this._width=this._getSize(0);this._height=this._getSize(1);var l=this._domRoot=xI(this._width,this._height);e.appendChild(l)}else{var u=e;var c=u.width;var f=u.height;if(r.width!=null){c=r.width}if(r.height!=null){f=r.height}this.dpr=r.devicePixelRatio||1;u.width=c*this.dpr;u.height=f*this.dpr;this._width=c;this._height=f;var h=new hI(u,this,this.dpr);h.__builtin__=true;h.initContext();s[vI]=h;h.zlevel=vI;o.push(vI);this._domRoot=e}}e.prototype.getType=function(){return"canvas"};e.prototype.isSingleCanvas=function(){return this._singleCanvas};e.prototype.getViewportRoot=function(){return this._domRoot};e.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e){return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}}};e.prototype.refresh=function(e){var t=this.storage.getDisplayList(true);var r=this._prevDisplayList;var i=this._zlevelList;this._redrawId=Math.random();this._paintList(t,r,e,this._redrawId);for(var n=0;n<i.length;n++){var a=i[n];var o=this._layers[a];if(!o.__builtin__&&o.refresh){var s=n===0?this._backgroundColor:null;o.refresh(s)}}if(this._opts.useDirtyRect){this._prevDisplayList=t.slice()}return this};e.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(false))};e.prototype._paintHoverList=function(e){var t=e.length;var r=this._hoverlayer;r&&r.clear();if(!t){return}var i={inHover:true,viewWidth:this._width,viewHeight:this._height};var n;for(var a=0;a<t;a++){var o=e[a];if(o.__inHover){if(!r){r=this._hoverlayer=this.getLayer(pI)}if(!n){n=r.ctx;n.save()}ex(n,o,i,a===t-1)}}if(n){n.restore()}};e.prototype.getHoverLayer=function(){return this.getLayer(pI)};e.prototype.paintOne=function(e,t){$0(e,t)};e.prototype._paintList=function(e,t,r,i){if(this._redrawId!==i){return}r=r||false;this._updateLayerStatus(e);var n=this._doPaintList(e,t,r),a=n.finished,o=n.needsRefreshHover;if(this._needsManuallyCompositing){this._compositeManually()}if(o){this._paintHoverList(e)}if(!a){var s=this;lr(function(){s._paintList(e,t,r,i)})}else{this.eachLayer(function(e){e.afterBrush&&e.afterBrush()})}};e.prototype._compositeManually=function(){var t=this.getLayer(vI).ctx;var r=this._domRoot.width;var i=this._domRoot.height;t.clearRect(0,0,r,i);this.eachBuiltinLayer(function(e){if(e.virtual){t.drawImage(e.dom,0,0,r,i)}})};e.prototype._doPaintList=function(v,d,g){var y=this;var m=[];var x=this._opts.useDirtyRect;for(var e=0;e<this._zlevelList.length;e++){var t=this._zlevelList[e];var r=this._layers[t];if(r.__builtin__&&r!==this._hoverlayer&&(r.__dirty||g)){m.push(r)}}var _=true;var b=false;var i=function(e){var n=m[e];var a=n.ctx;var t=x&&n.createRepaintRects(v,d,w._width,w._height);var o=g?n.__startIndex:n.__drawIndex;var s=!g&&n.incremental&&Date.now;var l=s&&Date.now();var r=n.zlevel===w._zlevelList[0]?w._backgroundColor:null;if(n.__startIndex===n.__endIndex){n.clear(false,r,t)}else if(o===n.__startIndex){var i=v[o];if(!i.incremental||!i.notClear||g){n.clear(false,r,t)}}if(o===-1){console.error("For some unknown reason. drawIndex is -1");o=n.__startIndex}var u;var c=function(e){var t={inHover:false,allClipped:false,prevEl:null,viewWidth:y._width,viewHeight:y._height};for(u=o;u<n.__endIndex;u++){var r=v[u];if(r.__inHover){b=true}y._doPaintEl(r,n,x,e,t,u===n.__endIndex-1);if(s){var i=Date.now()-l;if(i>15){break}}}if(t.prevElClipPaths){a.restore()}};if(t){if(t.length===0){u=n.__endIndex}else{var f=w.dpr;for(var h=0;h<t.length;++h){var p=t[h];a.save();a.beginPath();a.rect(p.x*f,p.y*f,p.width*f,p.height*f);a.clip();c(p);a.restore()}}}else{a.save();c();a.restore()}n.__drawIndex=u;if(n.__drawIndex<n.__endIndex){_=false}};var w=this;for(var n=0;n<m.length;n++){i(n)}if(S.wxa){U(this._layers,function(e){if(e&&e.ctx&&e.ctx.draw){e.ctx.draw()}})}return{finished:_,needsRefreshHover:b}};e.prototype._doPaintEl=function(e,t,r,i,n,a){var o=t.ctx;if(r){var s=e.getPaintRect();if(!i||s&&s.intersect(i)){ex(o,e,n,a);e.setPrevPaintRect(s)}}else{ex(o,e,n,a)}};e.prototype.getLayer=function(e,t){if(this._singleCanvas&&!this._needsManuallyCompositing){e=vI}var r=this._layers[e];if(!r){r=new hI("zr_"+e,this,this.dpr);r.zlevel=e;r.__builtin__=true;if(this._layerConfig[e]){y(r,this._layerConfig[e],true)}else if(this._layerConfig[e-dI]){y(r,this._layerConfig[e-dI],true)}if(t){r.virtual=t}this.insertLayer(e,r);r.initContext()}return r};e.prototype.insertLayer=function(e,t){var r=this._layers;var i=this._zlevelList;var n=i.length;var a=this._domRoot;var o=null;var s=-1;if(r[e]){re("ZLevel "+e+" has been used already");return}if(!mI(t)){re("Layer of zlevel "+e+" is not valid");return}if(n>0&&e>i[0]){for(s=0;s<n-1;s++){if(i[s]<e&&i[s+1]>e){break}}o=r[i[s]]}i.splice(s+1,0,e);r[e]=t;if(!t.virtual){if(o){var l=o.dom;if(l.nextSibling){a.insertBefore(t.dom,l.nextSibling)}else{a.appendChild(t.dom)}}else{if(a.firstChild){a.insertBefore(t.dom,a.firstChild)}else{a.appendChild(t.dom)}}}t.__painter=this};e.prototype.eachLayer=function(e,t){var r=this._zlevelList;for(var i=0;i<r.length;i++){var n=r[i];e.call(t,this._layers[n],n)}};e.prototype.eachBuiltinLayer=function(e,t){var r=this._zlevelList;for(var i=0;i<r.length;i++){var n=r[i];var a=this._layers[n];if(a.__builtin__){e.call(t,a,n)}}};e.prototype.eachOtherLayer=function(e,t){var r=this._zlevelList;for(var i=0;i<r.length;i++){var n=r[i];var a=this._layers[n];if(!a.__builtin__){e.call(t,a,n)}}};e.prototype.getLayers=function(){return this._layers};e.prototype._updateLayerStatus=function(e){this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=false});function t(e){if(n){if(n.__endIndex!==e){n.__dirty=true}n.__endIndex=e}}if(this._singleCanvas){for(var r=1;r<e.length;r++){var i=e[r];if(i.zlevel!==e[r-1].zlevel||i.incremental){this._needsManuallyCompositing=true;break}}}var n=null;var a=0;var o;var s;for(s=0;s<e.length;s++){var i=e[s];var l=i.zlevel;var u=void 0;if(o!==l){o=l;a=0}if(i.incremental){u=this.getLayer(l+gI,this._needsManuallyCompositing);u.incremental=true;a=1}else{u=this.getLayer(l+(a>0?dI:0),this._needsManuallyCompositing)}if(!u.__builtin__){re("ZLevel "+l+" has been used by unkown layer "+u.id)}if(u!==n){u.__used=true;if(u.__startIndex!==s){u.__dirty=true}u.__startIndex=s;if(!u.incremental){u.__drawIndex=s}else{u.__drawIndex=-1}t(s);n=u}if(i.__dirty&er&&!i.__inHover){u.__dirty=true;if(u.incremental&&u.__drawIndex<0){u.__drawIndex=s}}}t(s);this.eachBuiltinLayer(function(e,t){if(!e.__used&&e.getElementCount()>0){e.__dirty=true;e.__startIndex=e.__endIndex=e.__drawIndex=0}if(e.__dirty&&e.__drawIndex<0){e.__drawIndex=e.__startIndex}})};e.prototype.clear=function(){this.eachBuiltinLayer(this._clearLayer);return this};e.prototype._clearLayer=function(e){e.clear()};e.prototype.setBackgroundColor=function(e){this._backgroundColor=e;U(this._layers,function(e){e.setUnpainted()})};e.prototype.configLayer=function(e,t){if(t){var r=this._layerConfig;if(!r[e]){r[e]=t}else{y(r[e],t,true)}for(var i=0;i<this._zlevelList.length;i++){var n=this._zlevelList[i];if(n===e||n===e+dI){var a=this._layers[n];y(a,r[e],true)}}}};e.prototype.delLayer=function(e){var t=this._layers;var r=this._zlevelList;var i=t[e];if(!i){return}i.dom.parentNode.removeChild(i.dom);delete t[e];r.splice(D(r,e),1)};e.prototype.resize=function(e,t){if(!this._domRoot.style){if(e==null||t==null){return}this._width=e;this._height=t;this.getLayer(vI).resize(e,t)}else{var r=this._domRoot;r.style.display="none";var i=this._opts;e!=null&&(i.width=e);t!=null&&(i.height=t);e=this._getSize(0);t=this._getSize(1);r.style.display="";if(this._width!==e||t!==this._height){r.style.width=e+"px";r.style.height=t+"px";for(var n in this._layers){if(this._layers.hasOwnProperty(n)){this._layers[n].resize(e,t)}}this.refresh(true)}this._width=e;this._height=t}return this};e.prototype.clearLayer=function(e){var t=this._layers[e];if(t){t.clear()}};e.prototype.dispose=function(){this.root.innerHTML="";this.root=this.storage=this._domRoot=this._layers=null};e.prototype.getRenderedCanvas=function(e){e=e||{};if(this._singleCanvas&&!this._compositeManually){return this._layers[vI].dom}var t=new hI("image",this,e.pixelRatio||this.dpr);t.initContext();t.clear(false,e.backgroundColor||this._backgroundColor);var r=t.ctx;if(e.pixelRatio<=this.dpr){this.refresh();var i=t.dom.width;var n=t.dom.height;this.eachLayer(function(e){if(e.__builtin__){r.drawImage(e.dom,0,0,i,n)}else if(e.renderToCanvas){r.save();e.renderToCanvas(r);r.restore()}})}else{var a={inHover:false,viewWidth:this._width,viewHeight:this._height};var o=this.storage.getDisplayList(true);for(var s=0,l=o.length;s<l;s++){var u=o[s];ex(r,u,a,s===l-1)}}return t.dom};e.prototype.getWidth=function(){return this._width};e.prototype.getHeight=function(){return this._height};e.prototype._getSize=function(e){var t=this._opts;var r=["width","height"][e];var i=["clientWidth","clientHeight"][e];var n=["paddingLeft","paddingTop"][e];var a=["paddingRight","paddingBottom"][e];if(t[r]!=null&&t[r]!=="auto"){return parseFloat(t[r])}var o=this.root;var s=document.defaultView.getComputedStyle(o);return(o[i]||yI(s[r])||yI(o.style[r]))-(yI(s[n])||0)-(yI(s[a])||0)|0};e.prototype.pathToImage=function(e,t){t=t||this.dpr;var r=document.createElement("canvas");var i=r.getContext("2d");var n=e.getBoundingRect();var a=e.style;var o=a.shadowBlur*t;var s=a.shadowOffsetX*t;var l=a.shadowOffsetY*t;var u=e.hasStroke()?a.lineWidth:0;var c=Math.max(u/2,-s+o);var f=Math.max(u/2,s+o);var h=Math.max(u/2,-l+o);var p=Math.max(u/2,l+o);var v=n.width+c+f;var d=n.height+h+p;r.width=v*t;r.height=d*t;i.scale(t,t);i.clearRect(0,0,v,d);i.dpr=t;var g={x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY,rotation:e.rotation,originX:e.originX,originY:e.originY};e.x=c-n.x;e.y=h-n.y;e.rotation=0;e.scaleX=1;e.scaleY=1;e.updateTransform();if(e){ex(i,e,{inHover:false,viewWidth:this._width,viewHeight:this._height},true)}var y=new Rl({style:{x:0,y:0,image:r}});F(e,g);return y};return e}();function bI(e){e.registerPainter("canvas",_I)}var wI=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.hasSymbolVisual=true;return e}r.prototype.getInitialData=function(e){if("development"!=="production"){var t=e.coordinateSystem;if(t!=="polar"&&t!=="cartesian2d"){throw new Error("Line not support coordinateSystem besides cartesian and polar")}}return sw(this.getSource(),this,{useEncodeDefaulter:true})};r.prototype.getLegendIcon=function(e){var t=new H;var r=S0("line",0,e.itemHeight/2,e.itemWidth,0,e.lineStyle.stroke,false);t.add(r);r.setStyle(e.lineStyle);var i=this.getData().getVisual("symbol");var n=this.getData().getVisual("symbolRotate");var a=i==="none"?"circle":i;var o=e.itemHeight*.8;var s=S0(a,(e.itemWidth-o)/2,(e.itemHeight-o)/2,o,o,e.itemStyle.fill);t.add(s);s.setStyle(e.itemStyle);var l=e.iconRotate==="inherit"?n:e.iconRotate||0;s.rotation=l*Math.PI/180;s.setOrigin([e.itemWidth/2,e.itemHeight/2]);if(a.indexOf("empty")>-1){s.style.stroke=s.style.fill;s.style.fill="#fff";s.style.lineWidth=2}return t};r.type="series.line";r.dependencies=["grid","polar"];r.defaultOption={zlevel:0,z:3,coordinateSystem:"cartesian2d",legendHoverLink:true,clip:true,label:{position:"top"},endLabel:{show:false,valueAnimation:true,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:true,lineStyle:{width:"bolder"}},step:false,smooth:false,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:true,showAllSymbol:"auto",connectNulls:false,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:Infinity};return r}(dy);function SI(e,t){var r=e.mapDimensionsAll("defaultedLabel");var i=r.length;if(i===1){var n=yg(e,t,r[0]);return n!=null?n+"":null}else if(i){var a=[];for(var o=0;o<r.length;o++){a.push(yg(e,t,r[o]))}return a.join(" ")}}function MI(e,t){var r=e.mapDimensionsAll("defaultedLabel");if(!k(t)){return t+""}var i=[];for(var n=0;n<r.length;n++){var a=e.getDimensionInfo(r[n]);if(a){i.push(t[a.index])}}return i.join(" ")}var II=function(a){d(h,a);function h(e,t,r,i){var n=a.call(this)||this;n.updateData(e,t,r,i);return n}h.prototype._createSymbol=function(e,t,r,i,n){this.removeAll();var a=S0(e,-1,-1,2,2,null,n);a.attr({z2:100,culling:true,scaleX:i[0]/2,scaleY:i[1]/2});a.drift=CI;this._symbolType=e;this.add(a)};h.prototype.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(null,e)};h.prototype.getSymbolPath=function(){return this.childAt(0)};h.prototype.highlight=function(){Bu(this.childAt(0))};h.prototype.downplay=function(){Vu(this.childAt(0))};h.prototype.setZ=function(e,t){var r=this.childAt(0);r.zlevel=e;r.z=t};h.prototype.setDraggable=function(e){var t=this.childAt(0);t.draggable=e;t.cursor=e?"move":t.cursor};h.prototype.updateData=function(e,t,r,i){this.silent=false;var n=e.getItemVisual(t,"symbol")||"circle";var a=e.hostModel;var o=h.getSymbolSize(e,t);var s=n!==this._symbolType;var l=i&&i.disableAnimation;if(s){var u=e.getItemVisual(t,"symbolKeepAspect");this._createSymbol(n,e,t,o,u)}else{var c=this.childAt(0);c.silent=false;var f={scaleX:o[0]/2,scaleY:o[1]/2};l?c.attr(f):X(c,f,a,t)}this._updateCommon(e,t,o,r,i);if(s){var c=this.childAt(0);if(!l){var f={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:c.style.opacity}};c.scaleX=c.scaleY=0;c.style.opacity=0;qf(c,f,a,t)}}if(l){this.childAt(0).stopAnimation("remove")}this._seriesModel=a};h.prototype._updateCommon=function(t,e,r,i,n){var a=this.childAt(0);var o=t.hostModel;var s;var l;var u;var c;var f;var h;var p;var v;if(i){s=i.emphasisItemStyle;l=i.blurItemStyle;u=i.selectItemStyle;c=i.focus;f=i.blurScope;h=i.labelStatesModels;p=i.hoverScale;v=i.cursorStyle}if(!i||t.hasItemOption){var d=i&&i.itemModel?i.itemModel:t.getItemModel(e);var g=d.getModel("emphasis");s=g.getModel("itemStyle").getItemStyle();u=d.getModel(["select","itemStyle"]).getItemStyle();l=d.getModel(["blur","itemStyle"]).getItemStyle();c=g.get("focus");f=g.get("blurScope");h=xh(d);p=g.getShallow("scale");v=d.getShallow("cursor")}var y=t.getItemVisual(e,"symbolRotate");a.attr("rotation",(y||0)*Math.PI/180||0);var m=t.getItemVisual(e,"symbolOffset")||0;if(m){if(!k(m)){m=[m,m]}a.x=Y(m[0],r[0]);a.y=Y(N(m[1],m[0])||0,r[1])}v&&a.attr("cursor",v);var x=t.getItemVisual(e,"style");var _=x.fill;if(a instanceof Rl){var b=a.style;a.useStyle(F({image:b.image,x:b.x,y:b.y,width:b.width,height:b.height},x))}else{if(a.__isEmptyBrush){a.useStyle(F({},x))}else{a.useStyle(x)}a.style.decal=null;a.setColor(_,n&&n.symbolInnerColor);a.style.strokeNoScale=true}var w=t.getItemVisual(e,"liftZ");var S=this._z2;if(w!=null){if(S==null){this._z2=a.z2;a.z2+=w}}else if(S!=null){a.z2=S;this._z2=null}var M=n&&n.useNameLabel;mh(a,h,{labelFetcher:o,labelDataIndex:e,defaultText:I,inheritColor:_,defaultOpacity:x.opacity});function I(e){return M?t.getName(e):SI(t,e)}this._sizeX=r[0]/2;this._sizeY=r[1]/2;var C=a.ensureState("emphasis");C.style=s;a.ensureState("select").style=u;a.ensureState("blur").style=l;if(p){var T=Math.max(1.1,3/this._sizeY);C.scaleX=this._sizeX*T;C.scaleY=this._sizeY*T}this.setSymbolScale(1);tc(this,c,f)};h.prototype.setSymbolScale=function(e){this.scaleX=this.scaleY=e};h.prototype.fadeOut=function(e,t){var r=this.childAt(0);var i=this._seriesModel;var n=j(this).dataIndex;var a=t&&t.animation;this.silent=r.silent=true;if(t&&t.fadeLabel){var o=r.getTextContent();if(o){Jf(o,{style:{opacity:0}},i,{dataIndex:n,removeOpt:a,cb:function(){r.removeTextContent()}})}}else{r.removeTextContent()}Jf(r,{style:{opacity:0},scaleX:0,scaleY:0},i,{dataIndex:n,cb:e,removeOpt:a})};h.getSymbolSize=function(e,t){var r=e.getItemVisual(t,"symbolSize");return k(r)?r.slice():[+r,+r]};return h}(H);function CI(e,t){this.parent.drift(e,t)}function TI(e,t,r,i){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(i.isIgnore&&i.isIgnore(r))&&!(i.clipShape&&!i.clipShape.contain(t[0],t[1]))&&e.getItemVisual(r,"symbol")!=="none"}function DI(e){if(e!=null&&!O(e)){e={isIgnore:e}}return e||{}}function AI(e){var t=e.hostModel;var r=t.getModel("emphasis");return{emphasisItemStyle:r.getModel("itemStyle").getItemStyle(),blurItemStyle:t.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:t.getModel(["select","itemStyle"]).getItemStyle(),focus:r.get("focus"),blurScope:r.get("blurScope"),hoverScale:r.get("scale"),labelStatesModels:xh(t),cursorStyle:t.get("cursor")}}var LI=function(){function e(e){this.group=new H;this._SymbolCtor=e||II}e.prototype.updateData=function(a,o){o=DI(o);var s=this.group;var l=a.hostModel;var u=this._data;var c=this._SymbolCtor;var f=o.disableAnimation;var h=AI(a);var p={disableAnimation:f};var v=o.getSymbolPoint||function(e){return a.getItemLayout(e)};if(!u){s.removeAll()}a.diff(u).add(function(e){var t=v(e);if(TI(a,t,e,o)){var r=new c(a,e,h,p);r.setPosition(t);a.setItemGraphicEl(e,r);s.add(r)}}).update(function(e,t){var r=u.getItemGraphicEl(t);var i=v(e);if(!TI(a,i,e,o)){s.remove(r);return}if(!r){r=new c(a,e);r.setPosition(i)}else{r.updateData(a,e,h,p);var n={x:i[0],y:i[1]};f?r.attr(n):X(r,n,l)}s.add(r);a.setItemGraphicEl(e,r)}).remove(function(e){var t=u.getItemGraphicEl(e);t&&t.fadeOut(function(){s.remove(t)})}).execute();this._getSymbolPoint=v;this._data=a};e.prototype.isPersistent=function(){return true};e.prototype.updateLayout=function(){var i=this;var e=this._data;if(e){e.eachItemGraphicEl(function(e,t){var r=i._getSymbolPoint(t);e.setPosition(r);e.markRedraw()})}};e.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=AI(e);this._data=null;this.group.removeAll()};e.prototype.incrementalUpdate=function(e,t,r){r=DI(r);function i(e){if(!e.isGroup){e.incremental=true;e.ensureState("emphasis").hoverLayer=true}}for(var n=e.start;n<e.end;n++){var a=t.getItemLayout(n);if(TI(t,a,n,r)){var o=new this._SymbolCtor(t,n,this._seriesScope);o.traverse(i);o.setPosition(a);this.group.add(o);t.setItemGraphicEl(n,o)}}};e.prototype.remove=function(e){var t=this.group;var r=this._data;if(r&&e){r.eachItemGraphicEl(function(e){e.fadeOut(function(){t.remove(e)})})}else{t.removeAll()}};return e}();function kI(e,t,r){var i=e.getBaseAxis();var n=e.getOtherAxis(i);var a=PI(n,r);var o=i.dim;var s=n.dim;var l=t.mapDimension(s);var u=t.mapDimension(o);var c=s==="x"||s==="radius"?1:0;var f=A(e.dimensions,function(e){return t.mapDimension(e)});var h=false;var p=t.getCalculationInfo("stackResultDimension");if(aw(t,f[0])){h=true;f[0]=p}if(aw(t,f[1])){h=true;f[1]=p}return{dataDimsForPoint:f,valueStart:a,valueAxisDim:s,baseAxisDim:o,stacked:!!h,valueDim:l,baseDim:u,baseDataOffset:c,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function PI(e,t){var r=0;var i=e.scale.getExtent();if(t==="start"){r=i[0]}else if(t==="end"){r=i[1]}else{if(i[0]>0){r=i[0]}else if(i[1]<0){r=i[1]}}return r}function OI(e,t,r,i){var n=NaN;if(e.stacked){n=r.get(r.getCalculationInfo("stackedOverDimension"),i)}if(isNaN(n)){n=e.valueStart}var a=e.baseDataOffset;var o=[];o[a]=r.get(e.baseDim,i);o[1-a]=n;return t.dataToPoint(o)}var NI=typeof Float32Array!=="undefined";var EI=!NI?Array:Float32Array;function RI(e){if(k(e)){return NI?new Float32Array(e):e}return new EI(e)}function zI(e,t){var r=[];t.diff(e).add(function(e){r.push({cmd:"+",idx:e})}).update(function(e,t){r.push({cmd:"=",idx:t,idx1:e})}).remove(function(e){r.push({cmd:"-",idx:e})}).execute();return r}function BI(e,t,r,i,n,R,z,B){var a=zI(e,t);var o=[];var s=[];var l=[];var u=[];var c=[];var f=[];var h=[];var p=kI(n,t,z);var v=e.getLayout("points")||[];var d=t.getLayout("points")||[];for(var g=0;g<a.length;g++){var y=a[g];var m=true;var x=void 0;var _=void 0;switch(y.cmd){case"=":x=y.idx*2;_=y.idx1*2;var b=v[x];var w=v[x+1];var S=d[_];var M=d[_+1];if(isNaN(b)||isNaN(w)){b=S;w=M}o.push(b,w);s.push(S,M);l.push(r[x],r[x+1]);u.push(i[_],i[_+1]);h.push(t.getRawIndex(y.idx1));break;case"+":var I=y.idx;var C=p.dataDimsForPoint;var T=n.dataToPoint([t.get(C[0],I),t.get(C[1],I)]);_=I*2;o.push(T[0],T[1]);s.push(d[_],d[_+1]);var D=OI(p,n,t,I);l.push(D[0],D[1]);u.push(i[_],i[_+1]);h.push(t.getRawIndex(I));break;case"-":m=false}if(m){c.push(y);f.push(f.length)}}f.sort(function(e,t){return h[e]-h[t]});var A=o.length;var L=RI(A);var k=RI(A);var P=RI(A);var O=RI(A);var V=[];for(var g=0;g<f.length;g++){var G=f[g];var N=g*2;var E=G*2;L[N]=o[E];L[N+1]=o[E+1];k[N]=s[E];k[N+1]=s[E+1];P[N]=l[E];P[N+1]=l[E+1];O[N]=u[E];O[N+1]=u[E+1];V[g]=c[G]}return{current:L,next:k,stackedOnCurrent:P,stackedOnNext:O,status:V}}var VI=Math.min;var GI=Math.max;function FI(e,t){return isNaN(e)||isNaN(t)}function HI(e,t,r,i,n,a,o,s,l){var u;var c;var f;var h;var p;var v;var d=r;var g=0;for(;g<i;g++){var y=t[d*2];var m=t[d*2+1];if(d>=n||d<0){break}if(FI(y,m)){if(l){d+=a;continue}break}if(d===r){e[a>0?"moveTo":"lineTo"](y,m);f=y;h=m}else{var x=y-u;var _=m-c;if(x*x+_*_<.5){d+=a;continue}if(o>0){var b=d+a;var w=t[b*2];var S=t[b*2+1];var M=g+1;if(l){while(FI(w,S)&&M<i){M++;b+=a;w=t[b*2];S=t[b*2+1]}}var I=.5;var C=0;var T=0;var D=void 0;var A=void 0;if(M>=i||FI(w,S)){p=y;v=m}else{C=w-u;T=S-c;var L=y-u;var k=w-y;var P=m-c;var O=S-m;var N=void 0;var E=void 0;if(s==="x"){N=Math.abs(L);E=Math.abs(k);p=y-N*o;v=m;D=y+N*o;A=m}else if(s==="y"){N=Math.abs(P);E=Math.abs(O);p=y;v=m-N*o;D=y;A=m+N*o}else{N=Math.sqrt(L*L+P*P);E=Math.sqrt(k*k+O*O);I=E/(E+N);p=y-C*o*(1-I);v=m-T*o*(1-I);D=y+C*o*I;A=m+T*o*I;D=VI(D,GI(w,y));A=VI(A,GI(S,m));D=GI(D,VI(w,y));A=GI(A,VI(S,m));C=D-y;T=A-m;p=y-C*N/E;v=m-T*N/E;p=VI(p,GI(u,y));v=VI(v,GI(c,m));p=GI(p,VI(u,y));v=GI(v,VI(c,m));C=y-p;T=m-v;D=y+C*E/N;A=m+T*E/N}}e.bezierCurveTo(f,h,p,v,y,m);f=D;h=A}else{e.lineTo(y,m)}}u=y;c=m;d+=a}return g}var WI=function(){function e(){this.smooth=0;this.smoothConstraint=true}return e}();var jI=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="ec-polyline";return t}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new WI};e.prototype.buildPath=function(e,t){var r=t.points;var i=0;var n=r.length/2;if(t.connectNulls){for(;n>0;n--){if(!FI(r[n*2-2],r[n*2-1])){break}}for(;i<n;i++){if(!FI(r[i*2],r[i*2+1])){break}}}while(i<n){i+=HI(e,r,i,n,n,1,t.smooth,t.smoothMonotone,t.connectNulls)+1}};e.prototype.getPointOn=function(e,t){if(!this.path){this.createPathProxy();this.buildPath(this.path,this.shape)}var r=this.path;var i=r.data;var n=ol.CMD;var a;var o;var s=t==="x";var l=[];for(var u=0;u<i.length;){var c=i[u++];var f=void 0;var h=void 0;var p=void 0;var v=void 0;var d=void 0;var g=void 0;var y=void 0;switch(c){case n.M:a=i[u++];o=i[u++];break;case n.L:f=i[u++];h=i[u++];y=s?(e-a)/(f-a):(e-o)/(h-o);if(y<=1&&y>=0){var m=s?(h-o)*y+o:(f-a)*y+a;return s?[e,m]:[m,e]}a=f;o=h;break;case n.C:f=i[u++];h=i[u++];p=i[u++];v=i[u++];d=i[u++];g=i[u++];var x=s?vs(a,f,p,d,e,l):vs(o,h,v,g,e,l);if(x>0){for(var _=0;_<x;_++){var b=l[_];if(b<=1&&b>=0){var m=s?hs(o,h,v,g,b):hs(a,f,p,d,b);return s?[e,m]:[m,e]}}}a=d;o=g;break}}};return e}(m);var UI=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(WI);var ZI=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="ec-polygon";return t}e.prototype.getDefaultShape=function(){return new UI};e.prototype.buildPath=function(e,t){var r=t.points;var i=t.stackedOnPoints;var n=0;var a=r.length/2;var o=t.smoothMonotone;if(t.connectNulls){for(;a>0;a--){if(!FI(r[a*2-2],r[a*2-1])){break}}for(;n<a;n++){if(!FI(r[n*2],r[n*2+1])){break}}}while(n<a){var s=HI(e,r,n,a,a,1,t.smooth,o,t.connectNulls);HI(e,i,n+s-1,s,a,-1,t.stackedOnSmooth,o,t.connectNulls);n+=s+1;e.closePath()}};return e}(m);function YI(e,t,r,i,n){var a=e.getArea();var o=a.x;var s=a.y;var l=a.width;var u=a.height;var c=r.get(["lineStyle","width"])||2;o-=c/2;s-=c/2;l+=c;u+=c;o=Math.floor(o);l=Math.round(l);var f=new G({shape:{x:o,y:s,width:l,height:u}});if(t){var h=e.getBaseAxis();var p=h.isHorizontal();var v=h.inverse;if(p){if(v){f.shape.x+=l}f.shape.width=0}else{if(!v){f.shape.y+=u}f.shape.height=0}var d=typeof n==="function"?function(e){n(e,f)}:null;qf(f,{shape:{width:l,height:u,x:o,y:s}},r,null,i,d)}return f}function XI(e,t,r){var i=e.getArea();var n=Zn(i.r0,1);var a=Zn(i.r,1);var o=new ef({shape:{cx:Zn(e.cx,1),cy:Zn(e.cy,1),r0:n,r:a,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}});if(t){var s=e.getBaseAxis().dim==="angle";if(s){o.shape.endAngle=i.startAngle}else{o.shape.r=n}qf(o,{shape:{endAngle:i.endAngle,r:a}},r)}return o}function qI(e,t,r,i,n){if(!e){return null}else if(e.type==="polar"){return XI(e,t,r)}else if(e.type==="cartesian2d"){return YI(e,t,r,i,n)}return null}function JI(e,t){return e.type===t}function KI(e,t){if(e.length!==t.length){return}for(var r=0;r<e.length;r++){if(e[r]!==t[r]){return}}return true}function QI(e){var t=Infinity;var r=Infinity;var i=-Infinity;var n=-Infinity;for(var a=0;a<e.length;){var o=e[a++];var s=e[a++];if(!isNaN(o)){t=Math.min(o,t);i=Math.max(o,i)}if(!isNaN(s)){r=Math.min(s,r);n=Math.max(s,n)}}return[[t,r],[i,n]]}function $I(e,t){var r=QI(e),i=r[0],n=r[1];var a=QI(t),o=a[0],s=a[1];return Math.max(Math.abs(i[0]-o[0]),Math.abs(i[1]-o[1]),Math.abs(n[0]-s[0]),Math.abs(n[1]-s[1]))}function eC(e){return typeof e==="number"?e:e?.5:0}function tC(e,t,r){if(!r.valueDim){return[]}var i=t.count();var n=RI(i*2);for(var a=0;a<i;a++){var o=OI(r,e,t,a);n[a*2]=o[0];n[a*2+1]=o[1]}return n}function rC(e,t,r){var i=t.getBaseAxis();var n=i.dim==="x"||i.dim==="radius"?0:1;var a=[];var o=0;var s=[];var l=[];var u=[];for(;o<e.length-2;o+=2){u[0]=e[o+2];u[1]=e[o+3];l[0]=e[o];l[1]=e[o+1];a.push(l[0],l[1]);switch(r){case"end":s[n]=u[n];s[1-n]=l[1-n];a.push(s[0],s[1]);break;case"middle":var c=(l[n]+u[n])/2;var f=[];s[n]=f[n]=c;s[1-n]=l[1-n];f[1-n]=u[1-n];a.push(s[0],s[1]);a.push(f[0],f[1]);break;default:s[n]=l[n];s[1-n]=u[1-n];a.push(s[0],s[1])}}a.push(e[o++],e[o++]);return a}function iC(e,t){var r=e.getVisual("visualMeta");if(!r||!r.length||!e.count()){return}if(t.type!=="cartesian2d"){if("development"!=="production"){console.warn("Visual map on line style is only supported on cartesian2d.")}return}var i;var n;for(var a=r.length-1;a>=0;a--){var o=r[a].dimension;var s=e.dimensions[o];var l=e.getDimensionInfo(s);i=l&&l.coordDim;if(i==="x"||i==="y"){n=r[a];break}}if(!n){if("development"!=="production"){console.warn("Visual map on line style only support x or y dimension.")}return}var u=t.getAxis(i);var c=A(n.stops,function(e){return{offset:0,coord:u.toGlobalCoord(u.dataToCoord(e.value,true)),color:e.color}});var f=c.length;var h=n.outerColors.slice();if(f&&c[0].coord>c[f-1].coord){c.reverse();h.reverse()}var p=10;var v=c[0].coord-p;var d=c[f-1].coord+p;var g=d-v;if(g<.001){return"transparent"}U(c,function(e){e.offset=(e.coord-v)/g});c.push({offset:f?c[f-1].offset:.5,color:h[1]||"transparent"});c.unshift({offset:f?c[0].offset:.5,color:h[0]||"transparent"});var y=new Sf(0,0,0,0,c,true);y[i]=v;y[i+"2"]=d;return y}function nC(e,t,r){var i=e.get("showAllSymbol");var n=i==="auto";if(i&&!n){return}var a=r.getAxesByScale("ordinal")[0];if(!a){return}if(n&&aC(a,t)){return}var o=t.mapDimension(a.dim);var s={};U(a.getViewLabels(),function(e){var t=a.scale.getRawOrdinalNumber(e.tickValue);s[t]=1});return function(e){return!s.hasOwnProperty(t.get(o,e))}}function aC(e,t){var r=e.getExtent();var i=Math.abs(r[1]-r[0])/e.scale.count();isNaN(i)&&(i=0);var n=t.count();var a=Math.max(1,Math.round(n/5));for(var o=0;o<n;o+=a){if(II.getSymbolSize(t,o)[e.isHorizontal()?1:0]*1.5>i){return false}}return true}function oC(e,t){return isNaN(e)||isNaN(t)}function sC(e){var t=e.length/2;for(;t>0;t--){if(!oC(e[t*2-2],e[t*2-1])){break}}return t-1}function lC(e,t){return[e[t*2],e[t*2+1]]}function uC(e,t,r){var i=e.length/2;var n=r==="x"?0:1;var a;var o;var s=0;var l=-1;for(var u=0;u<i;u++){o=e[u*2+n];if(isNaN(o)||isNaN(e[u*2+1-n])){continue}if(u===0){a=o;continue}if(a<=t&&o>=t||a>=t&&o<=t){l=u;break}s=u;a=o}return{range:[s,l],t:(t-a)/(o-a)}}function cC(r,i,t,e){if(JI(i,"cartesian2d")){var n=e.getModel("endLabel");var a=n.get("show");var o=n.get("valueAnimation");var s=e.getData();var l={lastFrameIndex:0};var u=a?function(e,t){r._endLabelOnDuring(e,t,s,l,o,n,i)}:null;var c=i.getBaseAxis().isHorizontal();var f=YI(i,t,e,function(){var e=r._endLabel;if(e&&t){if(l.originalX!=null){e.attr({x:l.originalX,y:l.originalY})}}},u);if(!e.get("clip",true)){var h=f.shape;var p=Math.max(h.width,h.height);if(c){h.y-=p;h.height+=p*2}else{h.x-=p;h.width+=p*2}}if(u){u(1,f)}return f}else{if("development"!=="production"){if(e.get(["endLabel","show"])){console.warn("endLabel is not supported for lines in polar systems.")}}return XI(i,t,e)}}function fC(e,t){var r=t.getBaseAxis();var i=r.isHorizontal();var n=r.inverse;var a=i?n?"right":"left":"center";var o=i?"middle":n?"top":"bottom";return{normal:{align:e.get("align")||a,verticalAlign:e.get("verticalAlign")||o}}}var hC=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(){var e=new H;var t=new LI;this.group.add(t.group);this._symbolDraw=t;this._lineGroup=e};t.prototype.render=function(e,E,t){var r=this;var i=e.coordinateSystem;var n=this.group;var a=e.getData();var o=e.getModel("lineStyle");var s=e.getModel("areaStyle");var l=a.getLayout("points")||[];var u=i.type==="polar";var c=this._coordSys;var f=this._symbolDraw;var h=this._polyline;var p=this._polygon;var v=this._lineGroup;var d=e.get("animation");var g=!s.isEmpty();var y=s.get("origin");var m=kI(i,a,y);var x=g&&tC(i,a,m);var _=e.get("showSymbol");var b=_&&!u&&nC(e,a,i);var w=this._data;w&&w.eachItemGraphicEl(function(e,t){if(e.__temp){n.remove(e);w.setItemGraphicEl(t,null)}});if(!_){f.remove()}n.add(v);var S=!u?e.get("step"):false;var M;if(i&&i.getArea&&e.get("clip",true)){M=i.getArea();if(M.width!=null){M.x-=.1;M.y-=.1;M.width+=.2;M.height+=.2}else if(M.r0){M.r0-=.5;M.r+=.5}}this._clipShapeForSymbol=M;var I=iC(a,i)||a.getVisual("style")[a.getVisual("drawType")];if(!(h&&c.type===i.type&&S===this._step)){_&&f.updateData(a,{isIgnore:b,clipShape:M,disableAnimation:true,getSymbolPoint:function(e){return[l[e*2],l[e*2+1]]}});d&&this._initSymbolLabelAnimation(a,i,M);if(S){l=rC(l,i,S);if(x){x=rC(x,i,S)}}h=this._newPolyline(l);if(g){p=this._newPolygon(l,x)}if(!u){this._initOrUpdateEndLabel(e,i,Kp(I))}v.setClipPath(cC(this,i,true,e))}else{if(g&&!p){p=this._newPolygon(l,x)}else if(p&&!g){v.remove(p);p=this._polygon=null}if(!u){this._initOrUpdateEndLabel(e,i,Kp(I))}v.setClipPath(cC(this,i,false,e));_&&f.updateData(a,{isIgnore:b,clipShape:M,disableAnimation:true,getSymbolPoint:function(e){return[l[e*2],l[e*2+1]]}});if(!KI(this._stackedOnPoints,x)||!KI(this._points,l)){if(d){this._doUpdateAnimation(a,x,i,t,S,y)}else{if(S){l=rC(l,i,S);if(x){x=rC(x,i,S)}}h.setShape({points:l});p&&p.setShape({points:l,stackedOnPoints:x})}}}var C=e.get(["emphasis","focus"]);var T=e.get(["emphasis","blurScope"]);h.useStyle(R(o.getLineStyle(),{fill:"none",stroke:I,lineJoin:"bevel"}));ac(h,e,"lineStyle");if(h.style.lineWidth>0&&e.get(["emphasis","lineStyle","width"])==="bolder"){var D=h.getState("emphasis").style;D.lineWidth=+h.style.lineWidth+1}j(h).seriesIndex=e.seriesIndex;tc(h,C,T);var A=eC(e.get("smooth"));var L=e.get("smoothMonotone");var k=e.get("connectNulls");h.setShape({smooth:A,smoothMonotone:L,connectNulls:k});if(p){var P=a.getCalculationInfo("stackedOnSeries");var O=0;p.useStyle(R(s.getAreaStyle(),{fill:I,opacity:.7,lineJoin:"bevel",decal:a.getVisual("style").decal}));if(P){O=eC(P.get("smooth"))}p.setShape({smooth:A,stackedOnSmooth:O,smoothMonotone:L,connectNulls:k});ac(p,e,"areaStyle");j(p).seriesIndex=e.seriesIndex;tc(p,C,T)}var N=function(e){r._changePolyState(e)};a.eachItemGraphicEl(function(e){e&&(e.onHoverStateChange=N)});this._polyline.onHoverStateChange=N;this._data=a;this._coordSys=i;this._stackedOnPoints=x;this._points=l;this._step=S;this._valueOrigin=y};t.prototype.dispose=function(){};t.prototype.highlight=function(e,t,r,i){var n=e.getData();var a=Xa(n,i);this._changePolyState("emphasis");if(!(a instanceof Array)&&a!=null&&a>=0){var o=n.getLayout("points");var s=n.getItemGraphicEl(a);if(!s){var l=o[a*2];var u=o[a*2+1];if(isNaN(l)||isNaN(u)){return}if(this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(l,u)){return}var c=e.get("zlevel");var f=e.get("z");s=new II(n,a);s.x=l;s.y=u;s.setZ(c,f);var h=s.getSymbolPath().getTextContent();if(h){h.zlevel=c;h.z=f;h.z2=this._polyline.z2+1}s.__temp=true;n.setItemGraphicEl(a,s);s.stopSymbolAnimation(true);this.group.add(s)}s.highlight()}else{v.prototype.highlight.call(this,e,t,r,i)}};t.prototype.downplay=function(e,t,r,i){var n=e.getData();var a=Xa(n,i);this._changePolyState("normal");if(a!=null&&a>=0){var o=n.getItemGraphicEl(a);if(o){if(o.__temp){n.setItemGraphicEl(a,null);this.group.remove(o)}else{o.downplay()}}}else{v.prototype.downplay.call(this,e,t,r,i)}};t.prototype._changePolyState=function(e){var t=this._polygon;Au(this._polyline,e);t&&Au(t,e)};t.prototype._newPolyline=function(e){var t=this._polyline;if(t){this._lineGroup.remove(t)}t=new jI({shape:{points:e},segmentIgnoreThreshold:2,z2:10});this._lineGroup.add(t);this._polyline=t;return t};t.prototype._newPolygon=function(e,t){var r=this._polygon;if(r){this._lineGroup.remove(r)}r=new ZI({shape:{points:e,stackedOnPoints:t},segmentIgnoreThreshold:2});this._lineGroup.add(r);this._polygon=r;return r};t.prototype._initSymbolLabelAnimation=function(e,v,d){var g;var y;var t=v.getBaseAxis();var m=t.inverse;if(v.type==="cartesian2d"){g=t.isHorizontal();y=false}else if(v.type==="polar"){g=t.dim==="angle";y=true}var r=e.hostModel;var x=r.get("animationDuration");if(typeof x==="function"){x=x(null)}var _=r.get("animationDelay")||0;var b=typeof _==="function"?_(null):_;e.eachItemGraphicEl(function(e,t){var r=e;if(r){var i=[e.x,e.y];var n=void 0;var a=void 0;var o=void 0;if(d){if(y){var s=d;var l=v.pointToCoord(i);if(g){n=s.startAngle;a=s.endAngle;o=-l[1]/180*Math.PI}else{n=s.r0;a=s.r;o=l[0]}}else{var u=d;if(g){n=u.x;a=u.x+u.width;o=e.x}else{n=u.y+u.height;a=u.y;o=e.y}}}var c=a===n?0:(o-n)/(a-n);if(m){c=1-c}var f=typeof _==="function"?_(t):x*c+b;var h=r.getSymbolPath();var p=h.getTextContent();r.attr({scaleX:0,scaleY:0});r.animateTo({scaleX:1,scaleY:1},{duration:200,delay:f});if(p){p.animateFrom({style:{opacity:0}},{duration:300,delay:f})}h.disableLabelAnimation=true}})};t.prototype._initOrUpdateEndLabel=function(e,t,r){var i=e.getModel("endLabel");if(i.get("show")){var n=e.getData();var a=this._polyline;var o=this._endLabel;if(!o){o=this._endLabel=new W({z2:200});o.ignoreClip=true;a.setTextContent(this._endLabel);a.disableLabelAnimation=true}var s=sC(n.getLayout("points"));if(s>=0){mh(a,xh(e,"endLabel"),{inheritColor:r,labelFetcher:e,labelDataIndex:s,defaultText:function(e,t,r){return r!=null?MI(n,r):SI(n,e)},enableTextSetter:true},fC(i,t));a.textConfig.position=null}}else if(this._endLabel){this._polyline.removeTextContent();this._endLabel=null}};t.prototype._endLabelOnDuring=function(e,t,r,i,n,a,o){var s=this._endLabel;var l=this._polyline;if(s){if(e<1&&i.originalX==null){i.originalX=s.x;i.originalY=s.y}var u=r.getLayout("points");var c=r.hostModel;var f=c.get("connectNulls");var h=a.get("precision");var p=a.get("distance")||0;var v=o.getBaseAxis();var d=v.isHorizontal();var g=v.inverse;var y=t.shape;var m=g?d?y.x:y.y+y.height:d?y.x+y.width:y.y;var x=(d?p:0)*(g?-1:1);var _=(d?0:-p)*(g?-1:1);var b=d?"x":"y";var w=uC(u,m,b);var S=w.range;var M=S[1]-S[0];var I=void 0;if(M>=1){if(M>1&&!f){var C=lC(u,S[0]);s.attr({x:C[0]+x,y:C[1]+_});n&&(I=c.getRawValue(S[0]))}else{var C=l.getPointOn(m,b);C&&s.attr({x:C[0]+x,y:C[1]+_});var T=c.getRawValue(S[0]);var D=c.getRawValue(S[1]);n&&(I=oo(r,h,T,D,w.t))}i.lastFrameIndex=S[0]}else{var A=e===1||i.lastFrameIndex>0?S[0]:0;var C=lC(u,A);n&&(I=c.getRawValue(A));s.attr({x:C[0]+x,y:C[1]+_})}if(n){Ah(s).setLabelText(I)}}};t.prototype._doUpdateAnimation=function(e,t,r,i,n,a){var o=this._polyline;var s=this._polygon;var l=e.hostModel;var u=BI(this._data,e,this._stackedOnPoints,t,this._coordSys,r,this._valueOrigin);var c=u.current;var f=u.stackedOnCurrent;var h=u.next;var p=u.stackedOnNext;if(n){c=rC(u.current,r,n);f=rC(u.stackedOnCurrent,r,n);h=rC(u.next,r,n);p=rC(u.stackedOnNext,r,n)}if($I(c,h)>3e3||s&&$I(f,p)>3e3){o.setShape({points:h});if(s){s.setShape({points:h,stackedOnPoints:p})}return}o.shape.__points=u.current;o.shape.points=c;var v={shape:{points:h}};if(u.current!==c){v.shape.__points=u.next}o.stopAnimation();X(o,v,l);if(s){s.setShape({points:c,stackedOnPoints:f});s.stopAnimation();X(s,{shape:{stackedOnPoints:p}},l);if(o.shape.points!==s.shape.points){s.shape.points=o.shape.points}}var d=[];var g=u.status;for(var y=0;y<g.length;y++){var m=g[y].cmd;if(m==="="){var x=e.getItemGraphicEl(g[y].idx1);if(x){d.push({el:x,ptIdx:y})}}}if(o.animators&&o.animators.length){o.animators[0].during(function(){s&&s.dirtyShape();var e=o.shape.__points;for(var t=0;t<d.length;t++){var r=d[t].el;var i=d[t].ptIdx*2;r.x=e[i];r.y=e[i+1];r.markRedraw()}})}};t.prototype.remove=function(e){var r=this.group;var i=this._data;this._lineGroup.removeAll();this._symbolDraw.remove(true);i&&i.eachItemGraphicEl(function(e,t){if(e.__temp){r.remove(e);i.setItemGraphicEl(t,null)}});this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null};t.type="line";return t}(v);function pC(e,s){return{seriesType:e,plan:Iy(),reset:function(e){var t=e.getData();var c=e.coordinateSystem;var r=e.pipelineContext;var f=s||r.large;if(!c){return}var i=A(c.dimensions,function(e){return t.mapDimension(e)}).slice(0,2);var h=i.length;var n=t.getCalculationInfo("stackResultDimension");if(aw(t,i[0])){i[0]=n}if(aw(t,i[1])){i[1]=n}var a=t.getDimensionInfo(i[0]);var o=t.getDimensionInfo(i[1]);var p=a&&a.index;var v=o&&o.index;return h&&{progress:function(e,t){var r=e.end-e.start;var i=f&&RI(r*h);var n=[];var a=[];for(var o=e.start,s=0;o<e.end;o++){var l=void 0;if(h===1){var u=t.getByDimIdx(p,o);l=c.dataToPoint(u,null,a)}else{n[0]=t.getByDimIdx(p,o);n[1]=t.getByDimIdx(v,o);l=c.dataToPoint(n,null,a)}if(f){i[s++]=l[0];i[s++]=l[1]}else{t.setItemLayout(o,l.slice())}}f&&t.setLayout("points",i)}}}}}var vC={average:function(e){var t=0;var r=0;for(var i=0;i<e.length;i++){if(!isNaN(e[i])){t+=e[i];r++}}return r===0?NaN:t/r},sum:function(e){var t=0;for(var r=0;r<e.length;r++){t+=e[r]||0}return t},max:function(e){var t=-Infinity;for(var r=0;r<e.length;r++){e[r]>t&&(t=e[r])}return isFinite(t)?t:NaN},min:function(e){var t=Infinity;for(var r=0;r<e.length;r++){e[r]<t&&(t=e[r])}return isFinite(t)?t:NaN},nearest:function(e){return e[0]}};var dC=function(e){return Math.round(e.length/2)};function gC(e){return{seriesType:e,reset:function(e,t,r){var i=e.getData();var n=e.get("sampling");var a=e.coordinateSystem;var o=i.count();if(o>10&&a.type==="cartesian2d"&&n){var s=a.getBaseAxis();var l=a.getOtherAxis(s);var u=s.getExtent();var c=r.getDevicePixelRatio();var f=Math.abs(u[1]-u[0])*(c||1);var h=Math.round(o/f);if(h>1){if(n==="lttb"){e.setData(i.lttbDownSample(i.mapDimension(l.dim),1/h))}var p=void 0;if(typeof n==="string"){p=vC[n]}else if(typeof n==="function"){p=n}if(p){e.setData(i.downSample(i.mapDimension(l.dim),1/h,p,dC))}}}}}}function yC(e){e.registerChartView(hC);e.registerSeriesModel(wI);e.registerLayout(pC("line",true));e.registerVisual({seriesType:"line",reset:function(e){var t=e.getData();var r=e.getModel("lineStyle").getLineStyle();if(r&&!r.stroke){r.stroke=t.getVisual("style").fill}t.setVisual("legendLineStyle",r)}});e.registerProcessor(e.PRIORITY.PROCESSOR.STATISTIC,gC("line"))}var mC=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.getInitialData=function(e,t){return sw(this.getSource(),this,{useEncodeDefaulter:true})};r.prototype.getMarkerPosition=function(e){var t=this.coordinateSystem;if(t){var r=t.dataToPoint(t.clampData(e));var i=this.getData();var n=i.getLayout("offset");var a=i.getLayout("size");var o=t.getBaseAxis().isHorizontal()?0:1;r[o]+=n+a/2;return r}return[NaN,NaN]};r.type="series.__base_bar__";r.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:true,barMinHeight:0,barMinAngle:0,large:false,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"};return r}(dy);dy.registerClass(mC);var xC=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.getInitialData=function(){return sw(this.getSource(),this,{useEncodeDefaulter:true,createInvertedIndices:!!this.get("realtimeSort",true)||null})};r.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):false};r.prototype.getProgressiveThreshold=function(){var e=this.get("progressiveThreshold");var t=this.get("largeThreshold");if(t>e){e=t}return e};r.prototype.brushSelector=function(e,t,r){return r.rect(t.getItemLayout(e))};r.type="series.bar";r.dependencies=["grid","polar"];r.defaultOption=Uh(mC.defaultOption,{clip:true,roundCap:false,showBackground:false,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:false});return r}(mC);var _C=function(){function e(){this.cx=0;this.cy=0;this.r0=0;this.r=0;this.startAngle=0;this.endAngle=Math.PI*2;this.clockwise=true}return e}();var bC=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="sausage";return t}e.prototype.getDefaultShape=function(){return new _C};e.prototype.buildPath=function(e,t){var r=t.cx;var i=t.cy;var n=Math.max(t.r0||0,0);var a=Math.max(t.r,0);var o=(a-n)*.5;var s=n+o;var l=t.startAngle;var u=t.endAngle;var c=t.clockwise;var f=Math.cos(l);var h=Math.sin(l);var p=Math.cos(u);var v=Math.sin(u);var d=c?u-l<Math.PI*2:l-u<Math.PI*2;if(d){e.moveTo(f*n+r,h*n+i);e.arc(f*s+r,h*s+i,o,-Math.PI+l,l,!c)}e.arc(r,i,a,l,u,!c);e.moveTo(p*a+r,v*a+i);e.arc(p*s+r,v*s+i,o,u-Math.PI*2,u-Math.PI,!c);if(n!==0){e.arc(r,i,n,u,l,c);e.moveTo(f*n+r,v*n+i)}e.closePath()};return e}(m);var wC=[0,0];var SC=Math.max;var MC=Math.min;function IC(e,t){var r=e.getArea&&e.getArea();if(JI(e,"cartesian2d")){var i=e.getBaseAxis();if(i.type!=="category"||!i.onBand){var n=t.getLayout("bandWidth");if(i.isHorizontal()){r.x-=n;r.width+=n*2}else{r.y-=n;r.height+=n*2}}}return r}var CC=function(t){d(r,t);function r(){var e=t.call(this)||this;e.type=r.type;e._isFirstFrame=true;return e}r.prototype.render=function(e,t,r,i){this._model=e;this._removeOnRenderedListener(r);this._updateDrawMode(e);var n=e.get("coordinateSystem");if(n==="cartesian2d"||n==="polar"){this._isLargeDraw?this._renderLarge(e,t,r):this._renderNormal(e,t,r,i)}else if("development"!=="production"){ya("Only cartesian2d and polar supported for bar.")}};r.prototype.incrementalPrepareRender=function(e){this._clear();this._updateDrawMode(e);this._updateLargeClip(e)};r.prototype.incrementalRender=function(e,t){this._incrementalRenderLarge(e,t)};r.prototype._updateDrawMode=function(e){var t=e.pipelineContext.large;if(this._isLargeDraw==null||t!==this._isLargeDraw){this._isLargeDraw=t;this._clear()}};r.prototype._renderNormal=function(u,e,t,r){var c=this.group;var f=u.getData();var h=this._data;var p=u.coordinateSystem;var v=p.getBaseAxis();var d;if(p.type==="cartesian2d"){d=v.isHorizontal()}else if(p.type==="polar"){d=v.dim==="angle"}var g=u.isAnimationEnabled()?u:null;var y=AC(u,p);if(y){this._enableRealtimeSort(y,f,t)}var m=u.get("clip",true)||y;var x=IC(p,f);c.removeClipPath();var _=u.get("roundCap",true);var b=u.get("showBackground",true);var w=u.getModel("backgroundStyle");var S=w.get("borderRadius")||0;var M=[];var I=this._backgroundEls;var C=r&&r.isInitSort;var T=r&&r.type==="changeAxisOrder";function D(e){var t=kC[p.type](f,e);var r=WC(p,d,t);r.useStyle(w.getItemStyle());if(p.type==="cartesian2d"){r.setShape("r",S)}M[e]=r;return r}f.diff(h).add(function(e){var t=f.getItemModel(e);var r=kC[p.type](f,e,t);if(b){D(e)}if(!f.hasValue(e)){return}var i=false;if(m){i=TC[p.type](x,r)}var n=DC[p.type](u,f,e,r,d,g,v.model,false,_);OC(n,f,e,t,r,u,d,p.type==="polar");if(C){n.attr({shape:r})}else if(y){LC(y,g,n,r,e,d,false,false)}else{qf(n,{shape:r},u,e)}f.setItemGraphicEl(e,n);c.add(n);n.ignore=i}).update(function(e,t){var r=f.getItemModel(e);var i=kC[p.type](f,e,r);if(b){var n=void 0;if(I.length===0){n=D(t)}else{n=I[t];n.useStyle(w.getItemStyle());if(p.type==="cartesian2d"){n.setShape("r",S)}M[e]=n}var a=kC[p.type](f,e);var o=HC(d,a,p);X(n,{shape:o},g,e)}var s=h.getItemGraphicEl(t);if(!f.hasValue(e)){c.remove(s);s=null;return}var l=false;if(m){l=TC[p.type](x,i);if(l){c.remove(s)}}if(!s){s=DC[p.type](u,f,e,i,d,g,v.model,!!s,_)}if(!T){OC(s,f,e,r,i,u,d,p.type==="polar")}if(C){s.attr({shape:i})}else if(y){LC(y,g,s,i,e,d,true,T)}else{X(s,{shape:i},u,e,null)}f.setItemGraphicEl(e,s);s.ignore=l;c.add(s)}).remove(function(e){var t=h.getItemGraphicEl(e);t&&Qf(t,u,e)}).execute();var i=this._backgroundGroup||(this._backgroundGroup=new H);i.removeAll();for(var n=0;n<M.length;++n){i.add(M[n])}c.add(i);this._backgroundEls=M;this._data=f};r.prototype._renderLarge=function(e,t,r){this._clear();zC(e,this.group);this._updateLargeClip(e)};r.prototype._incrementalRenderLarge=function(e,t){this._removeBackground();zC(t,this.group,true)};r.prototype._updateLargeClip=function(e){var t=e.get("clip",true)?qI(e.coordinateSystem,false,e):null;if(t){this.group.setClipPath(t)}else{this.group.removeClipPath()}};r.prototype._enableRealtimeSort=function(e,i,t){var r=this;if(!i.count()){return}var n=e.baseAxis;if(this._isFirstFrame){this._dispatchInitSort(i,e,t);this._isFirstFrame=false}else{var a=function(e){var t=i.getItemGraphicEl(e);if(t){var r=t.shape;return(n.isHorizontal()?Math.abs(r.height):Math.abs(r.width))||0}else{return 0}};this._onRendered=function(){r._updateSortWithinSameData(i,a,n,t)};t.getZr().on("rendered",this._onRendered)}};r.prototype._dataSort=function(e,t,i){var n=[];e.each(e.mapDimension(t.dim),function(e,t){var r=i(t);r=r==null?NaN:r;n.push({dataIndex:t,mappedValue:r,ordinalNumber:e})});n.sort(function(e,t){return t.mappedValue-e.mappedValue});return{ordinalNumbers:A(n,function(e){return e.ordinalNumber})}};r.prototype._isOrderChangedWithinSameData=function(e,t,r){var i=r.scale;var n=e.mapDimension(r.dim);var a=Number.MAX_VALUE;for(var o=0,s=i.getOrdinalMeta().categories.length;o<s;++o){var l=e.rawIndexOf(n,i.getRawOrdinalNumber(o));var u=l<0?Number.MIN_VALUE:t(e.indexOfRawIndex(l));if(u>a){return true}a=u}return false};r.prototype._isOrderDifferentInView=function(e,t){var r=t.scale;var i=r.getExtent();var n=Math.max(0,i[0]);var a=Math.min(i[1],r.getOrdinalMeta().categories.length-1);for(;n<=a;++n){if(e.ordinalNumbers[n]!==r.getRawOrdinalNumber(n)){return true}}};r.prototype._updateSortWithinSameData=function(e,t,r,i){if(!this._isOrderChangedWithinSameData(e,t,r)){return}var n=this._dataSort(e,r,t);if(this._isOrderDifferentInView(n,r)){this._removeOnRenderedListener(i);i.dispatchAction({type:"changeAxisOrder",componentType:r.dim+"Axis",axisId:r.index,sortInfo:n})}};r.prototype._dispatchInitSort=function(t,r,e){var i=r.baseAxis;var n=this._dataSort(t,i,function(e){return t.get(t.mapDimension(r.otherAxis.dim),e)});e.dispatchAction({type:"changeAxisOrder",componentType:i.dim+"Axis",isInitSort:true,axisId:i.index,sortInfo:n,animation:{duration:0}})};r.prototype.remove=function(e,t){this._clear(this._model);this._removeOnRenderedListener(t)};r.prototype.dispose=function(e,t){this._removeOnRenderedListener(t)};r.prototype._removeOnRenderedListener=function(e){if(this._onRendered){e.getZr().off("rendered",this._onRendered);this._onRendered=null}};r.prototype._clear=function(t){var e=this.group;var r=this._data;if(t&&t.isAnimationEnabled()&&r&&!this._isLargeDraw){this._removeBackground();this._backgroundEls=[];r.eachItemGraphicEl(function(e){Qf(e,t,j(e).dataIndex)})}else{e.removeAll()}this._data=null;this._isFirstFrame=true};r.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup);this._backgroundGroup=null};r.type="bar";return r}(v);var TC={cartesian2d:function(e,t){var r=t.width<0?-1:1;var i=t.height<0?-1:1;if(r<0){t.x+=t.width;t.width=-t.width}if(i<0){t.y+=t.height;t.height=-t.height}var n=e.x+e.width;var a=e.y+e.height;var o=SC(t.x,e.x);var s=MC(t.x+t.width,n);var l=SC(t.y,e.y);var u=MC(t.y+t.height,a);var c=s<o;var f=u<l;t.x=c&&o>n?s:o;t.y=f&&l>a?u:l;t.width=c?0:s-o;t.height=f?0:u-l;if(r<0){t.x+=t.width;t.width=-t.width}if(i<0){t.y+=t.height;t.height=-t.height}return c||f},polar:function(e,t){var r=t.r0<=t.r?1:-1;if(r<0){var i=t.r;t.r=t.r0;t.r0=i}var n=MC(t.r,e.r);var a=SC(t.r0,e.r0);t.r=n;t.r0=a;var o=n-a<0;if(r<0){var i=t.r;t.r=t.r0;t.r0=i}return o}};var DC={cartesian2d:function(e,t,r,i,n,a,o,s,l){var u=new G({shape:F({},i),z2:1});u.__dataIndex=r;u.name="item";if(a){var c=u.shape;var f=n?"height":"width";c[f]=0}return u},polar:function(e,t,r,i,n,a,o,s,l){var u=i.startAngle<i.endAngle;var c=!n&&l?bC:ef;var f=new c({shape:R({clockwise:u},i),z2:1});f.name="item";if(a){var h=f.shape;var p=n?"r":"endAngle";var v={};h[p]=n?0:i.startAngle;v[p]=i[p];(s?X:qf)(f,{shape:v},a)}return f}};function AC(e,t){var r=e.get("realtimeSort",true);var i=t.getBaseAxis();if("development"!=="production"){if(r){if(i.type!=="category"){ya("`realtimeSort` will not work because this bar series is not based on a category axis.")}if(t.type!=="cartesian2d"){ya("`realtimeSort` will not work because this bar series is not on cartesian2d.")}}}if(r&&i.type==="category"&&t.type==="cartesian2d"){return{baseAxis:i,otherAxis:t.getOtherAxis(i)}}}function LC(e,t,r,i,n,a,o,s){var l;var u;if(a){u={x:i.x,width:i.width};l={y:i.y,height:i.height}}else{u={y:i.y,height:i.height};l={x:i.x,width:i.width}}if(!s){(o?X:qf)(r,{shape:l},t,n,null)}var c=t?e.baseAxis.model:null;(o?X:qf)(r,{shape:u},c,n)}var kC={cartesian2d:function(e,t,r){var i=e.getItemLayout(t);var n=r?NC(r,i):0;var a=i.width>0?1:-1;var o=i.height>0?1:-1;return{x:i.x+a*n/2,y:i.y+o*n/2,width:i.width-a*n,height:i.height-o*n}},polar:function(e,t,r){var i=e.getItemLayout(t);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle}}};function PC(e){return e.startAngle!=null&&e.endAngle!=null&&e.startAngle===e.endAngle}function OC(e,t,r,i,n,a,o,s){var l=t.getItemVisual(r,"style");if(!s){e.setShape("r",i.get(["itemStyle","borderRadius"])||0)}e.useStyle(l);var u=i.getShallow("cursor");u&&e.attr("cursor",u);if(!s){var c=o?n.height>0?"bottom":"top":n.width>0?"left":"right";var f=xh(i);mh(e,f,{labelFetcher:a,labelDataIndex:r,defaultText:SI(a.getData(),r),inheritColor:l.fill,defaultOpacity:l.opacity,defaultOutsidePosition:c});var h=e.getTextContent();Lh(h,f,a.getRawValue(r),function(e){return MI(t,e)})}var p=i.getModel(["emphasis"]);tc(e,p.get("focus"),p.get("blurScope"));ac(e,i);if(PC(n)){e.style.fill="none";e.style.stroke="none";U(e.states,function(e){if(e.style){e.style.fill=e.style.stroke="none"}})}}function NC(e,t){var r=e.get(["itemStyle","borderColor"]);if(!r||r==="none"){return 0}var i=e.get(["itemStyle","borderWidth"])||0;var n=isNaN(t.width)?Number.MAX_VALUE:Math.abs(t.width);var a=isNaN(t.height)?Number.MAX_VALUE:Math.abs(t.height);return Math.min(i,n,a)}var EC=function(){function e(){}return e}();var RC=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="largeBar";return t}e.prototype.getDefaultShape=function(){return new EC};e.prototype.buildPath=function(e,t){var r=t.points;var i=this.__startPoint;var n=this.__baseDimIdx;for(var a=0;a<r.length;a+=2){i[n]=r[a+n];e.moveTo(i[0],i[1]);e.lineTo(r[a],r[a+1])}};return e}(m);function zC(e,t,r){var i=e.getData();var n=[];var a=i.getLayout("valueAxisHorizontal")?1:0;n[1-a]=i.getLayout("valueAxisStart");var o=i.getLayout("largeDataIndices");var s=i.getLayout("barWidth");var l=e.getModel("backgroundStyle");var u=e.get("showBackground",true);if(u){var c=i.getLayout("largeBackgroundPoints");var f=[];f[1-a]=i.getLayout("backgroundStart");var h=new RC({shape:{points:c},incremental:!!r,silent:true,z2:0});h.__startPoint=f;h.__baseDimIdx=a;h.__largeDataIndices=o;h.__barWidth=s;FC(h,l,i);t.add(h)}var p=new RC({shape:{points:i.getLayout("largePoints")},incremental:!!r});p.__startPoint=n;p.__baseDimIdx=a;p.__largeDataIndices=o;p.__barWidth=s;t.add(p);GC(p,e,i);j(p).seriesIndex=e.seriesIndex;if(!e.get("silent")){p.on("mousedown",BC);p.on("mousemove",BC)}}var BC=Ry(function(e){var t=this;var r=VC(t,e.offsetX,e.offsetY);j(t).dataIndex=r>=0?r:null},30,false);function VC(e,t,r){var i=e.__baseDimIdx;var n=1-i;var a=e.shape.points;var o=e.__largeDataIndices;var s=Math.abs(e.__barWidth/2);var l=e.__startPoint[n];wC[0]=t;wC[1]=r;var u=wC[i];var c=wC[1-i];var f=u-s;var h=u+s;for(var p=0,v=a.length/2;p<v;p++){var d=p*2;var g=a[d+i];var y=a[d+n];if(g>=f&&g<=h&&(l<=y?c>=l&&c<=y:c>=y&&c<=l)){return o[p]}}return-1}function GC(e,t,r){var i=r.getVisual("style");e.useStyle(F({},i));e.style.fill=null;e.style.stroke=i.fill;e.style.lineWidth=r.getLayout("barWidth")}function FC(e,t,r){var i=t.get("borderColor")||t.get("color");var n=t.getItemStyle();e.useStyle(n);e.style.fill=null;e.style.stroke=i;e.style.lineWidth=r.getLayout("barWidth")}function HC(e,t,r){if(JI(r,"cartesian2d")){var i=t;var n=r.getArea();return{x:e?i.x:n.x,y:e?n.y:i.y,width:e?i.width:n.width,height:e?n.height:i.height}}else{var n=r.getArea();var a=t;return{cx:n.cx,cy:n.cy,r0:e?n.r0:a.r0,r:e?n.r:a.r,startAngle:e?a.startAngle:0,endAngle:e?a.endAngle:Math.PI*2}}}function WC(e,t,r){var i=e.type==="polar"?ef:G;return new i({shape:HC(t,r,e),silent:true,z2:0})}function jC(e){e.registerChartView(CC);e.registerSeriesModel(xC);e.registerLayout(e.PRIORITY.VISUAL.LAYOUT,_(Ew,"bar"));e.registerLayout(e.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,Rw);e.registerProcessor(e.PRIORITY.PROCESSOR.STATISTIC,gC("bar"));e.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(t,e){var r=t.componentType||"series";e.eachComponent({mainType:r,query:t},function(e){if(t.sortInfo){e.axis.setCategorySortInfo(t.sortInfo)}})})}var UC=Math.PI*2;var ZC=Math.PI/180;function YC(e,t){return sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function XC(e,t,T){t.eachSeriesByType(e,function(e){var n=e.getData();var t=n.mapDimension("value");var r=YC(e,T);var i=e.get("center");var a=e.get("radius");if(!k(a)){a=[0,a]}if(!k(i)){i=[i,i]}var o=Y(r.width,T.getWidth());var s=Y(r.height,T.getHeight());var l=Math.min(o,s);var u=Y(i[0],o)+r.x;var c=Y(i[1],s)+r.y;var f=Y(a[0],l/2);var h=Y(a[1],l/2);var p=-e.get("startAngle")*ZC;var v=e.get("minAngle")*ZC;var d=0;n.each(t,function(e){!isNaN(e)&&d++});var g=n.getSum(t);var y=Math.PI/(g||d)*2;var m=e.get("clockwise");var x=e.get("roseType");var _=e.get("stillShowZeroSum");var b=n.getDataExtent(t);b[0]=0;var w=UC;var S=0;var M=p;var I=m?1:-1;n.setLayout({viewRect:r,r:h});n.each(t,function(e,t){var r;if(isNaN(e)){n.setItemLayout(t,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:m,cx:u,cy:c,r0:f,r:x?NaN:h});return}if(x!=="area"){r=g===0&&_?y:e*y}else{r=UC/d}if(r<v){r=v;w-=v}else{S+=e}var i=M+I*r;n.setItemLayout(t,{angle:r,startAngle:M,endAngle:i,clockwise:m,cx:u,cy:c,r0:f,r:x?V(e,b,[f,h]):h});M=i});if(w<UC&&d){if(w<=.001){var C=UC/d;n.each(t,function(e,t){if(!isNaN(e)){var r=n.getItemLayout(t);r.angle=C;r.startAngle=p+I*t*C;r.endAngle=p+I*(t+1)*C}})}else{y=w/S;M=p;n.each(t,function(e,t){if(!isNaN(e)){var r=n.getItemLayout(t);var i=r.angle===v?v:e*y;r.startAngle=M;r.endAngle=M+I*i;M+=I*i}})}}})}function qC(e){return{seriesType:e,reset:function(e,t){var i=t.findComponents({mainType:"legend"});if(!i||!i.length){return}var n=e.getData();n.filterSelf(function(e){var t=n.getName(e);for(var r=0;r<i.length;r++){if(!i[r].isSelected(t)){return false}}return true})}}}var JC=Math.PI/180;function KC(e,c,f,h,p,t,r,i,n,a){if(e.length<2){return}function v(e){var t=e.rB;var r=t*t;for(var i=0;i<e.list.length;i++){var n=e.list[i];var a=Math.abs(n.label.y-f);var o=h+n.len;var s=o*o;var l=Math.sqrt((1-Math.abs(a*a/r))*s);n.label.x=c+(l+n.len2)*p}}function o(e){var t={list:[],maxY:0};var r={list:[],maxY:0};for(var i=0;i<e.length;i++){if(e[i].labelAlignTo!=="none"){continue}var n=e[i];var a=n.label.y>f?r:t;var o=Math.abs(n.label.y-f);if(o>a.maxY){var s=n.label.x-c-n.len2*p;var l=h+n.len;var u=Math.abs(s)<l?Math.sqrt(o*o/(1-s*s/l/l)):l;a.rB=u;a.maxY=o}a.list.push(n)}v(t);v(r)}var s=e.length;for(var l=0;l<s;l++){if(e[l].position==="outer"&&e[l].labelAlignTo==="labelLine"){var u=e[l].label.x-a;e[l].linePoints[1][0]+=u;e[l].label.x=a}}if(Km(e,n,n+r)){o(e)}}function QC(e,t,r,i,n,a,o,s){var l=[];var u=[];var c=Number.MAX_VALUE;var f=-Number.MAX_VALUE;for(var h=0;h<e.length;h++){var p=e[h].label;if($C(e[h])){continue}if(p.x<t){c=Math.min(c,p.x);l.push(e[h])}else{f=Math.max(f,p.x);u.push(e[h])}}KC(u,t,r,i,1,n,a,o,s,f);KC(l,t,r,i,-1,n,a,o,s,c);for(var h=0;h<e.length;h++){var v=e[h];var p=v.label;if($C(v)){continue}var d=v.linePoints;if(d){var g=v.labelAlignTo==="edge";var y=v.rect.width;var m=void 0;if(g){if(p.x<t){m=d[2][0]-v.labelDistance-o-v.edgeDistance}else{m=o+n-v.edgeDistance-d[2][0]-v.labelDistance}}else{if(p.x<t){m=p.x-o-v.bleedMargin}else{m=o+n-p.x-v.bleedMargin}}if(m<v.rect.width){v.label.style.width=m;if(v.labelAlignTo==="edge"){y=m}}var x=d[1][0]-d[2][0];if(g){if(p.x<t){d[2][0]=o+v.edgeDistance+y+v.labelDistance}else{d[2][0]=o+n-v.edgeDistance-y-v.labelDistance}}else{if(p.x<t){d[2][0]=p.x+v.labelDistance}else{d[2][0]=p.x-v.labelDistance}d[1][0]=d[2][0]+x}d[1][1]=d[2][1]=p.y}}}function $C(e){return e.position==="center"}function e2(e){var N=e.getData();var E=[];var R;var z;var B=false;var V=(e.get("minShowLabelAngle")||0)*JC;var t=N.getLayout("viewRect");var G=N.getLayout("r");var F=t.width;var H=t.x;var r=t.y;var i=t.height;function W(e){e.ignore=true}function j(e){if(!e.ignore){return true}for(var t in e.states){if(e.states[t].ignore===false){return true}}return false}N.each(function(e){var t=N.getItemGraphicEl(e);var r=t.shape;var i=t.getTextContent();var n=t.getTextGuideLine();var a=N.getItemModel(e);var o=a.getModel("label");var s=o.get("position")||a.get(["emphasis","label","position"]);var l=o.get("distanceToLabelLine");var u=o.get("alignTo");var c=Y(o.get("edgeDistance"),F);var f=o.get("bleedMargin");var h=a.getModel("labelLine");var p=h.get("length");p=Y(p,F);var v=h.get("length2");v=Y(v,F);if(Math.abs(r.endAngle-r.startAngle)<V){U(i.states,W);i.ignore=true;return}if(!j(i)){return}var d=(r.startAngle+r.endAngle)/2;var g=Math.cos(d);var y=Math.sin(d);var m;var x;var _;var b;R=r.cx;z=r.cy;var w=s==="inside"||s==="inner";if(s==="center"){m=r.cx;x=r.cy;b="center"}else{var S=(w?(r.r+r.r0)/2*g:r.r*g)+R;var M=(w?(r.r+r.r0)/2*y:r.r*y)+z;m=S+g*3;x=M+y*3;if(!w){var I=S+g*(p+G-r.r);var C=M+y*(p+G-r.r);var T=I+(g<0?-1:1)*v;var D=C;if(u==="edge"){m=g<0?H+c:H+F-c}else{m=T+(g<0?-l:l)}x=D;_=[[S,M],[I,C],[T,D]]}b=w?"center":u==="edge"?g>0?"right":"left":g>0?"left":"right"}var A;var L=o.get("rotate");if(typeof L==="number"){A=L*(Math.PI/180)}else{A=L?g<0?-d+Math.PI:-d:0}B=!!A;i.x=m;i.y=x;i.rotation=A;i.setStyle({verticalAlign:"middle"});if(!w){var k=i.getBoundingRect().clone();k.applyTransform(i.getComputedTransform());var P=(i.style.margin||0)+2.1;k.y-=P/2;k.height+=P;E.push({label:i,labelLine:n,position:s,len:p,len2:v,minTurnAngle:h.get("minTurnAngle"),maxSurfaceAngle:h.get("maxSurfaceAngle"),surfaceNormal:new Z(g,y),linePoints:_,textAlign:b,labelDistance:l,labelAlignTo:u,edgeDistance:c,bleedMargin:f,rect:k})}else{i.setStyle({align:b});var O=i.states.select;if(O){O.x+=i.x;O.y+=i.y}}t.setTextConfig({inside:w})});if(!B&&e.get("avoidLabelOverlap")){QC(E,R,z,G,F,i,H,r)}for(var n=0;n<E.length;n++){var a=E[n];var o=a.label;var s=a.labelLine;var l=isNaN(o.x)||isNaN(o.y);if(o){o.setStyle({align:a.textAlign});if(l){U(o.states,W);o.ignore=true}var u=o.states.select;if(u){u.x+=o.x;u.y+=o.y}}if(s){var c=a.linePoints;if(l||!c){U(s.states,W);s.ignore=true}else{Hm(c,a.minTurnAngle);Wm(c,a.surfaceNormal,a.maxSurfaceAngle);s.setShape({points:c});o.__hostTarget.textGuideLineConfig={anchor:new Z(c[0][0],c[0][1])}}}}}function t2(e,t){var r=e.get("borderRadius");if(r==null){return null}if(!k(r)){r=[r,r]}return{innerCornerRadius:yn(r[0],t.r0),cornerRadius:yn(r[1],t.r)}}var r2=function(a){d(e,a);function e(e,t,r){var i=a.call(this)||this;i.z2=2;var n=new W;i.setTextContent(n);i.updateData(e,t,r,true);return i}e.prototype.updateData=function(e,t,r,i){var n=this;var a=e.hostModel;var o=e.getItemModel(t);var s=o.getModel("emphasis");var l=e.getItemLayout(t);var u=F(t2(o.getModel("itemStyle"),l)||{},l);if(isNaN(u.startAngle)){n.setShape(u);return}if(i){n.setShape(u);var c=a.getShallow("animationType");if(c==="scale"){n.shape.r=l.r0;qf(n,{shape:{r:l.r}},a,t)}else{if(r!=null){n.setShape({startAngle:r,endAngle:r});qf(n,{shape:{startAngle:l.startAngle,endAngle:l.endAngle}},a,t)}else{n.shape.endAngle=l.startAngle;X(n,{shape:{endAngle:l.endAngle}},a,t)}}}else{X(n,{shape:u},a,t)}n.useStyle(e.getItemVisual(t,"style"));ac(n,o);var f=(l.startAngle+l.endAngle)/2;var h=a.get("selectedOffset");var p=Math.cos(f)*h;var v=Math.sin(f)*h;var d=o.getShallow("cursor");d&&n.attr("cursor",d);this._updateLabel(a,e,t);n.ensureState("emphasis").shape=w({r:l.r+(s.get("scale")?s.get("scaleSize")||0:0)},t2(s.getModel("itemStyle"),l));F(n.ensureState("select"),{x:p,y:v,shape:t2(o.getModel(["select","itemStyle"]),l)});F(n.ensureState("blur"),{shape:t2(o.getModel(["blur","itemStyle"]),l)});var g=n.getTextGuideLine();var y=n.getTextContent();g&&F(g.ensureState("select"),{x:p,y:v});F(y.ensureState("select"),{x:p,y:v});tc(this,s.get("focus"),s.get("blurScope"))};e.prototype._updateLabel=function(e,t,r){var i=this;var n=t.getItemModel(r);var a=n.getModel("labelLine");var o=t.getItemVisual(r,"style");var s=o&&o.fill;var l=o&&o.opacity;mh(i,xh(n),{labelFetcher:t.hostModel,labelDataIndex:r,inheritColor:s,defaultOpacity:l,defaultText:e.getFormattedLabel(r,"normal")||t.getName(r)});var u=i.getTextContent();i.setTextConfig({position:null,rotation:null});u.attr({z2:10});var c=e.get(["label","position"]);if(c!=="outside"&&c!=="outer"){i.removeTextGuideLine()}else{var f=this.getTextGuideLine();if(!f){f=new ff;this.setTextGuideLine(f)}Zm(this,Ym(n),{stroke:s,opacity:we(a.get(["lineStyle","opacity"]),l,1)})}};return e}(ef);var i2=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.ignoreLabelLineUpdate=true;return e}e.prototype.init=function(){var e=new H;this._sectorGroup=e};e.prototype.render=function(r,e,t,i){var n=r.getData();var a=this._data;var o=this.group;var s;if(!a&&n.count()>0){var l=n.getItemLayout(0);for(var u=1;isNaN(l&&l.startAngle)&&u<n.count();++u){l=n.getItemLayout(u)}if(l){s=l.startAngle}}n.diff(a).add(function(e){var t=new r2(n,e,s);n.setItemGraphicEl(e,t);o.add(t)}).update(function(e,t){var r=a.getItemGraphicEl(t);r.updateData(n,e,s);r.off("click");o.add(r);n.setItemGraphicEl(e,r)}).remove(function(e){var t=a.getItemGraphicEl(e);Qf(t,r,e)}).execute();e2(r);if(r.get("animationTypeUpdate")!=="expansion"){this._data=n}};e.prototype.dispose=function(){};e.prototype.containPoint=function(e,t){var r=t.getData();var i=r.getItemLayout(0);if(i){var n=e[0]-i.cx;var a=e[1]-i.cy;var o=Math.sqrt(n*n+a*a);return o<=i.r&&o>=i.r0}};e.type="pie";return e}(v);function n2(e,t,r){t=k(t)&&{coordDimensions:t}||F({},t);var i=e.getSource();var n=$b(i,t);var a=new qb(n,e);a.initData(i,r);return a}var a2=function(){function e(e,t){this._getDataWithEncodedVisual=e;this._getRawData=t}e.prototype.getAllNames=function(){var e=this._getRawData();return e.mapArray(e.getName)};e.prototype.containName=function(e){var t=this._getRawData();return t.indexOfName(e)>=0};e.prototype.indexOfName=function(e){var t=this._getDataWithEncodedVisual();return t.indexOfName(e)};e.prototype.getItemVisual=function(e,t){var r=this._getDataWithEncodedVisual();return r.getItemVisual(e,t)};return e}();var o2=function(n){d(e,n);function e(){var e=n!==null&&n.apply(this,arguments)||this;e.useColorPaletteOnData=true;return e}e.prototype.init=function(e){n.prototype.init.apply(this,arguments);this.legendVisualProvider=new a2(x(this.getData,this),x(this.getRawData,this));this._defaultLabelLine(e)};e.prototype.mergeOption=function(){n.prototype.mergeOption.apply(this,arguments)};e.prototype.getInitialData=function(){return n2(this,{coordDimensions:["value"],encodeDefaulter:_(Pv,this)})};e.prototype.getDataParams=function(e){var t=this.getData();var r=n.prototype.getDataParams.call(this,e);var i=[];t.each(t.mapDimension("value"),function(e){i.push(e)});r.percent=Kn(i,e,t.hostModel.get("percentPrecision"));r.$vars.push("percent");return r};e.prototype._defaultLabelLine=function(e){Ca(e,"labelLine",["show"]);var t=e.labelLine;var r=e.emphasis.labelLine;t.show=t.show&&e.label.show;r.show=r.show&&e.emphasis.label.show};e.type="series.pie";e.defaultOption={zlevel:0,z:2,legendHoverLink:true,center:["50%","50%"],radius:[0,"75%"],clockwise:true,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:true,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:true,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:true,length:15,length2:15,smooth:false,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1},labelLayout:{hideOverlap:true},emphasis:{scale:true,scaleSize:5},avoidLabelOverlap:true,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"};return e}(dy);function s2(e){e.registerChartView(i2);e.registerSeriesModel(o2);l0("pie",e.registerAction);e.registerLayout(_(XC,"pie"));e.registerProcessor(qC("pie"))}var l2=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.hasSymbolVisual=true;return e}r.prototype.getInitialData=function(e,t){return sw(this.getSource(),this,{useEncodeDefaulter:true})};r.prototype.getProgressive=function(){var e=this.option.progressive;if(e==null){return this.option.large?5e3:this.get("progressive")}return e};r.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;if(e==null){return this.option.large?1e4:this.get("progressiveThreshold")}return e};r.prototype.brushSelector=function(e,t,r){return r.point(t.getItemLayout(e))};r.type="series.scatter";r.dependencies=["grid","polar","geo","singleAxis","calendar"];r.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:true,symbolSize:10,large:false,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:true},clip:true,select:{itemStyle:{borderColor:"#212121"}}};return r}(dy);var u2=4;var c2=function(){function e(){}return e}();var f2=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new c2};e.prototype.buildPath=function(e,t){var r=t.points;var i=t.size;var n=this.symbolProxy;var a=n.shape;var o=e.getContext?e.getContext():e;var s=o&&i[0]<u2;if(s){this._ctx=o;return}this._ctx=null;for(var l=0;l<r.length;){var u=r[l++];var c=r[l++];if(isNaN(u)||isNaN(c)){continue}if(this.softClipShape&&!this.softClipShape.contain(u,c)){continue}a.x=u-i[0]/2;a.y=c-i[1]/2;a.width=i[0];a.height=i[1];n.buildPath(e,a,true)}};e.prototype.afterBrush=function(){var e=this.shape;var t=e.points;var r=e.size;var i=this._ctx;if(!i){return}for(var n=0;n<t.length;){var a=t[n++];var o=t[n++];if(isNaN(a)||isNaN(o)){continue}if(this.softClipShape&&!this.softClipShape.contain(a,o)){continue}i.fillRect(a-r[0]/2,o-r[1]/2,r[0],r[1])}};e.prototype.findDataIndex=function(e,t){var r=this.shape;var i=r.points;var n=r.size;var a=Math.max(n[0],4);var o=Math.max(n[1],4);for(var s=i.length/2-1;s>=0;s--){var l=s*2;var u=i[l]-a/2;var c=i[l+1]-o/2;if(e>=u&&t>=c&&e<=u+a&&t<=c+o){return s}}return-1};return e}(m);var h2=function(){function e(){this.group=new H}e.prototype.isPersistent=function(){return!this._incremental};e.prototype.updateData=function(e,t){this.group.removeAll();var r=new f2({rectHover:true,cursor:"default"});r.setShape({points:e.getLayout("points")});this._setCommon(r,e,false,t);this.group.add(r);this._incremental=null};e.prototype.updateLayout=function(e){if(this._incremental){return}var i=e.getLayout("points");this.group.eachChild(function(e){if(e.startIndex!=null){var t=(e.endIndex-e.startIndex)*2;var r=e.startIndex*4*2;i=new Float32Array(i.buffer,r,t)}e.setShape("points",i)})};e.prototype.incrementalPrepareUpdate=function(e){this.group.removeAll();this._clearIncremental();if(e.count()>2e6){if(!this._incremental){this._incremental=new kf({silent:true})}this.group.add(this._incremental)}else{this._incremental=null}};e.prototype.incrementalUpdate=function(e,t,r){var i;if(this._incremental){i=new f2;this._incremental.addDisplayable(i,true)}else{i=new f2({rectHover:true,cursor:"default",startIndex:e.start,endIndex:e.end});i.incremental=true;this.group.add(i)}i.setShape({points:t.getLayout("points")});this._setCommon(i,t,!!this._incremental,r)};e.prototype._setCommon=function(r,e,t,i){var n=e.hostModel;i=i||{};var a=e.getVisual("symbolSize");r.setShape("size",a instanceof Array?a:[a,a]);r.softClipShape=i.clipShape||null;r.symbolProxy=S0(e.getVisual("symbol"),0,0,0,0);r.setColor=r.symbolProxy.setColor;var o=r.shape.size[0]<u2;r.useStyle(n.getModel("itemStyle").getItemStyle(o?["color","shadowBlur","shadowColor"]:["color"]));var s=e.getVisual("style");var l=s&&s.fill;if(l){r.setColor(l)}if(!t){var u=j(r);u.seriesIndex=n.seriesIndex;r.on("mousemove",function(e){u.dataIndex=null;var t=r.findDataIndex(e.offsetX,e.offsetY);if(t>=0){u.dataIndex=t+(r.startIndex||0)}})}};e.prototype.remove=function(){this._clearIncremental();this._incremental=null;this.group.removeAll()};e.prototype._clearIncremental=function(){var e=this._incremental;if(e){e.clearDisplaybles()}};return e}();var p2=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var i=e.getData();var n=this._updateSymbolDraw(i,e);n.updateData(i,{clipShape:this._getClipShape(e)});this._finished=true};r.prototype.incrementalPrepareRender=function(e,t,r){var i=e.getData();var n=this._updateSymbolDraw(i,e);n.incrementalPrepareUpdate(i);this._finished=false};r.prototype.incrementalRender=function(e,t,r){this._symbolDraw.incrementalUpdate(e,t.getData(),{clipShape:this._getClipShape(t)});this._finished=e.end===t.getData().count()};r.prototype.updateTransform=function(e,t,r){var i=e.getData();this.group.dirty();if(!this._finished||i.count()>1e4||!this._symbolDraw.isPersistent()){return{update:true}}else{var n=pC("").reset(e,t,r);if(n.progress){n.progress({start:0,end:i.count(),count:i.count()},i)}this._symbolDraw.updateLayout(i)}};r.prototype._getClipShape=function(e){var t=e.coordinateSystem;var r=t&&t.getArea&&t.getArea();return e.get("clip",true)?r:null};r.prototype._updateSymbolDraw=function(e,t){var r=this._symbolDraw;var i=t.pipelineContext;var n=i.large;if(!r||n!==this._isLargeDraw){r&&r.remove();r=this._symbolDraw=n?new h2:new LI;this._isLargeDraw=n;this.group.removeAll()}this.group.add(r.group);return r};r.prototype.remove=function(e,t){this._symbolDraw&&this._symbolDraw.remove(true);this._symbolDraw=null};r.prototype.dispose=function(){};r.type="scatter";return r}(v);var v2=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.type="grid";t.dependencies=["xAxis","yAxis"];t.layoutMode="box";t.defaultOption={show:false,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:false,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"};return t}(p);var d2=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",$a).models[0]};t.type="cartesian2dAxis";return t}(p);oe(d2,IS);var g2={show:true,zlevel:0,z:0,inverse:false,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:false,triggerEvent:false,tooltip:{show:false},axisPointer:{},axisLine:{show:true,onZero:true,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:true,inside:false,length:5,lineStyle:{width:1}},axisLabel:{show:true,inside:false,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:true,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:false,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}};var y2=y({boundaryGap:true,deduplication:null,splitLine:{show:false},axisTick:{alignWithLabel:false,interval:"auto"},axisLabel:{interval:"auto"}},g2);var m2=y({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:false,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:false,lineStyle:{color:"#F4F7FD",width:1}}},g2);var x2=y({scale:true,splitNumber:6,axisLabel:{showMinLabel:false,showMaxLabel:false,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:false}},m2);var _2=R({scale:true,logBase:10},m2);var b2={category:y2,value:m2,time:x2,log:_2};var w2={value:1,category:1,time:1,log:1};function S2(i,n,o,s){U(w2,function(e,a){var t=y(y({},b2[a],true),s,true);var r=function(i){d(e,i);function e(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=i.apply(this,e)||this;r.type=n+"Axis."+a;return r}e.prototype.mergeDefaultAndTheme=function(e,t){var r=cv(this);var i=r?hv(e):{};var n=t.getTheme();y(e,n.get(a+"Axis"));y(e,this.getDefaultOption());e.type=M2(e);if(r){fv(e,i,r)}};e.prototype.optionUpdated=function(){var e=this.option;if(e.type==="category"){this.__ordinalMeta=fw.createByAxisModel(this)}};e.prototype.getCategories=function(e){var t=this.option;if(t.type==="category"){if(e){return t.data}return this.__ordinalMeta.categories}};e.prototype.getOrdinalMeta=function(){return this.__ordinalMeta};e.type=n+"Axis."+a;e.defaultOption=t;return e}(o);i.registerComponentModel(r)});i.registerSubTypeDefaulter(n+"Axis",M2)}function M2(e){return e.type||(e.data?"category":"value")}var I2=function(){function e(e){this.type="cartesian";this._dimList=[];this._axes={};this.name=e||""}e.prototype.getAxis=function(e){return this._axes[e]};e.prototype.getAxes=function(){return A(this._dimList,function(e){return this._axes[e]},this)};e.prototype.getAxesByScale=function(t){t=t.toLowerCase();return ue(this.getAxes(),function(e){return e.scale.type===t})};e.prototype.addAxis=function(e){var t=e.dim;this._axes[t]=e;this._dimList.push(t)};return e}();var C2=["x","y"];function T2(e){return e.type==="interval"||e.type==="time"}var D2=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="cartesian2d";e.dimensions=C2;return e}e.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var e=this.getAxis("x").scale;var t=this.getAxis("y").scale;if(!T2(e)||!T2(t)){return}var r=e.getExtent();var i=t.getExtent();var n=this.dataToPoint([r[0],i[0]]);var a=this.dataToPoint([r[1],i[1]]);var o=r[1]-r[0];var s=i[1]-i[0];if(!o||!s){return}var l=(a[0]-n[0])/o;var u=(a[1]-n[1])/s;var c=n[0]-r[0]*l;var f=n[1]-i[0]*u;var h=this._transform=[l,0,0,u,c,f];this._invTransform=Vi([],h)};e.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")};e.prototype.containPoint=function(e){var t=this.getAxis("x");var r=this.getAxis("y");return t.contain(t.toLocalCoord(e[0]))&&r.contain(r.toLocalCoord(e[1]))};e.prototype.containData=function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])};e.prototype.dataToPoint=function(e,t,r){r=r||[];var i=e[0];var n=e[1];if(this._transform&&i!=null&&isFinite(i)&&n!=null&&isFinite(n)){return rt(r,e,this._transform)}var a=this.getAxis("x");var o=this.getAxis("y");r[0]=a.toGlobalCoord(a.dataToCoord(i,t));r[1]=o.toGlobalCoord(o.dataToCoord(n,t));return r};e.prototype.clampData=function(e,t){var r=this.getAxis("x").scale;var i=this.getAxis("y").scale;var n=r.getExtent();var a=i.getExtent();var o=r.parse(e[0]);var s=i.parse(e[1]);t=t||[];t[0]=Math.min(Math.max(Math.min(n[0],n[1]),o),Math.max(n[0],n[1]));t[1]=Math.min(Math.max(Math.min(a[0],a[1]),s),Math.max(a[0],a[1]));return t};e.prototype.pointToData=function(e,t){var r=[];if(this._invTransform){return rt(r,e,this._invTransform)}var i=this.getAxis("x");var n=this.getAxis("y");r[0]=i.coordToData(i.toLocalCoord(e[0]),t);r[1]=n.coordToData(n.toLocalCoord(e[1]),t);return r};e.prototype.getOtherAxis=function(e){return this.getAxis(e.dim==="x"?"y":"x")};e.prototype.getArea=function(){var e=this.getAxis("x").getGlobalExtent();var t=this.getAxis("y").getGlobalExtent();var r=Math.min(e[0],e[1]);var i=Math.min(t[0],t[1]);var n=Math.max(e[0],e[1])-r;var a=Math.max(t[0],t[1])-i;return new B(r,i,n,a)};return e}(I2);var A2=function(o){d(e,o);function e(e,t,r,i,n){var a=o.call(this,e,t,r)||this;a.index=0;a.type=i||"value";a.position=n||"bottom";return a}e.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"};e.prototype.getGlobalExtent=function(e){var t=this.getExtent();t[0]=this.toGlobalCoord(t[0]);t[1]=this.toGlobalCoord(t[1]);e&&t[0]>t[1]&&t.reverse();return t};e.prototype.pointToData=function(e,t){return this.coordToData(this.toLocalCoord(e[this.dim==="x"?0:1]),t)};e.prototype.setCategorySortInfo=function(e){if(this.type!=="category"){return false}this.model.option.categorySortInfo=e;this.scale.setSortInfo(e)};return e}($S);function L2(e,t,r){r=r||{};var i=e.coordinateSystem;var n=t.axis;var a={};var o=n.getAxesOnZeroOf()[0];var s=n.position;var l=o?"onZero":s;var u=n.dim;var c=i.getRect();var f=[c.x,c.x+c.width,c.y,c.y+c.height];var h={left:0,right:1,top:0,bottom:1,onZero:2};var p=t.get("offset")||0;var v=u==="x"?[f[2]-p,f[3]+p]:[f[0]-p,f[1]+p];if(o){var d=o.toGlobalCoord(o.dataToCoord(0));v[h.onZero]=Math.max(Math.min(d,v[1]),v[0])}a.position=[u==="y"?v[h[l]]:f[0],u==="x"?v[h[l]]:f[3]];a.rotation=Math.PI/2*(u==="x"?0:1);var g={top:-1,bottom:1,left:-1,right:1};a.labelDirection=a.tickDirection=a.nameDirection=g[s];a.labelOffset=o?v[h[s]]-v[h.onZero]:0;if(t.get(["axisTick","inside"])){a.tickDirection=-a.tickDirection}if(be(r.labelInside,t.get(["axisLabel","inside"]))){a.labelDirection=-a.labelDirection}var y=t.get(["axisLabel","rotate"]);a.labelRotate=l==="top"?-y:y;a.z2=1;return a}function k2(e){return e.get("coordinateSystem")==="cartesian2d"}function P2(n){var a={xAxisModel:null,yAxisModel:null};U(a,function(e,t){var r=t.replace(/Model$/,"");var i=n.getReferringComponents(r,$a).models[0];if("development"!=="production"){if(!i){throw new Error(r+' "'+we(n.get(r+"Index"),n.get(r+"Id"),0)+'" not found')}}a[t]=i});return a}var O2=function(){function o(e,t,r){this.type="grid";this._coordsMap={};this._coordsList=[];this._axesMap={};this._axesList=[];this.axisPointerEnabled=true;this.dimensions=C2;this._initCartesian(e,t,r);this.model=e}o.prototype.getRect=function(){return this._rect};o.prototype.update=function(e,t){var r=this._axesMap;this._updateScale(e,this.model);U(r.x,function(e){vS(e.scale,e.model)});U(r.y,function(e){vS(e.scale,e.model)});var i={};U(r.x,function(e){E2(r,"y",e,i)});U(r.y,function(e){E2(r,"x",e,i)});this.resize(this.model,t)};o.prototype.resize=function(e,t,r){var i=e.getBoxLayoutParams();var n=!r&&e.get("containLabel");var a=sv(i,{width:t.getWidth(),height:t.getHeight()});this._rect=a;var o=this._axesList;s();if(n){U(o,function(e){if(!e.model.get(["axisLabel","inside"])){var t=xS(e);if(t){var r=e.isHorizontal()?"height":"width";var i=e.model.get(["axisLabel","margin"]);a[r]-=t[r]+i;if(e.position==="top"){a.y+=t.height+i}else if(e.position==="left"){a.x+=t.width+i}}}});s()}U(this._coordsList,function(e){e.calcAffineTransform()});function s(){U(o,function(e){var t=e.isHorizontal();var r=t?[0,a.width]:[0,a.height];var i=e.inverse?1:0;e.setExtent(r[i],r[1-i]);z2(e,t?a.x:a.y)})}};o.prototype.getAxis=function(e,t){var r=this._axesMap[e];if(r!=null){return r[t||0]}};o.prototype.getAxes=function(){return this._axesList.slice()};o.prototype.getCartesian=function(e,t){if(e!=null&&t!=null){var r="x"+e+"y"+t;return this._coordsMap[r]}if(O(e)){t=e.yAxisIndex;e=e.xAxisIndex}for(var i=0,n=this._coordsList;i<n.length;i++){if(n[i].getAxis("x").index===e||n[i].getAxis("y").index===t){return n[i]}}};o.prototype.getCartesians=function(){return this._coordsList.slice()};o.prototype.convertToPixel=function(e,t,r){var i=this._findConvertTarget(t);return i.cartesian?i.cartesian.dataToPoint(r):i.axis?i.axis.toGlobalCoord(i.axis.dataToCoord(r)):null};o.prototype.convertFromPixel=function(e,t,r){var i=this._findConvertTarget(t);return i.cartesian?i.cartesian.pointToData(r):i.axis?i.axis.coordToData(i.axis.toLocalCoord(r)):null};o.prototype._findConvertTarget=function(e){var t=e.seriesModel;var r=e.xAxisModel||t&&t.getReferringComponents("xAxis",$a).models[0];var i=e.yAxisModel||t&&t.getReferringComponents("yAxis",$a).models[0];var n=e.gridModel;var a=this._coordsList;var o;var s;if(t){o=t.coordinateSystem;D(a,o)<0&&(o=null)}else if(r&&i){o=this.getCartesian(r.componentIndex,i.componentIndex)}else if(r){s=this.getAxis("x",r.componentIndex)}else if(i){s=this.getAxis("y",i.componentIndex)}else if(n){var l=n.coordinateSystem;if(l===this){o=this._coordsList[0]}}return{cartesian:o,axis:s}};o.prototype.containPoint=function(e){var t=this._coordsList[0];if(t){return t.containPoint(e)}};o.prototype._initCartesian=function(o,e,t){var s=this;var l=this;var u={left:false,right:false,top:false,bottom:false};var c={x:{},y:{}};var f={x:0,y:0};e.eachComponent("xAxis",r("x"),this);e.eachComponent("yAxis",r("y"),this);if(!f.x||!f.y){this._axesMap={};this._axesList=[];return}this._axesMap=c;U(c.x,function(n,a){U(c.y,function(e,t){var r="x"+a+"y"+t;var i=new D2(r);i.master=s;i.model=o;s._coordsMap[r]=i;s._coordsList.push(i);i.addAxis(n);i.addAxis(e)})});function r(a){return function(e,t){if(!N2(e,o)){return}var r=e.get("position");if(a==="x"){if(r!=="top"&&r!=="bottom"){r=u.bottom?"top":"bottom"}}else{if(r!=="left"&&r!=="right"){r=u.left?"right":"left"}}u[r]=true;var i=new A2(a,dS(e),[0,0],e.get("type"),r);var n=i.type==="category";i.onBand=n&&e.get("boundaryGap");i.inverse=e.get("inverse");e.axis=i;i.model=e;i.grid=l;i.index=t;l._axesList.push(i);c[a][t]=i;f[a]++}}};o.prototype._updateScale=function(e,l){U(this._axesList,function(e){e.scale.setExtent(Infinity,-Infinity);if(e.type==="category"){var t=e.model.get("categorySortInfo");e.scale.setSortInfo(t)}});e.eachSeries(function(e){if(k2(e)){var t=P2(e);var r=t.xAxisModel;var i=t.yAxisModel;if(!N2(r,l)||!N2(i,l)){return}var n=this.getCartesian(r.componentIndex,i.componentIndex);var a=e.getData();var o=n.getAxis("x");var s=n.getAxis("y");if(a.type==="list"){u(a,o);u(a,s)}}},this);function u(t,r){U(SS(t,r.dim),function(e){r.scale.unionExtentFromData(t,e)})}};o.prototype.getTooltipAxes=function(i){var n=[];var a=[];U(this.getCartesians(),function(e){var t=i!=null&&i!=="auto"?e.getAxis(i):e.getBaseAxis();var r=e.getOtherAxis(t);D(n,t)<0&&n.push(t);D(a,r)<0&&a.push(r)});return{baseAxes:n,otherAxes:a}};o.create=function(i,n){var a=[];i.eachComponent("grid",function(e,t){var r=new o(e,i,n);r.name="grid_"+t;r.resize(e,n,true);e.coordinateSystem=r;a.push(r)});i.eachSeries(function(e){if(!k2(e)){return}var t=P2(e);var r=t.xAxisModel;var i=t.yAxisModel;var n=r.getCoordSysModel();if("development"!=="production"){if(!n){throw new Error('Grid "'+we(r.get("gridIndex"),r.get("gridId"),0)+'" not found')}if(r.getCoordSysModel()!==i.getCoordSysModel()){throw new Error("xAxis and yAxis must use the same grid")}}var a=n.coordinateSystem;e.coordinateSystem=a.getCartesian(r.componentIndex,i.componentIndex)});return a};o.dimensions=C2;return o}();function N2(e,t){return e.getCoordSysModel()===t}function E2(e,t,r,i){r.getAxesOnZeroOf=function(){return a?[a]:[]};var n=e[t];var a;var o=r.model;var s=o.get(["axisLine","onZero"]);var l=o.get(["axisLine","onZeroAxisIndex"]);if(!s){return}if(l!=null){if(R2(n[l])){a=n[l]}}else{for(var u in n){if(n.hasOwnProperty(u)&&R2(n[u])&&!i[c(n[u])]){a=n[u];break}}}if(a){i[c(a)]=true}function c(e){return e.dim+"_"+e.index}}function R2(e){return e&&e.type!=="category"&&e.type!=="time"&&gS(e)}function z2(e,t){var r=e.getExtent();var i=r[0]+r[1];e.toGlobalCoord=e.dim==="x"?function(e){return e+t}:function(e){return i-e+t};e.toLocalCoord=e.dim==="x"?function(e){return e-t}:function(e){return i-e+t}}var B2=Math.PI;var V2=function(){function e(e,t){this.group=new H;this.opt=t;this.axisModel=e;R(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:true,handleAutoShown:function(){return true}});var r=new H({x:t.position[0],y:t.position[1],rotation:t.rotation});r.updateTransform();this._transformGroup=r}e.prototype.hasBuilder=function(e){return!!G2[e]};e.prototype.add=function(e){G2[e](this.opt,this.axisModel,this.group,this._transformGroup)};e.prototype.getGroup=function(){return this.group};e.innerTextLayout=function(e,t,r){var i=ea(t-e);var n;var a;if(ta(i)){a=r>0?"top":"bottom";n="center"}else if(ta(i-B2)){a=r>0?"bottom":"top";n="center"}else{a="middle";if(i>0&&i<B2){n=r>0?"right":"left"}else{n=r>0?"left":"right"}}return{rotation:i,textAlign:n,textVerticalAlign:a}};e.makeAxisEventDataBase=function(e){var t={componentType:e.mainType,componentIndex:e.componentIndex};t[e.mainType+"Index"]=e.componentIndex;return t};e.isLabelSilent=function(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)};return e}();var G2={axisLine:function(n,e,a,t){var r=e.get(["axisLine","show"]);if(r==="auto"&&n.handleAutoShown){r=n.handleAutoShown("axisLine")}if(!r){return}var i=e.axis.getExtent();var o=t.transform;var s=[i[0],0];var l=[i[1],0];if(o){rt(s,s,o);rt(l,l,o)}var u=F({lineCap:"round"},e.getModel(["axisLine","lineStyle"]).getLineStyle());var c=new vf({subPixelOptimize:true,shape:{x1:s[0],y1:s[1],x2:l[0],y2:l[1]},style:u,strokeContainThreshold:n.strokeContainThreshold||5,silent:true,z2:1});c.anid="line";a.add(c);var f=e.get(["axisLine","symbol"]);var h=e.get(["axisLine","symbolSize"]);var p=e.get(["axisLine","symbolOffset"])||0;if(typeof p==="number"){p=[p,p]}if(f!=null){if(typeof f==="string"){f=[f,f]}if(typeof h==="string"||typeof h==="number"){h=[h,h]}var v=h[0];var d=h[1];U([{rotate:n.rotation+Math.PI/2,offset:p[0],r:0},{rotate:n.rotation-Math.PI/2,offset:p[1],r:Math.sqrt((s[0]-l[0])*(s[0]-l[0])+(s[1]-l[1])*(s[1]-l[1]))}],function(e,t){if(f[t]!=="none"&&f[t]!=null){var r=S0(f[t],-v/2,-d/2,v,d,u.stroke,true);var i=e.r+e.offset;r.attr({rotation:e.rotate,x:s[0]+i*Math.cos(n.rotation),y:s[1]-i*Math.sin(n.rotation),silent:true,z2:11});a.add(r)}})}},axisTickLabel:function(e,t,r,i){var n=Y2(r,i,t,e);var a=q2(r,i,t,e);H2(t,a,n);X2(r,i,t,e.tickDirection)},axisName:function(e,t,r,i){var n=be(e.axisName,t.get("name"));if(!n){return}var a=t.get("nameLocation");var o=e.nameDirection;var s=t.getModel("nameTextStyle");var l=t.get("nameGap")||0;var u=t.axis.getExtent();var c=u[0]>u[1]?-1:1;var f=[a==="start"?u[0]-c*l:a==="end"?u[1]+c*l:(u[0]+u[1])/2,U2(a)?e.labelOffset+o*l:0];var h;var p=t.get("nameRotate");if(p!=null){p=p*B2/180}var v;if(U2(a)){h=V2.innerTextLayout(e.rotation,p!=null?p:e.rotation,o)}else{h=F2(e.rotation,a,p||0,u);v=e.axisNameAvailableWidth;if(v!=null){v=Math.abs(v/Math.sin(h.rotation));!isFinite(v)&&(v=null)}}var d=s.getFont();var g=t.get("nameTruncate",true)||{};var y=g.ellipsis;var m=be(e.nameTruncateMaxWidth,g.maxWidth,v);var x=new W({x:f[0],y:f[1],rotation:h.rotation,silent:V2.isLabelSilent(t),style:_h(s,{text:n,font:d,overflow:"truncate",width:m,ellipsis:y,fill:s.getTextColor()||t.get(["axisLine","lineStyle","color"]),align:s.get("align")||h.textAlign,verticalAlign:s.get("verticalAlign")||h.textVerticalAlign}),z2:1});ph({el:x,componentModel:t,itemName:n});x.__fullText=n;x.anid="name";if(t.get("triggerEvent")){var _=V2.makeAxisEventDataBase(t);_.targetType="axisName";_.name=n;j(x).eventData=_}i.add(x);x.updateTransform();r.add(x);x.decomposeTransform()}};function F2(e,t,r,i){var n=ea(r-e);var a;var o;var s=i[0]>i[1];var l=t==="start"&&!s||t!=="start"&&s;if(ta(n-B2/2)){o=l?"bottom":"top";a="center"}else if(ta(n-B2*1.5)){o=l?"top":"bottom";a="center"}else{o="middle";if(n<B2*1.5&&n>B2/2){a=l?"left":"right"}else{a=l?"right":"left"}}return{rotation:n,textAlign:a,textVerticalAlign:o}}function H2(e,t,r){if(wS(e.axis)){return}var i=e.get(["axisLabel","showMinLabel"]);var n=e.get(["axisLabel","showMaxLabel"]);t=t||[];r=r||[];var a=t[0];var o=t[1];var s=t[t.length-1];var l=t[t.length-2];var u=r[0];var c=r[1];var f=r[r.length-1];var h=r[r.length-2];if(i===false){W2(a);W2(u)}else if(j2(a,o)){if(i){W2(o);W2(c)}else{W2(a);W2(u)}}if(n===false){W2(s);W2(f)}else if(j2(l,s)){if(n){W2(l);W2(h)}else{W2(s);W2(f)}}}function W2(e){e&&(e.ignore=true)}function j2(e,t){var r=e&&e.getBoundingRect().clone();var i=t&&t.getBoundingRect().clone();if(!r||!i){return}var n=Oi([]);zi(n,n,-e.rotation);r.applyTransform(Ei([],n,e.getLocalTransform()));i.applyTransform(Ei([],n,t.getLocalTransform()));return r.intersect(i)}function U2(e){return e==="middle"||e==="center"}function Z2(e,t,r,i,n){var a=[];var o=[];var s=[];for(var l=0;l<e.length;l++){var u=e[l].coord;o[0]=u;o[1]=0;s[0]=u;s[1]=r;if(t){rt(o,o,t);rt(s,s,t)}var c=new vf({subPixelOptimize:true,shape:{x1:o[0],y1:o[1],x2:s[0],y2:s[1]},style:i,z2:2,autoBatch:true,silent:true});c.anid=n+"_"+e[l].tickValue;a.push(c)}return a}function Y2(e,t,r,i){var n=r.axis;var a=r.getModel("axisTick");var o=a.get("show");if(o==="auto"&&i.handleAutoShown){o=i.handleAutoShown("axisTick")}if(!o||n.scale.isBlank()){return}var s=a.getModel("lineStyle");var l=i.tickDirection*a.get("length");var u=n.getTicksCoords();var c=Z2(u,t.transform,l,R(s.getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])}),"ticks");for(var f=0;f<c.length;f++){e.add(c[f])}return c}function X2(e,t,r,i){var n=r.axis;var a=r.getModel("minorTick");if(!a.get("show")||n.scale.isBlank()){return}var o=n.getMinorTicksCoords();if(!o.length){return}var s=a.getModel("lineStyle");var l=i*a.get("length");var u=R(s.getLineStyle(),R(r.getModel("axisTick").getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])}));for(var c=0;c<o.length;c++){var f=Z2(o[c],t.transform,l,u,"minorticks_"+c);for(var h=0;h<f.length;h++){e.add(f[h])}}}function q2(f,h,p,v){var d=p.axis;var e=be(v.axisLabelShow,p.get(["axisLabel","show"]));if(!e||d.scale.isBlank()){return}var g=p.getModel("axisLabel");var y=g.get("margin");var t=d.getViewLabels();var r=(be(v.labelRotate,g.get("rotate"))||0)*B2/180;var m=V2.innerTextLayout(v.rotation,r,v.labelDirection);var x=p.getCategories&&p.getCategories(true);var _=[];var b=V2.isLabelSilent(p);var w=p.get("triggerEvent");U(t,function(e,t){var r=d.scale.type==="ordinal"?d.scale.getRawOrdinalNumber(e.tickValue):e.tickValue;var i=e.formattedLabel;var n=e.rawLabel;var a=g;if(x&&x[r]){var o=x[r];if(O(o)&&o.textStyle){a=new C(o.textStyle,g,p.ecModel)}}var s=a.getTextColor()||p.get(["axisLine","lineStyle","color"]);var l=d.dataToCoord(r);var u=new W({x:l,y:v.labelOffset+v.labelDirection*y,rotation:m.rotation,silent:b,z2:10,style:_h(a,{text:i,align:a.getShallow("align",true)||m.textAlign,verticalAlign:a.getShallow("verticalAlign",true)||a.getShallow("baseline",true)||m.textVerticalAlign,fill:typeof s==="function"?s(d.type==="category"?n:d.type==="value"?r+"":r,t):s})});u.anid="label_"+r;if(w){var c=V2.makeAxisEventDataBase(p);c.targetType="axisLabel";c.value=n;j(u).eventData=c}h.add(u);u.updateTransform();_.push(u);f.add(u);u.decomposeTransform()});return _}function J2(e,t){var r={axesInfo:{},seriesInvolved:false,coordSysAxesInfo:{},coordSysMap:{}};K2(r,e,t);r.seriesInvolved&&$2(r,e);return r}function K2(v,d,e){var o=d.getComponent("tooltip");var g=d.getComponent("axisPointer");var y=g.get("link",true)||[];var m=[];U(e.getCoordinateSystems(),function(f){if(!f.axisPointerEnabled){return}var e=oT(f.model);var h=v.coordSysAxesInfo[e]={};v.coordSysMap[e]=f;var t=f.model;var p=t.getModel("tooltip",o);U(f.getAxes(),_(a,false,null));if(f.getTooltipAxes&&o&&p.get("show")){var r=p.get("trigger")==="axis";var i=p.get(["axisPointer","type"])==="cross";var n=f.getTooltipAxes(p.get(["axisPointer","axis"]));if(r||i){U(n.baseAxes,_(a,i?"cross":true,r))}if(i){U(n.otherAxes,_(a,"cross",false))}}function a(e,t,r){var i=r.model.getModel("axisPointer",g);var n=i.get("show");if(!n||n==="auto"&&!e&&!aT(i)){return}if(t==null){t=i.get("triggerTooltip")}i=e?Q2(r,p,g,d,e,t):i;var a=i.get("snap");var o=oT(r.model);var s=t||a||r.type==="category";var l=v.axesInfo[o]={key:o,axis:r,coordSys:f,axisPointerModel:i,triggerTooltip:t,involveSeries:s,snap:a,useHandle:aT(i),seriesModels:[],linkGroup:null};h[o]=l;v.seriesInvolved=v.seriesInvolved||s;var u=eT(y,r);if(u!=null){var c=m[u]||(m[u]={axesInfo:{}});c.axesInfo[o]=l;c.mapper=y[u].mapper;l.linkGroup=c}}})}function Q2(e,t,r,i,n,a){var o=t.getModel("axisPointer");var s=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"];var l={};U(s,function(e){l[e]=M(o.get(e))});l.snap=e.type!=="category"&&!!a;if(o.get("type")==="cross"){l.type="line"}var u=l.label||(l.label={});u.show==null&&(u.show=false);if(n==="cross"){var c=o.get(["label","show"]);u.show=c!=null?c:true;if(!a){var f=l.lineStyle=o.get("crossStyle");f&&R(u,f.textStyle)}}return e.model.getModel("axisPointer",new C(l,r,i))}function $2(n,e){e.eachSeries(function(r){var i=r.coordinateSystem;var e=r.get(["tooltip","trigger"],true);var t=r.get(["tooltip","show"],true);if(!i||e==="none"||e===false||e==="item"||t===false||r.get(["axisPointer","show"],true)===false){return}U(n.coordSysAxesInfo[oT(i.model)],function(e){var t=e.axis;if(i.getAxis(t.dim)===t){e.seriesModels.push(r);e.seriesDataCount==null&&(e.seriesDataCount=0);e.seriesDataCount+=r.getData().count()}})})}function eT(e,t){var r=t.model;var i=t.dim;for(var n=0;n<e.length;n++){var a=e[n]||{};if(tT(a[i+"AxisId"],r.id)||tT(a[i+"AxisIndex"],r.componentIndex)||tT(a[i+"AxisName"],r.name)){return n}}}function tT(e,t){return e==="all"||k(e)&&D(e,t)>=0||e===t}function rT(e){var t=iT(e);if(!t){return}var r=t.axisPointerModel;var i=t.axis.scale;var n=r.option;var a=r.get("status");var o=r.get("value");if(o!=null){o=i.parse(o)}var s=aT(r);if(a==null){n.status=s?"show":"hide"}var l=i.getExtent().slice();l[0]>l[1]&&l.reverse();if(o==null||o>l[1]){o=l[1]}if(o<l[0]){o=l[0]}n.value=o;if(s){n.status=t.axis.scale.isBlank()?"hide":"show"}}function iT(e){var t=(e.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[oT(e)]}function nT(e){var t=iT(e);return t&&t.axisPointerModel}function aT(e){return!!e.get(["handle","show"])}function oT(e){return e.type+"||"+e.id}var sT={};var lT=function(n){d(a,n);function a(){var e=n!==null&&n.apply(this,arguments)||this;e.type=a.type;return e}a.prototype.render=function(e,t,r,i){this.axisPointerClass&&rT(e);n.prototype.render.apply(this,arguments);this._doUpdateAxisPointerClass(e,r,true)};a.prototype.updateAxisPointer=function(e,t,r,i){this._doUpdateAxisPointerClass(e,r,false)};a.prototype.remove=function(e,t){var r=this._axisPointer;r&&r.remove(t)};a.prototype.dispose=function(e,t){this._disposeAxisPointer(t);n.prototype.dispose.apply(this,arguments)};a.prototype._doUpdateAxisPointerClass=function(e,t,r){var i=a.getAxisPointerClass(this.axisPointerClass);if(!i){return}var n=nT(e);n?(this._axisPointer||(this._axisPointer=new i)).render(e,n,t,r):this._disposeAxisPointer(t)};a.prototype._disposeAxisPointer=function(e){this._axisPointer&&this._axisPointer.dispose(e);this._axisPointer=null};a.registerAxisPointerClass=function(e,t){if("development"!=="production"){if(sT[e]){throw new Error("axisPointer "+e+" exists")}}sT[e]=t};a.getAxisPointerClass=function(e){return e&&sT[e]};a.type="axis";return a}(My);var uT=qa();function cT(e,t,r,i){var n=r.axis;if(n.scale.isBlank()){return}var a=r.getModel("splitArea");var o=a.getModel("areaStyle");var s=o.get("color");var l=i.coordinateSystem.getRect();var u=n.getTicksCoords({tickModel:a,clamp:true});if(!u.length){return}var c=s.length;var f=uT(e).splitAreaColors;var h=I();var p=0;if(f){for(var v=0;v<u.length;v++){var d=f.get(u[v].tickValue);if(d!=null){p=(d+(c-1)*v)%c;break}}}var g=n.toGlobalCoord(u[0].coord);var y=o.getAreaStyle();s=k(s)?s:[s];for(var v=1;v<u.length;v++){var m=n.toGlobalCoord(u[v].coord);var x=void 0;var _=void 0;var b=void 0;var w=void 0;if(n.isHorizontal()){x=g;_=l.y;b=m-x;w=l.height;g=x+b}else{x=l.x;_=g;b=l.width;w=m-_;g=_+w}var S=u[v-1].tickValue;S!=null&&h.set(S,p);t.add(new G({anid:S!=null?"area_"+S:null,shape:{x:x,y:_,width:b,height:w},style:R({fill:s[p]},y),autoBatch:true,silent:true}));p=(p+1)%c}uT(e).splitAreaColors=h}function fT(e){uT(e).splitAreaColors=null}var hT=["axisLine","axisTickLabel","axisName"];var pT=["splitArea","splitLine","minorSplitLine"];var vT=function(l){d(t,l);function t(){var e=l!==null&&l.apply(this,arguments)||this;e.type=t.type;e.axisPointerClass="CartesianAxisPointer";return e}t.prototype.render=function(n,e,t,r){this.group.removeAll();var i=this._axisGroup;this._axisGroup=new H;this.group.add(this._axisGroup);if(!n.get("show")){return}var a=n.getCoordSysModel();var o=L2(a,n);var s=new V2(n,F({handleAutoShown:function(e){var t=a.coordinateSystem.getCartesians();for(var r=0;r<t.length;r++){var i=t[r].getOtherAxis(n.axis).type;if(i==="value"||i==="log"){return true}}return false}},o));U(hT,s.add,s);this._axisGroup.add(s.getGroup());U(pT,function(e){if(n.get([e,"show"])){dT[e](this,this._axisGroup,n,a)}},this);ah(i,this._axisGroup,n);l.prototype.render.call(this,n,e,t,r)};t.prototype.remove=function(){fT(this)};t.type="cartesianAxis";return t}(lT);var dT={splitLine:function(e,t,r,i){var n=r.axis;if(n.scale.isBlank()){return}var a=r.getModel("splitLine");var o=a.getModel("lineStyle");var s=o.get("color");s=k(s)?s:[s];var l=i.coordinateSystem.getRect();var u=n.isHorizontal();var c=0;var f=n.getTicksCoords({tickModel:a});var h=[];var p=[];var v=o.getLineStyle();for(var d=0;d<f.length;d++){var g=n.toGlobalCoord(f[d].coord);if(u){h[0]=g;h[1]=l.y;p[0]=g;p[1]=l.y+l.height}else{h[0]=l.x;h[1]=g;p[0]=l.x+l.width;p[1]=g}var y=c++%s.length;var m=f[d].tickValue;t.add(new vf({anid:m!=null?"line_"+f[d].tickValue:null,subPixelOptimize:true,autoBatch:true,shape:{x1:h[0],y1:h[1],x2:p[0],y2:p[1]},style:R({stroke:s[y]},v),silent:true}))}},minorSplitLine:function(e,t,r,i){var n=r.axis;var a=r.getModel("minorSplitLine");var o=a.getModel("lineStyle");var s=i.coordinateSystem.getRect();var l=n.isHorizontal();var u=n.getMinorTicksCoords();if(!u.length){return}var c=[];var f=[];var h=o.getLineStyle();for(var p=0;p<u.length;p++){for(var v=0;v<u[p].length;v++){var d=n.toGlobalCoord(u[p][v].coord);if(l){c[0]=d;c[1]=s.y;f[0]=d;f[1]=s.y+s.height}else{c[0]=s.x;c[1]=d;f[0]=s.x+s.width;f[1]=d}t.add(new vf({anid:"minor_line_"+u[p][v].tickValue,subPixelOptimize:true,autoBatch:true,shape:{x1:c[0],y1:c[1],x2:f[0],y2:f[1]},style:h,silent:true}))}}},splitArea:function(e,t,r,i){cT(e,t,r,i)}};var gT=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="xAxis";return r}(vT);var yT=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type=gT.type;return e}e.type="yAxis";return e}(vT);var mT=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="grid";return e}e.prototype.render=function(e,t){this.group.removeAll();if(e.get("show")){this.group.add(new G({shape:e.coordinateSystem.getRect(),style:R({fill:e.get("backgroundColor")},e.getItemStyle()),silent:true,z2:-1}))}};e.type="grid";return e}(My);var xT={offset:0};function _T(e){e.registerComponentView(mT);e.registerComponentModel(v2);e.registerCoordinateSystem("cartesian2d",O2);S2(e,"x",d2,xT);S2(e,"y",d2,xT);e.registerComponentView(gT);e.registerComponentView(yT);e.registerPreprocessor(function(e){if(e.xAxis&&e.yAxis&&!e.grid){e.grid={}}})}function bT(e){t(_T);e.registerSeriesModel(l2);e.registerChartView(p2);e.registerLayout(pC("scatter"))}function wT(e){e.eachSeriesByType("radar",function(e){var r=e.getData();var n=[];var a=e.coordinateSystem;if(!a){return}var t=a.getIndicatorAxes();U(t,function(e,i){r.each(r.mapDimension(t[i].dim),function(e,t){n[t]=n[t]||[];var r=a.dataToPoint(e,i);n[t][i]=ST(r)?r:MT(a)})});r.each(function(e){var t=ce(n[e],function(e){return ST(e)})||MT(a);n[e].push(t.slice());r.setItemLayout(e,n[e])})})}function ST(e){return!isNaN(e[0])&&!isNaN(e[1])}function MT(e){return[e.cx,e.cy]}function IT(r){var e=r.polar;if(e){if(!k(e)){e=[e]}var i=[];U(e,function(e,t){if(e.indicator){if(e.type&&!e.shape){e.shape=e.type}r.radar=r.radar||[];if(!k(r.radar)){r.radar=[r.radar]}r.radar.push(e)}else{i.push(e)}});r.polar=i}U(r.series,function(e){if(e&&e.type==="radar"&&e.polarIndex){e.radarIndex=e.polarIndex}})}function CT(e){if(!k(e)){e=[+e,+e]}return e}var TT=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(l,e,t){var r=l.coordinateSystem;var h=this.group;var p=l.getData();var s=this._data;function u(e,t){var r=e.getItemVisual(t,"symbol")||"circle";if(r==="none"){return}var i=CT(e.getItemVisual(t,"symbolSize"));var n=S0(r,-1,-1,2,2);var a=e.getItemVisual(t,"symbolRotate")||0;n.attr({style:{strokeNoScale:true},z2:100,scaleX:i[0]/2,scaleY:i[1]/2,rotation:a*Math.PI/180||0});return n}function c(e,t,r,i,n,a){r.removeAll();for(var o=0;o<t.length-1;o++){var s=u(i,n);if(s){s.__dimIdx=o;if(e[o]){s.setPosition(e[o]);vh[a?"initProps":"updateProps"](s,{x:t[o][0],y:t[o][1]},l,n)}else{s.setPosition(t[o])}r.add(s)}}}function f(e){return A(e,function(e){return[r.cx,r.cy]})}p.diff(s).add(function(e){var t=p.getItemLayout(e);if(!t){return}var r=new uf;var i=new ff;var n={shape:{points:t}};r.shape.points=f(t);i.shape.points=f(t);qf(r,n,l,e);qf(i,n,l,e);var a=new H;var o=new H;a.add(i);a.add(r);a.add(o);c(i.shape.points,t,o,p,e,true);p.setItemGraphicEl(e,a)}).update(function(e,t){var r=s.getItemGraphicEl(t);var i=r.childAt(0);var n=r.childAt(1);var a=r.childAt(2);var o={shape:{points:p.getItemLayout(e)}};if(!o.shape.points){return}c(i.shape.points,o.shape.points,a,p,e,false);X(i,o,l);X(n,o,l);p.setItemGraphicEl(e,r)}).remove(function(e){h.remove(s.getItemGraphicEl(e))}).execute();p.eachItemGraphicEl(function(e,n){var a=p.getItemModel(n);var t=e.childAt(0);var i=e.childAt(1);var r=e.childAt(2);var o=p.getItemVisual(n,"style");var s=o.fill;h.add(e);t.useStyle(R(a.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:s}));ac(t,a,"lineStyle");ac(i,a,"areaStyle");var l=a.getModel("areaStyle");var u=l.isEmpty()&&l.parentModel.isEmpty();i.ignore=u;U(["emphasis","select","blur"],function(e){var t=a.getModel([e,"areaStyle"]);var r=t.isEmpty()&&t.parentModel.isEmpty();i.ensureState(e).ignore=r&&u});i.useStyle(R(l.getAreaStyle(),{fill:s,opacity:.7,decal:o.decal}));var c=a.getModel("emphasis");var f=c.getModel("itemStyle").getItemStyle();r.eachChild(function(e){if(e instanceof Rl){var t=e.style;e.useStyle(F({image:t.image,x:t.x,y:t.y,width:t.width,height:t.height},o))}else{e.useStyle(o);e.setColor(s)}var r=e.ensureState("emphasis");r.style=M(f);var i=p.get(p.dimensions[e.__dimIdx],n);(i==null||isNaN(i))&&(i="");mh(e,xh(a),{labelFetcher:p.hostModel,labelDataIndex:n,labelDimIndex:e.__dimIdx,defaultText:i,inheritColor:s,defaultOpacity:o.opacity})});tc(e,c.get("focus"),c.get("blurScope"))});this._data=p};r.prototype.remove=function(){this.group.removeAll();this._data=null};r.type="radar";return r}(v);var DT=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.useColorPaletteOnData=true;e.hasSymbolVisual=true;return e}r.prototype.init=function(e){t.prototype.init.apply(this,arguments);this.legendVisualProvider=new a2(x(this.getData,this),x(this.getRawData,this))};r.prototype.getInitialData=function(e,t){return n2(this,{generateCoord:"indicator_",generateCoordCount:Infinity})};r.prototype.formatTooltip=function(r,e,t){var i=this.getData();var n=this.coordinateSystem;var a=n.getIndicatorAxes();var o=this.getData().getName(r);var s=o===""?this.name:o;var l=ly(this,r);return Kg("section",{header:s,sortBlocks:true,blocks:A(a,function(e){var t=i.get(i.mapDimension(e.dim),r);return Kg("nameValue",{markerType:"subItem",markerColor:l,name:e.name,value:t,sortParam:t})})})};r.prototype.getTooltipPosition=function(e){if(e!=null){var t=this.getData();var r=this.coordinateSystem;var i=t.getValues(A(r.dimensions,function(e){return t.mapDimension(e)}),e);for(var n=0,a=i.length;n<a;n++){if(!isNaN(i[n])){var o=r.getIndicatorAxes();return r.coordToPoint(o[n].dataToCoord(i[n]),n)}}}};r.type="series.radar";r.dependencies=["radar"];r.defaultOption={zlevel:0,z:2,coordinateSystem:"radar",legendHoverLink:true,radarIndex:0,lineStyle:{width:2,type:"solid"},label:{position:"top"},symbolSize:8};return r}(dy);var AT=b2.value;function LT(e,t){return R({show:t},e)}var kT=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.optionUpdated=function(){var a=this.get("boundaryGap");var o=this.get("splitNumber");var s=this.get("scale");var l=this.get("axisLine");var u=this.get("axisTick");var c=this.get("axisLabel");var f=this.get("axisName");var h=this.get(["axisName","show"]);var p=this.get(["axisName","formatter"]);var v=this.get("axisNameGap");var d=this.get("triggerEvent");var e=A(this.get("indicator")||[],function(e){if(e.max!=null&&e.max>0&&!e.min){e.min=0}else if(e.min!=null&&e.min<0&&!e.max){e.max=0}var t=f;if(e.color!=null){t=R({color:e.color},f)}var r=y(M(e),{boundaryGap:a,splitNumber:o,scale:s,axisLine:l,axisTick:u,axisLabel:c,name:e.text,nameLocation:"end",nameGap:v,nameTextStyle:t,triggerEvent:d},false);if(!h){r.name=""}if(typeof p==="string"){var i=r.name;r.name=p.replace("{value}",i!=null?i:"")}else if(typeof p==="function"){r.name=p(r.name,r)}var n=new C(r,null,this.ecModel);oe(n,IS.prototype);n.mainType="radar";n.componentIndex=this.componentIndex;return n},this);this._indicatorModels=e};r.prototype.getIndicatorModels=function(){return this._indicatorModels};r.type="radar";r.defaultOption={zlevel:0,z:0,center:["50%","50%"],radius:"75%",startAngle:90,axisName:{show:true},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:false,shape:"polygon",axisLine:y({lineStyle:{color:"#bbb"}},AT.axisLine),axisLabel:LT(AT.axisLabel,false),axisTick:LT(AT.axisTick,false),splitLine:LT(AT.splitLine,true),splitArea:LT(AT.splitArea,true),indicator:[]};return r}(p);var PT=["axisLine","axisTickLabel","axisName"];var OT=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var i=this.group;i.removeAll();this._buildAxes(e);this._buildSplitLineAndArea(e)};r.prototype._buildAxes=function(e){var r=e.coordinateSystem;var t=r.getIndicatorAxes();var i=A(t,function(e){var t=new V2(e.model,{position:[r.cx,r.cy],rotation:e.angle,labelDirection:-1,tickDirection:-1,nameDirection:1});return t});U(i,function(e){U(PT,e.add,e);this.group.add(e.getGroup())},this)};r.prototype._buildSplitLineAndArea=function(e){var i=e.coordinateSystem;var t=i.getIndicatorAxes();if(!t.length){return}var r=e.get("shape");var n=e.getModel("splitLine");var a=e.getModel("splitArea");var o=n.getModel("lineStyle");var s=a.getModel("areaStyle");var l=n.get("show");var u=a.get("show");var c=o.get("color");var f=s.get("color");var h=k(c)?c:[c];var p=k(f)?f:[f];var v=[];var d=[];function g(e,t,r){var i=r%t.length;e[i]=e[i]||[];return i}if(r==="circle"){var y=t[0].getTicksCoords();var m=i.cx;var x=i.cy;for(var _=0;_<y.length;_++){if(l){var b=g(v,h,_);v[b].push(new Rc({shape:{cx:m,cy:x,r:y[_].coord}}))}if(u&&_<y.length-1){var b=g(d,p,_);d[b].push(new rf({shape:{cx:m,cy:x,r0:y[_].coord,r:y[_+1].coord}}))}}}else{var w;var S=A(t,function(e,t){var r=e.getTicksCoords();w=w==null?r.length-1:Math.min(r.length-1,w);return A(r,function(e){return i.coordToPoint(e.coord,t)})});var M=[];for(var _=0;_<=w;_++){var I=[];for(var C=0;C<t.length;C++){I.push(S[C][_])}if(I[0]){I.push(I[0].slice())}else{if("development"!=="production"){console.error("Can't draw value axis "+_)}}if(l){var b=g(v,h,_);v[b].push(new ff({shape:{points:I}}))}if(u&&M){var b=g(d,p,_-1);d[b].push(new uf({shape:{points:I.concat(M)}}))}M=I.slice().reverse()}}var T=o.getLineStyle();var D=s.getAreaStyle();U(d,function(e,t){this.group.add(Wf(e,{style:R({stroke:"none",fill:p[t%p.length]},D),silent:true}))},this);U(v,function(e,t){this.group.add(Wf(e,{style:R({fill:"none",stroke:h[t%h.length]},T),silent:true}))},this)};r.type="radar";return r}(My);var NT=function(n){d(e,n);function e(e,t,r){var i=n.call(this,e,t,r)||this;i.type="value";i.angle=0;i.name="";return i}return e}($S);var ET=function(){function a(e,t,r){this.dimensions=[];this._model=e;this._indicatorAxes=A(e.getIndicatorModels(),function(e,t){var r="indicator_"+t;var i=new NT(r,new Sw);i.name=e.get("name");i.model=e;e.axis=i;this.dimensions.push(r);return i},this);this.resize(e,r)}a.prototype.getIndicatorAxes=function(){return this._indicatorAxes};a.prototype.dataToPoint=function(e,t){var r=this._indicatorAxes[t];return this.coordToPoint(r.dataToCoord(e),t)};a.prototype.coordToPoint=function(e,t){var r=this._indicatorAxes[t];var i=r.angle;var n=this.cx+e*Math.cos(i);var a=this.cy-e*Math.sin(i);return[n,a]};a.prototype.pointToData=function(e){var t=e[0]-this.cx;var r=e[1]-this.cy;var i=Math.sqrt(t*t+r*r);t/=i;r/=i;var n=Math.atan2(-r,t);var a=Infinity;var o;var s=-1;for(var l=0;l<this._indicatorAxes.length;l++){var u=this._indicatorAxes[l];var c=Math.abs(n-u.angle);if(c<a){o=u;s=l;a=c}}return[s,+(o&&o.coordToData(i))]};a.prototype.resize=function(e,t){var r=e.get("center");var i=t.getWidth();var n=t.getHeight();var a=Math.min(i,n)/2;this.cx=Y(r[0],i);this.cy=Y(r[1],n);this.startAngle=e.get("startAngle")*Math.PI/180;var o=e.get("radius");if(typeof o==="string"||typeof o==="number"){o=[0,o]}this.r0=Y(o[0],a);this.r=Y(o[1],a);U(this._indicatorAxes,function(e,t){e.setExtent(this.r0,this.r);var r=this.startAngle+t*Math.PI*2/this._indicatorAxes.length;r=Math.atan2(Math.sin(r),Math.cos(r));e.angle=r},this)};a.prototype.update=function(i,e){var n=this._indicatorAxes;var a=this._model;U(n,function(e){e.scale.setExtent(Infinity,-Infinity)});i.eachSeriesByType("radar",function(e,t){if(e.get("coordinateSystem")!=="radar"||i.getComponent("radar",e.get("radarIndex"))!==a){return}var r=e.getData();U(n,function(e){e.scale.unionExtentFromData(r,r.mapDimension(e.dim))})},this);var f=a.get("splitNumber");function h(e){var t=Math.pow(10,Math.floor(Math.log(e)/Math.LN10));var r=e/t;if(r===2){r=5}else{r*=2}return r*t}U(n,function(e,t){var r=hS(e.scale,e.model).extent;vS(e.scale,e.model);var i=e.model;var n=e.scale;var a=fS(n,i.get("min",true));var o=fS(n,i.get("max",true));var s=n.getInterval();if(a!=null&&o!=null){n.setExtent(+a,+o);n.setInterval((o-a)/f)}else if(a!=null){var l=void 0;do{l=a+s*f;n.setExtent(+a,l);n.setInterval(s);s=h(s)}while(l<r[1]&&isFinite(l)&&isFinite(r[1]))}else if(o!=null){var u=void 0;do{u=o-s*f;n.setExtent(u,+o);n.setInterval(s);s=h(s)}while(u>r[0]&&isFinite(u)&&isFinite(r[0]))}else{var c=n.getTicks().length-1;if(c>f){s=h(s)}var l=Math.ceil(r[1]/s)*s;var u=Zn(l-s*f);n.setExtent(u,l);n.setInterval(s)}})};a.prototype.convertToPixel=function(e,t,r){console.warn("Not implemented.");return null};a.prototype.convertFromPixel=function(e,t,r){console.warn("Not implemented.");return null};a.prototype.containPoint=function(e){console.warn("Not implemented.");return false};a.create=function(r,i){var n=[];r.eachComponent("radar",function(e){var t=new a(e,r,i);n.push(t);e.coordinateSystem=t});r.eachSeriesByType("radar",function(e){if(e.get("coordinateSystem")==="radar"){e.coordinateSystem=n[e.get("radarIndex")||0]}});return n};a.dimensions=[];return a}();function RT(e){e.registerCoordinateSystem("radar",ET);e.registerComponentModel(kT);e.registerComponentView(OT);e.registerVisual({seriesType:"radar",reset:function(e){var t=e.getData();t.each(function(e){t.setItemVisual(e,"legendIcon","roundRect")});t.setVisual("legendIcon","roundRect")}})}function zT(e){t(RT);e.registerChartView(TT);e.registerSeriesModel(DT);e.registerLayout(wT);e.registerProcessor(qC("radar"));e.registerPreprocessor(IT)}var BT="\0_ec_interaction_mutex";function VT(e,t,r){var i=HT(e);i[t]=r}function GT(e,t,r){var i=HT(e);var n=i[t];if(n===r){i[t]=null}}function FT(e,t){return!!HT(e)[t]}function HT(e){return e[BT]||(e[BT]={})}$1({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},function(){});var WT=function(t){d(e,t);function e(r){var e=t.call(this)||this;e._zr=r;var i=x(e._mousedownHandler,e);var n=x(e._mousemoveHandler,e);var a=x(e._mouseupHandler,e);var o=x(e._mousewheelHandler,e);var s=x(e._pinchHandler,e);e.enable=function(e,t){this.disable();this._opt=R(M(t)||{},{zoomOnMouseWheel:true,moveOnMouseMove:true,moveOnMouseWheel:false,preventDefaultMouseMove:true});if(e==null){e=true}if(e===true||e==="move"||e==="pan"){r.on("mousedown",i);r.on("mousemove",n);r.on("mouseup",a)}if(e===true||e==="scale"||e==="zoom"){r.on("mousewheel",o);r.on("pinch",s)}};e.disable=function(){r.off("mousedown",i);r.off("mousemove",n);r.off("mouseup",a);r.off("mousewheel",o);r.off("pinch",s)};return e}e.prototype.isDragging=function(){return this._dragging};e.prototype.isPinching=function(){return this._pinching};e.prototype.setPointerChecker=function(e){this.pointerChecker=e};e.prototype.dispose=function(){this.disable()};e.prototype._mousedownHandler=function(e){if(Lt(e)||e.target&&e.target.draggable){return}var t=e.offsetX;var r=e.offsetY;if(this.pointerChecker&&this.pointerChecker(e,t,r)){this._x=t;this._y=r;this._dragging=true}};e.prototype._mousemoveHandler=function(e){if(!this._dragging||!ZT("moveOnMouseMove",e,this._opt)||e.gestureEvent==="pinch"||FT(this._zr,"globalPan")){return}var t=e.offsetX;var r=e.offsetY;var i=this._x;var n=this._y;var a=t-i;var o=r-n;this._x=t;this._y=r;this._opt.preventDefaultMouseMove&&At(e.event);UT(this,"pan","moveOnMouseMove",e,{dx:a,dy:o,oldX:i,oldY:n,newX:t,newY:r,isAvailableBehavior:null})};e.prototype._mouseupHandler=function(e){if(!Lt(e)){this._dragging=false}};e.prototype._mousewheelHandler=function(e){var t=ZT("zoomOnMouseWheel",e,this._opt);var r=ZT("moveOnMouseWheel",e,this._opt);var i=e.wheelDelta;var n=Math.abs(i);var a=e.offsetX;var o=e.offsetY;if(i===0||!t&&!r){return}if(t){var s=n>3?1.4:n>1?1.2:1.1;var l=i>0?s:1/s;jT(this,"zoom","zoomOnMouseWheel",e,{scale:l,originX:a,originY:o,isAvailableBehavior:null})}if(r){var u=Math.abs(i);var c=(i>0?1:-1)*(u>3?.4:u>1?.15:.05);jT(this,"scrollMove","moveOnMouseWheel",e,{scrollDelta:c,originX:a,originY:o,isAvailableBehavior:null})}};e.prototype._pinchHandler=function(e){if(FT(this._zr,"globalPan")){return}var t=e.pinchScale>1?1.1:1/1.1;jT(this,"zoom",null,e,{scale:t,originX:e.pinchX,originY:e.pinchY,isAvailableBehavior:null})};return e}(lt);function jT(e,t,r,i,n){if(e.pointerChecker&&e.pointerChecker(i,n.originX,n.originY)){At(i.event);UT(e,t,r,i,n)}}function UT(e,t,r,i,n){n.isAvailableBehavior=x(ZT,null,r,i);e.trigger(t,n)}function ZT(e,t,r){var i=r[e];return!e||i&&(!P(i)||t.event[i+"Key"])}function YT(e,t,r){var i=e.target;i.x+=t;i.y+=r;i.dirty()}function XT(e,t,r,i){var n=e.target;var a=e.zoomLimit;var o=e.zoom=e.zoom||1;o*=t;if(a){var s=a.min||0;var l=a.max||Infinity;o=Math.max(Math.min(l,o),s)}var u=o/e.zoom;e.zoom=o;n.x-=(r-n.x)*(u-1);n.y-=(i-n.y)*(u-1);n.scaleX*=u;n.scaleY*=u;n.dirty()}var qT={axisPointer:1,tooltip:1,brush:1};function JT(e,t,r){var i=t.getComponentByElement(e.topTarget);var n=i&&i.coordinateSystem;return i&&i!==r&&!qT.hasOwnProperty(i.mainType)&&n&&n.model!==r}var KT=["rect","circle","line","ellipse","polygon","polyline","path"];var QT=I(KT);var $T=I(KT.concat(["g"]));var eD=I(KT.concat(["g"]));var tD=qa();function rD(e){var t=e.getItemStyle();var r=e.get("areaColor");if(r!=null){t.fill=r}return t}var iD=function(){function e(e){var t=new H;this.uid=Hh("ec_map_draw");this._controller=new WT(e.getZr());this._controllerHost={target:t};this.group=t;t.add(this._regionsGroup=new H);t.add(this._svgGroup=new H)}e.prototype.draw=function(t,e,r,i,n){var a=t.mainType==="geo";var o=t.getData&&t.getData();a&&e.eachComponent({mainType:"series",subType:"map"},function(e){if(!o&&e.getHostGeoModel()===t){o=e.getData()}});var s=t.coordinateSystem;var l=this._regionsGroup;var u=this.group;var c=s.getTransformInfo();var f=c.raw;var h=c.roam;var p=!l.childAt(0)||n;if(p){u.x=h.x;u.y=h.y;u.scaleX=h.scaleX;u.scaleY=h.scaleY;u.dirty()}else{X(u,h,t)}var v=o&&o.getVisual("visualMeta")&&o.getVisual("visualMeta").length>0;var d={api:r,geo:s,mapOrGeoModel:t,data:o,isVisualEncodedByVisualMap:v,isGeo:a,transformInfoRaw:f};if(s.resourceType==="geoJSON"){this._buildGeoJSON(d)}else if(s.resourceType==="geoSVG"){this._buildSVG(d)}this._updateController(t,e,r);this._updateMapSelectHandler(t,l,r,i)};e.prototype._buildGeoJSON=function(l){var u=this._regionsGroupByName=I();var c=I();var f=this._regionsGroup;var t=l.transformInfoRaw;var h=l.mapOrGeoModel;var p=l.data;var v=function(e){return[e[0]*t.scaleX+t.x,e[1]*t.scaleY+t.y]};f.removeAll();U(l.geo.regions,function(e){var t=e.name;var r=u.get(t);var i=c.get(t)||{},n=i.dataIdx,a=i.regionModel;if(!r){r=u.set(t,new H);f.add(r);n=p?p.indexOfName(t):null;a=l.isGeo?h.getRegionModel(t):p?p.getItemModel(n):null;c.set(t,{dataIdx:n,regionModel:a})}var o=new bf({segmentIgnoreThreshold:1,shape:{paths:[]}});r.add(o);U(e.geometries,function(e){if(e.type!=="polygon"){return}var t=[];for(var r=0;r<e.exterior.length;++r){t.push(v(e.exterior[r]))}o.shape.paths.push(new uf({segmentIgnoreThreshold:1,shape:{points:t}}));for(var r=0;r<(e.interiors?e.interiors.length:0);++r){var i=e.interiors[r];var n=[];for(var a=0;a<i.length;++a){n.push(v(i[a]))}o.shape.paths.push(new uf({segmentIgnoreThreshold:1,shape:{points:n}}))}});nD(l,o,n,a);if(o instanceof Ko){o.culling=true}var s=v(e.getCenter());aD(l,o,t,a,h,n,s)});u.each(function(e,t){var r=c.get(t),i=r.dataIdx,n=r.regionModel;oD(l,e,t,n,h,i);sD(l,e,t,n,h);lD(l,e,t,n,h)},this)};e.prototype._buildSVG=function(c){var e=c.geo.map;var t=c.transformInfoRaw;this._svgGroup.x=t.x;this._svgGroup.y=t.y;this._svgGroup.scaleX=t.scaleX;this._svgGroup.scaleY=t.scaleY;if(this._svgResourceChanged(e)){this._freeSVG();this._useSVG(e)}var f=this._svgDispatcherMap=I();var h=false;U(this._svgGraphicRecord.named,function(e){var t=e.name;var r=c.mapOrGeoModel;var i=c.data;var n=e.svgNodeTagLower;var a=e.el;var o=i?i.indexOfName(t):null;var s=r.getRegionModel(t);if(QT.get(n)!=null&&a instanceof Ko){nD(c,a,o,s)}if(a instanceof Ko){a.culling=true}a.z2EmphasisLift=0;if(!e.namedFrom){if(eD.get(n)!=null){aD(c,a,t,s,r,o,null)}oD(c,a,t,s,r,o);sD(c,a,t,s,r);if($T.get(n)!=null){var l=lD(c,a,t,s,r);if(l==="self"){h=true}var u=f.get(t)||f.set(t,[]);u.push(a)}}},this);this._enableBlurEntireSVG(h,c)};e.prototype._enableBlurEntireSVG=function(e,t){if(e&&t.isGeo){var r=t.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle();var i=r.opacity;this._svgGraphicRecord.root.traverse(function(e){if(!e.isGroup){Eu(e);var t=e.ensureState("blur").style||{};if(t.opacity==null&&i!=null){t.opacity=i}e.ensureState("emphasis")}})}};e.prototype.remove=function(){this._regionsGroup.removeAll();this._regionsGroupByName=null;this._svgGroup.removeAll();this._freeSVG();this._controller.dispose();this._controllerHost=null};e.prototype.findHighDownDispatchers=function(e,t){if(e==null){return[]}var r=t.coordinateSystem;if(r.resourceType==="geoJSON"){var i=this._regionsGroupByName;if(i){var n=i.get(e);return n?[n]:[]}}else if(r.resourceType==="geoSVG"){return this._svgDispatcherMap&&this._svgDispatcherMap.get(e)||[]}};e.prototype._svgResourceChanged=function(e){return this._svgMapName!==e};e.prototype._useSVG=function(e){var t=y_.getGeoResource(e);if(t&&t.type==="geoSVG"){var r=t.useGraphic(this.uid);this._svgGroup.add(r.root);this._svgGraphicRecord=r;this._svgMapName=e}};e.prototype._freeSVG=function(){var e=this._svgMapName;if(e==null){return}var t=y_.getGeoResource(e);if(t&&t.type==="geoSVG"){t.freeGraphic(this.uid)}this._svgGraphicRecord=null;this._svgDispatcherMap=null;this._svgGroup.removeAll();this._svgMapName=null};e.prototype._updateController=function(i,e,n){var a=i.coordinateSystem;var t=this._controller;var r=this._controllerHost;r.zoomLimit=i.get("scaleLimit");r.zoom=a.getZoom();t.enable(i.get("roam")||false);var o=i.mainType;function s(){var e={type:"geoRoam",componentType:o};e[o+"Id"]=i.id;return e}t.off("pan").on("pan",function(e){this._mouseDownFlag=false;YT(r,e.dx,e.dy);n.dispatchAction(F(s(),{dx:e.dx,dy:e.dy}))},this);t.off("zoom").on("zoom",function(e){this._mouseDownFlag=false;XT(r,e.scale,e.originX,e.originY);n.dispatchAction(F(s(),{zoom:e.scale,originX:e.originX,originY:e.originY}))},this);t.setPointerChecker(function(e,t,r){return a.containPoint([t,r])&&!JT(e,n,i)})};e.prototype.resetForLabelLayout=function(){this.group.traverse(function(e){var t=e.getTextContent();if(t){t.ignore=tD(t).ignore}})};e.prototype._updateMapSelectHandler=function(e,t,r,i){var n=this;t.off("mousedown");t.off("click");if(e.get("selectedMode")){t.on("mousedown",function(){n._mouseDownFlag=true});t.on("click",function(e){if(!n._mouseDownFlag){return}n._mouseDownFlag=false})}};return e}();function nD(e,t,r,i){var n=i.getModel("itemStyle");var a=i.getModel(["emphasis","itemStyle"]);var o=i.getModel(["blur","itemStyle"]);var s=i.getModel(["select","itemStyle"]);var l=rD(n);var u=rD(a);var c=rD(s);var f=rD(o);var h=e.data;if(h){var p=h.getItemVisual(r,"style");var v=h.getItemVisual(r,"decal");if(e.isVisualEncodedByVisualMap&&p.fill){l.fill=p.fill}if(v){l.decal=ax(v,e.api)}}t.setStyle(l);t.style.strokeNoScale=true;t.ensureState("emphasis").style=u;t.ensureState("select").style=c;t.ensureState("blur").style=f;Eu(t)}function aD(e,t,r,i,n,a,o){var s=e.data;var l=e.isGeo;var u=s&&isNaN(s.get(s.mapDimension("value"),a));var c=s&&s.getItemLayout(a);if(l||u||c&&c.showLabel){var f=!l?a:r;var h=void 0;if(!s||a>=0){h=n}var p=o?{normal:{align:"center",verticalAlign:"middle"}}:null;mh(t,xh(i),{labelFetcher:h,labelDataIndex:f,defaultText:r},p);var v=t.getTextContent();if(v){tD(v).ignore=v.ignore;if(t.textConfig&&o){var d=t.getBoundingRect().clone();t.textConfig.layoutRect=d;t.textConfig.position=[(o[0]-d.x)/d.width*100+"%",(o[1]-d.y)/d.height*100+"%"]}}t.disableLabelAnimation=true}else{t.removeTextContent();t.removeTextConfig();t.disableLabelAnimation=null}}function oD(e,t,r,i,n,a){if(e.data){e.data.setItemGraphicEl(a,t)}else{j(t).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:r,region:i&&i.option||{}}}}function sD(e,t,r,i,n){if(!e.data){ph({el:t,componentModel:n,itemName:r,itemTooltipOption:i.get("tooltip")})}}function lD(e,t,r,i,n){t.highDownSilentOnTouch=!!n.get("selectedMode");var a=i.getModel("emphasis");var o=a.get("focus");tc(t,o,a.get("blurScope"));if(e.isGeo){lc(t,n,r)}return o}var uD=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r,i){if(i&&i.type==="mapToggleSelect"&&i.from===this.uid){return}var n=this.group;n.removeAll();if(e.getHostGeoModel()){return}if(this._mapDraw&&i&&i.type==="geoRoam"){this._mapDraw.resetForLabelLayout()}if(!(i&&i.type==="geoRoam"&&i.componentType==="series"&&i.seriesId===e.id)){if(e.needsDrawMap){var a=this._mapDraw||new iD(r);n.add(a.group);a.draw(e,t,r,this,i);this._mapDraw=a}else{this._mapDraw&&this._mapDraw.remove();this._mapDraw=null}}else{var a=this._mapDraw;a&&n.add(a.group)}e.get("showLegendSymbol")&&t.getComponent("legend")&&this._renderSymbols(e,t,r)};r.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove();this._mapDraw=null;this.group.removeAll()};r.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove();this._mapDraw=null};r.prototype._renderSymbols=function(h,e,t){var p=h.originalData;var v=this.group;p.each(p.mapDimension("value"),function(e,t){if(isNaN(e)){return}var r=p.getItemLayout(t);if(!r||!r.point){return}var i=r.point;var n=r.offset;var a=new Rc({style:{fill:h.getData().getVisual("style").fill},shape:{cx:i[0]+n*9,cy:i[1],r:3},silent:true,z2:8+(!n?cu+1:0)});if(!n){var o=h.mainSeries.getData();var s=p.getName(t);var l=o.indexOfName(s);var u=p.getItemModel(t);var c=u.getModel("label");var f=o.getItemGraphicEl(l);mh(a,xh(u),{labelFetcher:{getFormattedLabel:function(e,t){return h.getFormattedLabel(l,t)}}});a.disableLabelAnimation=true;if(!c.get("position")){a.setTextConfig({position:"bottom"})}f.onHoverStateChange=function(e){Au(a,e)}}v.add(a)})};r.type="map";return r}(v);var cD=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.needsDrawMap=false;e.seriesGroup=[];e.getTooltipPosition=function(e){if(e!=null){var t=this.getData().getName(e);var r=this.coordinateSystem;var i=r.getRegion(t);return i&&r.dataToPoint(i.getCenter())}};return e}r.prototype.getInitialData=function(e){var t=n2(this,{coordDimensions:["value"],encodeDefaulter:_(Pv,this)});var r=I();var i=[];for(var n=0,a=t.count();n<a;n++){var o=t.getName(n);r.set(o,true)}var s=y_.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);U(s.regions,function(e){var t=e.name;if(!r.get(t)){i.push(t)}});t.appendValues([],i);return t};r.prototype.getHostGeoModel=function(){var e=this.option.geoIndex;return e!=null?this.ecModel.getComponent("geo",e):null};r.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map};r.prototype.getRawValue=function(e){var t=this.getData();return t.get(t.mapDimension("value"),e)};r.prototype.getRegionModel=function(e){var t=this.getData();return t.getItemModel(t.indexOfName(e))};r.prototype.formatTooltip=function(e,t,r){var i=this.getData();var n=this.getRawValue(e);var a=i.getName(e);var o=this.seriesGroup;var s=[];for(var l=0;l<o.length;l++){var u=o[l].originalData.indexOfName(a);var c=i.mapDimension("value");if(!isNaN(o[l].originalData.get(c,u))){s.push(o[l].name)}}return Kg("section",{header:s.join(", "),noHeader:!s.length,blocks:[Kg("nameValue",{name:a,value:n})]})};r.prototype.setZoom=function(e){this.option.zoom=e};r.prototype.setCenter=function(e){this.option.center=e};r.prototype.getLegendIcon=function(e){var t=e.icon||"roundRect";var r=S0(t,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);r.setStyle(e.itemStyle);r.style.stroke="none";if(t.indexOf("empty")>-1){r.style.stroke=r.style.fill;r.style.fill="#fff";r.style.lineWidth=2}return r};r.type="series.map";r.dependencies=["geo"];r.layoutMode="box";r.defaultOption={zlevel:0,z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:true,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:true,label:{show:false,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:true,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:true,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"};return r}(dy);function fD(u,c){var f={};U(u,function(i){i.each(i.mapDimension("value"),function(e,t){var r="ec-"+i.getName(t);f[r]=f[r]||[];if(!isNaN(e)){f[r].push(e)}})});return u[0].map(u[0].mapDimension("value"),function(e,t){var r="ec-"+u[0].getName(t);var i=0;var n=Infinity;var a=-Infinity;var o=f[r].length;for(var s=0;s<o;s++){n=Math.min(n,f[r][s]);a=Math.max(a,f[r][s]);i+=f[r][s]}var l;if(c==="min"){l=n}else if(c==="max"){l=a}else if(c==="average"){l=i/o}else{l=i}return o===0?NaN:l})}function hD(e){var i={};e.eachSeriesByType("map",function(e){var t=e.getHostGeoModel();var r=t?"o"+t.id:"i"+e.getMapType();(i[r]=i[r]||[]).push(e)});U(i,function(e,t){var r=fD(A(e,function(e){return e.getData()}),e[0].get("mapValueCalculation"));for(var i=0;i<e.length;i++){e[i].originalData=e[i].getData()}for(var i=0;i<e.length;i++){e[i].seriesGroup=e;e[i].needsDrawMap=i===0&&!e[i].getHostGeoModel();e[i].setData(r.cloneShallow());e[i].mainSeries=e[0]}})}function pD(r){var n={};r.eachSeriesByType("map",function(e){var t=e.getMapType();if(e.getHostGeoModel()||n[t]){return}var l={};U(e.seriesGroup,function(e){var o=e.coordinateSystem;var s=e.originalData;if(e.get("showLegendSymbol")&&r.getComponent("legend")){s.each(s.mapDimension("value"),function(e,t){var r=s.getName(t);var i=o.getRegion(r);if(!i||isNaN(e)){return}var n=l[r]||0;var a=o.dataToPoint(i.getCenter());l[r]=n+1;s.setItemLayout(t,{point:a,offset:n})})}});var i=e.getData();i.each(function(e){var t=i.getName(e);var r=i.getItemLayout(e)||{};r.showLabel=!l[t];i.setItemLayout(e,r)});n[t]=true})}var vD=rt;var dD=function(r){d(e,r);function e(e){var t=r.call(this)||this;t.type="view";t.dimensions=["x","y"];t._roamTransformable=new qi;t._rawTransformable=new qi;t.name=e;return t}e.prototype.setBoundingRect=function(e,t,r,i){this._rect=new B(e,t,r,i);return this._rect};e.prototype.getBoundingRect=function(){return this._rect};e.prototype.setViewRect=function(e,t,r,i){this._transformTo(e,t,r,i);this._viewRect=new B(e,t,r,i)};e.prototype._transformTo=function(e,t,r,i){var n=this.getBoundingRect();var a=this._rawTransformable;a.transform=n.calculateTransform(new B(e,t,r,i));var o=a.parent;a.parent=null;a.decomposeTransform();a.parent=o;this._updateTransform()};e.prototype.setCenter=function(e){if(!e){return}this._center=e;this._updateCenterAndZoom()};e.prototype.setZoom=function(e){e=e||1;var t=this.zoomLimit;if(t){if(t.max!=null){e=Math.min(t.max,e)}if(t.min!=null){e=Math.max(t.min,e)}}this._zoom=e;this._updateCenterAndZoom()};e.prototype.getDefaultCenter=function(){var e=this.getBoundingRect();var t=e.x+e.width/2;var r=e.y+e.height/2;return[t,r]};e.prototype.getCenter=function(){return this._center||this.getDefaultCenter()};e.prototype.getZoom=function(){return this._zoom||1};e.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()};e.prototype._updateCenterAndZoom=function(){var e=this._rawTransformable.getLocalTransform();var t=this._roamTransformable;var r=this.getDefaultCenter();var i=this.getCenter();var n=this.getZoom();i=rt([],i,e);r=rt([],r,e);t.originX=i[0];t.originY=i[1];t.x=r[0]-i[0];t.y=r[1]-i[1];t.scaleX=t.scaleY=n;this._updateTransform()};e.prototype._updateTransform=function(){var e=this._roamTransformable;var t=this._rawTransformable;t.parent=e;e.updateTransform();t.updateTransform();Ni(this.transform||(this.transform=[]),t.transform||Pi());this._rawTransform=t.getLocalTransform();this.invTransform=this.invTransform||[];Vi(this.invTransform,this.transform);this.decomposeTransform()};e.prototype.getTransformInfo=function(){var e=this._rawTransformable;var t=this._roamTransformable;var r=new qi;r.transform=t.transform;r.decomposeTransform();return{roam:{x:r.x,y:r.y,scaleX:r.scaleX,scaleY:r.scaleY},raw:{x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY}}};e.prototype.getViewRect=function(){return this._viewRect};e.prototype.getViewRectAfterRoam=function(){var e=this.getBoundingRect().clone();e.applyTransform(this.transform);return e};e.prototype.dataToPoint=function(e,t,r){var i=t?this._rawTransform:this.transform;r=r||[];return i?vD(r,e,i):Ee(r,e)};e.prototype.pointToData=function(e){var t=this.invTransform;return t?vD([],e,t):[e[0],e[1]]};e.prototype.convertToPixel=function(e,t,r){var i=gD(t);return i===this?i.dataToPoint(r):null};e.prototype.convertFromPixel=function(e,t,r){var i=gD(t);return i===this?i.pointToData(r):null};e.prototype.containPoint=function(e){return this.getViewRectAfterRoam().contain(e[0],e[1])};e.dimensions=["x","y"];return e}(qi);function gD(e){var t=e.seriesModel;return t?t.coordinateSystem:null}var yD={geoJSON:{aspectScale:.75,invertLongitute:true},geoSVG:{aspectScale:1,invertLongitute:false}};var mD=function(l){d(e,l);function e(e,t,r){var i=l.call(this,e)||this;i.dimensions=["lng","lat"];i.type="geo";i._nameCoordMap=I();i.map=t;var n=y_.load(t,r.nameMap,r.nameProperty);var a=y_.getGeoResource(t);i.resourceType=a?a.type:null;var o=yD[a.type];i._regionsMap=n.regionsMap;i._invertLongitute=o.invertLongitute;i.regions=n.regions;i.aspectScale=N(r.aspectScale,o.aspectScale);var s=n.boundingRect;i.setBoundingRect(s.x,s.y,s.width,s.height);return i}e.prototype._transformTo=function(e,t,r,i){var n=this.getBoundingRect();var a=this._invertLongitute;n=n.clone();if(a){n.y=-n.y-n.height}var o=this._rawTransformable;o.transform=n.calculateTransform(new B(e,t,r,i));var s=o.parent;o.parent=null;o.decomposeTransform();o.parent=s;if(a){o.scaleY=-o.scaleY}this._updateTransform()};e.prototype.getRegion=function(e){return this._regionsMap.get(e)};e.prototype.getRegionByCoord=function(e){var t=this.regions;for(var r=0;r<t.length;r++){var i=t[r];if(i.type==="geoJSON"&&i.contain(e)){return t[r]}}};e.prototype.addGeoCoord=function(e,t){this._nameCoordMap.set(e,t)};e.prototype.getGeoCoord=function(e){var t=this._regionsMap.get(e);return this._nameCoordMap.get(e)||t&&t.getCenter()};e.prototype.dataToPoint=function(e,t,r){if(typeof e==="string"){e=this.getGeoCoord(e)}if(e){return dD.prototype.dataToPoint.call(this,e,t,r)}};e.prototype.convertToPixel=function(e,t,r){var i=xD(t);return i===this?i.dataToPoint(r):null};e.prototype.convertFromPixel=function(e,t,r){var i=xD(t);return i===this?i.pointToData(r):null};return e}(dD);oe(mD,dD);function xD(e){var t=e.geoModel;var r=e.seriesModel;return t?t.coordinateSystem:r?r.coordinateSystem||(r.getReferringComponents("geo",$a).models[0]||{}).coordinateSystem:null}function _D(e,t){var r=e.get("boundingCoords");if(r!=null){var i=r[0];var n=r[1];if(isNaN(i[0])||isNaN(i[1])||isNaN(n[0])||isNaN(n[1])){if("development"!=="production"){console.error("Invalid boundingCoords")}}else{this.setBoundingRect(i[0],i[1],n[0]-i[0],n[1]-i[1])}}var a=this.getBoundingRect();var o=e.get("layoutCenter");var s=e.get("layoutSize");var l=t.getWidth();var u=t.getHeight();var c=a.width/a.height*this.aspectScale;var f=false;var h;var p;if(o&&s){h=[Y(o[0],l),Y(o[1],u)];p=Y(s,Math.min(l,u));if(!isNaN(h[0])&&!isNaN(h[1])&&!isNaN(p)){f=true}else{if("development"!=="production"){console.warn("Given layoutCenter or layoutSize data are invalid. Use left/top/width/height instead.")}}}var v;if(f){v={};if(c>1){v.width=p;v.height=p/c}else{v.height=p;v.width=p*c}v.y=h[1]-v.height/2;v.x=h[0]-v.width/2}else{var d=e.getBoxLayoutParams();d.aspect=c;v=sv(d,{width:l,height:u})}this.setViewRect(v.x,v.y,v.width,v.height);this.setCenter(e.get("center"));this.setZoom(e.get("zoom"))}function bD(r,e){U(e.get("geoCoord"),function(e,t){r.addGeoCoord(t,e)})}var wD=function(){function e(){this.dimensions=mD.prototype.dimensions}e.prototype.create=function(e,n){var a=[];e.eachComponent("geo",function(e,t){var r=e.get("map");var i=new mD(r+t,r,{nameMap:e.get("nameMap"),nameProperty:e.get("nameProperty"),aspectScale:e.get("aspectScale")});i.zoomLimit=e.get("scaleLimit");a.push(i);e.coordinateSystem=i;i.model=e;i.resize=_D;i.resize(e,n)});e.eachSeries(function(e){var t=e.get("coordinateSystem");if(t==="geo"){var r=e.get("geoIndex")||0;e.coordinateSystem=a[r]}});var r={};e.eachSeriesByType("map",function(e){if(!e.getHostGeoModel()){var t=e.getMapType();r[t]=r[t]||[];r[t].push(e)}});U(r,function(e,t){var r=A(e,function(e){return e.get("nameMap")});var i=new mD(t,t,{nameMap:ie(r),nameProperty:e[0].get("nameProperty"),aspectScale:e[0].get("aspectScale")});i.zoomLimit=be.apply(null,A(e,function(e){return e.get("scaleLimit")}));a.push(i);i.resize=_D;i.resize(e[0],n);U(e,function(e){e.coordinateSystem=i;bD(i,e)})});return a};e.prototype.getFilledRegions=function(e,t,r,i){var n=(e||[]).slice();var a=I();for(var o=0;o<n.length;o++){a.set(n[o].name,n[o])}var s=y_.load(t,r,i);U(s.regions,function(e){var t=e.name;!a.get(t)&&n.push({name:t})});return n};return e}();var SD=new wD;var MD=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(e,t,r){var i=y_.getGeoResource(e.map);if(i&&i.type==="geoJSON"){var n=e.itemStyle=e.itemStyle||{};if(!("color"in n)){n.color="#eee"}}this.mergeDefaultAndTheme(e,r);Ca(e,"label",["show"])};r.prototype.optionUpdated=function(){var i=this;var e=this.option;e.regions=SD.getFilledRegions(e.regions,e.map,e.nameMap,e.nameProperty);var n={};this._optionModelMap=le(e.regions||[],function(e,t){var r=t.name;if(r){e.set(r,new C(t,i,i.ecModel));if(t.selected){n[r]=true}}return e},I());if(!e.selectedMap){e.selectedMap=n}};r.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new C(null,this,this.ecModel)};r.prototype.getFormattedLabel=function(e,t){var r=this.getRegionModel(e);var i=t==="normal"?r.get(["label","formatter"]):r.get(["emphasis","label","formatter"]);var n={name:e};if(typeof i==="function"){n.status=t;return i(n)}else if(typeof i==="string"){return i.replace("{a}",e!=null?e:"")}};r.prototype.setZoom=function(e){this.option.zoom=e};r.prototype.setCenter=function(e){this.option.center=e};r.prototype.select=function(e){var t=this.option;var r=t.selectedMode;if(!r){return}if(r!=="multiple"){t.selectedMap=null}var i=t.selectedMap||(t.selectedMap={});i[e]=true};r.prototype.unSelect=function(e){var t=this.option.selectedMap;if(t){t[e]=false}};r.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)};r.prototype.isSelected=function(e){var t=this.option.selectedMap;return!!(t&&t[e])};r.type="geo";r.layoutMode="box";r.defaultOption={zlevel:0,z:0,show:true,left:"center",top:"center",aspectScale:null,silent:false,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:false,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:true,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:true,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]};return r}(p);function ID(e,t,r){var i=e.getZoom();var n=e.getCenter();var a=t.zoom;var o=e.dataToPoint(n);if(t.dx!=null&&t.dy!=null){o[0]-=t.dx;o[1]-=t.dy;e.setCenter(e.pointToData(o))}if(a!=null){if(r){var s=r.min||0;var l=r.max||Infinity;a=Math.max(Math.min(i*a,l),s)/i}e.scaleX*=a;e.scaleY*=a;var u=(t.originX-e.x)*(a-1);var c=(t.originY-e.y)*(a-1);e.x-=u;e.y-=c;e.updateTransform();e.setCenter(e.pointToData(o));e.setZoom(a*i)}return{center:e.getCenter(),zoom:e.getZoom()}}var CD=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.focusBlurEnabled=true;return e}r.prototype.init=function(e,t){var r=new iD(t);this._mapDraw=r;this.group.add(r.group);this._api=t};r.prototype.render=function(e,t,r,i){var n=this._mapDraw;if(e.get("show")){n.draw(e,t,r,this,i)}else{this._mapDraw.group.removeAll()}n.group.on("click",this._handleRegionClick,this);n.group.silent=e.get("silent");this._model=e;this.updateSelectStatus(e,t,r)};r.prototype._handleRegionClick=function(e){var t;f0(e.target,function(e){return(t=j(e).eventData)!=null},true);if(t){this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:t.name})}};r.prototype.updateSelectStatus=function(e,t,r){var i=this;this._mapDraw.group.traverse(function(e){var t=j(e).eventData;if(t){i._model.isSelected(t.name)?r.enterSelect(e):r.leaveSelect(e);return true}})};r.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)};r.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()};r.type="geo";return r}(My);function TD(t){t.registerCoordinateSystem("geo",SD);t.registerComponentModel(MD);t.registerComponentView(CD);function e(o,e){e.update="geo:updateSelectStatus";t.registerAction(e,function(i,e){var n={};var a=[];e.eachComponent({mainType:"geo",query:i},function(t){t[o](i.name);var e=t.coordinateSystem;U(e.regions,function(e){n[e.name]=t.isSelected(e.name)||false});var r=[];U(n,function(e,t){n[t]&&r.push(t)});a.push({geoIndex:t.componentIndex,name:r})});return{selected:n,allSelected:a,name:i.name}})}e("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"});e("select",{type:"geoSelect",event:"geoselected"});e("unSelect",{type:"geoUnSelect",event:"geounselected"});t.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(i,e){var n=i.componentType||"series";e.eachComponent({mainType:n,query:i},function(e){var t=e.coordinateSystem;if(t.type!=="geo"){return}var r=ID(t,i,e.get("scaleLimit"));e.setCenter&&e.setCenter(r.center);e.setZoom&&e.setZoom(r.zoom);if(n==="series"){U(e.seriesGroup,function(e){e.setCenter(r.center);e.setZoom(r.zoom)})}})})}function DD(e){t(TD);e.registerChartView(uD);e.registerSeriesModel(cD);e.registerLayout(pD);e.registerProcessor(e.PRIORITY.PROCESSOR.STATISTIC,hD);l0("map",e.registerAction)}function AD(e){var t=e;t.hierNode={defaultAncestor:null,ancestor:t,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};var r=[t];var i;var n;while(i=r.pop()){n=i.children;if(i.isExpand&&n.length){var a=n.length;for(var o=a-1;o>=0;o--){var s=n[o];s.hierNode={defaultAncestor:null,ancestor:s,prelim:0,modifier:0,change:0,shift:0,i:o,thread:null};r.push(s)}}}}function LD(e,t){var r=e.isExpand?e.children:[];var i=e.parentNode.children;var n=e.hierNode.i?i[e.hierNode.i-1]:null;if(r.length){ED(e);var a=(r[0].hierNode.prelim+r[r.length-1].hierNode.prelim)/2;if(n){e.hierNode.prelim=n.hierNode.prelim+t(e,n);e.hierNode.modifier=e.hierNode.prelim-a}else{e.hierNode.prelim=a}}else if(n){e.hierNode.prelim=n.hierNode.prelim+t(e,n)}e.parentNode.hierNode.defaultAncestor=RD(e,n,e.parentNode.hierNode.defaultAncestor||i[0],t)}function kD(e){var t=e.hierNode.prelim+e.parentNode.hierNode.modifier;e.setLayout({x:t},true);e.hierNode.modifier+=e.parentNode.hierNode.modifier}function PD(e){return arguments.length?e:FD}function OD(e,t){e-=Math.PI/2;return{x:t*Math.cos(e),y:t*Math.sin(e)}}function ND(e,t){return sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function ED(e){var t=e.children;var r=t.length;var i=0;var n=0;while(--r>=0){var a=t[r];a.hierNode.prelim+=i;a.hierNode.modifier+=i;n+=a.hierNode.change;i+=a.hierNode.shift+n}}function RD(e,t,r,i){if(t){var n=e;var a=e;var o=a.parentNode.children[0];var s=t;var l=n.hierNode.modifier;var u=a.hierNode.modifier;var c=o.hierNode.modifier;var f=s.hierNode.modifier;while(s=zD(s),a=BD(a),s&&a){n=zD(n);o=BD(o);n.hierNode.ancestor=e;var h=s.hierNode.prelim+f-a.hierNode.prelim-u+i(s,a);if(h>0){GD(VD(s,e,r),e,h);u+=h;l+=h}f+=s.hierNode.modifier;u+=a.hierNode.modifier;l+=n.hierNode.modifier;c+=o.hierNode.modifier}if(s&&!zD(n)){n.hierNode.thread=s;n.hierNode.modifier+=f-l}if(a&&!BD(o)){o.hierNode.thread=a;o.hierNode.modifier+=u-c;r=e}}return r}function zD(e){var t=e.children;return t.length&&e.isExpand?t[t.length-1]:e.hierNode.thread}function BD(e){var t=e.children;return t.length&&e.isExpand?t[0]:e.hierNode.thread}function VD(e,t,r){return e.hierNode.ancestor.parentNode===t.parentNode?e.hierNode.ancestor:r}function GD(e,t,r){var i=r/(t.hierNode.i-e.hierNode.i);t.hierNode.change-=i;t.hierNode.shift+=r;t.hierNode.modifier+=r;t.hierNode.prelim+=r;e.hierNode.change+=i}function FD(e,t){return e.parentNode===t.parentNode?1:2}var HD=function(){function e(){this.parentPoint=[];this.childPoints=[]}return e}();var WD=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new HD};e.prototype.buildPath=function(e,t){var r=t.childPoints;var i=r.length;var n=t.parentPoint;var a=r[0];var o=r[i-1];if(i===1){e.moveTo(n[0],n[1]);e.lineTo(a[0],a[1]);return}var s=t.orient;var l=s==="TB"||s==="BT"?0:1;var u=1-l;var c=Y(t.forkPosition,1);var f=[];f[l]=n[l];f[u]=n[u]+(o[u]-n[u])*c;e.moveTo(n[0],n[1]);e.lineTo(f[0],f[1]);e.moveTo(a[0],a[1]);f[l]=a[l];e.lineTo(f[0],f[1]);f[l]=o[l];e.lineTo(f[0],f[1]);e.lineTo(o[0],o[1]);for(var h=1;h<i-1;h++){var p=r[h];e.moveTo(p[0],p[1]);f[l]=p[l];e.lineTo(f[0],f[1])}};return e}(m);var jD=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._mainGroup=new H;return e}r.prototype.init=function(e,t){this._controller=new WT(t.getZr());this._controllerHost={target:this.group};this.group.add(this._mainGroup)};r.prototype.render=function(i,e,r){var n=i.getData();var t=i.layoutInfo;var a=this._mainGroup;var o=i.get("layout");if(o==="radial"){a.x=t.x+t.width/2;a.y=t.y+t.height/2}else{a.x=t.x;a.y=t.y}this._updateViewCoordSys(i);this._updateController(i,e,r);var s=this._data;n.diff(s).add(function(e){if(UD(n,e)){ZD(n,e,null,a,i)}}).update(function(e,t){var r=s.getItemGraphicEl(t);if(!UD(n,e)){r&&XD(s,t,r,a,i);return}ZD(n,e,r,a,i)}).remove(function(e){var t=s.getItemGraphicEl(e);if(t){XD(s,e,t,a,i)}}).execute();this._nodeScaleRatio=i.get("nodeScaleRatio");this._updateNodeAndLinkScale(i);if(i.get("expandAndCollapse")===true){n.eachItemGraphicEl(function(e,t){e.off("click").on("click",function(){r.dispatchAction({type:"treeExpandAndCollapse",seriesId:i.id,dataIndex:t})})})}this._data=n};r.prototype._updateViewCoordSys=function(e){var r=e.getData();var i=[];r.each(function(e){var t=r.getItemLayout(e);if(t&&!isNaN(t.x)&&!isNaN(t.y)){i.push([+t.x,+t.y])}});var t=[];var n=[];Ns(i,t,n);var a=this._min;var o=this._max;if(n[0]-t[0]===0){t[0]=a?a[0]:t[0]-1;n[0]=o?o[0]:n[0]+1}if(n[1]-t[1]===0){t[1]=a?a[1]:t[1]-1;n[1]=o?o[1]:n[1]+1}var s=e.coordinateSystem=new dD;s.zoomLimit=e.get("scaleLimit");s.setBoundingRect(t[0],t[1],n[0]-t[0],n[1]-t[1]);s.setCenter(e.get("center"));s.setZoom(e.get("zoom"));this.group.attr({x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY});this._min=t;this._max=n};r.prototype._updateController=function(n,e,a){var t=this;var r=this._controller;var i=this._controllerHost;var o=this.group;r.setPointerChecker(function(e,t,r){var i=o.getBoundingRect();i.applyTransform(o.transform);return i.contain(t,r)&&!JT(e,a,n)});r.enable(n.get("roam"));i.zoomLimit=n.get("scaleLimit");i.zoom=n.coordinateSystem.getZoom();r.off("pan").off("zoom").on("pan",function(e){YT(i,e.dx,e.dy);a.dispatchAction({seriesId:n.id,type:"treeRoam",dx:e.dx,dy:e.dy})}).on("zoom",function(e){XT(i,e.scale,e.originX,e.originY);a.dispatchAction({seriesId:n.id,type:"treeRoam",zoom:e.scale,originX:e.originX,originY:e.originY});t._updateNodeAndLinkScale(n);a.updateLabelLayout()})};r.prototype._updateNodeAndLinkScale=function(e){var t=e.getData();var r=this._getNodeGlobalScale(e);t.eachItemGraphicEl(function(e,t){e.setSymbolScale(r)})};r.prototype._getNodeGlobalScale=function(e){var t=e.coordinateSystem;if(t.type!=="view"){return 1}var r=this._nodeScaleRatio;var i=t.scaleX||1;var n=t.getZoom();var a=(n-1)*r+1;return a/i};r.prototype.dispose=function(){this._controller&&this._controller.dispose();this._controllerHost=null};r.prototype.remove=function(){this._mainGroup.removeAll();this._data=null};r.type="tree";return r}(v);function UD(e,t){var r=e.getItemLayout(t);return r&&!isNaN(r.x)&&!isNaN(r.y)}function ZD(r,e,i,t,n){var a=!i;var o=r.tree.getNodeByDataIndex(e);var s=o.getModel();var l=o.getVisual("style").fill;var u=o.isExpand===false&&o.children.length!==0?l:"#fff";var c=r.tree.root;var f=o.parentNode===c?o:o.parentNode||o;var h=r.getItemGraphicEl(f.dataIndex);var p=f.getLayout();var v=h?{x:h.__oldX,y:h.__oldY,rawX:h.__radialOldRawX,rawY:h.__radialOldRawY}:p;var d=o.getLayout();if(a){i=new II(r,e,null,{symbolInnerColor:u,useNameLabel:true});i.x=v.x;i.y=v.y}else{i.updateData(r,e,null,{symbolInnerColor:u,useNameLabel:true})}i.__radialOldRawX=i.__radialRawX;i.__radialOldRawY=i.__radialRawY;i.__radialRawX=d.rawX;i.__radialRawY=d.rawY;t.add(i);r.setItemGraphicEl(e,i);i.__oldX=i.x;i.__oldY=i.y;X(i,{x:d.x,y:d.y},n);var g=i.getSymbolPath();if(n.get("layout")==="radial"){var y=c.children[0];var m=y.getLayout();var x=y.children.length;var _=void 0;var b=void 0;if(d.x===m.x&&o.isExpand===true){var w={x:(y.children[0].getLayout().x+y.children[x-1].getLayout().x)/2,y:(y.children[0].getLayout().y+y.children[x-1].getLayout().y)/2};_=Math.atan2(w.y-m.y,w.x-m.x);if(_<0){_=Math.PI*2+_}b=w.x<m.x;if(b){_=_-Math.PI}}else{_=Math.atan2(d.y-m.y,d.x-m.x);if(_<0){_=Math.PI*2+_}if(o.children.length===0||o.children.length!==0&&o.isExpand===false){b=d.x<m.x;if(b){_=_-Math.PI}}else{b=d.x>m.x;if(!b){_=_-Math.PI}}}var S=b?"left":"right";var M=s.getModel("label");var I=M.get("rotate");var C=I*(Math.PI/180);var T=g.getTextContent();if(T){g.setTextConfig({position:M.get("position")||S,rotation:I==null?-_:C,origin:"center"});T.setStyle("verticalAlign","middle")}}var D=s.get(["emphasis","focus"]);var A=D==="ancestor"?o.getAncestorsIndices():D==="descendant"?o.getDescendantIndices():null;if(A){j(i).focus=A}YD(n,o,c,i,v,p,d,t);if(i.__edge){i.onHoverStateChange=function(e){if(e!=="blur"){var t=o.parentNode&&r.getItemGraphicEl(o.parentNode.dataIndex);if(!(t&&t.hoverState===ou)){Au(i.__edge,e)}}}}}function YD(e,t,r,i,n,a,o,s){var l=t.getModel();var u=e.get("edgeShape");var c=e.get("layout");var f=e.getOrient();var h=e.get(["lineStyle","curveness"]);var p=e.get("edgeForkPosition");var v=l.getModel("lineStyle").getLineStyle();var d=i.__edge;if(u==="curve"){if(t.parentNode&&t.parentNode!==r){if(!d){d=i.__edge=new mf({shape:qD(c,f,h,n,n)})}X(d,{shape:qD(c,f,h,a,o)},e)}}else if(u==="polyline"){if(c==="orthogonal"){if(t!==r&&t.children&&t.children.length!==0&&t.isExpand===true){var g=t.children;var y=[];for(var m=0;m<g.length;m++){var x=g[m].getLayout();y.push([x.x,x.y])}if(!d){d=i.__edge=new WD({shape:{parentPoint:[o.x,o.y],childPoints:[[o.x,o.y]],orient:f,forkPosition:p}})}X(d,{shape:{parentPoint:[o.x,o.y],childPoints:y}},e)}}else{if("development"!=="production"){throw new Error("The polyline edgeShape can only be used in orthogonal layout")}}}if(d){d.useStyle(R({strokeNoScale:true,fill:null},v));ac(d,l,"lineStyle");Eu(d);s.add(d)}}function XD(e,t,r,i,n){var a=e.tree.getNodeByDataIndex(t);var o=e.tree.root;var s=a.parentNode===o?a:a.parentNode||a;var l;while(l=s.getLayout(),l==null){s=s.parentNode===o?s:s.parentNode||s}var u={duration:n.get("animationDurationUpdate"),easing:n.get("animationEasingUpdate")};Jf(r,{x:l.x+1,y:l.y+1},n,{cb:function(){i.remove(r);e.setItemGraphicEl(t,null)},removeOpt:u});r.fadeOut(null,{fadeLabel:true,animation:u});var c=e.getItemGraphicEl(s.dataIndex);var f=c.__edge;var h=r.__edge||(s.isExpand===false||s.children.length===1?f:undefined);var p=n.get("edgeShape");var v=n.get("layout");var d=n.get("orient");var g=n.get(["lineStyle","curveness"]);if(h){if(p==="curve"){Jf(h,{shape:qD(v,d,g,l,l),style:{opacity:0}},n,{cb:function(){i.remove(h)},removeOpt:u})}else if(p==="polyline"&&n.get("layout")==="orthogonal"){Jf(h,{shape:{parentPoint:[l.x,l.y],childPoints:[[l.x,l.y]]},style:{opacity:0}},n,{cb:function(){i.remove(h)},removeOpt:u})}}}function qD(e,t,r,i,n){var a;var o;var s;var l;var u;var c;var f;var h;if(e==="radial"){u=i.rawX;f=i.rawY;c=n.rawX;h=n.rawY;var p=OD(u,f);var v=OD(u,f+(h-f)*r);var d=OD(c,h+(f-h)*r);var g=OD(c,h);return{x1:p.x||0,y1:p.y||0,x2:g.x||0,y2:g.y||0,cpx1:v.x||0,cpy1:v.y||0,cpx2:d.x||0,cpy2:d.y||0}}else{u=i.x;f=i.y;c=n.x;h=n.y;if(t==="LR"||t==="RL"){a=u+(c-u)*r;o=f;s=c+(u-c)*r;l=h}if(t==="TB"||t==="BT"){a=u;o=f+(h-f)*r;s=c;l=h+(f-h)*r}}return{x1:u,y1:f,x2:c,y2:h,cpx1:a,cpy1:o,cpx2:s,cpy2:l}}var JD=qa();function KD(r){var i=r.mainData;var e=r.datas;if(!e){e={main:i};r.datasAttr={main:"data"}}r.datas=r.mainData=null;nA(i,e,r);U(e,function(t){U(i.TRANSFERABLE_METHODS,function(e){t.wrapMethod(e,_(QD,r))})});i.wrapMethod("cloneShallow",_(eA,r));U(i.CHANGABLE_METHODS,function(e){i.wrapMethod(e,_($D,r))});E(e[i.dataType]===i)}function QD(e,t){if(iA(this)){var r=F({},JD(this).datas);r[this.dataType]=t;nA(t,r,e)}else{aA(t,this.dataType,JD(this).mainData,e)}return t}function $D(e,t){e.struct&&e.struct.update();return t}function eA(r,i){U(JD(i).datas,function(e,t){e!==i&&aA(e.cloneShallow(),t,i,r)});return i}function tA(e){var t=JD(this).mainData;return e==null||t==null?t:JD(t).datas[e]}function rA(){var t=JD(this).mainData;return t==null?[{data:t}]:A(L(JD(t).datas),function(e){return{type:e,data:JD(t).datas[e]}})}function iA(e){return JD(e).mainData===e}function nA(r,e,i){JD(r).datas={};U(e,function(e,t){aA(e,t,r,i)})}function aA(e,t,r,i){JD(r).datas[t]=e;JD(e).mainData=r;e.dataType=t;if(i.struct){e[i.structAttr]=i.struct;i.struct[i.datasAttr[t]]=e}e.getLinkedData=tA;e.getLinkedDataAll=rA}var oA=function(){function e(e,t){this.depth=0;this.height=0;this.dataIndex=-1;this.children=[];this.viewChildren=[];this.isExpand=false;this.name=e||"";this.hostTree=t}e.prototype.isRemoved=function(){return this.dataIndex<0};e.prototype.eachNode=function(e,t,r){if(typeof e==="function"){r=t;t=e;e=null}e=e||{};if(P(e)){e={order:e}}var i=e.order||"preorder";var n=this[e.attr||"children"];var a;i==="preorder"&&(a=t.call(r,this));for(var o=0;!a&&o<n.length;o++){n[o].eachNode(e,t,r)}i==="postorder"&&t.call(r,this)};e.prototype.updateDepthAndHeight=function(e){var t=0;this.depth=e;for(var r=0;r<this.children.length;r++){var i=this.children[r];i.updateDepthAndHeight(e+1);if(i.height>t){t=i.height}}this.height=t+1};e.prototype.getNodeById=function(e){if(this.getId()===e){return this}for(var t=0,r=this.children,i=r.length;t<i;t++){var n=r[t].getNodeById(e);if(n){return n}}};e.prototype.contains=function(e){if(e===this){return true}for(var t=0,r=this.children,i=r.length;t<i;t++){var n=r[t].contains(e);if(n){return n}}};e.prototype.getAncestors=function(e){var t=[];var r=e?this:this.parentNode;while(r){t.push(r);r=r.parentNode}t.reverse();return t};e.prototype.getAncestorsIndices=function(){var e=[];var t=this;while(t){e.push(t.dataIndex);t=t.parentNode}e.reverse();return e};e.prototype.getDescendantIndices=function(){var t=[];this.eachNode(function(e){t.push(e.dataIndex)});return t};e.prototype.getValue=function(e){var t=this.hostTree.data;return t.get(t.getDimension(e||"value"),this.dataIndex)};e.prototype.setLayout=function(e,t){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,e,t)};e.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)};e.prototype.getModel=function(e){if(this.dataIndex<0){return}var t=this.hostTree;var r=t.data.getItemModel(this.dataIndex);return r.getModel(e)};e.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]};e.prototype.setVisual=function(e,t){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,e,t)};e.prototype.getVisual=function(e){return this.hostTree.data.getItemVisual(this.dataIndex,e)};e.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)};e.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)};e.prototype.isAncestorOf=function(e){var t=e.parentNode;while(t){if(t===this){return true}t=t.parentNode}return false};e.prototype.isDescendantOf=function(e){return e!==this&&e.isAncestorOf(this)};return e}();var sA=function(){function a(e){this.type="tree";this._nodes=[];this.hostModel=e}a.prototype.eachNode=function(e,t,r){this.root.eachNode(e,t,r)};a.prototype.getNodeByDataIndex=function(e){var t=this.data.getRawIndex(e);return this._nodes[t]};a.prototype.getNodeById=function(e){return this.root.getNodeById(e)};a.prototype.update=function(){var e=this.data;var t=this._nodes;for(var r=0,i=t.length;r<i;r++){t[r].dataIndex=-1}for(var r=0,i=e.count();r<i;r++){t[e.getRawIndex(r)].dataIndex=r}};a.prototype.clearLayouts=function(){this.data.clearItemLayouts()};a.createTree=function(e,t,r){var o=new a(t);var s=[];var l=1;u(e);function u(e,t){var r=e.value;l=Math.max(l,k(r)?r.length:1);s.push(e);var i=new oA(Va(e.name,""),o);t?lA(i,t):o.root=i;o._nodes.push(i);var n=e.children;if(n){for(var a=0;a<n.length;a++){u(n[a],i)}}}o.root.updateDepthAndHeight(0);var i=$b(s,{coordDimensions:["value"],dimensionsCount:l});var n=new qb(i,t);n.initData(s);r&&r(n);KD({mainData:n,struct:o,structAttr:"tree"});o.update();return o};return a}();function lA(e,t){var r=t.children;if(e.parentNode===t){return}r.push(e);e.parentNode=t}function uA(e,t,r){if(e&&D(t,e.type)>=0){var i=r.getData().tree.root;var n=e.targetNode;if(typeof n==="string"){n=i.getNodeById(n)}if(n&&i.contains(n)){return{node:n}}var a=e.targetNodeId;if(a!=null&&(n=i.getNodeById(a))){return{node:n}}}}function cA(e){var t=[];while(e){e=e.parentNode;e&&t.push(e)}return t.reverse()}function fA(e,t){var r=cA(e);return D(r,t)>=0}function hA(e,t){var r=[];while(e){var i=e.dataIndex;r.push({name:e.name,dataIndex:i,value:t.getRawValue(i)});e=e.parentNode}r.reverse();return r}var pA=function(i){d(e,i);function e(){var e=i!==null&&i.apply(this,arguments)||this;e.hasSymbolVisual=true;e.ignoreStyleOnData=true;return e}e.prototype.getInitialData=function(e){var t={name:e.name,children:e.data};var r=e.leaves||{};var i=new C(r,this,this.ecModel);var n=sA.createTree(t,this,a);function a(e){e.wrapMethod("getItemModel",function(e,t){var r=n.getNodeByDataIndex(t);if(!(r&&r.children.length&&r.isExpand)){e.parentModel=i}return e})}var o=0;n.eachNode("preorder",function(e){if(e.depth>o){o=e.depth}});var s=e.expandAndCollapse;var l=s&&e.initialTreeDepth>=0?e.initialTreeDepth:o;n.root.eachNode("preorder",function(e){var t=e.hostTree.data.getRawDataItem(e.dataIndex);e.isExpand=t&&t.collapsed!=null?!t.collapsed:e.depth<=l});return n.data};e.prototype.getOrient=function(){var e=this.get("orient");if(e==="horizontal"){e="LR"}else if(e==="vertical"){e="TB"}return e};e.prototype.setZoom=function(e){this.option.zoom=e};e.prototype.setCenter=function(e){this.option.center=e};e.prototype.formatTooltip=function(e,t,r){var i=this.getData().tree;var n=i.root.children[0];var a=i.getNodeByDataIndex(e);var o=a.getValue();var s=a.name;while(a&&a!==n){s=a.parentNode.name+"."+s;a=a.parentNode}return Kg("nameValue",{name:s,value:o,noValue:isNaN(o)||o==null})};e.prototype.getDataParams=function(e){var t=i.prototype.getDataParams.apply(this,arguments);var r=this.getData().tree.getNodeByDataIndex(e);t.treeAncestors=hA(r,this);return t};e.type="series.tree";e.layoutMode="box";e.defaultOption={zlevel:0,z:2,coordinateSystem:"view",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:false,nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:true,initialTreeDepth:2,lineStyle:{color:"#ccc",width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:true},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500};return e}(dy);function vA(e,t,r){var i=[e];var n=[];var a;while(a=i.pop()){n.push(a);if(a.isExpand){var o=a.children;if(o.length){for(var s=0;s<o.length;s++){i.push(o[s])}}}}while(a=n.pop()){t(a,r)}}function dA(e,t){var r=[e];var i;while(i=r.pop()){t(i);if(i.isExpand){var n=i.children;if(n.length){for(var a=n.length-1;a>=0;a--){r.push(n[a])}}}}}function gA(e,t){e.eachSeriesByType("tree",function(e){yA(e,t)})}function yA(e,t){var r=ND(e,t);e.layoutInfo=r;var i=e.get("layout");var n=0;var a=0;var o=null;if(i==="radial"){n=2*Math.PI;a=Math.min(r.height,r.width)/2;o=PD(function(e,t){return(e.parentNode===t.parentNode?1:2)/e.depth})}else{n=r.width;a=r.height;o=PD()}var s=e.getData().tree.root;var l=s.children[0];if(l){AD(s);vA(l,LD,o);s.hierNode.modifier=-l.hierNode.prelim;dA(l,kD);var u=l;var c=l;var f=l;dA(l,function(e){var t=e.getLayout().x;if(t<u.getLayout().x){u=e}if(t>c.getLayout().x){c=e}if(e.depth>f.depth){f=e}});var h=u===c?1:o(u,c)/2;var p=h-u.getLayout().x;var v=0;var d=0;var g=0;var y=0;if(i==="radial"){v=n/(c.getLayout().x+h+p);d=a/(f.depth-1||1);dA(l,function(e){g=(e.getLayout().x+p)*v;y=(e.depth-1)*d;var t=OD(g,y);e.setLayout({x:t.x,y:t.y,rawX:g,rawY:y},true)})}else{var m=e.getOrient();if(m==="RL"||m==="LR"){d=a/(c.getLayout().x+h+p);v=n/(f.depth-1||1);dA(l,function(e){y=(e.getLayout().x+p)*d;g=m==="LR"?(e.depth-1)*v:n-(e.depth-1)*v;e.setLayout({x:g,y:y},true)})}else if(m==="TB"||m==="BT"){v=n/(c.getLayout().x+h+p);d=a/(f.depth-1||1);dA(l,function(e){g=(e.getLayout().x+p)*v;y=m==="TB"?(e.depth-1)*d:a-(e.depth-1)*d;e.setLayout({x:g,y:y},true)})}}}}function mA(e){e.eachSeriesByType("tree",function(e){var n=e.getData();var t=n.tree;t.eachNode(function(e){var t=e.getModel();var r=t.getModel("itemStyle").getItemStyle();var i=n.ensureUniqueItemVisual(e.dataIndex,"style");F(i,r)})})}function xA(e){e.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(n,e){e.eachComponent({mainType:"series",subType:"tree",query:n},function(e){var t=n.dataIndex;var r=e.getData().tree;var i=r.getNodeByDataIndex(t);i.isExpand=!i.isExpand})});e.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(i,e){e.eachComponent({mainType:"series",subType:"tree",query:i},function(e){var t=e.coordinateSystem;var r=ID(t,i);e.setCenter&&e.setCenter(r.center);e.setZoom&&e.setZoom(r.zoom)})})}function _A(e){e.registerChartView(jD);e.registerSeriesModel(pA);e.registerLayout(gA);e.registerVisual(mA);xA(e)}var bA=function(){};var wA=["treemapZoomToNode","treemapRender","treemapMove"];function SA(e){for(var t=0;t<wA.length;t++){e.registerAction({type:wA[t],update:"updateView"},bA)}e.registerAction({type:"treemapRootToNode",update:"updateView"},function(a,e){e.eachComponent({mainType:"series",subType:"treemap",query:a},t);function t(e,t){var r=["treemapZoomToNode","treemapRootToNode"];var i=uA(a,r,e);if(i){var n=e.getViewRoot();if(n){a.direction=fA(n,i.node)?"rollUp":"drillDown"}e.resetViewRoot(i.node)}}})}function MA(i){var e=i.getData();var t=e.tree;var n={};t.eachNode(function(e){var t=e;while(t&&t.depth>1){t=t.parentNode}var r=Wv(i.ecModel,t.name||t.dataIndex+"",n);e.setVisual("decal",r)})}var IA=function(i){d(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;e.type=t.type;e.preventUsingHoverLayer=true;return e}t.prototype.getInitialData=function(e,t){var r={name:e.name,children:e.data};CA(r);var i=e.levels||[];var n=this.designatedVisualItemStyle={};var a=new C({itemStyle:n},this,t);i=e.levels=TA(i,t);var o=A(i||[],function(e){return new C(e,a,t)},this);var s=sA.createTree(r,this,l);function l(e){e.wrapMethod("getItemModel",function(e,t){var r=s.getNodeByDataIndex(t);var i=r?o[r.depth]:null;e.parentModel=i||a;return e})}return s.data};t.prototype.optionUpdated=function(){this.resetViewRoot()};t.prototype.formatTooltip=function(e,t,r){var i=this.getData();var n=this.getRawValue(e);var a=i.getName(e);return Kg("nameValue",{name:a,value:n})};t.prototype.getDataParams=function(e){var t=i.prototype.getDataParams.apply(this,arguments);var r=this.getData().tree.getNodeByDataIndex(e);t.treePathInfo=hA(r,this);return t};t.prototype.setLayoutInfo=function(e){this.layoutInfo=this.layoutInfo||{};F(this.layoutInfo,e)};t.prototype.mapIdToIndex=function(e){var t=this._idIndexMap;if(!t){t=this._idIndexMap=I();this._idIndexMapCount=0}var r=t.get(e);if(r==null){t.set(e,r=this._idIndexMapCount++)}return r};t.prototype.getViewRoot=function(){return this._viewRoot};t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var t=this.getRawData().tree.root;if(!e||e!==t&&!t.contains(e)){this._viewRoot=t}};t.prototype.enableAriaDecal=function(){MA(this)};t.type="series.treemap";t.layoutMode="box";t.defaultOption={progressive:0,left:"center",top:"middle",width:"80%",height:"80%",sort:true,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"",zoomToNodeRatio:.32*.32,roam:true,nodeClick:"zoomToNode",animation:true,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:true,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{color:"rgba(0,0,0,0.7)",textStyle:{color:"#fff"}}},label:{show:true,distance:0,padding:5,position:"inside",color:"#fff",overflow:"truncate"},upperLabel:{show:false,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{upperLabel:{show:true,position:[0,"50%"],ellipsis:true,verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]};return t}(dy);function CA(e){var r=0;U(e.children,function(e){CA(e);var t=e.value;k(t)&&(t=t[0]);r+=t});var t=e.value;if(k(t)){t=t[0]}if(t==null||isNaN(t)){t=r}if(t<0){t=0}k(e.value)?e.value[0]=t:e.value=t}function TA(e,t){var r=Ia(t.get("color"));var i=Ia(t.get(["aria","decal","decals"]));if(!r){return}e=e||[];var n;var a;U(e,function(e){var t=new C(e);var r=t.get("color");var i=t.get("decal");if(t.get(["itemStyle","color"])||r&&r!=="none"){n=true}if(t.get(["itemStyle","decal"])||i&&i!=="none"){a=true}});var o=e[0]||(e[0]={});if(!n){o.color=r.slice()}if(!a&&i){o.decal=i.slice()}return e}var DA=8;var AA=8;var LA=5;var kA=function(){function e(e){this.group=new H;e.add(this.group)}e.prototype.render=function(e,t,r,i){var n=e.getModel("breadcrumb");var a=this.group;a.removeAll();if(!n.get("show")||!r){return}var o=n.getModel("itemStyle");var s=o.getModel("textStyle");var l={pos:{left:n.get("left"),right:n.get("right"),top:n.get("top"),bottom:n.get("bottom")},box:{width:t.getWidth(),height:t.getHeight()},emptyItemWidth:n.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(r,l,s);this._renderContent(e,l,o,s,i);lv(a,l.pos,l.box)};e.prototype._prepare=function(e,t,r){for(var i=e;i;i=i.parentNode){var n=Va(i.getModel().get("name"),"");var a=r.getTextRect(n);var o=Math.max(a.width+DA*2,t.emptyItemWidth);t.totalWidth+=o+AA;t.renderList.push({node:i,text:n,width:o})}};e.prototype._renderContent=function(e,t,r,i,n){var a=0;var o=t.emptyItemWidth;var s=e.get(["breadcrumb","height"]);var l=ov(t.pos,t.box);var u=t.totalWidth;var c=t.renderList;for(var f=c.length-1;f>=0;f--){var h=c[f];var p=h.node;var v=h.width;var d=h.text;if(u>l.width){u-=v-o;v=o;d=null}var g=new uf({shape:{points:PA(a,0,v,s,f===c.length-1,f===0)},style:R(r.getItemStyle(),{lineJoin:"bevel"}),textContent:new W({style:{text:d,fill:i.getTextColor(),font:i.getFont()}}),textConfig:{position:"inside"},z2:cu*1e4,onclick:_(n,p)});g.disableLabelAnimation=true;this.group.add(g);OA(g,e,p);a+=v+AA}};e.prototype.remove=function(){this.group.removeAll()};return e}();function PA(e,t,r,i,n,a){var o=[[n?e:e-LA,t],[e+r,t],[e+r,t+i],[n?e:e-LA,t+i]];!a&&o.splice(2,0,[e+r+LA,t+i/2]);!n&&o.push([e,t+i/2]);return o}function OA(e,t,r){j(e).eventData={componentType:"series",componentSubType:"treemap",componentIndex:t.componentIndex,seriesIndex:t.componentIndex,seriesName:t.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:r&&r.dataIndex,name:r&&r.name},treePathInfo:r&&hA(r,t)}}var NA=function(){function e(){this._storage=[];this._elExistsMap={}}e.prototype.add=function(e,t,r,i,n){if(this._elExistsMap[e.id]){return false}this._elExistsMap[e.id]=true;this._storage.push({el:e,target:t,duration:r,delay:i,easing:n});return true};e.prototype.finished=function(e){this._finishedCallback=e;return this};e.prototype.start=function(){var e=this;var t=this._storage.length;var r=function(){t--;if(t<=0){e._storage.length=0;e._elExistsMap={};e._finishedCallback&&e._finishedCallback()}};for(var i=0,n=this._storage.length;i<n;i++){var a=this._storage[i];a.el.animateTo(a.target,{duration:a.duration,delay:a.delay,easing:a.easing,setToFinal:true,done:r,aborted:r})}return this};return e}();function EA(){return new NA}var RA=H;var zA=G;var BA=3;var VA="label";var GA="upperLabel";var FA=cu*10;var HA=cu*2;var WA=cu*3;var jA=wo([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]);var UA=function(e){var t=jA(e);t.stroke=t.fill=t.lineWidth=null;return t};var ZA=qa();var YA=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._state="ready";e._storage=XA();return e}r.prototype.render=function(e,t,r,i){var n=t.findComponents({mainType:"series",subType:"treemap",query:i});if(D(n,e)<0){return}this.seriesModel=e;this.api=r;this.ecModel=t;var a=["treemapZoomToNode","treemapRootToNode"];var o=uA(i,a,e);var s=i&&i.type;var l=e.layoutInfo;var u=!this._oldTree;var c=this._storage;var f=s==="treemapRootToNode"&&o&&c?{rootNodeGroup:c.nodeGroup[o.node.getRawIndex()],direction:i.direction}:null;var h=this._giveContainerGroup(l);var p=this._doRender(h,e,f);!u&&(!s||s==="treemapZoomToNode"||s==="treemapRootToNode")?this._doAnimation(h,p,e,f):p.renderFinally();this._resetController(r);this._renderBreadcrumb(e,r,o)};r.prototype._giveContainerGroup=function(e){var t=this._containerGroup;if(!t){t=this._containerGroup=new RA;this._initEvents(t);this.group.add(t)}t.x=e.x;t.y=e.y;return t};r.prototype._doRender=function(e,n,a){var t=n.getData().tree;var r=this._oldTree;var o=XA();var s=XA();var l=this._storage;var u=[];function c(e,t,r,i){return qA(n,s,l,a,o,u,e,t,r,i)}f(t.root?[t.root]:[],r&&r.root?[r.root]:[],e,t===r||!r,0);var i=h(l);this._oldTree=t;this._storage=s;return{lastsForAnimation:o,willDeleteEls:i,renderFinally:p};function f(a,o,s,l,u){if(l){o=a;U(a,function(e,t){!e.isRemoved()&&r(t,t)})}else{new gb(o,a,e,e).add(r).update(r).remove(_(r,null)).execute()}function e(e){return e.getId()}function r(e,t){var r=e!=null?a[e]:null;var i=t!=null?o[t]:null;var n=c(r,i,s,u);n&&f(r&&r.viewChildren||[],i&&i.viewChildren||[],n,l,u+1)}}function h(e){var i=XA();e&&U(e,function(e,t){var r=i[t];U(e,function(e){e&&(r.push(e),ZA(e).willDelete=true)})});return i}function p(){U(i,function(e){U(e,function(e){e.parent&&e.parent.remove(e)})});U(u,function(e){e.invisible=true;e.dirty()})}};r.prototype._doAnimation=function(e,a,t,l){if(!t.get("animation")){return}var r=t.get("animationDurationUpdate");var i=t.get("animationEasing");var u=(b(r)?0:r)||0;var c=(b(i)?null:i)||"cubicOut";var f=EA();U(a.willDeleteEls,function(e,s){U(e,function(e,t){if(e.invisible){return}var r=e.parent;var i;var n=ZA(r);if(l&&l.direction==="drillDown"){i=r===l.rootNodeGroup?{shape:{x:0,y:0,width:n.nodeWidth,height:n.nodeHeight},style:{opacity:0}}:{style:{opacity:0}}}else{var a=0;var o=0;if(!n.willDelete){a=n.nodeWidth/2;o=n.nodeHeight/2}i=s==="nodeGroup"?{x:a,y:o,style:{opacity:0}}:{shape:{x:a,y:o,width:0,height:0},style:{opacity:0}}}i&&f.add(e,i,u,0,c)})});U(this._storage,function(e,n){U(e,function(e,t){var r=a.lastsForAnimation[n][t];var i={};if(!r){return}if(e instanceof H){if(r.oldX!=null){i.x=e.x;i.y=e.y;e.x=r.oldX;e.y=r.oldY}}else{if(r.oldShape){i.shape=F({},e.shape);e.setShape(r.oldShape)}if(r.fadein){e.setStyle("opacity",0);i.style={opacity:1}}else if(e.style.opacity!==1){i.style={opacity:1}}}f.add(e,i,u,0,c)})},this);this._state="animating";f.finished(x(function(){this._state="ready";a.renderFinally()},this)).start()};r.prototype._resetController=function(e){var t=this._controller;if(!t){t=this._controller=new WT(e.getZr());t.enable(this.seriesModel.get("roam"));t.on("pan",x(this._onPan,this));t.on("zoom",x(this._onZoom,this))}var i=new B(0,0,e.getWidth(),e.getHeight());t.setPointerChecker(function(e,t,r){return i.contain(t,r)})};r.prototype._clearController=function(){var e=this._controller;if(e){e.dispose();e=null}};r.prototype._onPan=function(e){if(this._state!=="animating"&&(Math.abs(e.dx)>BA||Math.abs(e.dy)>BA)){var t=this.seriesModel.getData().tree.root;if(!t){return}var r=t.getLayout();if(!r){return}this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:r.x+e.dx,y:r.y+e.dy,width:r.width,height:r.height}})}};r.prototype._onZoom=function(e){var t=e.originX;var r=e.originY;if(this._state!=="animating"){var i=this.seriesModel.getData().tree.root;if(!i){return}var n=i.getLayout();if(!n){return}var a=new B(n.x,n.y,n.width,n.height);var o=this.seriesModel.layoutInfo;t-=o.x;r-=o.y;var s=Pi();Ri(s,s,[-t,-r]);Bi(s,s,[e.scale,e.scale]);Ri(s,s,[t,r]);a.applyTransform(s);this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:a.x,y:a.y,width:a.width,height:a.height}})}};r.prototype._initEvents=function(e){var s=this;e.on("click",function(e){if(s._state!=="ready"){return}var t=s.seriesModel.get("nodeClick",true);if(!t){return}var r=s.findTarget(e.offsetX,e.offsetY);if(!r){return}var i=r.node;if(i.getLayout().isLeafRoot){s._rootToNode(r)}else{if(t==="zoomToNode"){s._zoomToNode(r)}else if(t==="link"){var n=i.hostTree.data.getItemModel(i.dataIndex);var a=n.get("link",true);var o=n.get("target",true)||"blank";a&&Qp(a,o)}}},this)};r.prototype._renderBreadcrumb=function(t,e,r){var i=this;if(!r){r=t.get("leafDepth",true)!=null?{node:t.getViewRoot()}:this.findTarget(e.getWidth()/2,e.getHeight()/2);if(!r){r={node:t.getData().tree.root}}}(this._breadcrumb||(this._breadcrumb=new kA(this.group))).render(t,e,r.node,function(e){if(i._state!=="animating"){fA(t.getViewRoot(),e)?i._rootToNode({node:e}):i._zoomToNode({node:e})}})};r.prototype.remove=function(){this._clearController();this._containerGroup&&this._containerGroup.removeAll();this._storage=XA();this._state="ready";this._breadcrumb&&this._breadcrumb.remove()};r.prototype.dispose=function(){this._clearController()};r.prototype._zoomToNode=function(e){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})};r.prototype._rootToNode=function(e){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})};r.prototype.findTarget=function(n,a){var o;var e=this.seriesModel.getViewRoot();e.eachNode({attr:"viewChildren",order:"preorder"},function(e){var t=this._storage.background[e.getRawIndex()];if(t){var r=t.transformCoordToLocal(n,a);var i=t.shape;if(i.x<=r[0]&&r[0]<=i.x+i.width&&i.y<=r[1]&&r[1]<=i.y+i.height){o={node:e,offsetX:r[0],offsetY:r[1]}}else{return false}}},this);return o};r.type="treemap";return r}(v);function XA(){return{nodeGroup:[],background:[],content:[]}}function qA(f,o,s,l,u,t,h,e,r,i){if(!h){return}var p=h.getLayout();var n=f.getData();var v=h.getModel();n.setItemGraphicEl(h.dataIndex,null);if(!p||!p.isInView){return}var d=p.width;var g=p.height;var y=p.borderWidth;var m=p.invisible;var c=h.getRawIndex();var x=e&&e.getRawIndex();var a=h.viewChildren;var R=p.upperHeight;var _=a&&a.length;var b=v.getModel("itemStyle");var w=v.getModel(["emphasis","itemStyle"]);var S=v.getModel(["blur","itemStyle"]);var M=v.getModel(["select","itemStyle"]);var I=b.get("borderRadius")||0;var C=E("nodeGroup",RA);if(!C){return}r.add(C);C.x=p.x||0;C.y=p.y||0;C.markRedraw();ZA(C).nodeWidth=d;ZA(C).nodeHeight=g;if(p.isAboveViewRoot){return C}var T=E("background",zA,i,HA);T&&z(C,T,_&&p.upperLabelHeight);var D=v.get(["emphasis","focus"]);var A=v.get(["emphasis","blurScope"]);var L=D==="ancestor"?h.getAncestorsIndices():D==="descendant"?h.getDescendantIndices():D;if(_){if(sc(C)){oc(C,false)}if(T){oc(T,true);n.setItemGraphicEl(h.dataIndex,T);rc(T,L,A)}}else{var k=E("content",zA,i,WA);k&&B(C,k);if(T&&sc(T)){oc(T,false)}oc(C,true);n.setItemGraphicEl(h.dataIndex,C);rc(C,L,A)}return C;function z(e,t,r){var i=j(t);i.dataIndex=h.dataIndex;i.seriesIndex=f.seriesIndex;t.setShape({x:0,y:0,width:d,height:g,r:I});if(m){P(t)}else{t.invisible=false;var n=h.getVisual("style");var a=n.stroke;var o=UA(b);o.fill=a;var s=jA(w);s.fill=w.get("borderColor");var l=jA(S);l.fill=S.get("borderColor");var u=jA(M);u.fill=M.get("borderColor");if(r){var c=d-2*y;O(t,a,n.opacity,{x:y,y:0,width:c,height:R})}else{t.removeTextContent()}t.setStyle(o);t.ensureState("emphasis").style=s;t.ensureState("blur").style=l;t.ensureState("select").style=u;Eu(t)}e.add(t)}function B(e,t){var r=j(t);r.dataIndex=h.dataIndex;r.seriesIndex=f.seriesIndex;var i=Math.max(d-2*y,0);var n=Math.max(g-2*y,0);t.culling=true;t.setShape({x:y,y:y,width:i,height:n,r:I});if(m){P(t)}else{t.invisible=false;var a=h.getVisual("style");var o=a.fill;var s=UA(b);s.fill=o;s.decal=a.decal;var l=jA(w);var u=jA(S);var c=jA(M);O(t,o,a.opacity,null);t.setStyle(s);t.ensureState("emphasis").style=l;t.ensureState("blur").style=u;t.ensureState("select").style=c;Eu(t)}e.add(t)}function P(e){!e.invisible&&t.push(e)}function O(r,e,t,i){var n=v.getModel(i?GA:VA);var a=Va(v.get("name"),null);var o=n.getShallow("show");mh(r,xh(v,i?GA:VA),{defaultText:o?a:null,inheritColor:e,defaultOpacity:t,labelFetcher:f,labelDataIndex:h.dataIndex});var s=r.getTextContent();var l=s.style;var u=Me(l.padding||0);if(i){r.setTextConfig({layoutRect:i});s.disableLabelLayout=true}s.beforeUpdate=function(){var e=Math.max((i?i.width:r.shape.width)-u[1]-u[3],0);var t=Math.max((i?i.height:r.shape.height)-u[0]-u[2],0);if(l.width!==e||l.height!==t){s.setStyle({width:e,height:t})}};l.truncateMinChar=2;l.lineOverflow="truncate";N(l,i,p);var c=s.getState("emphasis");N(c?c.style:null,i,p)}function N(e,t,r){var i=e?e.text:null;if(!t&&r.isLeafRoot&&i!=null){var n=f.get("drillDownIcon",true);e.text=n?n+" "+i:i}}function E(e,t,r,i){var n=x!=null&&s[e][x];var a=u[e];if(n){s[e][x]=null;V(a,n)}else if(!m){n=new t;if(n instanceof Ko){n.z2=JA(r,i)}G(a,n)}return o[e][c]=n}function V(e,t){var r=e[c]={};if(t instanceof RA){r.oldX=t.x;r.oldY=t.y}else{r.oldShape=F({},t.shape)}}function G(e,t){var r=e[c]={};var i=h.parentNode;var n=t instanceof H;if(i&&(!l||l.direction==="drillDown")){var a=0;var o=0;var s=u.background[i.getRawIndex()];if(!l&&s&&s.oldShape){a=s.oldShape.width;o=s.oldShape.height}if(n){r.oldX=0;r.oldY=o}else{r.oldShape={x:a,y:o,width:0,height:0}}}r.fadein=!n}}function JA(e,t){return e*FA+t}var KA=U;var QA=O;var $A=-1;var eL=function(){function s(e){var t=e.mappingMethod;var r=e.type;var i=this.option=M(e);this.type=r;this.mappingMethod=t;this._normalizeData=hL[t];var n=s.visualHandlers[r];this.applyVisual=n.applyVisual;this.getColorMapper=n.getColorMapper;this._normalizedToVisual=n._normalizedToVisual[t];if(t==="piecewise"){iL(i);tL(i)}else if(t==="category"){i.categories?rL(i):iL(i,true)}else{E(t!=="linear"||i.dataExtent);iL(i)}}s.prototype.mapValueToVisual=function(e){var t=this._normalizeData(e);return this._normalizedToVisual(t,e)};s.prototype.getNormalizer=function(){return x(this._normalizeData,this)};s.listVisualTypes=function(){return L(s.visualHandlers)};s.isValidType=function(e){return s.visualHandlers.hasOwnProperty(e)};s.eachVisual=function(e,t,r){if(O(e)){U(e,t,r)}else{t.call(r,e)}};s.mapVisual=function(e,i,n){var a;var o=k(e)?[]:O(e)?{}:(a=true,null);s.eachVisual(e,function(e,t){var r=i.call(n,e,t);a?o=r:o[t]=r});return o};s.retrieveVisuals=function(r){var i={};var n;r&&KA(s.visualHandlers,function(e,t){if(r.hasOwnProperty(t)){i[t]=r[t];n=true}});return n?i:null};s.prepareVisualTypes=function(e){if(k(e)){e=e.slice()}else if(QA(e)){var r=[];KA(e,function(e,t){r.push(t)});e=r}else{return[]}e.sort(function(e,t){return t==="color"&&e!=="color"&&e.indexOf("color")===0?1:-1});return e};s.dependsOn=function(e,t){return t==="color"?!!(e&&e.indexOf(t)===0):e===t};s.findPieceIndex=function(i,e,t){var n;var a=Infinity;for(var r=0,o=e.length;r<o;r++){var s=e[r].value;if(s!=null){if(s===i||typeof s==="string"&&s===i+""){return r}t&&f(s,r)}}for(var r=0,o=e.length;r<o;r++){var l=e[r];var u=l.interval;var c=l.close;if(u){if(u[0]===-Infinity){if(pL(c[1],i,u[1])){return r}}else if(u[1]===Infinity){if(pL(c[0],u[0],i)){return r}}else if(pL(c[0],u[0],i)&&pL(c[1],i,u[1])){return r}t&&f(u[0],r);t&&f(u[1],r)}}if(t){return i===Infinity?e.length-1:i===-Infinity?0:n}function f(e,t){var r=Math.abs(e-i);if(r<a){a=r;n=t}}};s.visualHandlers={color:{applyVisual:oL("color"),getColorMapper:function(){var n=this.option;return x(n.mappingMethod==="category"?function(e,t){!t&&(e=this._normalizeData(e));return sL.call(this,e)}:function(e,t,r){var i=!!r;!t&&(e=this._normalizeData(e));r=Pr(e,n.parsedVisual,r);return i?r:Br(r,"rgba")},this)},_normalizedToVisual:{linear:function(e){return Br(Pr(e,this.option.parsedVisual),"rgba")},category:sL,piecewise:function(e,t){var r=cL.call(this,t);if(r==null){r=Br(Pr(e,this.option.parsedVisual),"rgba")}return r},fixed:lL}},colorHue:nL(function(e,t){return Rr(e,t)}),colorSaturation:nL(function(e,t){return Rr(e,null,t)}),colorLightness:nL(function(e,t){return Rr(e,null,null,t)}),colorAlpha:nL(function(e,t){return zr(e,t)}),decal:{applyVisual:oL("decal"),_normalizedToVisual:{linear:null,category:sL,piecewise:null,fixed:null}},opacity:{applyVisual:oL("opacity"),_normalizedToVisual:uL([0,1])},liftZ:{applyVisual:oL("liftZ"),_normalizedToVisual:{linear:lL,category:lL,piecewise:lL,fixed:lL}},symbol:{applyVisual:function(e,t,r){var i=this.mapValueToVisual(e);r("symbol",i)},_normalizedToVisual:{linear:aL,category:sL,piecewise:function(e,t){var r=cL.call(this,t);if(r==null){r=aL.call(this,e)}return r},fixed:lL}},symbolSize:{applyVisual:oL("symbolSize"),_normalizedToVisual:uL([0,1])}};return s}();function tL(r){var e=r.pieceList;r.hasSpecialVisual=false;U(e,function(e,t){e.originIndex=t;if(e.visual!=null){r.hasSpecialVisual=true}})}function rL(e){var t=e.categories;var i=e.categoryMap={};var r=e.visual;KA(t,function(e,t){i[e]=t});if(!k(r)){var n=[];if(O(r)){KA(r,function(e,t){var r=i[t];n[r!=null?r:$A]=e})}else{n[$A]=r}r=fL(e,n)}for(var a=t.length-1;a>=0;a--){if(r[a]==null){delete i[t[a]];t.pop()}}}function iL(e,t){var r=e.visual;var i=[];if(O(r)){KA(r,function(e){i.push(e)})}else if(r!=null){i.push(r)}var n={color:1,symbol:1};if(!t&&i.length===1&&!n.hasOwnProperty(e.type)){i[1]=i[0]}fL(e,i)}function nL(n){return{applyVisual:function(e,t,r){var i=this.mapValueToVisual(e);r("color",n(t("color"),i))},_normalizedToVisual:uL([0,1])}}function aL(e){var t=this.option.visual;return t[Math.round(V(e,[0,1],[0,t.length-1],true))]||{}}function oL(i){return function(e,t,r){r(i,this.mapValueToVisual(e))}}function sL(e){var t=this.option.visual;return t[this.option.loop&&e!==$A?e%t.length:e]}function lL(){return this.option.visual[0]}function uL(i){return{linear:function(e){return V(e,i,this.option.visual,true)},category:sL,piecewise:function(e,t){var r=cL.call(this,t);if(r==null){r=V(e,i,this.option.visual,true)}return r},fixed:lL}}function cL(e){var t=this.option;var r=t.pieceList;if(t.hasSpecialVisual){var i=eL.findPieceIndex(e,r);var n=r[i];if(n&&n.visual){return n.visual[this.type]}}}function fL(e,t){e.visual=t;if(e.type==="color"){e.parsedVisual=A(t,function(e){return Tr(e)})}return t}var hL={linear:function(e){return V(e,this.option.dataExtent,[0,1],true)},piecewise:function(e){var t=this.option.pieceList;var r=eL.findPieceIndex(e,t,true);if(r!=null){return V(r,[0,t.length-1],[0,1],true)}},category:function(e){var t=this.option.categories?this.option.categoryMap[e]:e;return t==null?$A:t},fixed:Pe};function pL(e,t,r){return e?t<=r:t<r}var vL="itemStyle";var dL=qa();var gL={seriesType:"treemap",reset:function(e){var t=e.getData().tree;var r=t.root;if(r.isRemoved()){return}yL(r,{},e.getViewRoot().getAncestors(),e)}};function yL(e,t,i,n){var a=e.getModel();var r=e.getLayout();var o=e.hostTree.data;if(!r||r.invisible||!r.isInView){return}var s=a.getModel(vL);var l=mL(s,t,n);var u=o.ensureUniqueItemVisual(e.dataIndex,"style");var c=s.get("borderColor");var f=s.get("borderColorSaturation");var h;if(f!=null){h=xL(l);c=_L(f,h)}u.stroke=c;var p=e.viewChildren;if(!p||!p.length){h=xL(l);u.fill=h}else{var v=wL(e,a,r,s,l,p);U(p,function(e,t){if(e.depth>=i.length||e===i[e.depth]){var r=ML(a,l,e,t,v,n);yL(e,r,i,n)}})}}function mL(r,i,e){var n=F({},i);var a=e.designatedVisualItemStyle;U(["color","colorAlpha","colorSaturation"],function(e){a[e]=i[e];var t=r.get(e);a[e]=null;t!=null&&(n[e]=t)});return n}function xL(e){var t=bL(e,"color");if(t){var r=bL(e,"colorAlpha");var i=bL(e,"colorSaturation");if(i){t=Rr(t,null,null,i)}if(r){t=zr(t,r)}return t}}function _L(e,t){return t!=null?Rr(t,null,null,e):null}function bL(e,t){var r=e[t];if(r!=null&&r!=="none"){return r}}function wL(e,t,r,i,n,a){if(!a||!a.length){return}var o=SL(t,"color")||n.color!=null&&n.color!=="none"&&(SL(t,"colorAlpha")||SL(t,"colorSaturation"));if(!o){return}var s=t.get("visualMin");var l=t.get("visualMax");var u=r.dataExtent.slice();s!=null&&s<u[0]&&(u[0]=s);l!=null&&l>u[1]&&(u[1]=l);var c=t.get("colorMappingBy");var f={type:o.name,dataExtent:u,visual:o.range};if(f.type==="color"&&(c==="index"||c==="id")){f.mappingMethod="category";f.loop=true}else{f.mappingMethod="linear"}var h=new eL(f);dL(h).drColorMappingBy=c;return h}function SL(e,t){var r=e.get(t);return k(r)&&r.length?{name:t,range:r}:null}function ML(e,t,r,i,n,a){var o=F({},t);if(n){var s=n.type;var l=s==="color"&&dL(n).drColorMappingBy;var u=l==="index"?i:l==="id"?a.mapIdToIndex(r.getId()):r.getValue(e.get("visualDimension"));o[s]=n.mapValueToVisual(u)}return o}var IL=Math.max;var CL=Math.min;var TL=be;var DL=U;var AL=["itemStyle","borderWidth"];var LL=["itemStyle","gapWidth"];var kL=["upperLabel","show"];var PL=["upperLabel","height"];var OL={seriesType:"treemap",reset:function(e,t,r,i){var n=r.getWidth();var a=r.getHeight();var o=e.option;var s=sv(e.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()});var l=o.size||[];var u=Y(TL(s.width,l[0]),n);var c=Y(TL(s.height,l[1]),a);var f=i&&i.type;var h=["treemapZoomToNode","treemapRootToNode"];var p=uA(i,h,e);var v=f==="treemapRender"||f==="treemapMove"?i.rootRect:null;var d=e.getViewRoot();var g=cA(d);if(f!=="treemapMove"){var y=f==="treemapZoomToNode"?FL(e,p,d,u,c):v?[v.width,v.height]:[u,c];var m=o.sort;if(m&&m!=="asc"&&m!=="desc"){m="desc"}var x={squareRatio:o.squareRatio,sort:m,leafDepth:o.leafDepth};d.hostTree.clearLayouts();var _={x:0,y:0,width:y[0],height:y[1],area:y[0]*y[1]};d.setLayout(_);NL(d,x,false,0);_=d.getLayout();DL(g,function(e,t){var r=(g[t+1]||d).getValue();e.setLayout(F({dataExtent:[r,r],borderWidth:0,upperHeight:0},_))})}var b=e.getData().tree.root;b.setLayout(HL(s,v,p),true);e.setLayoutInfo(s);WL(b,new B(-s.x,-s.y,n,a),g,d,0)}};function NL(e,t,r,i){var n;var a;if(e.isRemoved()){return}var o=e.getLayout();n=o.width;a=o.height;var s=e.getModel();var l=s.get(AL);var u=s.get(LL)/2;var c=jL(s);var f=Math.max(l,c);var h=l-u;var p=f-u;e.setLayout({borderWidth:l,upperHeight:f,upperLabelHeight:c},true);n=IL(n-2*h,0);a=IL(a-h-p,0);var v=n*a;var d=EL(e,s,v,t,r,i);if(!d.length){return}var g={x:h,y:p,width:n,height:a};var y=CL(n,a);var m=Infinity;var x=[];x.area=0;for(var _=0,b=d.length;_<b;){var w=d[_];x.push(w);x.area+=w.getLayout().area;var S=VL(x,y,t.squareRatio);if(S<=m){_++;m=S}else{x.area-=x.pop().getLayout().area;GL(x,y,g,u,false);y=CL(g.width,g.height);x.length=x.area=0;m=Infinity}}if(x.length){GL(x,y,g,u,true)}if(!r){var M=s.get("childrenVisibleMin");if(M!=null&&v<M){r=true}}for(var _=0,b=d.length;_<b;_++){NL(d[_],t,r,i+1)}}function EL(e,t,r,i,n,a){var o=e.children||[];var s=i.sort;s!=="asc"&&s!=="desc"&&(s=null);var l=i.leafDepth!=null&&i.leafDepth<=a;if(n&&!l){return e.viewChildren=[]}o=ue(o,function(e){return!e.isRemoved()});zL(o,s);var u=BL(t,o,s);if(u.sum===0){return e.viewChildren=[]}u.sum=RL(t,r,u.sum,s,o);if(u.sum===0){return e.viewChildren=[]}for(var c=0,f=o.length;c<f;c++){var h=o[c].getValue()/u.sum*r;o[c].setLayout({area:h})}if(l){o.length&&e.setLayout({isLeafRoot:true},true);o.length=0}e.viewChildren=o;e.setLayout({dataExtent:u.dataExtent},true);return o}function RL(e,t,r,i,n){if(!i){return r}var a=e.get("visibleMin");var o=n.length;var s=o;for(var l=o-1;l>=0;l--){var u=n[i==="asc"?o-l-1:l].getValue();if(u/r*t<a){s=l;r-=u}}i==="asc"?n.splice(0,o-s):n.splice(s,o-s);return r}function zL(e,i){if(i){e.sort(function(e,t){var r=i==="asc"?e.getValue()-t.getValue():t.getValue()-e.getValue();return r===0?i==="asc"?e.dataIndex-t.dataIndex:t.dataIndex-e.dataIndex:r})}return e}function BL(e,t,r){var i=0;for(var n=0,a=t.length;n<a;n++){i+=t[n].getValue()}var o=e.get("visualDimension");var s;if(!t||!t.length){s=[NaN,NaN]}else if(o==="value"&&r){s=[t[t.length-1].getValue(),t[0].getValue()];r==="asc"&&s.reverse()}else{s=[Infinity,-Infinity];DL(t,function(e){var t=e.getValue(o);t<s[0]&&(s[0]=t);t>s[1]&&(s[1]=t)})}return{sum:i,dataExtent:s}}function VL(e,t,r){var i=0;var n=Infinity;for(var a=0,o=void 0,s=e.length;a<s;a++){o=e[a].getLayout().area;if(o){o<n&&(n=o);o>i&&(i=o)}}var l=e.area*e.area;var u=t*t*r;return l?IL(u*i/l,l/(u*n)):Infinity}function GL(e,t,r,i,n){var a=t===r.width?0:1;var o=1-a;var s=["x","y"];var l=["width","height"];var u=r[s[a]];var c=t?e.area/t:0;if(n||c>r[l[o]]){c=r[l[o]]}for(var f=0,h=e.length;f<h;f++){var p=e[f];var v={};var d=c?p.getLayout().area/c:0;var g=v[l[o]]=IL(c-2*i,0);var y=r[s[a]]+r[l[a]]-u;var m=f===h-1||y<d?y:d;var x=v[l[a]]=IL(m-2*i,0);v[s[o]]=r[s[o]]+CL(i,g/2);v[s[a]]=u+CL(i,x/2);u+=m;p.setLayout(v,true)}r[s[o]]+=c;r[l[o]]-=c}function FL(e,t,r,i,n){var a=(t||{}).node;var o=[i,n];if(!a||a===r){return o}var s;var l=i*n;var u=l*e.option.zoomToNodeRatio;while(s=a.parentNode){var c=0;var f=s.children;for(var h=0,p=f.length;h<p;h++){c+=f[h].getValue()}var v=a.getValue();if(v===0){return o}u*=c/v;var d=s.getModel();var g=d.get(AL);var y=Math.max(g,jL(d));u+=4*g*g+(3*g+y)*Math.pow(u,.5);u>$n&&(u=$n);a=s}u<l&&(u=l);var m=Math.pow(u/l,.5);return[i*m,n*m]}function HL(e,t,r){if(t){return{x:t.x,y:t.y}}var i={x:0,y:0};if(!r){return i}var n=r.node;var a=n.getLayout();if(!a){return i}var o=[a.width/2,a.height/2];var s=n;while(s){var l=s.getLayout();o[0]+=l.x;o[1]+=l.y;s=s.parentNode}return{x:e.width/2-o[0],y:e.height/2-o[1]}}function WL(e,t,r,i,n){var a=e.getLayout();var o=r[n];var s=o&&o===e;if(o&&!s||n===r.length&&e!==i){return}e.setLayout({isInView:true,invisible:!s&&!t.intersect(a),isAboveViewRoot:s},true);var l=new B(t.x-a.x,t.y-a.y,t.width,t.height);DL(e.viewChildren||[],function(e){WL(e,l,r,i,n+1)})}function jL(e){return e.get(kL)?e.get(PL):0}function UL(e){e.registerSeriesModel(IA);e.registerChartView(YA);e.registerVisual(gL);e.registerLayout(OL);SA(e)}function ZL(e){var o=e.findComponents({mainType:"legend"});if(!o||!o.length){return}e.eachSeriesByType("graph",function(e){var t=e.getCategoriesData();var r=e.getGraph();var n=r.data;var a=t.mapArray(t.getName);n.filterSelf(function(e){var t=n.getItemModel(e);var r=t.getShallow("category");if(r!=null){if(typeof r==="number"){r=a[r]}for(var i=0;i<o.length;i++){if(!o[i].isSelected(r)){return false}}}return true})})}function YL(e){var f={};e.eachSeriesByType("graph",function(s){var l=s.getCategoriesData();var u=s.getData();var c={};l.each(function(e){var t=l.getName(e);c["ec-"+t]=e;var r=l.getItemModel(e);var i=r.getModel("itemStyle").getItemStyle();if(!i.fill){i.fill=s.getColorFromPalette(t,f)}l.setItemVisual(e,"style",i);var n=["symbol","symbolSize","symbolKeepAspect"];for(var a=0;a<n.length;a++){var o=r.getShallow(n[a],true);if(o!=null){l.setItemVisual(e,n[a],o)}}});if(l.count()){u.each(function(e){var t=u.getItemModel(e);var r=t.getShallow("category");if(r!=null){if(typeof r==="string"){r=c["ec-"+r]}var i=l.getItemVisual(r,"style");var n=u.ensureUniqueItemVisual(e,"style");F(n,i);var a=["symbol","symbolSize","symbolKeepAspect"];for(var o=0;o<a.length;o++){u.setItemVisual(e,a[o],l.getItemVisual(r,a[o]))}}})}})}function XL(e){if(!(e instanceof Array)){e=[e,e]}return e}function qL(e){e.eachSeriesByType("graph",function(e){var l=e.getGraph();var u=e.getEdgeData();var t=XL(e.get("edgeSymbol"));var r=XL(e.get("edgeSymbolSize"));u.setVisual("fromSymbol",t&&t[0]);u.setVisual("toSymbol",t&&t[1]);u.setVisual("fromSymbolSize",r&&r[0]);u.setVisual("toSymbolSize",r&&r[1]);u.setVisual("style",e.getModel("lineStyle").getLineStyle());u.each(function(e){var t=u.getItemModel(e);var r=l.getEdgeByIndex(e);var i=XL(t.getShallow("symbol",true));var n=XL(t.getShallow("symbolSize",true));var a=t.getModel("lineStyle").getLineStyle();var o=u.ensureUniqueItemVisual(e,"style");F(o,a);switch(o.stroke){case"source":{var s=r.node1.getVisual("style");o.stroke=s&&s.fill;break}case"target":{var s=r.node2.getVisual("style");o.stroke=s&&s.fill;break}}i[0]&&r.setVisual("fromSymbol",i[0]);i[1]&&r.setVisual("toSymbol",i[1]);n[0]&&r.setVisual("fromSymbolSize",n[0]);n[1]&&r.setVisual("toSymbolSize",n[1])})})}var JL="--\x3e";var KL=function(e){return e.get("autoCurveness")||null};var QL=function(e,t){var r=KL(e);var i=20;var n=[];if(typeof r==="number"){i=r}else if(k(r)){e.__curvenessList=r;return}if(t>i){i=t}var a=i%2?i+2:i+3;n=[];for(var o=0;o<a;o++){n.push((o%2?o+1:o)/10*(o%2?-1:1))}e.__curvenessList=n};var $L=function(e,t,r){var i=[e.id,e.dataIndex].join(".");var n=[t.id,t.dataIndex].join(".");return[r.uid,i,n].join(JL)};var ek=function(e){var t=e.split(JL);return[t[0],t[2],t[1]].join(JL)};var tk=function(e,t){var r=$L(e.node1,e.node2,t);return t.__edgeMap[r]};var rk=function(e,t){var r=ik($L(e.node1,e.node2,t),t);var i=ik($L(e.node2,e.node1,t),t);return r+i};var ik=function(e,t){var r=t.__edgeMap;return r[e]?r[e].length:0};function nk(e){if(!KL(e)){return}e.__curvenessList=[];e.__edgeMap={};QL(e)}function ak(e,t,r,i){if(!KL(r)){return}var n=$L(e,t,r);var a=r.__edgeMap;var o=a[ek(n)];if(a[n]&&!o){a[n].isForward=true}else if(o&&a[n]){o.isForward=true;a[n].isForward=false}a[n]=a[n]||[];a[n].push(i)}function ok(e,t,r,i){var n=KL(t);var a=k(n);if(!n){return null}var o=tk(e,t);if(!o){return null}var s=-1;for(var l=0;l<o.length;l++){if(o[l]===r){s=l;break}}var u=rk(e,t);QL(t,u);e.lineStyle=e.lineStyle||{};var c=$L(e.node1,e.node2,t);var f=t.__curvenessList;var h=a?0:u%2?0:1;if(!o.isForward){var p=ek(c);var v=ik(p,t);var d=f[s+v+h];if(i){if(a){if(n&&n[0]===0){return(v+h)%2?d:-d}else{return((v%2?0:1)+h)%2?d:-d}}else{return(v+h)%2?d:-d}}else{return f[s+v+h]}}else{return f[h+s]}}function sk(e){var t=e.coordinateSystem;if(t&&t.type!=="view"){return}var r=e.getGraph();r.eachNode(function(e){var t=e.getModel();e.setLayout([+t.get("x"),+t.get("y")])});lk(r,e)}function lk(e,o){e.eachEdge(function(e,t){var r=we(e.getModel().get(["lineStyle","curveness"]),-ok(e,o,t,true),0);var i=Re(e.node1.getLayout());var n=Re(e.node2.getLayout());var a=[i,n];if(+r){a.push([(i[0]+n[0])/2-(i[1]-n[1])*r,(i[1]+n[1])/2-(n[0]-i[0])*r])}e.setLayout(a)})}function uk(e,t){e.eachSeriesByType("graph",function(e){var t=e.get("layout");var r=e.coordinateSystem;if(r&&r.type!=="view"){var i=e.getData();var n=[];U(r.dimensions,function(e){n=n.concat(i.mapDimensionsAll(e))});for(var a=0;a<i.count();a++){var o=[];var s=false;for(var l=0;l<n.length;l++){var u=i.get(n[l],a);if(!isNaN(u)){s=true}o.push(u)}if(s){i.setItemLayout(a,r.dataToPoint(o))}else{i.setItemLayout(a,[NaN,NaN])}}lk(i.graph,e)}else if(!t||t==="none"){sk(e)}})}function ck(e){var t=e.coordinateSystem;if(t.type!=="view"){return 1}var r=e.option.nodeScaleRatio;var i=t.scaleX;var n=t.getZoom();var a=(n-1)*r+1;return a/i}function fk(e){var t=e.getVisual("symbolSize");if(t instanceof Array){t=(t[0]+t[1])/2}return+t}var hk=Math.PI;var pk=[];function vk(l,e){var t=l.coordinateSystem;if(t&&t.type!=="view"){return}var r=t.getBoundingRect();var i=l.getData();var n=i.graph;var u=r.width/2+r.x;var c=r.height/2+r.y;var a=Math.min(r.width,r.height)/2;var o=i.count();i.setLayout({cx:u,cy:c});if(!o){return}dk[e](l,n,i,a,u,c,o);n.eachEdge(function(e,t){var r=we(e.getModel().get(["lineStyle","curveness"]),ok(e,l,t),0);var i=Re(e.node1.getLayout());var n=Re(e.node2.getLayout());var a;var o=(i[0]+n[0])/2;var s=(i[1]+n[1])/2;if(+r){r*=3;a=[u*r+o*(1-r),c*r+s*(1-r)]}e.setLayout([i,n,a])})}var dk={value:function(e,t,r,i,n,a,o){var s=0;var l=r.getSum("value");var u=Math.PI*2/(l||o);t.eachNode(function(e){var t=e.getValue("value");var r=u*(l?t:1)/2;s+=r;e.setLayout([i*Math.cos(s)+n,i*Math.sin(s)+a]);s+=r})},symbolSize:function(e,t,r,i,n,a,o){var s=0;pk.length=o;var l=ck(e);t.eachNode(function(e){var t=fk(e);isNaN(t)&&(t=2);t<0&&(t=0);t*=l;var r=Math.asin(t/2/i);isNaN(r)&&(r=hk/2);pk[e.dataIndex]=r;s+=r*2});var u=(2*hk-s)/o/2;var c=0;t.eachNode(function(e){var t=u+pk[e.dataIndex];c+=t;e.setLayout([i*Math.cos(c)+n,i*Math.sin(c)+a]);c+=t})}};function gk(e){e.eachSeriesByType("graph",function(e){if(e.get("layout")==="circular"){vk(e,"symbolSize")}})}var yk=Ve;function mk(e,t,r){var v=e;var d=t;var i=r.rect;var n=i.width;var a=i.height;var g=[i.x+n/2,i.y+a/2];var y=r.gravity==null?.1:r.gravity;for(var o=0;o<v.length;o++){var s=v[o];if(!s.p){s.p=Ne(n*(Math.random()-.5)+g[0],a*(Math.random()-.5)+g[1])}s.pp=Re(s.p);s.edges=null}var l=r.friction==null?.6:r.friction;var m=l;var x;var _;return{warmUp:function(){m=l*.8},setFixed:function(e){v[e].fixed=true},setUnfixed:function(e){v[e].fixed=false},beforeStep:function(e){x=e},afterStep:function(e){_=e},step:function(e){x&&x(v,d);var t=[];var r=v.length;for(var i=0;i<d.length;i++){var n=d[i];if(n.ignoreForceLayout){continue}var a=n.n1;var o=n.n2;Ge(t,o.p,a.p);var s=Fe(t)-n.d;var l=o.w/(a.w+o.w);if(isNaN(l)){l=0}qe(t,t);!a.fixed&&yk(a.p,a.p,t,l*s*m);!o.fixed&&yk(o.p,o.p,t,-(1-l)*s*m)}for(var i=0;i<r;i++){var u=v[i];if(!u.fixed){Ge(t,g,u.p);yk(u.p,u.p,t,y*m)}}for(var i=0;i<r;i++){var a=v[i];for(var c=i+1;c<r;c++){var o=v[c];Ge(t,o.p,a.p);var s=Fe(t);if(s===0){ze(t,Math.random()-.5,Math.random()-.5);s=1}var f=(a.rep+o.rep)/s/s;!a.fixed&&yk(a.pp,a.pp,t,f);!o.fixed&&yk(o.pp,o.pp,t,-f)}}var h=[];for(var i=0;i<r;i++){var u=v[i];if(!u.fixed){Ge(h,u.p,u.pp);yk(u.p,u.p,h,m);Ee(u.pp,u.p)}}m=m*.992;var p=m<.01;_&&_(v,d,p);e&&e(p)}}}function xk(e){e.eachSeriesByType("graph",function(o){var e=o.coordinateSystem;if(e&&e.type!=="view"){return}if(o.get("layout")==="force"){var c=o.preservedPoints||{};var f=o.getGraph();var h=f.data;var t=f.edgeData;var r=o.getModel("force");var i=r.get("initLayout");if(o.preservedPoints){h.each(function(e){var t=h.getId(e);h.setItemLayout(e,c[t]||[NaN,NaN])})}else if(!i||i==="none"){sk(o)}else if(i==="circular"){vk(o,"value")}var n=h.getDataExtent("value");var s=t.getDataExtent("value");var a=r.get("repulsion");var l=r.get("edgeLength");var u=k(a)?a:[a,a];var p=k(l)?l:[l,l];p=[p[1],p[0]];var v=h.mapArray("value",function(e,t){var r=h.getItemLayout(t);var i=V(e,n,u);if(isNaN(i)){i=(u[0]+u[1])/2}return{w:i,rep:i,fixed:h.getItemModel(t).get("fixed"),p:!r||isNaN(r[0])||isNaN(r[1])?null:r}});var d=t.mapArray("value",function(e,t){var r=f.getEdgeByIndex(t);var i=V(e,s,p);if(isNaN(i)){i=(p[0]+p[1])/2}var n=r.getModel();var a=we(r.getModel().get(["lineStyle","curveness"]),-ok(r,o,t,true),0);return{n1:v[r.node1.dataIndex],n2:v[r.node2.dataIndex],d:i,curveness:a,ignoreForceLayout:n.get("ignoreForceLayout")}});var g=e.getBoundingRect();var y=mk(v,d,{rect:g,gravity:r.get("gravity"),friction:r.get("friction")});y.beforeStep(function(e,t){for(var r=0,i=e.length;r<i;r++){if(e[r].fixed){Ee(e[r].p,f.getNodeByIndex(r).getLayout())}}});y.afterStep(function(e,t,r){for(var i=0,n=e.length;i<n;i++){if(!e[i].fixed){f.getNodeByIndex(i).setLayout(e[i].p)}c[h.getId(i)]=e[i].p}for(var i=0,n=t.length;i<n;i++){var a=t[i];var o=f.getEdgeByIndex(i);var s=a.n1.p;var l=a.n2.p;var u=o.getLayout();u=u?u.slice():[];u[0]=u[0]||[];u[1]=u[1]||[];Ee(u[0],s);Ee(u[1],l);if(+a.curveness){u[2]=[(s[0]+l[0])/2-(s[1]-l[1])*a.curveness,(s[1]+l[1])/2-(l[0]-s[0])*a.curveness]}o.setLayout(u)}});o.forceLayout=y;o.preservedPoints=c;y.step()}else{o.forceLayout=null}})}function _k(e,t,r){var i=F(e.getBoxLayoutParams(),{aspect:r});return sv(i,{width:t.getWidth(),height:t.getHeight()})}function bk(e,p){var v=[];e.eachSeriesByType("graph",function(e){var t=e.get("coordinateSystem");if(!t||t==="view"){var r=e.getData();var i=r.mapArray(function(e){var t=r.getItemModel(e);return[+t.get("x"),+t.get("y")]});var n=[];var a=[];Ns(i,n,a);if(a[0]-n[0]===0){a[0]+=1;n[0]-=1}if(a[1]-n[1]===0){a[1]+=1;n[1]-=1}var o=(a[0]-n[0])/(a[1]-n[1]);var s=_k(e,p,o);if(isNaN(o)){n=[s.x,s.y];a=[s.x+s.width,s.y+s.height]}var l=a[0]-n[0];var u=a[1]-n[1];var c=s.width;var f=s.height;var h=e.coordinateSystem=new dD;h.zoomLimit=e.get("scaleLimit");h.setBoundingRect(n[0],n[1],l,u);h.setViewRect(s.x,s.y,c,f);h.setCenter(e.get("center"));h.setZoom(e.get("zoom"));v.push(h)}});return v}var wk=vf.prototype;var Sk=mf.prototype;var Mk=function(){function e(){this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.percent=1}return e}();var Ik=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Mk);function Ck(e){return isNaN(+e.cpx1)||isNaN(+e.cpy1)}var Tk=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="ec-line";return t}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new Mk};e.prototype.buildPath=function(e,t){if(Ck(t)){wk.buildPath.call(this,e,t)}else{Sk.buildPath.call(this,e,t)}};e.prototype.pointAt=function(e){if(Ck(this.shape)){return wk.pointAt.call(this,e)}else{return Sk.pointAt.call(this,e)}};e.prototype.tangentAt=function(e){var t=this.shape;var r=Ck(t)?[t.x2-t.x1,t.y2-t.y1]:Sk.tangentAt.call(this,e);return qe(r,r)};return e}(m);var Dk=["fromSymbol","toSymbol"];function Ak(e){return"_"+e+"Type"}function Lk(e,t,r){var i=t.getItemVisual(r,e);if(!i||i==="none"){return}var n=t.getItemVisual(r,e+"Size");var a=t.getItemVisual(r,e+"Rotate");var o=t.getItemVisual(r,e+"Offset")||0;var s=t.getItemVisual(r,e+"KeepAspect");var l=k(n)?n:[n,n];var u=k(o)?o:[o,o];u[0]=Y(u[0],l[0]);u[1]=Y(N(u[1],u[0]),l[1]);var c=S0(i,-l[0]/2+u[0],-l[1]/2+u[1],l[0],l[1],null,s);c.__specifiedRotation=a==null||isNaN(a)?void 0:+a*Math.PI/180||0;c.name=e;return c}function kk(e){var t=new Tk({name:"line",subPixelOptimize:true});Pk(t.shape,e);return t}function Pk(e,t){e.x1=t[0][0];e.y1=t[0][1];e.x2=t[1][0];e.y2=t[1][1];e.percent=1;var r=t[2];if(r){e.cpx1=r[0];e.cpy1=r[1]}else{e.cpx1=NaN;e.cpy1=NaN}}var Ok=function(n){d(e,n);function e(e,t,r){var i=n.call(this)||this;i._createLine(e,t,r);return i}e.prototype._createLine=function(r,i,e){var t=r.hostModel;var n=r.getItemLayout(i);var a=kk(n);a.shape.percent=0;qf(a,{shape:{percent:1}},t,i);this.add(a);U(Dk,function(e){var t=Lk(e,r,i);this.add(t);this[Ak(e)]=r.getItemVisual(i,e)},this);this._updateCommonStl(r,i,e)};e.prototype.updateData=function(n,a,e){var t=n.hostModel;var r=this.childOfName("line");var i=n.getItemLayout(a);var o={shape:{}};Pk(o.shape,i);X(r,o,t,a);U(Dk,function(e){var t=n.getItemVisual(a,e);var r=Ak(e);if(this[r]!==t){this.remove(this.childOfName(e));var i=Lk(e,n,a);this.add(i)}this[r]=t},this);this._updateCommonStl(n,a,e)};e.prototype.getLinePath=function(){return this.childAt(0)};e.prototype._updateCommonStl=function(r,e,t){var i=r.hostModel;var l=this.childOfName("line");var n=t&&t.emphasisLineStyle;var a=t&&t.blurLineStyle;var o=t&&t.selectLineStyle;var s=t&&t.labelStatesModels;if(!t||r.hasItemOption){var u=r.getItemModel(e);n=u.getModel(["emphasis","lineStyle"]).getLineStyle();a=u.getModel(["blur","lineStyle"]).getLineStyle();o=u.getModel(["select","lineStyle"]).getLineStyle();s=xh(u)}var c=r.getItemVisual(e,"style");var f=c.stroke;l.useStyle(c);l.style.fill=null;l.style.strokeNoScale=true;l.ensureState("emphasis").style=n;l.ensureState("blur").style=a;l.ensureState("select").style=o;U(Dk,function(e){var t=this.childOfName(e);if(t){t.setColor(f);t.style.opacity=c.opacity;for(var r=0;r<lu.length;r++){var i=lu[r];var n=l.getState(i);if(n){var a=n.style||{};var o=t.ensureState(i);var s=o.style||(o.style={});if(a.stroke!=null){s[t.__isEmptyBrush?"stroke":"fill"]=a.stroke}if(a.opacity!=null){s.opacity=a.opacity}}}t.markRedraw()}},this);var h=i.getRawValue(e);mh(this,s,{labelDataIndex:e,labelFetcher:{getFormattedLabel:function(e,t){return i.getFormattedLabel(e,t,r.dataType)}},inheritColor:f||"#000",defaultOpacity:c.opacity,defaultText:(h==null?r.getName(e):isFinite(h)?Zn(h):h)+""});var p=this.getTextContent();if(p){var v=s.normal;p.__align=p.style.align;p.__verticalAlign=p.style.verticalAlign;p.__position=v.get("position")||"middle";var d=v.get("distance");if(!k(d)){d=[d,d]}p.__labelDistance=d}this.setTextConfig({position:null,local:true,inside:false});tc(this)};e.prototype.highlight=function(){Bu(this)};e.prototype.downplay=function(){Vu(this)};e.prototype.updateLayout=function(e,t){this.setLinePoints(e.getItemLayout(t))};e.prototype.setLinePoints=function(e){var t=this.childOfName("line");Pk(t.shape,e);t.dirty()};e.prototype.beforeUpdate=function(){var e=this;var t=e.childOfName("fromSymbol");var r=e.childOfName("toSymbol");var i=e.getTextContent();if(!t&&!r&&(!i||i.ignore)){return}var n=1;var a=this.parent;while(a){if(a.scaleX){n/=a.scaleX}a=a.parent}var o=e.childOfName("line");if(!this.__dirty&&!o.__dirty){return}var s=o.shape.percent;var l=o.pointAt(0);var u=o.pointAt(s);var c=Ge([],u,l);qe(c,c);function f(e,t){var r=e.__specifiedRotation;if(r==null){var i=o.tangentAt(t);e.attr("rotation",(t===1?-1:1)*Math.PI/2-Math.atan2(i[1],i[0]))}else{e.attr("rotation",r)}}if(t){t.setPosition(l);f(t,0);t.scaleX=t.scaleY=n*s;t.markRedraw()}if(r){r.setPosition(u);f(r,1);r.scaleX=r.scaleY=n*s;r.markRedraw()}if(i&&!i.ignore){i.x=i.y=0;i.originX=i.originY=0;var h=void 0;var p=void 0;var v=i.__labelDistance;var d=v[0]*n;var g=v[1]*n;var y=s/2;var m=o.tangentAt(y);var x=[m[1],-m[0]];var _=o.pointAt(y);if(x[1]>0){x[0]=-x[0];x[1]=-x[1]}var b=m[0]<0?-1:1;if(i.__position!=="start"&&i.__position!=="end"){var w=-Math.atan2(m[1],m[0]);if(u[0]<l[0]){w=Math.PI+w}i.rotation=w}var S=void 0;switch(i.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":S=-g;p="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":S=g;p="top";break;default:S=0;p="middle"}switch(i.__position){case"end":i.x=c[0]*d+u[0];i.y=c[1]*g+u[1];h=c[0]>.8?"left":c[0]<-.8?"right":"center";p=c[1]>.8?"top":c[1]<-.8?"bottom":"middle";break;case"start":i.x=-c[0]*d+l[0];i.y=-c[1]*g+l[1];h=c[0]>.8?"right":c[0]<-.8?"left":"center";p=c[1]>.8?"bottom":c[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":i.x=d*b+l[0];i.y=l[1]+S;h=m[0]<0?"right":"left";i.originX=-d*b;i.originY=-S;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":i.x=_[0];i.y=_[1]+S;h="center";i.originY=-S;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":i.x=-d*b+u[0];i.y=u[1]+S;h=m[0]>=0?"right":"left";i.originX=d*b;i.originY=-S;break}i.scaleX=i.scaleY=n;i.setStyle({verticalAlign:i.__verticalAlign||p,align:i.__align||h})}};return e}(H);var Nk=function(){function e(e){this.group=new H;this._LineCtor=e||Ok}e.prototype.isPersistent=function(){return true};e.prototype.updateData=function(r){var i=this;var e=this;var t=e.group;var n=e._lineData;e._lineData=r;if(!n){t.removeAll()}var a=Rk(r);r.diff(n).add(function(e){i._doAdd(r,e,a)}).update(function(e,t){i._doUpdate(n,r,t,e,a)}).remove(function(e){t.remove(n.getItemGraphicEl(e))}).execute()};e.prototype.updateLayout=function(){var r=this._lineData;if(!r){return}r.eachItemGraphicEl(function(e,t){e.updateLayout(r,t)},this)};e.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=Rk(e);this._lineData=null;this.group.removeAll()};e.prototype.incrementalUpdate=function(e,t){function r(e){if(!e.isGroup&&!Ek(e)){e.incremental=true;e.ensureState("emphasis").hoverLayer=true}}for(var i=e.start;i<e.end;i++){var n=t.getItemLayout(i);if(Bk(n)){var a=new this._LineCtor(t,i,this._seriesScope);a.traverse(r);this.group.add(a);t.setItemGraphicEl(i,a)}}};e.prototype.remove=function(){this.group.removeAll()};e.prototype._doAdd=function(e,t,r){var i=e.getItemLayout(t);if(!Bk(i)){return}var n=new this._LineCtor(e,t,r);e.setItemGraphicEl(t,n);this.group.add(n)};e.prototype._doUpdate=function(e,t,r,i,n){var a=e.getItemGraphicEl(r);if(!Bk(t.getItemLayout(i))){this.group.remove(a);return}if(!a){a=new this._LineCtor(t,i,n)}else{a.updateData(t,i,n)}t.setItemGraphicEl(i,a);this.group.add(a)};return e}();function Ek(e){return e.animators&&e.animators.length>0}function Rk(e){var t=e.hostModel;return{lineStyle:t.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["emphasis","lineStyle"]).getLineStyle(),blurLineStyle:t.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:t.getModel(["select","lineStyle"]).getLineStyle(),labelStatesModels:xh(t)}}function zk(e){return isNaN(e[0])||isNaN(e[1])}function Bk(e){return!zk(e[0])&&!zk(e[1])}var Vk=[];var Gk=[];var Fk=[];var Hk=xs;var Wk=$e;var jk=Math.abs;function Uk(e,t,r){var i=e[0];var n=e[1];var a=e[2];var o=Infinity;var s;var l=r*r;var u=.1;for(var c=.1;c<=.9;c+=.1){Vk[0]=Hk(i[0],n[0],a[0],c);Vk[1]=Hk(i[1],n[1],a[1],c);var f=jk(Wk(Vk,t)-l);if(f<o){o=f;s=c}}for(var h=0;h<32;h++){var p=s+u;Gk[0]=Hk(i[0],n[0],a[0],s);Gk[1]=Hk(i[1],n[1],a[1],s);Fk[0]=Hk(i[0],n[0],a[0],p);Fk[1]=Hk(i[1],n[1],a[1],p);var f=Wk(Gk,t)-l;if(jk(f)<.01){break}var v=Wk(Fk,t)-l;u/=2;if(f<0){if(v>=0){s=s+u}else{s=s-u}}else{if(v>=0){s=s-u}else{s=s+u}}}return s}function Zk(e,l){var u=[];var c=Ss;var f=[[],[],[]];var h=[[],[]];var p=[];l/=2;e.eachEdge(function(e,t){var r=e.getLayout();var i=e.getVisual("fromSymbol");var n=e.getVisual("toSymbol");if(!r.__original){r.__original=[Re(r[0]),Re(r[1])];if(r[2]){r.__original.push(Re(r[2]))}}var a=r.__original;if(r[2]!=null){Ee(f[0],a[0]);Ee(f[1],a[2]);Ee(f[2],a[1]);if(i&&i!=="none"){var o=fk(e.node1);var s=Uk(f,a[0],o*l);c(f[0][0],f[1][0],f[2][0],s,u);f[0][0]=u[3];f[1][0]=u[4];c(f[0][1],f[1][1],f[2][1],s,u);f[0][1]=u[3];f[1][1]=u[4]}if(n&&n!=="none"){var o=fk(e.node2);var s=Uk(f,a[1],o*l);c(f[0][0],f[1][0],f[2][0],s,u);f[1][0]=u[1];f[2][0]=u[2];c(f[0][1],f[1][1],f[2][1],s,u);f[1][1]=u[1];f[2][1]=u[2]}Ee(r[0],f[0]);Ee(r[1],f[2]);Ee(r[2],f[1])}else{Ee(h[0],a[0]);Ee(h[1],a[1]);Ge(p,h[1],h[0]);qe(p,p);if(i&&i!=="none"){var o=fk(e.node1);Ve(h[0],h[0],p,o*l)}if(n&&n!=="none"){var o=fk(e.node2);Ve(h[1],h[1],p,-o*l)}Ee(r[0],h[0]);Ee(r[1],h[1])}})}function Yk(e){return e.type==="view"}var Xk=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(e,t){var r=new LI;var i=new Nk;var n=this.group;this._controller=new WT(t.getZr());this._controllerHost={target:n};n.add(r.group);n.add(i.group);this._symbolDraw=r;this._lineDraw=i;this._firstRender=true};r.prototype.render=function(e,t,r){var o=this;var i=e.coordinateSystem;this._model=e;var n=this._symbolDraw;var a=this._lineDraw;var s=this.group;if(Yk(i)){var l={x:i.x,y:i.y,scaleX:i.scaleX,scaleY:i.scaleY};if(this._firstRender){s.attr(l)}else{X(s,l,e)}}Zk(e.getGraph(),ck(e));var c=e.getData();n.updateData(c);var u=e.getEdgeData();a.updateData(u);this._updateNodeAndLinkScale();this._updateController(e,t,r);clearTimeout(this._layoutTimeout);var f=e.forceLayout;var h=e.get(["force","layoutAnimation"]);if(f){this._startForceLayoutIteration(f,h)}c.graph.eachNode(function(e){var t=e.dataIndex;var r=e.getGraphicEl();var i=e.getModel();r.off("drag").off("dragend");var n=i.get("draggable");if(n){r.on("drag",function(){if(f){f.warmUp();!o._layouting&&o._startForceLayoutIteration(f,h);f.setFixed(t);c.setItemLayout(t,[r.x,r.y])}}).on("dragend",function(){if(f){f.setUnfixed(t)}})}r.setDraggable(n&&!!f);var a=i.get(["emphasis","focus"]);if(a==="adjacency"){j(r).focus=e.getAdjacentDataIndices()}});c.graph.eachEdge(function(e){var t=e.getGraphicEl();var r=e.getModel().get(["emphasis","focus"]);if(r==="adjacency"){j(t).focus={edge:[e.dataIndex],node:[e.node1.dataIndex,e.node2.dataIndex]}}});var p=e.get("layout")==="circular"&&e.get(["circular","rotateLabel"]);var v=c.getLayout("cx");var d=c.getLayout("cy");c.eachItemGraphicEl(function(e,t){var r=c.getItemModel(t);var i=r.get(["label","rotate"])||0;var n=e.getSymbolPath();if(p){var a=c.getItemLayout(t);var o=Math.atan2(a[1]-d,a[0]-v);if(o<0){o=Math.PI*2+o}var s=a[0]<v;if(s){o=o-Math.PI}var l=s?"left":"right";n.setTextConfig({rotation:-o,position:l,origin:"center"});var u=n.ensureState("emphasis");F(u.textConfig||(u.textConfig={}),{position:l})}else{n.setTextConfig({rotation:i*=Math.PI/180})}});this._firstRender=false};r.prototype.dispose=function(){this._controller&&this._controller.dispose();this._controllerHost=null};r.prototype._startForceLayoutIteration=function(e,r){var i=this;(function t(){e.step(function(e){i.updateLayout(i._model);(i._layouting=!e)&&(r?i._layoutTimeout=setTimeout(t,16):t())})})()};r.prototype._updateController=function(n,e,a){var t=this;var r=this._controller;var i=this._controllerHost;var o=this.group;r.setPointerChecker(function(e,t,r){var i=o.getBoundingRect();i.applyTransform(o.transform);return i.contain(t,r)&&!JT(e,a,n)});if(!Yk(n.coordinateSystem)){r.disable();return}r.enable(n.get("roam"));i.zoomLimit=n.get("scaleLimit");i.zoom=n.coordinateSystem.getZoom();r.off("pan").off("zoom").on("pan",function(e){YT(i,e.dx,e.dy);a.dispatchAction({seriesId:n.id,type:"graphRoam",dx:e.dx,dy:e.dy})}).on("zoom",function(e){XT(i,e.scale,e.originX,e.originY);a.dispatchAction({seriesId:n.id,type:"graphRoam",zoom:e.scale,originX:e.originX,originY:e.originY});t._updateNodeAndLinkScale();Zk(n.getGraph(),ck(n));t._lineDraw.updateLayout();a.updateLabelLayout()})};r.prototype._updateNodeAndLinkScale=function(){var e=this._model;var t=e.getData();var r=ck(e);t.eachItemGraphicEl(function(e,t){e.setSymbolScale(r)})};r.prototype.updateLayout=function(e){Zk(e.getGraph(),ck(e));this._symbolDraw.updateLayout();this._lineDraw.updateLayout()};r.prototype.remove=function(e,t){this._symbolDraw&&this._symbolDraw.remove();this._lineDraw&&this._lineDraw.remove()};r.type="graph";return r}(v);function qk(e){return"_EC_"+e}var Jk=function(){function a(e){this.type="graph";this.nodes=[];this.edges=[];this._nodesMap={};this._edgesMap={};this._directed=e||false}a.prototype.isDirected=function(){return this._directed};a.prototype.addNode=function(e,t){e=e==null?""+t:""+e;var r=this._nodesMap;if(r[qk(e)]){if("development"!=="production"){console.error("Graph nodes have duplicate name or id")}return}var i=new Kk(e,t);i.hostGraph=this;this.nodes.push(i);r[qk(e)]=i;return i};a.prototype.getNodeByIndex=function(e){var t=this.data.getRawIndex(e);return this.nodes[t]};a.prototype.getNodeById=function(e){return this._nodesMap[qk(e)]};a.prototype.addEdge=function(e,t,r){var i=this._nodesMap;var n=this._edgesMap;if(typeof e==="number"){e=this.nodes[e]}if(typeof t==="number"){t=this.nodes[t]}if(!(e instanceof Kk)){e=i[qk(e)]}if(!(t instanceof Kk)){t=i[qk(t)]}if(!e||!t){return}var a=e.id+"-"+t.id;var o=new Qk(e,t,r);o.hostGraph=this;if(this._directed){e.outEdges.push(o);t.inEdges.push(o)}e.edges.push(o);if(e!==t){t.edges.push(o)}this.edges.push(o);n[a]=o;return o};a.prototype.getEdgeByIndex=function(e){var t=this.edgeData.getRawIndex(e);return this.edges[t]};a.prototype.getEdge=function(e,t){if(e instanceof Kk){e=e.id}if(t instanceof Kk){t=t.id}var r=this._edgesMap;if(this._directed){return r[e+"-"+t]}else{return r[e+"-"+t]||r[t+"-"+e]}};a.prototype.eachNode=function(e,t){var r=this.nodes;var i=r.length;for(var n=0;n<i;n++){if(r[n].dataIndex>=0){e.call(t,r[n],n)}}};a.prototype.eachEdge=function(e,t){var r=this.edges;var i=r.length;for(var n=0;n<i;n++){if(r[n].dataIndex>=0&&r[n].node1.dataIndex>=0&&r[n].node2.dataIndex>=0){e.call(t,r[n],n)}}};a.prototype.breadthFirstTraverse=function(e,t,r,i){if(!(t instanceof Kk)){t=this._nodesMap[qk(t)]}if(!t){return}var n=r==="out"?"outEdges":r==="in"?"inEdges":"edges";for(var a=0;a<this.nodes.length;a++){this.nodes[a].__visited=false}if(e.call(i,t,null)){return}var o=[t];while(o.length){var s=o.shift();var l=s[n];for(var a=0;a<l.length;a++){var u=l[a];var c=u.node1===s?u.node2:u.node1;if(!c.__visited){if(e.call(i,c,s)){return}o.push(c);c.__visited=true}}}};a.prototype.update=function(){var e=this.data;var r=this.edgeData;var t=this.nodes;var i=this.edges;for(var n=0,a=t.length;n<a;n++){t[n].dataIndex=-1}for(var n=0,a=e.count();n<a;n++){t[e.getRawIndex(n)].dataIndex=n}r.filterSelf(function(e){var t=i[r.getRawIndex(e)];return t.node1.dataIndex>=0&&t.node2.dataIndex>=0});for(var n=0,a=i.length;n<a;n++){i[n].dataIndex=-1}for(var n=0,a=r.count();n<a;n++){i[r.getRawIndex(n)].dataIndex=n}};a.prototype.clone=function(){var e=new a(this._directed);var t=this.nodes;var r=this.edges;for(var i=0;i<t.length;i++){e.addNode(t[i].id,t[i].dataIndex)}for(var i=0;i<r.length;i++){var n=r[i];e.addEdge(n.node1.id,n.node2.id,n.dataIndex)}return e};return a}();var Kk=function(){function e(e,t){this.inEdges=[];this.outEdges=[];this.edges=[];this.dataIndex=-1;this.id=e==null?"":e;this.dataIndex=t==null?-1:t}e.prototype.degree=function(){return this.edges.length};e.prototype.inDegree=function(){return this.inEdges.length};e.prototype.outDegree=function(){return this.outEdges.length};e.prototype.getModel=function(e){if(this.dataIndex<0){return}var t=this.hostGraph;var r=t.data.getItemModel(this.dataIndex);return r.getModel(e)};e.prototype.getAdjacentDataIndices=function(){var e={edge:[],node:[]};for(var t=0;t<this.edges.length;t++){var r=this.edges[t];if(r.dataIndex<0){continue}e.edge.push(r.dataIndex);e.node.push(r.node1.dataIndex,r.node2.dataIndex)}return e};return e}();var Qk=function(){function e(e,t,r){this.dataIndex=-1;this.node1=e;this.node2=t;this.dataIndex=r==null?-1:r}e.prototype.getModel=function(e){if(this.dataIndex<0){return}var t=this.hostGraph;var r=t.edgeData.getItemModel(this.dataIndex);return r.getModel(e)};e.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}};return e}();function $k(r,i){return{getValue:function(e){var t=this[r][i];return t.get(t.getDimension(e||"value"),this.dataIndex)},setVisual:function(e,t){this.dataIndex>=0&&this[r][i].setItemVisual(this.dataIndex,e,t)},getVisual:function(e){return this[r][i].getItemVisual(this.dataIndex,e)},setLayout:function(e,t){this.dataIndex>=0&&this[r][i].setItemLayout(this.dataIndex,e,t)},getLayout:function(){return this[r][i].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[r][i].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[r][i].getRawIndex(this.dataIndex)}}}oe(Kk,$k("hostGraph","data"));oe(Qk,$k("hostGraph","edgeData"));function eP(e,t,r,i,n){var a=new Jk(i);for(var o=0;o<e.length;o++){a.addNode(be(e[o].id,e[o].name,o),o)}var s=[];var l=[];var u=0;for(var o=0;o<t.length;o++){var c=t[o];var f=c.source;var h=c.target;if(a.addEdge(f,h,u)){l.push(c);s.push(be(Va(c.id,null),f+" > "+h));u++}}var p=r.get("coordinateSystem");var v;if(p==="cartesian2d"||p==="polar"){v=sw(e,r)}else{var d=fd.get(p);var g=d?d.dimensions||[]:[];if(D(g,"value")<0){g.concat(["value"])}var y=$b(e,{coordDimensions:g});v=new qb(y,r);v.initData(e)}var m=new qb(["value"],r);m.initData(l,s);n&&n(v,m);KD({mainData:v,struct:a,structAttr:"graph",datas:{node:v,edge:m},datasAttr:{node:"data",edge:"edgeData"}});a.update();return a}var tP=function(i){d(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;e.type=t.type;e.hasSymbolVisual=true;return e}t.prototype.init=function(e){i.prototype.init.apply(this,arguments);var t=this;function r(){return t._categoriesData}this.legendVisualProvider=new a2(r,r);this.fillDataTextStyle(e.edges||e.links);this._updateCategoriesData()};t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments);this.fillDataTextStyle(e.edges||e.links);this._updateCategoriesData()};t.prototype.mergeDefaultAndTheme=function(e){i.prototype.mergeDefaultAndTheme.apply(this,arguments);Ca(e,"edgeLabel",["show"])};t.prototype.getInitialData=function(e,t){var r=e.edges||e.links||[];var i=e.data||e.nodes||[];var a=this;if(i&&r){nk(this);var n=eP(i,r,this,true,o);U(n.edges,function(e){ak(e.node1,e.node2,this,e.dataIndex)},this);return n.data}function o(e,t){e.wrapMethod("getItemModel",function(e){var t=a._categoriesModels;var r=e.getShallow("category");var i=t[r];if(i){i.parentModel=e.parentModel;e.parentModel=i}return e});var i=C.prototype.getModel;function r(e,t){var r=i.call(this,e,t);r.resolveParentPath=n;return r}t.wrapMethod("getItemModel",function(e){e.resolveParentPath=n;e.getModel=r;return e});function n(e){if(e&&(e[0]==="label"||e[1]==="label")){var t=e.slice();if(e[0]==="label"){t[0]="edgeLabel"}else if(e[1]==="label"){t[1]="edgeLabel"}return t}return e}}};t.prototype.getGraph=function(){return this.getData().graph};t.prototype.getEdgeData=function(){return this.getGraph().edgeData};t.prototype.getCategoriesData=function(){return this._categoriesData};t.prototype.formatTooltip=function(e,t,r){if(r==="edge"){var i=this.getData();var n=this.getDataParams(e,r);var a=i.graph.getEdgeByIndex(e);var o=i.getName(a.node1.dataIndex);var s=i.getName(a.node2.dataIndex);var l=[];o!=null&&l.push(o);s!=null&&l.push(s);return Kg("nameValue",{name:l.join(" > "),value:n.value,noValue:n.value==null})}var u=fy({series:this,dataIndex:e,multipleSeries:t});return u};t.prototype._updateCategoriesData=function(){var e=A(this.option.categories||[],function(e){return e.value!=null?e:F({value:0},e)});var t=new qb(["value"],this);t.initData(e);this._categoriesData=t;this._categoriesModels=t.mapArray(function(e){return t.getItemModel(e)})};t.prototype.setZoom=function(e){this.option.zoom=e};t.prototype.setCenter=function(e){this.option.center=e};t.prototype.isAnimationEnabled=function(){return i.prototype.isAnimationEnabled.call(this)&&!(this.get("layout")==="force"&&this.get(["force","layoutAnimation"]))};t.type="series.graph";t.dependencies=["grid","polar","geo","singleAxis","calendar"];t.defaultOption={zlevel:0,z:2,coordinateSystem:"view",legendHoverLink:true,layout:null,circular:{rotateLabel:false},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:true},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:false,roam:false,center:null,zoom:1,nodeScaleRatio:.6,label:{show:false,formatter:"{b}"},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{scale:true,label:{show:true}},select:{itemStyle:{borderColor:"#212121"}}};return t}(dy);var rP={type:"graphRoam",event:"graphRoam",update:"none"};function iP(e){e.registerChartView(Xk);e.registerSeriesModel(tP);e.registerProcessor(ZL);e.registerVisual(YL);e.registerVisual(qL);e.registerLayout(uk);e.registerLayout(e.PRIORITY.VISUAL.POST_CHART_LAYOUT,gk);e.registerLayout(xk);e.registerCoordinateSystem("graphView",{dimensions:dD.dimensions,create:bk});e.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},function(){});e.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},function(){});e.registerAction(rP,function(i,e){e.eachComponent({mainType:"series",query:i},function(e){var t=e.coordinateSystem;var r=ID(t,i);e.setCenter&&e.setCenter(r.center);e.setZoom&&e.setZoom(r.zoom)})})}var nP=function(){function e(){this.angle=0;this.width=10;this.r=10;this.x=0;this.y=0}return e}();var aP=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="pointer";return t}e.prototype.getDefaultShape=function(){return new nP};e.prototype.buildPath=function(e,t){var r=Math.cos;var i=Math.sin;var n=t.r;var a=t.width;var o=t.angle;var s=t.x-r(o)*a*(a>=n/3?1:2);var l=t.y-i(o)*a*(a>=n/3?1:2);o=t.angle-Math.PI/2;e.moveTo(s,l);e.lineTo(t.x+r(o)*a,t.y+i(o)*a);e.lineTo(t.x+r(t.angle)*n,t.y+i(t.angle)*n);e.lineTo(t.x-r(o)*a,t.y-i(o)*a);e.lineTo(s,l)};return e}(m);function oP(e,t){var r=e.get("center");var i=t.getWidth();var n=t.getHeight();var a=Math.min(i,n);var o=Y(r[0],t.getWidth());var s=Y(r[1],t.getHeight());var l=Y(e.get("radius"),a/2);return{cx:o,cy:s,r:l}}function sP(e,t){var r=e==null?"":e+"";if(t){if(typeof t==="string"){r=t.replace("{value}",r)}else if(typeof t==="function"){r=t(e)}}return r}var lP=Math.PI*2;var uP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){this.group.removeAll();var i=e.get(["axisLine","lineStyle","color"]);var n=oP(e,r);this._renderMain(e,t,r,i,n);this._data=e.getData()};r.prototype.dispose=function(){};r.prototype._renderMain=function(e,t,r,i,n){var a=this.group;var o=e.get("clockwise");var s=-e.get("startAngle")/180*Math.PI;var l=-e.get("endAngle")/180*Math.PI;var u=e.getModel("axisLine");var c=u.get("roundCap");var f=c?bC:ef;var h=u.get("show");var p=u.getModel("lineStyle");var v=p.get("width");var d=!((l-s)%lP)&&l!==s?lP:(l-s)%lP;var g=s;for(var y=0;h&&y<i.length;y++){var m=Math.min(Math.max(i[y][0],0),1);l=s+d*m;var x=new f({shape:{startAngle:g,endAngle:l,cx:n.cx,cy:n.cy,clockwise:o,r0:n.r-v,r:n.r},silent:true});x.setStyle({fill:i[y][1]});x.setStyle(p.getLineStyle(["color","width"]));a.add(x);g=l}var _=function(e){if(e<=0){return i[0][1]}var t;for(t=0;t<i.length;t++){if(i[t][0]>=e&&(t===0?0:i[t-1][0])<e){return i[t][1]}}return i[t-1][1]};if(!o){var b=s;s=l;l=b}this._renderTicks(e,t,r,_,n,s,l,o,v);this._renderTitleAndDetail(e,t,r,_,n);this._renderAnchor(e,n);this._renderPointer(e,t,r,_,n,s,l,o,v)};r.prototype._renderTicks=function(e,t,E,r,i,n,a,R,o){var s=this.group;var l=i.cx;var u=i.cy;var c=i.r;var f=+e.get("min");var h=+e.get("max");var p=e.getModel("splitLine");var v=e.getModel("axisTick");var d=e.getModel("axisLabel");var g=e.get("splitNumber");var y=v.get("splitNumber");var m=Y(p.get("length"),c);var x=Y(v.get("length"),c);var _=n;var b=(a-n)/g;var w=b/y;var S=p.getModel("lineStyle").getLineStyle();var M=v.getModel("lineStyle").getLineStyle();var I=p.get("distance");var C;var T;for(var D=0;D<=g;D++){C=Math.cos(_);T=Math.sin(_);if(p.get("show")){var A=I?I+o:o;var L=new vf({shape:{x1:C*(c-A)+l,y1:T*(c-A)+u,x2:C*(c-m-A)+l,y2:T*(c-m-A)+u},style:S,silent:true});if(S.stroke==="auto"){L.setStyle({stroke:r(D/g)})}s.add(L)}if(d.get("show")){var A=d.get("distance")+I;var k=sP(Zn(D/g*(h-f)+f),d.get("formatter"));var P=r(D/g);s.add(new W({style:_h(d,{text:k,x:C*(c-m-A)+l,y:T*(c-m-A)+u,verticalAlign:T<-.8?"top":T>.8?"bottom":"middle",align:C<-.4?"left":C>.4?"right":"center"},{inheritColor:P}),silent:true}))}if(v.get("show")&&D!==g){var A=v.get("distance");A=A?A+o:o;for(var O=0;O<=y;O++){C=Math.cos(_);T=Math.sin(_);var N=new vf({shape:{x1:C*(c-A)+l,y1:T*(c-A)+u,x2:C*(c-x-A)+l,y2:T*(c-x-A)+u},silent:true,style:M});if(M.stroke==="auto"){N.setStyle({stroke:r((D+O/y)/g)})}s.add(N);_+=w}_-=w}else{_+=b}}};r.prototype._renderPointer=function(h,e,t,l,p,u,r,c,f){var v=this.group;var d=this._data;var g=this._progressEls;var y=[];var m=h.get(["pointer","show"]);var x=h.getModel("progress");var _=x.get("show");var b=h.getData();var w=b.mapDimension("value");var i=+h.get("min");var S=+h.get("max");var M=[i,S];var I=[u,r];function C(e,t){var r=b.getItemModel(e);var i=r.getModel("pointer");var n=Y(i.get("width"),p.r);var a=Y(i.get("length"),p.r);var o=h.get(["pointer","icon"]);var s=i.get("offsetCenter");var l=Y(s[0],p.r);var u=Y(s[1],p.r);var c=i.get("keepAspect");var f;if(o){f=S0(o,l-n/2,u-a,n,a,null,c)}else{f=new aP({shape:{angle:-Math.PI/2,width:n,r:a,x:l,y:u}})}f.rotation=-(t+Math.PI/2);f.x=p.cx;f.y=p.cy;return f}function T(e,t){var r=x.get("roundCap");var i=r?bC:ef;var n=x.get("overlap");var a=n?x.get("width"):f/b.count();var o=n?p.r-a:p.r-(e+1)*a;var s=n?p.r:p.r-e*a;var l=new i({shape:{startAngle:u,endAngle:t,cx:p.cx,cy:p.cy,clockwise:c,r0:o,r:s}});n&&(l.z2=S-b.get(w,e)%S);return l}if(_||m){b.diff(d).add(function(e){if(m){var t=C(e,u);qf(t,{rotation:-(V(b.get(w,e),M,I,true)+Math.PI/2)},h);v.add(t);b.setItemGraphicEl(e,t)}if(_){var r=T(e,u);var i=x.get("clip");qf(r,{shape:{endAngle:V(b.get(w,e),M,I,i)}},h);v.add(r);y[e]=r}}).update(function(e,t){if(m){var r=d.getItemGraphicEl(t);var i=r?r.rotation:u;var n=C(e,i);n.rotation=i;X(n,{rotation:-(V(b.get(w,e),M,I,true)+Math.PI/2)},h);v.add(n);b.setItemGraphicEl(e,n)}if(_){var a=g[t];var o=a?a.shape.endAngle:u;var s=T(e,o);var l=x.get("clip");X(s,{shape:{endAngle:V(b.get(w,e),M,I,l)}},h);v.add(s);y[e]=s}}).execute();b.each(function(e){var t=b.getItemModel(e);var r=t.getModel("emphasis");if(m){var i=b.getItemGraphicEl(e);var n=b.getItemVisual(e,"style");var a=n.fill;if(i instanceof Rl){var o=i.style;i.useStyle(F({image:o.image,x:o.x,y:o.y,width:o.width,height:o.height},n))}else{i.useStyle(n);i.type!=="pointer"&&i.setColor(a)}i.setStyle(t.getModel(["pointer","itemStyle"]).getItemStyle());if(i.style.fill==="auto"){i.setStyle("fill",l(V(b.get(w,e),M,[0,1],true)))}i.z2EmphasisLift=0;ac(i,t);tc(i,r.get("focus"),r.get("blurScope"))}if(_){var s=y[e];s.useStyle(b.getItemVisual(e,"style"));s.setStyle(t.getModel(["progress","itemStyle"]).getItemStyle());s.z2EmphasisLift=0;ac(s,t);tc(s,r.get("focus"),r.get("blurScope"))}});this._progressEls=y}};r.prototype._renderAnchor=function(e,t){var r=e.getModel("anchor");var i=r.get("show");if(i){var n=r.get("size");var a=r.get("icon");var o=r.get("offsetCenter");var s=r.get("keepAspect");var l=S0(a,t.cx-n/2+Y(o[0],t.r),t.cy-n/2+Y(o[1],t.r),n,n,null,s);l.z2=r.get("showAbove")?1:0;l.setStyle(r.getModel("itemStyle").getItemStyle());this.group.add(l)}};r.prototype._renderTitleAndDetail=function(m,e,t,x,_){var r=this;var b=m.getData();var w=b.mapDimension("value");var S=+m.get("min");var M=+m.get("max");var I=new H;var C=[];var T=[];var D=m.isAnimationEnabled();b.diff(this._data).add(function(e){C[e]=new W({silent:true});T[e]=new W({silent:true})}).update(function(e,t){C[e]=r._titleEls[t];T[e]=r._detailEls[t]}).execute();b.each(function(e){var t=b.getItemModel(e);var o=b.get(w,e);var r=new H;var i=x(V(o,[S,M],[0,1],true));var n=t.getModel("title");if(n.get("show")){var a=n.get("offsetCenter");var s=_.cx+Y(a[0],_.r);var l=_.cy+Y(a[1],_.r);var u=C[e];u.attr({style:_h(n,{x:s,y:l,text:b.getName(e),align:"center",verticalAlign:"middle"},{inheritColor:i})});r.add(u)}var c=t.getModel("detail");if(c.get("show")){var f=c.get("offsetCenter");var h=_.cx+Y(f[0],_.r);var p=_.cy+Y(f[1],_.r);var v=Y(c.get("width"),_.r);var d=Y(c.get("height"),_.r);var g=m.get(["progress","show"])?b.getItemVisual(e,"style").fill:i;var u=T[e];var y=c.get("formatter");u.attr({style:_h(c,{x:h,y:p,text:sP(o,y),width:isNaN(v)?null:v,height:isNaN(d)?null:d,align:"center",verticalAlign:"middle"},{inheritColor:g})});Lh(u,{normal:c},o,function(e){return sP(e,y)});D&&kh(u,e,b,m,{getFormattedLabel:function(e,t,r,i,n,a){return sP(a?a.interpolatedValue:o,y)}});r.add(u)}I.add(r)});this.group.add(I);this._titleEls=C;this._detailEls=T};r.type="gauge";return r}(v);var cP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.visualStyleAccessPath="itemStyle";e.useColorPaletteOnData=true;return e}r.prototype.getInitialData=function(e,t){return n2(this,["value"])};r.type="series.gauge";r.defaultOption={zlevel:0,z:2,center:["50%","50%"],legendHoverLink:true,radius:"75%",startAngle:225,endAngle:-45,clockwise:true,min:0,max:100,splitNumber:10,axisLine:{show:true,roundCap:false,lineStyle:{color:[[1,"#E6EBF8"]],width:10}},progress:{show:false,overlap:true,width:10,roundCap:false,clip:true},splitLine:{show:true,length:10,distance:10,lineStyle:{color:"#63677A",width:3,type:"solid"}},axisTick:{show:true,splitNumber:5,length:6,distance:10,lineStyle:{color:"#63677A",width:1,type:"solid"}},axisLabel:{show:true,distance:15,color:"#464646",fontSize:12},pointer:{icon:null,offsetCenter:[0,0],show:true,length:"60%",width:6,keepAspect:false},anchor:{show:false,showAbove:false,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:false,itemStyle:{color:"#fff",borderWidth:0,borderColor:"#5470c6"}},title:{show:true,offsetCenter:[0,"20%"],color:"#464646",fontSize:16,valueAnimation:false},detail:{show:true,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:"#464646",fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:false}};return r}(dy);function fP(e){e.registerChartView(uP);e.registerSeriesModel(cP)}var hP=["itemStyle","opacity"];var pP=function(o){d(e,o);function e(e,t){var r=o.call(this)||this;var i=r;var n=new ff;var a=new W;i.setTextContent(a);r.setTextGuideLine(n);r.updateData(e,t,true);return r}e.prototype.updateData=function(e,t,r){var i=this;var n=e.hostModel;var a=e.getItemModel(t);var o=e.getItemLayout(t);var s=a.getModel("emphasis");var l=a.get(hP);l=l==null?1:l;i.useStyle(e.getItemVisual(t,"style"));i.style.lineJoin="round";if(r){i.setShape({points:o.points});i.style.opacity=0;qf(i,{style:{opacity:l}},n,t)}else{X(i,{style:{opacity:l},shape:{points:o.points}},n,t)}ac(i,a);this._updateLabel(e,t);tc(this,s.get("focus"),s.get("blurScope"))};e.prototype._updateLabel=function(e,t){var r=this;var i=this.getTextGuideLine();var n=r.getTextContent();var a=e.hostModel;var o=e.getItemModel(t);var s=e.getItemLayout(t);var l=s.label;var u=e.getItemVisual(t,"style");var c=u.fill;mh(n,xh(o),{labelFetcher:e.hostModel,labelDataIndex:t,defaultOpacity:u.opacity,defaultText:e.getName(t)},{normal:{align:l.textAlign,verticalAlign:l.verticalAlign}});r.setTextConfig({local:true,inside:!!l.inside,insideStroke:c,outsideFill:c});var f=l.linePoints;i.setShape({points:f});r.textGuideLineConfig={anchor:f?new Z(f[0][0],f[0][1]):null};X(n,{style:{x:l.x,y:l.y}},a,t);n.attr({rotation:l.rotation,originX:l.x,originY:l.y,z2:10});Zm(r,Ym(o),{stroke:c})};return e}(uf);var vP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.ignoreLabelLineUpdate=true;return e}r.prototype.render=function(r,e,t){var i=r.getData();var n=this._data;var a=this.group;i.diff(n).add(function(e){var t=new pP(i,e);i.setItemGraphicEl(e,t);a.add(t)}).update(function(e,t){var r=n.getItemGraphicEl(t);r.updateData(i,e);a.add(r);i.setItemGraphicEl(e,r)}).remove(function(e){var t=n.getItemGraphicEl(e);Qf(t,r,e)}).execute();this._data=i};r.prototype.remove=function(){this.group.removeAll();this._data=null};r.prototype.dispose=function(){};r.type="funnel";return r}(v);var dP=function(a){d(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;e.type=t.type;e.useColorPaletteOnData=true;return e}t.prototype.init=function(e){a.prototype.init.apply(this,arguments);this.legendVisualProvider=new a2(x(this.getData,this),x(this.getRawData,this));this._defaultLabelLine(e)};t.prototype.getInitialData=function(e,t){return n2(this,{coordDimensions:["value"],encodeDefaulter:_(Pv,this)})};t.prototype._defaultLabelLine=function(e){Ca(e,"labelLine",["show"]);var t=e.labelLine;var r=e.emphasis.labelLine;t.show=t.show&&e.label.show;r.show=r.show&&e.emphasis.label.show};t.prototype.getDataParams=function(e){var t=this.getData();var r=a.prototype.getDataParams.call(this,e);var i=t.mapDimension("value");var n=t.getSum(i);r.percent=!n?0:+(t.get(i,e)/n*100).toFixed(2);r.$vars.push("percent");return r};t.type="series.funnel";t.defaultOption={zlevel:0,z:2,legendHoverLink:true,left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:true,position:"outer"},labelLine:{show:true,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:true}},select:{itemStyle:{borderColor:"#212121"}}};return t}(dy);function gP(e,t){return sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function yP(e,t){var r=e.mapDimension("value");var i=e.mapArray(r,function(e){return e});var n=[];var a=t==="ascending";for(var o=0,s=e.count();o<s;o++){n[o]=o}if(typeof t==="function"){n.sort(t)}else if(t!=="none"){n.sort(function(e,t){return a?i[e]-i[t]:i[t]-i[e]})}return n}function mP(y){var e=y.hostModel;var m=e.get("orient");y.each(function(e){var t=y.getItemModel(e);var r=t.getModel("label");var i=r.get("position");var n=t.getModel("labelLine");var a=y.getItemLayout(e);var o=a.points;var s=i==="inner"||i==="inside"||i==="center"||i==="insideLeft"||i==="insideRight";var l;var u;var c;var f;if(s){if(i==="insideLeft"){u=(o[0][0]+o[3][0])/2+5;c=(o[0][1]+o[3][1])/2;l="left"}else if(i==="insideRight"){u=(o[1][0]+o[2][0])/2-5;c=(o[1][1]+o[2][1])/2;l="right"}else{u=(o[0][0]+o[1][0]+o[2][0]+o[3][0])/4;c=(o[0][1]+o[1][1]+o[2][1]+o[3][1])/4;l="center"}f=[[u,c],[u,c]]}else{var h=void 0;var p=void 0;var v=void 0;var d=void 0;var g=n.get("length");if("development"!=="production"){if(m==="vertical"&&["top","bottom"].indexOf(i)>-1){i="left";console.warn("Position error: Funnel chart on vertical orient dose not support top and bottom.")}if(m==="horizontal"&&["left","right"].indexOf(i)>-1){i="bottom";console.warn("Position error: Funnel chart on horizontal orient dose not support left and right.")}}if(i==="left"){h=(o[3][0]+o[0][0])/2;p=(o[3][1]+o[0][1])/2;v=h-g;u=v-5;l="right"}else if(i==="right"){h=(o[1][0]+o[2][0])/2;p=(o[1][1]+o[2][1])/2;v=h+g;u=v+5;l="left"}else if(i==="top"){h=(o[3][0]+o[0][0])/2;p=(o[3][1]+o[0][1])/2;d=p-g;c=d-5;l="center"}else if(i==="bottom"){h=(o[1][0]+o[2][0])/2;p=(o[1][1]+o[2][1])/2;d=p+g;c=d+5;l="center"}else if(i==="rightTop"){h=m==="horizontal"?o[3][0]:o[1][0];p=m==="horizontal"?o[3][1]:o[1][1];if(m==="horizontal"){d=p-g;c=d-5;l="center"}else{v=h+g;u=v+5;l="top"}}else if(i==="rightBottom"){h=o[2][0];p=o[2][1];if(m==="horizontal"){d=p+g;c=d+5;l="center"}else{v=h+g;u=v+5;l="bottom"}}else if(i==="leftTop"){h=o[0][0];p=m==="horizontal"?o[0][1]:o[1][1];if(m==="horizontal"){d=p-g;c=d-5;l="center"}else{v=h-g;u=v-5;l="right"}}else if(i==="leftBottom"){h=m==="horizontal"?o[1][0]:o[3][0];p=m==="horizontal"?o[1][1]:o[2][1];if(m==="horizontal"){d=p+g;c=d+5;l="center"}else{v=h-g;u=v-5;l="right"}}else{h=(o[1][0]+o[2][0])/2;p=(o[1][1]+o[2][1])/2;if(m==="horizontal"){d=p+g;c=d+5;l="center"}else{v=h+g;u=v+5;l="left"}}if(m==="horizontal"){v=h;u=v}else{d=p;c=d}f=[[h,p],[v,d]]}a.label={linePoints:f,x:u,y:c,verticalAlign:"middle",textAlign:l,inside:s}})}function xP(e,D){e.eachSeriesByType("funnel",function(e){var l=e.getData();var u=l.mapDimension("value");var t=e.get("sort");var r=gP(e,D);var c=e.get("orient");var f=r.width;var h=r.height;var i=yP(l,t);var p=r.x;var v=r.y;var d=c==="horizontal"?[Y(e.get("minSize"),h),Y(e.get("maxSize"),h)]:[Y(e.get("minSize"),f),Y(e.get("maxSize"),f)];var n=l.getDataExtent(u);var g=e.get("min");var y=e.get("max");if(g==null){g=Math.min(n[0],0)}if(y==null){y=n[1]}var m=e.get("funnelAlign");var a=e.get("gap");var o=c==="horizontal"?f:h;var s=(o-a*(l.count()-1))/l.count();var x=function(e,t){if(c==="horizontal"){var r=l.get(u,e)||0;var i=V(r,[g,y],d,true);var n=void 0;switch(m){case"top":n=v;break;case"center":n=v+(h-i)/2;break;case"bottom":n=v+(h-i);break}return[[t,n],[t,n+i]]}var a=l.get(u,e)||0;var o=V(a,[g,y],d,true);var s;switch(m){case"left":s=p;break;case"center":s=p+(f-o)/2;break;case"right":s=p+f-o;break}return[[s,t],[s+o,t]]};if(t==="ascending"){s=-s;a=-a;if(c==="horizontal"){p+=f}else{v+=h}i=i.reverse()}for(var _=0;_<i.length;_++){var b=i[_];var w=i[_+1];var S=l.getItemModel(b);if(c==="horizontal"){var M=S.get(["itemStyle","width"]);if(M==null){M=s}else{M=Y(M,f);if(t==="ascending"){M=-M}}var I=x(b,p);var C=x(w,p+M);p+=M+a;l.setItemLayout(b,{points:I.concat(C.slice().reverse())})}else{var T=S.get(["itemStyle","height"]);if(T==null){T=s}else{T=Y(T,h);if(t==="ascending"){T=-T}}var I=x(b,v);var C=x(w,v+T);v+=T+a;l.setItemLayout(b,{points:I.concat(C.slice().reverse())})}}mP(l)})}function _P(e){e.registerChartView(vP);e.registerSeriesModel(dP);e.registerLayout(xP);e.registerProcessor(qC("funnel"))}var bP=.3;var wP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._dataGroup=new H;e._initialized=false;return e}r.prototype.init=function(){this.group.add(this._dataGroup)};r.prototype.render=function(n,e,t,r){var i=this._dataGroup;var a=n.getData();var o=this._data;var s=n.coordinateSystem;var l=s.dimensions;var u=CP(n);a.diff(o).add(c).update(f).remove(h).execute();function c(e){var t=IP(a,i,e,l,s);TP(t,a,e,u)}function f(e,t){var r=o.getItemGraphicEl(t);var i=MP(a,e,l,s);a.setItemGraphicEl(e,r);X(r,{shape:{points:i}},n,e);TP(r,a,e,u)}function h(e){var t=o.getItemGraphicEl(e);i.remove(t)}if(!this._initialized){this._initialized=true;var p=SP(s,n,function(){setTimeout(function(){i.removeClipPath()})});i.setClipPath(p)}this._data=a};r.prototype.incrementalPrepareRender=function(e,t,r){this._initialized=true;this._data=null;this._dataGroup.removeAll()};r.prototype.incrementalRender=function(e,t,r){var i=t.getData();var n=t.coordinateSystem;var a=n.dimensions;var o=CP(t);for(var s=e.start;s<e.end;s++){var l=IP(i,this._dataGroup,s,a,n);l.incremental=true;TP(l,i,s,o)}};r.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll();this._data=null};r.type="parallel";return r}(v);function SP(e,t,r){var i=e.model;var n=e.getRect();var a=new G({shape:{x:n.x,y:n.y,width:n.width,height:n.height}});var o=i.get("layout")==="horizontal"?"width":"height";a.setShape(o,0);qf(a,{shape:{width:n.width,height:n.height}},t,r);return a}function MP(e,t,r,i){var n=[];for(var a=0;a<r.length;a++){var o=r[a];var s=e.get(e.mapDimension(o),t);if(!DP(s,i.getAxis(o).type)){n.push(i.dataToPoint(s,o))}}return n}function IP(e,t,r,i,n){var a=MP(e,r,i,n);var o=new ff({shape:{points:a},z2:10});t.add(o);e.setItemGraphicEl(r,o);return o}function CP(e){var t=e.get("smooth",true);t===true&&(t=bP);t=ua(t);_e(t)&&(t=0);return{smooth:t}}function TP(e,t,r,i){e.useStyle(t.getItemVisual(r,"style"));e.style.fill=null;e.setShape("smooth",i.smooth);var n=t.getItemModel(r);var a=n.getModel("emphasis");ac(e,n,"lineStyle");tc(e,a.get("focus"),a.get("blurScope"))}function DP(e,t){return t==="category"?e==null:e==null||isNaN(e)}var AP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.visualStyleAccessPath="lineStyle";e.visualDrawType="stroke";return e}r.prototype.getInitialData=function(e,t){return sw(this.getSource(),this,{useEncodeDefaulter:x(LP,null,this)})};r.prototype.getRawIndicesByActiveState=function(r){var e=this.coordinateSystem;var i=this.getData();var n=[];e.eachActiveState(i,function(e,t){if(r===e){n.push(i.getRawIndex(t))}});return n};r.type="series.parallel";r.dependencies=["parallel"];r.defaultOption={zlevel:0,z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:false},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:false}},progressive:500,smooth:false,animationEasing:"linear"};return r}(dy);function LP(e){var t=e.ecModel.getComponent("parallel",e.get("parallelIndex"));if(!t){return}var r={};U(t.dimensions,function(e){var t=kP(e);r[e]=t});return r}function kP(e){return+e.replace("dim","")}var PP=["lineStyle","opacity"];var OP={seriesType:"parallel",reset:function(e,t){var r=e.coordinateSystem;var o={normal:e.get(["lineStyle","opacity"]),active:e.get("activeOpacity"),inactive:e.get("inactiveOpacity")};return{progress:function(e,a){r.eachActiveState(a,function(e,t){var r=o[e];if(e==="normal"&&a.hasItemOption){var i=a.getItemModel(t).get(PP,true);i!=null&&(r=i)}var n=a.ensureUniqueItemVisual(t,"style");n.opacity=r},e.start,e.end)}}}};function NP(e){EP(e);RP(e)}function EP(e){if(e.parallel){return}var t=false;U(e.series,function(e){if(e&&e.type==="parallel"){t=true}});if(t){e.parallel=[{}]}}function RP(i){var e=Ia(i.parallelAxis);U(e,function(e){if(!O(e)){return}var t=e.parallelIndex||0;var r=Ia(i.parallel)[t];if(r&&r.parallelAxisDefault){y(e,r.parallelAxisDefault,false)}})}var zP=5;var BP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){this._model=e;this._api=r;if(!this._handlers){this._handlers={};U(VP,function(e,t){r.getZr().on(t,this._handlers[t]=x(e,this))},this)}zy(this,"_throttledDispatchExpand",e.get("axisExpandRate"),"fixRate")};r.prototype.dispose=function(e,r){U(this._handlers,function(e,t){r.getZr().off(t,e)});this._handlers=null};r.prototype._throttledDispatchExpand=function(e){this._dispatchExpand(e)};r.prototype._dispatchExpand=function(e){e&&this._api.dispatchAction(F({type:"parallelAxisExpand"},e))};r.type="parallel";return r}(My);var VP={mousedown:function(e){if(GP(this,"click")){this._mouseDownPoint=[e.offsetX,e.offsetY]}},mouseup:function(e){var t=this._mouseDownPoint;if(GP(this,"click")&&t){var r=[e.offsetX,e.offsetY];var i=Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2);if(i>zP){return}var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([e.offsetX,e.offsetY]);n.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(e){if(this._mouseDownPoint||!GP(this,"mousemove")){return}var t=this._model;var r=t.coordinateSystem.getSlidedAxisExpandWindow([e.offsetX,e.offsetY]);var i=r.behavior;i==="jump"&&this._throttledDispatchExpand.debounceNextCall(t.get("axisExpandDebounce"));this._throttledDispatchExpand(i==="none"?null:{axisExpandWindow:r.axisExpandWindow,animation:i==="jump"?null:{duration:0}})}};function GP(e,t){var r=e._model;return r.get("axisExpandable")&&r.get("axisExpandTriggerOn")===t}var FP=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(){t.prototype.init.apply(this,arguments);this.mergeOption({})};r.prototype.mergeOption=function(e){var t=this.option;e&&y(t,e,true);this._initDimensions()};r.prototype.contains=function(e,t){var r=e.get("parallelIndex");return r!=null&&t.getComponent("parallel",r)===this};r.prototype.setAxisExpand=function(t){U(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(e){if(t.hasOwnProperty(e)){this.option[e]=t[e]}},this)};r.prototype._initDimensions=function(){var t=this.dimensions=[];var r=this.parallelAxisIndex=[];var e=ue(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(e){return(e.get("parallelIndex")||0)===this.componentIndex},this);U(e,function(e){t.push("dim"+e.get("dim"));r.push(e.componentIndex)})};r.type="parallel";r.dependencies=["parallelAxis"];r.layoutMode="box";r.defaultOption={zlevel:0,z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:false,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null};return r}(p);var HP=function(o){d(e,o);function e(e,t,r,i,n){var a=o.call(this,e,t,r)||this;a.type=i||"value";a.axisIndex=n;return a}e.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"};return e}($S);function WP(e,t,r,i,n,a){e=e||0;var o=r[1]-r[0];if(n!=null){n=UP(n,[0,o])}if(a!=null){a=Math.max(a,n!=null?n:0)}if(i==="all"){var s=Math.abs(t[1]-t[0]);s=UP(s,[0,o]);n=a=UP(s,[n,a]);i=0}t[0]=UP(t[0],r);t[1]=UP(t[1],r);var l=jP(t,i);t[i]+=e;var u=n||0;var c=r.slice();l.sign<0?c[0]+=u:c[1]-=u;t[i]=UP(t[i],c);var f;f=jP(t,i);if(n!=null&&(f.sign!==l.sign||f.span<n)){t[1-i]=t[i]+l.sign*n}f=jP(t,i);if(a!=null&&f.span>a){t[1-i]=t[i]+f.sign*a}return t}function jP(e,t){var r=e[t]-e[1-t];return{span:Math.abs(r),sign:r>0?-1:r<0?1:t?-1:1}}function UP(e,t){return Math.min(t[1]!=null?t[1]:Infinity,Math.max(t[0]!=null?t[0]:-Infinity,e))}var ZP=U;var YP=Math.min;var XP=Math.max;var qP=Math.floor;var JP=Math.ceil;var KP=Zn;var QP=Math.PI;var $P=function(){function e(e,t,r){this.type="parallel";this._axesMap=I();this._axesLayout={};this.dimensions=e.dimensions;this._model=e;this._init(e,t,r)}e.prototype._init=function(e,o,t){var r=e.dimensions;var s=e.parallelAxisIndex;ZP(r,function(e,t){var r=s[t];var i=o.getComponent("parallelAxis",r);var n=this._axesMap.set(e,new HP(e,dS(i),[0,0],i.get("type"),r));var a=n.type==="category";n.onBand=a&&i.get("boundaryGap");n.inverse=i.get("inverse");i.axis=n;n.model=i;n.coordinateSystem=i.coordinateSystem=this},this)};e.prototype.update=function(e,t){this._updateAxesFromSeries(this._model,e)};e.prototype.containPoint=function(e){var t=this._makeLayoutInfo();var r=t.axisBase;var i=t.layoutBase;var n=t.pixelDimIndex;var a=e[1-n];var o=e[n];return a>=r&&a<=r+t.axisLength&&o>=i&&o<=i+t.layoutLength};e.prototype.getModel=function(){return this._model};e.prototype._updateAxesFromSeries=function(t,i){i.eachSeries(function(e){if(!t.contains(e,i)){return}var r=e.getData();ZP(this.dimensions,function(e){var t=this._axesMap.get(e);t.scale.unionExtentFromData(r,r.mapDimension(e));vS(t.scale,t.model)},this)},this)};e.prototype.resize=function(e,t){this._rect=sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()});this._layoutAxes()};e.prototype.getRect=function(){return this._rect};e.prototype._makeLayoutInfo=function(){var e=this._model;var t=this._rect;var r=["x","y"];var i=["width","height"];var n=e.get("layout");var a=n==="horizontal"?0:1;var o=t[i[a]];var s=[0,o];var l=this.dimensions.length;var u=eO(e.get("axisExpandWidth"),s);var c=eO(e.get("axisExpandCount")||0,[0,l]);var f=e.get("axisExpandable")&&l>3&&l>c&&c>1&&u>0&&o>0;var h=e.get("axisExpandWindow");var p;if(!h){p=eO(u*(c-1),s);var v=e.get("axisExpandCenter")||qP(l/2);h=[u*v-p/2];h[1]=h[0]+p}else{p=eO(h[1]-h[0],s);h[1]=h[0]+p}var d=(o-p)/(l-c);d<3&&(d=0);var g=[qP(KP(h[0]/u,1))+1,JP(KP(h[1]/u,1))-1];var y=d/u*h[0];return{layout:n,pixelDimIndex:a,layoutBase:t[r[a]],layoutLength:o,axisBase:t[r[1-a]],axisLength:t[i[1-a]],axisExpandable:f,axisExpandWidth:u,axisCollapseWidth:d,axisExpandWindow:h,axisCount:l,winInnerIndices:g,axisExpandWindow0Pos:y}};e.prototype._layoutAxes=function(){var l=this._rect;var e=this._axesMap;var t=this.dimensions;var u=this._makeLayoutInfo();var c=u.layout;e.each(function(e){var t=[0,u.axisLength];var r=e.inverse?1:0;e.setExtent(t[r],t[1-r])});ZP(t,function(e,t){var r=(u.axisExpandable?rO:tO)(t,u);var i={horizontal:{x:r.position,y:u.axisLength},vertical:{x:0,y:r.position}};var n={horizontal:QP/2,vertical:0};var a=[i[c].x+l.x,i[c].y+l.y];var o=n[c];var s=Pi();zi(s,s,o);Ri(s,s,a);this._axesLayout[e]={position:a,rotation:o,transform:s,axisNameAvailableWidth:r.axisNameAvailableWidth,axisLabelShow:r.axisLabelShow,nameTruncateMaxWidth:r.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)};e.prototype.getAxis=function(e){return this._axesMap.get(e)};e.prototype.dataToPoint=function(e,t){return this.axisCoordToPoint(this._axesMap.get(t).dataToCoord(e),t)};e.prototype.eachActiveState=function(t,e,r,i){r==null&&(r=0);i==null&&(i=t.count());var n=this._axesMap;var a=this.dimensions;var o=[];var s=[];U(a,function(e){o.push(t.mapDimension(e));s.push(n.get(e).model)});var l=this.hasAxisBrushed();for(var u=r;u<i;u++){var c=void 0;if(!l){c="normal"}else{c="active";var f=t.getValues(o,u);for(var h=0,p=a.length;h<p;h++){var v=s[h].getActiveState(f[h]);if(v==="inactive"){c="inactive";break}}}e(c,u)}};e.prototype.hasAxisBrushed=function(){var e=this.dimensions;var t=this._axesMap;var r=false;for(var i=0,n=e.length;i<n;i++){if(t.get(e[i]).model.getActiveState()!=="normal"){r=true}}return r};e.prototype.axisCoordToPoint=function(e,t){var r=this._axesLayout[t];return th([e,0],r.transform)};e.prototype.getAxisLayout=function(e){return M(this._axesLayout[e])};e.prototype.getSlidedAxisExpandWindow=function(e){var t=this._makeLayoutInfo();var r=t.pixelDimIndex;var i=t.axisExpandWindow.slice();var n=i[1]-i[0];var a=[0,t.axisExpandWidth*(t.axisCount-1)];if(!this.containPoint(e)){return{behavior:"none",axisExpandWindow:i}}var o=e[r]-t.layoutBase-t.axisExpandWindow0Pos;var s;var l="slide";var u=t.axisCollapseWidth;var c=this._model.get("axisExpandSlideTriggerArea");var f=c[0]!=null;if(u){if(f&&u&&o<n*c[0]){l="jump";s=o-n*c[2]}else if(f&&u&&o>n*(1-c[0])){l="jump";s=o-n*(1-c[2])}else{(s=o-n*c[1])>=0&&(s=o-n*(1-c[1]))<=0&&(s=0)}s*=t.axisExpandWidth/u;s?WP(s,i,a,"all"):l="none"}else{var h=i[1]-i[0];var p=a[1]*o/h;i=[XP(0,p-h/2)];i[1]=YP(a[1],i[0]+h);i[0]=i[1]-h}return{axisExpandWindow:i,behavior:l}};return e}();function eO(e,t){return YP(XP(e,t[0]),t[1])}function tO(e,t){var r=t.layoutLength/(t.axisCount-1);return{position:r*e,axisNameAvailableWidth:r,axisLabelShow:true}}function rO(e,t){var r=t.layoutLength;var i=t.axisExpandWidth;var n=t.axisCount;var a=t.axisCollapseWidth;var o=t.winInnerIndices;var s;var l=a;var u=false;var c;if(e<o[0]){s=e*a;c=a}else if(e<=o[1]){s=t.axisExpandWindow0Pos+e*i-t.axisExpandWindow[0];l=i;u=true}else{s=r-(n-1-e)*a;c=a}return{position:s,axisNameAvailableWidth:l,axisLabelShow:u,nameTruncateMaxWidth:c}}function iO(i,n){var a=[];i.eachComponent("parallel",function(e,t){var r=new $P(e,i,n);r.name="parallel_"+t;r.resize(e,n);e.coordinateSystem=r;r.model=e;a.push(r)});i.eachSeries(function(e){if(e.get("coordinateSystem")==="parallel"){var t=e.getReferringComponents("parallel",$a).models[0];e.coordinateSystem=t.coordinateSystem}});return a}var nO={create:iO};var aO=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.activeIntervals=[];return e}r.prototype.getAreaSelectStyle=function(){return wo([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))};r.prototype.setActiveIntervals=function(e){var t=this.activeIntervals=M(e);if(t){for(var r=t.length-1;r>=0;r--){Yn(t[r])}}};r.prototype.getActiveState=function(e){var t=this.activeIntervals;if(!t.length){return"normal"}if(e==null||isNaN(+e)){return"inactive"}if(t.length===1){var r=t[0];if(r[0]<=e&&e<=r[1]){return"active"}}else{for(var i=0,n=t.length;i<n;i++){if(t[i][0]<=e&&e<=t[i][1]){return"active"}}}return"inactive"};return r}(p);oe(aO,IS);var oO=true;var sO=Math.min;var lO=Math.max;var uO=Math.pow;var cO=1e4;var fO=6;var hO=6;var pO="globalPan";var vO={w:[0,0],e:[0,1],n:[1,0],s:[1,1]};var dO={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"};var gO={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:true,brushMode:"single",removeOnClick:false};var yO=0;var mO=function(r){d(e,r);function e(e){var t=r.call(this)||this;t._track=[];t._covers=[];t._handlers={};if("development"!=="production"){E(e)}t._zr=e;t.group=new H;t._uid="brushController_"+yO++;U(JO,function(e,t){this._handlers[t]=x(e,this)},t);return t}e.prototype.enableBrush=function(e){if("development"!=="production"){E(this._mounted)}this._brushType&&this._doDisableBrush();e.brushType&&this._doEnableBrush(e);return this};e.prototype._doEnableBrush=function(e){var r=this._zr;if(!this._enableGlobalPan){VT(r,pO,this._uid)}U(this._handlers,function(e,t){r.on(t,e)});this._brushType=e.brushType;this._brushOption=y(M(gO),e,true)};e.prototype._doDisableBrush=function(){var r=this._zr;GT(r,pO,this._uid);U(this._handlers,function(e,t){r.off(t,e)});this._brushType=this._brushOption=null};e.prototype.setPanels=function(e){if(e&&e.length){var t=this._panels={};U(e,function(e){t[e.panelId]=M(e)})}else{this._panels=null}return this};e.prototype.mount=function(e){e=e||{};if("development"!=="production"){this._mounted=true}this._enableGlobalPan=e.enableGlobalPan;var t=this.group;this._zr.add(t);t.attr({x:e.x||0,y:e.y||0,rotation:e.rotation||0,scaleX:e.scaleX||1,scaleY:e.scaleY||1});this._transform=t.getLocalTransform();return this};e.prototype.updateCovers=function(n){if("development"!=="production"){E(this._mounted)}n=A(n,function(e){return y(M(gO),e,true)});var r="\0-brush-index-";var a=this._covers;var o=this._covers=[];var s=this;var l=this._creatingCover;new gb(a,n,e,i).add(t).update(t).remove(u).execute();return this;function i(e,t){return(e.id!=null?e.id:r+t)+"-"+e.brushType}function e(e,t){return i(e.__brushOption,t)}function t(e,t){var r=n[e];if(t!=null&&a[t]===l){o[e]=a[t]}else{var i=o[e]=t!=null?(a[t].__brushOption=r,a[t]):_O(s,xO(s,r));SO(s,i)}}function u(e){if(a[e]!==l){s.group.remove(a[e])}}};e.prototype.unmount=function(){if("development"!=="production"){if(!this._mounted){return}}this.enableBrush(false);TO(this);this._zr.remove(this.group);if("development"!=="production"){this._mounted=false}return this};e.prototype.dispose=function(){this.unmount();this.off()};return e}(lt);function xO(e,t){var r=$O[t.brushType].createCover(e,t);r.__brushOption=t;wO(r,t);e.group.add(r);return r}function _O(e,t){var r=MO(t);if(r.endCreating){r.endCreating(e,t);wO(t,t.__brushOption)}return t}function bO(e,t){var r=t.__brushOption;MO(t).updateCoverShape(e,t,r.range,r)}function wO(e,t){var r=t.z;r==null&&(r=cO);e.traverse(function(e){e.z=r;e.z2=r})}function SO(e,t){MO(t).updateCommon(e,t);bO(e,t)}function MO(e){return $O[e.__brushOption.brushType]}function IO(e,t,r){var i=e._panels;if(!i){return oO}var n;var a=e._transform;U(i,function(e){e.isTargetByCursor(t,r,a)&&(n=e)});return n}function CO(e,t){var r=e._panels;if(!r){return oO}var i=t.__brushOption.panelId;return i!=null?r[i]:oO}function TO(t){var e=t._covers;var r=e.length;U(e,function(e){t.group.remove(e)},t);e.length=0;return!!r}function DO(e,t){var r=A(e._covers,function(e){var t=e.__brushOption;var r=M(t.range);return{brushType:t.brushType,panelId:t.panelId,range:r}});e.trigger("brush",{areas:r,isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function AO(e){var t=e._track;if(!t.length){return false}var r=t[t.length-1];var i=t[0];var n=r[0]-i[0];var a=r[1]-i[1];var o=uO(n*n+a*a,.5);return o>fO}function LO(e){var t=e.length-1;t<0&&(t=0);return[e[0],e[t]]}function kO(t,r,e,i){var n=new H;n.add(new G({name:"main",style:EO(e),silent:true,draggable:true,cursor:"move",drift:_(GO,t,r,n,["n","s","w","e"]),ondragend:_(DO,r,{isEnd:true})}));U(i,function(e){n.add(new G({name:e.join(""),style:{opacity:0},draggable:true,silent:true,invisible:true,drift:_(GO,t,r,n,e),ondragend:_(DO,r,{isEnd:true})}))});return n}function PO(e,t,r,i){var n=i.brushStyle.lineWidth||0;var a=lO(n,hO);var o=r[0][0];var s=r[1][0];var l=o-n/2;var u=s-n/2;var c=r[0][1];var f=r[1][1];var h=c-a+n/2;var p=f-a+n/2;var v=c-o;var d=f-s;var g=v+n;var y=d+n;NO(e,t,"main",o,s,v,d);if(i.transformable){NO(e,t,"w",l,u,a,y);NO(e,t,"e",h,u,a,y);NO(e,t,"n",l,u,g,a);NO(e,t,"s",l,p,g,a);NO(e,t,"nw",l,u,a,a);NO(e,t,"ne",h,u,a,a);NO(e,t,"sw",l,p,a,a);NO(e,t,"se",h,p,a,a)}}function OO(i,n){var e=n.__brushOption;var a=e.transformable;var t=n.childAt(0);t.useStyle(EO(e));t.attr({silent:!a,cursor:a?"move":"default"});U([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(e){var t=n.childOfName(e.join(""));var r=e.length===1?BO(i,e[0]):VO(i,e);t&&t.attr({silent:!a,invisible:!a,cursor:a?dO[r]+"-resize":null})})}function NO(e,t,r,i,n,a,o){var s=t.childOfName(r);s&&s.setShape(jO(WO(e,t,[[i,n],[i+a,n+o]])))}function EO(e){return R({strokeNoScale:true},e.brushStyle)}function RO(e,t,r,i){var n=[sO(e,r),sO(t,i)];var a=[lO(e,r),lO(t,i)];return[[n[0],a[0]],[n[1],a[1]]]}function zO(e){return eh(e.group)}function BO(e,t){var r={w:"left",e:"right",n:"top",s:"bottom"};var i={left:"w",right:"e",top:"n",bottom:"s"};var n=rh(r[t],zO(e));return i[n]}function VO(e,t){var r=[BO(e,t[0]),BO(e,t[1])];(r[0]==="e"||r[0]==="w")&&r.reverse();return r.join("")}function GO(e,t,r,i,n,a){var o=r.__brushOption;var s=e.toRectRange(o.range);var l=HO(t,n,a);U(i,function(e){var t=vO[e];s[t[0]][t[1]]+=l[t[0]]});o.range=e.fromRectRange(RO(s[0][0],s[1][0],s[0][1],s[1][1]));SO(t,r);DO(t,{isEnd:false})}function FO(e,t,r,i){var n=t.__brushOption.range;var a=HO(e,r,i);U(n,function(e){e[0]+=a[0];e[1]+=a[1]});SO(e,t);DO(e,{isEnd:false})}function HO(e,t,r){var i=e.group;var n=i.transformCoordToLocal(t,r);var a=i.transformCoordToLocal(0,0);return[n[0]-a[0],n[1]-a[1]]}function WO(e,t,r){var i=CO(e,t);return i&&i!==oO?i.clipPath(r,e._transform):M(r)}function jO(e){var t=sO(e[0][0],e[1][0]);var r=sO(e[0][1],e[1][1]);var i=lO(e[0][0],e[1][0]);var n=lO(e[0][1],e[1][1]);return{x:t,y:r,width:i-t,height:n-r}}function UO(e,t,r){if(!e._brushType||QO(e,t.offsetX,t.offsetY)){return}var i=e._zr;var n=e._covers;var a=IO(e,t,r);if(!e._dragging){for(var o=0;o<n.length;o++){var s=n[o].__brushOption;if(a&&(a===oO||s.panelId===a.panelId)&&$O[s.brushType].contain(n[o],r[0],r[1])){return}}}a&&i.setCursorStyle("crosshair")}function ZO(e){var t=e.event;t.preventDefault&&t.preventDefault()}function YO(e,t,r){return e.childOfName("main").contain(t,r)}function XO(e,t,r,i){var n=e._creatingCover;var a=e._creatingPanel;var o=e._brushOption;var s;e._track.push(r.slice());if(AO(e)||n){if(a&&!n){o.brushMode==="single"&&TO(e);var l=M(o);l.brushType=qO(l.brushType,a);l.panelId=a===oO?null:a.panelId;n=e._creatingCover=xO(e,l);e._covers.push(n)}if(n){var u=$O[qO(e._brushType,a)];var c=n.__brushOption;c.range=u.getCreatingRange(WO(e,n,e._track));if(i){_O(e,n);u.updateCommon(e,n)}bO(e,n);s={isEnd:i}}}else if(i&&o.brushMode==="single"&&o.removeOnClick){if(IO(e,t,r)&&TO(e)){s={isEnd:i,removeOnClick:true}}}return s}function qO(e,t){if(e==="auto"){if("development"!=="production"){E(t&&t.defaultBrushType,'MUST have defaultBrushType when brushType is "atuo"')}return t.defaultBrushType}return e}var JO={mousedown:function(e){if(this._dragging){KO(this,e)}else if(!e.target||!e.target.draggable){ZO(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);this._creatingCover=null;var r=this._creatingPanel=IO(this,e,t);if(r){this._dragging=true;this._track=[t.slice()]}}},mousemove:function(e){var t=e.offsetX;var r=e.offsetY;var i=this.group.transformCoordToLocal(t,r);UO(this,e,i);if(this._dragging){ZO(e);var n=XO(this,e,i,false);n&&DO(this,n)}},mouseup:function(e){KO(this,e)}};function KO(e,t){if(e._dragging){ZO(t);var r=t.offsetX;var i=t.offsetY;var n=e.group.transformCoordToLocal(r,i);var a=XO(e,t,n,true);e._dragging=false;e._track=[];e._creatingCover=null;a&&DO(e,a)}}function QO(e,t,r){var i=e._zr;return t<0||t>i.getWidth()||r<0||r>i.getHeight()}var $O={lineX:eN(0),lineY:eN(1),rect:{createCover:function(e,t){function r(e){return e}return kO({toRectRange:r,fromRectRange:r},e,t,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(e){var t=LO(e);return RO(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(e,t,r,i){PO(e,t,r,i)},updateCommon:OO,contain:YO},polygon:{createCover:function(e,t){var r=new H;r.add(new ff({name:"main",style:EO(t),silent:true}));return r},getCreatingRange:function(e){return e},endCreating:function(e,t){t.remove(t.childAt(0));t.add(new uf({name:"main",draggable:true,drift:_(FO,e,t),ondragend:_(DO,e,{isEnd:true})}))},updateCoverShape:function(e,t,r,i){t.childAt(0).setShape({points:WO(e,t,r)})},updateCommon:OO,contain:YO}};function eN(l){return{createCover:function(e,t){return kO({toRectRange:function(e){var t=[e,[0,100]];l&&t.reverse();return t},fromRectRange:function(e){return e[l]}},e,t,[[["w"],["e"]],[["n"],["s"]]][l])},getCreatingRange:function(e){var t=LO(e);var r=sO(t[0][l],t[1][l]);var i=lO(t[0][l],t[1][l]);return[r,i]},updateCoverShape:function(e,t,r,i){var n;var a=CO(e,t);if(a!==oO&&a.getLinearBrushOtherExtent){n=a.getLinearBrushOtherExtent(l)}else{var o=e._zr;n=[0,[o.getWidth(),o.getHeight()][1-l]]}var s=[r,n];l&&s.reverse();PO(e,t,s,i)},updateCommon:OO,contain:YO}}function tN(t){t=nN(t);return function(e){return oh(e,t)}}function rN(n,a){n=nN(n);return function(e){var t=a!=null?a:e;var r=t?n.width:n.height;var i=t?n.x:n.y;return[i,i+(r||0)]}}function iN(e,r,i){var n=nN(e);return function(e,t){return n.contain(t[0],t[1])&&!JT(e,r,i)}}function nN(e){return B.create(e)}var aN=["axisLine","axisTickLabel","axisName"];var oN=function(r){d(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.init=function(e,t){r.prototype.init.apply(this,arguments);(this._brushController=new mO(t.getZr())).on("brush",x(this._onBrush,this))};t.prototype.render=function(e,t,r,i){if(sN(e,t,i)){return}this.axisModel=e;this.api=r;this.group.removeAll();var n=this._axisGroup;this._axisGroup=new H;this.group.add(this._axisGroup);if(!e.get("show")){return}var a=uN(e,t);var o=a.coordinateSystem;var s=e.getAreaSelectStyle();var l=s.width;var u=e.axis.dim;var c=o.getAxisLayout(u);var f=F({strokeContainThreshold:l},c);var h=new V2(e,f);U(aN,h.add,h);this._axisGroup.add(h.getGroup());this._refreshBrushController(f,s,e,a,l,r);ah(n,this._axisGroup,e)};t.prototype._refreshBrushController=function(e,t,r,i,n,a){var o=r.axis.getExtent();var s=o[1]-o[0];var l=Math.min(30,Math.abs(s)*.1);var u=B.create({x:o[0],y:-n/2,width:s,height:n});u.x-=l;u.width+=2*l;this._brushController.mount({enableGlobalPan:true,rotation:e.rotation,x:e.position[0],y:e.position[1]}).setPanels([{panelId:"pl",clipPath:tN(u),isTargetByCursor:iN(u,a,i),getLinearBrushOtherExtent:rN(u,0)}]).enableBrush({brushType:"lineX",brushStyle:t,removeOnClick:true}).updateCovers(lN(r))};t.prototype._onBrush=function(e){var t=e.areas;var r=this.axisModel;var i=r.axis;var n=A(t,function(e){return[i.coordToData(e.range[0],true),i.coordToData(e.range[1],true)]});if(!r.option.realtime===e.isEnd||e.removeOnClick){this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:r.id,intervals:n})}};t.prototype.dispose=function(){this._brushController.dispose()};t.type="parallelAxis";return t}(My);function sN(e,t,r){return r&&r.type==="axisAreaSelect"&&t.findComponents({mainType:"parallelAxis",query:r})[0]===e}function lN(e){var t=e.axis;return A(e.activeIntervals,function(e){return{brushType:"lineX",panelId:"pl",range:[t.dataToCoord(e[0],true),t.dataToCoord(e[1],true)]}})}function uN(e,t){return t.getComponent("parallel",e.get("parallelIndex"))}var cN={type:"axisAreaSelect",event:"axisAreaSelected"};function fN(e){e.registerAction(cN,function(t,e){e.eachComponent({mainType:"parallelAxis",query:t},function(e){e.axis.model.setActiveIntervals(t.intervals)})});e.registerAction("parallelAxisExpand",function(t,e){e.eachComponent({mainType:"parallel",query:t},function(e){e.setAxisExpand(t)})})}var hN={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:true,z:10};function pN(e){e.registerComponentView(BP);e.registerComponentModel(FP);e.registerCoordinateSystem("parallel",nO);e.registerPreprocessor(NP);e.registerComponentModel(aO);e.registerComponentView(oN);S2(e,"parallel",aO,hN);fN(e)}function vN(e){t(pN);e.registerChartView(wP);e.registerSeriesModel(AP);e.registerVisual(e.PRIORITY.VISUAL.BRUSH,OP)}var dN=function(){function e(){this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.cpx1=0;this.cpy1=0;this.cpx2=0;this.cpy2=0;this.extent=0}return e}();var gN=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultShape=function(){return new dN};e.prototype.buildPath=function(e,t){var r=t.extent;e.moveTo(t.x1,t.y1);e.bezierCurveTo(t.cpx1,t.cpy1,t.cpx2,t.cpy2,t.x2,t.y2);if(t.orient==="vertical"){e.lineTo(t.x2+r,t.y2);e.bezierCurveTo(t.cpx2+r,t.cpy2,t.cpx1+r,t.cpy1,t.x1+r,t.y1)}else{e.lineTo(t.x2,t.y2+r);e.bezierCurveTo(t.cpx2,t.cpy2+r,t.cpx1,t.cpy1+r,t.x1,t.y1+r)}e.closePath()};e.prototype.highlight=function(){Bu(this)};e.prototype.downplay=function(){Vu(this)};return e}(m);var yN=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._focusAdjacencyDisabled=false;return e}r.prototype.render=function(T,e,i){var n=this;var t=T.getGraph();var D=this.group;var r=T.layoutInfo;var A=r.width;var L=r.height;var l=T.getData();var k=T.getData("edge");var P=T.get("orient");this._model=T;D.removeAll();D.x=r.x;D.y=r.y;t.eachEdge(function(e){var t=new gN;var r=j(t);r.dataIndex=e.dataIndex;r.seriesIndex=T.seriesIndex;r.dataType="edge";var i=e.getModel();var n=i.getModel("lineStyle");var a=n.get("curveness");var o=e.node1.getLayout();var s=e.node1.getModel();var l=s.get("localX");var u=s.get("localY");var c=e.node2.getLayout();var f=e.node2.getModel();var h=f.get("localX");var p=f.get("localY");var v=e.getLayout();var d;var g;var y;var m;var x;var _;var b;var w;t.shape.extent=Math.max(1,v.dy);t.shape.orient=P;if(P==="vertical"){d=(l!=null?l*A:o.x)+v.sy;g=(u!=null?u*L:o.y)+o.dy;y=(h!=null?h*A:c.x)+v.ty;m=p!=null?p*L:c.y;x=d;_=g*(1-a)+m*a;b=y;w=g*a+m*(1-a)}else{d=(l!=null?l*A:o.x)+o.dx;g=(u!=null?u*L:o.y)+v.sy;y=h!=null?h*A:c.x;m=(p!=null?p*L:c.y)+v.ty;x=d*(1-a)+y*a;_=g;b=d*a+y*(1-a);w=m}t.setShape({x1:d,y1:g,x2:y,y2:m,cpx1:x,cpy1:_,cpx2:b,cpy2:w});t.useStyle(n.getItemStyle());switch(t.style.fill){case"source":t.style.fill=e.node1.getVisual("color");t.style.decal=e.node1.getVisual("style").decal;break;case"target":t.style.fill=e.node2.getVisual("color");t.style.decal=e.node2.getVisual("style").decal;break;case"gradient":var S=e.node1.getVisual("color");var M=e.node2.getVisual("color");if(typeof S==="string"&&typeof M==="string"){t.style.fill=new Sf(0,0,1,0,[{color:S,offset:0},{color:M,offset:1}])}}var I=i.getModel("emphasis");ac(t,i,"lineStyle",function(e){return e.getItemStyle()});D.add(t);k.setItemGraphicEl(e.dataIndex,t);var C=I.get("focus");tc(t,C==="adjacency"?e.getAdjacentDataIndices():C,I.get("blurScope"));j(t).dataType="edge"});t.eachNode(function(e){var t=e.getLayout();var r=e.getModel();var i=r.get("localX");var n=r.get("localY");var a=r.getModel("emphasis");var o=new G({shape:{x:i!=null?i*A:t.x,y:n!=null?n*L:t.y,width:t.dx,height:t.dy},style:r.getModel("itemStyle").getItemStyle(),z2:10});mh(o,xh(r),{labelFetcher:T,labelDataIndex:e.dataIndex,defaultText:e.id});o.disableLabelAnimation=true;o.setStyle("fill",e.getVisual("color"));o.setStyle("decal",e.getVisual("style").decal);ac(o,r);D.add(o);l.setItemGraphicEl(e.dataIndex,o);j(o).dataType="node";var s=a.get("focus");tc(o,s==="adjacency"?e.getAdjacentDataIndices():s,a.get("blurScope"))});l.eachItemGraphicEl(function(e,r){var t=l.getItemModel(r);if(t.get("draggable")){e.drift=function(e,t){n._focusAdjacencyDisabled=true;this.shape.x+=e;this.shape.y+=t;this.dirty();i.dispatchAction({type:"dragNode",seriesId:T.id,dataIndex:l.getRawIndex(r),localX:this.shape.x/A,localY:this.shape.y/L})};e.ondragend=function(){n._focusAdjacencyDisabled=false};e.draggable=true;e.cursor="move"}});if(!this._data&&T.isAnimationEnabled()){D.setClipPath(mN(D.getBoundingRect(),T,function(){D.removeClipPath()}))}this._data=T.getData()};r.prototype.dispose=function(){};r.type="sankey";return r}(v);function mN(e,t,r){var i=new G({shape:{x:e.x-10,y:e.y-10,width:0,height:e.height+20}});qf(i,{shape:{width:e.width+20}},t,r);return i}var xN=function(a){d(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.getInitialData=function(e,t){var r=e.edges||e.links;var i=e.data||e.nodes;var n=e.levels;this.levelModels=[];var a=this.levelModels;for(var o=0;o<n.length;o++){if(n[o].depth!=null&&n[o].depth>=0){a[n[o].depth]=new C(n[o],this,t)}else{if("development"!=="production"){throw new Error("levels[i].depth is mandatory and should be natural number")}}}if(i&&r){var s=eP(i,r,this,true,l);return s.data}function l(e,t){e.wrapMethod("getItemModel",function(e,t){var r=e.parentModel;var i=r.getData().getItemLayout(t);if(i){var n=i.depth;var a=r.levelModels[n];if(a){e.parentModel=a}}return e});t.wrapMethod("getItemModel",function(e,t){var r=e.parentModel;var i=r.getGraph().getEdgeByIndex(t);var n=i.node1.getLayout();if(n){var a=n.depth;var o=r.levelModels[a];if(o){e.parentModel=o}}return e})}};t.prototype.setNodePosition=function(e,t){var r=this.option.data[e];r.localX=t[0];r.localY=t[1]};t.prototype.getGraph=function(){return this.getData().graph};t.prototype.getEdgeData=function(){return this.getGraph().edgeData};t.prototype.formatTooltip=function(e,t,r){function i(e){return isNaN(e)||e==null}if(r==="edge"){var n=this.getDataParams(e,r);var a=n.data;var o=n.value;var s=a.source+" -- "+a.target;return Kg("nameValue",{name:s,value:o,noValue:i(o)})}else{var l=this.getGraph().getNodeByIndex(e);var u=l.getLayout().value;var c=this.getDataParams(e,r).data.name;return Kg("nameValue",{name:c!=null?c+"":null,value:u,noValue:i(u)})}};t.prototype.optionUpdated=function(){};t.prototype.getDataParams=function(e,t){var r=a.prototype.getDataParams.call(this,e,t);if(r.value==null&&t==="node"){var i=this.getGraph().getNodeByIndex(e);var n=i.getLayout().value;r.value=n}return r};t.type="series.sankey";t.defaultOption={zlevel:0,z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:true,layoutIterations:32,label:{show:true,position:"right",fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:true},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3};return t}(dy);function _N(e,p){e.eachSeriesByType("sankey",function(e){var t=e.get("nodeWidth");var r=e.get("nodeGap");var i=bN(e,p);e.layoutInfo=i;var n=i.width;var a=i.height;var o=e.getGraph();var s=o.nodes;var l=o.edges;SN(s);var u=ue(s,function(e){return e.getLayout().value===0});var c=u.length!==0?0:e.get("layoutIterations");var f=e.get("orient");var h=e.get("nodeAlign");wN(s,l,t,r,n,a,c,f,h)})}function bN(e,t){return sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function wN(e,t,r,i,n,a,o,s,l){MN(e,t,r,n,a,s,l);AN(e,t,a,n,i,o,s);HN(e,s)}function SN(e){U(e,function(e){var t=GN(e.outEdges,VN);var r=GN(e.inEdges,VN);var i=e.getValue()||0;var n=Math.max(t,r,i);e.setLayout({value:n},true)})}function MN(e,t,r,i,n,a,o){var s=[];var l=[];var u=[];var c=[];var f=0;for(var h=0;h<t.length;h++){s[h]=1}for(var h=0;h<e.length;h++){l[h]=e[h].inEdges.length;if(l[h]===0){u.push(e[h])}}var p=-1;while(u.length){for(var v=0;v<u.length;v++){var d=u[v];var g=d.hostGraph.data.getRawDataItem(d.dataIndex);var y=g.depth!=null&&g.depth>=0;if(y&&g.depth>p){p=g.depth}d.setLayout({depth:y?g.depth:f},true);a==="vertical"?d.setLayout({dy:r},true):d.setLayout({dx:r},true);for(var m=0;m<d.outEdges.length;m++){var x=d.outEdges[m];var _=t.indexOf(x);s[_]=0;var b=x.node2;var w=e.indexOf(b);if(--l[w]===0&&c.indexOf(b)<0){c.push(b)}}}++f;u=c;c=[]}for(var h=0;h<s.length;h++){if(s[h]===1){throw new Error("Sankey is a DAG, the original data has cycle!")}}var S=p>f-1?p:f-1;if(o&&o!=="left"){CN(e,o,a,S)}var M=a==="vertical"?(n-r)/S:(i-r)/S;DN(e,M,a)}function IN(e){var t=e.hostGraph.data.getRawDataItem(e.dataIndex);return t.depth!=null&&t.depth>=0}function CN(e,t,r,i){if(t==="right"){var n=[];var a=e;var o=0;while(a.length){for(var s=0;s<a.length;s++){var l=a[s];l.setLayout({skNodeHeight:o},true);for(var u=0;u<l.inEdges.length;u++){var c=l.inEdges[u];if(n.indexOf(c.node1)<0){n.push(c.node1)}}}a=n;n=[];++o}U(e,function(e){if(!IN(e)){e.setLayout({depth:Math.max(0,i-e.getLayout().skNodeHeight)},true)}})}else if(t==="justify"){TN(e,i)}}function TN(e,t){U(e,function(e){if(!IN(e)&&!e.outEdges.length){e.setLayout({depth:t},true)}})}function DN(e,r,i){U(e,function(e){var t=e.getLayout().depth*r;i==="vertical"?e.setLayout({y:t},true):e.setLayout({x:t},true)})}function AN(e,t,r,i,n,a,o){var s=LN(e,o);kN(s,t,r,i,n,o);PN(s,n,r,i,o);for(var l=1;a>0;a--){l*=.99;ON(s,l,o);PN(s,n,r,i,o);FN(s,l,o);PN(s,n,r,i,o)}}function LN(e,t){var r=[];var i=t==="vertical"?"y":"x";var n=ao(e,function(e){return e.getLayout()[i]});n.keys.sort(function(e,t){return e-t});U(n.keys,function(e){r.push(n.buckets.get(e))});return r}function kN(e,t,n,a,o,s){var l=Infinity;U(e,function(e){var t=e.length;var r=0;U(e,function(e){r+=e.getLayout().value});var i=s==="vertical"?(a-(t-1)*o)/r:(n-(t-1)*o)/r;if(i<l){l=i}});U(e,function(e){U(e,function(e,t){var r=e.getLayout().value*l;if(s==="vertical"){e.setLayout({x:t},true);e.setLayout({dx:r},true)}else{e.setLayout({y:t},true);e.setLayout({dy:r},true)}})});U(t,function(e){var t=+e.getValue()*l;e.setLayout({dy:t},true)})}function PN(e,u,c,f,h){var p=h==="vertical"?"x":"y";U(e,function(e){e.sort(function(e,t){return e.getLayout()[p]-t.getLayout()[p]});var t;var r;var i;var n=0;var a=e.length;var o=h==="vertical"?"dx":"dy";for(var s=0;s<a;s++){r=e[s];i=n-r.getLayout()[p];if(i>0){t=r.getLayout()[p]+i;h==="vertical"?r.setLayout({x:t},true):r.setLayout({y:t},true)}n=r.getLayout()[p]+r.getLayout()[o]+u}var l=h==="vertical"?f:c;i=n-u-l;if(i>0){t=r.getLayout()[p]-i;h==="vertical"?r.setLayout({x:t},true):r.setLayout({y:t},true);n=t;for(var s=a-2;s>=0;--s){r=e[s];i=r.getLayout()[p]+r.getLayout()[o]+u-n;if(i>0){t=r.getLayout()[p]-i;h==="vertical"?r.setLayout({x:t},true):r.setLayout({y:t},true)}n=r.getLayout()[p]}}})}function ON(e,a,o){U(e.slice().reverse(),function(e){U(e,function(e){if(e.outEdges.length){var t=GN(e.outEdges,NN,o)/GN(e.outEdges,VN);if(isNaN(t)){var r=e.outEdges.length;t=r?GN(e.outEdges,EN,o)/r:0}if(o==="vertical"){var i=e.getLayout().x+(t-BN(e,o))*a;e.setLayout({x:i},true)}else{var n=e.getLayout().y+(t-BN(e,o))*a;e.setLayout({y:n},true)}}})})}function NN(e,t){return BN(e.node2,t)*e.getValue()}function EN(e,t){return BN(e.node2,t)}function RN(e,t){return BN(e.node1,t)*e.getValue()}function zN(e,t){return BN(e.node1,t)}function BN(e,t){return t==="vertical"?e.getLayout().x+e.getLayout().dx/2:e.getLayout().y+e.getLayout().dy/2}function VN(e){return e.getValue()}function GN(e,t,r){var i=0;var n=e.length;var a=-1;while(++a<n){var o=+t(e[a],r);if(!isNaN(o)){i+=o}}return i}function FN(e,a,o){U(e,function(e){U(e,function(e){if(e.inEdges.length){var t=GN(e.inEdges,RN,o)/GN(e.inEdges,VN);if(isNaN(t)){var r=e.inEdges.length;t=r?GN(e.inEdges,zN,o)/r:0}if(o==="vertical"){var i=e.getLayout().x+(t-BN(e,o))*a;e.setLayout({x:i},true)}else{var n=e.getLayout().y+(t-BN(e,o))*a;e.setLayout({y:n},true)}}})})}function HN(e,t){var r=t==="vertical"?"x":"y";U(e,function(e){e.outEdges.sort(function(e,t){return e.node2.getLayout()[r]-t.node2.getLayout()[r]});e.inEdges.sort(function(e,t){return e.node1.getLayout()[r]-t.node1.getLayout()[r]})});U(e,function(e){var t=0;var r=0;U(e.outEdges,function(e){e.setLayout({sy:t},true);t+=e.getLayout().dy});U(e.inEdges,function(e){e.setLayout({ty:r},true);r+=e.getLayout().dy})})}function WN(e){e.eachSeriesByType("sankey",function(n){var e=n.getGraph();var t=e.nodes;if(t.length){var a=Infinity;var o=-Infinity;U(t,function(e){var t=e.getLayout().value;if(t<a){a=t}if(t>o){o=t}});U(t,function(e){var t=new eL({type:"color",mappingMethod:"linear",dataExtent:[a,o],visual:n.get("color")});var r=t.mapValueToVisual(e.getLayout().value);var i=e.getModel().get(["itemStyle","color"]);if(i!=null){e.setVisual("color",i);e.setVisual("style",{fill:i})}else{e.setVisual("color",r);e.setVisual("style",{fill:r})}})}})}function jN(e){e.registerChartView(yN);e.registerSeriesModel(xN);e.registerLayout(_N);e.registerVisual(WN);e.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(e){e.setNodePosition(t.dataIndex,[t.localX,t.localY])})})}var UN=function(){function e(){}e.prototype.getInitialData=function(e,t){var r;var i=t.getComponent("xAxis",this.get("xAxisIndex"));var n=t.getComponent("yAxis",this.get("yAxisIndex"));var a=i.get("type");var o=n.get("type");var s;if(a==="category"){e.layout="horizontal";r=i.getOrdinalMeta();s=true}else if(o==="category"){e.layout="vertical";r=n.getOrdinalMeta();s=true}else{e.layout=e.layout||"horizontal"}var l=["x","y"];var u=e.layout==="horizontal"?0:1;var c=this._baseAxisDim=l[u];var f=l[1-u];var h=[i,n];var p=h[u].get("type");var v=h[1-u].get("type");var d=e.data;if(d&&s){var g=[];U(d,function(e,t){var r;if(k(e)){r=e.slice();e.unshift(t)}else if(k(e.value)){r=e.value.slice();e.value.unshift(t)}else{r=e}g.push(r)});e.data=g}var y=this.defaultValueDimensions;var m=[{name:c,type:xb(p),ordinalMeta:r,otherDims:{tooltip:false,itemName:0},dimsDef:["base"]},{name:f,type:xb(v),dimsDef:y.slice()}];return n2(this,{coordDimensions:m,dimensionsCount:y.length+1,encodeDefaulter:_(kv,m,this)})};e.prototype.getBaseAxis=function(){var e=this._baseAxisDim;return this.ecModel.getComponent(e+"Axis",this.get(e+"AxisIndex")).axis};return e}();var ZN=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.defaultValueDimensions=[{name:"min",defaultTooltip:true},{name:"Q1",defaultTooltip:true},{name:"median",defaultTooltip:true},{name:"Q3",defaultTooltip:true},{name:"max",defaultTooltip:true}];e.visualDrawType="stroke";return e}r.type="series.boxplot";r.dependencies=["xAxis","yAxis","grid"];r.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:true,layout:null,boxWidth:[7,50],itemStyle:{color:"#fff",borderWidth:1},emphasis:{scale:true,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}},animationDuration:800};return r}(dy);oe(ZN,UN,true);var YN=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var n=e.getData();var a=this.group;var o=this._data;if(!this._data){a.removeAll()}var s=e.get("layout")==="horizontal"?1:0;n.diff(o).add(function(e){if(n.hasValue(e)){var t=n.getItemLayout(e);var r=JN(t,n,e,s,true);n.setItemGraphicEl(e,r);a.add(r)}}).update(function(e,t){var r=o.getItemGraphicEl(t);if(!n.hasValue(e)){a.remove(r);return}var i=n.getItemLayout(e);if(!r){r=JN(i,n,e,s)}else{KN(i,r,n,e)}a.add(r);n.setItemGraphicEl(e,r)}).remove(function(e){var t=o.getItemGraphicEl(e);t&&a.remove(t)}).execute();this._data=n};r.prototype.remove=function(e){var t=this.group;var r=this._data;this._data=null;r&&r.eachItemGraphicEl(function(e){e&&t.remove(e)})};r.type="boxplot";return r}(v);var XN=function(){function e(){}return e}();var qN=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="boxplotBoxPath";return t}e.prototype.getDefaultShape=function(){return new XN};e.prototype.buildPath=function(e,t){var r=t.points;var i=0;e.moveTo(r[i][0],r[i][1]);i++;for(;i<4;i++){e.lineTo(r[i][0],r[i][1])}e.closePath();for(;i<r.length;i++){e.moveTo(r[i][0],r[i][1]);i++;e.lineTo(r[i][0],r[i][1])}};return e}(m);function JN(e,t,r,i,n){var a=e.ends;var o=new qN({shape:{points:n?QN(a,i,e):a}});KN(e,o,t,r,n);return o}function KN(e,t,r,i,n){var a=r.hostModel;var o=vh[n?"initProps":"updateProps"];o(t,{shape:{points:e.ends}},a,i);t.useStyle(r.getItemVisual(i,"style"));t.style.strokeNoScale=true;t.z2=100;var s=r.getItemModel(i);ac(t,s);tc(t,s.get(["emphasis","focus"]),s.get(["emphasis","blurScope"]))}function QN(e,t,r){return A(e,function(e){e=e.slice();e[t]=r.initBaseline;return e})}function $N(e,t){}var eE=U;function tE(e){var t=rE(e);eE(t,function(r){var e=r.seriesModels;if(!e.length){return}iE(r);eE(e,function(e,t){nE(e,r.boxOffsetList[t],r.boxWidthList[t])})})}function rE(e){var i=[];var n=[];e.eachSeriesByType("boxplot",function(e){var t=e.getBaseAxis();var r=D(n,t);if(r<0){r=n.length;n[r]=t;i[r]={axis:t,seriesModels:[]}}i[r].seriesModels.push(e)});return i}function iE(e){var t;var r=e.axis;var i=e.seriesModels;var n=i.length;var a=e.boxWidthList=[];var o=e.boxOffsetList=[];var s=[];var l;if(r.type==="category"){l=r.getBandWidth()}else{var u=0;eE(i,function(e){u=Math.max(u,e.getData().count())});t=r.getExtent(),Math.abs(t[1]-t[0])/u}eE(i,function(e){var t=e.get("boxWidth");if(!k(t)){t=[t,t]}s.push([Y(t[0],l)||0,Y(t[1],l)||0])});var c=l*.8-2;var f=c/n*.3;var h=(c-f*(n-1))/n;var p=h/2-c/2;eE(i,function(e,t){o.push(p);p+=f+h;a.push(Math.min(Math.max(h,s[t][0]),s[t][1]))})}function nE(e,o,t){var s=e.coordinateSystem;var l=e.getData();var a=t/2;var u=e.get("layout")==="horizontal"?0:1;var c=1-u;var r=["x","y"];var i=l.mapDimension(r[u]);var n=l.mapDimensionsAll(r[c]);if(i==null||n.length<5){return}for(var f=0;f<l.count();f++){var h=l.get(i,f);var p=x(h,n[2],f);var v=x(h,n[0],f);var d=x(h,n[1],f);var g=x(h,n[3],f);var y=x(h,n[4],f);var m=[];_(m,d,false);_(m,g,true);m.push(v,d,y,g);b(m,v);b(m,y);b(m,p);l.setItemLayout(f,{initBaseline:p[c],ends:m})}function x(e,t,r){var i=l.get(t,r);var n=[];n[u]=e;n[c]=i;var a;if(isNaN(e)||isNaN(i)){a=[NaN,NaN]}else{a=s.dataToPoint(n);a[u]+=o}return a}function _(e,t,r){var i=t.slice();var n=t.slice();i[u]+=a;n[u]-=a;r?e.push(i,n):e.push(n,i)}function b(e,t){var r=t.slice();var i=t.slice();r[u]-=a;i[u]+=a;e.push(r,i)}}function aE(e,t){t=t||{};var r=[];var i=[];var n=t.boundIQR;var a=n==="none"||n===0;for(var o=0;o<e.length;o++){var s=Yn(e[o].slice());var l=sa(s,.25);var u=sa(s,.5);var c=sa(s,.75);var f=s[0];var h=s[s.length-1];var p=(n==null?1.5:n)*(c-l);var v=a?f:Math.max(f,l-p);var d=a?h:Math.min(h,c+p);var g=t.itemNameFormatter;var y=b(g)?g({value:o}):P(g)?g.replace("{value}",o+""):o+"";r.push([y,v,l,u,c,d]);for(var m=0;m<s.length;m++){var x=s[m];if(x<v||x>d){var _=[y,x];i.push(_)}}}return{boxData:r,outliers:i}}var oE={type:"echarts:boxplot",transform:function e(t){var r=t.upstream;if(r.sourceFormat!==bv){var i="";if("development"!=="production"){i=wa("source data is not applicable for this boxplot transform. Expect number[][].")}g(i)}var n=aE(r.getRawData(),t.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};function sE(e){e.registerSeriesModel(ZN);e.registerChartView(YN);e.registerVisual($N);e.registerLayout(tE);e.registerTransform(oE)}var lE=["color","borderColor"];var uE=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){this.group.removeClipPath();this._updateDrawMode(e);this._isLargeDraw?this._renderLarge(e):this._renderNormal(e)};r.prototype.incrementalPrepareRender=function(e,t,r){this._clear();this._updateDrawMode(e)};r.prototype.incrementalRender=function(e,t,r,i){this._isLargeDraw?this._incrementalRenderLarge(e,t):this._incrementalRenderNormal(e,t)};r.prototype._updateDrawMode=function(e){var t=e.pipelineContext.large;if(this._isLargeDraw==null||t!==this._isLargeDraw){this._isLargeDraw=t;this._clear()}};r.prototype._renderNormal=function(n){var a=n.getData();var o=this._data;var s=this.group;var l=a.getLayout("isSimpleBox");var u=n.get("clip",true);var e=n.coordinateSystem;var c=e.getArea&&e.getArea();if(!this._data){s.removeAll()}a.diff(o).add(function(e){if(a.hasValue(e)){var t=a.getItemLayout(e);if(u&&pE(c,t)){return}var r=hE(t,e,true);qf(r,{shape:{points:t.ends}},n,e);vE(r,a,e,l);s.add(r);a.setItemGraphicEl(e,r)}}).update(function(e,t){var r=o.getItemGraphicEl(t);if(!a.hasValue(e)){s.remove(r);return}var i=a.getItemLayout(e);if(u&&pE(c,i)){s.remove(r);return}if(!r){r=hE(i)}else{X(r,{shape:{points:i.ends}},n,e)}vE(r,a,e,l);s.add(r);a.setItemGraphicEl(e,r)}).remove(function(e){var t=o.getItemGraphicEl(e);t&&s.remove(t)}).execute();this._data=a};r.prototype._renderLarge=function(e){this._clear();mE(e,this.group);var t=e.get("clip",true)?qI(e.coordinateSystem,false,e):null;if(t){this.group.setClipPath(t)}else{this.group.removeClipPath()}};r.prototype._incrementalRenderNormal=function(e,t){var r=t.getData();var i=r.getLayout("isSimpleBox");var n;while((n=e.next())!=null){var a=r.getItemLayout(n);var o=hE(a);vE(o,r,n,i);o.incremental=true;this.group.add(o)}};r.prototype._incrementalRenderLarge=function(e,t){mE(t,this.group,true)};r.prototype.remove=function(e){this._clear()};r.prototype._clear=function(){this.group.removeAll();this._data=null};r.type="candlestick";return r}(v);var cE=function(){function e(){}return e}();var fE=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="normalCandlestickBox";return t}e.prototype.getDefaultShape=function(){return new cE};e.prototype.buildPath=function(e,t){var r=t.points;if(this.__simpleBox){e.moveTo(r[4][0],r[4][1]);e.lineTo(r[6][0],r[6][1])}else{e.moveTo(r[0][0],r[0][1]);e.lineTo(r[1][0],r[1][1]);e.lineTo(r[2][0],r[2][1]);e.lineTo(r[3][0],r[3][1]);e.closePath();e.moveTo(r[4][0],r[4][1]);e.lineTo(r[5][0],r[5][1]);e.moveTo(r[6][0],r[6][1]);e.lineTo(r[7][0],r[7][1])}};return e}(m);function hE(e,t,r){var i=e.ends;return new fE({shape:{points:r?dE(i,e):i},z2:100})}function pE(e,t){var r=true;for(var i=0;i<t.ends.length;i++){if(e.contain(t.ends[i][0],t.ends[i][1])){r=false;break}}return r}function vE(e,t,r,i){var n=t.getItemModel(r);e.useStyle(t.getItemVisual(r,"style"));e.style.strokeNoScale=true;e.__simpleBox=i;ac(e,n)}function dE(e,t){return A(e,function(e){e=e.slice();e[1]=t.initBaseline;return e})}var gE=function(){function e(){}return e}();var yE=function(r){d(e,r);function e(e){var t=r.call(this,e)||this;t.type="largeCandlestickBox";return t}e.prototype.getDefaultShape=function(){return new gE};e.prototype.buildPath=function(e,t){var r=t.points;for(var i=0;i<r.length;){if(this.__sign===r[i++]){var n=r[i++];e.moveTo(n,r[i++]);e.lineTo(n,r[i++])}else{i+=3}}};return e}(m);function mE(e,t,r){var i=e.getData();var n=i.getLayout("largePoints");var a=new yE({shape:{points:n},__sign:1});t.add(a);var o=new yE({shape:{points:n},__sign:-1});t.add(o);xE(1,a,e);xE(-1,o,e);if(r){a.incremental=true;o.incremental=true}}function xE(e,t,r,i){var n=r.get(["itemStyle",e>0?"borderColor":"borderColor0"])||r.get(["itemStyle",e>0?"color":"color0"]);var a=r.getModel("itemStyle").getItemStyle(lE);t.useStyle(a);t.style.fill=null;t.style.stroke=n}var _E=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.defaultValueDimensions=[{name:"open",defaultTooltip:true},{name:"close",defaultTooltip:true},{name:"lowest",defaultTooltip:true},{name:"highest",defaultTooltip:true}];return e}r.prototype.getShadowDim=function(){return"open"};r.prototype.brushSelector=function(e,t,r){var i=t.getItemLayout(e);return i&&r.rect(i.brushRect)};r.type="series.candlestick";r.dependencies=["xAxis","yAxis","grid"];r.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:true,layout:null,clip:true,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderWidth:1},emphasis:{scale:true,itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:true,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300};return r}(dy);oe(_E,UN,true);function bE(e){if(!e||!k(e.series)){return}U(e.series,function(e){if(O(e)&&e.type==="k"){e.type="candlestick"}})}var wE=["itemStyle","borderColor"];var SE=["itemStyle","borderColor0"];var ME=["itemStyle","color"];var IE=["itemStyle","color0"];var CE={seriesType:"candlestick",plan:Iy(),performRawSeries:true,reset:function(e,t){function s(e,t){return t.get(e>0?ME:IE)}function l(e,t){return t.get(e>0?wE:SE)}if(t.isSeriesFiltered(e)){return}var r=e.pipelineContext.large;return!r&&{progress:function(e,t){var r;while((r=e.next())!=null){var i=t.getItemModel(r);var n=t.getItemLayout(r).sign;var a=i.getItemStyle();a.fill=s(n,i);a.stroke=l(n,i)||a.fill;var o=t.ensureUniqueItemVisual(r,"style");F(o,a)}}}}};var TE=typeof Float32Array!=="undefined"?Float32Array:Array;var DE={seriesType:"candlestick",plan:Iy(),reset:function(e){var x=e.coordinateSystem;var t=e.getData();var _=LE(e,t);var b=0;var w=1;var r=["x","y"];var S=t.mapDimension(r[b]);var i=t.mapDimensionsAll(r[w]);var M=i[0];var I=i[1];var C=i[2];var T=i[3];t.setLayout({candleWidth:_,isSimpleBox:_<=1.3});if(S==null||i.length<4){return}return{progress:e.pipelineContext.large?a:n};function n(e,t){var r;while((r=e.next())!=null){var i=t.get(S,r);var n=t.get(M,r);var a=t.get(I,r);var o=t.get(C,r);var s=t.get(T,r);var l=Math.min(n,a);var u=Math.max(n,a);var c=d(l,i);var f=d(u,i);var h=d(o,i);var p=d(s,i);var v=[];g(v,f,0);g(v,c,1);v.push(m(p),m(f),m(h),m(c));t.setItemLayout(r,{sign:AE(t,r,n,a,I),initBaseline:n>a?f[w]:c[w],ends:v,brushRect:y(o,s,i)})}function d(e,t){var r=[];r[b]=t;r[w]=e;return isNaN(t)||isNaN(e)?[NaN,NaN]:x.dataToPoint(r)}function g(e,t,r){var i=t.slice();var n=t.slice();i[b]=Yf(i[b]+_/2,1,false);n[b]=Yf(n[b]-_/2,1,true);r?e.push(i,n):e.push(n,i)}function y(e,t,r){var i=d(e,r);var n=d(t,r);i[b]-=_/2;n[b]-=_/2;return{x:i[0],y:i[1],width:_,height:n[1]-i[1]}}function m(e){e[b]=Yf(e[b],1);return e}}function a(e,t){var r=new TE(e.count*4);var i=0;var n;var a=[];var o=[];var s;while((s=e.next())!=null){var l=t.get(S,s);var u=t.get(M,s);var c=t.get(I,s);var f=t.get(C,s);var h=t.get(T,s);if(isNaN(l)||isNaN(f)||isNaN(h)){r[i++]=NaN;i+=3;continue}r[i++]=AE(t,s,u,c,I);a[b]=l;a[w]=f;n=x.dataToPoint(a,null,o);r[i++]=n?n[0]:NaN;r[i++]=n?n[1]:NaN;a[w]=h;n=x.dataToPoint(a,null,o);r[i++]=n?n[1]:NaN}t.setLayout("largePoints",r)}}};function AE(e,t,r,i,n){var a;if(r>i){a=-1}else if(r<i){a=1}else{a=t>0?e.get(n,t-1)<=i?1:-1:1}return a}function LE(e,t){var r=e.getBaseAxis();var i;var n=r.type==="category"?r.getBandWidth():(i=r.getExtent(),Math.abs(i[1]-i[0])/t.count());var a=Y(N(e.get("barMaxWidth"),n),n);var o=Y(N(e.get("barMinWidth"),1),n);var s=e.get("barWidth");return s!=null?Y(s,n):Math.max(Math.min(n/2,a),o)}function kE(e){e.registerChartView(uE);e.registerSeriesModel(_E);e.registerPreprocessor(bE);e.registerVisual(CE);e.registerLayout(DE)}var PE=3;function OE(e){if(!k(e)){e=[+e,+e]}return e}function NE(e,t){var r=t.rippleEffectColor||t.color;e.eachChild(function(e){e.attr({z:t.z,zlevel:t.zlevel,style:{stroke:t.brushType==="stroke"?r:null,fill:t.brushType==="fill"?r:null}})})}var EE=function(a){d(e,a);function e(e,t){var r=a.call(this)||this;var i=new II(e,t);var n=new H;r.add(i);r.add(n);r.updateData(e,t);return r}e.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()};e.prototype.startEffectAnimation=function(e){var t=e.symbolType;var r=e.color;var i=this.childAt(1);for(var n=0;n<PE;n++){var a=S0(t,-1,-1,2,2,r);a.attr({style:{strokeNoScale:true},z2:99,silent:true,scaleX:.5,scaleY:.5});var o=-n/PE*e.period+e.effectOffset;a.animate("",true).when(e.period,{scaleX:e.rippleScale/2,scaleY:e.rippleScale/2}).delay(o).start();a.animateStyle(true).when(e.period,{opacity:0}).delay(o).start();i.add(a)}NE(i,e)};e.prototype.updateEffectAnimation=function(e){var t=this._effectCfg;var r=this.childAt(1);var i=["symbolType","period","rippleScale"];for(var n=0;n<i.length;n++){var a=i[n];if(t[a]!==e[a]){this.stopEffectAnimation();this.startEffectAnimation(e);return}}NE(r,e)};e.prototype.highlight=function(){Bu(this)};e.prototype.downplay=function(){Vu(this)};e.prototype.updateData=function(e,t){var r=this;var i=e.hostModel;this.childAt(0).updateData(e,t);var n=this.childAt(1);var a=e.getItemModel(t);var o=e.getItemVisual(t,"symbol");var s=OE(e.getItemVisual(t,"symbolSize"));var l=e.getItemVisual(t,"style");var u=l&&l.fill;n.setScale(s);n.traverse(function(e){e.setStyle("fill",u)});var c=e.getItemVisual(t,"symbolOffset");if(c){if(!k(c)){c=[c,c]}n.x=Y(c[0],s[0]);n.y=Y(N(c[1],c[0])||0,s[1])}var f=e.getItemVisual(t,"symbolRotate");n.rotation=(f||0)*Math.PI/180||0;var h={};h.showEffectOn=i.get("showEffectOn");h.rippleScale=a.get(["rippleEffect","scale"]);h.brushType=a.get(["rippleEffect","brushType"]);h.period=a.get(["rippleEffect","period"])*1e3;h.effectOffset=t/e.count();h.z=i.getShallow("z")||0;h.zlevel=i.getShallow("zlevel")||0;h.symbolType=o;h.color=u;h.rippleEffectColor=a.get(["rippleEffect","color"]);this.off("mouseover").off("mouseout").off("emphasis").off("normal");if(h.showEffectOn==="render"){this._effectCfg?this.updateEffectAnimation(h):this.startEffectAnimation(h);this._effectCfg=h}else{this._effectCfg=null;this.stopEffectAnimation();this.onHoverStateChange=function(e){if(e==="emphasis"){if(h.showEffectOn!=="render"){r.startEffectAnimation(h)}}else if(e==="normal"){if(h.showEffectOn!=="render"){r.stopEffectAnimation()}}}}this._effectCfg=h;tc(this)};e.prototype.fadeOut=function(e){this.off("mouseover").off("mouseout");e&&e()};return e}(H);var RE=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(){this._symbolDraw=new LI(EE)};r.prototype.render=function(e,t,r){var i=e.getData();var n=this._symbolDraw;n.updateData(i,{clipShape:this._getClipShape(e)});this.group.add(n.group)};r.prototype._getClipShape=function(e){var t=e.coordinateSystem;var r=t&&t.getArea&&t.getArea();return e.get("clip",true)?r:null};r.prototype.updateTransform=function(e,t,r){var i=e.getData();this.group.dirty();var n=pC("").reset(e,t,r);if(n.progress){n.progress({start:0,end:i.count(),count:i.count()},i)}this._symbolDraw.updateLayout()};r.prototype._updateGroupTransform=function(e){var t=e.coordinateSystem;if(t&&t.getRoamTransform){this.group.transform=Gi(t.getRoamTransform());this.group.decomposeTransform()}};r.prototype.remove=function(e,t){this._symbolDraw&&this._symbolDraw.remove(true)};r.type="effectScatter";return r}(v);var zE=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.hasSymbolVisual=true;return e}r.prototype.getInitialData=function(e,t){return sw(this.getSource(),this,{useEncodeDefaulter:true})};r.prototype.brushSelector=function(e,t,r){return r.point(t.getItemLayout(e))};r.type="series.effectScatter";r.dependencies=["grid","polar"];r.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:true,effectType:"ripple",progressive:0,showEffectOn:"render",clip:true,rippleEffect:{period:4,scale:2.5,brushType:"fill"},symbolSize:10};return r}(dy);function BE(e){e.registerChartView(RE);e.registerSeriesModel(zE);e.registerLayout(pC("effectScatter"))}var VE=function(n){d(e,n);function e(e,t,r){var i=n.call(this)||this;i.add(i.createLine(e,t,r));i._updateEffectSymbol(e,t);return i}e.prototype.createLine=function(e,t,r){return new Ok(e,t,r)};e.prototype._updateEffectSymbol=function(e,t){var r=e.getItemModel(t);var i=r.getModel("effect");var n=i.get("symbolSize");var a=i.get("symbol");if(!k(n)){n=[n,n]}var o=e.getItemVisual(t,"style");var s=i.get("color")||o&&o.stroke;var l=this.childAt(1);if(this._symbolType!==a){this.remove(l);l=S0(a,-.5,-.5,1,1,s);l.z2=100;l.culling=true;this.add(l)}if(!l){return}l.setStyle("shadowColor",s);l.setStyle(i.getItemStyle(["color"]));l.scaleX=n[0];l.scaleY=n[1];l.setColor(s);this._symbolType=a;this._symbolScale=n;this._updateEffectAnimation(e,i,t)};e.prototype._updateEffectAnimation=function(t,e,r){var i=this.childAt(1);if(!i){return}var n=this;var a=t.getItemLayout(r);var o=e.get("period")*1e3;var s=e.get("loop");var l=e.get("constantSpeed");var u=be(e.get("delay"),function(e){return e/t.count()*o/3});i.ignore=true;this._updateAnimationPoints(i,a);if(l>0){o=this._getLineLength(i)/l*1e3}if(o!==this._period||s!==this._loop){i.stopAnimation();if(o>0){var c=void 0;if(typeof u==="function"){c=u(r)}else{c=u}if(i.__t>0){c=-o*i.__t}i.__t=0;var f=i.animate("",s).when(o,{__t:1}).delay(c).during(function(){n._updateSymbolPosition(i)});if(!s){f.done(function(){n.remove(i)})}f.start()}}this._period=o;this._loop=s};e.prototype._getLineLength=function(e){return Ke(e.__p1,e.__cp1)+Ke(e.__cp1,e.__p2)};e.prototype._updateAnimationPoints=function(e,t){e.__p1=t[0];e.__p2=t[1];e.__cp1=t[2]||[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]};e.prototype.updateData=function(e,t,r){this.childAt(0).updateData(e,t,r);this._updateEffectSymbol(e,t)};e.prototype._updateSymbolPosition=function(e){var t=e.__p1;var r=e.__p2;var i=e.__cp1;var n=e.__t;var a=[e.x,e.y];var o=a.slice();var s=xs;var l=_s;a[0]=s(t[0],i[0],r[0],n);a[1]=s(t[1],i[1],r[1],n);var u=l(t[0],i[0],r[0],n);var c=l(t[1],i[1],r[1],n);e.rotation=-Math.atan2(c,u)-Math.PI/2;if(this._symbolType==="line"||this._symbolType==="rect"||this._symbolType==="roundRect"){if(e.__lastT!==undefined&&e.__lastT<e.__t){e.scaleY=Ke(o,a)*1.05;if(n===1){a[0]=o[0]+(a[0]-o[0])/2;a[1]=o[1]+(a[1]-o[1])/2}}else if(e.__lastT===1){e.scaleY=2*Ke(t,a)}else{e.scaleY=this._symbolScale[1]}}e.__lastT=e.__t;e.ignore=false;e.x=a[0];e.y=a[1]};e.prototype.updateLayout=function(e,t){this.childAt(0).updateLayout(e,t);var r=e.getItemModel(t).getModel("effect");this._updateEffectAnimation(e,r,t)};return e}(H);var GE=function(n){d(e,n);function e(e,t,r){var i=n.call(this)||this;i._createPolyline(e,t,r);return i}e.prototype._createPolyline=function(e,t,r){var i=e.getItemLayout(t);var n=new ff({shape:{points:i}});this.add(n);this._updateCommonStl(e,t,r)};e.prototype.updateData=function(e,t,r){var i=e.hostModel;var n=this.childAt(0);var a={shape:{points:e.getItemLayout(t)}};X(n,a,i,t);this._updateCommonStl(e,t,r)};e.prototype._updateCommonStl=function(e,t,r){var i=this.childAt(0);var n=e.getItemModel(t);var a=r&&r.emphasisLineStyle;if(!r||e.hasItemOption){a=n.getModel(["emphasis","lineStyle"]).getLineStyle()}i.useStyle(e.getItemVisual(t,"style"));i.style.fill=null;i.style.strokeNoScale=true;var o=i.ensureState("emphasis");o.style=a;tc(this)};e.prototype.updateLayout=function(e,t){var r=this.childAt(0);r.setShape("points",e.getItemLayout(t))};return e}(H);var FE=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e._lastFrame=0;e._lastFramePercent=0;return e}e.prototype.createLine=function(e,t,r){return new GE(e,t,r)};e.prototype._updateAnimationPoints=function(e,t){this._points=t;var r=[0];var i=0;for(var n=1;n<t.length;n++){var a=t[n-1];var o=t[n];i+=Ke(a,o);r.push(i)}if(i===0){this._length=0;return}for(var n=0;n<r.length;n++){r[n]/=i}this._offsets=r;this._length=i};e.prototype._getLineLength=function(){return this._length};e.prototype._updateSymbolPosition=function(e){var t=e.__t;var r=this._points;var i=this._offsets;var n=r.length;if(!i){return}var a=this._lastFrame;var o;if(t<this._lastFramePercent){var s=Math.min(a+1,n-1);for(o=s;o>=0;o--){if(i[o]<=t){break}}o=Math.min(o,n-2)}else{for(o=a;o<n;o++){if(i[o]>t){break}}o=Math.min(o-1,n-2)}var l=(t-i[o])/(i[o+1]-i[o]);var u=r[o];var c=r[o+1];e.x=u[0]*(1-l)+l*c[0];e.y=u[1]*(1-l)+l*c[1];var f=c[0]-u[0];var h=c[1]-u[1];e.rotation=-Math.atan2(h,f)-Math.PI/2;this._lastFrame=o;this._lastFramePercent=t;e.ignore=false};return e}(VE);var HE=function(){function e(){this.polyline=false;this.curveness=0;this.segs=[]}return e}();var WE=function(t){d(e,t);function e(e){return t.call(this,e)||this}e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}};e.prototype.getDefaultShape=function(){return new HE};e.prototype.buildPath=function(e,t){var r=t.segs;var i=t.curveness;if(t.polyline){for(var n=0;n<r.length;){var a=r[n++];if(a>0){e.moveTo(r[n++],r[n++]);for(var o=1;o<a;o++){e.lineTo(r[n++],r[n++])}}}}else{for(var n=0;n<r.length;){var s=r[n++];var l=r[n++];var u=r[n++];var c=r[n++];e.moveTo(s,l);if(i>0){var f=(s+u)/2-(l-c)*i;var h=(l+c)/2-(u-s)*i;e.quadraticCurveTo(f,h,u,c)}else{e.lineTo(u,c)}}}};e.prototype.findDataIndex=function(e,t){var r=this.shape;var i=r.segs;var n=r.curveness;var a=this.style.lineWidth;if(r.polyline){var o=0;for(var s=0;s<i.length;){var l=i[s++];if(l>0){var u=i[s++];var c=i[s++];for(var f=1;f<l;f++){var h=i[s++];var p=i[s++];if(sl(u,c,h,p,a,e,t)){return o}}}o++}}else{var o=0;for(var s=0;s<i.length;){var u=i[s++];var c=i[s++];var h=i[s++];var p=i[s++];if(n>0){var v=(u+h)/2-(c-p)*n;var d=(c+p)/2-(h-u)*n;if(ul(u,c,v,d,h,p,a,e,t)){return o}}else{if(sl(u,c,h,p,a,e,t)){return o}}o++}}return-1};return e}(m);var jE=function(){function e(){this.group=new H}e.prototype.isPersistent=function(){return!this._incremental};e.prototype.updateData=function(e){this.group.removeAll();var t=new WE({rectHover:true,cursor:"default"});t.setShape({segs:e.getLayout("linesPoints")});this._setCommon(t,e);this.group.add(t);this._incremental=null};e.prototype.incrementalPrepareUpdate=function(e){this.group.removeAll();this._clearIncremental();if(e.count()>5e5){if(!this._incremental){this._incremental=new kf({silent:true})}this.group.add(this._incremental)}else{this._incremental=null}};e.prototype.incrementalUpdate=function(e,t){var r=new WE;r.setShape({segs:t.getLayout("linesPoints")});this._setCommon(r,t,!!this._incremental);if(!this._incremental){r.rectHover=true;r.cursor="default";r.__startIndex=e.start;this.group.add(r)}else{this._incremental.addDisplayable(r,true)}};e.prototype.remove=function(){this._clearIncremental();this._incremental=null;this.group.removeAll()};e.prototype._setCommon=function(r,e,t){var i=e.hostModel;r.setShape({polyline:i.get("polyline"),curveness:i.get(["lineStyle","curveness"])});r.useStyle(i.getModel("lineStyle").getLineStyle());r.style.strokeNoScale=true;var n=e.getVisual("style");if(n&&n.stroke){r.setStyle("stroke",n.stroke)}r.setStyle("fill",null);if(!t){var a=j(r);a.seriesIndex=i.seriesIndex;r.on("mousemove",function(e){a.dataIndex=null;var t=r.findDataIndex(e.offsetX,e.offsetY);if(t>0){a.dataIndex=t+r.__startIndex}})}};e.prototype._clearIncremental=function(){var e=this._incremental;if(e){e.clearDisplaybles()}};return e}();var UE={seriesType:"lines",plan:Iy(),reset:function(d){var g=d.coordinateSystem;var y=d.get("polyline");var m=d.pipelineContext.large;return{progress:function(e,t){var r=[];if(m){var i=void 0;var n=e.end-e.start;if(y){var a=0;for(var o=e.start;o<e.end;o++){a+=d.getLineCoordsCount(o)}i=new Float32Array(n+a*2)}else{i=new Float32Array(n*4)}var s=0;var l=[];for(var o=e.start;o<e.end;o++){var u=d.getLineCoords(o,r);if(y){i[s++]=u}for(var c=0;c<u;c++){l=g.dataToPoint(r[c],false,l);i[s++]=l[0];i[s++]=l[1]}}t.setLayout("linesPoints",i)}else{for(var o=e.start;o<e.end;o++){var f=t.getItemModel(o);var u=d.getLineCoords(o,r);var h=[];if(y){for(var p=0;p<u;p++){h.push(g.dataToPoint(r[p]))}}else{h[0]=g.dataToPoint(r[0]);h[1]=g.dataToPoint(r[1]);var v=f.get(["lineStyle","curveness"]);if(+v){h[2]=[(h[0][0]+h[1][0])/2-(h[0][1]-h[1][1])*v,(h[0][1]+h[1][1])/2-(h[1][0]-h[0][0])*v]}}t.setItemLayout(o,h)}}}}}};var ZE=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(t,e,r){var i=t.getData();var n=this._updateLineDraw(i,t);var a=t.get("zlevel");var o=t.get(["effect","trailLength"]);var s=r.getZr();var l=s.painter.getType()==="svg";if(!l){s.painter.getLayer(a).clear(true)}if(this._lastZlevel!=null&&!l){s.configLayer(this._lastZlevel,{motionBlur:false})}if(this._showEffect(t)&&o){if("development"!=="production"){var u=false;e.eachSeries(function(e){if(e!==t&&e.get("zlevel")===a){u=true}});u&&console.warn("Lines with trail effect should have an individual zlevel")}if(!l){s.configLayer(a,{motionBlur:true,lastFrameAlpha:Math.max(Math.min(o/10+.9,1),0)})}}n.updateData(i);var c=t.get("clip",true)&&qI(t.coordinateSystem,false,t);if(c){this.group.setClipPath(c)}else{this.group.removeClipPath()}this._lastZlevel=a;this._finished=true};r.prototype.incrementalPrepareRender=function(e,t,r){var i=e.getData();var n=this._updateLineDraw(i,e);n.incrementalPrepareUpdate(i);this._clearLayer(r);this._finished=false};r.prototype.incrementalRender=function(e,t,r){this._lineDraw.incrementalUpdate(e,t.getData());this._finished=e.end===t.getData().count()};r.prototype.updateTransform=function(e,t,r){var i=e.getData();var n=e.pipelineContext;if(!this._finished||n.large||n.progressiveRender){return{update:true}}else{var a=UE.reset(e,t,r);if(a.progress){a.progress({start:0,end:i.count(),count:i.count()},i)}this._lineDraw.updateLayout();this._clearLayer(r)}};r.prototype._updateLineDraw=function(e,t){var r=this._lineDraw;var i=this._showEffect(t);var n=!!t.get("polyline");var a=t.pipelineContext;var o=a.large;if("development"!=="production"){if(i&&o){console.warn("Large lines not support effect")}}if(!r||i!==this._hasEffet||n!==this._isPolyline||o!==this._isLargeDraw){if(r){r.remove()}r=this._lineDraw=o?new jE:new Nk(n?i?FE:GE:i?VE:Ok);this._hasEffet=i;this._isPolyline=n;this._isLargeDraw=o;this.group.removeAll()}this.group.add(r.group);return r};r.prototype._showEffect=function(e){return!!e.get(["effect","show"])};r.prototype._clearLayer=function(e){var t=e.getZr();var r=t.painter.getType()==="svg";if(!r&&this._lastZlevel!=null){t.painter.getLayer(this._lastZlevel).clear(true)}};r.prototype.remove=function(e,t){this._lineDraw&&this._lineDraw.remove();this._lineDraw=null;this._clearLayer(t)};r.type="lines";return r}(v);var YE=typeof Uint32Array==="undefined"?Array:Uint32Array;var XE=typeof Float64Array==="undefined"?Array:Float64Array;function qE(e){var t=e.data;if(t&&t[0]&&t[0][0]&&t[0][0].coord){if("development"!=="production"){console.warn("Lines data configuration has been changed to"+" { coords:[[1,2],[2,3]] }")}e.data=A(t,function(e){var t=[e[0].coord,e[1].coord];var r={coords:t};if(e[0].name){r.fromName=e[0].name}if(e[1].name){r.toName=e[1].name}return ie([r,e[0],e[1]])})}}var JE=function(r){d(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;e.type=t.type;e.visualStyleAccessPath="lineStyle";e.visualDrawType="stroke";return e}t.prototype.init=function(e){e.data=e.data||[];qE(e);var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;if(t.flatCoords){e.data=new Float32Array(t.count)}r.prototype.init.apply(this,arguments)};t.prototype.mergeOption=function(e){qE(e);if(e.data){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;if(t.flatCoords){e.data=new Float32Array(t.count)}}r.prototype.mergeOption.apply(this,arguments)};t.prototype.appendData=function(e){var t=this._processFlatCoordsArray(e.data);if(t.flatCoords){if(!this._flatCoords){this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset}else{this._flatCoords=Le(this._flatCoords,t.flatCoords);this._flatCoordsOffset=Le(this._flatCoordsOffset,t.flatCoordsOffset)}e.data=new Float32Array(t.count)}this.getRawData().appendData(e.data)};t.prototype._getCoordsFromItemModel=function(e){var t=this.getData().getItemModel(e);var r=t.option instanceof Array?t.option:t.getShallow("coords");if("development"!=="production"){if(!(r instanceof Array&&r.length>0&&r[0]instanceof Array)){throw new Error("Invalid coords "+JSON.stringify(r)+". Lines must have 2d coords array in data item.")}}return r};t.prototype.getLineCoordsCount=function(e){if(this._flatCoordsOffset){return this._flatCoordsOffset[e*2+1]}else{return this._getCoordsFromItemModel(e).length}};t.prototype.getLineCoords=function(e,t){if(this._flatCoordsOffset){var r=this._flatCoordsOffset[e*2];var i=this._flatCoordsOffset[e*2+1];for(var n=0;n<i;n++){t[n]=t[n]||[];t[n][0]=this._flatCoords[r+n*2];t[n][1]=this._flatCoords[r+n*2+1]}return i}else{var a=this._getCoordsFromItemModel(e);for(var n=0;n<a.length;n++){t[n]=t[n]||[];t[n][0]=a[n][0];t[n][1]=a[n][1]}return a.length}};t.prototype._processFlatCoordsArray=function(e){var t=0;if(this._flatCoords){t=this._flatCoords.length}if(typeof e[0]==="number"){var r=e.length;var i=new YE(r);var n=new XE(r);var a=0;var o=0;var s=0;for(var l=0;l<r;){s++;var u=e[l++];i[o++]=a+t;i[o++]=u;for(var c=0;c<u;c++){var f=e[l++];var h=e[l++];n[a++]=f;n[a++]=h;if(l>r){if("development"!=="production"){throw new Error("Invalid data format.")}}}}return{flatCoordsOffset:new Uint32Array(i.buffer,0,o),flatCoords:n,count:s}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}};t.prototype.getInitialData=function(e,t){if("development"!=="production"){var r=fd.get(e.coordinateSystem);if(!r){throw new Error("Unkown coordinate system "+e.coordinateSystem)}}var a=new qb(["value"],this);a.hasItemOption=false;a.initData(e.data,[],function(e,t,r,i){if(e instanceof Array){return NaN}else{a.hasItemOption=true;var n=e.value;if(n!=null){return n instanceof Array?n[i]:n}}});return a};t.prototype.formatTooltip=function(e,t,r){var i=this.getData();var n=i.getItemModel(e);var a=n.get("name");if(a){return a}var o=n.get("fromName");var s=n.get("toName");var l=[];o!=null&&l.push(o);s!=null&&l.push(s);return Kg("nameValue",{name:l.join(" > ")})};t.prototype.preventIncremental=function(){return!!this.get(["effect","show"])};t.prototype.getProgressive=function(){var e=this.option.progressive;if(e==null){return this.option.large?1e4:this.get("progressive")}return e};t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;if(e==null){return this.option.large?2e4:this.get("progressiveThreshold")}return e};t.type="series.lines";t.dependencies=["grid","polar","geo","calendar"];t.defaultOption={coordinateSystem:"geo",zlevel:0,z:2,legendHoverLink:true,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:false,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:true,trailLength:.2},large:false,largeThreshold:2e3,polyline:false,clip:true,label:{show:false,position:"end"},lineStyle:{opacity:.5}};return t}(dy);function KE(e){if(!(e instanceof Array)){e=[e,e]}return e}var QE={seriesType:"lines",reset:function(e){var t=KE(e.get("symbol"));var r=KE(e.get("symbolSize"));var i=e.getData();i.setVisual("fromSymbol",t&&t[0]);i.setVisual("toSymbol",t&&t[1]);i.setVisual("fromSymbolSize",r&&r[0]);i.setVisual("toSymbolSize",r&&r[1]);function n(e,t){var r=e.getItemModel(t);var i=KE(r.getShallow("symbol",true));var n=KE(r.getShallow("symbolSize",true));i[0]&&e.setItemVisual(t,"fromSymbol",i[0]);i[1]&&e.setItemVisual(t,"toSymbol",i[1]);n[0]&&e.setItemVisual(t,"fromSymbolSize",n[0]);n[1]&&e.setItemVisual(t,"toSymbolSize",n[1])}return{dataEach:i.hasItemOption?n:null}}};function $E(e){e.registerChartView(ZE);e.registerSeriesModel(JE);e.registerLayout(UE);e.registerVisual(QE)}var eR=256;var tR=function(){function e(){this.blurSize=30;this.pointSize=20;this.maxOpacity=1;this.minOpacity=0;this._gradientPixels={inRange:null,outOfRange:null};var e=ne();this.canvas=e}e.prototype.update=function(e,t,r,i,n,a){var o=this._getBrush();var s=this._getGradient(n,"inRange");var l=this._getGradient(n,"outOfRange");var u=this.pointSize+this.blurSize;var c=this.canvas;var f=c.getContext("2d");var h=e.length;c.width=t;c.height=r;for(var p=0;p<h;++p){var v=e[p];var d=v[0];var g=v[1];var y=v[2];var m=i(y);f.globalAlpha=m;f.drawImage(o,d-u,g-u)}if(!c.width||!c.height){return c}var x=f.getImageData(0,0,c.width,c.height);var _=x.data;var b=0;var w=_.length;var S=this.minOpacity;var M=this.maxOpacity;var I=M-S;while(b<w){var m=_[b+3]/256;var C=Math.floor(m*(eR-1))*4;if(m>0){var T=a(m)?s:l;m>0&&(m=m*I+S);_[b++]=T[C];_[b++]=T[C+1];_[b++]=T[C+2];_[b++]=T[C+3]*m*256}else{b+=4}}f.putImageData(x,0,0);return c};e.prototype._getBrush=function(){var e=this._brushCanvas||(this._brushCanvas=ne());var t=this.pointSize+this.blurSize;var r=t*2;e.width=r;e.height=r;var i=e.getContext("2d");i.clearRect(0,0,r,r);i.shadowOffsetX=r;i.shadowBlur=this.blurSize;i.shadowColor="#000";i.beginPath();i.arc(-t,t,this.pointSize,0,Math.PI*2,true);i.closePath();i.fill();return e};e.prototype._getGradient=function(e,t){var r=this._gradientPixels;var i=r[t]||(r[t]=new Uint8ClampedArray(256*4));var n=[0,0,0,0];var a=0;for(var o=0;o<256;o++){e[t](o/255,true,n);i[a++]=n[0];i[a++]=n[1];i[a++]=n[2];i[a++]=n[3]}return i};return e}();function rR(t,i,n){var r=t[1]-t[0];i=A(i,function(e){return{interval:[(e.interval[0]-t[0])/r,(e.interval[1]-t[0])/r]}});var a=i.length;var o=0;return function(e){var t;for(t=o;t<a;t++){var r=i[t].interval;if(r[0]<=e&&e<=r[1]){o=t;break}}if(t===a){for(t=o-1;t>=0;t--){var r=i[t].interval;if(r[0]<=e&&e<=r[1]){o=t;break}}}return t>=0&&t<a&&n[t]}}function iR(e,t){var r=e[1]-e[0];t=[(t[0]-e[0])/r,(t[1]-e[0])/r];return function(e){return e>=t[0]&&e<=t[1]}}function nR(e){var t=e.dimensions;return t[0]==="lng"&&t[1]==="lat"}var aR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(r,e,t){var i;e.eachComponent("visualMap",function(t){t.eachTargetSeries(function(e){if(e===r){i=t}})});if("development"!=="production"){if(!i){throw new Error("Heatmap must use with visualMap")}}this.group.removeAll();this._incrementalDisplayable=null;var n=r.coordinateSystem;if(n.type==="cartesian2d"||n.type==="calendar"){this._renderOnCartesianAndCalendar(r,t,0,r.getData().count())}else if(nR(n)){this._renderOnGeo(n,r,i,t)}};r.prototype.incrementalPrepareRender=function(e,t,r){this.group.removeAll()};r.prototype.incrementalRender=function(e,t,r,i){var n=t.coordinateSystem;if(n){if(nR(n)){this.render(t,r,i)}else{this._renderOnCartesianAndCalendar(t,i,e.start,e.end,true)}}};r.prototype._renderOnCartesianAndCalendar=function(e,t,r,i,n){var a=e.coordinateSystem;var o;var s;var l;var u;if(JI(a,"cartesian2d")){var c=a.getAxis("x");var f=a.getAxis("y");if("development"!=="production"){if(!(c.type==="category"&&f.type==="category")){throw new Error("Heatmap on cartesian must have two category axes")}if(!(c.onBand&&f.onBand)){throw new Error("Heatmap on cartesian must have two axes with boundaryGap true")}}o=c.getBandWidth();s=f.getBandWidth();l=c.scale.getExtent();u=f.scale.getExtent()}var h=this.group;var p=e.getData();var v=e.getModel(["emphasis","itemStyle"]).getItemStyle();var d=e.getModel(["blur","itemStyle"]).getItemStyle();var g=e.getModel(["select","itemStyle"]).getItemStyle();var y=xh(e);var m=e.get(["emphasis","focus"]);var x=e.get(["emphasis","blurScope"]);var _=JI(a,"cartesian2d")?[p.mapDimension("x"),p.mapDimension("y"),p.mapDimension("value")]:[p.mapDimension("time"),p.mapDimension("value")];for(var b=r;b<i;b++){var w=void 0;var S=p.getItemVisual(b,"style");if(JI(a,"cartesian2d")){var M=p.get(_[0],b);var I=p.get(_[1],b);if(isNaN(p.get(_[2],b))||M<l[0]||M>l[1]||I<u[0]||I>u[1]){continue}var C=a.dataToPoint([M,I]);w=new G({shape:{x:Math.floor(Math.round(C[0])-o/2),y:Math.floor(Math.round(C[1])-s/2),width:Math.ceil(o),height:Math.ceil(s)},style:S})}else{if(isNaN(p.get(_[1],b))){continue}w=new G({z2:1,shape:a.dataToRect([p.get(_[0],b)]).contentShape,style:S})}var T=p.getItemModel(b);if(p.hasItemOption){var D=T.getModel("emphasis");v=D.getModel("itemStyle").getItemStyle();d=T.getModel(["blur","itemStyle"]).getItemStyle();g=T.getModel(["select","itemStyle"]).getItemStyle();m=D.get("focus");x=D.get("blurScope");y=xh(T)}var A=e.getRawValue(b);var L="-";if(A&&A[2]!=null){L=A[2]+""}mh(w,y,{labelFetcher:e,labelDataIndex:b,defaultOpacity:S.opacity,defaultText:L});w.ensureState("emphasis").style=v;w.ensureState("blur").style=d;w.ensureState("select").style=g;tc(w,m,x);w.incremental=n;if(n){w.states.emphasis.hoverLayer=true}h.add(w);p.setItemGraphicEl(b,w)}};r.prototype._renderOnGeo=function(n,e,t,r){var i=t.targetVisuals.inRange;var a=t.targetVisuals.outOfRange;var o=e.getData();var s=this._hmLayer||this._hmLayer||new tR;s.blurSize=e.get("blurSize");s.pointSize=e.get("pointSize");s.minOpacity=e.get("minOpacity");s.maxOpacity=e.get("maxOpacity");var l=n.getViewRect().clone();var u=n.getRoamTransform();l.applyTransform(u);var c=Math.max(l.x,0);var f=Math.max(l.y,0);var h=Math.min(l.width+l.x,r.getWidth());var p=Math.min(l.height+l.y,r.getHeight());var v=h-c;var d=p-f;var g=[o.mapDimension("lng"),o.mapDimension("lat"),o.mapDimension("value")];var y=o.mapArray(g,function(e,t,r){var i=n.dataToPoint([e,t]);i[0]-=c;i[1]-=f;i.push(r);return i});var m=t.getExtent();var x=t.type==="visualMap.continuous"?iR(m,t.option.range):rR(m,t.getPieceList(),t.option.selected);s.update(y,v,d,i.color.getNormalizer(),{inRange:i.color.getColorMapper(),outOfRange:a.color.getColorMapper()},x);var _=new Rl({style:{width:v,height:d,x:c,y:f,image:s.canvas},silent:true});this.group.add(_)};r.type="heatmap";return r}(v);var oR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.getInitialData=function(e,t){return sw(this.getSource(),this,{generateCoord:"value"})};r.prototype.preventIncremental=function(){var e=fd.get(this.get("coordinateSystem"));if(e&&e.dimensions){return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"}};r.type="series.heatmap";r.dependencies=["grid","geo","calendar"];r.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}};return r}(dy);function sR(e){e.registerChartView(aR);e.registerSeriesModel(oR)}var lR=["itemStyle","borderWidth"];var uR=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}];var cR=new Rc;var fR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var o=this.group;var s=e.getData();var l=this._data;var i=e.coordinateSystem;var n=i.getBaseAxis();var a=n.isHorizontal();var u=i.master.getRect();var c={ecSize:{width:r.getWidth(),height:r.getHeight()},seriesModel:e,coordSys:i,coordSysExtent:[[u.x,u.x+u.width],[u.y,u.y+u.height]],isHorizontal:a,valueDim:uR[+a],categoryDim:uR[1-+a]};s.diff(l).add(function(e){if(!s.hasValue(e)){return}var t=SR(s,e);var r=hR(s,e,t,c);var i=CR(s,c,r);s.setItemGraphicEl(e,i);o.add(i);PR(i,c,r)}).update(function(e,t){var r=l.getItemGraphicEl(t);if(!s.hasValue(e)){o.remove(r);return}var i=SR(s,e);var n=hR(s,e,i,c);var a=AR(s,n);if(r&&a!==r.__pictorialShapeStr){o.remove(r);s.setItemGraphicEl(e,null);r=null}if(r){TR(r,c,n)}else{r=CR(s,c,n,true)}s.setItemGraphicEl(e,r);r.__pictorialSymbolMeta=n;o.add(r);PR(r,c,n)}).remove(function(e){var t=l.getItemGraphicEl(e);t&&DR(l,e,t.__pictorialSymbolMeta.animationModel,t)}).execute();this._data=s;return this.group};r.prototype.remove=function(t,e){var r=this.group;var i=this._data;if(t.get("animation")){if(i){i.eachItemGraphicEl(function(e){DR(i,j(e).dataIndex,t,e)})}}else{r.removeAll()}};r.type="pictorialBar";return r}(v);function hR(e,t,r,i){var n=e.getItemLayout(t);var a=r.get("symbolRepeat");var o=r.get("symbolClip");var s=r.get("symbolPosition")||"start";var l=r.get("symbolRotate");var u=(l||0)*Math.PI/180||0;var c=r.get("symbolPatternSize")||2;var f=r.isAnimationEnabled();var h={dataIndex:t,layout:n,itemModel:r,symbolType:e.getItemVisual(t,"symbol")||"circle",style:e.getItemVisual(t,"style"),symbolClip:o,symbolRepeat:a,symbolRepeatDirection:r.get("symbolRepeatDirection"),symbolPatternSize:c,rotation:u,animationModel:f?r:null,hoverScale:f&&r.get(["emphasis","scale"]),z2:r.getShallow("z",true)||0};pR(r,a,n,i,h);dR(e,t,n,a,o,h.boundingLength,h.pxSign,c,i,h);gR(r,h.symbolScale,u,i,h);var p=h.symbolSize;var v=r.get("symbolOffset");if(k(v)){v=[Y(v[0],p[0]),Y(v[1],p[1])]}yR(r,p,n,a,o,v,s,h.valueLineWidth,h.boundingLength,h.repeatCutLength,i,h);return h}function pR(e,t,r,i,n){var a=i.valueDim;var o=e.get("symbolBoundingData");var s=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis());var l=s.toGlobalCoord(s.dataToCoord(0));var u=1-+(r[a.wh]<=0);var c;if(k(o)){var f=[vR(s,o[0])-l,vR(s,o[1])-l];f[1]<f[0]&&f.reverse();c=f[u]}else if(o!=null){c=vR(s,o)-l}else if(t){c=i.coordSysExtent[a.index][u]-l}else{c=r[a.wh]}n.boundingLength=c;if(t){n.repeatCutLength=r[a.wh]}n.pxSign=c>0?1:c<0?-1:0}function vR(e,t){return e.toGlobalCoord(e.dataToCoord(e.scale.parse(t)))}function dR(e,t,r,i,n,a,o,s,l,u){var c=l.valueDim;var f=l.categoryDim;var h=Math.abs(r[f.wh]);var p=e.getItemVisual(t,"symbolSize");var v;if(k(p)){v=p.slice()}else{if(p==null){v=["100%","100%"]}else{v=[p,p]}}v[f.index]=Y(v[f.index],h);v[c.index]=Y(v[c.index],i?h:Math.abs(a));u.symbolSize=v;var d=u.symbolScale=[v[0]/s,v[1]/s];d[c.index]*=(l.isHorizontal?-1:1)*o}function gR(e,t,r,i,n){var a=e.get(lR)||0;if(a){cR.attr({scaleX:t[0],scaleY:t[1],rotation:r});cR.updateTransform();a/=cR.getLineScale();a*=t[i.valueDim.index]}n.valueLineWidth=a}function yR(e,t,r,i,n,a,o,s,l,u,c,f){var h=c.categoryDim;var p=c.valueDim;var v=f.pxSign;var d=Math.max(t[p.index]+s,0);var g=d;if(i){var y=Math.abs(l);var m=be(e.get("symbolMargin"),"15%")+"";var x=false;if(m.lastIndexOf("!")===m.length-1){x=true;m=m.slice(0,m.length-1)}var _=Y(m,t[p.index]);var b=Math.max(d+_*2,0);var w=x?0:_*2;var S=ca(i);var M=S?i:OR((y+w)/b);var I=y-M*d;_=I/2/(x?M:M-1);b=d+_*2;w=x?0:_*2;if(!S&&i!=="fixed"){M=u?OR((Math.abs(u)+w)/b):0}g=M*b-w;f.repeatTimes=M;f.symbolMargin=_}var C=v*(g/2);var T=f.pathPosition=[];T[h.index]=r[h.wh]/2;T[p.index]=o==="start"?C:o==="end"?l-C:l/2;if(a){T[0]+=a[0];T[1]+=a[1]}var D=f.bundlePosition=[];D[h.index]=r[h.xy];D[p.index]=r[p.xy];var A=f.barRectShape=F({},r);A[p.wh]=v*Math.max(Math.abs(r[p.wh]),Math.abs(T[p.index]+C));A[h.wh]=r[h.wh];var L=f.clipShape={};L[h.xy]=-r[h.xy];L[h.wh]=c.ecSize[h.wh];L[p.xy]=0;L[p.wh]=r[p.wh]}function mR(e){var t=e.symbolPatternSize;var r=S0(e.symbolType,-t/2,-t/2,t,t);r.attr({culling:true});r.type!=="image"&&r.setStyle({strokeNoScale:true});return r}function xR(e,t,n,r){var i=e.__pictorialBundle;var a=n.symbolSize;var o=n.valueLineWidth;var s=n.pathPosition;var l=t.valueDim;var u=n.repeatTimes||0;var c=0;var f=a[t.valueDim.index]+o+n.symbolMargin*2;LR(e,function(e){e.__pictorialAnimationIndex=c;e.__pictorialRepeatTimes=u;if(c<u){kR(e,null,v(c),n,r)}else{kR(e,null,{scaleX:0,scaleY:0},n,r,function(){i.remove(e)})}c++});for(;c<u;c++){var h=mR(n);h.__pictorialAnimationIndex=c;h.__pictorialRepeatTimes=u;i.add(h);var p=v(c);kR(h,{x:p.x,y:p.y,scaleX:0,scaleY:0},{scaleX:p.scaleX,scaleY:p.scaleY,rotation:p.rotation},n,r)}function v(e){var t=s.slice();var r=n.pxSign;var i=e;if(n.symbolRepeatDirection==="start"?r>0:r<0){i=u-1-e}t[l.index]=f*(i-u/2+.5)+s[l.index];return{x:t[0],y:t[1],scaleX:n.symbolScale[0],scaleY:n.symbolScale[1],rotation:n.rotation}}}function _R(e,t,r,i){var n=e.__pictorialBundle;var a=e.__pictorialMainPath;if(!a){a=e.__pictorialMainPath=mR(r);n.add(a);kR(a,{x:r.pathPosition[0],y:r.pathPosition[1],scaleX:0,scaleY:0,rotation:r.rotation},{scaleX:r.symbolScale[0],scaleY:r.symbolScale[1]},r,i)}else{kR(a,null,{x:r.pathPosition[0],y:r.pathPosition[1],scaleX:r.symbolScale[0],scaleY:r.symbolScale[1],rotation:r.rotation},r,i)}}function bR(e,t,r){var i=F({},t.barRectShape);var n=e.__pictorialBarRect;if(!n){n=e.__pictorialBarRect=new G({z2:2,shape:i,silent:true,style:{stroke:"transparent",fill:"transparent",lineWidth:0}});e.add(n)}else{kR(n,null,{shape:i},t,r)}}function wR(e,t,r,i){if(r.symbolClip){var n=e.__pictorialClipPath;var a=F({},r.clipShape);var o=t.valueDim;var s=r.animationModel;var l=r.dataIndex;if(n){X(n,{shape:a},s,l)}else{a[o.wh]=0;n=new G({shape:a});e.__pictorialBundle.setClipPath(n);e.__pictorialClipPath=n;var u={};u[o.wh]=r.clipShape[o.wh];vh[i?"updateProps":"initProps"](n,{shape:u},s,l)}}}function SR(e,t){var r=e.getItemModel(t);r.getAnimationDelayParams=MR;r.isAnimationEnabled=IR;return r}function MR(e){return{index:e.__pictorialAnimationIndex,count:e.__pictorialRepeatTimes}}function IR(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function CR(e,t,r,i){var n=new H;var a=new H;n.add(a);n.__pictorialBundle=a;a.x=r.bundlePosition[0];a.y=r.bundlePosition[1];if(r.symbolRepeat){xR(n,t,r)}else{_R(n,t,r)}bR(n,r,i);wR(n,t,r,i);n.__pictorialShapeStr=AR(e,r);n.__pictorialSymbolMeta=r;return n}function TR(e,t,r){var i=r.animationModel;var n=r.dataIndex;var a=e.__pictorialBundle;X(a,{x:r.bundlePosition[0],y:r.bundlePosition[1]},i,n);if(r.symbolRepeat){xR(e,t,r,true)}else{_R(e,t,r,true)}bR(e,r,true);wR(e,t,r,true)}function DR(e,t,r,i){var n=i.__pictorialBarRect;n&&n.removeTextContent();var a=[];LR(i,function(e){a.push(e)});i.__pictorialMainPath&&a.push(i.__pictorialMainPath);i.__pictorialClipPath&&(r=null);U(a,function(e){Jf(e,{scaleX:0,scaleY:0},r,t,function(){i.parent&&i.parent.remove(i)})});e.setItemGraphicEl(t,null)}function AR(e,t){return[e.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function LR(t,r,i){U(t.__pictorialBundle.children(),function(e){e!==t.__pictorialBarRect&&r.call(i,e)})}function kR(e,t,r,i,n,a){t&&e.attr(t);if(i.symbolClip&&!n){r&&e.attr(r)}else{r&&vh[n?"updateProps":"initProps"](e,r,i.animationModel,i.dataIndex,a)}}function PR(e,t,i){var r=i.dataIndex;var n=i.itemModel;var a=n.getModel("emphasis");var o=a.getModel("itemStyle").getItemStyle();var s=n.getModel(["blur","itemStyle"]).getItemStyle();var l=n.getModel(["select","itemStyle"]).getItemStyle();var u=n.getShallow("cursor");var c=a.get("focus");var f=a.get("blurScope");var h=a.get("scale");LR(e,function(e){if(e instanceof Rl){var t=e.style;e.useStyle(F({image:t.image,x:t.x,y:t.y,width:t.width,height:t.height},i.style))}else{e.useStyle(i.style)}var r=e.ensureState("emphasis");r.style=o;if(h){r.scaleX=e.scaleX*1.1;r.scaleY=e.scaleY*1.1}e.ensureState("blur").style=s;e.ensureState("select").style=l;u&&(e.cursor=u);e.z2=i.z2});var p=t.valueDim.posDesc[+(i.boundingLength>0)];var v=e.__pictorialBarRect;mh(v,xh(n),{labelFetcher:t.seriesModel,labelDataIndex:r,defaultText:SI(t.seriesModel.getData(),r),inheritColor:i.style.fill,defaultOpacity:i.style.opacity,defaultOutsidePosition:p});tc(e,c,f)}function OR(e){var t=Math.round(e);return Math.abs(e-t)<1e-4?t:Math.ceil(e)}var NR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.hasSymbolVisual=true;e.defaultSymbol="roundRect";return e}r.prototype.getInitialData=function(e){e.stack=null;return t.prototype.getInitialData.apply(this,arguments)};r.type="series.pictorialBar";r.dependencies=["grid"];r.defaultOption=Uh(mC.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:false,symbolRepeatDirection:"end",symbolClip:false,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",progressive:0,emphasis:{scale:false},select:{itemStyle:{borderColor:"#212121"}}});return r}(mC);function ER(e){e.registerChartView(fR);e.registerSeriesModel(NR);e.registerLayout(_(Ew,"pictorialBar"))}var RR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._layers=[];return e}r.prototype.render=function(_,e,t){var b=_.getData();var w=this;var S=this.group;var M=_.getLayerSeries();var r=b.getLayout("layoutInfo");var i=r.rect;var n=r.boundaryGap;S.x=0;S.y=i.y+n[0];function a(e){return e.name}var o=new gb(this._layersSeries||[],M,a,a);var I=[];o.add(x(s,this,"add")).update(x(s,this,"update")).remove(x(s,this,"remove")).execute();function s(e,t,r){var i=w._layers;if(e==="remove"){S.remove(i[t]);return}var n=[];var a=[];var o;var s=M[t].indices;var l=0;for(;l<s.length;l++){var u=b.getItemLayout(s[l]);var c=u.x;var f=u.y0;var h=u.y;n.push(c,f);a.push(c,f+h);o=b.getItemVisual(s[l],"style")}var p;var v=b.getItemLayout(s[0]);var d=_.getModel("label");var g=d.get("margin");var y=_.getModel("emphasis");if(e==="add"){var m=I[t]=new H;p=new ZI({shape:{points:n,stackedOnPoints:a,smooth:.4,stackedOnSmooth:.4,smoothConstraint:false},z2:0});m.add(p);S.add(m);if(_.isAnimationEnabled()){p.setClipPath(zR(p.getBoundingRect(),_,function(){p.removeClipPath()}))}}else{var m=i[r];p=m.childAt(0);S.add(m);I[t]=m;X(p,{shape:{points:n,stackedOnPoints:a}},_)}mh(p,xh(_),{labelDataIndex:s[l-1],defaultText:b.getName(s[l-1]),inheritColor:o.fill},{normal:{verticalAlign:"middle"}});p.setTextConfig({position:null,local:true});var x=p.getTextContent();if(x){x.x=v.x-g;x.y=v.y0+v.y/2}p.useStyle(o);b.setItemGraphicEl(t,p);ac(p,_);tc(p,y.get("focus"),y.get("blurScope"))}this._layersSeries=M;this._layers=I};r.type="themeRiver";return r}(v);function zR(e,t,r){var i=new G({shape:{x:e.x-10,y:e.y-10,width:0,height:e.height+20}});qf(i,{shape:{x:e.x-50,width:e.width+100,height:e.height+20}},t,r);return i}var BR=2;var VR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.useColorPaletteOnData=true;return e}r.prototype.init=function(e){t.prototype.init.apply(this,arguments);this.legendVisualProvider=new a2(x(this.getData,this),x(this.getRawData,this))};r.prototype.fixData=function(e){var t=e.length;var r={};var i=ao(e,function(e){if(!r.hasOwnProperty(e[0]+"")){r[e[0]+""]=-1}return e[2]});var n=[];i.buckets.each(function(e,t){n.push({name:t,dataList:e})});var a=n.length;for(var o=0;o<a;++o){var s=n[o].name;for(var l=0;l<n[o].dataList.length;++l){var u=n[o].dataList[l][0]+"";r[u]=o}for(var u in r){if(r.hasOwnProperty(u)&&r[u]!==o){r[u]=o;e[t]=[u,0,s];t++}}}return e};r.prototype.getInitialData=function(e,t){var r=this.getReferringComponents("singleAxis",$a).models[0];var i=r.get("type");var n=ue(e.data,function(e){return e[2]!==undefined});var a=this.fixData(n||[]);var o=[];var s=this.nameMap=I();var l=0;for(var u=0;u<a.length;++u){o.push(a[u][BR]);if(!s.get(a[u][BR])){s.set(a[u][BR],l);l++}}var c=$b(a,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:xb(i)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}});var f=new qb(c,this);f.initData(a);return f};r.prototype.getLayerSeries=function(){var r=this.getData();var e=r.count();var t=[];for(var i=0;i<e;++i){t[i]=i}var n=r.mapDimension("single");var a=ao(t,function(e){return r.get("name",e)});var o=[];a.buckets.each(function(e,t){e.sort(function(e,t){return r.get(n,e)-r.get(n,t)});o.push({name:t,indices:e})});return o};r.prototype.getAxisTooltipData=function(e,t,r){if(!k(e)){e=e?[e]:[]}var i=this.getData();var n=this.getLayerSeries();var a=[];var o=n.length;var s;for(var l=0;l<o;++l){var u=Number.MAX_VALUE;var c=-1;var f=n[l].indices.length;for(var h=0;h<f;++h){var p=i.get(e[0],n[l].indices[h]);var v=Math.abs(p-t);if(v<=u){s=p;u=v;c=n[l].indices[h]}}a.push(c)}return{dataIndices:a,nestestValue:s}};r.prototype.formatTooltip=function(e,t,r){var i=this.getData();var n=i.getName(e);var a=i.get(i.mapDimension("value"),e);return Kg("nameValue",{name:n,value:a})};r.type="series.themeRiver";r.dependencies=["singleAxis"];r.defaultOption={zlevel:0,z:2,coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:true,position:"left",fontSize:11},emphasis:{label:{show:true}}};return r}(dy);function GR(e,t){e.eachSeriesByType("themeRiver",function(e){var t=e.getData();var r=e.coordinateSystem;var i={};var n=r.getRect();i.rect=n;var a=e.get("boundaryGap");var o=r.getAxis();i.boundaryGap=a;if(o.orient==="horizontal"){a[0]=Y(a[0],n.height);a[1]=Y(a[1],n.height);var s=n.height-a[0]-a[1];FR(t,e,s)}else{a[0]=Y(a[0],n.width);a[1]=Y(a[1],n.width);var l=n.width-a[0]-a[1];FR(t,e,l)}t.setLayout("layoutInfo",i)})}function FR(r,e,t){if(!r.count()){return}var i=e.coordinateSystem;var n=e.getLayerSeries();var a=r.mapDimension("single");var o=r.mapDimension("value");var s=A(n,function(e){return A(e.indices,function(e){var t=i.dataToPoint(r.get(a,e));t[1]=r.get(o,e);return t})});var l=HR(s);var u=l.y0;var c=t/l.max;var f=n.length;var h=n[0].indices.length;var p;for(var v=0;v<h;++v){p=u[v]*c;r.setItemLayout(n[0].indices[v],{layerIndex:0,x:s[0][v][0],y0:p,y:s[0][v][1]*c});for(var d=1;d<f;++d){p+=s[d-1][v][1]*c;r.setItemLayout(n[d].indices[v],{layerIndex:d,x:s[d][v][0],y0:p,y:s[d][v][1]*c})}}}function HR(e){var t=e.length;var r=e[0].length;var i=[];var n=[];var a=0;for(var o=0;o<r;++o){var s=0;for(var l=0;l<t;++l){s+=e[l][o][1]}if(s>a){a=s}i.push(s)}for(var u=0;u<r;++u){n[u]=(a-i[u])/2}a=0;for(var c=0;c<r;++c){var f=i[c]+n[c];if(f>a){a=f}}return{y0:n,max:a}}function WR(e){e.registerChartView(RR);e.registerSeriesModel(VR);e.registerLayout(GR);e.registerProcessor(qC("themeRiver"))}var jR=2;var UR=4;var ZR=function(o){d(e,o);function e(e,t,r,i){var n=o.call(this)||this;n.z2=jR;n.textConfig={inside:true};j(n).seriesIndex=t.seriesIndex;var a=new W({z2:UR,silent:e.getModel().get(["label","silent"])});n.setTextContent(a);n.updateData(true,e,t,r,i);return n}e.prototype.updateData=function(e,t,r,i,n){this.node=t;t.piece=this;r=r||this._seriesModel;i=i||this._ecModel;var a=this;j(a).dataIndex=t.dataIndex;var o=t.getModel();var s=o.getModel("emphasis");var l=t.getLayout();var u=F({},l);u.label=null;var c=t.getVisual("style");c.lineJoin="bevel";var f=t.getVisual("decal");if(f){c.decal=ax(f,n)}var h=t2(o.getModel("itemStyle"),u);F(u,h);U(lu,function(e){var t=a.ensureState(e);var r=o.getModel([e,"itemStyle"]);t.style=r.getItemStyle();var i=t2(r,u);if(i){t.shape=i}});if(e){a.setShape(u);a.shape.r=l.r0;X(a,{shape:{r:l.r}},r,t.dataIndex)}else{X(a,{shape:u},r)}a.useStyle(c);this._updateLabel(r);var p=o.getShallow("cursor");p&&a.attr("cursor",p);this._seriesModel=r||this._seriesModel;this._ecModel=i||this._ecModel;var v=s.get("focus");var d=v==="ancestor"?t.getAncestorsIndices():v==="descendant"?t.getDescendantIndices():v;tc(this,d,s.get("blurScope"))};e.prototype._updateLabel=function(v){var d=this;var g=this.node.getModel();var i=g.getModel("label");var y=this.node.getLayout();var e=y.endAngle-y.startAngle;var m=(y.startAngle+y.endAngle)/2;var x=Math.cos(m);var _=Math.sin(m);var b=this;var w=b.getTextContent();var S=this.node.dataIndex;var t=i.get("minAngle")/180*Math.PI;var r=i.get("show")&&!(t!=null&&Math.abs(e)<t);w.ignore=!r;U(uu,function(e){var t=e==="normal"?g.getModel("label"):g.getModel([e,"label"]);var r=e==="normal";var i=r?w:w.ensureState(e);var n=v.getFormattedLabel(S,e);if(r){n=n||d.node.name}i.style=_h(t,{},null,e!=="normal",true);if(n){i.style.text=n}var a=t.get("show");if(a!=null&&!r){i.ignore=!a}var o=M(t,"position");var s=r?b:b.states[e];var l=s.style.fill;s.textConfig={outsideFill:t.get("color")==="inherit"?l:null,inside:o!=="outside"};var u;var c=M(t,"distance")||0;var f=M(t,"align");if(o==="outside"){u=y.r+c;f=m>Math.PI/2?"right":"left"}else{if(!f||f==="center"){u=(y.r+y.r0)/2;f="center"}else if(f==="left"){u=y.r0+c;if(m>Math.PI/2){f="right"}}else if(f==="right"){u=y.r-c;if(m>Math.PI/2){f="left"}}}i.style.align=f;i.style.verticalAlign=M(t,"verticalAlign")||"middle";i.x=u*x+y.cx;i.y=u*_+y.cy;var h=M(t,"rotate");var p=0;if(h==="radial"){p=-m;if(p<-Math.PI/2){p+=Math.PI}}else if(h==="tangential"){p=Math.PI/2-m;if(p>Math.PI/2){p-=Math.PI}else if(p<-Math.PI/2){p+=Math.PI}}else if(typeof h==="number"){p=h*Math.PI/180}i.rotation=p});function M(e,t){var r=e.get(t);if(r==null){return i.get(t)}return r}w.dirtyStyle()};return e}(ef);var YR="sunburstRootToNode";var XR="sunburstHighlight";var qR="sunburstUnhighlight";function JR(e){e.registerAction({type:YR,update:"updateView"},function(n,e){e.eachComponent({mainType:"series",subType:"sunburst",query:n},t);function t(e,t){var r=uA(n,[YR],e);if(r){var i=e.getViewRoot();if(i){n.direction=fA(i,r.node)?"rollUp":"drillDown"}e.resetViewRoot(r.node)}}});e.registerAction({type:XR,update:"none"},function(r,e,t){r=F({},r);e.eachComponent({mainType:"series",subType:"sunburst",query:r},i);function i(e){var t=uA(r,[XR],e);if(t){r.dataIndex=t.node.dataIndex}}if("development"!=="production"){_a("highlight","sunburstHighlight")}t.dispatchAction(F(r,{type:"highlight"}))});e.registerAction({type:qR,update:"updateView"},function(e,t,r){e=F({},e);if("development"!=="production"){_a("downplay","sunburstUnhighlight")}r.dispatchAction(F(e,{type:"downplay"}))})}var KR=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(i,n,a,e){var r=this;this.seriesModel=i;this.api=a;this.ecModel=n;var o=i.getData();var s=o.tree.root;var t=i.getViewRoot();var l=this.group;var u=i.get("renderLabelForZeroData");var c=[];t.eachNode(function(e){c.push(e)});var f=this._oldChildren||[];h(c,f);d(s,t);this._initEvents();this._oldChildren=c;function h(n,a){if(n.length===0&&a.length===0){return}new gb(a,n,e,e).add(t).update(t).remove(_(t,null)).execute();function e(e){return e.getId()}function t(e,t){var r=e==null?null:n[e];var i=t==null?null:a[t];p(r,i)}}function p(e,t){if(!u&&e&&!e.getValue()){e=null}if(e!==s&&t!==s){if(t&&t.piece){if(e){t.piece.updateData(false,e,i,n,a);o.setItemGraphicEl(e.dataIndex,t.piece)}else{v(t)}}else if(e){var r=new ZR(e,i,n,a);l.add(r);o.setItemGraphicEl(e.dataIndex,r)}}}function v(e){if(!e){return}if(e.piece){l.remove(e.piece);e.piece=null}}function d(e,t){if(t.depth>0){if(r.virtualPiece){r.virtualPiece.updateData(false,e,i,n,a)}else{r.virtualPiece=new ZR(e,i,n,a);l.add(r.virtualPiece)}t.piece.off("click");r.virtualPiece.on("click",function(e){r._rootToNode(t.parentNode)})}else if(r.virtualPiece){l.remove(r.virtualPiece);r.virtualPiece=null}}};r.prototype._initEvents=function(){var s=this;this.group.off("click");this.group.on("click",function(a){var o=false;var e=s.seriesModel.getViewRoot();e.eachNode(function(e){if(!o&&e.piece&&e.piece===a.target){var t=e.getModel().get("nodeClick");if(t==="rootToNode"){s._rootToNode(e)}else if(t==="link"){var r=e.getModel();var i=r.get("link");if(i){var n=r.get("target",true)||"_blank";Qp(i,n)}}o=true}})})};r.prototype._rootToNode=function(e){if(e!==this.seriesModel.getViewRoot()){this.api.dispatchAction({type:YR,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})}};r.prototype.containPoint=function(e,t){var r=t.getData();var i=r.getItemLayout(0);if(i){var n=e[0]-i.cx;var a=e[1]-i.cy;var o=Math.sqrt(n*n+a*a);return o<=i.r&&o>=i.r0}};r.type="sunburst";return r}(v);var QR=function(i){d(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;e.type=t.type;e.ignoreStyleOnData=true;return e}t.prototype.getInitialData=function(e,t){var r={name:e.name,children:e.data};$R(r);var n=A(e.levels||[],function(e){return new C(e,this,t)},this);var a=sA.createTree(r,this,i);function i(e){e.wrapMethod("getItemModel",function(e,t){var r=a.getNodeByDataIndex(t);var i=n[r.depth];i&&(e.parentModel=i);return e})}return a.data};t.prototype.optionUpdated=function(){this.resetViewRoot()};t.prototype.getDataParams=function(e){var t=i.prototype.getDataParams.apply(this,arguments);var r=this.getData().tree.getNodeByDataIndex(e);t.treePathInfo=hA(r,this);return t};t.prototype.getViewRoot=function(){return this._viewRoot};t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var t=this.getRawData().tree.root;if(!e||e!==t&&!t.contains(e)){this._viewRoot=t}};t.prototype.enableAriaDecal=function(){MA(this)};t.type="series.sunburst";t.defaultOption={zlevel:0,z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:true,startAngle:90,minAngle:0,stillShowZeroSum:true,nodeClick:"rootToNode",renderLabelForZeroData:false,label:{rotate:"radial",show:true,opacity:1,align:"center",position:"inside",distance:5,silent:true},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],levels:[],sort:"desc"};return t}(dy);function $R(e){var r=0;U(e.children,function(e){$R(e);var t=e.value;k(t)&&(t=t[0]);r+=t});var t=e.value;if(k(t)){t=t[0]}if(t==null||isNaN(t)){t=r}if(t<0){t=0}k(e.value)?e.value[0]=t:e.value=t}var ez=Math.PI/180;function tz(e,t,A){t.eachSeriesByType(e,function(e){var t=e.get("center");var r=e.get("radius");if(!k(r)){r=[0,r]}if(!k(t)){t=[t,t]}var i=A.getWidth();var n=A.getHeight();var c=Math.min(i,n);var f=Y(t[0],i);var h=Y(t[1],n);var p=Y(r[0],c/2);var a=Y(r[1],c/2);var o=-e.get("startAngle")*ez;var v=e.get("minAngle")*ez;var d=e.getData().tree.root;var s=e.getViewRoot();var g=s.depth;var l=e.get("sort");if(l!=null){rz(s,l)}var u=0;U(s.children,function(e){!isNaN(e.getValue())&&u++});var y=s.getValue();var m=Math.PI/(y||u)*2;var x=s.depth>0;var _=s.height-(x?-1:1);var b=(a-p)/(_||1);var w=e.get("clockwise");var S=e.get("stillShowZeroSum");var M=w?1:-1;var I=function(e,t){if(!e){return}var r=t;if(e!==d){var i=e.getValue();var n=y===0&&S?m:i*m;if(n<v){n=v}r=t+M*n;var a=e.depth-g-(x?-1:1);var o=p+b*a;var s=p+b*(a+1);var l=e.getModel();if(l.get("r0")!=null){o=Y(l.get("r0"),c/2)}if(l.get("r")!=null){s=Y(l.get("r"),c/2)}e.setLayout({angle:n,startAngle:t,endAngle:r,clockwise:w,cx:f,cy:h,r0:o,r:s})}if(e.children&&e.children.length){var u=0;U(e.children,function(e){u+=I(e,t+u)})}return r-t};if(x){var C=p;var T=p+b;var D=Math.PI*2;d.setLayout({angle:D,startAngle:o,endAngle:o+D,clockwise:w,cx:f,cy:h,r0:C,r:T})}I(s,o)})}function rz(e,t){var r=e.children||[];e.children=iz(r,t);if(r.length){U(e.children,function(e){rz(e,t)})}}function iz(t,r){if(typeof r==="function"){var e=A(t,function(e,t){var r=e.getValue();return{params:{depth:e.depth,height:e.height,dataIndex:e.dataIndex,getValue:function(){return r}},index:t}});e.sort(function(e,t){return r(e.params,t.params)});return A(e,function(e){return t[e.index]})}else{var i=r==="asc";return t.sort(function(e,t){var r=(e.getValue()-t.getValue())*(i?1:-1);return r===0?(e.dataIndex-t.dataIndex)*(i?-1:1):r})}}function nz(e){var a={};function s(e,t,r){var i=e;while(i&&i.depth>1){i=i.parentNode}var n=t.getColorFromPalette(i.name||i.dataIndex+"",a);if(e.depth>1&&typeof n==="string"){n=Lr(n,(e.depth-1)/(r-1)*.5)}return n}e.eachSeriesByType("sunburst",function(n){var a=n.getData();var o=a.tree;o.eachNode(function(e){var t=e.getModel();var r=t.getModel("itemStyle").getItemStyle();if(!r.fill){r.fill=s(e,n,o.root.height)}var i=a.ensureUniqueItemVisual(e.dataIndex,"style");F(i,r)})})}function az(e){e.registerChartView(KR);e.registerSeriesModel(QR);e.registerLayout(_(tz,"sunburst"));e.registerProcessor(_(qC,"sunburst"));e.registerVisual(nz);JR(e)}function oz(a,o){o=o||[0,0];return A(["x","y"],function(e,t){var r=this.getAxis(e);var i=o[t];var n=a[t]/2;return r.type==="category"?r.getBandWidth():Math.abs(r.dataToCoord(i-n)-r.dataToCoord(i+n))},this)}function sz(t){var e=t.master.getRect();return{coordSys:{type:"cartesian2d",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(e){return t.dataToPoint(e)},size:x(oz,t)}}}function lz(a,o){o=o||[0,0];return A([0,1],function(e){var t=o[e];var r=a[e]/2;var i=[];var n=[];i[e]=t-r;n[e]=t+r;i[1-e]=n[1-e]=o[1-e];return Math.abs(this.dataToPoint(i)[e]-this.dataToPoint(n)[e])},this)}function uz(t){var e=t.getBoundingRect();return{coordSys:{type:"geo",x:e.x,y:e.y,width:e.width,height:e.height,zoom:t.getZoom()},api:{coord:function(e){return t.dataToPoint(e)},size:x(lz,t)}}}function cz(e,t){var r=this.getAxis();var i=t instanceof Array?t[0]:t;var n=(e instanceof Array?e[0]:e)/2;return r.type==="category"?r.getBandWidth():Math.abs(r.dataToCoord(i-n)-r.dataToCoord(i+n))}function fz(t){var e=t.getRect();return{coordSys:{type:"singleAxis",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(e){return t.dataToPoint(e)},size:x(cz,t)}}}function hz(s,l){l=l||[0,0];return A(["Radius","Angle"],function(e,t){var r="get"+e+"Axis";var i=this[r]();var n=l[t];var a=s[t]/2;var o=i.type==="category"?i.getBandWidth():Math.abs(i.dataToCoord(n-a)-i.dataToCoord(n+a));if(e==="Angle"){o=o*Math.PI/180}return o},this)}function pz(n){var a=n.getRadiusAxis();var o=n.getAngleAxis();var e=a.getExtent();e[0]>e[1]&&e.reverse();return{coordSys:{type:"polar",cx:n.cx,cy:n.cy,r:e[1],r0:e[0]},api:{coord:function(e){var t=a.dataToRadius(e[0]);var r=o.dataToAngle(e[1]);var i=n.coordToPoint([t,r]);i.push(t,r*Math.PI/180);return i},size:x(hz,n)}}}function vz(r){var e=r.getRect();var t=r.getRangeInfo();return{coordSys:{type:"calendar",x:e.x,y:e.y,width:e.width,height:e.height,cellWidth:r.getCellWidth(),cellHeight:r.getCellHeight(),rangeInfo:{start:t.start,end:t.end,weeks:t.weeks,dayCount:t.allDay}},api:{coord:function(e,t){return r.dataToPoint(e,t)}}}}var dz={};function gz(e,t,r,i){return e&&(e.legacy||e.legacy!==false&&!r&&!i&&t!=="tspan"&&(t==="text"||z(e,"text")))}function yz(e,t,r){var i=e;var n;var a;var o;if(t==="text"){o=i}else{o={};z(i,"text")&&(o.text=i.text);z(i,"rich")&&(o.rich=i.rich);z(i,"textFill")&&(o.fill=i.textFill);z(i,"textStroke")&&(o.stroke=i.textStroke);a={type:"text",style:o,silent:true};n={};var s=z(i,"textPosition");if(r){n.position=s?i.textPosition:"inside"}else{s&&(n.position=i.textPosition)}z(i,"textPosition")&&(n.position=i.textPosition);z(i,"textOffset")&&(n.offset=i.textOffset);z(i,"textRotation")&&(n.rotation=i.textRotation);z(i,"textDistance")&&(n.distance=i.textDistance)}mz(o,e);U(o.rich,function(e){mz(e,e)});return{textConfig:n,textContent:a}}function mz(e,t){if(!t){return}t.font=t.textFont||t.font;z(t,"textStrokeWidth")&&(e.lineWidth=t.textStrokeWidth);z(t,"textAlign")&&(e.align=t.textAlign);z(t,"textVerticalAlign")&&(e.verticalAlign=t.textVerticalAlign);z(t,"textLineHeight")&&(e.lineHeight=t.textLineHeight);z(t,"textWidth")&&(e.width=t.textWidth);z(t,"textHeight")&&(e.height=t.textHeight);z(t,"textBackgroundColor")&&(e.backgroundColor=t.textBackgroundColor);z(t,"textPadding")&&(e.padding=t.textPadding);z(t,"textBorderColor")&&(e.borderColor=t.textBorderColor);z(t,"textBorderWidth")&&(e.borderWidth=t.textBorderWidth);z(t,"textBorderRadius")&&(e.borderRadius=t.textBorderRadius);z(t,"textBoxShadowColor")&&(e.shadowColor=t.textBoxShadowColor);z(t,"textBoxShadowBlur")&&(e.shadowBlur=t.textBoxShadowBlur);z(t,"textBoxShadowOffsetX")&&(e.shadowOffsetX=t.textBoxShadowOffsetX);z(t,"textBoxShadowOffsetY")&&(e.shadowOffsetY=t.textBoxShadowOffsetY)}function xz(e,t,r){var i=e;i.textPosition=i.textPosition||r.position||"inside";r.offset!=null&&(i.textOffset=r.offset);r.rotation!=null&&(i.textRotation=r.rotation);r.distance!=null&&(i.textDistance=r.distance);var n=i.textPosition.indexOf("inside")>=0;var a=e.fill||"#000";_z(i,t);var o=i.textFill==null;if(n){if(o){i.textFill=r.insideFill||"#fff";!i.textStroke&&r.insideStroke&&(i.textStroke=r.insideStroke);!i.textStroke&&(i.textStroke=a);i.textStrokeWidth==null&&(i.textStrokeWidth=2)}}else{if(o){i.textFill=e.fill||r.outsideFill||"#000"}!i.textStroke&&r.outsideStroke&&(i.textStroke=r.outsideStroke)}i.text=t.text;i.rich=t.rich;U(t.rich,function(e){_z(e,e)});return i}function _z(e,t){if(!t){return}z(t,"fill")&&(e.textFill=t.fill);z(t,"stroke")&&(e.textStroke=t.fill);z(t,"lineWidth")&&(e.textStrokeWidth=t.lineWidth);z(t,"font")&&(e.font=t.font);z(t,"fontStyle")&&(e.fontStyle=t.fontStyle);z(t,"fontWeight")&&(e.fontWeight=t.fontWeight);z(t,"fontSize")&&(e.fontSize=t.fontSize);z(t,"fontFamily")&&(e.fontFamily=t.fontFamily);z(t,"align")&&(e.textAlign=t.align);z(t,"verticalAlign")&&(e.textVerticalAlign=t.verticalAlign);z(t,"lineHeight")&&(e.textLineHeight=t.lineHeight);z(t,"width")&&(e.textWidth=t.width);z(t,"height")&&(e.textHeight=t.height);z(t,"backgroundColor")&&(e.textBackgroundColor=t.backgroundColor);z(t,"padding")&&(e.textPadding=t.padding);z(t,"borderColor")&&(e.textBorderColor=t.borderColor);z(t,"borderWidth")&&(e.textBorderWidth=t.borderWidth);z(t,"borderRadius")&&(e.textBorderRadius=t.borderRadius);z(t,"shadowColor")&&(e.textBoxShadowColor=t.shadowColor);z(t,"shadowBlur")&&(e.textBoxShadowBlur=t.shadowBlur);z(t,"shadowOffsetX")&&(e.textBoxShadowOffsetX=t.shadowOffsetX);z(t,"shadowOffsetY")&&(e.textBoxShadowOffsetY=t.shadowOffsetY);z(t,"textShadowColor")&&(e.textShadowColor=t.textShadowColor);z(t,"textShadowBlur")&&(e.textShadowBlur=t.textShadowBlur);z(t,"textShadowOffsetX")&&(e.textShadowOffsetX=t.textShadowOffsetX);z(t,"textShadowOffsetY")&&(e.textShadowOffsetY=t.textShadowOffsetY)}function bz(e,t){if("development"!=="production"){var r=e+"^_^"+t;if(!dz[r]){console.warn('[ECharts] DEPRECATED: "'+e+'" has been deprecated. '+t);dz[r]=true}}}var wz=ol.CMD;var Sz=Math.PI*2;var Mz=["x","y"];var Iz=["width","height"];var Cz=[];function Tz(e,t){return Math.abs(e-t)<1e-5}function Dz(e){var t=e.data;var r=e.len();var i=[];var x;var n=0;var a=0;var o=0;var s=0;function l(e,t){if(x&&x.length>2){i.push(x)}x=[e,t]}function u(e,t,r,i){if(!(Tz(e,r)&&Tz(t,i))){x.push(e,t,r,i,r,i)}}function c(e,t,r,i,n,a){var o=Math.abs(t-e);var s=Math.tan(o/4)*4/3;var l=t<e?-1:1;var u=Math.cos(e);var c=Math.sin(e);var f=Math.cos(t);var h=Math.sin(t);var p=u*n+r;var v=c*a+i;var d=f*n+r;var g=h*a+i;var y=n*s*l;var m=a*s*l;x.push(p-y*c,v+m*u,d+y*h,g-m*f,d,g)}var f;var h;var p;var v;for(var d=0;d<r;){var g=t[d++];var y=d===1;if(y){n=t[d];a=t[d+1];o=n;s=a;if(g===wz.L||g===wz.C||g===wz.Q){x=[o,s]}}switch(g){case wz.M:n=o=t[d++];a=s=t[d++];l(o,s);break;case wz.L:f=t[d++];h=t[d++];u(n,a,f,h);n=f;a=h;break;case wz.C:x.push(t[d++],t[d++],t[d++],t[d++],n=t[d++],a=t[d++]);break;case wz.Q:f=t[d++];h=t[d++];p=t[d++];v=t[d++];x.push(n+2/3*(f-n),a+2/3*(h-a),p+2/3*(f-p),v+2/3*(h-v),p,v);n=p;a=v;break;case wz.A:var m=t[d++];var _=t[d++];var b=t[d++];var w=t[d++];var S=t[d++];var M=t[d++]+S;d+=1;var I=!t[d++];f=Math.cos(S)*b+m;h=Math.sin(S)*w+_;if(y){o=f;s=h;l(o,s)}else{u(n,a,f,h)}n=Math.cos(M)*b+m;a=Math.sin(M)*w+_;var C=(I?-1:1)*Math.PI/2;for(var T=S;I?T>M:T<M;T+=C){var D=I?Math.max(T+C,M):Math.min(T+C,M);c(T,D,m,_,b,w)}break;case wz.R:o=n=t[d++];s=a=t[d++];f=o+t[d++];h=s+t[d++];l(f,s);u(f,s,f,h);u(f,h,o,h);u(o,h,o,s);u(o,s,f,s);break;case wz.Z:x&&u(n,a,o,s);n=o;a=s;break}}if(x&&x.length>2){i.push(x)}return i}function Az(e,t){var r=e.length;var i=t.length;if(r===i){return[e,t]}var n=r<i?e:t;var a=Math.min(r,i);var o=Math.abs(i-r)/6;var s=(a-2)/6;var l=Math.ceil(o/s)+1;var u=[n[0],n[1]];var c=o;var f=[];var h=[];for(var p=2;p<a;){var v=n[p-2];var d=n[p-1];var g=n[p++];var y=n[p++];var m=n[p++];var x=n[p++];var _=n[p++];var b=n[p++];if(c<=0){u.push(g,y,m,x,_,b);continue}var w=Math.min(c,l-1)+1;for(var S=1;S<=w;S++){var M=S/w;gs(v,g,m,_,M,f);gs(d,y,x,b,M,h);v=f[3];d=h[3];u.push(f[1],h[1],f[2],h[2],v,d);g=f[5];y=h[5];m=f[6];x=h[6]}c-=w-1}return n===e?[u,t]:[e,u]}function Lz(e,t){var r=e.length;var i=e[r-2];var n=e[r-1];var a=[];for(var o=0;o<t.length;){a[o++]=i;a[o++]=n}return a}function kz(e,t){var r;var i;var n;var a=[];var o=[];for(var s=0;s<Math.max(e.length,t.length);s++){var l=e[s];var u=t[s];var c=void 0;var f=void 0;if(!l){c=Lz(i||u,u);f=u}else if(!u){f=Lz(n||l,l);c=l}else{r=Az(l,u),c=r[0],f=r[1];i=c;n=f}a.push(c);o.push(f)}return[a,o]}function Pz(e){var t=0;var r=0;var i=0;var n=e.length;for(var a=0,o=n-2;a<n;o=a,a+=2){var s=e[o];var l=e[o+1];var u=e[a];var c=e[a+1];var f=s*c-u*l;t+=f;r+=(s+u)*f;i+=(l+c)*f}if(t===0){return[e[0]||0,e[1]||0]}return[r/t/3,i/t/3,t]}function Oz(e,t,r,i){var n=(e.length-2)/6;var a=Infinity;var o=0;var s=e.length;var l=s-2;for(var u=0;u<n;u++){var c=u*6;var f=0;for(var h=0;h<s;h+=2){var p=h===0?c:(c+h-2)%l+2;var v=e[p]-r[0];var d=e[p+1]-r[1];var g=t[h]-i[0];var y=t[h+1]-i[1];var m=g-v;var x=y-d;f+=m*m+x*x}if(f<a){a=f;o=u}}return o}function Nz(e){var t=[];var r=e.length;for(var i=0;i<r;i+=2){t[i]=e[r-i-2];t[i+1]=e[r-i-1]}return t}function Ez(e,t,r,i){var n=[];var a;for(var o=0;o<e.length;o++){var s=e[o];var l=t[o];var u=Pz(s);var c=Pz(l);if(a==null){a=u[2]<0!==c[2]<0}var f=[];var h=[];var p=0;var v=Infinity;var d=[];var g=s.length;if(a){s=Nz(s)}var y=Oz(s,l,u,c)*6;var m=g-2;for(var x=0;x<m;x+=2){var _=(y+x)%m+2;f[x+2]=s[_]-u[0];f[x+3]=s[_+1]-u[1]}f[0]=s[y]-u[0];f[1]=s[y+1]-u[1];if(r>0){var b=i/r;for(var w=-i/2;w<=i/2;w+=b){var S=Math.sin(w);var M=Math.cos(w);var I=0;for(var x=0;x<s.length;x+=2){var C=f[x];var T=f[x+1];var D=l[x]-c[0];var A=l[x+1]-c[1];var L=D*M-A*S;var k=D*S+A*M;d[x]=L;d[x+1]=k;var P=L-C;var O=k-T;I+=P*P+O*O}if(I<v){v=I;p=w;for(var N=0;N<d.length;N++){h[N]=d[N]}}}}else{for(var E=0;E<g;E+=2){h[E]=l[E]-c[0];h[E+1]=l[E+1]-c[1]}}n.push({from:f,to:h,fromCp:u,toCp:c,rotation:-p})}return n}function Rz(e,t,r){var i;var n;if(!e||!t){return t}!e.path&&e.createPathProxy();i=e.path;i.beginPath();e.buildPath(i,e.shape);!t.path&&t.createPathProxy();n=t.path;n===i&&(n=new ol(false));n.beginPath();if(Fz(t)){t.__oldBuildPath(n,t.shape)}else{t.buildPath(n,t.shape)}var a=kz(Dz(i),Dz(n)),o=a[0],s=a[1];var l=Ez(o,s,10,Math.PI);Bz(t,l,0);var u=r&&r.done;var c=r&&r.aborted;var f=r&&r.during;t.animateTo({__morphT:1},R({during:function(e){t.dirtyShape();f&&f(e)},done:function(){Gz(t);t.createPathProxy();t.dirtyShape();u&&u()},aborted:function(){c&&c()}},r));return t}function zz(e){var t=this.__morphingData;var r=this.__morphT;var i=1-r;var n=[];for(var a=0;a<t.length;a++){var o=t[a];var s=o.from;var l=o.to;var u=o.rotation*r;var c=o.fromCp;var f=o.toCp;var h=Math.sin(u);var p=Math.cos(u);tt(n,c,f,r);for(var v=0;v<s.length;v+=2){var d=s[v];var g=s[v+1];var y=l[v];var m=l[v+1];var x=d*i+y*r;var _=g*i+m*r;Cz[v]=x*p-_*h+n[0];Cz[v+1]=x*h+_*p+n[1]}for(var v=0;v<s.length;){if(v===0){e.moveTo(Cz[v++],Cz[v++])}e.bezierCurveTo(Cz[v++],Cz[v++],Cz[v++],Cz[v++],Cz[v++],Cz[v++])}}}function Bz(e,t,r){if(Fz(e)){Vz(e,t,r);return}var i=e;i.__oldBuildPath=i.buildPath;i.buildPath=zz;Vz(i,t,r)}function Vz(e,t,r){e.__morphingData=t;e.__morphT=r}function Gz(e){if(Fz(e)){e.buildPath=e.__oldBuildPath;e.__oldBuildPath=e.__morphingData=null}}function Fz(e){return e.__oldBuildPath!=null}function Hz(e){return!!e.__combiningSubList}function Wz(e){return Fz(e)||Hz(e)}function jz(e,t,r,i){var n=[];var a=0;for(var o=0;o<e.length;o++){var s=e[o];if(Hz(s)){var l=s.__combiningSubList;for(var u=0;u<l.length;u++){n.push(l[u])}a+=l.length}else{n.push(s);a++}}if(!a){return}var c=r?r.dividingMethod:null;var f=$z(t,a,c);E(f.length===a);var h=r&&r.done;var p=r&&r.aborted;var v=r&&r.during;var d=0;var g=false;var y=R({during:function(e){v&&v(e)},done:function(){d++;if(d===f.length){Zz(t);h&&h()}},aborted:function(){if(!g){g=true;p&&p()}}},r);for(var o=0;o<a;o++){var m=n[o];var x=f[o];i&&i(t,x,true);Rz(m,x,y)}Uz(t,f);return{fromIndividuals:n,toIndividuals:f,count:a}}function Uz(e,t){if(Hz(e)){Yz(e,t);return}var r=e;Yz(r,t);r.__oldAddSelfToZr=e.addSelfToZr;r.__oldRemoveSelfFromZr=e.removeSelfFromZr;r.addSelfToZr=Xz;r.removeSelfFromZr=Jz;r.__oldBuildPath=r.buildPath;r.buildPath=Pe;r.childrenRef=Kz}function Zz(e){if(!Hz(e)){return}var t=e;Yz(t,null);t.addSelfToZr=t.__oldAddSelfToZr;t.removeSelfFromZr=t.__oldRemoveSelfFromZr;t.buildPath=t.__oldBuildPath;t.childrenRef=t.__combiningSubList=t.__oldAddSelfToZr=t.__oldRemoveSelfFromZr=t.__oldBuildPath=null}function Yz(e,t){if(e.__combiningSubList!==t){qz(e,"removeSelfFromZr");e.__combiningSubList=t;if(t){for(var r=0;r<t.length;r++){t[r].parent=e}}qz(e,"addSelfToZr")}}function Xz(e){this.__oldAddSelfToZr(e);qz(this,"addSelfToZr")}function qz(e,t){var r=e.__combiningSubList;var i=e.__zr;if(r&&i){for(var n=0;n<r.length;n++){var a=r[n];a[t](i)}}}function Jz(e){this.__oldRemoveSelfFromZr(e);var t=this.__combiningSubList;for(var r=0;r<t.length;r++){var i=t[r];i.removeSelfFromZr(e)}}function Kz(){return this.__combiningSubList}function Qz(e,t,r,i){var n=t.length;var a;var o=r?r.dividingMethod:null;var s=false;if(Hz(e)){var l=e.__combiningSubList;if(l.length===n){a=l}else{a=$z(e,n,o);s=true}}else{a=$z(e,n,o);s=true}E(a.length===n);for(var u=0;u<n;u++){if(s&&i){i(e,a[u],false)}Rz(a[u],t[u],r)}return{fromIndividuals:a,toIndividuals:t,count:n}}function $z(e,t,r){return r==="duplicate"?t5(e,t):e5(e,t)}function e5(e,t){var r=[];if(t<=0){return r}if(t===1){return t5(e,t)}if(e instanceof G){var i=e.shape;var n=i.height>i.width?1:0;var a=Iz[n];var o=Mz[n];var s=i[a]/t;var l=i[o];for(var u=0;u<t;u++,l+=s){var c={x:i.x,y:i.y,width:i.width,height:i.height};c[o]=l;c[a]=u<t-1?s:i[o]+i[a]-l;var f=new G({shape:c});r.push(f)}}else if(e instanceof ef){var i=e.shape;var h=i.clockwise;var p=i.startAngle;var v=i.endAngle;var d=r5(p,i.endAngle,h);var g=(d-p)/t;var y=p;for(var u=0;u<t;u++,y+=g){var f=new ef({shape:{cx:i.cx,cy:i.cy,r:i.r,r0:i.r0,clockwise:h,startAngle:y,endAngle:u===t-1?v:y+g}});r.push(f)}}else{return t5(e,t)}return r}function t5(e,t){var r=[];if(t<=0){return r}var i=e.constructor;for(var n=0;n<t;n++){var a=new i({shape:M(e.shape)});r.push(a)}return r}function r5(e,t,r){return t+Sz*Math[r?"ceil":"floor"]((e-t)/Sz)}var i5=qa();var n5={x:1,y:1,scaleX:1,scaleY:1,originX:1,originY:1,rotation:1};var a5=L(n5).join(", ");var o5={color:"fill",borderColor:"stroke"};var s5={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1};var l5="emphasis";var u5="normal";var c5="blur";var f5="select";var h5=[u5,l5,c5,f5];var p5={normal:["itemStyle"],emphasis:[l5,"itemStyle"],blur:[c5,"itemStyle"],select:[f5,"itemStyle"]};var v5={normal:["label"],emphasis:[l5,"label"],blur:[c5,"label"],select:[f5,"label"]};var d5="e\0\0";var g5={normal:{},emphasis:{},blur:{},select:{}};var y5={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]};var m5=new qi;var x5={cartesian2d:sz,geo:uz,singleAxis:fz,polar:pz,calendar:vz};var _5=function(n){d(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",true);this.currentZ=this.get("z",true)};t.prototype.getInitialData=function(e,t){return sw(this.getSource(),this)};t.prototype.getDataParams=function(e,t,r){var i=n.prototype.getDataParams.call(this,e,t);r&&(i.info=i5(r).info);return i};t.type="series.custom";t.dependencies=["grid","polar","geo","singleAxis","calendar"];t.defaultOption={coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:true,clip:false};return t}(dy);var b5=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(a,e,o,s){var l=this._data;var u=a.getData();var c=this.group;var f=Y5(a,u,e,o);if(!l){c.removeAll()}var t=a.__transientTransitionOpt;if(t&&(t.from==null||t.to==null)){l&&l.each(function(e){lB(l.getItemGraphicEl(e),a,c)});u.each(function(e){q5(o,null,e,f(e,s),a,c,u,null)})}else{var h=new pB(a,t);var r=t?"multiple":"oneToOne";new gb(l?l.getIndices():[],u.getIndices(),w5(l,r,t&&t.from),w5(u,r,t&&t.to),null,r).add(function(e){q5(o,null,e,f(e,s),a,c,u,null)}).remove(function(e){lB(l.getItemGraphicEl(e),a,c)}).update(function(e,t){h.reset("oneToOne");var r=l.getItemGraphicEl(t);h.findAndAddFrom(r);if(h.hasFrom()){hB(r,c);r=null}q5(o,r,e,f(e,s),a,c,u,h);h.applyMorphing()}).updateManyToOne(function(e,t){h.reset("manyToOne");for(var r=0;r<t.length;r++){var i=l.getItemGraphicEl(t[r]);h.findAndAddFrom(i);hB(i,c)}q5(o,null,e,f(e,s),a,c,u,h);h.applyMorphing()}).updateOneToMany(function(e,t){h.reset("oneToMany");var r=e.length;var i=l.getItemGraphicEl(t);h.findAndAddFrom(i);hB(i,c);for(var n=0;n<r;n++){q5(o,null,e[n],f(e[n],s),a,c,u,h)}h.applyMorphing()}).execute()}var i=a.get("clip",true)?qI(a.coordinateSystem,false,a):null;if(i){c.setClipPath(i)}else{c.removeClipPath()}this._data=u};r.prototype.incrementalPrepareRender=function(e,t,r){this.group.removeAll();this._data=null};r.prototype.incrementalRender=function(e,t,r,i,n){var a=t.getData();var o=Y5(t,a,r,i);function s(e){if(!e.isGroup){e.incremental=true;e.ensureState("emphasis").hoverLayer=true}}for(var l=e.start;l<e.end;l++){var u=q5(null,null,l,o(l,n),t,this.group,a,null);u&&u.traverse(s)}};r.prototype.filterForExposedEvent=function(e,t,r,i){var n=t.element;if(n==null||r.name===n){return true}while((r=r.__hostTarget||r.parent)&&r!==this.group){if(r.name===n){return true}}return false};r.type="custom";return r}(v);function w5(i,e,t){if(!i){return}if(e==="oneToOne"){return function(e,t){return i.getId(t)}}var n=i.getDimension(t);var r=i.getDimensionInfo(n);if(!r){var a="";if("development"!=="production"){a=t+" is not a valid dimension."}g(a)}var o=r.ordinalMeta;return function(e,t){var r=i.get(n,t);if(o){r=o.categories[r]}return r==null||_e(r)?e+"":"_ec_"+r}}function S5(e){var t=e.type;var r;if(t==="path"){var i=e.shape;var n=i.width!=null&&i.height!=null?{x:i.x||0,y:i.y||0,width:i.width,height:i.height}:null;var a=uB(i);r=Gf(a,null,n,i.layout||"center");i5(r).customPathData=a}else if(t==="image"){r=new Rl({});i5(r).customImagePath=e.style.image}else if(t==="text"){r=new W({})}else if(t==="group"){r=new H}else if(t==="compoundPath"){throw new Error('"compoundPath" is not supported yet.')}else{var o=Vf(t);if(!o){var s="";if("development"!=="production"){s='graphic type "'+t+'" can not be found.'}g(s)}r=new o}i5(r).customGraphicType=t;r.name=e.name;r.z2EmphasisLift=1;r.z2SelectLift=1;return r}function M5(e,t,r,i,n,a,o,s,l,u){var c={};var f={};var h=t.isGroup?null:t;!r&&T5("shape",t,null,n,c,l);D5("shape",n,f);!r&&T5("extra",t,null,n,c,l);D5("extra",n,f);!r&&A5(t,null,n,c,l);L5(n,f);var p=o&&o.normal.cfg;if(p){t.setTextConfig(p)}if(t.type==="text"&&a){var v=a;z(v,"textFill")&&(v.fill=v.textFill);z(v,"textStroke")&&(v.stroke=v.textStroke)}if(a){var d=void 0;var g=fB(t)?a.decal:null;if(e&&g){g.dirty=true;d=ax(g,e)}a.__decalPattern=d}!r&&k5(t,null,n,a,c,l);if(h){z(n,"invisible")&&(h.invisible=n.invisible)}if(!r){I5(t,f,a);C5(t,i,n,s,c,l)}z(n,"silent")&&(t.silent=n.silent);z(n,"ignore")&&(t.ignore=n.ignore);if(!u){z(n,"info")&&(i5(t).info=n.info)}a?t.dirty():t.markRedraw();return r?f:null}function I5(e,t,r){var i=e.isGroup?null:e;if(i&&r){var n=r.__decalPattern;var a=void 0;if(n){a=r.decal;r.decal=n}i.useStyle(r);if(n){r.decal=a}var o=i.animators;for(var s=0;s<o.length;s++){var l=o[s];if(l.targetName==="style"){l.changeTarget(i.style)}}}t&&e.attr(t)}function C5(e,t,r,i,n,a){if(n){var o=r.during;i5(e).userDuring=o;var s=o?x(G5,{el:e,userDuring:o}):null;var l={dataIndex:t,isFrom:true,during:s};a?qf(e,n,i,l):X(e,n,i,l)}}function T5(e,t,r,i,n,a){var o=i[e];if(!o){return}var s=t[e];var l;var u=o.enterFrom;if(a&&u){!l&&(l=n[e]={});var c=L(u);for(var f=0;f<c.length;f++){var h=c[f];l[h]=u[h]}}if(!a&&s&&!(r!=null&&e==="shape")){if(o.transition){!l&&(l=n[e]={});var p=Ia(o.transition);for(var f=0;f<p.length;f++){var h=p[f];var v=s[h];if("development"!=="production"){O5(h,o[h],v)}l[h]=v}}else if(D(i.transition,e)>=0){!l&&(l=n[e]={});var d=L(s);for(var f=0;f<d.length;f++){var h=d[f];var v=s[h];if(N5(o[h],v)){l[h]=v}}}}var g=o.leaveTo;if(g){var y=R5(t);var m=y[e]||(y[e]={});var x=L(g);for(var f=0;f<x.length;f++){var h=x[f];m[h]=g[h]}}}function D5(e,t,r){var i=t[e];if(!i){return}var n=r[e]={};var a=L(i);for(var o=0;o<a.length;o++){var s=a[o];n[s]=ei(i[s])}}function A5(e,t,r,i,n){var a=r.enterFrom;if(n&&a){var o=L(a);for(var s=0;s<o.length;s++){var l=o[s];if("development"!=="production"){E5(l,"el.enterFrom")}i[l]=a[l]}}if(!n){if(t){var u=P5(t,e);Z5(i,"x",u);Z5(i,"y",u);Z5(i,"scaleX",u);Z5(i,"scaleY",u);Z5(i,"originX",u);Z5(i,"originY",u);Z5(i,"rotation",u)}else if(r.transition){var c=Ia(r.transition);for(var s=0;s<c.length;s++){var l=c[s];if(l==="style"||l==="shape"||l==="extra"){continue}var f=e[l];if("development"!=="production"){E5(l,"el.transition");O5(l,r[l],f)}i[l]=f}}else{Z5(i,"x",e);Z5(i,"y",e)}}var h=r.leaveTo;if(h){var p=R5(e);var v=L(h);for(var s=0;s<v.length;s++){var l=v[s];if("development"!=="production"){E5(l,"el.leaveTo")}p[l]=h[l]}}}function L5(e,t){j5(e,t,"position");j5(e,t,"scale");j5(e,t,"origin");U5(e,t,"x");U5(e,t,"y");U5(e,t,"scaleX");U5(e,t,"scaleY");U5(e,t,"originX");U5(e,t,"originY");U5(e,t,"rotation")}function k5(e,t,r,i,n,a){if(!i){return}var o=t||e;var s=o.style;var l;var u=i.enterFrom;if(a&&u){var c=L(u);!l&&(l=n.style={});for(var f=0;f<c.length;f++){var h=c[f];l[h]=u[h]}}if(!a&&s){if(i.transition){var p=Ia(i.transition);!l&&(l=n.style={});for(var f=0;f<p.length;f++){var h=p[f];var v=s[h];l[h]=v}}else if(e.getAnimationStyleProps&&D(r.transition,"style")>=0){var d=e.getAnimationStyleProps();var g=d?d.style:null;if(g){!l&&(l=n.style={});var y=L(i);for(var f=0;f<y.length;f++){var h=y[f];if(g[h]){var v=s[h];l[h]=v}}}}}var m=i.leaveTo;if(m){var x=L(m);var _=R5(e);var b=_.style||(_.style={});for(var f=0;f<x.length;f++){var h=x[f];b[h]=m[h]}}}function P5(e,t){if(!e||e===t||e.parent===t.parent){return e}var r=m5.transform||(m5.transform=Oi([]));var i=e.getComputedTransform();i?Ni(r,i):Oi(r);var n=t.parent;if(n){n.getComputedTransform()}m5.originX=e.originX;m5.originY=e.originY;m5.parent=n;m5.decomposeTransform();return m5}var O5;if("development"!=="production"){O5=function(e,t,r){if(!se(t)){E(t!=null&&isFinite(t),"Prop `"+e+"` must refer to a finite number or ArrayLike for transition.")}else{E(t!==r,"Prop `"+e+"` must use different Array object each time for transition.")}}}function N5(e,t){return!se(e)?e!=null&&isFinite(e):e!==t}var E5;if("development"!=="production"){E5=function(e,t){E(z(n5,e),"Prop `"+e+"` is not a permitted in `"+t+"`. "+"Only `"+L(n5).join("`, `")+"` are permitted.")}}function R5(e){var t=i5(e);return t.leaveToProps||(t.leaveToProps={})}var z5={};var B5={setTransform:function(e,t){if("development"!=="production"){E(z(n5,e),"Only "+a5+" available in `setTransform`.")}z5.el[e]=t;return this},getTransform:function(e){if("development"!=="production"){E(z(n5,e),"Only "+a5+" available in `getTransform`.")}return z5.el[e]},setShape:function(e,t){if("development"!=="production"){V5(e)}var r=z5.el.shape||(z5.el.shape={});r[e]=t;z5.isShapeDirty=true;return this},getShape:function(e){if("development"!=="production"){V5(e)}var t=z5.el.shape;if(t){return t[e]}},setStyle:function(e,t){if("development"!=="production"){V5(e)}var r=z5.el.style;if(r){if("development"!=="production"){if(_e(t)){ya("style."+e+" must not be assigned with NaN.")}}r[e]=t;z5.isStyleDirty=true}return this},getStyle:function(e){if("development"!=="production"){V5(e)}var t=z5.el.style;if(t){return t[e]}},setExtra:function(e,t){if("development"!=="production"){V5(e)}var r=z5.el.extra||(z5.el.extra={});r[e]=t;return this},getExtra:function(e){if("development"!=="production"){V5(e)}var t=z5.el.extra;if(t){return t[e]}}};function V5(e){if("development"!=="production"){if(e==="transition"||e==="enterFrom"||e==="leaveTo"){throw new Error('key must not be "'+e+'"')}}}function G5(){var e=this;var t=e.el;if(!t){return}var r=i5(t).userDuring;var i=e.userDuring;if(r!==i){e.el=e.userDuring=null;return}z5.el=t;z5.isShapeDirty=false;z5.isStyleDirty=false;i(B5);if(z5.isShapeDirty&&t.dirtyShape){t.dirtyShape()}if(z5.isStyleDirty&&t.dirtyStyle){t.dirtyStyle()}}function F5(e,t,r,i,n,a,o){var s=t.isGroup?null:t;var l=n&&n[e].cfg;if(s){var u=s.ensureState(e);if(i===false){var c=s.getState(e);if(c){c.style=null}}else{u.style=i||null}if(l){u.textConfig=l}Eu(s)}}function H5(e,t,r,i){if(e.isGroup){return}var n=e;var a=r.currentZ;var o=r.currentZLevel;n.z=a;n.zlevel=o;var s=t.z2;s!=null&&(n.z2=s||0);for(var l=0;l<h5.length;l++){W5(n,t,h5[l])}}function W5(e,t,r){var i=r===u5;var n=i?t:tB(t,r);var a=n?n.z2:null;var o;if(a!=null){o=i?e:e.ensureState(r);o.z2=a||0}}function j5(e,t,r,i){var n=e[r];var a=y5[r];if(n){if(i){t[a[0]]=i[a[0]];t[a[1]]=i[a[1]]}else{t[a[0]]=n[0];t[a[1]]=n[1]}}}function U5(e,t,r,i){if(e[r]!=null){t[r]=i?i[r]:e[r]}}function Z5(e,t,r){if(r){e[t]=r[t]}}function Y5(c,f,t,e){var r=c.get("renderItem");var i=c.coordinateSystem;var n={};if(i){if("development"!=="production"){E(r,"series.render is required.");E(i.prepareCustoms||x5[i.type],"This coordSys does not support custom series.")}n=i.prepareCustoms?i.prepareCustoms(i):x5[i.type](i)}var a=R({getWidth:e.getWidth,getHeight:e.getHeight,getZr:e.getZr,getDevicePixelRatio:e.getDevicePixelRatio,value:_,style:w,ordinalRawValue:b,styleEmphasis:S,visual:C,barLayout:T,currentSeriesIndices:D,font:A},n.api||{});var o={context:{},seriesId:c.id,seriesName:c.name,seriesIndex:c.seriesIndex,coordSys:n.coordSys,dataInsideLength:f.count(),encode:X5(c.getData())};var h;var s;var l={};var u={};var p={};var v={};for(var d=0;d<h5.length;d++){var g=h5[d];p[g]=c.getModel(p5[g]);v[g]=c.getModel(v5[g])}function y(e){return e===h?s||(s=f.getItemModel(e)):f.getItemModel(e)}function m(e,t){return!f.hasItemOption?p[t]:e===h?l[t]||(l[t]=y(e).getModel(p5[t])):y(e).getModel(p5[t])}function x(e,t){return!f.hasItemOption?v[t]:e===h?u[t]||(u[t]=y(e).getModel(v5[t])):y(e).getModel(v5[t])}return function(e,t){h=e;s=null;l={};u={};return r&&r(R({dataIndexInside:e,dataIndex:f.getRawIndex(e),actionType:t?t.type:null},o),a)};function _(e,t){t==null&&(t=h);return f.get(f.getDimension(e||0),t)}function b(e,t){t==null&&(t=h);var r=f.getDimensionInfo(e||0);if(!r){return}var i=f.get(r.name,t);var n=r&&r.ordinalMeta;return n?n.categories[i]:i}function w(e,t){if("development"!=="production"){bz("api.style","Please write literal style directly instead.")}t==null&&(t=h);var r=f.getItemVisual(t,"style");var i=r&&r.fill;var n=r&&r.opacity;var a=m(t,u5).getItemStyle();i!=null&&(a.fill=i);n!=null&&(a.opacity=n);var o={inheritColor:P(i)?i:"#000"};var s=x(t,u5);var l=_h(s,null,o,false,true);l.text=s.getShallow("show")?N(c.getFormattedLabel(t,u5),SI(f,t)):null;var u=bh(s,o,false);I(e,a);a=xz(a,l,u);e&&M(a,e);a.legacy=true;return a}function S(e,t){if("development"!=="production"){bz("api.styleEmphasis","Please write literal style directly instead.")}t==null&&(t=h);var r=m(t,l5).getItemStyle();var i=x(t,l5);var n=_h(i,null,null,true,true);n.text=i.getShallow("show")?we(c.getFormattedLabel(t,l5),c.getFormattedLabel(t,u5),SI(f,t)):null;var a=bh(i,null,true);I(e,r);r=xz(r,n,a);e&&M(r,e);r.legacy=true;return r}function M(e,t){for(var r in t){if(z(t,r)){e[r]=t[r]}}}function I(e,t){if(e){e.textFill&&(t.textFill=e.textFill);e.textPosition&&(t.textPosition=e.textPosition)}}function C(e,t){t==null&&(t=h);if(z(o5,e)){var r=f.getItemVisual(t,"style");return r?r[o5[e]]:null}if(z(s5,e)){return f.getItemVisual(t,e)}}function T(e){if(i.type==="cartesian2d"){var t=i.getBaseAxis();return Aw(R({axis:t},e))}}function D(){return t.getCurrentSeriesIndices()}function A(e){return Dh(e,t)}}function X5(a){var o={};U(a.dimensions,function(e,t){var r=a.getDimensionInfo(e);if(!r.isExtraCoord){var i=r.coordDim;var n=o[i]=o[i]||[];n[r.coordDimIndex]=t}});return o}function q5(e,t,r,i,n,a,o,s){if(!i){hB(t,a);return}t=J5(e,t,r,i,n,a,true,s);t&&o.setItemGraphicEl(r,t);t&&tc(t,i.focus,i.blurScope);return t}function J5(e,t,r,i,n,a,o,s){if("development"!=="production"){E(i,"should not have an null/undefined element setting")}var l=-1;if(t&&K5(t,i)){l=a.childrenRef().indexOf(t);t=null}var u=!t;if(!t){t=S5(i)}else{t.clearStates()}var c=i5(t).canMorph=i.morph&&fB(t);var f=c&&s&&s.hasFrom();var h=u&&!f;g5.normal.cfg=g5.normal.conOpt=g5.emphasis.cfg=g5.emphasis.conOpt=g5.blur.cfg=g5.blur.conOpt=g5.select.cfg=g5.select.conOpt=null;g5.isLegacy=false;$5(t,r,i,n,h,g5);Q5(t,r,i,n,h);var p=M5(e,t,f,r,i,i.style,g5,n,h,false);if(f){s.addTo(t,i,r,p)}for(var v=0;v<h5.length;v++){var d=h5[v];if(d!==u5){var g=tB(i,d);var y=rB(i,g,d);F5(d,t,g,y,g5)}}H5(t,i,n);if(i.type==="group"){iB(e,t,r,i,n,s)}if(l>=0){a.replaceAt(t,l)}else{a.add(t)}return t}function K5(e,t){var r=i5(e);var i=t.type;var n=t.shape;var a=t.style;return i!=null&&i!==r.customGraphicType||i==="path"&&cB(n)&&uB(n)!==r.customPathData||i==="image"&&z(a,"image")&&a.image!==r.customImagePath}function Q5(e,t,r,i,n){var a=r.clipPath;if(a===false){if(e&&e.getClipPath()){e.removeClipPath()}}else if(a){var o=e.getClipPath();if(o&&K5(o,a)){o=null}if(!o){o=S5(a);if("development"!=="production"){E(o instanceof m,"Only any type of `path` can be used in `clipPath`, rather than "+o.type+".")}e.setClipPath(o)}M5(null,o,null,t,a,null,null,i,n,false)}}function $5(e,t,r,i,n,a){if(e.isGroup){return}eB(r,null,a);eB(r,l5,a);var o=a.normal.conOpt;var s=a.emphasis.conOpt;var l=a.blur.conOpt;var u=a.select.conOpt;if(o!=null||s!=null||u!=null||l!=null){var c=e.getTextContent();if(o===false){c&&e.removeTextContent()}else{o=a.normal.conOpt=o||{type:"text"};if(!c){c=S5(o);e.setTextContent(c)}else{c.clearStates()}var f=o&&o.style;M5(null,c,null,t,o,f,null,i,n,true);for(var h=0;h<h5.length;h++){var p=h5[h];if(p!==u5){var v=a[p].conOpt;F5(p,c,v,rB(o,v,p),null)}}f?c.dirty():c.markRedraw()}}}function eB(e,t,r){var i=!t?e:tB(e,t);var n=!t?e.style:rB(e,i,l5);var a=e.type;var o=i?i.textConfig:null;var s=e.textContent;var l=!s?null:!t?s:tB(s,t);if(n&&(r.isLegacy||gz(n,a,!!o,!!l))){r.isLegacy=true;var u=yz(n,a,!t);if(!o&&u.textConfig){o=u.textConfig}if(!l&&u.textContent){l=u.textContent}}if(!t&&l){var c=l;!c.type&&(c.type="text");if("development"!=="production"){c.type!=="text"&&E(c.type==="text",'textContent.type must be "text"')}}var f=!t?r.normal:r[t];f.cfg=o;f.conOpt=l}function tB(e,t){return!t?e:e?e[t]:null}function rB(e,t,r){var i=t&&t.style;if(i==null&&r===l5&&e){i=e.styleEmphasis}return i}function iB(e,t,r,i,n,a){var o=i.children;var s=o?o.length:0;var l=i.$mergeChildren;var u=l==="byName"||i.diffChildrenByName;var c=l===false;if(!s&&!u&&!c){return}if(u){nB({api:e,oldChildren:t.children()||[],newChildren:o||[],dataIndex:r,seriesModel:n,group:t,morphPreparation:a});return}c&&t.removeAll();var f=0;for(;f<s;f++){o[f]&&J5(e,t.childAt(f),r,o[f],n,t,false,a)}for(var h=t.childCount()-1;h>=f;h--){lB(t.childAt(h),n,t)}}function nB(e){new gb(e.oldChildren,e.newChildren,aB,aB,e).add(oB).update(oB).remove(sB).execute()}function aB(e,t){var r=e&&e.name;return r!=null?r:d5+t}function oB(e,t){var r=this.context;var i=e!=null?r.newChildren[e]:null;var n=t!=null?r.oldChildren[t]:null;J5(r.api,n,r.dataIndex,i,r.seriesModel,r.group,false,r.morphPreparation)}function sB(e){var t=this.context;var r=t.oldChildren[e];lB(r,t.seriesModel,t.group)}function lB(e,t,r){if(e){var i=i5(e).leaveToProps;i?X(e,i,t,{cb:function(){r.remove(e)}}):r.remove(e)}}function uB(e){return e&&(e.pathData||e.d)}function cB(e){return e&&(z(e,"pathData")||z(e,"d"))}function fB(e){return e&&e instanceof m}function hB(e,t){e&&t.remove(e)}var pB=function(){function e(e,t){this._fromList=[];this._toList=[];this._toElOptionList=[];this._allPropsFinalList=[];this._toDataIndices=[];this._morphConfigList=[];this._seriesModel=e;this._transOpt=t}e.prototype.hasFrom=function(){return!!this._fromList.length};e.prototype.findAndAddFrom=function(e){if(!e){return}if(i5(e).canMorph){this._fromList.push(e)}if(e.isGroup){var t=e.childrenRef();for(var r=0;r<t.length;r++){this.findAndAddFrom(t[r])}}};e.prototype.addTo=function(e,t,r,i){if(e){this._toList.push(e);this._toElOptionList.push(t);this._toDataIndices.push(r);this._allPropsFinalList.push(i)}};e.prototype.applyMorphing=function(){var e=this._type;var t=this._fromList;var r=this._toList;var i=r.length;var n=t.length;if(!n||!i){return}if(e==="oneToOne"){for(var a=0;a<i;a++){this._oneToOneForSingleTo(a,a)}}else if(e==="manyToOne"){var o=Math.max(1,Math.floor(n/i));for(var a=0,s=0;a<i;a++,s+=o){var l=a+1>=i?n-s:o;this._manyToOneForSingleTo(a,s>=n?null:s,l)}}else if(e==="oneToMany"){var u=Math.max(1,Math.floor(i/n));for(var c=0,f=0;c<i;c+=u,f++){var h=c+u>=i?i-c:u;this._oneToManyForSingleFrom(c,h,f>=n?null:f)}}};e.prototype._oneToOneForSingleTo=function(e,t){var r=this._toList[e];var i=this._toElOptionList[e];var n=this._toDataIndices[e];var a=this._allPropsFinalList[e];var o=this._fromList[t];var s=this._getOrCreateMorphConfig(n);var l=s.duration;if(o&&Hz(o)){I5(r,a,i.style);if(l){var u=jz([o],r,s,vB);this._processResultIndividuals(u,e,null)}}else{var c=l&&o&&(o!==r||Wz(o))?o:null;var f={};T5("shape",r,c,i,f,false);T5("extra",r,c,i,f,false);A5(r,c,i,f,false);k5(r,c,i,i.style,f,false);I5(r,a,i.style);if(c){Rz(c,r,s)}C5(r,n,i,this._seriesModel,f,false)}};e.prototype._manyToOneForSingleTo=function(e,t,r){var i=this._toList[e];var n=this._toElOptionList[e];var a=this._allPropsFinalList[e];I5(i,a,n.style);var o=this._getOrCreateMorphConfig(this._toDataIndices[e]);if(o.duration&&t!=null){var s=[];for(var l=t;l<r;l++){s.push(this._fromList[l])}var u=jz(s,i,o,vB);this._processResultIndividuals(u,e,null)}};e.prototype._oneToManyForSingleFrom=function(e,t,r){var i=r==null?null:this._fromList[r];var n=this._toList;var a=[];for(var o=e;o<t;o++){var s=n[o];I5(s,this._allPropsFinalList[o],this._toElOptionList[o].style);a.push(s)}var l=this._getOrCreateMorphConfig(this._toDataIndices[e]);if(l.duration&&i){var u=Qz(i,a,l,vB);this._processResultIndividuals(u,e,t)}};e.prototype._processResultIndividuals=function(e,t,r){var i=r!=null;for(var n=0;n<e.count;n++){var a=e.fromIndividuals[n];var o=e.toIndividuals[n];var s=t+(i?n:0);var l=this._toElOptionList[s];var u=this._toDataIndices[s];var c={};A5(o,a,l,c,false);k5(o,a,l,l.style,c,false);C5(o,u,l,this._seriesModel,c,false)}};e.prototype._getOrCreateMorphConfig=function(e){var t=this._morphConfigList;var r=t[e];if(r){return r}var i;var n;var a;var o=this._seriesModel;var s=this._transOpt;if(o.isAnimationEnabled()){var l=void 0;if(o&&o.ecModel){var u=o.ecModel.getUpdatePayload();l=u&&u.animation}if(l){i=l.duration||0;n=l.easing||"cubicOut";a=l.delay||0}else{n=o.get("animationEasingUpdate");var c=o.get("animationDelayUpdate");a=b(c)?c(e):c;var f=o.get("animationDurationUpdate");i=b(f)?f(e):f}}r={duration:i||0,delay:a,easing:n,dividingMethod:s?s.dividingMethod:null};t[e]=r;return r};e.prototype.reset=function(e){this._type=e;this._fromList.length=this._toList.length=this._toElOptionList.length=this._allPropsFinalList.length=this._toDataIndices.length=0};return e}();function vB(e,t,r){t.style=r?M(e.style):e.style;t.zlevel=e.zlevel;t.z=e.z;t.z2=e.z2}function dB(e){e.registerChartView(b5);e.registerSeriesModel(_5)}var gB=qa();var yB=M;var mB=x;var xB=function(){function e(){this._dragging=false;this.animationThreshold=15}e.prototype.render=function(e,t,r,i){var n=t.get("value");var a=t.get("status");this._axisModel=e;this._axisPointerModel=t;this._api=r;if(!i&&this._lastValue===n&&this._lastStatus===a){return}this._lastValue=n;this._lastStatus=a;var o=this._group;var s=this._handle;if(!a||a==="hide"){o&&o.hide();s&&s.hide();return}o&&o.show();s&&s.show();var l={};this.makeElOption(l,n,e,t,r);var u=l.graphicKey;if(u!==this._lastGraphicKey){this.clear(r)}this._lastGraphicKey=u;var c=this._moveAnimation=this.determineAnimation(e,t);if(!o){o=this._group=new H;this.createPointerEl(o,l,e,t);this.createLabelEl(o,l,e,t);r.getZr().add(o)}else{var f=_(_B,t,c);this.updatePointerEl(o,l,f);this.updateLabelEl(o,l,f,t)}MB(o,t,true);this._renderHandle(n)};e.prototype.remove=function(e){this.clear(e)};e.prototype.dispose=function(e){this.clear(e)};e.prototype.determineAnimation=function(e,t){var r=t.get("animation");var i=e.axis;var n=i.type==="category";var a=t.get("snap");if(!a&&!n){return false}if(r==="auto"||r==null){var o=this.animationThreshold;if(n&&i.getBandWidth()>o){return true}if(a){var s=iT(e).seriesDataCount;var l=i.getExtent();return Math.abs(l[0]-l[1])/s>o}return false}return r===true};e.prototype.makeElOption=function(e,t,r,i,n){};e.prototype.createPointerEl=function(e,t,r,i){var n=t.pointer;if(n){var a=gB(e).pointerEl=new vh[n.type](yB(t.pointer));e.add(a)}};e.prototype.createLabelEl=function(e,t,r,i){if(t.label){var n=gB(e).labelEl=new W(yB(t.label));e.add(n);wB(n,i)}};e.prototype.updatePointerEl=function(e,t,r){var i=gB(e).pointerEl;if(i&&t.pointer){i.setStyle(t.pointer.style);r(i,{shape:t.pointer.shape})}};e.prototype.updateLabelEl=function(e,t,r,i){var n=gB(e).labelEl;if(n){n.setStyle(t.label.style);r(n,{x:t.label.x,y:t.label.y});wB(n,i)}};e.prototype._renderHandle=function(e){if(this._dragging||!this.updateHandleTransform){return}var t=this._axisPointerModel;var r=this._api.getZr();var i=this._handle;var n=t.getModel("handle");var a=t.get("status");if(!n.get("show")||!a||a==="hide"){i&&r.remove(i);this._handle=null;return}var o;if(!this._handle){o=true;i=this._handle=lh(n.get("icon"),{cursor:"move",draggable:true,onmousemove:function(e){At(e.event)},onmousedown:mB(this._onHandleDragMove,this,0,0),drift:mB(this._onHandleDragMove,this),ondragend:mB(this._onHandleDragEnd,this)});r.add(i)}MB(i,t,false);i.setStyle(n.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var s=n.get("size");if(!k(s)){s=[s,s]}i.scaleX=s[0]/2;i.scaleY=s[1]/2;zy(this,"_doDispatchAxisPointer",n.get("throttle")||0,"fixRate");this._moveHandleToValue(e,o)};e.prototype._moveHandleToValue=function(e,t){_B(this._axisPointerModel,!t&&this._moveAnimation,this._handle,SB(this.getHandleTransform(e,this._axisModel,this._axisPointerModel)))};e.prototype._onHandleDragMove=function(e,t){var r=this._handle;if(!r){return}this._dragging=true;var i=this.updateHandleTransform(SB(r),[e,t],this._axisModel,this._axisPointerModel);this._payloadInfo=i;r.stopAnimation();r.attr(SB(i));gB(r).lastProp=null;this._doDispatchAxisPointer()};e.prototype._doDispatchAxisPointer=function(){var e=this._handle;if(!e){return}var t=this._payloadInfo;var r=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:r.axis.dim,axisIndex:r.componentIndex}]})};e.prototype._onHandleDragEnd=function(){this._dragging=false;var e=this._handle;if(!e){return}var t=this._axisPointerModel.get("value");this._moveHandleToValue(t);this._api.dispatchAction({type:"hideTip"})};e.prototype.clear=function(e){this._lastValue=null;this._lastStatus=null;var t=e.getZr();var r=this._group;var i=this._handle;if(t&&r){this._lastGraphicKey=null;r&&t.remove(r);i&&t.remove(i);this._group=null;this._handle=null;this._payloadInfo=null}};e.prototype.doClear=function(){};e.prototype.buildLabel=function(e,t,r){r=r||0;return{x:e[r],y:e[1-r],width:t[r],height:t[1-r]}};return e}();function _B(e,t,r,i){if(!bB(gB(r).lastProp,i)){gB(r).lastProp=i;t?X(r,i,e):(r.stopAnimation(),r.attr(i))}}function bB(r,e){if(O(r)&&O(e)){var i=true;U(e,function(e,t){i=i&&bB(r[t],e)});return!!i}else{return r===e}}function wB(e,t){e[t.get(["label","show"])?"show":"hide"]()}function SB(e){return{x:e.x||0,y:e.y||0,rotation:e.rotation||0}}function MB(e,t,r){var i=t.get("z");var n=t.get("zlevel");e&&e.traverse(function(e){if(e.type!=="group"){i!=null&&(e.z=i);n!=null&&(e.zlevel=n);e.silent=r}})}function IB(e){var t=e.get("type");var r=e.getModel(t+"Style");var i;if(t==="line"){i=r.getLineStyle();i.fill=null}else if(t==="shadow"){i=r.getAreaStyle();i.stroke=null}return i}function CB(e,t,r,i,n){var a=r.get("value");var o=DB(a,t.axis,t.ecModel,r.get("seriesDataIndices"),{precision:r.get(["label","precision"]),formatter:r.get(["label","formatter"])});var s=r.getModel("label");var l=Vp(s.get("padding")||0);var u=s.getFont();var c=pn(o,u);var f=n.position;var h=c.width+l[1]+l[3];var p=c.height+l[0]+l[2];var v=n.align;v==="right"&&(f[0]-=h);v==="center"&&(f[0]-=h/2);var d=n.verticalAlign;d==="bottom"&&(f[1]-=p);d==="middle"&&(f[1]-=p/2);TB(f,h,p,i);var g=s.get("backgroundColor");if(!g||g==="auto"){g=t.get(["axisLine","lineStyle","color"])}e.label={x:f[0],y:f[1],style:_h(s,{text:o,font:u,fill:s.getTextColor(),padding:l,backgroundColor:g}),z2:10}}function TB(e,t,r,i){var n=i.getWidth();var a=i.getHeight();e[0]=Math.min(e[0]+t,n)-t;e[1]=Math.min(e[1]+r,a)-r;e[0]=Math.max(e[0],0);e[1]=Math.max(e[1],0)}function DB(e,t,n,r,i){e=t.scale.parse(e);var a=t.scale.getLabel({value:e},{precision:i.precision});var o=i.formatter;if(o){var s={value:mS(t,{value:e}),axisDimension:t.dim,axisIndex:t.index,seriesData:[]};U(r,function(e){var t=n.getSeriesByIndex(e.seriesIndex);var r=e.dataIndexInside;var i=t&&t.getDataParams(r);i&&s.seriesData.push(i)});if(P(o)){a=o.replace("{value}",a)}else if(b(o)){a=o(s)}}return a}function AB(e,t,r){var i=Pi();zi(i,i,r.rotation);Ri(i,i,r.position);return th([e.dataToCoord(t),(r.labelOffset||0)+(r.labelDirection||1)*(r.labelMargin||0)],i)}function LB(e,t,r,i,n,a){var o=V2.innerTextLayout(r.rotation,0,r.labelDirection);r.labelMargin=n.get(["label","margin"]);CB(t,i,n,a,{position:AB(i.axis,e,r),align:o.textAlign,verticalAlign:o.textVerticalAlign})}function kB(e,t,r){r=r||0;return{x1:e[r],y1:e[1-r],x2:t[r],y2:t[1-r]}}function PB(e,t,r){r=r||0;return{x:e[r],y:e[1-r],width:t[r],height:t[1-r]}}function OB(e,t,r,i,n,a){return{cx:e,cy:t,r0:r,r:i,startAngle:n,endAngle:a,clockwise:true}}var NB=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.makeElOption=function(e,t,r,i,n){var a=r.axis;var o=a.grid;var s=i.get("type");var l=EB(o,a).getOtherAxis(a).getGlobalExtent();var u=a.toGlobalCoord(a.dataToCoord(t,true));if(s&&s!=="none"){var c=IB(i);var f=RB[s](a,u,l);f.style=c;e.graphicKey=f.type;e.pointer=f}var h=L2(o.model,r);LB(t,e,h,r,i,n)};t.prototype.getHandleTransform=function(e,t,r){var i=L2(t.axis.grid.model,t,{labelInside:false});i.labelMargin=r.get(["handle","margin"]);var n=AB(t.axis,e,i);return{x:n[0],y:n[1],rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}};t.prototype.updateHandleTransform=function(e,t,r,i){var n=r.axis;var a=n.grid;var o=n.getGlobalExtent(true);var s=EB(a,n).getOtherAxis(n).getGlobalExtent();var l=n.dim==="x"?0:1;var u=[e.x,e.y];u[l]+=t[l];u[l]=Math.min(o[1],u[l]);u[l]=Math.max(o[0],u[l]);var c=(s[1]+s[0])/2;var f=[c,c];f[l]=u[l];var h=[{verticalAlign:"middle"},{align:"center"}];return{x:u[0],y:u[1],rotation:e.rotation,cursorPoint:f,tooltipOption:h[l]}};return t}(xB);function EB(e,t){var r={};r[t.dim+"AxisIndex"]=t.index;return e.getCartesian(r)}var RB={line:function(e,t,r){var i=kB([t,r[0]],[t,r[1]],zB(e));return{type:"Line",subPixelOptimize:true,shape:i}},shadow:function(e,t,r){var i=Math.max(1,e.getBandWidth());var n=r[1]-r[0];return{type:"Rect",shape:PB([t-i/2,r[0]],[i,n],zB(e))}}};function zB(e){return e.dim==="x"?0:1}var BB=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="axisPointer";r.defaultOption={show:"auto",zlevel:0,z:50,type:"line",snap:false,triggerTooltip:true,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:true,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:false,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}};return r}(p);var VB=qa();var GB=U;function FB(e,t,r){if(S.node){return}var i=t.getZr();VB(i).records||(VB(i).records={});HB(i,t);var n=VB(i).records[e]||(VB(i).records[e]={});n.handler=r}function HB(n,a){if(VB(n).initialized){return}VB(n).initialized=true;e("click",_(UB,"click"));e("mousemove",_(UB,"mousemove"));e("globalout",jB);function e(e,i){n.on(e,function(t){var r=ZB(a);GB(VB(n).records,function(e){e&&i(e,t,r.dispatchAction)});WB(r.pendings,a)})}}function WB(e,t){var r=e.showTip.length;var i=e.hideTip.length;var n;if(r){n=e.showTip[r-1]}else if(i){n=e.hideTip[i-1]}if(n){n.dispatchAction=null;t.dispatchAction(n)}}function jB(e,t,r){e.handler("leave",null,r)}function UB(e,t,r,i){t.handler(e,r,i)}function ZB(r){var i={showTip:[],hideTip:[]};var n=function(e){var t=i[e.type];if(t){t.push(e)}else{e.dispatchAction=n;r.dispatchAction(e)}};return{dispatchAction:n,pendings:i}}function YB(e,t){if(S.node){return}var r=t.getZr();var i=(VB(r).records||{})[e];if(i){VB(r).records[e]=null}}var XB=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var i=t.getComponent("tooltip");var n=e.get("triggerOn")||i&&i.get("triggerOn")||"mousemove|click";FB("axisPointer",r,function(e,t,r){if(n!=="none"&&(e==="leave"||n.indexOf(e)>=0)){r({type:"updateAxisPointer",currTrigger:e,x:t&&t.offsetX,y:t&&t.offsetY})}})};r.prototype.remove=function(e,t){YB("axisPointer",t)};r.prototype.dispose=function(e,t){YB("axisPointer",t)};r.type="axisPointer";return r}(My);function qB(e,t){var r=[];var i=e.seriesIndex;var n;if(i==null||!(n=t.getSeriesByIndex(i))){return{point:[]}}var a=n.getData();var o=Xa(a,e);if(o==null||o<0||k(o)){return{point:[]}}var s=a.getItemGraphicEl(o);var l=n.coordinateSystem;if(n.getTooltipPosition){r=n.getTooltipPosition(o)||[]}else if(l&&l.dataToPoint){if(e.isStacked){var u=l.getBaseAxis();var c=l.getOtherAxis(u);var f=c.dim;var h=u.dim;var p=f==="x"||f==="radius"?1:0;var v=a.mapDimension(h);var d=[];d[p]=a.get(v,o);d[1-p]=a.get(a.getCalculationInfo("stackResultDimension"),o);r=l.dataToPoint(d)||[]}else{r=l.dataToPoint(a.getValues(A(l.dimensions,function(e){return a.mapDimension(e)}),o))||[]}}else if(s){var g=s.getBoundingRect().clone();g.applyTransform(s.transform);r=[g.x+g.width/2,g.y+g.height/2]}return{point:r,el:s}}var JB=qa();function KB(e,t,r){var i=e.currTrigger;var o=[e.x,e.y];var n=e;var a=e.dispatchAction||x(r.dispatchAction,r);var s=t.getComponent("axisPointer").coordSysAxesInfo;if(!s){return}if(s3(o)){o=qB({seriesIndex:n.seriesIndex,dataIndex:n.dataIndex},t).point}var l=s3(o);var u=n.axesInfo;var c=s.axesInfo;var f=i==="leave"||s3(o);var h={};var p={};var v={list:[],map:{}};var d={showPointer:_(e3,p),showTooltip:_(t3,v)};U(s.coordSysMap,function(e,t){var a=l||e.containPoint(o);U(s.coordSysAxesInfo[t],function(e,t){var r=e.axis;var i=a3(u,e);if(!f&&a&&(!u||i)){var n=i&&i.value;if(n==null&&!l){n=r.pointToData(o)}n!=null&&QB(e,n,d,false,h)}})});var g={};U(c,function(n,e){var a=n.linkGroup;if(a&&!p[e]){U(a.axesInfo,function(e,t){var r=p[t];if(e!==n&&r){var i=r.value;a.mapper&&(i=n.axis.scale.parse(a.mapper(i,o3(e),o3(n))));g[n.key]=i}})}});U(g,function(e,t){QB(c[t],e,d,true,h)});r3(p,c,h);i3(v,o,e,a);n3(c,a,r);return h}function QB(e,t,r,i,n){var a=e.axis;if(a.scale.isBlank()||!a.containData(t)){return}if(!e.involveSeries){r.showPointer(e,t);return}var o=$B(t,e);var s=o.payloadBatch;var l=o.snapToValue;if(s[0]&&n.seriesIndex==null){F(n,s[0])}if(!i&&e.snap){if(a.containData(l)&&l!=null){t=l}}r.showPointer(e,t,s);r.showTooltip(e,o,l)}function $B(l,e){var u=e.axis;var c=u.dim;var f=l;var h=[];var p=Number.MAX_VALUE;var v=-1;U(e.seriesModels,function(t,e){var r=t.getData().mapDimensionsAll(c);var i;var n;if(t.getAxisTooltipData){var a=t.getAxisTooltipData(r,l,u);n=a.dataIndices;i=a.nestestValue}else{n=t.getData().indicesOfNearest(r[0],l,u.type==="category"?.5:null);if(!n.length){return}i=t.getData().get(r[0],n[0])}if(i==null||!isFinite(i)){return}var o=l-i;var s=Math.abs(o);if(s<=p){if(s<p||o>=0&&v<0){p=s;v=o;f=i;h.length=0}U(n,function(e){h.push({seriesIndex:t.seriesIndex,dataIndexInside:e,dataIndex:t.getData().getRawIndex(e)})})}});return{payloadBatch:h,snapToValue:f}}function e3(e,t,r,i){e[t.key]={value:r,payloadBatch:i}}function t3(e,t,r,i){var n=r.payloadBatch;var a=t.axis;var o=a.model;var s=t.axisPointerModel;if(!t.triggerTooltip||!n.length){return}var l=t.coordSys.model;var u=oT(l);var c=e.map[u];if(!c){c=e.map[u]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]};e.list.push(c)}c.dataByAxis.push({axisDim:a.dim,axisIndex:o.componentIndex,axisType:o.type,axisId:o.id,value:i,valueLabelOpt:{precision:s.get(["label","precision"]),formatter:s.get(["label","formatter"])},seriesDataIndices:n.slice()})}function r3(n,e,t){var a=t.axesInfo=[];U(e,function(e,t){var r=e.axisPointerModel.option;var i=n[t];if(i){!e.useHandle&&(r.status="show");r.value=i.value;r.seriesDataIndices=(i.payloadBatch||[]).slice()}else{!e.useHandle&&(r.status="hide")}r.status==="show"&&a.push({axisDim:e.axis.dim,axisIndex:e.axis.model.componentIndex,value:r.value})})}function i3(e,t,r,i){if(s3(t)||!e.list.length){i({type:"hideTip"});return}var n=((e.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:true,x:t[0],y:t[1],tooltipOption:r.tooltipOption,position:r.position,dataIndexInside:n.dataIndexInside,dataIndex:n.dataIndex,seriesIndex:n.seriesIndex,dataByCoordSys:e.list})}function n3(e,t,r){var i=r.getZr();var n="axisPointerLastHighlights";var a=JB(i)[n]||{};var o=JB(i)[n]={};U(e,function(e,t){var r=e.axisPointerModel.option;r.status==="show"&&U(r.seriesDataIndices,function(e){var t=e.seriesIndex+" | "+e.dataIndex;o[t]=e})});var s=[];var l=[];U(a,function(e,t){!o[t]&&l.push(e)});U(o,function(e,t){!a[t]&&s.push(e)});l.length&&r.dispatchAction({type:"downplay",escapeConnect:true,notBlur:true,batch:l});s.length&&r.dispatchAction({type:"highlight",escapeConnect:true,notBlur:true,batch:s})}function a3(e,t){for(var r=0;r<(e||[]).length;r++){var i=e[r];if(t.axis.dim===i.axisDim&&t.axis.model.componentIndex===i.axisIndex){return i}}}function o3(e){var t=e.axis.model;var r={};var i=r.axisDim=e.axis.dim;r.axisIndex=r[i+"AxisIndex"]=t.componentIndex;r.axisName=r[i+"AxisName"]=t.name;r.axisId=r[i+"AxisId"]=t.id;return r}function s3(e){return!e||e[0]==null||isNaN(e[0])||e[1]==null||isNaN(e[1])}function l3(e){lT.registerAxisPointerClass("CartesianAxisPointer",NB);e.registerComponentModel(BB);e.registerComponentView(XB);e.registerPreprocessor(function(e){if(e){(!e.axisPointer||e.axisPointer.length===0)&&(e.axisPointer={});var t=e.axisPointer.link;if(t&&!k(t)){e.axisPointer.link=[t]}}});e.registerProcessor(e.PRIORITY.PROCESSOR.STATISTIC,function(e,t){e.getComponent("axisPointer").coordSysAxesInfo=J2(e,t)});e.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},KB)}function u3(e){t(_T);t(l3)}var c3=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.makeElOption=function(e,t,r,i,n){var a=r.axis;if(a.dim==="angle"){this.animationThreshold=Math.PI/18}var o=a.polar;var s=o.getOtherAxis(a);var l=s.getExtent();var u=a.dataToCoord(t);var c=i.get("type");if(c&&c!=="none"){var f=IB(i);var h=h3[c](a,o,u,l);h.style=f;e.graphicKey=h.type;e.pointer=h}var p=i.get(["label","margin"]);var v=f3(t,r,i,o,p);CB(e,r,i,n,v)};return t}(xB);function f3(e,t,r,i,n){var a=t.axis;var o=a.dataToCoord(e);var s=i.getAngleAxis().getExtent()[0];s=s/180*Math.PI;var l=i.getRadiusAxis().getExtent();var u;var c;var f;if(a.dim==="radius"){var h=Pi();zi(h,h,s);Ri(h,h,[i.cx,i.cy]);u=th([o,-n],h);var p=t.getModel("axisLabel").get("rotate")||0;var v=V2.innerTextLayout(s,p*Math.PI/180,-1);c=v.textAlign;f=v.textVerticalAlign}else{var d=l[1];u=i.coordToPoint([d+n,o]);var g=i.cx;var y=i.cy;c=Math.abs(u[0]-g)/d<.3?"center":u[0]>g?"left":"right";f=Math.abs(u[1]-y)/d<.3?"middle":u[1]>y?"top":"bottom"}return{position:u,align:c,verticalAlign:f}}var h3={line:function(e,t,r,i){return e.dim==="angle"?{type:"Line",shape:kB(t.coordToPoint([i[0],r]),t.coordToPoint([i[1],r]))}:{type:"Circle",shape:{cx:t.cx,cy:t.cy,r:r}}},shadow:function(e,t,r,i){var n=Math.max(1,e.getBandWidth());var a=Math.PI/180;return e.dim==="angle"?{type:"Sector",shape:OB(t.cx,t.cy,i[0],i[1],(-r-n/2)*a,(-r+n/2)*a)}:{type:"Sector",shape:OB(t.cx,t.cy,r-n/2,r+n/2,0,Math.PI*2)}}};var p3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.findAxisModel=function(e){var t;var r=this.ecModel;r.eachComponent(e,function(e){if(e.getCoordSysModel()===this){t=e}},this);return t};r.type="polar";r.dependencies=["radiusAxis","angleAxis"];r.defaultOption={zlevel:0,z:0,center:["50%","50%"],radius:"80%"};return r}(p);var v3=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",$a).models[0]};t.type="polarAxis";return t}(p);oe(v3,IS);var d3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="angleAxis";return r}(v3);var g3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="radiusAxis";return r}(v3);var y3=function(r){d(e,r);function e(e,t){return r.call(this,"radius",e,t)||this}e.prototype.pointToData=function(e,t){return this.polar.pointToData(e,t)[this.dim==="radius"?0:1]};return e}($S);y3.prototype.dataToRadius=$S.prototype.dataToCoord;y3.prototype.radiusToData=$S.prototype.coordToData;var m3=qa();var x3=function(r){d(e,r);function e(e,t){return r.call(this,"angle",e,t||[0,360])||this}e.prototype.pointToData=function(e,t){return this.polar.pointToData(e,t)[this.dim==="radius"?0:1]};e.prototype.calculateCategoryInterval=function(){var e=this;var t=e.getLabelModel();var r=e.scale;var i=r.getExtent();var n=r.count();if(i[1]-i[0]<1){return 0}var a=i[0];var o=e.dataToCoord(a+1)-e.dataToCoord(a);var s=Math.abs(o);var l=pn(a==null?"":a+"",t.getFont(),"center","top");var u=Math.max(l.height,7);var c=u/s;isNaN(c)&&(c=Infinity);var f=Math.max(0,Math.floor(c));var h=m3(e.model);var p=h.lastAutoInterval;var v=h.lastTickCount;if(p!=null&&v!=null&&Math.abs(p-f)<=1&&Math.abs(v-n)<=1&&p>f){f=p}else{h.lastTickCount=n;h.lastAutoInterval=f}return f};return e}($S);x3.prototype.dataToAngle=$S.prototype.dataToCoord;x3.prototype.angleToData=$S.prototype.coordToData;var _3=function(){function e(e){this.dimensions=["radius","angle"];this.type="polar";this.cx=0;this.cy=0;this._radiusAxis=new y3;this._angleAxis=new x3;this.axisPointerEnabled=true;this.name=e||"";this._radiusAxis.polar=this._angleAxis.polar=this}e.prototype.containPoint=function(e){var t=this.pointToCoord(e);return this._radiusAxis.contain(t[0])&&this._angleAxis.contain(t[1])};e.prototype.containData=function(e){return this._radiusAxis.containData(e[0])&&this._angleAxis.containData(e[1])};e.prototype.getAxis=function(e){var t="_"+e+"Axis";return this[t]};e.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]};e.prototype.getAxesByScale=function(e){var t=[];var r=this._angleAxis;var i=this._radiusAxis;r.scale.type===e&&t.push(r);i.scale.type===e&&t.push(i);return t};e.prototype.getAngleAxis=function(){return this._angleAxis};e.prototype.getRadiusAxis=function(){return this._radiusAxis};e.prototype.getOtherAxis=function(e){var t=this._angleAxis;return e===t?this._radiusAxis:t};e.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()};e.prototype.getTooltipAxes=function(e){var t=e!=null&&e!=="auto"?this.getAxis(e):this.getBaseAxis();return{baseAxes:[t],otherAxes:[this.getOtherAxis(t)]}};e.prototype.dataToPoint=function(e,t){return this.coordToPoint([this._radiusAxis.dataToRadius(e[0],t),this._angleAxis.dataToAngle(e[1],t)])};e.prototype.pointToData=function(e,t){var r=this.pointToCoord(e);return[this._radiusAxis.radiusToData(r[0],t),this._angleAxis.angleToData(r[1],t)]};e.prototype.pointToCoord=function(e){var t=e[0]-this.cx;var r=e[1]-this.cy;var i=this.getAngleAxis();var n=i.getExtent();var a=Math.min(n[0],n[1]);var o=Math.max(n[0],n[1]);i.inverse?a=o-360:o=a+360;var s=Math.sqrt(t*t+r*r);t/=s;r/=s;var l=Math.atan2(-r,t)/Math.PI*180;var u=l<a?1:-1;while(l<a||l>o){l+=u*360}return[s,l]};e.prototype.coordToPoint=function(e){var t=e[0];var r=e[1]/180*Math.PI;var i=Math.cos(r)*t+this.cx;var n=-Math.sin(r)*t+this.cy;return[i,n]};e.prototype.getArea=function(){var e=this.getAngleAxis();var t=this.getRadiusAxis();var r=t.getExtent().slice();r[0]>r[1]&&r.reverse();var i=e.getExtent();var n=Math.PI/180;return{cx:this.cx,cy:this.cy,r0:r[0],r:r[1],startAngle:-i[0]*n,endAngle:-i[1]*n,clockwise:e.inverse,contain:function(e,t){var r=e-this.cx;var i=t-this.cy;var n=r*r+i*i;var a=this.r;var o=this.r0;return n<=a*a&&n>=o*o}}};e.prototype.convertToPixel=function(e,t,r){var i=b3(t);return i===this?this.dataToPoint(r):null};e.prototype.convertFromPixel=function(e,t,r){var i=b3(t);return i===this?this.pointToData(r):null};return e}();function b3(e){var t=e.seriesModel;var r=e.polarModel;return r&&r.coordinateSystem||t&&t.coordinateSystem}function w3(e,t,r){var i=t.get("center");var n=r.getWidth();var a=r.getHeight();e.cx=Y(i[0],n);e.cy=Y(i[1],a);var o=e.getRadiusAxis();var s=Math.min(n,a)/2;var l=t.get("radius");if(l==null){l=[0,"100%"]}else if(!k(l)){l=[0,l]}var u=[Y(l[0],s),Y(l[1],s)];o.inverse?o.setExtent(u[1],u[0]):o.setExtent(u[0],u[1])}function S3(e,t){var r=this;var i=r.getAngleAxis();var n=r.getRadiusAxis();i.scale.setExtent(Infinity,-Infinity);n.scale.setExtent(Infinity,-Infinity);e.eachSeries(function(e){if(e.coordinateSystem===r){var t=e.getData();U(SS(t,"radius"),function(e){n.scale.unionExtentFromData(t,e)});U(SS(t,"angle"),function(e){i.scale.unionExtentFromData(t,e)})}});vS(i.scale,i.model);vS(n.scale,n.model);if(i.type==="category"&&!i.onBand){var a=i.getExtent();var o=360/i.scale.count();i.inverse?a[1]+=o:a[1]-=o;i.setExtent(a[0],a[1])}}function M3(e){return e.mainType==="angleAxis"}function I3(e,t){e.type=t.get("type");e.scale=dS(t);e.onBand=t.get("boundaryGap")&&e.type==="category";e.inverse=t.get("inverse");if(M3(t)){e.inverse=e.inverse!==t.get("clockwise");var r=t.get("startAngle");e.setExtent(r,r+(e.inverse?-360:360))}t.axis=e;e.model=t}var C3={dimensions:_3.prototype.dimensions,create:function(e,s){var l=[];e.eachComponent("polar",function(e,t){var r=new _3(t+"");r.update=S3;var i=r.getRadiusAxis();var n=r.getAngleAxis();var a=e.findAxisModel("radiusAxis");var o=e.findAxisModel("angleAxis");I3(i,a);I3(n,o);w3(r,e,s);l.push(r);e.coordinateSystem=r;r.model=e});e.eachSeries(function(e){if(e.get("coordinateSystem")==="polar"){var t=e.getReferringComponents("polar",$a).models[0];if("development"!=="production"){if(!t){throw new Error('Polar "'+be(e.get("polarIndex"),e.get("polarId"),0)+'" not found')}}e.coordinateSystem=t.coordinateSystem}});return l}};var T3=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function D3(e,t,r){t[1]>t[0]&&(t=t.slice().reverse());var i=e.coordToPoint([t[0],r]);var n=e.coordToPoint([t[1],r]);return{x1:i[0],y1:i[1],x2:n[0],y2:n[1]}}function A3(e){var t=e.getRadiusAxis();return t.inverse?0:1}function L3(e){var t=e[0];var r=e[e.length-1];if(t&&r&&Math.abs(Math.abs(t.coord-r.coord)-360)<1e-4){e.pop()}}var k3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.axisPointerClass="PolarAxisPointer";return e}r.prototype.render=function(t,e){this.group.removeAll();if(!t.get("show")){return}var i=t.axis;var r=i.polar;var n=r.getRadiusAxis().getExtent();var a=i.getTicksCoords();var o=i.getMinorTicksCoords();var s=A(i.getViewLabels(),function(e){e=M(e);var t=i.scale;var r=t.type==="ordinal"?t.getRawOrdinalNumber(e.tickValue):e.tickValue;e.coord=i.dataToCoord(r);return e});L3(s);L3(a);U(T3,function(e){if(t.get([e,"show"])&&(!i.scale.isBlank()||e==="axisLine")){P3[e](this.group,t,r,a,o,n,s)}},this)};r.type="angleAxis";return r}(lT);var P3={axisLine:function(e,t,r,i,n,a){var o=t.getModel(["axisLine","lineStyle"]);var s=A3(r);var l=s?0:1;var u;if(a[l]===0){u=new Rc({shape:{cx:r.cx,cy:r.cy,r:a[s]},style:o.getLineStyle(),z2:1,silent:true})}else{u=new rf({shape:{cx:r.cx,cy:r.cy,r:a[s],r0:a[l]},style:o.getLineStyle(),z2:1,silent:true})}u.style.fill=null;e.add(u)},axisTick:function(e,t,r,i,n,a){var o=t.getModel("axisTick");var s=(o.get("inside")?-1:1)*o.get("length");var l=a[A3(r)];var u=A(i,function(e){return new vf({shape:D3(r,[l,l+s],e.coord)})});e.add(Wf(u,{style:R(o.getModel("lineStyle").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})}))},minorTick:function(e,t,r,i,n,a){if(!n.length){return}var o=t.getModel("axisTick");var s=t.getModel("minorTick");var l=(o.get("inside")?-1:1)*s.get("length");var u=a[A3(r)];var c=[];for(var f=0;f<n.length;f++){for(var h=0;h<n[f].length;h++){c.push(new vf({shape:D3(r,[u,u+l],n[f][h].coord)}))}}e.add(Wf(c,{style:R(s.getModel("lineStyle").getLineStyle(),R(o.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}))}))},axisLabel:function(p,v,d,e,t,g,r){var y=v.getCategories(true);var m=v.getModel("axisLabel");var x=m.get("margin");var _=v.get("triggerEvent");U(r,function(e,t){var r=m;var i=e.tickValue;var n=g[A3(d)];var a=d.coordToPoint([n+x,e.coord]);var o=d.cx;var s=d.cy;var l=Math.abs(a[0]-o)/n<.3?"center":a[0]>o?"left":"right";var u=Math.abs(a[1]-s)/n<.3?"middle":a[1]>s?"top":"bottom";if(y&&y[i]){var c=y[i];if(O(c)&&c.textStyle){r=new C(c.textStyle,m,m.ecModel)}}var f=new W({silent:V2.isLabelSilent(v),style:_h(r,{x:a[0],y:a[1],fill:r.getTextColor()||v.get(["axisLine","lineStyle","color"]),text:e.formattedLabel,align:l,verticalAlign:u})});p.add(f);if(_){var h=V2.makeAxisEventDataBase(v);h.targetType="axisLabel";h.value=e.rawLabel;j(f).eventData=h}},this)},splitLine:function(e,t,r,i,n,a){var o=t.getModel("splitLine");var s=o.getModel("lineStyle");var l=s.get("color");var u=0;l=l instanceof Array?l:[l];var c=[];for(var f=0;f<i.length;f++){var h=u++%l.length;c[h]=c[h]||[];c[h].push(new vf({shape:D3(r,a,i[f].coord)}))}for(var f=0;f<c.length;f++){e.add(Wf(c[f],{style:R({stroke:l[f%l.length]},s.getLineStyle()),silent:true,z:t.get("z")}))}},minorSplitLine:function(e,t,r,i,n,a){if(!n.length){return}var o=t.getModel("minorSplitLine");var s=o.getModel("lineStyle");var l=[];for(var u=0;u<n.length;u++){for(var c=0;c<n[u].length;c++){l.push(new vf({shape:D3(r,a,n[u][c].coord)}))}}e.add(Wf(l,{style:s.getLineStyle(),silent:true,z:t.get("z")}))},splitArea:function(e,t,r,i,n,a){if(!i.length){return}var o=t.getModel("splitArea");var s=o.getModel("areaStyle");var l=s.get("color");var u=0;l=l instanceof Array?l:[l];var c=[];var f=Math.PI/180;var h=-i[0].coord*f;var p=Math.min(a[0],a[1]);var v=Math.max(a[0],a[1]);var d=t.get("clockwise");for(var g=1,y=i.length;g<=y;g++){var m=g===y?i[0].coord:i[g].coord;var x=u++%l.length;c[x]=c[x]||[];c[x].push(new ef({shape:{cx:r.cx,cy:r.cy,r0:p,r:v,startAngle:h,endAngle:-m*f,clockwise:d},silent:true}));h=-m*f}for(var g=0;g<c.length;g++){e.add(Wf(c[g],{style:R({fill:l[g%l.length]},s.getAreaStyle()),silent:true}))}}};var O3=["axisLine","axisTickLabel","axisName"];var N3=["splitLine","splitArea","minorSplitLine"];var E3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.axisPointerClass="PolarAxisPointer";return e}r.prototype.render=function(t,e){this.group.removeAll();if(!t.get("show")){return}var r=this._axisGroup;var i=this._axisGroup=new H;this.group.add(i);var n=t.axis;var a=n.polar;var o=a.getAngleAxis();var s=n.getTicksCoords();var l=n.getMinorTicksCoords();var u=o.getExtent()[0];var c=n.getExtent();var f=z3(a,t,u);var h=new V2(t,f);U(O3,h.add,h);i.add(h.getGroup());ah(r,i,t);U(N3,function(e){if(t.get([e,"show"])&&!n.scale.isBlank()){R3[e](this.group,t,a,u,c,s,l)}},this)};r.type="radiusAxis";return r}(lT);var R3={splitLine:function(e,t,r,i,n,a){var o=t.getModel("splitLine");var s=o.getModel("lineStyle");var l=s.get("color");var u=0;l=l instanceof Array?l:[l];var c=[];for(var f=0;f<a.length;f++){var h=u++%l.length;c[h]=c[h]||[];c[h].push(new Rc({shape:{cx:r.cx,cy:r.cy,r:a[f].coord}}))}for(var f=0;f<c.length;f++){e.add(Wf(c[f],{style:R({stroke:l[f%l.length],fill:null},s.getLineStyle()),silent:true}))}},minorSplitLine:function(e,t,r,i,n,a,o){if(!o.length){return}var s=t.getModel("minorSplitLine");var l=s.getModel("lineStyle");var u=[];for(var c=0;c<o.length;c++){for(var f=0;f<o[c].length;f++){u.push(new Rc({shape:{cx:r.cx,cy:r.cy,r:o[c][f].coord}}))}}e.add(Wf(u,{style:R({fill:null},l.getLineStyle()),silent:true}))},splitArea:function(e,t,r,i,n,a){if(!a.length){return}var o=t.getModel("splitArea");var s=o.getModel("areaStyle");var l=s.get("color");var u=0;l=l instanceof Array?l:[l];var c=[];var f=a[0].coord;for(var h=1;h<a.length;h++){var p=u++%l.length;c[p]=c[p]||[];c[p].push(new ef({shape:{cx:r.cx,cy:r.cy,r0:f,r:a[h].coord,startAngle:0,endAngle:Math.PI*2},silent:true}));f=a[h].coord}for(var h=0;h<c.length;h++){e.add(Wf(c[h],{style:R({fill:l[h%l.length]},s.getAreaStyle()),silent:true}))}}};function z3(e,t,r){return{position:[e.cx,e.cy],rotation:r/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:t.getModel("axisLabel").get("rotate"),z2:1}}function B3(e){return e.get("stack")||"__ec_stack_"+e.seriesIndex}function V3(e,t){return t.dim+e.model.componentIndex}function G3(e,t,r){var O={};var N=F3(ue(t.getSeriesByType(e),function(e){return!t.isSeriesFiltered(e)&&e.coordinateSystem&&e.coordinateSystem.type==="polar"}));t.eachSeriesByType(e,function(e){if(e.coordinateSystem.type!=="polar"){return}var t=e.getData();var r=e.coordinateSystem;var i=r.getBaseAxis();var n=V3(r,i);var a=B3(e);var o=N[n][a];var s=o.offset;var l=o.width;var u=r.getOtherAxis(i);var c=e.coordinateSystem.cx;var f=e.coordinateSystem.cy;var h=e.get("barMinHeight")||0;var p=e.get("barMinAngle")||0;O[a]=O[a]||[];var v=t.mapDimension(u.dim);var d=t.mapDimension(i.dim);var g=aw(t,v);var y=i.dim!=="radius"||!e.get("roundCap",true);var m=u.dataToCoord(0);for(var x=0,_=t.count();x<_;x++){var b=t.get(v,x);var w=t.get(d,x);var S=b>=0?"p":"n";var M=m;if(g){if(!O[a][w]){O[a][w]={p:m,n:m}}M=O[a][w][S]}var I=void 0;var C=void 0;var T=void 0;var D=void 0;if(u.dim==="radius"){var A=u.dataToCoord(b)-m;var L=i.dataToCoord(w);if(Math.abs(A)<h){A=(A<0?-1:1)*h}I=M;C=M+A;T=L-s;D=T-l;g&&(O[a][w][S]=C)}else{var k=u.dataToCoord(b,y)-m;var P=i.dataToCoord(w);if(Math.abs(k)<p){k=(k<0?-1:1)*p}I=P+s;C=I+l;T=M;D=M+k;g&&(O[a][w][S]=D)}t.setItemLayout(x,{cx:c,cy:f,r0:I,r:C,startAngle:-T*Math.PI/180,endAngle:-D*Math.PI/180})}})}function F3(e){var d={};U(e,function(e,t){var r=e.getData();var i=e.coordinateSystem;var n=i.getBaseAxis();var a=V3(i,n);var o=n.getExtent();var s=n.type==="category"?n.getBandWidth():Math.abs(o[1]-o[0])/r.count();var l=d[a]||{bandWidth:s,remainedWidth:s,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}};var u=l.stacks;d[a]=l;var c=B3(e);if(!u[c]){l.autoWidthCount++}u[c]=u[c]||{width:0,maxWidth:0};var f=Y(e.get("barWidth"),s);var h=Y(e.get("barMaxWidth"),s);var p=e.get("barGap");var v=e.get("barCategoryGap");if(f&&!u[c].width){f=Math.min(l.remainedWidth,f);u[c].width=f;l.remainedWidth-=f}h&&(u[c].maxWidth=h);p!=null&&(l.gap=p);v!=null&&(l.categoryGap=v)});var h={};U(d,function(e,r){h[r]={};var t=e.stacks;var i=e.bandWidth;var n=Y(e.categoryGap,i);var a=Y(e.gap,1);var o=e.remainedWidth;var s=e.autoWidthCount;var l=(o-n)/(s+(s-1)*a);l=Math.max(l,0);U(t,function(e,t){var r=e.maxWidth;if(r&&r<l){r=Math.min(r,o);if(e.width){r=Math.min(r,e.width)}o-=r;e.width=r;s--}});l=(o-n)/(s+(s-1)*a);l=Math.max(l,0);var u=0;var c;U(t,function(e,t){if(!e.width){e.width=l}c=e;u+=e.width*(1+a)});if(c){u-=c.width*a}var f=-u/2;U(t,function(e,t){h[r][t]=h[r][t]||{offset:f,width:e.width};f+=e.width*(1+a)})});return h}var H3={startAngle:90,clockwise:true,splitNumber:12,axisLabel:{rotate:0}};var W3={splitNumber:5};var j3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="polar";return r}(My);function U3(e){t(l3);lT.registerAxisPointerClass("PolarAxisPointer",c3);e.registerCoordinateSystem("polar",C3);e.registerComponentModel(p3);e.registerComponentView(j3);S2(e,"angle",d3,H3);S2(e,"radius",g3,W3);e.registerComponentView(k3);e.registerComponentView(E3);e.registerLayout(_(G3,"bar"))}function Z3(e,t){t=t||{};var r=e.coordinateSystem;var i=e.axis;var n={};var a=i.position;var o=i.orient;var s=r.getRect();var l=[s.x,s.x+s.width,s.y,s.y+s.height];var u={horizontal:{top:l[2],bottom:l[3]},vertical:{left:l[0],right:l[1]}};n.position=[o==="vertical"?u.vertical[a]:l[0],o==="horizontal"?u.horizontal[a]:l[3]];var c={horizontal:0,vertical:1};n.rotation=Math.PI/2*c[o];var f={top:-1,bottom:1,right:1,left:-1};n.labelDirection=n.tickDirection=n.nameDirection=f[a];if(e.get(["axisTick","inside"])){n.tickDirection=-n.tickDirection}if(be(t.labelInside,e.get(["axisLabel","inside"]))){n.labelDirection=-n.labelDirection}var h=t.rotate;h==null&&(h=e.get(["axisLabel","rotate"]));n.labelRotation=a==="top"?-h:h;n.z2=1;return n}var Y3=["axisLine","axisTickLabel","axisName"];var X3=["splitArea","splitLine"];var q3=function(l){d(t,l);function t(){var e=l!==null&&l.apply(this,arguments)||this;e.type=t.type;e.axisPointerClass="SingleAxisPointer";return e}t.prototype.render=function(t,e,r,i){var n=this.group;n.removeAll();var a=this._axisGroup;this._axisGroup=new H;var o=Z3(t);var s=new V2(t,o);U(Y3,s.add,s);n.add(this._axisGroup);n.add(s.getGroup());U(X3,function(e){if(t.get([e,"show"])){J3[e](this,this.group,this._axisGroup,t)}},this);ah(a,this._axisGroup,t);l.prototype.render.call(this,t,e,r,i)};t.prototype.remove=function(){fT(this)};t.type="singleAxis";return t}(lT);var J3={splitLine:function(e,t,r,i){var n=i.axis;if(n.scale.isBlank()){return}var a=i.getModel("splitLine");var o=a.getModel("lineStyle");var s=o.get("color");s=s instanceof Array?s:[s];var l=i.coordinateSystem.getRect();var u=n.isHorizontal();var c=[];var f=0;var h=n.getTicksCoords({tickModel:a});var p=[];var v=[];for(var d=0;d<h.length;++d){var g=n.toGlobalCoord(h[d].coord);if(u){p[0]=g;p[1]=l.y;v[0]=g;v[1]=l.y+l.height}else{p[0]=l.x;p[1]=g;v[0]=l.x+l.width;v[1]=g}var y=f++%s.length;c[y]=c[y]||[];c[y].push(new vf({subPixelOptimize:true,shape:{x1:p[0],y1:p[1],x2:v[0],y2:v[1]},silent:true}))}var m=o.getLineStyle(["color"]);for(var d=0;d<c.length;++d){t.add(Wf(c[d],{style:R({stroke:s[d%s.length]},m),silent:true}))}},splitArea:function(e,t,r,i){cT(e,r,i,i)}};var K3=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.getCoordSysModel=function(){return this};r.type="singleAxis";r.layoutMode="box";r.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:true,lineStyle:{width:1,type:"solid"}},tooltip:{show:true},axisTick:{show:true,length:6,lineStyle:{width:1}},axisLabel:{show:true,interval:"auto"},splitLine:{show:true,lineStyle:{type:"dashed",opacity:.2}}};return r}(p);oe(K3,IS.prototype);var Q3=function(o){d(e,o);function e(e,t,r,i,n){var a=o.call(this,e,t,r)||this;a.type=i||"value";a.position=n||"bottom";return a}e.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"};e.prototype.pointToData=function(e,t){return this.coordinateSystem.pointToData(e)[0]};return e}($S);var $3=function(){function e(e,t,r){this.type="single";this.dimension="single";this.dimensions=["single"];this.axisPointerEnabled=true;this.model=e;this._init(e,t,r)}e.prototype._init=function(e,t,r){var i=this.dimension;var n=new Q3(i,dS(e),[0,0],e.get("type"),e.get("position"));var a=n.type==="category";n.onBand=a&&e.get("boundaryGap");n.inverse=e.get("inverse");n.orient=e.get("orient");e.axis=n;n.model=e;n.coordinateSystem=this;this._axis=n};e.prototype.update=function(e,t){e.eachSeries(function(e){if(e.coordinateSystem===this){var t=e.getData();U(t.mapDimensionsAll(this.dimension),function(e){this._axis.scale.unionExtentFromData(t,e)},this);vS(this._axis.scale,this._axis.model)}},this)};e.prototype.resize=function(e,t){this._rect=sv({left:e.get("left"),top:e.get("top"),right:e.get("right"),bottom:e.get("bottom"),width:e.get("width"),height:e.get("height")},{width:t.getWidth(),height:t.getHeight()});this._adjustAxis()};e.prototype.getRect=function(){return this._rect};e.prototype._adjustAxis=function(){var e=this._rect;var t=this._axis;var r=t.isHorizontal();var i=r?[0,e.width]:[0,e.height];var n=t.reverse?1:0;t.setExtent(i[n],i[1-n]);this._updateAxisTransform(t,r?e.x:e.y)};e.prototype._updateAxisTransform=function(e,t){var r=e.getExtent();var i=r[0]+r[1];var n=e.isHorizontal();e.toGlobalCoord=n?function(e){return e+t}:function(e){return i-e+t};e.toLocalCoord=n?function(e){return e-t}:function(e){return i-e+t}};e.prototype.getAxis=function(){return this._axis};e.prototype.getBaseAxis=function(){return this._axis};e.prototype.getAxes=function(){return[this._axis]};e.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}};e.prototype.containPoint=function(e){var t=this.getRect();var r=this.getAxis();var i=r.orient;if(i==="horizontal"){return r.contain(r.toLocalCoord(e[0]))&&e[1]>=t.y&&e[1]<=t.y+t.height}else{return r.contain(r.toLocalCoord(e[1]))&&e[0]>=t.y&&e[0]<=t.y+t.height}};e.prototype.pointToData=function(e){var t=this.getAxis();return[t.coordToData(t.toLocalCoord(e[t.orient==="horizontal"?0:1]))]};e.prototype.dataToPoint=function(e){var t=this.getAxis();var r=this.getRect();var i=[];var n=t.orient==="horizontal"?0:1;if(e instanceof Array){e=e[0]}i[n]=t.toGlobalCoord(t.dataToCoord(+e));i[1-n]=n===0?r.y+r.height/2:r.x+r.width/2;return i};e.prototype.convertToPixel=function(e,t,r){var i=eV(t);return i===this?this.dataToPoint(r):null};e.prototype.convertFromPixel=function(e,t,r){var i=eV(t);return i===this?this.pointToData(r):null};return e}();function eV(e){var t=e.seriesModel;var r=e.singleAxisModel;return r&&r.coordinateSystem||t&&t.coordinateSystem}function tV(i,n){var a=[];i.eachComponent("singleAxis",function(e,t){var r=new $3(e,i,n);r.name="single_"+t;r.resize(e,n);e.coordinateSystem=r;a.push(r)});i.eachSeries(function(e){if(e.get("coordinateSystem")==="singleAxis"){var t=e.getReferringComponents("singleAxis",$a).models[0];e.coordinateSystem=t&&t.coordinateSystem}});return a}var rV={create:tV,dimensions:$3.prototype.dimensions};var iV=["x","y"];var nV=["width","height"];var aV=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.makeElOption=function(e,t,r,i,n){var a=r.axis;var o=a.coordinateSystem;var s=lV(o,1-sV(a));var l=o.dataToPoint(t)[0];var u=i.get("type");if(u&&u!=="none"){var c=IB(i);var f=oV[u](a,l,s);f.style=c;e.graphicKey=f.type;e.pointer=f}var h=Z3(r);LB(t,e,h,r,i,n)};t.prototype.getHandleTransform=function(e,t,r){var i=Z3(t,{labelInside:false});i.labelMargin=r.get(["handle","margin"]);var n=AB(t.axis,e,i);return{x:n[0],y:n[1],rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}};t.prototype.updateHandleTransform=function(e,t,r,i){var n=r.axis;var a=n.coordinateSystem;var o=sV(n);var s=lV(a,o);var l=[e.x,e.y];l[o]+=t[o];l[o]=Math.min(s[1],l[o]);l[o]=Math.max(s[0],l[o]);var u=lV(a,1-o);var c=(u[1]+u[0])/2;var f=[c,c];f[o]=l[o];return{x:l[0],y:l[1],rotation:e.rotation,cursorPoint:f,tooltipOption:{verticalAlign:"middle"}}};return t}(xB);var oV={line:function(e,t,r){var i=kB([t,r[0]],[t,r[1]],sV(e));return{type:"Line",subPixelOptimize:true,shape:i}},shadow:function(e,t,r){var i=e.getBandWidth();var n=r[1]-r[0];return{type:"Rect",shape:PB([t-i/2,r[0]],[i,n],sV(e))}}};function sV(e){return e.isHorizontal()?0:1}function lV(e,t){var r=e.getRect();return[r[iV[t]],r[iV[t]]+r[nV[t]]]}var uV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="single";return r}(My);function cV(e){t(l3);lT.registerAxisPointerClass("SingleAxisPointer",aV);e.registerComponentView(uV);e.registerComponentView(q3);e.registerComponentModel(K3);S2(e,"single",K3,K3.defaultOption);e.registerCoordinateSystem("single",rV)}var fV=function(n){d(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.init=function(e,t,r){var i=hv(e);n.prototype.init.apply(this,arguments);hV(e,i)};t.prototype.mergeOption=function(e){n.prototype.mergeOption.apply(this,arguments);hV(this.option,e)};t.prototype.getCellSize=function(){return this.option.cellSize};t.type="calendar";t.defaultOption={zlevel:0,z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:true,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{color:"#fff",borderWidth:1,borderColor:"#ccc"},dayLabel:{show:true,firstDay:0,position:"start",margin:"50%",nameMap:"en",color:"#000"},monthLabel:{show:true,position:"start",margin:5,align:"center",nameMap:"en",formatter:null,color:"#000"},yearLabel:{show:true,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}};return t}(p);function hV(e,t){var r=e.cellSize;var i;if(!k(r)){i=e.cellSize=[r,r]}else{i=r}if(i.length===1){i[1]=i[0]}var n=A([0,1],function(e){if(uv(t,e)){i[e]="auto"}return i[e]!=null&&i[e]!=="auto"});fv(e,t,{type:"box",ignoreSize:n})}var pV={EN:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CN:["","","","","","","","","","","",""]};var vV={EN:["S","M","T","W","T","F","S"],CN:["","","","","","",""]};var dV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){var i=this.group;i.removeAll();var n=e.coordinateSystem;var a=n.getRangeInfo();var o=n.getOrient();this._renderDayRect(e,a,i);this._renderLines(e,a,o,i);this._renderYearText(e,a,o,i);this._renderMonthText(e,o,i);this._renderWeekText(e,a,o,i)};r.prototype._renderDayRect=function(e,t,r){var i=e.coordinateSystem;var n=e.getModel("itemStyle").getItemStyle();var a=i.getCellWidth();var o=i.getCellHeight();for(var s=t.start.time;s<=t.end.time;s=i.getNextNDay(s,1).time){var l=i.dataToRect([s],false).tl;var u=new G({shape:{x:l[0],y:l[1],width:a,height:o},cursor:"default",style:n});r.add(u)}};r.prototype._renderLines=function(r,e,i,n){var a=this;var o=r.coordinateSystem;var s=r.getModel(["splitLine","lineStyle"]).getLineStyle();var l=r.get(["splitLine","show"]);var t=s.lineWidth;this._tlpoints=[];this._blpoints=[];this._firstDayOfMonth=[];this._firstDayPoints=[];var u=e.start;for(var c=0;u.time<=e.end.time;c++){h(u.formatedDate);if(c===0){u=o.getDateInfo(e.start.y+"-"+e.start.m)}var f=u.date;f.setMonth(f.getMonth()+1);u=o.getDateInfo(f)}h(o.getNextNDay(e.end.time,1).formatedDate);function h(e){a._firstDayOfMonth.push(o.getDateInfo(e));a._firstDayPoints.push(o.dataToRect([e],false).tl);var t=a._getLinePointsOfOneWeek(r,e,i);a._tlpoints.push(t[0]);a._blpoints.push(t[t.length-1]);l&&a._drawSplitline(t,s,n)}l&&this._drawSplitline(a._getEdgesPoints(a._tlpoints,t,i),s,n);l&&this._drawSplitline(a._getEdgesPoints(a._blpoints,t,i),s,n)};r.prototype._getEdgesPoints=function(e,t,r){var i=[e[0].slice(),e[e.length-1].slice()];var n=r==="horizontal"?0:1;i[0][n]=i[0][n]-t/2;i[1][n]=i[1][n]+t/2;return i};r.prototype._drawSplitline=function(e,t,r){var i=new ff({z2:20,shape:{points:e},style:t});r.add(i)};r.prototype._getLinePointsOfOneWeek=function(e,t,r){var i=e.coordinateSystem;var n=i.getDateInfo(t);var a=[];for(var o=0;o<7;o++){var s=i.getNextNDay(n.time,o);var l=i.dataToRect([s.time],false);a[2*s.day]=l.tl;a[2*s.day+1]=l[r==="horizontal"?"bl":"tr"]}return a};r.prototype._formatterLabel=function(e,t){if(typeof e==="string"&&e){return Yp(e,t)}if(typeof e==="function"){return e(t)}return t.nameMap};r.prototype._yearTextPositionControl=function(e,t,r,i,n){var a=t[0];var o=t[1];var s=["center","bottom"];if(i==="bottom"){o+=n;s=["center","top"]}else if(i==="left"){a-=n}else if(i==="right"){a+=n;s=["center","top"]}else{o-=n}var l=0;if(i==="left"||i==="right"){l=Math.PI/2}return{rotation:l,x:a,y:o,style:{align:s[0],verticalAlign:s[1]}}};r.prototype._renderYearText=function(e,t,r,i){var n=e.getModel("yearLabel");if(!n.get("show")){return}var a=n.get("margin");var o=n.get("position");if(!o){o=r!=="horizontal"?"top":"left"}var s=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]];var l=(s[0][0]+s[1][0])/2;var u=(s[0][1]+s[1][1])/2;var c=r==="horizontal"?0:1;var f={top:[l,s[c][1]],bottom:[l,s[1-c][1]],left:[s[1-c][0],u],right:[s[c][0],u]};var h=t.start.y;if(+t.end.y>+t.start.y){h=h+"-"+t.end.y}var p=n.get("formatter");var v={start:t.start.y,end:t.end.y,nameMap:h};var d=this._formatterLabel(p,v);var g=new W({z2:30,style:_h(n,{text:d})});g.attr(this._yearTextPositionControl(g,f[o],r,o,a));i.add(g)};r.prototype._monthTextPositionControl=function(e,t,r,i,n){var a="left";var o="top";var s=e[0];var l=e[1];if(r==="horizontal"){l=l+n;if(t){a="center"}if(i==="start"){o="bottom"}}else{s=s+n;if(t){o="middle"}if(i==="start"){a="right"}}return{x:s,y:l,align:a,verticalAlign:o}};r.prototype._renderMonthText=function(e,t,r){var i=e.getModel("monthLabel");if(!i.get("show")){return}var n=i.get("nameMap");var a=i.get("margin");var o=i.get("position");var s=i.get("align");var l=[this._tlpoints,this._blpoints];if(P(n)){n=pV[n.toUpperCase()]||[]}var u=o==="start"?0:1;var c=t==="horizontal"?0:1;a=o==="start"?-a:a;var f=s==="center";for(var h=0;h<l[u].length-1;h++){var p=l[u][h].slice();var v=this._firstDayOfMonth[h];if(f){var d=this._firstDayPoints[h];p[c]=(d[c]+l[0][h+1][c])/2}var g=i.get("formatter");var y=n[+v.m-1];var m={yyyy:v.y,yy:(v.y+"").slice(2),MM:v.m,M:+v.m,nameMap:y};var x=this._formatterLabel(g,m);var _=new W({z2:30,style:F(_h(i,{text:x}),this._monthTextPositionControl(p,f,t,o,a))});r.add(_)}};r.prototype._weekTextPositionControl=function(e,t,r,i,n){var a="center";var o="middle";var s=e[0];var l=e[1];var u=r==="start";if(t==="horizontal"){s=s+i+(u?1:-1)*n[0]/2;a=u?"right":"left"}else{l=l+i+(u?1:-1)*n[1]/2;o=u?"bottom":"top"}return{x:s,y:l,align:a,verticalAlign:o}};r.prototype._renderWeekText=function(e,t,r,i){var n=e.getModel("dayLabel");if(!n.get("show")){return}var a=e.coordinateSystem;var o=n.get("position");var s=n.get("nameMap");var l=n.get("margin");var u=a.getFirstDayOfWeek();if(P(s)){s=vV[s.toUpperCase()]||[]}var c=a.getNextNDay(t.end.time,7-t.lweek).time;var f=[a.getCellWidth(),a.getCellHeight()];l=Y(l,Math.min(f[1],f[0]));if(o==="start"){c=a.getNextNDay(t.start.time,-(7+t.fweek)).time;l=-l}for(var h=0;h<7;h++){var p=a.getNextNDay(c,h);var v=a.dataToRect([p.time],false).center;var d=h;d=Math.abs((h+u)%7);var g=new W({z2:30,style:F(_h(n,{text:s[d]}),this._weekTextPositionControl(v,r,o,l,f))});i.add(g)}};r.type="calendar";return r}(My);var gV=864e5;var yV=function(){function a(e,t,r){this.type="calendar";this.dimensions=a.dimensions;this.getDimensionsInfo=a.getDimensionsInfo;this._model=e}a.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]};a.prototype.getRangeInfo=function(){return this._rangeInfo};a.prototype.getModel=function(){return this._model};a.prototype.getRect=function(){return this._rect};a.prototype.getCellWidth=function(){return this._sw};a.prototype.getCellHeight=function(){return this._sh};a.prototype.getOrient=function(){return this._orient};a.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek};a.prototype.getDateInfo=function(e){e=ia(e);var t=e.getFullYear();var r=e.getMonth()+1;var i=r<10?"0"+r:""+r;var n=e.getDate();var a=n<10?"0"+n:""+n;var o=e.getDay();o=Math.abs((o+7-this.getFirstDayOfWeek())%7);return{y:t+"",m:i,d:a,day:o,time:e.getTime(),formatedDate:t+"-"+i+"-"+a,date:e}};a.prototype.getNextNDay=function(e,t){t=t||0;if(t===0){return this.getDateInfo(e)}e=new Date(this.getDateInfo(e).time);e.setDate(e.getDate()+t);return this.getDateInfo(e)};a.prototype.update=function(e,t){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay");this._orient=this._model.get("orient");this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0;this._rangeInfo=this._getRangeInfo(this._initRangeOption());var r=this._rangeInfo.weeks||1;var i=["width","height"];var n=this._model.getCellSize().slice();var a=this._model.getBoxLayoutParams();var o=this._orient==="horizontal"?[r,7]:[7,r];U([0,1],function(e){if(u(n,e)){a[i[e]]=n[e]*o[e]}});var s={width:t.getWidth(),height:t.getHeight()};var l=this._rect=sv(a,s);U([0,1],function(e){if(!u(n,e)){n[e]=l[i[e]]/o[e]}});function u(e,t){return e[t]!=null&&e[t]!=="auto"}this._sw=n[0];this._sh=n[1]};a.prototype.dataToPoint=function(e,t){k(e)&&(e=e[0]);t==null&&(t=true);var r=this.getDateInfo(e);var i=this._rangeInfo;var n=r.formatedDate;if(t&&!(r.time>=i.start.time&&r.time<i.end.time+gV)){return[NaN,NaN]}var a=r.day;var o=this._getRangeInfo([i.start.time,n]).nthWeek;if(this._orient==="vertical"){return[this._rect.x+a*this._sw+this._sw/2,this._rect.y+o*this._sh+this._sh/2]}return[this._rect.x+o*this._sw+this._sw/2,this._rect.y+a*this._sh+this._sh/2]};a.prototype.pointToData=function(e){var t=this.pointToDate(e);return t&&t.time};a.prototype.dataToRect=function(e,t){var r=this.dataToPoint(e,t);return{contentShape:{x:r[0]-(this._sw-this._lineWidth)/2,y:r[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:r,tl:[r[0]-this._sw/2,r[1]-this._sh/2],tr:[r[0]+this._sw/2,r[1]-this._sh/2],br:[r[0]+this._sw/2,r[1]+this._sh/2],bl:[r[0]-this._sw/2,r[1]+this._sh/2]}};a.prototype.pointToDate=function(e){var t=Math.floor((e[0]-this._rect.x)/this._sw)+1;var r=Math.floor((e[1]-this._rect.y)/this._sh)+1;var i=this._rangeInfo.range;if(this._orient==="vertical"){return this._getDateByWeeksAndDay(r,t-1,i)}return this._getDateByWeeksAndDay(t,r-1,i)};a.prototype.convertToPixel=function(e,t,r){var i=mV(t);return i===this?i.dataToPoint(r):null};a.prototype.convertFromPixel=function(e,t,r){var i=mV(t);return i===this?i.pointToData(r):null};a.prototype.containPoint=function(e){console.warn("Not implemented.");return false};a.prototype._initRangeOption=function(){var e=this._model.get("range");var t;if(k(e)&&e.length===1){e=e[0]}if(!k(e)){var r=e.toString();if(/^\d{4}$/.test(r)){t=[r+"-01-01",r+"-12-31"]}if(/^\d{4}[\/|-]\d{1,2}$/.test(r)){var i=this.getDateInfo(r);var n=i.date;n.setMonth(n.getMonth()+1);var a=this.getNextNDay(n,-1);t=[i.formatedDate,a.formatedDate]}if(/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(r)){t=[r,r]}}else{t=e}if(!t){if("development"!=="production"){re("Invalid date range.")}return e}var o=this._getRangeInfo(t);if(o.start.time>o.end.time){t.reverse()}return t};a.prototype._getRangeInfo=function(e){var t=[this.getDateInfo(e[0]),this.getDateInfo(e[1])];var r;if(t[0].time>t[1].time){r=true;t.reverse()}var i=Math.floor(t[1].time/gV)-Math.floor(t[0].time/gV)+1;var n=new Date(t[0].time);var a=n.getDate();var o=t[1].date.getDate();n.setDate(a+i-1);var s=n.getDate();if(s!==o){var l=n.getTime()-t[1].time>0?1:-1;while((s=n.getDate())!==o&&(n.getTime()-t[1].time)*l>0){i-=l;n.setDate(s-l)}}var u=Math.floor((i+t[0].day+6)/7);var c=r?-u+1:u-1;r&&t.reverse();return{range:[t[0].formatedDate,t[1].formatedDate],start:t[0],end:t[1],allDay:i,weeks:u,nthWeek:c,fweek:t[0].day,lweek:t[1].day}};a.prototype._getDateByWeeksAndDay=function(e,t,r){var i=this._getRangeInfo(r);if(e>i.weeks||e===0&&t<i.fweek||e===i.weeks&&t>i.lweek){return null}var n=(e-1)*7-i.fweek+t;var a=new Date(i.start.time);a.setDate(+i.start.d+n);return this.getDateInfo(a)};a.create=function(r,i){var n=[];r.eachComponent("calendar",function(e){var t=new a(e,r,i);n.push(t);e.coordinateSystem=t});r.eachSeries(function(e){if(e.get("coordinateSystem")==="calendar"){e.coordinateSystem=n[e.get("calendarIndex")||0]}});return n};a.dimensions=["time","value"];return a}();function mV(e){var t=e.calendarModel;var r=e.seriesModel;var i=t?t.coordinateSystem:r?r.coordinateSystem:null;return i}function xV(e){e.registerComponentModel(fV);e.registerComponentView(dV);e.registerCoordinateSystem("calendar",yV)}var _V=qa();var bV={path:null,compoundPath:null,group:H,image:Rl,text:W};var wV=function(e){var t=e.graphic;if(k(t)){if(!t[0]||!t[0].elements){e.graphic=[{elements:t}]}else{e.graphic=[e.graphic[0]]}}else if(t&&!t.elements){e.graphic=[{elements:[t]}]}};var SV=function(i){d(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;e.type=t.type;e.preventAutoZ=true;return e}t.prototype.mergeOption=function(e,t){var r=this.option.elements;this.option.elements=null;i.prototype.mergeOption.call(this,e,t);this.option.elements=r};t.prototype.optionUpdated=function(e,t){var r=this.option;var i=(t?r:e).elements;var n=r.elements=t?[]:r.elements;var a=[];this._flatten(i,a,null);var o=La(n,a,"normalMerge");var s=this._elOptionsToUpdate=[];U(o,function(e,t){var r=e.newOption;if("development"!=="production"){E(O(r)||e.existing,"Empty graphic option definition")}if(!r){return}s.push(r);AV(e,r);LV(n,t,r);kV(n[t],r)},this);for(var l=n.length-1;l>=0;l--){if(n[l]==null){n.splice(l,1)}else{delete n[l].$action}}};t.prototype._flatten=function(e,r,i){U(e,function(e){if(!e){return}if(i){e.parentOption=i}r.push(e);var t=e.children;if(e.type==="group"&&t){this._flatten(t,r,e)}delete e.children},this)};t.prototype.useElOptionsToUpdate=function(){var e=this._elOptionsToUpdate;this._elOptionsToUpdate=null;return e};t.type="graphic";t.defaultOption={elements:[]};return t}(p);var MV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(){this._elMap=I()};r.prototype.render=function(e,t,r){if(e!==this._lastGraphicModel){this._clear()}this._lastGraphicModel=e;this._updateElements(e);this._relocate(e,r)};r.prototype._updateElements=function(d){var e=d.useElOptionsToUpdate();if(!e){return}var g=this._elMap;var y=this.group;U(e,function(e){var t=Va(e.id,null);var r=t!=null?g.get(t):null;var i=Va(e.parentId,null);var n=i!=null?g.get(i):y;var a=e.type;var o=e.style;if(a==="text"&&o){if(e.hv&&e.hv[1]){o.textVerticalAlign=o.textBaseline=o.verticalAlign=o.align=null}}var s=e.textContent;var l=e.textConfig;if(o&&gz(o,a,!!l,!!s)){var u=yz(o,a,true);if(!l&&u.textConfig){l=e.textConfig=u.textConfig}if(!s&&u.textContent){s=u.textContent}}var c=TV(e);if("development"!=="production"){r&&E(n===r.parent,"Changing parent is not supported.")}var f=e.$action||"merge";if(f==="merge"){r?r.attr(c):IV(t,n,c,g)}else if(f==="replace"){CV(r,g);IV(t,n,c,g)}else if(f==="remove"){CV(r,g)}var h=g.get(t);if(h&&s){if(f==="merge"){var p=h.getTextContent();p?p.attr(s):h.setTextContent(new W(s))}else if(f==="replace"){h.setTextContent(new W(s))}}if(h){var v=_V(h);v.__ecGraphicWidthOption=e.width;v.__ecGraphicHeightOption=e.height;PV(h,d,e);ph({el:h,componentModel:d,itemName:h.name,itemTooltipOption:e.tooltip})}})};r.prototype._relocate=function(e,t){var r=e.option.elements;var i=this.group;var n=this._elMap;var a=t.getWidth();var o=t.getHeight();for(var s=0;s<r.length;s++){var l=r[s];var u=Va(l.id,null);var c=u!=null?n.get(u):null;if(!c||!c.isGroup){continue}var f=c.parent;var h=f===i;var p=_V(c);var v=_V(f);p.__ecGraphicWidth=Y(p.__ecGraphicWidthOption,h?a:v.__ecGraphicWidth)||0;p.__ecGraphicHeight=Y(p.__ecGraphicHeightOption,h?o:v.__ecGraphicHeight)||0}for(var s=r.length-1;s>=0;s--){var l=r[s];var u=Va(l.id,null);var c=u!=null?n.get(u):null;if(!c){continue}var f=c.parent;var v=_V(f);var d=f===i?{width:a,height:o}:{width:v.__ecGraphicWidth,height:v.__ecGraphicHeight};lv(c,l,d,null,{hv:l.hv,boundingMode:l.bounding})}};r.prototype._clear=function(){var t=this._elMap;t.each(function(e){CV(e,t)});this._elMap=I()};r.prototype.dispose=function(){this._clear()};r.type="graphic";return r}(My);function IV(e,t,r,i){var n=r.type;if("development"!=="production"){E(n,"graphic type MUST be set")}var a=z(bV,n)?bV[n]:Vf(n);if("development"!=="production"){E(a,"graphic type can not be found")}var o=new a(r);t.add(o);i.set(e,o);_V(o).__ecGraphicId=e}function CV(e,t){var r=e&&e.parent;if(r){e.type==="group"&&e.traverse(function(e){CV(e,t)});t.removeKey(_V(e).__ecGraphicId);r.remove(e)}}function TV(t){t=F({},t);U(["id","parentId","$action","hv","bounding","textContent"].concat(ev),function(e){delete t[e]});return t}function DV(t,e){var r;U(e,function(e){t[e]!=null&&t[e]!=="auto"&&(r=true)});return r}function AV(e,t){var r=e.existing;t.id=e.keyInfo.id;!t.type&&r&&(t.type=r.type);if(t.parentId==null){var i=t.parentOption;if(i){t.parentId=i.id}else if(r){t.parentId=r.parentId}}t.parentOption=null}function LV(e,t,r){var i=F({},r);var n=e[t];var a=r.$action||"merge";if(a==="merge"){if(n){if("development"!=="production"){var o=r.type;E(!o||n.type===o,'Please set $action: "replace" to change `type`')}y(n,i,true);fv(n,i,{ignoreSize:true});pv(r,n)}else{e[t]=i}}else if(a==="replace"){e[t]=i}else if(a==="remove"){n&&(e[t]=null)}}function kV(e,t){if(!e){return}e.hv=t.hv=[DV(t,["left","right"]),DV(t,["top","bottom"])];if(e.type==="group"){var r=e;var i=t;r.width==null&&(r.width=i.width=0);r.height==null&&(r.height=i.height=0)}}function PV(e,t,r){var i=j(e).eventData;if(!e.silent&&!e.ignore&&!i){i=j(e).eventData={componentType:"graphic",componentIndex:t.componentIndex,name:e.name}}if(i){i.info=r.info}}function OV(e){e.registerComponentModel(SV);e.registerComponentView(MV);e.registerPreprocessor(wV)}var NV=["x","y","radius","angle","single"];var EV=["cartesian2d","polar","singleAxis"];function RV(e){var t=e.get("coordinateSystem");return D(EV,t)>=0}function zV(e){if("development"!=="production"){E(e)}return e+"Axis"}function BV(e,t){var n=I();var r=[];var i=I();e.eachComponent({mainType:"dataZoom",query:t},function(e){if(!i.get(e.uid)){s(e)}});var a;do{a=false;e.eachComponent("dataZoom",o)}while(a);function o(e){if(!i.get(e.uid)&&l(e)){s(e);a=true}}function s(e){i.set(e.uid,true);r.push(e);u(e)}function l(e){var i=false;e.eachTargetAxis(function(e,t){var r=n.get(e);if(r&&r[t]){i=true}});return i}function u(e){e.eachTargetAxis(function(e,t){(n.get(e)||n.set(e,[]))[t]=true})}return r}function VV(e){var o=e.ecModel;var s={infoList:[],infoMap:I()};e.eachTargetAxis(function(e,t){var r=o.getComponent(zV(e),t);if(!r){return}var i=r.getCoordSysModel();if(!i){return}var n=i.uid;var a=s.infoMap.get(n);if(!a){a={model:i,axisModels:[]};s.infoList.push(a);s.infoMap.set(n,a)}a.axisModels.push(r)});return s}var GV=function(){function e(){this.indexList=[];this.indexMap=[]}e.prototype.add=function(e){if(!this.indexMap[e]){this.indexList.push(e);this.indexMap[e]=true}};return e}();var FV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._autoThrottle=true;e._noTarget=true;e._rangePropMode=["percent","percent"];return e}r.prototype.init=function(e,t,r){var i=HV(e);this.settledOption=i;this.mergeDefaultAndTheme(e,r);this._doInit(i)};r.prototype.mergeOption=function(e){var t=HV(e);y(this.option,e,true);y(this.settledOption,t,true);this._doInit(t)};r.prototype._doInit=function(e){var r=this.option;this._setDefaultThrottle(e);this._updateRangeUse(e);var i=this.settledOption;U([["start","startValue"],["end","endValue"]],function(e,t){if(this._rangePropMode[t]==="value"){r[e[0]]=i[e[0]]=null}},this);this._resetTarget()};r.prototype._resetTarget=function(){var e=this.get("orient",true);var t=this._targetAxisInfoMap=I();var r=this._fillSpecifiedTargetAxis(t);if(r){this._orient=e||this._makeAutoOrientByTargetAxis()}else{this._orient=e||"horizontal";this._fillAutoTargetAxisByOrient(t,this._orient)}this._noTarget=true;t.each(function(e){if(e.indexList.length){this._noTarget=false}},this)};r.prototype._fillSpecifiedTargetAxis=function(i){var n=false;U(NV,function(e){var t=this.getReferringComponents(zV(e),eo);if(!t.specified){return}n=true;var r=new GV;U(t.models,function(e){r.add(e.componentIndex)});i.set(e,r)},this);return n};r.prototype._fillAutoTargetAxisByOrient=function(a,t){var i=this.ecModel;var o=true;if(o){var e=t==="vertical"?"y":"x";var r=i.findComponents({mainType:e+"Axis"});n(r,e)}if(o){var r=i.findComponents({mainType:"singleAxis",filter:function(e){return e.get("orient",true)===t}});n(r,"single")}function n(e,t){var r=e[0];if(!r){return}var i=new GV;i.add(r.componentIndex);a.set(t,i);o=false;if(t==="x"||t==="y"){var n=r.getReferringComponents("grid",$a).models[0];n&&U(e,function(e){if(r.componentIndex!==e.componentIndex&&n===e.getReferringComponents("grid",$a).models[0]){i.add(e.componentIndex)}})}}if(o){U(NV,function(e){if(!o){return}var t=i.findComponents({mainType:zV(e),filter:function(e){return e.get("type",true)==="category"}});if(t[0]){var r=new GV;r.add(t[0].componentIndex);a.set(e,r);o=false}},this)}};r.prototype._makeAutoOrientByTargetAxis=function(){var t;this.eachTargetAxis(function(e){!t&&(t=e)},this);return t==="y"?"vertical":"horizontal"};r.prototype._setDefaultThrottle=function(e){if(e.hasOwnProperty("throttle")){this._autoThrottle=false}if(this._autoThrottle){var t=this.ecModel.option;this.option.throttle=t.animation&&t.animationDurationUpdate>0?100:20}};r.prototype._updateRangeUse=function(n){var a=this._rangePropMode;var o=this.get("rangeMode");U([["start","startValue"],["end","endValue"]],function(e,t){var r=n[e[0]]!=null;var i=n[e[1]]!=null;if(r&&!i){a[t]="percent"}else if(!r&&i){a[t]="value"}else if(o){a[t]=o[t]}else if(r){a[t]="percent"}})};r.prototype.noTarget=function(){return this._noTarget};r.prototype.getFirstTargetAxisModel=function(){var r;this.eachTargetAxis(function(e,t){if(r==null){r=this.ecModel.getComponent(zV(e),t)}},this);return r};r.prototype.eachTargetAxis=function(r,i){this._targetAxisInfoMap.each(function(e,t){U(e.indexList,function(e){r.call(i,t,e)})})};r.prototype.getAxisProxy=function(e,t){var r=this.getAxisModel(e,t);if(r){return r.__dzAxisProxy}};r.prototype.getAxisModel=function(e,t){if("development"!=="production"){E(e&&t!=null)}var r=this._targetAxisInfoMap.get(e);if(r&&r.indexMap[t]){return this.ecModel.getComponent(zV(e),t)}};r.prototype.setRawRange=function(t){var r=this.option;var i=this.settledOption;U([["start","startValue"],["end","endValue"]],function(e){if(t[e[0]]!=null||t[e[1]]!=null){r[e[0]]=i[e[0]]=t[e[0]];r[e[1]]=i[e[1]]=t[e[1]]}},this);this._updateRangeUse(t)};r.prototype.setCalculatedRange=function(t){var r=this.option;U(["start","startValue","end","endValue"],function(e){r[e]=t[e]})};r.prototype.getPercentRange=function(){var e=this.findRepresentativeAxisProxy();if(e){return e.getDataPercentWindow()}};r.prototype.getValueRange=function(e,t){if(e==null&&t==null){var r=this.findRepresentativeAxisProxy();if(r){return r.getDataValueWindow()}}else{return this.getAxisProxy(e,t).getDataValueWindow()}};r.prototype.findRepresentativeAxisProxy=function(e){if(e){return e.__dzAxisProxy}var t;var r=this._targetAxisInfoMap.keys();for(var i=0;i<r.length;i++){var n=r[i];var a=this._targetAxisInfoMap.get(n);for(var o=0;o<a.indexList.length;o++){var s=this.getAxisProxy(n,a.indexList[o]);if(s.hostedBy(this)){return s}if(!t){t=s}}}return t};r.prototype.getRangePropMode=function(){return this._rangePropMode.slice()};r.prototype.getOrient=function(){if("development"!=="production"){E(this._orient)}return this._orient};r.type="dataZoom";r.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"];r.defaultOption={zlevel:0,z:4,filterMode:"filter",start:0,end:100};return r}(p);function HV(t){var r={};U(["start","end","startValue","endValue","throttle"],function(e){t.hasOwnProperty(e)&&(r[e]=t[e])});return r}var WV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="dataZoom.select";return r}(FV);var jV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r,i){this.dataZoomModel=e;this.ecModel=t;this.api=r};r.type="dataZoom";return r}(My);var UV=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="dataZoom.select";return r}(jV);var ZV=U;var YV=Yn;var XV=function(){function e(e,t,r,i){this._dimName=e;this._axisIndex=t;this.ecModel=i;this._dataZoomModel=r}e.prototype.hostedBy=function(e){return this._dataZoomModel===e};e.prototype.getDataValueWindow=function(){return this._valueWindow.slice()};e.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()};e.prototype.getTargetSeriesModels=function(){var i=[];this.ecModel.eachSeries(function(e){if(RV(e)){var t=zV(this._dimName);var r=e.getReferringComponents(t,$a).models[0];if(r&&this._axisIndex===r.componentIndex){i.push(e)}}},this);return i};e.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)};e.prototype.getMinMaxSpan=function(){return M(this._minMaxSpan)};e.prototype.calculateDataWindow=function(n){var a=this._dataExtent;var e=this.getAxisModel();var s=e.axis.scale;var o=this._dataZoomModel.getRangePropMode();var l=[0,100];var u=[];var c=[];var f;ZV(["start","end"],function(e,t){var r=n[e];var i=n[e+"Value"];if(o[t]==="percent"){r==null&&(r=l[t]);i=s.parse(V(r,l,a))}else{f=true;i=i==null?a[t]:s.parse(i);r=V(i,a,l)}c[t]=i;u[t]=r});YV(c);YV(u);var h=this._minMaxSpan;f?t(c,u,a,l,false):t(u,c,l,a,true);function t(e,t,r,i,n){var a=n?"Span":"ValueSpan";WP(0,e,r,"all",h["min"+a],h["max"+a]);for(var o=0;o<2;o++){t[o]=V(e[o],r,i,true);n&&(t[o]=s.parse(t[o]))}}return{valueWindow:c,percentWindow:u}};e.prototype.reset=function(e){if(e!==this._dataZoomModel){return}var t=this.getTargetSeriesModels();this._dataExtent=qV(this,this._dimName,t);this._updateMinMaxSpan();var r=this.calculateDataWindow(e.settledOption);this._valueWindow=r.valueWindow;this._percentWindow=r.percentWindow;this._setAxisModel()};e.prototype.filterData=function(e,t){if(e!==this._dataZoomModel){return}var i=this._dimName;var r=this.getTargetSeriesModels();var n=e.get("filterMode");var f=this._valueWindow;if(n==="none"){return}ZV(r,function(r){var u=r.getData();var c=u.mapDimensionsAll(i);if(!c.length){return}if(n==="weakFilter"){u.filterSelf(function(e){var t;var r;var i;for(var n=0;n<c.length;n++){var a=u.get(c[n],e);var o=!isNaN(a);var s=a<f[0];var l=a>f[1];if(o&&!s&&!l){return true}o&&(i=true);s&&(t=true);l&&(r=true)}return i&&t&&r})}else{ZV(c,function(e){if(n==="empty"){r.setData(u=u.map(e,function(e){return!a(e)?NaN:e}))}else{var t={};t[e]=f;u.selectRange(t)}})}ZV(c,function(e){u.setApproximateExtent(f,e)})});function a(e){return e>=f[0]&&e<=f[1]}};e.prototype._updateMinMaxSpan=function(){var i=this._minMaxSpan={};var n=this._dataZoomModel;var a=this._dataExtent;ZV(["min","max"],function(e){var t=n.get(e+"Span");var r=n.get(e+"ValueSpan");r!=null&&(r=this.getAxisModel().axis.scale.parse(r));if(r!=null){t=V(a[0]+r,a,[0,100],true)}else if(t!=null){r=V(t,[0,100],a,true)-a[0]}i[e+"Span"]=t;i[e+"ValueSpan"]=r},this)};e.prototype._setAxisModel=function(){var e=this.getAxisModel();var t=this._percentWindow;var r=this._valueWindow;if(!t){return}var i=Jn(r,[0,500]);i=Math.min(i,20);var n=e.axis.scale.rawExtentInfo;if(t[0]!==0){n.setDeterminedMinMax("min",+r[0].toFixed(i))}if(t[1]!==100){n.setDeterminedMinMax("max",+r[1].toFixed(i))}n.freeze()};return e}();function qV(e,t,r){var i=[Infinity,-Infinity];ZV(r,function(e){MS(i,e.getData(),t)});var n=e.getAxisModel();var a=cS(n.axis.scale,n,i).calculate();return[a.min,a.max]}var JV={getTargetSeries:function(a){function e(n){a.eachComponent("dataZoom",function(i){i.eachTargetAxis(function(e,t){var r=a.getComponent(zV(e),t);n(e,t,r,i)})})}e(function(e,t,r,i){r.__dzAxisProxy=null});var n=[];e(function(e,t,r,i){if(!r.__dzAxisProxy){r.__dzAxisProxy=new XV(e,t,i,a);n.push(r.__dzAxisProxy)}});var t=I();U(n,function(e){U(e.getTargetSeriesModels(),function(e){t.set(e.uid,e)})});return t},overallReset:function(e,i){e.eachComponent("dataZoom",function(r){r.eachTargetAxis(function(e,t){r.getAxisProxy(e,t).reset(r)});r.eachTargetAxis(function(e,t){r.getAxisProxy(e,t).filterData(r,i)})});e.eachComponent("dataZoom",function(e){var t=e.findRepresentativeAxisProxy();if(t){var r=t.getDataPercentWindow();var i=t.getDataValueWindow();e.setCalculatedRange({start:r[0],end:r[1],startValue:i[0],endValue:i[1]})}})}};function KV(e){e.registerAction("dataZoom",function(t,e){var r=BV(e,t);U(r,function(e){e.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})})})}var QV=false;function $V(e){if(QV){return}QV=true;e.registerProcessor(e.PRIORITY.PROCESSOR.FILTER,JV);KV(e);e.registerSubTypeDefaulter("dataZoom",function(){return"slider"})}function e4(e){e.registerComponentModel(WV);e.registerComponentView(UV);$V(e)}var t4=function(){function e(){}return e}();var r4={};function i4(e,t){r4[e]=t}function n4(e){return r4[e]}var a4=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.optionUpdated=function(){t.prototype.optionUpdated.apply(this,arguments);var i=this.ecModel;U(this.option.feature,function(e,t){var r=n4(t);if(r){if(r.getDefaultOption){r.defaultOption=r.getDefaultOption(i)}y(e,r.defaultOption)}})};r.type="toolbox";r.layoutMode={type:"box",ignoreSize:true};r.defaultOption={show:true,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:true,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:false,position:"bottom"}};return r}(p);function o4(e,t,r){var i=t.getBoxLayoutParams();var n=t.get("padding");var a={width:r.getWidth(),height:r.getHeight()};var o=sv(i,a,n);iv(t.get("orient"),e,t.get("itemGap"),o.width,o.height);lv(e,i,a,n)}function s4(e,t){var r=Vp(t.get("padding"));var i=t.getItemStyle(["color","opacity"]);i.fill=t.get("backgroundColor");e=new G({shape:{x:e.x-r[3],y:e.y-r[0],width:e.width+r[1]+r[3],height:e.height+r[0]+r[2],r:t.get("borderRadius")},style:i,silent:true,z2:-1});return e}var l4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(f,h,p,u){var v=this.group;v.removeAll();if(!f.get("show")){return}var d=+f.get("itemSize");var c=f.get("feature")||{};var g=this._features||(this._features={});var y=[];U(c,function(e,t){y.push(t)});new gb(this._featureNames||[],y).add(e).update(e).remove(_(e,null)).execute();this._featureNames=y;function e(e,t){var r=y[e];var i=y[t];var n=c[r];var a=new C(n,f,f.ecModel);var o;if(u&&u.newTitle!=null&&u.featureName===r){n.title=u.newTitle}if(r&&!i){if(u4(r)){o={onclick:a.option.onclick,featureName:r}}else{var s=n4(r);if(!s){return}o=new s}g[r]=o}else{o=g[i];if(!o){return}}o.uid=Hh("toolbox-feature");o.model=a;o.ecModel=h;o.api=p;var l=o instanceof t4;if(!r&&i){l&&o.dispose&&o.dispose(h,p);return}if(!a.get("show")||l&&o.unusable){l&&o.remove&&o.remove(h,p);return}m(a,o,r);a.setIconStatus=function(e,t){var r=this.option;var i=this.iconPaths;r.iconStatus=r.iconStatus||{};r.iconStatus[e]=t;if(i[e]){(t==="emphasis"?Bu:Vu)(i[e])}};if(o instanceof t4){if(o.render){o.render(a,h,p,u)}}}function m(a,o,e){var s=a.getModel("iconStyle");var l=a.getModel(["emphasis","iconStyle"]);var t=o instanceof t4&&o.getIcons?o.getIcons():a.get("icon");var r=a.get("title")||{};var i;var u;if(typeof t==="string"){i={};i[e]=t}else{i=t}if(typeof r==="string"){u={};u[e]=r}else{u=r}var c=a.iconPaths={};U(i,function(e,t){var r=lh(e,{},{x:-d/2,y:-d/2,width:d,height:d});r.setStyle(s.getItemStyle());var i=r.ensureState("emphasis");i.style=l.getItemStyle();var n=new W({style:{text:u[t],align:l.get("textAlign"),borderRadius:l.get("textBorderRadius"),padding:l.get("textPadding"),fill:null},ignore:true});r.setTextContent(n);ph({el:r,componentModel:f,itemName:t,formatterParamsExtra:{title:u[t]}});r.__title=u[t];r.on("mouseover",function(){var e=l.getItemStyle();var t=f.get("orient")==="vertical"?f.get("right")==null?"right":"left":f.get("bottom")==null?"bottom":"top";n.setStyle({fill:l.get("textFill")||e.fill||e.stroke||"#000",backgroundColor:l.get("textBackgroundColor")});r.setTextConfig({position:l.get("textPosition")||t});n.ignore=!f.get("showTitle");Bu(this)}).on("mouseout",function(){if(a.get(["iconStatus",t])!=="emphasis"){Vu(this)}n.hide()});(a.get(["iconStatus",t])==="emphasis"?Bu:Vu)(r);v.add(r);r.on("click",x(o.onclick,o,h,p,t));c[t]=r})}o4(v,f,p);v.add(s4(v.getBoundingRect(),f));v.eachChild(function(e){var t=e.__title;var r=e.ensureState("emphasis");var i=r.textConfig||(r.textConfig={});var n=e.getTextContent();var a=n&&n.states.emphasis;if(a&&!b(a)&&t){var o=a.style||(a.style={});var s=pn(t,W.makeFont(o));var l=e.x+v.x;var u=e.y+v.y+d;var c=false;if(u+s.height>p.getHeight()){i.position="top";c=true}var f=c?-5-s.height:d+8;if(l+s.width/2>p.getWidth()){i.position=["100%",f];o.align="right"}else if(l-s.width/2<0){i.position=[0,f];o.align="left"}}})};t.prototype.updateView=function(e,t,r,i){U(this._features,function(e){e instanceof t4&&e.updateView&&e.updateView(e.model,t,r,i)})};t.prototype.remove=function(t,r){U(this._features,function(e){e instanceof t4&&e.remove&&e.remove(t,r)});this.group.removeAll()};t.prototype.dispose=function(t,r){U(this._features,function(e){e instanceof t4&&e.dispose&&e.dispose(t,r)})};t.type="toolbox";return t}(My);function u4(e){return e.indexOf("my")===0}var c4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onclick=function(e,t){var r=this.model;var i=r.get("name")||e.get("title.0.text")||"echarts";var n=t.getZr().painter.getType()==="svg";var a=n?"svg":r.get("type",true)||"png";var o=t.getConnectedDataURL({type:a,backgroundColor:r.get("backgroundColor",true)||e.get("backgroundColor")||"#fff",connectedBackgroundColor:r.get("connectedBackgroundColor"),excludeComponents:r.get("excludeComponents"),pixelRatio:r.get("pixelRatio")});if(typeof MouseEvent==="function"&&(S.browser.newEdge||!S.browser.ie&&!S.browser.edge)){var s=document.createElement("a");s.download=i+"."+a;s.target="_blank";s.href=o;var l=new MouseEvent("click",{view:document.defaultView,bubbles:true,cancelable:false});s.dispatchEvent(l)}else{if(window.navigator.msSaveOrOpenBlob||n){var u=o.split(",");var c=u[0].indexOf("base64")>-1;var f=n?decodeURIComponent(u[1]):u[1];c&&(f=window.atob(f));var h=i+"."+a;if(window.navigator.msSaveOrOpenBlob){var p=f.length;var v=new Uint8Array(p);while(p--){v[p]=f.charCodeAt(p)}var d=new Blob([v]);window.navigator.msSaveOrOpenBlob(d,h)}else{var g=document.createElement("iframe");document.body.appendChild(g);var y=g.contentWindow;var m=y.document;m.open("image/svg+xml","replace");m.write(f);m.close();y.focus();m.execCommand("SaveAs",true,h);document.body.removeChild(g)}}else{var x=r.get("lang");var _=""+'<body style="margin:0;">'+'<img src="'+o+'" style="max-width:100%;" title="'+(x&&x[0]||"")+'" />'+"</body>";var b=window.open();b.document.write(_);b.document.title=i}}};t.getDefaultOption=function(e){var t={show:true,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:e.getLocale(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:e.getLocale(["toolbox","saveAsImage","lang"])};return t};return t}(t4);c4.prototype.unusable=!S.canvasSupported;var f4="__ec_magicType_stack__";var h4=[["line","bar"],["stack"]];var p4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getIcons=function(){var e=this.model;var t=e.get("icon");var r={};U(e.get("type"),function(e){if(t[e]){r[e]=t[e]}});return r};t.getDefaultOption=function(e){var t={show:true,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:e.getLocale(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return t};t.prototype.onclick=function(e,t,f){var h=this.model;var r=h.get(["seriesIndex",f]);if(!v4[f]){return}var p={series:[]};var i=function(e){var t=e.subType;var r=e.id;var i=v4[f](t,r,e,h);if(i){R(i,e.option);p.series.push(i)}var n=e.coordinateSystem;if(n&&n.type==="cartesian2d"&&(f==="line"||f==="bar")){var a=n.getAxesByScale("ordinal")[0];if(a){var o=a.dim;var s=o+"Axis";var l=e.getReferringComponents(s,$a).models[0];var u=l.componentIndex;p[s]=p[s]||[];for(var c=0;c<=u;c++){p[s][u]=p[s][u]||{}}p[s][u].boundaryGap=f==="bar"}}};U(h4,function(e){if(D(e,f)>=0){U(e,function(e){h.setIconStatus(e,"normal")})}});h.setIconStatus(f,"emphasis");e.eachComponent({mainType:"series",query:r==null?null:{seriesIndex:r}},i);var n;var a=f;if(f==="stack"){n=y({stack:h.option.title.tiled,tiled:h.option.title.stack},h.option.title);if(h.get(["iconStatus",f])!=="emphasis"){a="tiled"}}t.dispatchAction({type:"changeMagicType",currentType:a,newOption:p,newTitle:n,featureName:"magicType"})};return t}(t4);var v4={line:function(e,t,r,i){if(e==="bar"){return y({id:t,type:"line",data:r.get("data"),stack:r.get("stack"),markPoint:r.get("markPoint"),markLine:r.get("markLine")},i.get(["option","line"])||{},true)}},bar:function(e,t,r,i){if(e==="line"){return y({id:t,type:"bar",data:r.get("data"),stack:r.get("stack"),markPoint:r.get("markPoint"),markLine:r.get("markLine")},i.get(["option","bar"])||{},true)}},stack:function(e,t,r,i){var n=r.get("stack")===f4;if(e==="line"||e==="bar"){i.setIconStatus("stack",n?"normal":"emphasis");return y({id:t,stack:n?"":f4},i.get(["option","stack"])||{},true)}}};$1({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(e,t){t.mergeOption(e.newOption)});var d4=new Array(60).join("-");var g4="\t";function y4(e){var n={};var a=[];var o=[];e.eachRawSeries(function(e){var t=e.coordinateSystem;if(t&&(t.type==="cartesian2d"||t.type==="polar")){var r=t.getBaseAxis();if(r.type==="category"){var i=r.dim+"_"+r.index;if(!n[i]){n[i]={categoryAxis:r,valueAxis:t.getOtherAxis(r),series:[]};o.push({axisDim:r.dim,axisIndex:r.index})}n[i].series.push(e)}else{a.push(e)}}else{a.push(e)}});return{seriesGroupByCategoryAxis:n,other:a,meta:o}}function m4(e){var f=[];U(e,function(e,t){var r=e.categoryAxis;var i=e.valueAxis;var n=i.dim;var a=[" "].concat(A(e.series,function(e){return e.name}));var o=[r.model.getCategories()];U(e.series,function(e){var t=e.getRawData();o.push(e.getRawData().mapArray(t.mapDimension(n),function(e){return e}))});var s=[a.join(g4)];for(var l=0;l<o[0].length;l++){var u=[];for(var c=0;c<o.length;c++){u.push(o[c][l])}s.push(u.join(g4))}f.push(s.join("\n"))});return f.join("\n\n"+d4+"\n\n")}function x4(e){return A(e,function(e){var n=e.getRawData();var a=[e.name];var o=[];n.each(n.dimensions,function(){var e=arguments.length;var t=arguments[e-1];var r=n.getName(t);for(var i=0;i<e-1;i++){o[i]=arguments[i]}a.push((r?r+g4:"")+o.join(g4))});return a.join("\n")}).join("\n\n"+d4+"\n\n")}function _4(e){var t=y4(e);return{value:ue([m4(t.seriesGroupByCategoryAxis),x4(t.other)],function(e){return!!e.replace(/[\n\t\s]/g,"")}).join("\n\n"+d4+"\n\n"),meta:t.meta}}function b4(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function w4(e){var t=e.slice(0,e.indexOf("\n"));if(t.indexOf(g4)>=0){return true}}var S4=new RegExp("["+g4+"]+","g");function M4(e){var t=e.split(/\n+/g);var r=b4(t.shift()).split(S4);var i=[];var n=A(r,function(e){return{name:e,data:[]}});for(var a=0;a<t.length;a++){var o=b4(t[a]).split(S4);i.push(o.shift());for(var s=0;s<o.length;s++){n[s]&&(n[s].data[a]=o[s])}}return{series:n,categories:i}}function I4(e){var t=e.split(/\n+/g);var r=b4(t.shift());var i=[];for(var n=0;n<t.length;n++){var a=b4(t[n]);if(!a){continue}var o=a.split(S4);var s="";var l=void 0;var u=false;if(isNaN(o[0])){u=true;s=o[0];o=o.slice(1);i[n]={name:s,value:[]};l=i[n].value}else{l=i[n]=[]}for(var c=0;c<o.length;c++){l.push(+o[c])}if(l.length===1){u?i[n].value=l[0]:i[n]=l[0]}}return{name:r,data:i}}function C4(e,a){var t=e.split(new RegExp("\n*"+d4+"\n*","g"));var o={series:[]};U(t,function(e,t){if(w4(e)){var r=M4(e);var i=a[t];var n=i.axisDim+"Axis";if(i){o[n]=o[n]||[];o[n][i.axisIndex]={data:r.categories};o.series=o.series.concat(r.series)}}else{var r=I4(e);o.series.push(r)}});return o}var T4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onclick=function(e,t){var r=t.getDom();var i=this.model;if(this._dom){r.removeChild(this._dom)}var n=document.createElement("div");n.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;";n.style.backgroundColor=i.get("backgroundColor")||"#fff";var a=document.createElement("h4");var o=i.get("lang")||[];a.innerHTML=o[0]||i.get("title");a.style.cssText="margin: 10px 20px;";a.style.color=i.get("textColor");var s=document.createElement("div");var l=document.createElement("textarea");s.style.cssText="display:block;width:100%;overflow:auto;";var u=i.get("optionToContent");var c=i.get("contentToOption");var f=_4(e);if(typeof u==="function"){var h=u(t.getOption());if(typeof h==="string"){s.innerHTML=h}else if(ge(h)){s.appendChild(h)}}else{s.appendChild(l);l.readOnly=i.get("readOnly");l.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;";l.style.color=i.get("textColor");l.style.borderColor=i.get("textareaBorderColor");l.style.backgroundColor=i.get("textareaColor");l.value=f.value}var p=f.meta;var v=document.createElement("div");v.style.cssText="position:absolute;bottom:0;left:0;right:0;";var d="float:right;margin-right:20px;border:none;"+"cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px";var g=document.createElement("div");var y=document.createElement("div");d+=";background-color:"+i.get("buttonColor");d+=";color:"+i.get("buttonTextColor");var m=this;function x(){r.removeChild(n);m._dom=null}Tt(g,"click",x);Tt(y,"click",function(){if(c==null&&u!=null||c!=null&&u==null){if("development"!=="production"){console.warn("It seems you have just provided one of `contentToOption` and `optionToContent` functions but missed the other one. Data change is ignored.")}x();return}var e;try{if(typeof c==="function"){e=c(s,t.getOption())}else{e=C4(l.value,p)}}catch(e){x();throw new Error("Data view format error "+e)}if(e){t.dispatchAction({type:"changeDataView",newOption:e})}x()});g.innerHTML=o[1];y.innerHTML=o[2];y.style.cssText=d;g.style.cssText=d;!i.get("readOnly")&&v.appendChild(y);v.appendChild(g);n.appendChild(a);n.appendChild(s);n.appendChild(v);s.style.height=r.clientHeight-80+"px";r.appendChild(n);this._dom=n};t.prototype.remove=function(e,t){this._dom&&t.getDom().removeChild(this._dom)};t.prototype.dispose=function(e,t){this.remove(e,t)};t.getDefaultOption=function(e){var t={show:true,readOnly:false,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:e.getLocale(["toolbox","dataView","title"]),lang:e.getLocale(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"};return t};return t}(t4);function D4(e,a){return A(e,function(e,t){var r=a&&a[t];if(O(r)&&!k(r)){var i=O(e)&&!k(e);if(!i){e={value:e}}var n=r.name!=null&&e.name==null;e=R(e,r);n&&delete e.name;return e}else{return e}})}$1({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(e,i){var n=[];U(e.newOption.series,function(e){var t=i.getSeriesByName(e.name)[0];if(!t){n.push(F({type:"scatter"},e))}else{var r=t.get("data");n.push({name:e.name,data:D4(e.data,r)})}});i.mergeOption(R({series:n},e.newOption))});var A4=U;var L4=qa();function k4(o,e){var s=E4(o);A4(e,function(e,t){var r=s.length-1;for(;r>=0;r--){var i=s[r];if(i[t]){break}}if(r<0){var n=o.queryComponents({mainType:"dataZoom",subType:"select",id:t})[0];if(n){var a=n.getPercentRange();s[0][t]={dataZoomId:t,start:a[0],end:a[1]}}}});s.push(e)}function P4(e){var i=E4(e);var t=i[i.length-1];i.length>1&&i.pop();var n={};A4(t,function(e,t){for(var r=i.length-1;r>=0;r--){e=i[r][t];if(e){n[t]=e;break}}});return n}function O4(e){L4(e).snapshots=null}function N4(e){return E4(e).length}function E4(e){var t=L4(e);if(!t.snapshots){t.snapshots=[{}]}return t.snapshots}var R4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onclick=function(e,t){O4(e);t.dispatchAction({type:"restore",from:this.uid})};t.getDefaultOption=function(e){var t={show:true,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:e.getLocale(["toolbox","restore","title"])};return t};return t}(t4);$1({type:"restore",event:"restore",update:"prepareAndUpdate"},function(e,t){t.resetOption("recreate")});var z4=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"];var B4=function(){function e(e,t,r){var i=this;this._targetInfoList=[];var n=G4(t,e);U(F4,function(e,t){if(!r||!r.include||D(r.include,t)>=0){e(n,i._targetInfoList)}})}e.prototype.setOutputRanges=function(e,t){this.matchOutputRanges(e,t,function(e,t,r){(e.coordRanges||(e.coordRanges=[])).push(t);if(!e.coordRange){e.coordRange=t;var i=j4[e.brushType](0,r,t);e.__rangeOffset={offset:Z4[e.brushType](i.values,e.range,[1,1]),xyMinMax:i.xyMinMax}}});return e};e.prototype.matchOutputRanges=function(e,i,n){U(e,function(r){var e=this.findTargetInfo(r,i);if(e&&e!==true){U(e.coordSyses,function(e){var t=j4[r.brushType](1,e,r.range,true);n(r,t.values,e,i)})}},this)};e.prototype.setInputRanges=function(e,n){U(e,function(e){var t=this.findTargetInfo(e,n);if("development"!=="production"){E(!t||t===true||e.coordRange,"coordRange must be specified when coord index specified.");E(!t||t!==true||e.range,"range must be specified in global brush.")}e.range=e.range||[];if(t&&t!==true){e.panelId=t.panelId;var r=j4[e.brushType](0,t.coordSys,e.coordRange);var i=e.__rangeOffset;e.range=i?Z4[e.brushType](r.values,i.offset,X4(r.xyMinMax,i.xyMinMax)):r.values}},this)};e.prototype.makePanelOpts=function(r,i){return A(this._targetInfoList,function(e){var t=e.getPanelRect();return{panelId:e.panelId,defaultBrushType:i?i(e):null,clipPath:tN(t),isTargetByCursor:iN(t,r,e.coordSysModel),getLinearBrushOtherExtent:rN(t)}})};e.prototype.controlSeries=function(e,t,r){var i=this.findTargetInfo(e,r);return i===true||i&&D(i.coordSyses,t.coordinateSystem)>=0};e.prototype.findTargetInfo=function(e,t){var r=this._targetInfoList;var i=G4(t,e);for(var n=0;n<r.length;n++){var a=r[n];var o=e.panelId;if(o){if(a.panelId===o){return a}}else{for(var s=0;s<H4.length;s++){if(H4[s](i,a)){return a}}}}return true};return e}();function V4(e){e[0]>e[1]&&e.reverse();return e}function G4(e,t){return Ka(e,t,{includeMainTypes:z4})}var F4={grid:function(e,i){var n=e.xAxisModels;var a=e.yAxisModels;var t=e.gridModels;var r=I();var o={};var s={};if(!n&&!a&&!t){return}U(n,function(e){var t=e.axis.grid.model;r.set(t.id,t);o[t.id]=true});U(a,function(e){var t=e.axis.grid.model;r.set(t.id,t);s[t.id]=true});U(t,function(e){r.set(e.id,e);o[e.id]=true;s[e.id]=true});r.each(function(e){var t=e.coordinateSystem;var r=[];U(t.getCartesians(),function(e,t){if(D(n,e.getAxis("x").model)>=0||D(a,e.getAxis("y").model)>=0){r.push(e)}});i.push({panelId:"grid--"+e.id,gridModel:e,coordSysModel:e,coordSys:r[0],coordSyses:r,getPanelRect:W4.grid,xAxisDeclared:o[e.id],yAxisDeclared:s[e.id]})})},geo:function(e,r){U(e.geoModels,function(e){var t=e.coordinateSystem;r.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:t,coordSyses:[t],getPanelRect:W4.geo})})}};var H4=[function(e,t){var r=e.xAxisModel;var i=e.yAxisModel;var n=e.gridModel;!n&&r&&(n=r.axis.grid.model);!n&&i&&(n=i.axis.grid.model);return n&&n===t.gridModel},function(e,t){var r=e.geoModel;return r&&r===t.geoModel}];var W4={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var e=this.coordSys;var t=e.getBoundingRect().clone();t.applyTransform(eh(e));return t}};var j4={lineX:_(U4,0),lineY:_(U4,1),rect:function(e,t,r,i){var n=e?t.pointToData([r[0][0],r[1][0]],i):t.dataToPoint([r[0][0],r[1][0]],i);var a=e?t.pointToData([r[0][1],r[1][1]],i):t.dataToPoint([r[0][1],r[1][1]],i);var o=[V4([n[0],a[0]]),V4([n[1],a[1]])];return{values:o,xyMinMax:o}},polygon:function(r,i,e,n){var a=[[Infinity,-Infinity],[Infinity,-Infinity]];var t=A(e,function(e){var t=r?i.pointToData(e,n):i.dataToPoint(e,n);a[0][0]=Math.min(a[0][0],t[0]);a[1][0]=Math.min(a[1][0],t[1]);a[0][1]=Math.max(a[0][1],t[0]);a[1][1]=Math.max(a[1][1],t[1]);return t});return{values:t,xyMinMax:a}}};function U4(e,t,r,i){if("development"!=="production"){E(r.type==="cartesian2d","lineX/lineY brush is available only in cartesian2d.")}var n=r.getAxis(["x","y"][e]);var a=V4(A([0,1],function(e){return t?n.coordToData(n.toLocalCoord(i[e]),true):n.toGlobalCoord(n.dataToCoord(i[e]))}));var o=[];o[e]=a;o[1-e]=[NaN,NaN];return{values:a,xyMinMax:o}}var Z4={lineX:_(Y4,0),lineY:_(Y4,1),rect:function(e,t,r){return[[e[0][0]-r[0]*t[0][0],e[0][1]-r[0]*t[0][1]],[e[1][0]-r[1]*t[1][0],e[1][1]-r[1]*t[1][1]]]},polygon:function(e,r,i){return A(e,function(e,t){return[e[0]-i[0]*r[t][0],e[1]-i[1]*r[t][1]]})}};function Y4(e,t,r,i){return[t[0]-i[e]*r[0],t[1]-i[e]*r[1]]}function X4(e,t){var r=q4(e);var i=q4(t);var n=[r[0]/i[0],r[1]/i[1]];isNaN(n[0])&&(n[0]=1);isNaN(n[1])&&(n[1]=1);return n}function q4(e){return e?[e[0][1]-e[0][0],e[1][1]-e[1][0]]:[NaN,NaN]}var J4=U;var K4=ja("toolbox-dataZoom_");var Q4=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(e,t,r,i){if(!this._brushController){this._brushController=new mO(r.getZr());this._brushController.on("brush",x(this._onBrush,this)).mount()}rG(e,t,this,i,r);tG(e,t)};t.prototype.onclick=function(e,t,r){$4[r].call(this)};t.prototype.remove=function(e,t){this._brushController&&this._brushController.unmount()};t.prototype.dispose=function(e,t){this._brushController&&this._brushController.dispose()};t.prototype._onBrush=function(e){var t=e.areas;if(!e.isEnd||!t.length){return}var s={};var l=this.ecModel;this._brushController.updateCovers([]);var r=new B4(eG(this.model),l,{include:["grid"]});r.matchOutputRanges(t,l,function(e,t,r){if(r.type!=="cartesian2d"){return}var i=e.brushType;if(i==="rect"){n("x",r,t[0]);n("y",r,t[1])}else{n({lineX:"x",lineY:"y"}[i],r,t)}});k4(l,s);this._dispatchZoomAction(s);function n(e,t,r){var i=t.getAxis(e);var n=i.model;var a=u(e,n,l);var o=a.findRepresentativeAxisProxy(n).getMinMaxSpan();if(o.minValueSpan!=null||o.maxValueSpan!=null){r=WP(0,r.slice(),i.scale.getExtent(),0,o.minValueSpan,o.maxValueSpan)}a&&(s[a.id]={dataZoomId:a.id,startValue:r[0],endValue:r[1]})}function u(r,i,e){var n;e.eachComponent({mainType:"dataZoom",subType:"select"},function(e){var t=e.getAxisModel(r,i.componentIndex);t&&(n=e)});return n}};t.prototype._dispatchZoomAction=function(e){var r=[];J4(e,function(e,t){r.push(M(e))});r.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:r})};t.getDefaultOption=function(e){var t={show:true,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:e.getLocale(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}};return t};return t}(t4);var $4={zoom:function(){var e=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:e})},back:function(){this._dispatchZoomAction(P4(this.ecModel))}};function eG(e){var t={xAxisIndex:e.get("xAxisIndex",true),yAxisIndex:e.get("yAxisIndex",true),xAxisId:e.get("xAxisId",true),yAxisId:e.get("yAxisId",true)};if(t.xAxisIndex==null&&t.xAxisId==null){t.xAxisIndex="all"}if(t.yAxisIndex==null&&t.yAxisId==null){t.yAxisIndex="all"}return t}function tG(e,t){e.setIconStatus("back",N4(t)>1?"emphasis":"normal")}function rG(e,t,r,i,n){var a=r._isZoomActive;if(i&&i.type==="takeGlobalCursor"){a=i.key==="dataZoomSelect"?i.dataZoomSelectActive:false}r._isZoomActive=a;e.setIconStatus("zoom",a?"emphasis":"normal");var o=new B4(eG(e),t,{include:["grid"]});var s=o.makePanelOpts(n,function(e){return e.xAxisDeclared&&!e.yAxisDeclared?"lineX":!e.xAxisDeclared&&e.yAxisDeclared?"lineY":"rect"});r._brushController.setPanels(s).enableBrush(a&&s.length?{brushType:"auto",brushStyle:e.getModel("brushStyle").getItemStyle()}:false)}Bv("dataZoom",function(e){var t=e.getComponent("toolbox",0);var r=["feature","dataZoom"];if(!t||t.get(r)==null){return}var a=t.getModel(r);var o=[];var i=eG(a);var n=Ka(e,i);J4(n.xAxisModels,function(e){return s(e,"xAxis","xAxisIndex")});J4(n.yAxisModels,function(e){return s(e,"yAxis","yAxisIndex")});function s(e,t,r){var i=e.componentIndex;var n={type:"select",$fromToolbox:true,filterMode:a.get("filterMode",true)||"filter",id:K4+t+i};n[r]=i;o.push(n)}return o});function iG(e){e.registerComponentModel(a4);e.registerComponentView(l4);i4("saveAsImage",c4);i4("magicType",p4);i4("dataView",T4);i4("dataZoom",Q4);i4("restore",R4);t(e4)}var nG=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="tooltip";r.dependencies=["axisPointer"];r.defaultOption={zlevel:0,z:60,show:true,showContent:true,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:false,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:false,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}};return r}(p);function aG(e){var t=e.get("confine");return t!=null?!!t:e.get("renderMode")==="richText"}function oG(e){if(!S.domSupported){return}var t=document.documentElement.style;for(var r=0,i=e.length;r<i;r++){if(e[r]in t){return e[r]}}}var sG=oG(["transform","webkitTransform","OTransform","MozTransform","msTransform"]);var lG=oG(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function uG(e,t){if(!e){return t}t=Bp(t,true);var r=e.indexOf(t);e=r===-1?t:"-"+e.slice(0,r)+"-"+t;return e.toLowerCase()}function cG(e,t){var r=e.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(e);return r?t?r[t]:r:null}var fG=uG(lG,"transition");var hG=uG(sG,"transform");var pG="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(S.transform3dSupported?"will-change:transform;":"");function vG(e){e=e==="left"?"right":e==="right"?"left":e==="top"?"bottom":"top";return e}function dG(e,t,r){if(!P(r)||r==="inside"){return""}t=Kp(t);var i=vG(r);var n=i+":-6px;";var a=hG+":";if(D(["left","right"],i)>-1){n+="top:50%";a+="translateY(-50%) rotate("+(i==="left"?-225:-45)+"deg)"}else{n+="left:50%";a+="translateX(-50%) rotate("+(i==="top"?225:45)+"deg)"}var o=t+" solid 1px;";var s=["position:absolute;width:10px;height:10px;",n+";"+a+";","border-bottom:"+o,"border-right:"+o,"background-color:"+e+";","box-shadow:8px 8px 16px -3px #000;"];return'<div style="'+s.join("")+'"></div>'}function gG(e,t){var r="cubic-bezier(0.23,1,0.32,1)";var i=" "+e/2+"s "+r;var n="opacity"+i+",visibility"+i;if(!t){i=" "+e+"s "+r;n+=S.transformSupported?","+hG+i:",left"+i+",top"+i}return fG+":"+n}function yG(e,t,r){var i=e.toFixed(0)+"px";var n=t.toFixed(0)+"px";if(!S.transformSupported){return r?"top:"+n+";left:"+i+";":[["top",n],["left",i]]}var a=S.transform3dSupported;var o="translate"+(a?"3d":"")+"("+i+","+n+(a?",0":"")+")";return r?"top:0;left:0;"+hG+":"+o+";":[["top",0],["left",0],[sG,o]]}function mG(r){var i=[];var e=r.get("fontSize");var t=r.getTextColor();t&&i.push("color:"+t);i.push("font:"+r.getFont());e&&i.push("line-height:"+Math.round(e*3/2)+"px");var n=r.get("textShadowColor");var a=r.get("textShadowBlur")||0;var o=r.get("textShadowOffsetX")||0;var s=r.get("textShadowOffsetY")||0;n&&a&&i.push("text-shadow:"+o+"px "+s+"px "+a+"px "+n);U(["decoration","align"],function(e){var t=r.get(e);t&&i.push("text-"+e+":"+t)});return i.join(";")}function xG(n,e,t){var a=[];var r=n.get("transitionDuration");var i=n.get("backgroundColor");var o=n.get("shadowBlur");var s=n.get("shadowColor");var l=n.get("shadowOffsetX");var u=n.get("shadowOffsetY");var c=n.getModel("textStyle");var f=uy(n,"html");var h=l+"px "+u+"px "+o+"px "+s;a.push("box-shadow:"+h);e&&r&&a.push(gG(r,t));if(i){if(S.canvasSupported){a.push("background-color:"+i)}else{a.push("background-color:#"+kr(i));a.push("filter:alpha(opacity=70)")}}U(["width","color","radius"],function(e){var t="border-"+e;var r=Bp(t);var i=n.get(r);i!=null&&a.push(t+":"+i+(e==="color"?"":"px"))});a.push(mG(c));if(f!=null){a.push("padding:"+Vp(f).join("px ")+"px")}return a.join(";")+";"}function _G(e,t,r,i,n){var a=t&&t.painter;if(r){var o=a&&a.getViewportRoot();if(o){vt(e,o,document.body,i,n)}}else{e[0]=i;e[1]=n;var s=a&&a.getViewportRootOffset();if(s){e[0]+=s.offsetLeft;e[1]+=s.offsetTop}}e[2]=e[0]/t.getWidth();e[3]=e[1]/t.getHeight()}var bG=function(){function e(e,t,r){this._show=false;this._styleCoord=[0,0,0,0];this._enterable=true;this._firstShow=true;this._longHide=true;if(S.wxa){return null}var i=document.createElement("div");i.domBelongToZr=true;this.el=i;var n=this._zr=t.getZr();var a=this._appendToBody=r&&r.appendToBody;_G(this._styleCoord,n,a,t.getWidth()/2,t.getHeight()/2);if(a){document.body.appendChild(i)}else{e.appendChild(i)}this._container=e;var o=this;i.onmouseenter=function(){if(o._enterable){clearTimeout(o._hideTimeout);o._show=true}o._inContent=true};i.onmousemove=function(e){e=e||window.event;if(!o._enterable){var t=n.handler;var r=n.painter.getViewportRoot();It(r,e,true);t.dispatch("mousemove",e)}};i.onmouseleave=function(){o._inContent=false;if(o._enterable){if(o._show){o.hideLater(o._hideDelay)}}}}e.prototype.update=function(e){var t=this._container;var r=cG(t,"position");var i=t.style;if(i.position!=="absolute"&&r!=="absolute"){i.position="relative"}var n=e.get("alwaysShowContent");n&&this._moveIfResized();this.el.className=e.get("className")||""};e.prototype.show=function(e,t){clearTimeout(this._hideTimeout);clearTimeout(this._longHideTimeout);var r=this.el;var i=r.style;var n=this._styleCoord;if(!r.innerHTML){i.display="none"}else{i.cssText=pG+xG(e,!this._firstShow,this._longHide)+yG(n[0],n[1],true)+("border-color:"+Kp(t)+";")+(e.get("extraCssText")||"")+(";pointer-event:"+(this._enterable?"auto":"none"))}this._show=true;this._firstShow=false;this._longHide=false};e.prototype.setContent=function(e,t,r,i,n){if(e==null){return}var a=this.el;if(P(n)&&r.get("trigger")==="item"&&!aG(r)){e+=dG(r.get("backgroundColor"),i,n)}if(P(e)){a.innerHTML=e}else if(e){a.innerHTML="";if(!k(e)){e=[e]}for(var o=0;o<e.length;o++){if(ge(e[o])&&e[o].parentNode!==a){a.appendChild(e[o])}}}};e.prototype.setEnterable=function(e){this._enterable=e};e.prototype.getSize=function(){var e=this.el;return[e.clientWidth,e.clientHeight]};e.prototype.moveTo=function(e,t){var r=this._styleCoord;_G(r,this._zr,this._appendToBody,e,t);if(r[0]!=null&&r[1]!=null){var i=this.el.style;var n=yG(r[0],r[1]);U(n,function(e){i[e[0]]=e[1]})}};e.prototype._moveIfResized=function(){var e=this._styleCoord[2];var t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())};e.prototype.hide=function(){var e=this;var t=this.el.style;t.visibility="hidden";t.opacity="0";S.transform3dSupported&&(t.willChange="");this._show=false;this._longHideTimeout=setTimeout(function(){return e._longHide=true},500)};e.prototype.hideLater=function(e){if(this._show&&!(this._inContent&&this._enterable)){if(e){this._hideDelay=e;this._show=false;this._hideTimeout=setTimeout(x(this.hide,this),e)}else{this.hide()}}};e.prototype.isShow=function(){return this._show};e.prototype.dispose=function(){this.el.parentNode.removeChild(this.el)};e.prototype.getOuterSize=function(){var e=this.el.clientWidth;var t=this.el.clientHeight;var r=cG(this.el);if(r){e+=parseInt(r.borderLeftWidth,10)+parseInt(r.borderRightWidth,10);t+=parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)}return{width:e,height:t}};return e}();var wG=function(){function e(e){this._show=false;this._styleCoord=[0,0,0,0];this._enterable=true;this._zr=e.getZr();IG(this._styleCoord,this._zr,e.getWidth()/2,e.getHeight()/2)}e.prototype.update=function(e){var t=e.get("alwaysShowContent");t&&this._moveIfResized()};e.prototype.show=function(){if(this._hideTimeout){clearTimeout(this._hideTimeout)}this.el.show();this._show=true};e.prototype.setContent=function(e,t,r,i,n){if(O(e)){g("development"!=="production"?"Passing DOM nodes as content is not supported in richText tooltip!":"")}if(this.el){this._zr.remove(this.el)}var a=r.getModel("textStyle");this.el=new W({style:{rich:t.richTextStyles,text:e,lineHeight:22,backgroundColor:r.get("backgroundColor"),borderRadius:r.get("borderRadius"),borderWidth:1,borderColor:i,shadowColor:r.get("shadowColor"),shadowBlur:r.get("shadowBlur"),shadowOffsetX:r.get("shadowOffsetX"),shadowOffsetY:r.get("shadowOffsetY"),textShadowColor:a.get("textShadowColor"),textShadowBlur:a.get("textShadowBlur")||0,textShadowOffsetX:a.get("textShadowOffsetX")||0,textShadowOffsetY:a.get("textShadowOffsetY")||0,fill:r.get(["textStyle","color"]),padding:uy(r,"richText"),verticalAlign:"top",align:"left"},z:r.get("z")});this._zr.add(this.el);var o=this;this.el.on("mouseover",function(){if(o._enterable){clearTimeout(o._hideTimeout);o._show=true}o._inContent=true});this.el.on("mouseout",function(){if(o._enterable){if(o._show){o.hideLater(o._hideDelay)}}o._inContent=false})};e.prototype.setEnterable=function(e){this._enterable=e};e.prototype.getSize=function(){var e=this.el;var t=this.el.getBoundingRect();var r=MG(e.style);return[t.width+r.left+r.right,t.height+r.top+r.bottom]};e.prototype.moveTo=function(e,t){var r=this.el;if(r){var i=this._styleCoord;IG(i,this._zr,e,t);e=i[0];t=i[1];var n=r.style;var a=SG(n.borderWidth||0);var o=MG(n);r.x=e+a+o.left;r.y=t+a+o.top;r.markRedraw()}};e.prototype._moveIfResized=function(){var e=this._styleCoord[2];var t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())};e.prototype.hide=function(){if(this.el){this.el.hide()}this._show=false};e.prototype.hideLater=function(e){if(this._show&&!(this._inContent&&this._enterable)){if(e){this._hideDelay=e;this._show=false;this._hideTimeout=setTimeout(x(this.hide,this),e)}else{this.hide()}}};e.prototype.isShow=function(){return this._show};e.prototype.getOuterSize=function(){var e=this.getSize();return{width:e[0],height:e[1]}};e.prototype.dispose=function(){this._zr.remove(this.el)};return e}();function SG(e){return Math.max(0,e)}function MG(e){var t=SG(e.shadowBlur||0);var r=SG(e.shadowOffsetX||0);var i=SG(e.shadowOffsetY||0);return{left:SG(t-r),right:SG(t+r),top:SG(t-i),bottom:SG(t+i)}}function IG(e,t,r,i){e[0]=r;e[1]=i;e[2]=e[0]/t.getWidth();e[3]=e[1]/t.getHeight()}var CG=x;var TG=U;var DG=Y;var AG=new G({shape:{x:-1,y:-1,width:2,height:2}});var LG=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(e,t){if(S.node){return}var r=e.getComponent("tooltip");var i=r.get("renderMode");this._renderMode=no(i);this._tooltipContent=this._renderMode==="richText"?new wG(t):new bG(t.getDom(),t,{appendToBody:r.get("appendToBody",true)})};r.prototype.render=function(e,t,r){if(S.node){return}this.group.removeAll();this._tooltipModel=e;this._ecModel=t;this._api=r;this._alwaysShowContent=e.get("alwaysShowContent");var i=this._tooltipContent;i.update(e);i.setEnterable(e.get("enterable"));this._initGlobalListener();this._keepShow()};r.prototype._initGlobalListener=function(){var e=this._tooltipModel;var i=e.get("triggerOn");FB("itemTooltip",this._api,CG(function(e,t,r){if(i!=="none"){if(i.indexOf(e)>=0){this._tryShow(t,r)}else if(e==="leave"){this._hide(r)}}},this))};r.prototype._keepShow=function(){var e=this._tooltipModel;var t=this._ecModel;var r=this._api;if(this._lastX!=null&&this._lastY!=null&&e.get("triggerOn")!=="none"){var i=this;clearTimeout(this._refreshUpdateTimeout);this._refreshUpdateTimeout=setTimeout(function(){!r.isDisposed()&&i.manuallyShowTip(e,t,r,{x:i._lastX,y:i._lastY,dataByCoordSys:i._lastDataByCoordSys})})}};r.prototype.manuallyShowTip=function(e,t,r,i){if(i.from===this.uid||S.node){return}var n=PG(i,r);this._ticket="";var a=i.dataByCoordSys;var o=zG(i,t,r);if(o){var s=o.el.getBoundingRect().clone();s.applyTransform(o.el.transform);this._tryShow({offsetX:s.x+s.width/2,offsetY:s.y+s.height/2,target:o.el,position:i.position,positionDefault:"bottom"},n)}else if(i.tooltip&&i.x!=null&&i.y!=null){var l=AG;l.x=i.x;l.y=i.y;l.update();j(l).tooltipConfig={name:null,option:i.tooltip};this._tryShow({offsetX:i.x,offsetY:i.y,target:l},n)}else if(a){this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,dataByCoordSys:a,tooltipOption:i.tooltipOption},n)}else if(i.seriesIndex!=null){if(this._manuallyAxisShowTip(e,t,r,i)){return}var u=qB(i,t);var c=u.point[0];var f=u.point[1];if(c!=null&&f!=null){this._tryShow({offsetX:c,offsetY:f,target:u.el,position:i.position,positionDefault:"bottom"},n)}}else if(i.x!=null&&i.y!=null){r.dispatchAction({type:"updateAxisPointer",x:i.x,y:i.y});this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,target:r.getZr().findHover(i.x,i.y).target},n)}};r.prototype.manuallyHideTip=function(e,t,r,i){var n=this._tooltipContent;if(!this._alwaysShowContent&&this._tooltipModel){n.hideLater(this._tooltipModel.get("hideDelay"))}this._lastX=this._lastY=this._lastDataByCoordSys=null;if(i.from!==this.uid){this._hide(PG(i,r))}};r.prototype._manuallyAxisShowTip=function(e,t,r,i){var n=i.seriesIndex;var a=i.dataIndex;var o=t.getComponent("axisPointer").coordSysAxesInfo;if(n==null||a==null||o==null){return}var s=t.getSeriesByIndex(n);if(!s){return}var l=s.getData();var u=kG([l.getItemModel(a),s,(s.coordinateSystem||{}).model],this._tooltipModel);if(u.get("trigger")!=="axis"){return}r.dispatchAction({type:"updateAxisPointer",seriesIndex:n,dataIndex:a,position:i.position});return true};r.prototype._tryShow=function(e,t){var r=e.target;var i=this._tooltipModel;if(!i){return}this._lastX=e.offsetX;this._lastY=e.offsetY;var n=e.dataByCoordSys;if(n&&n.length){this._showAxisTooltip(n,e)}else if(r){this._lastDataByCoordSys=null;var a;var o;f0(r,function(e){if(j(e).dataIndex!=null){a=e;return true}if(j(e).tooltipConfig!=null){o=e;return true}},true);if(a){this._showSeriesItemTooltip(e,a,t)}else if(o){this._showComponentItemTooltip(e,o,t)}else{this._hide(t)}}else{this._lastDataByCoordSys=null;this._hide(t)}};r.prototype._showOrMove=function(e,t){var r=e.get("showDelay");t=x(t,this);clearTimeout(this._showTimout);r>0?this._showTimout=setTimeout(t,r):t()};r.prototype._showAxisTooltip=function(e,t){var c=this._ecModel;var r=this._tooltipModel;var i=[t.offsetX,t.offsetY];var n=kG([t.tooltipOption],r);var f=this._renderMode;var h=[];var p=Kg("section",{blocks:[],noHeader:true});var v=[];var d=new cy;TG(e,function(e){TG(e.dataByAxis,function(a){var o=c.getComponent(a.axisDim+"Axis",a.axisIndex);var s=a.value;if(!o||s==null){return}var l=DB(s,o.axis,c,a.seriesDataIndices,a.valueLabelOpt);var u=Kg("section",{header:l,noHeader:!Ie(l),sortBlocks:true,blocks:[]});p.blocks.push(u);U(a.seriesDataIndices,function(e){var t=c.getSeriesByIndex(e.seriesIndex);var r=e.dataIndexInside;var i=t.getDataParams(r);i.axisDim=a.axisDim;i.axisIndex=a.axisIndex;i.axisType=a.axisType;i.axisId=a.axisId;i.axisValue=mS(o.axis,{value:s});i.axisValueLabel=l;i.marker=d.makeTooltipMarker("item",Kp(i.color),f);var n=_g(t.formatTooltip(r,true,null));if(n.markupFragment){u.blocks.push(n.markupFragment)}if(n.markupText){v.push(n.markupText)}h.push(i)})})});p.blocks.reverse();v.reverse();var a=t.position;var o=n.get("order");var s=ty(p,d,f,o,c.get("useUTC"),n.get("textStyle"));s&&v.unshift(s);var l=f==="richText"?"\n\n":"<br/>";var u=v.join(l);this._showOrMove(n,function(){if(this._updateContentNotChangedOnAxis(e)){this._updatePosition(n,a,i[0],i[1],this._tooltipContent,h)}else{this._showTooltipContent(n,u,h,Math.random()+"",i[0],i[1],a,null,d)}})};r.prototype._showSeriesItemTooltip=function(e,t,r){var i=this._ecModel;var n=j(t);var a=n.seriesIndex;var o=i.getSeriesByIndex(a);var s=n.dataModel||o;var l=n.dataIndex;var u=n.dataType;var c=s.getData(u);var f=this._renderMode;var h=e.positionDefault;var p=kG([c.getItemModel(l),s,o&&(o.coordinateSystem||{}).model],this._tooltipModel,h?{position:h}:null);var v=p.get("trigger");if(v!=null&&v!=="item"){return}var d=s.getDataParams(l,u);var g=new cy;d.marker=g.makeTooltipMarker("item",Kp(d.color),f);var y=_g(s.formatTooltip(l,false,u));var m=p.get("order");var x=y.markupFragment?ty(y.markupFragment,g,f,m,i.get("useUTC"),p.get("textStyle")):y.markupText;var _="item_"+s.name+"_"+l;this._showOrMove(p,function(){this._showTooltipContent(p,x,d,_,e.offsetX,e.offsetY,e.position,e.target,g)});r({type:"showTip",dataIndexInside:l,dataIndex:c.getRawIndex(l),seriesIndex:a,from:this.uid})};r.prototype._showComponentItemTooltip=function(t,r,e){var i=j(r);var n=i.tooltipConfig;var a=n.option||{};if(P(a)){var o=a;a={content:o,formatter:o}}var s=[a];var l=this._ecModel.getComponent(i.componentMainType,i.componentIndex);if(l){s.push(l)}s.push({formatter:a.content});var u=t.positionDefault;var c=kG(s,this._tooltipModel,u?{position:u}:null);var f=c.get("content");var h=Math.random()+"";var p=new cy;this._showOrMove(c,function(){var e=M(c.get("formatterParams")||{});this._showTooltipContent(c,f,e,h,t.offsetX,t.offsetY,t.position,r,p)});e({type:"showTip",from:this.uid})};r.prototype._showTooltipContent=function(r,e,i,t,n,a,o,s,l){this._ticket="";if(!r.get("showContent")||!r.get("show")){return}var u=this._tooltipContent;var c=r.get("formatter");o=o||r.get("position");var f=e;var h=this._getNearestPoint([n,a],i,r.get("trigger"),r.get("borderColor"));var p=h.color;if(c&&P(c)){var v=r.ecModel.get("useUTC");var d=k(i)?i[0]:i;var g=d&&d.axisType&&d.axisType.indexOf("time")>=0;f=c;if(g){f=mp(d.axisValue,f,v)}f=Zp(f,i,true)}else if(b(c)){var y=CG(function(e,t){if(e===this._ticket){u.setContent(t,l,r,p,o);this._updatePosition(r,o,n,a,u,i,s)}},this);this._ticket=t;f=c(i,t,y)}u.setContent(f,l,r,p,o);u.show(r,p);this._updatePosition(r,o,n,a,u,i,s)};r.prototype._getNearestPoint=function(e,t,r,i){if(r==="axis"||k(t)){return{color:i||(this._renderMode==="html"?"#fff":"none")}}if(!k(t)){return{color:i||t.color||t.borderColor}}};r.prototype._updatePosition=function(e,t,r,i,n,a,o){var s=this._api.getWidth();var l=this._api.getHeight();t=t||e.get("position");var u=n.getSize();var c=e.get("align");var f=e.get("verticalAlign");var h=o&&o.getBoundingRect().clone();o&&h.applyTransform(o.transform);if(b(t)){t=t([r,i],a,n.el,h,{viewSize:[s,l],contentSize:u.slice()})}if(k(t)){r=DG(t[0],s);i=DG(t[1],l)}else if(O(t)){var p=t;p.width=u[0];p.height=u[1];var v=sv(p,{width:s,height:l});r=v.x;i=v.y;c=null;f=null}else if(P(t)&&o){var d=EG(t,h,u);r=d[0];i=d[1]}else{var d=OG(r,i,n,s,l,c?null:20,f?null:20);r=d[0];i=d[1]}c&&(r-=RG(c)?u[0]/2:c==="right"?u[0]:0);f&&(i-=RG(f)?u[1]/2:f==="bottom"?u[1]:0);if(aG(e)){var d=NG(r,i,n,s,l);r=d[0];i=d[1]}n.moveTo(r,i)};r.prototype._updateContentNotChangedOnAxis=function(n){var e=this._lastDataByCoordSys;var o=!!e&&e.length===n.length;o&&TG(e,function(e,t){var r=e.dataByAxis||[];var i=n[t]||{};var a=i.dataByAxis||[];o=o&&r.length===a.length;o&&TG(r,function(e,t){var r=a[t]||{};var i=e.seriesDataIndices||[];var n=r.seriesDataIndices||[];o=o&&e.value===r.value&&e.axisType===r.axisType&&e.axisId===r.axisId&&i.length===n.length;o&&TG(i,function(e,t){var r=n[t];o=o&&e.seriesIndex===r.seriesIndex&&e.dataIndex===r.dataIndex})})});this._lastDataByCoordSys=n;return!!o};r.prototype._hide=function(e){this._lastDataByCoordSys=null;e({type:"hideTip",from:this.uid})};r.prototype.dispose=function(e,t){if(S.node){return}this._tooltipContent.dispose();YB("itemTooltip",t)};r.type="tooltip";return r}(My);function kG(e,t,r){var i=t.ecModel;var n;if(r){n=new C(r,i,i);n=new C(t.option,n,i)}else{n=t}for(var a=e.length-1;a>=0;a--){var o=e[a];if(o){if(o instanceof C){o=o.get("tooltip",true)}if(P(o)){o={formatter:o}}if(o){n=new C(o,n,i)}}}return n}function PG(e,t){return e.dispatchAction||x(t.dispatchAction,t)}function OG(e,t,r,i,n,a,o){var s=r.getOuterSize();var l=s.width;var u=s.height;if(a!=null){if(e+l+a+2>i){e-=l+a}else{e+=a}}if(o!=null){if(t+u+o>n){t-=u+o}else{t+=o}}return[e,t]}function NG(e,t,r,i,n){var a=r.getOuterSize();var o=a.width;var s=a.height;e=Math.min(e+o,i)-o;t=Math.min(t+s,n)-s;e=Math.max(e,0);t=Math.max(t,0);return[e,t]}function EG(e,t,r){var i=r[0];var n=r[1];var a=10;var o=5;var s=0;var l=0;var u=t.width;var c=t.height;switch(e){case"inside":s=t.x+u/2-i/2;l=t.y+c/2-n/2;break;case"top":s=t.x+u/2-i/2;l=t.y-n-a;break;case"bottom":s=t.x+u/2-i/2;l=t.y+c+a;break;case"left":s=t.x-i-a-o;l=t.y+c/2-n/2;break;case"right":s=t.x+u+a+o;l=t.y+c/2-n/2}return[s,l]}function RG(e){return e==="center"||e==="middle"}function zG(r,e,t){var i=Qa(r).queryOptionMap;var n=i.keys()[0];if(!n||n==="series"){return}var a=to(e,n,i.get(n),{useDefault:false,enableAll:false,enableNone:false});var o=a.models[0];if(!o){return}var s=t.getViewOfComponentModel(o);var l;s.group.traverse(function(e){var t=j(e).tooltipConfig;if(t&&t.name===r.name){l=e;return true}});if(l){return{componentMainType:n,componentIndex:o.componentIndex,el:l}}}function BG(e){t(l3);e.registerComponentModel(nG);e.registerComponentView(LG);e.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},function(){});e.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},function(){})}var VG=["rect","polygon","keep","clear"];function GG(e,t){var r=Ia(e?e.brush:[]);if(!r.length){return}var i=[];U(r,function(e){var t=e.hasOwnProperty("toolbox")?e.toolbox:[];if(t instanceof Array){i=i.concat(t)}});var n=e&&e.toolbox;if(k(n)){n=n[0]}if(!n){n={feature:{}};e.toolbox=[n]}var a=n.feature||(n.feature={});var o=a.brush||(a.brush={});var s=o.type||(o.type=[]);s.push.apply(s,i);FG(s);if(t&&!s.length){s.push.apply(s,VG)}}function FG(r){var t={};U(r,function(e){t[e]=1});r.length=0;U(t,function(e,t){r.push(t)})}var HG=U;function WG(e){if(e){for(var t in e){if(e.hasOwnProperty(t)){return true}}}}function jG(e,t,a){var r={};HG(t,function(i){var n=r[i]=o();HG(e[i],function(e,t){if(!eL.isValidType(t)){return}var r={type:t,visual:e};a&&a(r,i);n[t]=new eL(r);if(t==="opacity"){r=M(r);r.type="colorAlpha";n.__hidden.__alphaForOpacity=new eL(r)}})});return r;function o(){var e=function(){};e.prototype.__hidden=e.prototype;var t=new e;return t}}function UG(t,r,e){var i;U(e,function(e){if(r.hasOwnProperty(e)&&WG(r[e])){i=true}});i&&U(e,function(e){if(r.hasOwnProperty(e)&&WG(r[e])){t[e]=M(r[e])}else{delete t[e]}})}function ZG(e,u,c,f,h,p){var v={};U(e,function(e){var t=eL.prepareVisualTypes(u[e]);v[e]=t});var d;function g(e){return bm(c,d,e)}function y(e,t){Sm(c,d,e,t)}if(p==null){c.each(t)}else{c.each([p],t)}function t(e,t){d=p==null?e:t;var r=c.getRawDataItem(d);if(r&&r.visualMap===false){return}var i=f.call(h,e);var n=u[i];var a=v[i];for(var o=0,s=a.length;o<s;o++){var l=a[o];n[l]&&n[l].applyVisual(e,g,y)}}}function YG(e,d,g,y){var m={};U(e,function(e){var t=eL.prepareVisualTypes(d[e]);m[e]=t});return{progress:function e(t,r){var i;if(y!=null){i=r.getDimension(y)}function n(e){return bm(r,o,e)}function a(e,t){Sm(r,o,e,t)}var o;while((o=t.next())!=null){var s=r.getRawDataItem(o);if(s&&s.visualMap===false){continue}var l=y!=null?r.get(i,o):o;var u=g(l);var c=d[u];var f=m[u];for(var h=0,p=f.length;h<p;h++){var v=f[h];c[v]&&c[v].applyVisual(l,n,a)}}}}}function XG(t){var r=t.brushType;var i={point:function(e){return qG[r].point(e,i,t)},rect:function(e){return qG[r].rect(e,i,t)}};return i}var qG={lineX:JG(0),lineY:JG(1),rect:{point:function(e,t,r){return e&&r.boundingRect.contain(e[0],e[1])},rect:function(e,t,r){return e&&r.boundingRect.intersect(e)}},polygon:{point:function(e,t,r){return e&&r.boundingRect.contain(e[0],e[1])&&Hx(r.range,e[0],e[1])},rect:function(e,t,r){var i=r.range;if(!e||i.length<=1){return false}var n=e.x;var a=e.y;var o=e.width;var s=e.height;var l=i[0];if(Hx(i,n,a)||Hx(i,n+o,a)||Hx(i,n,a+s)||Hx(i,n+o,a+s)||B.create(e).contain(l[0],l[1])||uh(n,a,n+o,a,i)||uh(n,a,n,a+s,i)||uh(n+o,a,n+o,a+s,i)||uh(n,a+s,n+o,a+s,i)){return true}}}};function JG(a){var o=["x","y"];var s=["width","height"];return{point:function(e,t,r){if(e){var i=r.range;var n=e[a];return KG(n,i)}},rect:function(e,t,r){if(e){var i=r.range;var n=[e[o[a]],e[o[a]]+e[s[a]]];n[1]<n[0]&&n.reverse();return KG(n[0],i)||KG(n[1],i)||KG(i[0],n)||KG(i[1],n)}}}}function KG(e,t){return t[0]<=e&&e<=t[1]}var QG=["inBrush","outOfBrush"];var $G="__ecBrushSelect";var eF="__ecInBrushSelectEvent";function tF(r){r.eachComponent({mainType:"brush"},function(e){var t=e.brushTargetManager=new B4(e.option,r);t.setInputRanges(e.areas,r)})}function rF(d,e,t){var g=[];var y;var m;d.eachComponent({mainType:"brush"},function(e){t&&t.type==="takeGlobalCursor"&&e.setBrushOption(t.key==="brush"?t.brushOption:{brushType:false})});tF(d);d.eachComponent({mainType:"brush"},function(n,e){var o={brushId:n.id,brushIndex:e,brushName:n.name,areas:M(n.areas),selected:[]};g.push(o);var t=n.option;var r=t.brushLink;var i=[];var s=[];var l=[];var u=false;if(!e){y=t.throttleType;m=t.throttleDelay}var a=A(n.areas,function(e){var t=sF[e.brushType];var r=R({boundingRect:t?t(e):void 0},e);r.selectors=XG(r);return r});var c=jG(n.option,QG,function(e){e.mappingMethod="fixed"});k(r)&&U(r,function(e){i[e]=1});function f(e){return r==="all"||!!i[e]}function h(e){return!!e.length}d.eachSeries(function(e,t){var r=l[t]=[];e.subType==="parallel"?p(e,t):v(e,t,r)});function p(e,t){var r=e.coordinateSystem;u=u||r.hasAxisBrushed();f(t)&&r.eachActiveState(e.getData(),function(e,t){e==="active"&&(s[t]=1)})}function v(t,e,r){if(!t.brushSelector||oF(n,e)){return}U(a,function(e){if(n.brushTargetManager.controlSeries(e,t,d)){r.push(e)}u=u||h(r)});if(f(e)&&h(r)){var i=t.getData();i.each(function(e){if(aF(t,r,i,e)){s[e]=1}})}}d.eachSeries(function(t,e){var r={seriesId:t.id,seriesIndex:e,seriesName:t.name,dataIndex:[]};o.selected.push(r);var i=l[e];var n=t.getData();var a=f(e)?function(e){return s[e]?(r.dataIndex.push(n.getRawIndex(e)),"inBrush"):"outOfBrush"}:function(e){return aF(t,i,n,e)?(r.dataIndex.push(n.getRawIndex(e)),"inBrush"):"outOfBrush"};(f(e)?u:h(i))&&ZG(QG,c,n,a)})});iF(e,y,m,g,t)}function iF(e,t,r,i,n){if(!n){return}var a=e.getZr();if(a[eF]){return}if(!a[$G]){a[$G]=nF}var o=zy(a,$G,r,t);o(e,i)}function nF(e,t){if(!e.isDisposed()){var r=e.getZr();r[eF]=true;e.dispatchAction({type:"brushSelect",batch:t});r[eF]=false}}function aF(e,t,r,i){for(var n=0,a=t.length;n<a;n++){var o=t[n];if(e.brushSelector(i,r,o.selectors,o)){return true}}}function oF(e,t){var r=e.option.seriesIndex;return r!=null&&r!=="all"&&(k(r)?D(r,t)<0:t!==r)}var sF={rect:function(e){return lF(e.range)},polygon:function(e){var t;var r=e.range;for(var i=0,n=r.length;i<n;i++){t=t||[[Infinity,-Infinity],[Infinity,-Infinity]];var a=r[i];a[0]<t[0][0]&&(t[0][0]=a[0]);a[0]>t[0][1]&&(t[0][1]=a[0]);a[1]<t[1][0]&&(t[1][0]=a[1]);a[1]>t[1][1]&&(t[1][1]=a[1])}return t&&lF(t)}};function lF(e){return new B(e[0][0],e[1][0],e[0][1]-e[0][0],e[1][1]-e[1][0])}var uF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(e,t){this.ecModel=e;this.api=t;this.model;(this._brushController=new mO(t.getZr())).on("brush",x(this._onBrush,this)).mount()};r.prototype.render=function(e,t,r,i){this.model=e;this._updateController(e,t,r,i)};r.prototype.updateTransform=function(e,t,r,i){tF(t);this._updateController(e,t,r,i)};r.prototype.updateVisual=function(e,t,r,i){this.updateTransform(e,t,r,i)};r.prototype.updateView=function(e,t,r,i){this._updateController(e,t,r,i)};r.prototype._updateController=function(e,t,r,i){(!i||i.$from!==e.id)&&this._brushController.setPanels(e.brushTargetManager.makePanelOpts(r)).enableBrush(e.brushOption).updateCovers(e.areas.slice())};r.prototype.dispose=function(){this._brushController.dispose()};r.prototype._onBrush=function(e){var t=this.model.id;var r=this.model.brushTargetManager.setOutputRanges(e.areas,this.ecModel);(!e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:t,areas:M(r),$from:t});e.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:t,areas:M(r),$from:t})};r.type="brush";return r}(My);var cF="#ddd";var fF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.areas=[];e.brushOption={};return e}r.prototype.optionUpdated=function(e,t){var r=this.option;!t&&UG(r,e,["inBrush","outOfBrush"]);var i=r.inBrush=r.inBrush||{};r.outOfBrush=r.outOfBrush||{color:cF};if(!i.hasOwnProperty("liftZ")){i.liftZ=5}};r.prototype.setAreas=function(e){if("development"!=="production"){E(k(e));U(e,function(e){E(e.brushType,"Illegal areas")})}if(!e){return}this.areas=A(e,function(e){return hF(this.option,e)},this)};r.prototype.setBrushOption=function(e){this.brushOption=hF(this.option,e);this.brushType=this.brushOption.brushType};r.type="brush";r.dependencies=["geo","grid","xAxis","yAxis","parallel","series"];r.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:true,brushStyle:{borderWidth:1,color:"rgba(210,219,238,0.3)",borderColor:"#D2DBEE"},throttleType:"fixRate",throttleDelay:0,removeOnClick:true,z:1e4};return r}(p);function hF(e,t){return y({brushType:e.brushType,brushMode:e.brushMode,transformable:e.transformable,brushStyle:new C(e.brushStyle).getItemStyle(),removeOnClick:e.removeOnClick,z:e.z},t,true)}var pF=["rect","polygon","lineX","lineY","keep","clear"];var vF=function(e){d(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(t,e,r){var i;var n;var a;e.eachComponent({mainType:"brush"},function(e){i=e.brushType;n=e.brushOption.brushMode||"single";a=a||!!e.areas.length});this._brushType=i;this._brushMode=n;U(t.get("type",true),function(e){t.setIconStatus(e,(e==="keep"?n==="multiple":e==="clear"?a:e===i)?"emphasis":"normal")})};t.prototype.updateView=function(e,t,r){this.render(e,t,r)};t.prototype.getIcons=function(){var e=this.model;var t=e.get("icon",true);var r={};U(e.get("type",true),function(e){if(t[e]){r[e]=t[e]}});return r};t.prototype.onclick=function(e,t,r){var i=this._brushType;var n=this._brushMode;if(r==="clear"){t.dispatchAction({type:"axisAreaSelect",intervals:[]});t.dispatchAction({type:"brush",command:"clear",areas:[]})}else{t.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:r==="keep"?i:i===r?false:r,brushMode:r==="keep"?n==="multiple"?"single":"multiple":n}})}};t.getDefaultOption=function(e){var t={show:true,type:pF.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:e.getLocale(["toolbox","brush","title"])};return t};return t}(t4);function dF(e){e.registerComponentView(uF);e.registerComponentModel(fF);e.registerPreprocessor(GG);e.registerVisual(e.PRIORITY.VISUAL.BRUSH,rF);e.registerAction({type:"brush",event:"brush",update:"updateVisual"},function(t,e){e.eachComponent({mainType:"brush",query:t},function(e){e.setAreas(t.areas)})});e.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},function(){});e.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},function(){});i4("brush",vF)}var gF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.layoutMode={type:"box",ignoreSize:true};return e}r.type="title";r.defaultOption={zlevel:0,z:6,show:true,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}};return r}(p);var yF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.render=function(e,t,r){this.group.removeAll();if(!e.get("show")){return}var i=this.group;var n=e.getModel("textStyle");var a=e.getModel("subtextStyle");var o=e.get("textAlign");var s=N(e.get("textBaseline"),e.get("textVerticalAlign"));var l=new W({style:_h(n,{text:e.get("text"),fill:n.getTextColor()},{disableBox:true}),z2:10});var u=l.getBoundingRect();var c=e.get("subtext");var f=new W({style:_h(a,{text:c,fill:a.getTextColor(),y:u.height+e.get("itemGap"),verticalAlign:"top"},{disableBox:true}),z2:10});var h=e.get("link");var p=e.get("sublink");var v=e.get("triggerEvent",true);l.silent=!h&&!v;f.silent=!p&&!v;if(h){l.on("click",function(){Qp(h,"_"+e.get("target"))})}if(p){f.on("click",function(){Qp(p,"_"+e.get("subtarget"))})}j(l).eventData=j(f).eventData=v?{componentType:"title",componentIndex:e.componentIndex}:null;i.add(l);c&&i.add(f);var d=i.getBoundingRect();var g=e.getBoxLayoutParams();g.width=d.width;g.height=d.height;var y=sv(g,{width:r.getWidth(),height:r.getHeight()},e.get("padding"));if(!o){o=e.get("left")||e.get("right");if(o==="middle"){o="center"}if(o==="right"){y.x+=y.width}else if(o==="center"){y.x+=y.width/2}}if(!s){s=e.get("top")||e.get("bottom");if(s==="center"){s="middle"}if(s==="bottom"){y.y+=y.height}else if(s==="middle"){y.y+=y.height/2}s=s||"top"}i.x=y.x;i.y=y.y;i.markRedraw();var m={align:o,verticalAlign:s};l.setStyle(m);f.setStyle(m);d=i.getBoundingRect();var x=y.margin;var _=e.getItemStyle(["color","opacity"]);_.fill=e.get("backgroundColor");var b=new G({shape:{x:d.x-x[3],y:d.y-x[0],width:d.width+x[1]+x[3],height:d.height+x[0]+x[2],r:e.get("borderRadius")},style:_,subPixelOptimize:true,silent:true});i.add(b)};r.type="title";return r}(My);function mF(e){e.registerComponentModel(gF);e.registerComponentView(yF)}var xF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.layoutMode="box";return e}r.prototype.init=function(e,t,r){this.mergeDefaultAndTheme(e,r);this._initData()};r.prototype.mergeOption=function(e){t.prototype.mergeOption.apply(this,arguments);this._initData()};r.prototype.setCurrentIndex=function(e){if(e==null){e=this.option.currentIndex}var t=this._data.count();if(this.option.loop){e=(e%t+t)%t}else{e>=t&&(e=t-1);e<0&&(e=0)}this.option.currentIndex=e};r.prototype.getCurrentIndex=function(){return this.option.currentIndex};r.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1};r.prototype.setPlayState=function(e){this.option.autoPlay=!!e};r.prototype.getPlayState=function(){return!!this.option.autoPlay};r.prototype._initData=function(){var e=this.option;var t=e.data||[];var r=e.axisType;var n=this._names=[];var a;if(r==="category"){a=[];U(t,function(e,t){var r=Va(Da(e),"");var i;if(O(e)){i=M(e);i.value=t}else{i=t}a.push(i);n.push(r)})}else{a=t}var i={category:"ordinal",time:"time",value:"number"}[r]||"number";var o=this._data=new qb([{name:"value",type:i}],this);o.initData(a,n)};r.prototype.getData=function(){return this._data};r.prototype.getCategories=function(){if(this.get("axisType")==="category"){return this._names.slice()}};r.type="timeline";r.defaultOption={zlevel:0,z:4,show:true,axisType:"time",realtime:true,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:5,controlPosition:"left",autoPlay:false,rewind:false,loop:true,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:"#000"},data:[]};return r}(p);var _F=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="timeline.slider";r.defaultOption=Uh(xF.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,orient:"horizontal",inverse:false,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:true,width:2,color:"#DAE1F5"},label:{position:"auto",show:true,interval:"auto",rotate:0,color:"#A4B1D7"},itemStyle:{color:"#A4B1D7",borderWidth:1},checkpointStyle:{symbol:"circle",symbolSize:15,color:"#316bf3",borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0, 0, 0, 0.3)",animation:true,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:true,showPlayBtn:true,showPrevBtn:true,showNextBtn:true,itemSize:24,itemGap:12,position:"left",playIcon:"path://M31.6,53C17.5,53,6,41.5,6,27.4S17.5,1.8,31.6,1.8C45.7,1.8,57.2,13.3,57.2,27.4S45.7,53,31.6,53z M31.6,3.3 C18.4,3.3,7.5,14.1,7.5,27.4c0,13.3,10.8,24.1,24.1,24.1C44.9,51.5,55.7,40.7,55.7,27.4C55.7,14.1,44.9,3.3,31.6,3.3z M24.9,21.3 c0-2.2,1.6-3.1,3.5-2l10.5,6.1c1.899,1.1,1.899,2.9,0,4l-10.5,6.1c-1.9,1.1-3.5,0.2-3.5-2V21.3z",stopIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z",nextIcon:"M2,18.5A1.52,1.52,0,0,1,.92,18a1.49,1.49,0,0,1,0-2.12L7.81,9.36,1,3.11A1.5,1.5,0,1,1,3,.89l8,7.34a1.48,1.48,0,0,1,.49,1.09,1.51,1.51,0,0,1-.46,1.1L3,18.08A1.5,1.5,0,0,1,2,18.5Z",prevIcon:"M10,.5A1.52,1.52,0,0,1,11.08,1a1.49,1.49,0,0,1,0,2.12L4.19,9.64,11,15.89a1.5,1.5,0,1,1-2,2.22L1,10.77A1.48,1.48,0,0,1,.5,9.68,1.51,1.51,0,0,1,1,8.58L9,.92A1.5,1.5,0,0,1,10,.5Z",prevBtnSize:18,nextBtnSize:18,color:"#A4B1D7",borderColor:"#A4B1D7",borderWidth:1},emphasis:{label:{show:true,color:"#6f778d"},itemStyle:{color:"#316BF3"},controlStyle:{color:"#316BF3",borderColor:"#316BF3",borderWidth:2}},progress:{lineStyle:{color:"#316BF3"},itemStyle:{color:"#316BF3"},label:{color:"#6f778d"}},data:[]});return r}(xF);oe(_F,xg.prototype);var bF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="timeline";return r}(My);var wF=function(a){d(e,a);function e(e,t,r,i){var n=a.call(this,e,t,r)||this;n.type=i||"value";return n}e.prototype.getLabelModel=function(){return this.model.getModel("label")};e.prototype.isHorizontal=function(){return this.model.get("orient")==="horizontal"};return e}($S);var SF=Math.PI;var MF=qa();var IF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(e,t){this.api=t};r.prototype.render=function(t,e,r){this.model=t;this.api=r;this.ecModel=e;this.group.removeAll();if(t.get("show",true)){var i=this._layout(t,r);var n=this._createGroup("_mainGroup");var a=this._createGroup("_labelGroup");var o=this._axis=this._createAxis(i,t);t.formatTooltip=function(e){var t=o.scale.getLabel({value:e});return Kg("nameValue",{noName:true,value:t})};U(["AxisLine","AxisTick","Control","CurrentPointer"],function(e){this["_render"+e](i,n,o,t)},this);this._renderAxisLabel(i,a,o,t);this._position(i,t)}this._doPlayStop();this._updateTicksStatus()};r.prototype.remove=function(){this._clearTimer();this.group.removeAll()};r.prototype.dispose=function(){this._clearTimer()};r.prototype._layout=function(e,t){var r=e.get(["label","position"]);var i=e.get("orient");var n=TF(e,t);var a;if(r==null||r==="auto"){a=i==="horizontal"?n.y+n.height/2<t.getHeight()/2?"-":"+":n.x+n.width/2<t.getWidth()/2?"+":"-"}else if(P(r)){a={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[i][r]}else{a=r}var o={horizontal:"center",vertical:a>=0||a==="+"?"left":"right"};var s={horizontal:a>=0||a==="+"?"top":"bottom",vertical:"middle"};var l={horizontal:0,vertical:SF/2};var u=i==="vertical"?n.height:n.width;var c=e.getModel("controlStyle");var f=c.get("show",true);var h=f?c.get("itemSize"):0;var p=f?c.get("itemGap"):0;var v=h+p;var d=e.get(["label","rotate"])||0;d=d*SF/180;var g;var y;var m;var x=c.get("position",true);var _=f&&c.get("showPlayBtn",true);var b=f&&c.get("showPrevBtn",true);var w=f&&c.get("showNextBtn",true);var S=0;var M=u;if(x==="left"||x==="bottom"){_&&(g=[0,0],S+=v);b&&(y=[S,0],S+=v);w&&(m=[M-h,0],M-=v)}else{_&&(g=[M-h,0],M-=v);b&&(y=[0,0],S+=v);w&&(m=[M-h,0],M-=v)}var I=[S,M];if(e.get("inverse")){I.reverse()}return{viewRect:n,mainLength:u,orient:i,rotation:l[i],labelRotation:d,labelPosOpt:a,labelAlign:e.get(["label","align"])||o[i],labelBaseline:e.get(["label","verticalAlign"])||e.get(["label","baseline"])||s[i],playPosition:g,prevBtnPosition:y,nextBtnPosition:m,axisExtent:I,controlSize:h,controlGap:p}};r.prototype._position=function(e,t){var r=this._mainGroup;var i=this._labelGroup;var n=e.viewRect;if(e.orient==="vertical"){var a=Pi();var o=n.x;var s=n.y+n.height;Ri(a,a,[-o,-s]);zi(a,a,-SF/2);Ri(a,a,[o,s]);n=n.clone();n.applyTransform(a)}var l=g(n);var u=g(r.getBoundingRect());var c=g(i.getBoundingRect());var f=[r.x,r.y];var h=[i.x,i.y];h[0]=f[0]=l[0][0];var p=e.labelPosOpt;if(p==null||P(p)){var v=p==="+"?0:1;y(f,u,l,1,v);y(h,c,l,1,1-v)}else{var v=p>=0?0:1;y(f,u,l,1,v);h[1]=f[1]+p}r.setPosition(f);i.setPosition(h);r.rotation=i.rotation=e.rotation;d(r);d(i);function d(e){e.originX=l[0][0]-e.x;e.originY=l[1][0]-e.y}function g(e){return[[e.x,e.x+e.width],[e.y,e.y+e.height]]}function y(e,t,r,i,n){e[i]+=r[i][n]-t[i][n]}};r.prototype._createAxis=function(e,t){var r=t.getData();var i=t.get("axisType");var n=CF(t,i);n.getTicks=function(){return r.mapArray(["value"],function(e){return{value:e}})};var a=r.getDataExtent("value");n.setExtent(a[0],a[1]);n.niceTicks();var o=new wF("value",n,e.axisExtent,i);o.model=t;return o};r.prototype._createGroup=function(e){var t=this[e]=new H;this.group.add(t);return t};r.prototype._renderAxisLine=function(e,t,r,i){var n=r.getExtent();if(!i.get(["lineStyle","show"])){return}var a=new vf({shape:{x1:n[0],y1:0,x2:n[1],y2:0},style:F({lineCap:"round"},i.getModel("lineStyle").getLineStyle()),silent:true,z2:1});t.add(a);var o=this._progressLine=new vf({shape:{x1:n[0],x2:this._currentPointer?this._currentPointer.x:n[0],y1:0,y2:0},style:R({lineCap:"round",lineWidth:a.style.lineWidth},i.getModel(["progress","lineStyle"]).getLineStyle()),silent:true,z2:1});t.add(o)};r.prototype._renderAxisTick=function(e,u,c,f){var h=this;var p=f.getData();var t=c.scale.getTicks();this._tickSymbols=[];U(t,function(e){var t=c.dataToCoord(e.value);var r=p.getItemModel(e.value);var i=r.getModel("itemStyle");var n=r.getModel(["emphasis","itemStyle"]);var a=r.getModel(["progress","itemStyle"]);var o={x:t,y:0,onclick:x(h._changeTimeline,h,e.value)};var s=AF(r,i,u,o);s.ensureState("emphasis").style=n.getItemStyle();s.ensureState("progress").style=a.getItemStyle();tc(s);var l=j(s);if(r.get("tooltip")){l.dataIndex=e.value;l.dataModel=f}else{l.dataIndex=l.dataModel=null}h._tickSymbols.push(s)})};r.prototype._renderAxisLabel=function(l,u,c,e){var f=this;var t=c.getLabelModel();if(!t.get("show")){return}var h=e.getData();var r=c.getViewLabels();this._tickLabels=[];U(r,function(e){var t=e.tickValue;var r=h.getItemModel(t);var i=r.getModel("label");var n=r.getModel(["emphasis","label"]);var a=r.getModel(["progress","label"]);var o=c.dataToCoord(e.tickValue);var s=new W({x:o,y:0,rotation:l.labelRotation-l.rotation,onclick:x(f._changeTimeline,f,t),silent:false,style:_h(i,{text:e.formattedLabel,align:l.labelAlign,verticalAlign:l.labelBaseline})});s.ensureState("emphasis").style=_h(n);s.ensureState("progress").style=_h(a);u.add(s);tc(s);MF(s).dataIndex=t;f._tickLabels.push(s)})};r.prototype._renderControl=function(e,s,t,l){var u=e.controlSize;var c=e.rotation;var f=l.getModel("controlStyle").getItemStyle();var h=l.getModel(["emphasis","controlStyle"]).getItemStyle();var r=l.getPlayState();var i=l.get("inverse",true);n(e.nextBtnPosition,"next",x(this._changeTimeline,this,i?"-":"+"));n(e.prevBtnPosition,"prev",x(this._changeTimeline,this,i?"+":"-"));n(e.playPosition,r?"stop":"play",x(this._handlePlayClick,this,!r),true);function n(e,t,r,i){if(!e){return}var n=yn(N(l.get(["controlStyle",t+"BtnSize"]),u),u);var a=[0,-n/2,n,n];var o=DF(l,t+"Icon",a,{x:e[0],y:e[1],originX:u/2,originY:0,rotation:i?-c:0,rectHover:true,style:f,onclick:r});o.ensureState("emphasis").style=h;s.add(o);tc(o)}};r.prototype._renderCurrentPointer=function(e,t,r,i){var n=i.getData();var a=i.getCurrentIndex();var o=n.getItemModel(a).getModel("checkpointStyle");var s=this;var l={onCreate:function(e){e.draggable=true;e.drift=x(s._handlePointerDrag,s);e.ondragend=x(s._handlePointerDragend,s);LF(e,s._progressLine,a,r,i,true)},onUpdate:function(e){LF(e,s._progressLine,a,r,i)}};this._currentPointer=AF(o,o,this._mainGroup,{},this._currentPointer,l)};r.prototype._handlePlayClick=function(e){this._clearTimer();this.api.dispatchAction({type:"timelinePlayChange",playState:e,from:this.uid})};r.prototype._handlePointerDrag=function(e,t,r){this._clearTimer();this._pointerChangeTimeline([r.offsetX,r.offsetY])};r.prototype._handlePointerDragend=function(e){this._pointerChangeTimeline([e.offsetX,e.offsetY],true)};r.prototype._pointerChangeTimeline=function(e,t){var r=this._toAxisCoord(e)[0];var i=this._axis;var n=Yn(i.getExtent().slice());r>n[1]&&(r=n[1]);r<n[0]&&(r=n[0]);this._currentPointer.x=r;this._currentPointer.markRedraw();this._progressLine.shape.x2=r;this._progressLine.dirty();var a=this._findNearestTick(r);var o=this.model;if(t||a!==o.getCurrentIndex()&&o.get("realtime")){this._changeTimeline(a)}};r.prototype._doPlayStop=function(){var t=this;this._clearTimer();if(this.model.getPlayState()){this._timer=setTimeout(function(){var e=t.model;t._changeTimeline(e.getCurrentIndex()+(e.get("rewind",true)?-1:1))},this.model.get("playInterval"))}};r.prototype._toAxisCoord=function(e){var t=this._mainGroup.getLocalTransform();return th(e,t,true)};r.prototype._findNearestTick=function(n){var e=this.model.getData();var a=Infinity;var o;var s=this._axis;e.each(["value"],function(e,t){var r=s.dataToCoord(e);var i=Math.abs(r-n);if(i<a){a=i;o=t}});return o};r.prototype._clearTimer=function(){if(this._timer){clearTimeout(this._timer);this._timer=null}};r.prototype._changeTimeline=function(e){var t=this.model.getCurrentIndex();if(e==="+"){e=t+1}else if(e==="-"){e=t-1}this.api.dispatchAction({type:"timelineChange",currentIndex:e,from:this.uid})};r.prototype._updateTicksStatus=function(){var e=this.model.getCurrentIndex();var t=this._tickSymbols;var r=this._tickLabels;if(t){for(var i=0;i<t.length;i++){t&&t[i]&&t[i].toggleState("progress",i<e)}}if(r){for(var i=0;i<r.length;i++){r&&r[i]&&r[i].toggleState("progress",MF(r[i]).dataIndex<=e)}}};r.type="timeline.slider";return r}(bF);function CF(e,t){t=t||e.get("type");if(t){switch(t){case"category":return new bw({ordinalMeta:e.getCategories(),extent:[Infinity,-Infinity]});case"time":return new Fw({locale:e.ecModel.getLocaleModel(),useUTC:e.ecModel.get("useUTC")});default:return new Sw}}}function TF(e,t){return sv(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()},e.get("padding"))}function DF(e,t,r,i){var n=i.style;var a=lh(e.get(["controlStyle",t]),i||{},new B(r[0],r[1],r[2],r[3]));if(n){a.setStyle(n)}return a}function AF(e,t,r,i,n,a){var o=t.get("color");if(!n){var s=e.get("symbol");n=S0(s,-1,-1,2,2,o);n.setStyle("strokeNoScale",true);r.add(n);a&&a.onCreate(n)}else{n.setColor(o);r.add(n);a&&a.onUpdate(n)}var l=t.getItemStyle(["color"]);n.setStyle(l);i=y({rectHover:true,z2:100},i,true);var u=e.get("symbolSize");u=u instanceof Array?u.slice():[+u,+u];i.scaleX=u[0]/2;i.scaleY=u[1]/2;var c=e.get("symbolOffset");if(c){i.x=i.x||0;i.y=i.y||0;i.x+=Y(c[0],u[0]);i.y+=Y(c[1],u[1])}var f=e.get("symbolRotate");i.rotation=(f||0)*Math.PI/180||0;n.attr(i);n.updateTransform();return n}function LF(e,t,r,i,n,a){if(e.dragging){return}var o=n.getModel("checkpointStyle");var s=i.dataToCoord(n.getData().get("value",r));if(a||!o.get("animation",true)){e.attr({x:s,y:0});t&&t.attr({shape:{x2:s}})}else{var l={duration:o.get("animationDuration",true),easing:o.get("animationEasing",true)};e.stopAnimation(null,true);e.animateTo({x:s,y:0},l);t&&t.animateTo({shape:{x2:s}},l)}}function kF(e){e.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(e,t){var r=t.getComponent("timeline");if(r&&e.currentIndex!=null){r.setCurrentIndex(e.currentIndex);if(!r.get("loop",true)&&r.isIndexMax()){r.setPlayState(false)}}t.resetOption("timeline",{replaceMerge:r.get("replaceMerge",true)});return R({currentIndex:r.option.currentIndex},e)});e.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(e,t){var r=t.getComponent("timeline");if(r&&e.playState!=null){r.setPlayState(e.playState)}})}function PF(e){var t=e&&e.timeline;if(!k(t)){t=t?[t]:[]}U(t,function(e){if(!e){return}OF(e)})}function OF(e){var t=e.type;var r={number:"value",time:"time"};if(r[t]){e.axisType=r[t];delete e.type}NF(e);if(EF(e,"controlPosition")){var i=e.controlStyle||(e.controlStyle={});if(!EF(i,"position")){i.position=e.controlPosition}if(i.position==="none"&&!EF(i,"show")){i.show=false;delete i.position}delete e.controlPosition}U(e.data||[],function(e){if(O(e)&&!k(e)){if(!EF(e,"value")&&EF(e,"name")){e.value=e.name}NF(e)}})}function NF(e){var t=e.itemStyle||(e.itemStyle={});var r=t.emphasis||(t.emphasis={});var i=e.label||e.label||{};var n=i.normal||(i.normal={});var a={normal:1,emphasis:1};U(i,function(e,t){if(!a[t]&&!EF(n,t)){n[t]=e}});if(r.label&&!EF(i,"emphasis")){i.emphasis=r.label;delete r.label}}function EF(e,t){return e.hasOwnProperty(t)}function RF(e){e.registerComponentModel(_F);e.registerComponentView(IF);e.registerSubTypeDefaulter("timeline",function(){return"slider"});kF(e);e.registerPreprocessor(PF)}function zF(e,t){if(!e){return false}var r=k(e)?e:[e];for(var i=0;i<r.length;i++){if(r[i]&&r[i][t]){return true}}return false}function BF(e){Ca(e,"label",["show"])}var VF=qa();var GF=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.createdBySelf=false;return e}r.prototype.init=function(e,t,r){if("development"!=="production"){if(this.type==="marker"){throw new Error("Marker component is abstract component. Use markLine, markPoint, markArea instead.")}}this.mergeDefaultAndTheme(e,r);this._mergeOption(e,r,false,true)};r.prototype.isAnimationEnabled=function(){if(S.node){return false}var e=this.__hostSeries;return this.getShallow("animation")&&e&&e.isAnimationEnabled()};r.prototype.mergeOption=function(e,t){this._mergeOption(e,t,false,false)};r.prototype._mergeOption=function(e,i,t,n){var a=this.mainType;if(!t){i.eachSeries(function(e){var t=e.get(this.mainType,true);var r=VF(e)[a];if(!t||!t.data){VF(e)[a]=null;return}if(!r){if(n){BF(t)}U(t.data,function(e){if(e instanceof Array){BF(e[0]);BF(e[1])}else{BF(e)}});r=this.createMarkerModelFromSeries(t,this,i);F(r,{mainType:this.mainType,seriesIndex:e.seriesIndex,name:e.name,createdBySelf:true});r.__hostSeries=e}else{r._mergeOption(t,i,true)}VF(e)[a]=r},this)}};r.prototype.formatTooltip=function(e,t,r){var i=this.getData();var n=this.getRawValue(e);var a=i.getName(e);return Kg("section",{header:this.name,blocks:[Kg("nameValue",{name:a,value:n,noName:!a,noValue:n==null})]})};r.prototype.getData=function(){return this._data};r.prototype.setData=function(e){this._data=e};r.getMarkerModelFromSeries=function(e,t){return VF(e)[t]};r.type="marker";r.dependencies=["series","grid","polar","geo"];return r}(p);oe(GF,xg.prototype);var FF=function(t){d(i,t);function i(){var e=t!==null&&t.apply(this,arguments)||this;e.type=i.type;return e}i.prototype.createMarkerModelFromSeries=function(e,t,r){return new i(e,t,r)};i.type="markPoint";i.defaultOption={zlevel:0,z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:true,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:true}}};return i}(GF);function HF(e){return!(isNaN(parseFloat(e.x))&&isNaN(parseFloat(e.y)))}function WF(e){return!isNaN(parseFloat(e.x))&&!isNaN(parseFloat(e.y))}function jF(e,t,r,i,n,a){var o=[];var s=aw(t,i);var l=s?t.getCalculationInfo("stackResultDimension"):i;var u=KF(t,l,e);var c=t.indicesOfNearest(l,u)[0];o[n]=t.get(r,c);o[a]=t.get(l,c);var f=t.get(i,c);var h=Xn(t.get(i,c));h=Math.min(h,20);if(h>=0){o[a]=+o[a].toFixed(h)}return[o,f]}var UF={min:_(jF,"min"),max:_(jF,"max"),average:_(jF,"average"),median:_(jF,"median")};function ZF(e,t){var r=e.getData();var i=e.coordinateSystem;if(t&&!WF(t)&&!k(t.coord)&&i){var n=i.dimensions;var a=YF(t,r,i,e);t=M(t);if(t.type&&UF[t.type]&&a.baseAxis&&a.valueAxis){var o=D(n,a.baseAxis.dim);var s=D(n,a.valueAxis.dim);var l=UF[t.type](r,a.baseDataDim,a.valueDataDim,o,s);t.coord=l[0];t.value=l[1]}else{var u=[t.xAxis!=null?t.xAxis:t.radiusAxis,t.yAxis!=null?t.yAxis:t.angleAxis];for(var c=0;c<2;c++){if(UF[u[c]]){u[c]=KF(r,r.mapDimension(n[c]),u[c])}}t.coord=u}}return t}function YF(e,t,r,i){var n={};if(e.valueIndex!=null||e.valueDim!=null){n.valueDataDim=e.valueIndex!=null?t.getDimension(e.valueIndex):e.valueDim;n.valueAxis=r.getAxis(XF(i,n.valueDataDim));n.baseAxis=r.getOtherAxis(n.valueAxis);n.baseDataDim=t.mapDimension(n.baseAxis.dim)}else{n.baseAxis=i.getBaseAxis();n.valueAxis=r.getOtherAxis(n.baseAxis);n.baseDataDim=t.mapDimension(n.baseAxis.dim);n.valueDataDim=t.mapDimension(n.valueAxis.dim)}return n}function XF(e,t){var r=e.getData();var i=r.dimensions;t=r.getDimension(t);for(var n=0;n<i.length;n++){var a=r.getDimensionInfo(i[n]);if(a.name===t){return a.coordDim}}}function qF(e,t){return e&&e.containData&&t.coord&&!HF(t)?e.containData(t.coord):true}function JF(e,t,r,i){if(i<2){return e.coord&&e.coord[i]}return e.value}function KF(e,t,r){if(r==="average"){var i=0;var n=0;e.each(t,function(e,t){if(!isNaN(e)){i+=e;n++}});return i/n}else if(r==="median"){return e.getMedian(t)}else{return e.getDataExtent(t)[r==="max"?1:0]}}var QF=qa();var $F=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.init=function(){this.markerGroupMap=I()};r.prototype.render=function(e,r,i){var n=this;var t=this.markerGroupMap;t.each(function(e){QF(e).keep=false});r.eachSeries(function(e){var t=GF.getMarkerModelFromSeries(e,n.type);t&&n.renderSeries(e,t,r,i)});t.each(function(e){!QF(e).keep&&n.group.remove(e.group)})};r.prototype.markKeep=function(e){QF(e).keep=true};r.prototype.blurSeries=function(e){var i=this;U(e,function(e){var t=GF.getMarkerModelFromSeries(e,i.type);if(t){var r=t.getData();r.eachItemGraphicEl(function(e){if(e){Gu(e)}})}})};r.type="marker";return r}(My);function eH(s,l,u){var c=l.coordinateSystem;s.each(function(e){var t=s.getItemModel(e);var r;var i=Y(t.get("x"),u.getWidth());var n=Y(t.get("y"),u.getHeight());if(!isNaN(i)&&!isNaN(n)){r=[i,n]}else if(l.getMarkerPosition){r=l.getMarkerPosition(s.getValues(s.dimensions,e))}else if(c){var a=s.get(c.dimensions[0],e);var o=s.get(c.dimensions[1],e);r=c.dataToPoint([a,o])}if(!isNaN(i)){r[0]=i}if(!isNaN(n)){r[1]=n}s.setItemLayout(e,r)})}var tH=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.updateTransform=function(e,t,r){t.eachSeries(function(e){var t=GF.getMarkerModelFromSeries(e,"markPoint");if(t){eH(t.getData(),e,r);this.markerGroupMap.get(e.id).updateLayout()}},this)};r.prototype.renderSeries=function(e,u,t,r){var i=e.coordinateSystem;var n=e.id;var c=e.getData();var a=this.markerGroupMap;var o=a.get(n)||a.set(n,new LI);var f=rH(i,e,u);u.setData(f);eH(u.getData(),e,r);f.each(function(e){var t=f.getItemModel(e);var r=t.getShallow("symbol");var i=t.getShallow("symbolSize");var n=t.getShallow("symbolRotate");if(b(r)||b(i)||b(n)){var a=u.getRawValue(e);var o=u.getDataParams(e);if(b(r)){r=r(a,o)}if(b(i)){i=i(a,o)}if(b(n)){n=n(a,o)}}var s=t.getModel("itemStyle").getItemStyle();var l=wm(c,"color");if(!s.fill){s.fill=l}f.setItemVisual(e,{symbol:r,symbolSize:i,symbolRotate:n,style:s})});o.updateData(f);this.group.add(o.group);f.eachItemGraphicEl(function(e){e.traverse(function(e){j(e).dataModel=u})});this.markKeep(o);o.group.silent=u.get("silent")||e.get("silent")};r.type="markPoint";return r}($F);function rH(e,r,t){var i;if(e){i=A(e&&e.dimensions,function(e){var t=r.getData().getDimensionInfo(r.getData().mapDimension(e))||{};return R({name:e},t)})}else{i=[{name:"value",type:"float"}]}var n=new qb(i,t);var a=A(t.get("data"),_(ZF,r));if(e){a=ue(a,_(qF,e))}n.initData(a,null,e?JF:function(e){return e.value});return n}function iH(e){e.registerComponentModel(FF);e.registerComponentView(tH);e.registerPreprocessor(function(e){if(zF(e.series,"markPoint")){e.markPoint=e.markPoint||{}}})}var nH=function(t){d(i,t);function i(){var e=t!==null&&t.apply(this,arguments)||this;e.type=i.type;return e}i.prototype.createMarkerModelFromSeries=function(e,t,r){return new i(e,t,r)};i.type="markLine";i.defaultOption={zlevel:0,z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:true,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:true},lineStyle:{width:3}},animationEasing:"linear"};return i}(GF);var aH=qa();var oH=function(e,t,r,i){var n=e.getData();var a;if(!k(i)){var o=i.type;if(o==="min"||o==="max"||o==="average"||o==="median"||i.xAxis!=null||i.yAxis!=null){var s=void 0;var l=void 0;if(i.yAxis!=null||i.xAxis!=null){s=t.getAxis(i.yAxis!=null?"y":"x");l=be(i.yAxis,i.xAxis)}else{var u=YF(i,n,t,e);s=u.valueAxis;var c=ow(n,u.valueDataDim);l=KF(n,c,o)}var f=s.dim==="x"?0:1;var h=1-f;var p=M(i);var v={coord:[]};p.type=null;p.coord=[];p.coord[h]=-Infinity;v.coord[h]=Infinity;var d=r.get("precision");if(d>=0&&typeof l==="number"){l=+l.toFixed(Math.min(d,20))}p.coord[f]=v.coord[f]=l;a=[p,v,{type:o,valueIndex:i.valueIndex,value:l}]}else{if("development"!=="production"){re("Invalid markLine data.")}a=[]}}else{a=i}var g=[ZF(e,a[0]),ZF(e,a[1]),F({},a[2])];g[2].type=g[2].type||null;y(g[2],g[0]);y(g[2],g[1]);return g};function sH(e){return!isNaN(e)&&!isFinite(e)}function lH(e,t,r,i){var n=1-e;var a=i.dimensions[e];return sH(t[n])&&sH(r[n])&&t[e]===r[e]&&i.getAxis(a).containData(t[e])}function uH(e,t){if(e.type==="cartesian2d"){var r=t[0].coord;var i=t[1].coord;if(r&&i&&(lH(1,r,i,e)||lH(0,r,i,e))){return true}}return qF(e,t[0])&&qF(e,t[1])}function cH(e,t,r,i,n){var a=i.coordinateSystem;var o=e.getItemModel(t);var s;var l=Y(o.get("x"),n.getWidth());var u=Y(o.get("y"),n.getHeight());if(!isNaN(l)&&!isNaN(u)){s=[l,u]}else{if(i.getMarkerPosition){s=i.getMarkerPosition(e.getValues(e.dimensions,t))}else{var c=a.dimensions;var f=e.get(c[0],t);var h=e.get(c[1],t);s=a.dataToPoint([f,h])}if(JI(a,"cartesian2d")){var p=a.getAxis("x");var v=a.getAxis("y");var c=a.dimensions;if(sH(e.get(c[0],t))){s[0]=p.toGlobalCoord(p.getExtent()[r?0:1])}else if(sH(e.get(c[1],t))){s[1]=v.toGlobalCoord(v.getExtent()[r?0:1])}}if(!isNaN(l)){s[0]=l}if(!isNaN(u)){s[1]=u}}e.setItemLayout(t,s)}var fH=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.updateTransform=function(e,t,a){t.eachSeries(function(t){var e=GF.getMarkerModelFromSeries(t,"markLine");if(e){var r=e.getData();var i=aH(e).from;var n=aH(e).to;i.each(function(e){cH(i,e,true,t,a);cH(n,e,false,t,a)});r.each(function(e){r.setItemLayout(e,[i.getItemLayout(e),n.getItemLayout(e)])});this.markerGroupMap.get(t.id).updateLayout()}},this)};r.prototype.renderSeries=function(a,r,e,o){var t=a.coordinateSystem;var i=a.id;var s=a.getData();var n=this.markerGroupMap;var l=n.get(i)||n.set(i,new Nk);this.group.add(l.group);var u=hH(t,a,r);var c=u.from;var f=u.to;var h=u.line;aH(r).from=c;aH(r).to=f;r.setData(h);var p=r.get("symbol");var v=r.get("symbolSize");var d=r.get("symbolRotate");var g=r.get("symbolOffset");if(!k(p)){p=[p,p]}if(!k(v)){v=[v,v]}if(!k(d)){d=[d,d]}if(!k(g)){g=[g,g]}u.from.each(function(e){y(c,e,true);y(f,e,false)});h.each(function(e){var t=h.getItemModel(e).getModel("lineStyle").getLineStyle();h.setItemLayout(e,[c.getItemLayout(e),f.getItemLayout(e)]);if(t.stroke==null){t.stroke=c.getItemVisual(e,"style").fill}h.setItemVisual(e,{fromSymbolKeepAspect:c.getItemVisual(e,"symbolKeepAspect"),fromSymbolOffset:c.getItemVisual(e,"symbolOffset"),fromSymbolRotate:c.getItemVisual(e,"symbolRotate"),fromSymbolSize:c.getItemVisual(e,"symbolSize"),fromSymbol:c.getItemVisual(e,"symbol"),toSymbolKeepAspect:f.getItemVisual(e,"symbolKeepAspect"),toSymbolOffset:f.getItemVisual(e,"symbolOffset"),toSymbolRotate:f.getItemVisual(e,"symbolRotate"),toSymbolSize:f.getItemVisual(e,"symbolSize"),toSymbol:f.getItemVisual(e,"symbol"),style:t})});l.updateData(h);u.line.eachItemGraphicEl(function(e,t){e.traverse(function(e){j(e).dataModel=r})});function y(e,t,r){var i=e.getItemModel(t);cH(e,t,r,a,o);var n=i.getModel("itemStyle").getItemStyle();if(n.fill==null){n.fill=wm(s,"color")}e.setItemVisual(t,{symbolKeepAspect:i.get("symbolKeepAspect"),symbolOffset:N(i.get("symbolOffset"),g[r?0:1]),symbolRotate:N(i.get("symbolRotate",true),d[r?0:1]),symbolSize:N(i.get("symbolSize"),v[r?0:1]),symbol:N(i.get("symbol",true),p[r?0:1]),style:n})}this.markKeep(l);l.group.silent=r.get("silent")||a.get("silent")};r.type="markLine";return r}($F);function hH(e,r,t){var i;if(e){i=A(e&&e.dimensions,function(e){var t=r.getData().getDimensionInfo(r.getData().mapDimension(e))||{};return R({name:e},t)})}else{i=[{name:"value",type:"float"}]}var n=new qb(i,t);var a=new qb(i,t);var o=new qb([],t);var s=A(t.get("data"),_(oH,r,e,t));if(e){s=ue(s,_(uH,e))}var l=e?JF:function(e){return e.value};n.initData(A(s,function(e){return e[0]}),null,l);a.initData(A(s,function(e){return e[1]}),null,l);o.initData(A(s,function(e){return e[2]}));o.hasItemOption=true;return{from:n,to:a,line:o}}function pH(e){e.registerComponentModel(nH);e.registerComponentView(fH);e.registerPreprocessor(function(e){if(zF(e.series,"markLine")){e.markLine=e.markLine||{}}})}var vH=function(t){d(i,t);function i(){var e=t!==null&&t.apply(this,arguments)||this;e.type=i.type;return e}i.prototype.createMarkerModelFromSeries=function(e,t,r){return new i(e,t,r)};i.type="markArea";i.defaultOption={zlevel:0,z:1,tooltip:{trigger:"item"},animation:false,label:{show:true,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:true,position:"top"}}};return i}(GF);var dH=qa();var gH=function(e,t,r,i){var n=ZF(e,i[0]);var a=ZF(e,i[1]);var o=n.coord;var s=a.coord;o[0]=be(o[0],-Infinity);o[1]=be(o[1],-Infinity);s[0]=be(s[0],Infinity);s[1]=be(s[1],Infinity);var l=ie([{},n,a]);l.coord=[n.coord,a.coord];l.x0=n.x;l.y0=n.y;l.x1=a.x;l.y1=a.y;return l};function yH(e){return!isNaN(e)&&!isFinite(e)}function mH(e,t,r,i){var n=1-e;return yH(t[n])&&yH(r[n])}function xH(e,t){var r=t.coord[0];var i=t.coord[1];if(JI(e,"cartesian2d")){if(r&&i&&(mH(1,r,i)||mH(0,r,i))){return true}}return qF(e,{coord:r,x:t.x0,y:t.y0})||qF(e,{coord:i,x:t.x1,y:t.y1})}function _H(e,t,r,i,n){var a=i.coordinateSystem;var o=e.getItemModel(t);var s;var l=Y(o.get(r[0]),n.getWidth());var u=Y(o.get(r[1]),n.getHeight());if(!isNaN(l)&&!isNaN(u)){s=[l,u]}else{if(i.getMarkerPosition){s=i.getMarkerPosition(e.getValues(r,t))}else{var c=e.get(r[0],t);var f=e.get(r[1],t);var h=[c,f];a.clampData&&a.clampData(h,h);s=a.dataToPoint(h,true)}if(JI(a,"cartesian2d")){var p=a.getAxis("x");var v=a.getAxis("y");var c=e.get(r[0],t);var f=e.get(r[1],t);if(yH(c)){s[0]=p.toGlobalCoord(p.getExtent()[r[0]==="x0"?0:1])}else if(yH(f)){s[1]=v.toGlobalCoord(v.getExtent()[r[1]==="y0"?0:1])}}if(!isNaN(l)){s[0]=l}if(!isNaN(u)){s[1]=u}}return s}var bH=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]];var wH=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.updateTransform=function(e,t,a){t.eachSeries(function(i){var e=GF.getMarkerModelFromSeries(i,"markArea");if(e){var n=e.getData();n.each(function(t){var e=A(bH,function(e){return _H(n,t,e,i,a)});n.setItemLayout(t,e);var r=n.getItemGraphicEl(t);r.setShape("points",e)})}},this)};r.prototype.renderSeries=function(h,n,e,p){var v=h.coordinateSystem;var t=h.id;var d=h.getData();var r=this.markerGroupMap;var a=r.get(t)||r.set(t,{group:new H});this.group.add(a.group);this.markKeep(a);var g=SH(v,h,n);n.setData(g);g.each(function(t){var e=A(bH,function(e){return _H(g,t,e,h,p)});var r=v.getAxis("x").scale;var i=v.getAxis("y").scale;var n=r.getExtent();var a=i.getExtent();var o=[r.parse(g.get("x0",t)),r.parse(g.get("x1",t))];var s=[i.parse(g.get("y0",t)),i.parse(g.get("y1",t))];Yn(o);Yn(s);var l=!(n[0]>o[1]||n[1]<o[0]||a[0]>s[1]||a[1]<s[0]);var u=!l;g.setItemLayout(t,{points:e,allClipped:u});var c=g.getItemModel(t).getModel("itemStyle").getItemStyle();var f=wm(d,"color");if(!c.fill){c.fill=f;if(typeof c.fill==="string"){c.fill=zr(c.fill,.4)}}if(!c.stroke){c.stroke=f}g.setItemVisual(t,"style",c)});g.diff(dH(a).data).add(function(e){var t=g.getItemLayout(e);if(!t.allClipped){var r=new uf({shape:{points:t.points}});g.setItemGraphicEl(e,r);a.group.add(r)}}).update(function(e,t){var r=dH(a).data.getItemGraphicEl(t);var i=g.getItemLayout(e);if(!i.allClipped){if(r){X(r,{shape:{points:i.points}},n,e)}else{r=new uf({shape:{points:i.points}})}g.setItemGraphicEl(e,r);a.group.add(r)}else if(r){a.group.remove(r)}}).remove(function(e){var t=dH(a).data.getItemGraphicEl(e);a.group.remove(t)}).execute();g.eachItemGraphicEl(function(e,t){var r=g.getItemModel(t);var i=g.getItemVisual(t,"style");e.useStyle(g.getItemVisual(t,"style"));mh(e,xh(r),{labelFetcher:n,labelDataIndex:t,defaultText:g.getName(t)||"",inheritColor:typeof i.fill==="string"?zr(i.fill,1):"#000"});ac(e,r);tc(e);j(e).dataModel=n});dH(a).data=g;a.group.silent=n.get("silent")||h.get("silent")};r.type="markArea";return r}($F);function SH(e,i,t){var r;var n;var a=["x0","y0","x1","y1"];if(e){r=A(e&&e.dimensions,function(e){var t=i.getData();var r=t.getDimensionInfo(t.mapDimension(e))||{};return R({name:e},r)});n=new qb(A(a,function(e,t){return{name:e,type:r[t%2].type}}),t)}else{r=[{name:"value",type:"float"}];n=new qb(r,t)}var o=A(t.get("data"),_(gH,i,e,t));if(e){o=ue(o,_(xH,e))}var s=e?function(e,t,r,i){return e.coord[Math.floor(i/2)][i%2]}:function(e){return e.value};n.initData(o,null,s);n.hasItemOption=true;return n}function MH(e){e.registerComponentModel(vH);e.registerComponentView(wH);e.registerPreprocessor(function(e){if(zF(e.series,"markArea")){e.markArea=e.markArea||{}}})}var IH=function(e,t){if(t==="all"){return{type:"all",title:e.getLocale(["legend","selector","all"])}}else if(t==="inverse"){return{type:"inverse",title:e.getLocale(["legend","selector","inverse"])}}};var CH=function(r){d(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;e.type=t.type;e.layoutMode={type:"box",ignoreSize:true};return e}t.prototype.init=function(e,t,r){this.mergeDefaultAndTheme(e,r);e.selected=e.selected||{};this._updateSelector(e)};t.prototype.mergeOption=function(e,t){r.prototype.mergeOption.call(this,e,t);this._updateSelector(e)};t.prototype._updateSelector=function(e){var r=e.selector;var i=this.ecModel;if(r===true){r=e.selector=["all","inverse"]}if(k(r)){U(r,function(e,t){P(e)&&(e={type:e});r[t]=y(e,IH(i,e.type))})}};t.prototype.optionUpdated=function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&this.get("selectedMode")==="single"){var t=false;for(var r=0;r<e.length;r++){var i=e[r].get("name");if(this.isSelected(i)){this.select(i);t=true;break}}!t&&this.select(e[0].get("name"))}};t.prototype._updateData=function(a){var o=[];var s=[];a.eachRawSeries(function(e){var t=e.name;s.push(t);var r;if(e.legendVisualProvider){var i=e.legendVisualProvider;var n=i.getAllNames();if(!a.isSeriesFiltered(e)){s=s.concat(n)}if(n.length){o=o.concat(n)}else{r=true}}else{r=true}if(r&&Ha(e)){o.push(e.name)}});this._availableNames=s;var e=this.get("data")||o;var t=A(e,function(e){if(typeof e==="string"||typeof e==="number"){e={name:e}}return new C(e,this,this.ecModel)},this);this._data=t};t.prototype.getData=function(){return this._data};t.prototype.select=function(e){var t=this.option.selected;var r=this.get("selectedMode");if(r==="single"){var i=this._data;U(i,function(e){t[e.get("name")]=false})}t[e]=true};t.prototype.unSelect=function(e){if(this.get("selectedMode")!=="single"){this.option.selected[e]=false}};t.prototype.toggleSelected=function(e){var t=this.option.selected;if(!t.hasOwnProperty(e)){t[e]=true}this[t[e]?"unSelect":"select"](e)};t.prototype.allSelect=function(){var e=this._data;var t=this.option.selected;U(e,function(e){t[e.get("name",true)]=true})};t.prototype.inverseSelect=function(){var e=this._data;var r=this.option.selected;U(e,function(e){var t=e.get("name",true);if(!r.hasOwnProperty(t)){r[t]=true}r[t]=!r[t]})};t.prototype.isSelected=function(e){var t=this.option.selected;return!(t.hasOwnProperty(e)&&!t[e])&&D(this._availableNames,e)>=0};t.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}};t.type="legend.plain";t.dependencies=["series"];t.defaultOption={zlevel:0,z:4,show:true,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",decal:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0},textStyle:{color:"#333"},selectedMode:true,selector:false,selectorLabel:{show:true,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:" sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:true,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:false}};return t}(p);var TH=_;var DH=U;var AH=H;var LH=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.newlineDisabled=false;return e}r.prototype.init=function(){this.group.add(this._contentGroup=new AH);this.group.add(this._selectorGroup=new AH);this._isFirstRender=true};r.prototype.getContentGroup=function(){return this._contentGroup};r.prototype.getSelectorGroup=function(){return this._selectorGroup};r.prototype.render=function(e,t,r){var i=this._isFirstRender;this._isFirstRender=false;this.resetInner();if(!e.get("show",true)){return}var n=e.get("align");var a=e.get("orient");if(!n||n==="auto"){n=e.get("left")==="right"&&a==="vertical"?"right":"left"}var o=e.get("selector",true);var s=e.get("selectorPosition",true);if(o&&(!s||s==="auto")){s=a==="horizontal"?"end":"start"}this.renderInner(n,e,t,r,o,a,s);var l=e.getBoxLayoutParams();var u={width:r.getWidth(),height:r.getHeight()};var c=e.get("padding");var f=sv(l,u,c);var h=this.layoutInner(e,n,f,i,o,s);var p=sv(R({width:h.width,height:h.height},l),u,c);this.group.x=p.x-h.x;this.group.y=p.y-h.y;this.group.markRedraw();this.group.add(this._backgroundEl=s4(h,e))};r.prototype.resetInner=function(){this.getContentGroup().removeAll();this._backgroundEl&&this.group.remove(this._backgroundEl);this.getSelectorGroup().removeAll()};r.prototype.renderInner=function(c,f,h,p,e,t,r){var v=this.getContentGroup();var d=I();var g=f.get("selectedMode");var y=[];h.eachRawSeries(function(e){!e.get("legendHoverLink")&&y.push(e.id)});DH(f.getData(),function(s,l){var u=s.get("name");if(!this.newlineDisabled&&(u===""||u==="\n")){var e=new AH;e.newline=true;v.add(e);return}var t=h.getSeriesByName(u)[0];if(d.get(u)){return}if(t){var r=t.getData();var i=r.getVisual("legendLineStyle")||{};var n=r.getVisual("legendIcon");var a=r.getVisual("style");var o=this._createItem(t,u,l,s,f,c,i,a,n,g);o.on("click",TH(OH,u,null,p,y)).on("mouseover",TH(EH,t.name,null,p,y)).on("mouseout",TH(RH,t.name,null,p,y));d.set(u,true)}else{h.eachRawSeries(function(e){if(d.get(u)){return}if(e.legendVisualProvider){var t=e.legendVisualProvider;if(!t.containName(u)){return}var r=t.indexOfName(u);var i=t.getItemVisual(r,"style");var n=t.getItemVisual(r,"legendIcon");var a=Tr(i.fill);if(a&&a[3]===0){a[3]=.2;i.fill=Br(a,"rgba")}var o=this._createItem(e,u,l,s,f,c,{},i,n,g);o.on("click",TH(OH,null,u,p,y)).on("mouseover",TH(EH,null,u,p,y)).on("mouseout",TH(RH,null,u,p,y));d.set(u,true)}},this)}if("development"!=="production"){if(!d.get(u)){console.warn(u+" series not exists. Legend data should be same with series name or data name.")}}},this);if(e){this._createSelector(e,f,p,t,r)}};r.prototype._createSelector=function(e,o,s,t,r){var l=this.getSelectorGroup();DH(e,function e(t){var r=t.type;var i=new W({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){s.dispatchAction({type:r==="all"?"legendAllSelect":"legendInverseSelect"})}});l.add(i);var n=o.getModel("selectorLabel");var a=o.getModel(["emphasis","selectorLabel"]);mh(i,{normal:n,emphasis:a},{defaultText:t.title});tc(i)})};r.prototype._createItem=function(e,t,r,i,n,a,o,s,l,u){var c=e.visualDrawType;var f=n.get("itemWidth");var h=n.get("itemHeight");var p=n.isSelected(t);var v=i.get("symbolRotate");var d=i.get("icon");l=d||l||"roundRect";var g=n.getModel("lineStyle");var y=kH(l,i,g,o,s,c,p);var m=new AH;var x=i.getModel("textStyle");if(typeof e.getLegendIcon==="function"&&(!d||d==="inherit")){m.add(e.getLegendIcon({itemWidth:f,itemHeight:h,icon:l,iconRotate:v,itemStyle:y.itemStyle,lineStyle:y.lineStyle}))}else{var _=d==="inherit"&&e.getData().getVisual("symbol")?v==="inherit"?e.getData().getVisual("symbolRotate"):v:0;m.add(PH({itemWidth:f,itemHeight:h,icon:l,iconRotate:_,itemStyle:y.itemStyle,lineStyle:y.lineStyle}))}var b=a==="left"?f+5:-5;var w=a;var S=n.get("formatter");var M=t;if(typeof S==="string"&&S){M=S.replace("{name}",t!=null?t:"")}else if(typeof S==="function"){M=S(t)}var I=i.get("inactiveColor");m.add(new W({style:_h(x,{text:M,x:b,y:h/2,fill:p?x.getTextColor():I,align:w,verticalAlign:"middle"})}));var C=new G({shape:m.getBoundingRect(),invisible:true});var T=i.getModel("tooltip");if(T.get("show")){ph({el:C,componentModel:n,itemName:t,itemTooltipOption:T.option})}m.add(C);m.eachChild(function(e){e.silent=true});C.silent=!u;this.getContentGroup().add(m);tc(m);m.__legendDataIndex=r;return m};r.prototype.layoutInner=function(e,t,r,i,n,a){var o=this.getContentGroup();var s=this.getSelectorGroup();iv(e.get("orient"),o,e.get("itemGap"),r.width,r.height);var l=o.getBoundingRect();var u=[-l.x,-l.y];s.markRedraw();o.markRedraw();if(n){iv("horizontal",s,e.get("selectorItemGap",true));var c=s.getBoundingRect();var f=[-c.x,-c.y];var h=e.get("selectorButtonGap",true);var p=e.getOrient().index;var v=p===0?"width":"height";var d=p===0?"height":"width";var g=p===0?"y":"x";if(a==="end"){f[p]+=l[v]+h}else{u[p]+=c[v]+h}f[1-p]+=l[d]/2-c[d]/2;s.x=f[0];s.y=f[1];o.x=u[0];o.y=u[1];var y={x:0,y:0};y[v]=l[v]+h+c[v];y[d]=Math.max(l[d],c[d]);y[g]=Math.min(0,c[g]+f[1-p]);return y}else{o.x=u[0];o.y=u[1];return this.group.getBoundingRect()}};r.prototype.remove=function(){this.getContentGroup().removeAll();this._isFirstRender=true};r.type="legend.plain";return r}(My);function kH(e,t,r,i,n,a,o){var s=t.getModel("itemStyle");var l=Bh.concat([["decal"]]);var u={};for(var c=0;c<l.length;++c){var f=l[c][l[c].length-1];var h=l[c][0];var p=s.getShallow(f);if(p==="inherit"){switch(h){case"fill":u.fill=n[a];break;case"stroke":u.stroke=n[e.lastIndexOf("empty",0)===0?"fill":"stroke"];break;case"opacity":u.opacity=(a==="fill"?n:i).opacity;break;default:u[h]=n[h]}}else if(p==="auto"&&h==="lineWidth"){u.lineWidth=n.lineWidth>0?2:0}else{u[h]=p}}var v=t.getModel("lineStyle");var d=Eh.concat([["inactiveColor"],["inactiveWidth"]]);var g={};for(var c=0;c<d.length;++c){var f=d[c][1];var h=d[c][0];var p=v.getShallow(f);if(p==="inherit"){g[h]=i[h]}else if(p==="auto"&&h==="lineWidth"){g.lineWidth=i.lineWidth>0?2:0}else{g[h]=p}}u.fill==="auto"&&(u.fill=n.fill);u.stroke==="auto"&&(u.stroke=n.fill);g.stroke==="auto"&&(g.stroke=n.fill);if(!o){var y=t.get("inactiveBorderWidth");var m=u[e.indexOf("empty")>-1?"fill":"stroke"];u.lineWidth=y==="auto"?n.lineWidth>0&&m?2:0:u.lineWidth;u.fill=t.get("inactiveColor");u.stroke=t.get("inactiveBorderColor");g.stroke=r.get("inactiveColor");g.lineWidth=r.get("inactiveWidth")}return{itemStyle:u,lineStyle:g}}function PH(e){var t=e.icon||"roundRect";var r=S0(t,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);r.setStyle(e.itemStyle);r.rotation=(e.iconRotate||0)*Math.PI/180;r.setOrigin([e.itemWidth/2,e.itemHeight/2]);if(t.indexOf("empty")>-1){r.style.stroke=r.style.fill;r.style.fill="#fff";r.style.lineWidth=2}return r}function OH(e,t,r,i){RH(e,t,r,i);r.dispatchAction({type:"legendToggleSelect",name:e!=null?e:t});EH(e,t,r,i)}function NH(e){var t=e.getZr().storage.getDisplayList();var r;var i=0;var n=t.length;while(i<n&&!(r=t[i].states.emphasis)){i++}return r&&r.hoverLayer}function EH(e,t,r,i){if(!NH(r)){r.dispatchAction({type:"highlight",seriesName:e,name:t,excludeSeriesId:i})}}function RH(e,t,r,i){if(!NH(r)){r.dispatchAction({type:"downplay",seriesName:e,name:t,excludeSeriesId:i})}}function zH(e){var r=e.findComponents({mainType:"legend"});if(r&&r.length){e.filterSeries(function(e){for(var t=0;t<r.length;t++){if(!r[t].isSelected(e.name)){return false}}return true})}}function BH(t,r,e){var n={};var a=t==="toggleSelected";var o;e.eachComponent("legend",function(i){if(a&&o!=null){i[o?"select":"unSelect"](r.name)}else if(t==="allSelect"||t==="inverseSelect"){i[t]()}else{i[t](r.name);o=i.isSelected(r.name)}var e=i.getData();U(e,function(e){var t=e.get("name");if(t==="\n"||t===""){return}var r=i.isSelected(t);if(n.hasOwnProperty(t)){n[t]=n[t]&&r}else{n[t]=r}})});return t==="allSelect"||t==="inverseSelect"?{selected:n}:{name:r.name,selected:n}}function VH(e){e.registerAction("legendToggleSelect","legendselectchanged",_(BH,"toggleSelected"));e.registerAction("legendAllSelect","legendselectall",_(BH,"allSelect"));e.registerAction("legendInverseSelect","legendinverseselect",_(BH,"inverseSelect"));e.registerAction("legendSelect","legendselected",_(BH,"select"));e.registerAction("legendUnSelect","legendunselected",_(BH,"unSelect"))}function GH(e){e.registerComponentModel(CH);e.registerComponentView(LH);e.registerProcessor(e.PRIORITY.PROCESSOR.SERIES_FILTER,zH);e.registerSubTypeDefaulter("legend",function(){return"plain"});VH(e)}var FH=function(n){d(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.setScrollDataIndex=function(e){this.option.scrollDataIndex=e};t.prototype.init=function(e,t,r){var i=hv(e);n.prototype.init.call(this,e,t,r);HH(this,e,i)};t.prototype.mergeOption=function(e,t){n.prototype.mergeOption.call(this,e,t);HH(this,this.option,e)};t.type="legend.scroll";t.defaultOption=Uh(CH.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800});return t}(CH);function HH(e,t,r){var i=e.getOrient();var n=[1,1];n[i.index]=0;fv(t,r,{type:"box",ignoreSize:!!n})}var WH=H;var jH=["width","height"];var UH=["x","y"];var ZH=function(p){d(t,p);function t(){var e=p!==null&&p.apply(this,arguments)||this;e.type=t.type;e.newlineDisabled=true;e._currentIndex=0;return e}t.prototype.init=function(){p.prototype.init.call(this);this.group.add(this._containerGroup=new WH);this._containerGroup.add(this.getContentGroup());this.group.add(this._controllerGroup=new WH)};t.prototype.resetInner=function(){p.prototype.resetInner.call(this);this._controllerGroup.removeAll();this._containerGroup.removeClipPath();this._containerGroup.__rectSize=null};t.prototype.renderInner=function(e,n,t,a,r,i,o){var s=this;p.prototype.renderInner.call(this,e,n,t,a,r,i,o);var l=this._controllerGroup;var u=n.get("pageIconSize",true);var c=k(u)?u:[u,u];h("pagePrev",0);var f=n.getModel("pageTextStyle");l.add(new W({name:"pageText",style:{text:"xx/xx",fill:f.getTextColor(),font:f.getFont(),verticalAlign:"middle",align:"center"},silent:true}));h("pageNext",1);function h(e,t){var r=e+"DataIndex";var i=lh(n.get("pageIcons",true)[n.getOrient().name][t],{onclick:x(s._pageGo,s,r,n,a)},{x:-c[0]/2,y:-c[1]/2,width:c[0],height:c[1]});i.name=e;l.add(i)}};t.prototype.layoutInner=function(e,t,r,i,n,a){var o=this.getSelectorGroup();var s=e.getOrient().index;var l=jH[s];var u=UH[s];var c=jH[1-s];var f=UH[1-s];n&&iv("horizontal",o,e.get("selectorItemGap",true));var h=e.get("selectorButtonGap",true);var p=o.getBoundingRect();var v=[-p.x,-p.y];var d=M(r);n&&(d[l]=r[l]-p[l]-h);var g=this._layoutContentAndController(e,i,d,s,l,c,f,u);if(n){if(a==="end"){v[s]+=g[l]+h}else{var y=p[l]+h;v[s]-=y;g[u]-=y}g[l]+=p[l]+h;v[1-s]+=g[f]+g[c]/2-p[c]/2;g[c]=Math.max(g[c],p[c]);g[f]=Math.min(g[f],p[f]+v[1-s]);o.x=v[0];o.y=v[1];o.markRedraw()}return g};t.prototype._layoutContentAndController=function(e,t,r,i,n,a,o,s){var l=this.getContentGroup();var u=this._containerGroup;var c=this._controllerGroup;iv(e.get("orient"),l,e.get("itemGap"),!i?null:r.width,i?null:r.height);iv("horizontal",c,e.get("pageButtonItemGap",true));var f=l.getBoundingRect();var h=c.getBoundingRect();var p=this._showController=f[n]>r[n];var v=[-f.x,-f.y];if(!t){v[i]=l[s]}var d=[0,0];var g=[-h.x,-h.y];var y=N(e.get("pageButtonGap",true),e.get("itemGap",true));if(p){var m=e.get("pageButtonPosition",true);if(m==="end"){g[i]+=r[n]-h[n]}else{d[i]+=h[n]+y}}g[1-i]+=f[a]/2-h[a]/2;l.setPosition(v);u.setPosition(d);c.setPosition(g);var x={x:0,y:0};x[n]=p?r[n]:f[n];x[a]=Math.max(f[a],h[a]);x[o]=Math.min(0,h[o]+g[1-i]);u.__rectSize=r[n];if(p){var _={x:0,y:0};_[n]=Math.max(r[n]-h[n]-y,0);_[a]=x[a];u.setClipPath(new G({shape:_}));u.__rectSize=_[n]}else{c.eachChild(function(e){e.attr({invisible:true,silent:true})})}var b=this._getPageInfo(e);b.pageIndex!=null&&X(l,{x:b.contentPosition[0],y:b.contentPosition[1]},p?e:null);this._updatePageInfoView(e,b);return x};t.prototype._pageGo=function(e,t,r){var i=this._getPageInfo(t)[e];i!=null&&r.dispatchAction({type:"legendScroll",scrollDataIndex:i,legendId:t.id})};t.prototype._updatePageInfoView=function(n,a){var o=this._controllerGroup;U(["pagePrev","pageNext"],function(e){var t=e+"DataIndex";var r=a[t]!=null;var i=o.childOfName(e);if(i){i.setStyle("fill",r?n.get("pageIconColor",true):n.get("pageIconInactiveColor",true));i.cursor=r?"pointer":"default"}});var e=o.childOfName("pageText");var t=n.get("pageFormatter");var r=a.pageIndex;var i=r!=null?r+1:0;var s=a.pageCount;e&&t&&e.setStyle("text",P(t)?t.replace("{current}",i==null?"":i+"").replace("{total}",s==null?"":s+""):t({current:i,total:s}))};t.prototype._getPageInfo=function(e){var t=e.get("scrollDataIndex",true);var r=this.getContentGroup();var i=this._containerGroup.__rectSize;var n=e.getOrient().index;var a=jH[n];var o=UH[n];var s=this._findTargetItemIndex(t);var l=r.children();var u=l[s];var c=l.length;var f=!c?0:1;var h={contentPosition:[r.x,r.y],pageCount:f,pageIndex:f-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!u){return h}var p=m(u);h.contentPosition[n]=-p.s;for(var v=s+1,d=p,g=p,y=null;v<=c;++v){y=m(l[v]);if(!y&&g.e>d.s+i||y&&!x(y,d.s)){if(g.i>d.i){d=g}else{d=y}if(d){if(h.pageNextDataIndex==null){h.pageNextDataIndex=d.i}++h.pageCount}}g=y}for(var v=s-1,d=p,g=p,y=null;v>=-1;--v){y=m(l[v]);if((!y||!x(g,y.s))&&d.i<g.i){g=d;if(h.pagePrevDataIndex==null){h.pagePrevDataIndex=d.i}++h.pageCount;++h.pageIndex}d=y}return h;function m(e){if(e){var t=e.getBoundingRect();var r=t[o]+e[o];return{s:r,e:r+t[a],i:e.__legendDataIndex}}}function x(e,t){return e.e>=t&&e.s<=t+i}};t.prototype._findTargetItemIndex=function(i){if(!this._showController){return 0}var n;var e=this.getContentGroup();var a;e.eachChild(function(e,t){var r=e.__legendDataIndex;if(a==null&&r!=null){a=t}if(r===i){n=t}});return n!=null?n:a};t.type="legend.scroll";return t}(LH);function YH(e){e.registerAction("legendScroll","legendscroll",function(e,t){var r=e.scrollDataIndex;r!=null&&t.eachComponent({mainType:"legend",subType:"scroll",query:e},function(e){e.setScrollDataIndex(r)})})}function XH(e){t(GH);e.registerComponentModel(FH);e.registerComponentView(ZH);YH(e)}function qH(e){t(GH);t(XH)}var JH=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="dataZoom.inside";r.defaultOption=Uh(FV.defaultOption,{disabled:false,zoomLock:false,zoomOnMouseWheel:true,moveOnMouseMove:true,moveOnMouseWheel:false,preventDefaultMouseMove:true});return r}(FV);var KH=qa();function QH(e,r,i){KH(e).coordSysRecordMap.each(function(e){var t=e.dataZoomInfoMap.get(r.uid);if(t){t.getRange=i}})}function $H(e,t){var r=KH(e).coordSysRecordMap;var i=r.keys();for(var n=0;n<i.length;n++){var a=i[n];var o=r.get(a);var s=o.dataZoomInfoMap;if(s){var l=t.uid;var u=s.get(l);if(u){s.removeKey(l);if(!s.keys().length){eW(r,o)}}}}}function eW(e,t){if(t){e.removeKey(t.model.uid);var r=t.controller;r&&r.dispose()}}function tW(e,t){var o={model:t,containsPoint:_(iW,t),dispatchAction:_(rW,e),dataZoomInfoMap:null,controller:null};var r=o.controller=new WT(e.getZr());U(["pan","zoom","scrollMove"],function(a){r.on(a,function(i){var n=[];o.dataZoomInfoMap.each(function(e){if(!i.isAvailableBehavior(e.model.option)){return}var t=(e.getRange||{})[a];var r=t&&t(e.dzReferCoordSysInfo,o.model.mainType,o.controller,i);!e.model.get("disabled",true)&&r&&n.push({dataZoomId:e.model.id,start:r[0],end:r[1]})});n.length&&o.dispatchAction(n)})});return o}function rW(e,t){e.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:t})}function iW(e,t,r,i){return e.coordinateSystem.containPoint([r,i])}function nW(e){var i;var n="type_";var a={type_true:2,type_move:1,type_false:0,type_undefined:-1};var o=true;e.each(function(e){var t=e.model;var r=t.get("disabled",true)?false:t.get("zoomLock",true)?"move":true;if(a[n+r]>a[n+i]){i=r}o=o&&t.get("preventDefaultMouseMove",true)});return{controlType:i,opt:{zoomOnMouseWheel:true,moveOnMouseMove:true,moveOnMouseWheel:true,preventDefaultMouseMove:!!o}}}function aW(e){e.registerProcessor(e.PRIORITY.PROCESSOR.FILTER,function(e,a){var t=KH(a);var o=t.coordSysRecordMap||(t.coordSysRecordMap=I());o.each(function(e){e.dataZoomInfoMap=null});e.eachComponent({mainType:"dataZoom",subType:"inside"},function(n){var e=VV(n);U(e.infoList,function(e){var t=e.model.uid;var r=o.get(t)||o.set(t,tW(a,e.model));var i=r.dataZoomInfoMap||(r.dataZoomInfoMap=I());i.set(n.uid,{dzReferCoordSysInfo:e,model:n,getRange:null})})});o.each(function(e){var t=e.controller;var r;var i=e.dataZoomInfoMap;if(i){var n=i.keys()[0];if(n!=null){r=i.get(n)}}if(!r){eW(o,e);return}var a=nW(i);t.enable(a.controlType,a.opt);t.setPointerChecker(e.containsPoint);zy(e,"dispatchAction",r.model.get("throttle",true),"fixRate")})})}var oW=function(i){d(e,i);function e(){var e=i!==null&&i.apply(this,arguments)||this;e.type="dataZoom.inside";return e}e.prototype.render=function(e,t,r){i.prototype.render.apply(this,arguments);if(e.noTarget()){this._clear();return}this.range=e.getPercentRange();QH(r,e,{pan:x(sW.pan,this),zoom:x(sW.zoom,this),scrollMove:x(sW.scrollMove,this)})};e.prototype.dispose=function(){this._clear();i.prototype.dispose.apply(this,arguments)};e.prototype._clear=function(){$H(this.api,this.dataZoomModel);this.range=null};e.type="dataZoom.inside";return e}(jV);var sW={zoom:function(e,t,r,i){var n=this.range;var a=n.slice();var o=e.axisModels[0];if(!o){return}var s=uW[t](null,[i.originX,i.originY],o,r,e);var l=(s.signal>0?s.pixelStart+s.pixelLength-s.pixel:s.pixel-s.pixelStart)/s.pixelLength*(a[1]-a[0])+a[0];var u=Math.max(1/i.scale,0);a[0]=(a[0]-l)*u+l;a[1]=(a[1]-l)*u+l;var c=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();WP(0,a,[0,100],0,c.minSpan,c.maxSpan);this.range=a;if(n[0]!==a[0]||n[1]!==a[1]){return a}},pan:lW(function(e,t,r,i,n,a){var o=uW[i]([a.oldX,a.oldY],[a.newX,a.newY],t,n,r);return o.signal*(e[1]-e[0])*o.pixel/o.pixelLength}),scrollMove:lW(function(e,t,r,i,n,a){var o=uW[i]([0,0],[a.scrollDelta,a.scrollDelta],t,n,r);return o.signal*(e[1]-e[0])*a.scrollDelta})};function lW(l){return function(e,t,r,i){var n=this.range;var a=n.slice();var o=e.axisModels[0];if(!o){return}var s=l(a,o,e,t,r,i);WP(s,a,[0,100],"all");this.range=a;if(n[0]!==a[0]||n[1]!==a[1]){return a}}}var uW={grid:function(e,t,r,i,n){var a=r.axis;var o={};var s=n.model.coordinateSystem.getRect();e=e||[0,0];if(a.dim==="x"){o.pixel=t[0]-e[0];o.pixelLength=s.width;o.pixelStart=s.x;o.signal=a.inverse?1:-1}else{o.pixel=t[1]-e[1];o.pixelLength=s.height;o.pixelStart=s.y;o.signal=a.inverse?-1:1}return o},polar:function(e,t,r,i,n){var a=r.axis;var o={};var s=n.model.coordinateSystem;var l=s.getRadiusAxis().getExtent();var u=s.getAngleAxis().getExtent();e=e?s.pointToCoord(e):[0,0];t=s.pointToCoord(t);if(r.mainType==="radiusAxis"){o.pixel=t[0]-e[0];o.pixelLength=l[1]-l[0];o.pixelStart=l[0];o.signal=a.inverse?1:-1}else{o.pixel=t[1]-e[1];o.pixelLength=u[1]-u[0];o.pixelStart=u[0];o.signal=a.inverse?-1:1}return o},singleAxis:function(e,t,r,i,n){var a=r.axis;var o=n.model.coordinateSystem.getRect();var s={};e=e||[0,0];if(a.orient==="horizontal"){s.pixel=t[0]-e[0];s.pixelLength=o.width;s.pixelStart=o.x;s.signal=a.inverse?1:-1}else{s.pixel=t[1]-e[1];s.pixelLength=o.height;s.pixelStart=o.y;s.signal=a.inverse?-1:1}return s}};function cW(e){$V(e);e.registerComponentModel(JH);e.registerComponentView(oW);aW(e)}var fW=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.type="dataZoom.slider";r.layoutMode="box";r.defaultOption=Uh(FV.defaultOption,{show:true,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:true,showDataShadow:"auto",realtime:true,zoomLock:false,textStyle:{color:"#6E7079"},brushSelect:true,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}});return r}(FV);var hW=G;var pW=7;var vW=1;var dW=30;var gW=7;var yW="horizontal";var mW="vertical";var xW=5;var _W=["line","bar","candlestick","scatter"];var bW={easing:"cubicOut",duration:100};var wW=function(n){d(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;e.type=t.type;e._displayables={};return e}t.prototype.init=function(e,t){this.api=t;this._onBrush=x(this._onBrush,this);this._onBrushEnd=x(this._onBrushEnd,this)};t.prototype.render=function(e,t,r,i){n.prototype.render.apply(this,arguments);zy(this,"_dispatchZoomAction",e.get("throttle"),"fixRate");this._orient=e.getOrient();if(e.get("show")===false){this.group.removeAll();return}if(e.noTarget()){this._clear();this.group.removeAll();return}if(!i||i.type!=="dataZoom"||i.from!==this.uid){this._buildView()}this._updateView()};t.prototype.dispose=function(){this._clear();n.prototype.dispose.apply(this,arguments)};t.prototype._clear=function(){By(this,"_dispatchZoomAction");var e=this.api.getZr();e.off("mousemove",this._onBrush);e.off("mouseup",this._onBrushEnd)};t.prototype._buildView=function(){var e=this.group;e.removeAll();this._brushing=false;this._displayables.brushRect=null;this._resetLocation();this._resetInterval();var t=this._displayables.sliderGroup=new H;this._renderBackground();this._renderHandle();this._renderDataShadow();e.add(t);this._positionGroup()};t.prototype._resetLocation=function(){var e=this.dataZoomModel;var t=this.api;var r=e.get("brushSelect");var i=r?gW:0;var n=this._findCoordRect();var a={width:t.getWidth(),height:t.getHeight()};var o=this._orient===yW?{right:a.width-n.x-n.width,top:a.height-dW-pW-i,width:n.width,height:dW}:{right:pW,top:n.y,width:dW,height:n.height};var s=hv(e.option);U(["right","top","width","height"],function(e){if(s[e]==="ph"){s[e]=o[e]}});var l=sv(s,a);this._location={x:l.x,y:l.y};this._size=[l.width,l.height];this._orient===mW&&this._size.reverse()};t.prototype._positionGroup=function(){var e=this.group;var t=this._location;var r=this._orient;var i=this.dataZoomModel.getFirstTargetAxisModel();var n=i&&i.get("inverse");var a=this._displayables.sliderGroup;var o=(this._dataShadowInfo||{}).otherAxisInverse;a.attr(r===yW&&!n?{scaleY:o?1:-1,scaleX:1}:r===yW&&n?{scaleY:o?1:-1,scaleX:-1}:r===mW&&!n?{scaleY:o?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:o?-1:1,scaleX:-1,rotation:Math.PI/2});var s=e.getBoundingRect([a]);e.x=t.x-s.x;e.y=t.y-s.y;e.markRedraw()};t.prototype._getViewExtent=function(){return[0,this._size[0]]};t.prototype._renderBackground=function(){var e=this.dataZoomModel;var t=this._size;var r=this._displayables.sliderGroup;var i=e.get("brushSelect");r.add(new hW({silent:true,shape:{x:0,y:0,width:t[0],height:t[1]},style:{fill:e.get("backgroundColor")},z2:-40}));var n=new hW({shape:{x:0,y:0,width:t[0],height:t[1]},style:{fill:"transparent"},z2:0,onclick:x(this._onClickPanel,this)});var a=this.api.getZr();if(i){n.on("mousedown",this._onBrushStart,this);n.cursor="crosshair";a.on("mousemove",this._onBrush);a.on("mouseup",this._onBrushEnd)}else{a.off("mousemove",this._onBrush);a.off("mouseup",this._onBrushEnd)}r.add(n)};t.prototype._renderDataShadow=function(){var e=this._dataShadowInfo=this._prepareDataShadowInfo();this._displayables.dataShadowSegs=[];if(!e){return}var t=this._size;var r=e.series;var i=r.getRawData();var n=r.getShadowDim?r.getShadowDim():e.otherDim;if(n==null){return}var a=i.getDataExtent(n);var o=(a[1]-a[0])*.3;a=[a[0]-o,a[1]+o];var s=[0,t[1]];var l=[0,t[0]];var u=[[t[0],0],[0,0]];var c=[];var f=l[1]/(i.count()-1);var h=0;var p=Math.round(i.count()/t[0]);var v;i.each([n],function(e,t){if(p>0&&t%p){h+=f;return}var r=e==null||isNaN(e)||e==="";var i=r?0:V(e,a,s,true);if(r&&!v&&t){u.push([u[u.length-1][0],0]);c.push([c[c.length-1][0],0])}else if(!r&&v){u.push([h,0]);c.push([h,0])}u.push([h,i]);c.push([h,i]);h+=f;v=r});var d=this.dataZoomModel;function g(e){var t=d.getModel(e?"selectedDataBackground":"dataBackground");var r=new H;var i=new uf({shape:{points:u},segmentIgnoreThreshold:1,style:t.getModel("areaStyle").getAreaStyle(),silent:true,z2:-20});var n=new ff({shape:{points:c},segmentIgnoreThreshold:1,style:t.getModel("lineStyle").getLineStyle(),silent:true,z2:-19});r.add(i);r.add(n);return r}for(var y=0;y<3;y++){var m=g(y===1);this._displayables.sliderGroup.add(m);this._displayables.dataShadowSegs.push(m)}};t.prototype._prepareDataShadowInfo=function(){var t=this.dataZoomModel;var s=t.get("showDataShadow");if(s===false){return}var l;var u=this.ecModel;t.eachTargetAxis(function(a,o){var e=t.getAxisProxy(a,o).getTargetSeriesModels();U(e,function(e){if(l){return}if(s!==true&&D(_W,e.get("type"))<0){return}var t=u.getComponent(zV(a),o).axis;var r=SW(a);var i;var n=e.coordinateSystem;if(r!=null&&n.getOtherAxis){i=n.getOtherAxis(t).inverse}r=e.getData().mapDimension(r);l={thisAxis:t,series:e,thisDim:a,otherDim:r,otherAxisInverse:i}},this)},this);return l};t.prototype._renderHandle=function(){var s=this.group;var e=this._displayables;var l=e.handles=[null,null];var u=e.handleLabels=[null,null];var c=this._displayables.sliderGroup;var t=this._size;var f=this.dataZoomModel;var r=this.api;var i=f.get("borderRadius")||0;var n=f.get("brushSelect");var a=e.filler=new hW({silent:n,style:{fill:f.get("fillerColor")},textConfig:{position:"inside"}});c.add(a);c.add(new hW({silent:true,subPixelOptimize:true,shape:{x:0,y:0,width:t[0],height:t[1],r:i},style:{stroke:f.get("dataBackgroundColor")||f.get("borderColor"),lineWidth:vW,fill:"rgba(0,0,0,0)"}}));U([0,1],function(e){var t=f.get("handleIcon");if(!_0[t]&&t.indexOf("path://")<0&&t.indexOf("image://")<0){t="path://"+t;if("development"!=="production"){xa("handleIcon now needs 'path://' prefix when using a path string")}}var r=S0(t,-1,0,2,2,null,true);r.attr({cursor:MW(this._orient),draggable:true,drift:x(this._onDragMove,this,e),ondragend:x(this._onDragEnd,this),onmouseover:x(this._showDataInfo,this,true),onmouseout:x(this._showDataInfo,this,false),z2:5});var i=r.getBoundingRect();var n=f.get("handleSize");this._handleHeight=Y(n,this._size[1]);this._handleWidth=i.width/i.height*this._handleHeight;r.setStyle(f.getModel("handleStyle").getItemStyle());r.style.strokeNoScale=true;r.rectHover=true;r.ensureState("emphasis").style=f.getModel(["emphasis","handleStyle"]).getItemStyle();tc(r);var a=f.get("handleColor");if(a!=null){r.style.fill=a}c.add(l[e]=r);var o=f.getModel("textStyle");s.add(u[e]=new W({silent:true,invisible:true,style:_h(o,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:o.getTextColor(),font:o.getFont()}),z2:10}))},this);var o=a;if(n){var h=Y(f.get("moveHandleSize"),t[1]);var p=e.moveHandle=new G({style:f.getModel("moveHandleStyle").getItemStyle(),silent:true,shape:{r:[0,0,2,2],y:t[1]-.5,height:h}});var v=h*.8;var d=e.moveHandleIcon=S0(f.get("moveHandleIcon"),-v/2,-v/2,v,v,"#fff",true);d.silent=true;d.y=t[1]+h/2-.5;p.ensureState("emphasis").style=f.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var g=Math.min(t[1]/2,Math.max(h,10));o=e.moveZone=new G({invisible:true,shape:{y:t[1]-g,height:h+g}});o.on("mouseover",function(){r.enterEmphasis(p)}).on("mouseout",function(){r.leaveEmphasis(p)});c.add(p);c.add(d);c.add(o)}o.attr({draggable:true,cursor:MW(this._orient),drift:x(this._onDragMove,this,"all"),ondragstart:x(this._showDataInfo,this,true),ondragend:x(this._onDragEnd,this),onmouseover:x(this._showDataInfo,this,true),onmouseout:x(this._showDataInfo,this,false)})};t.prototype._resetInterval=function(){var e=this._range=this.dataZoomModel.getPercentRange();var t=this._getViewExtent();this._handleEnds=[V(e[0],[0,100],t,true),V(e[1],[0,100],t,true)]};t.prototype._updateInterval=function(e,t){var r=this.dataZoomModel;var i=this._handleEnds;var n=this._getViewExtent();var a=r.findRepresentativeAxisProxy().getMinMaxSpan();var o=[0,100];WP(t,i,n,r.get("zoomLock")?"all":e,a.minSpan!=null?V(a.minSpan,o,n,true):null,a.maxSpan!=null?V(a.maxSpan,o,n,true):null);var s=this._range;var l=this._range=Yn([V(i[0],n,o,true),V(i[1],n,o,true)]);return!s||s[0]!==l[0]||s[1]!==l[1]};t.prototype._updateView=function(e){var i=this._displayables;var n=this._handleEnds;var t=Yn(n.slice());var a=this._size;U([0,1],function(e){var t=i.handles[e];var r=this._handleHeight;t.attr({scaleX:r/2,scaleY:r/2,x:n[e]+(e?-1:1),y:a[1]/2-r/2})},this);i.filler.setShape({x:t[0],y:0,width:t[1]-t[0],height:a[1]});var r={x:t[0],width:t[1]-t[0]};if(i.moveHandle){i.moveHandle.setShape(r);i.moveZone.setShape(r);i.moveZone.getBoundingRect();i.moveHandleIcon&&i.moveHandleIcon.attr("x",r.x+r.width/2)}var o=i.dataShadowSegs;var s=[0,t[0],t[1],a[0]];for(var l=0;l<o.length;l++){var u=o[l];var c=u.getClipPath();if(!c){c=new G;u.setClipPath(c)}c.setShape({x:s[l],y:0,width:s[l+1]-s[l],height:a[1]})}this._updateDataInfo(e)};t.prototype._updateDataInfo=function(e){var t=this.dataZoomModel;var a=this._displayables;var o=a.handleLabels;var s=this._orient;var l=["",""];if(t.get("showDetail")){var r=t.findRepresentativeAxisProxy();if(r){var i=r.getAxisModel().axis;var n=this._range;var u=e?r.calculateDataWindow({start:n[0],end:n[1]}).valueWindow:r.getDataValueWindow();l=[this._formatLabel(u[0],i),this._formatLabel(u[1],i)]}}var c=Yn(this._handleEnds.slice());f.call(this,0);f.call(this,1);function f(e){var t=eh(a.handles[e].parent,this.group);var r=rh(e===0?"right":"left",t);var i=this._handleWidth/2+xW;var n=th([c[e]+(e===0?-i:i),this._size[1]/2],t);o[e].setStyle({x:n[0],y:n[1],verticalAlign:s===yW?"middle":r,align:s===yW?r:"center",text:l[e]})}};t.prototype._formatLabel=function(e,t){var r=this.dataZoomModel;var i=r.get("labelFormatter");var n=r.get("labelPrecision");if(n==null||n==="auto"){n=t.getPixelPrecision()}var a=e==null||isNaN(e)?"":t.type==="category"||t.type==="time"?t.scale.getLabel({value:Math.round(e)}):e.toFixed(Math.min(n,20));return b(i)?i(e,a):P(i)?i.replace("{value}",a):a};t.prototype._showDataInfo=function(e){e=this._dragging||e;var t=this._displayables;var r=t.handleLabels;r[0].attr("invisible",!e);r[1].attr("invisible",!e);t.moveHandle&&this.api[e?"enterEmphasis":"leaveEmphasis"](t.moveHandle,1)};t.prototype._onDragMove=function(e,t,r,i){this._dragging=true;At(i.event);var n=this._displayables.sliderGroup.getLocalTransform();var a=th([t,r],n,true);var o=this._updateInterval(e,a[0]);var s=this.dataZoomModel.get("realtime");this._updateView(!s);o&&s&&this._dispatchZoomAction(true)};t.prototype._onDragEnd=function(){this._dragging=false;this._showDataInfo(false);var e=this.dataZoomModel.get("realtime");!e&&this._dispatchZoomAction(false)};t.prototype._onClickPanel=function(e){var t=this._size;var r=this._displayables.sliderGroup.transformCoordToLocal(e.offsetX,e.offsetY);if(r[0]<0||r[0]>t[0]||r[1]<0||r[1]>t[1]){return}var i=this._handleEnds;var n=(i[0]+i[1])/2;var a=this._updateInterval("all",r[0]-n);this._updateView();a&&this._dispatchZoomAction(false)};t.prototype._onBrushStart=function(e){var t=e.offsetX;var r=e.offsetY;this._brushStart=new Z(t,r);this._brushing=true;this._brushStartTime=+new Date};t.prototype._onBrushEnd=function(e){if(!this._brushing){return}var t=this._displayables.brushRect;this._brushing=false;if(!t){return}t.attr("ignore",true);var r=t.shape;var i=+new Date;if(i-this._brushStartTime<200&&Math.abs(r.width)<5){return}var n=this._getViewExtent();var a=[0,100];this._range=Yn([V(r.x,n,a,true),V(r.x+r.width,n,a,true)]);this._handleEnds=[r.x,r.x+r.width];this._updateView();this._dispatchZoomAction(false)};t.prototype._onBrush=function(e){if(this._brushing){At(e.event);this._updateBrushRect(e.offsetX,e.offsetY)}};t.prototype._updateBrushRect=function(e,t){var r=this._displayables;var i=this.dataZoomModel;var n=r.brushRect;if(!n){n=r.brushRect=new hW({silent:true,style:i.getModel("brushStyle").getItemStyle()});r.sliderGroup.add(n)}n.attr("ignore",false);var a=this._brushStart;var o=this._displayables.sliderGroup;var s=o.transformCoordToLocal(e,t);var l=o.transformCoordToLocal(a.x,a.y);var u=this._size;s[0]=Math.max(Math.min(u[0],s[0]),0);n.setShape({x:l[0],y:0,width:s[0]-l[0],height:u[1]})};t.prototype._dispatchZoomAction=function(e){var t=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:e?bW:null,start:t[0],end:t[1]})};t.prototype._findCoordRect=function(){var e;var t=VV(this.dataZoomModel).infoList;if(!e&&t.length){var r=t[0].model.coordinateSystem;e=r.getRect&&r.getRect()}if(!e){var i=this.api.getWidth();var n=this.api.getHeight();e={x:i*.2,y:n*.2,width:i*.6,height:n*.6}}return e};t.type="dataZoom.slider";return t}(jV);function SW(e){var t={x:"y",y:"x",radius:"angle",angle:"radius"};return t[e]}function MW(e){return e==="vertical"?"ns-resize":"ew-resize"}function IW(e){e.registerComponentModel(fW);e.registerComponentView(wW);$V(e)}function CW(e){t(cW);t(IW)}var TW={get:function(e,t,r){var i=M((DW[e]||{})[t]);return r?k(i)?i[i.length-1]:i:i}};var DW={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}};var AW=eL.mapVisual;var LW=eL.eachVisual;var kW=k;var PW=U;var OW=Yn;var NW=V;var EW=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.stateList=["inRange","outOfRange"];e.replacableOptionKeys=["inRange","outOfRange","target","controller","color"];e.layoutMode={type:"box",ignoreSize:true};e.dataBound=[-Infinity,Infinity];e.targetVisuals={};e.controllerVisuals={};return e}r.prototype.init=function(e,t,r){this.mergeDefaultAndTheme(e,r)};r.prototype.optionUpdated=function(e,t){var r=this.option;if(!S.canvasSupported){r.realtime=false}!t&&UG(r,e,this.replacableOptionKeys);this.textStyleModel=this.getModel("textStyle");this.resetItemSize();this.completeVisualOption()};r.prototype.resetVisual=function(e){var t=this.stateList;e=x(e,this);this.controllerVisuals=jG(this.option.controller,t,e);this.targetVisuals=jG(this.option.target,t,e)};r.prototype.getItemSymbol=function(){return null};r.prototype.getTargetSeriesIndices=function(){var e=this.option.seriesIndex;var r=[];if(e==null||e==="all"){this.ecModel.eachSeries(function(e,t){r.push(t)})}else{r=Ia(e)}return r};r.prototype.eachTargetSeries=function(r,i){U(this.getTargetSeriesIndices(),function(e){var t=this.ecModel.getSeriesByIndex(e);if(t){r.call(i,t)}},this)};r.prototype.isTargetSeries=function(t){var r=false;this.eachTargetSeries(function(e){e===t&&(r=true)});return r};r.prototype.formatValueText=function(e,t,r){var i=this.option;var n=i.precision;var a=this.dataBound;var o=i.formatter;var s;r=r||["<",">"];if(k(e)){e=e.slice();s=true}var l=t?e:s?[u(e[0]),u(e[1])]:u(e);if(P(o)){return o.replace("{value}",s?l[0]:l).replace("{value2}",s?l[1]:l)}else if(b(o)){return s?o(e[0],e[1]):o(e)}if(s){if(e[0]===a[0]){return r[0]+" "+l[1]}else if(e[1]===a[1]){return r[1]+" "+l[0]}else{return l[0]+" - "+l[1]}}else{return l}function u(e){return e===a[0]?"min":e===a[1]?"max":(+e).toFixed(Math.min(n,20))}};r.prototype.resetExtent=function(){var e=this.option;var t=OW([e.min,e.max]);this._dataExtent=t};r.prototype.getDataDimension=function(e){var t=this.option.dimension;var r=e.dimensions;if(t==null&&!r.length){return}if(t!=null){return e.getDimension(t)}var i=e.dimensions;for(var n=i.length-1;n>=0;n--){var a=i[n];var o=e.getDimensionInfo(a);if(!o.isCalculationCoord){return a}}};r.prototype.getExtent=function(){return this._dataExtent.slice()};r.prototype.completeVisualOption=function(){var t=this.ecModel;var r=this.option;var e={inRange:r.inRange,outOfRange:r.outOfRange};var i=r.target||(r.target={});var n=r.controller||(r.controller={});y(i,e);y(n,e);var c=this.isCategory();a.call(this,i);a.call(this,n);o.call(this,i,"inRange","outOfRange");s.call(this,n);function a(e){if(kW(r.color)&&!e.inRange){e.inRange={color:r.color.slice().reverse()}}e.inRange=e.inRange||{color:t.get("gradientColor")}}function o(e,t,r){var i=e[t];var n=e[r];if(i&&!n){n=e[r]={};PW(i,function(e,t){if(!eL.isValidType(t)){return}var r=TW.get(t,"inactive",c);if(r!=null){n[t]=r;if(t==="color"&&!n.hasOwnProperty("opacity")&&!n.hasOwnProperty("colorAlpha")){n.opacity=[0,0]}}})}}function s(a){var o=(a.inRange||{}).symbol||(a.outOfRange||{}).symbol;var s=(a.inRange||{}).symbolSize||(a.outOfRange||{}).symbolSize;var l=this.get("inactiveColor");var e=this.getItemSymbol();var u=e||"roundRect";PW(this.stateList,function(e){var t=this.itemSize;var r=a[e];if(!r){r=a[e]={color:c?l:[l]}}if(r.symbol==null){r.symbol=o&&M(o)||(c?u:[u])}if(r.symbolSize==null){r.symbolSize=s&&M(s)||(c?t[0]:[t[0],t[0]])}r.symbol=AW(r.symbol,function(e){return e==="none"?u:e});var i=r.symbolSize;if(i!=null){var n=-Infinity;LW(i,function(e){e>n&&(n=e)});r.symbolSize=AW(i,function(e){return NW(e,[0,n],[0,t[0]],true)})}},this)}};r.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]};r.prototype.isCategory=function(){return!!this.option.categories};r.prototype.setSelected=function(e){};r.prototype.getSelected=function(){return null};r.prototype.getValueState=function(e){return null};r.prototype.getVisualMeta=function(e){return null};r.type="visualMap";r.dependencies=["series"];r.defaultOption={show:true,zlevel:0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:false,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}};return r}(p);var RW=[20,140];var zW=function(r){d(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;e.type=t.type;return e}t.prototype.optionUpdated=function(e,t){r.prototype.optionUpdated.apply(this,arguments);this.resetExtent();this.resetVisual(function(e){e.mappingMethod="linear";e.dataExtent=this.getExtent()});this._resetRange()};t.prototype.resetItemSize=function(){r.prototype.resetItemSize.apply(this,arguments);var e=this.itemSize;(e[0]==null||isNaN(e[0]))&&(e[0]=RW[0]);(e[1]==null||isNaN(e[1]))&&(e[1]=RW[1])};t.prototype._resetRange=function(){var e=this.getExtent();var t=this.option.range;if(!t||t.auto){e.auto=1;this.option.range=e}else if(k(t)){if(t[0]>t[1]){t.reverse()}t[0]=Math.max(t[0],e[0]);t[1]=Math.min(t[1],e[1])}};t.prototype.completeVisualOption=function(){r.prototype.completeVisualOption.apply(this,arguments);U(this.stateList,function(e){var t=this.option.controller[e].symbolSize;if(t&&t[0]!==t[1]){t[0]=t[1]/3}},this)};t.prototype.setSelected=function(e){this.option.range=e.slice();this._resetRange()};t.prototype.getSelected=function(){var e=this.getExtent();var t=Yn((this.get("range")||[]).slice());t[0]>e[1]&&(t[0]=e[1]);t[1]>e[1]&&(t[1]=e[1]);t[0]<e[0]&&(t[0]=e[0]);t[1]<e[0]&&(t[1]=e[0]);return t};t.prototype.getValueState=function(e){var t=this.option.range;var r=this.getExtent();return(t[0]<=r[0]||t[0]<=e)&&(t[1]>=r[1]||e<=t[1])?"inRange":"outOfRange"};t.prototype.findTargetDataIndices=function(i){var n=[];this.eachTargetSeries(function(e){var r=[];var t=e.getData();t.each(this.getDataDimension(t),function(e,t){i[0]<=e&&e<=i[1]&&r.push(t)},this);n.push({seriesId:e.id,dataIndex:r})},this);return n};t.prototype.getVisualMeta=function(r){var e=BW(this,"outOfRange",this.getExtent());var t=BW(this,"inRange",this.option.range.slice());var i=[];function n(e,t){i.push({value:e,color:r(e,t)})}var a=0;var o=0;var s=t.length;var l=e.length;for(;o<l&&(!t.length||e[o]<=t[0]);o++){if(e[o]<t[a]){n(e[o],"outOfRange")}}for(var u=1;a<s;a++,u=0){u&&i.length&&n(t[a],"outOfRange");n(t[a],"inRange")}for(var u=1;o<l;o++){if(!t.length||t[t.length-1]<e[o]){if(u){i.length&&n(i[i.length-1].value,"outOfRange");u=0}n(e[o],"outOfRange")}}var c=i.length;return{stops:i,outerColors:[c?i[0].color:"transparent",c?i[c-1].color:"transparent"]}};t.type="visualMap.continuous";t.defaultOption=Uh(EW.defaultOption,{align:"auto",calculable:false,hoverLink:true,realtime:true,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}});return t}(EW);function BW(e,t,r){if(r[0]===r[1]){return r.slice()}var i=200;var n=(r[1]-r[0])/i;var a=r[0];var o=[];for(var s=0;s<=i&&a<r[1];s++){o.push(a);a+=n}o.push(r[1]);return o}var VW=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e.autoPositionValues={left:1,right:1,top:1,bottom:1};return e}r.prototype.init=function(e,t){this.ecModel=e;this.api=t};r.prototype.render=function(e,t,r,i){this.visualMapModel=e;if(e.get("show")===false){this.group.removeAll();return}this.doRender(e,t,r,i)};r.prototype.renderBackground=function(e){var t=this.visualMapModel;var r=Vp(t.get("padding")||0);var i=e.getBoundingRect();e.add(new G({z2:-1,silent:true,shape:{x:i.x-r[3],y:i.y-r[0],width:i.width+r[3]+r[1],height:i.height+r[0]+r[2]},style:{fill:t.get("backgroundColor"),stroke:t.get("borderColor"),lineWidth:t.get("borderWidth")}}))};r.prototype.getControllerVisual=function(r,i,n){n=n||{};var e=n.forceState;var t=this.visualMapModel;var a={};if(i==="color"){var o=t.get("contentColor");a.color=o}function s(e){return a[e]}function l(e,t){a[e]=t}var u=t.controllerVisuals[e||t.getValueState(r)];var c=eL.prepareVisualTypes(u);U(c,function(e){var t=u[e];if(n.convertOpacityToAlpha&&e==="opacity"){e="colorAlpha";t=u.__alphaForOpacity}if(eL.dependsOn(e,i)){t&&t.applyVisual(r,s,l)}});return a[i]};r.prototype.positionGroup=function(e){var t=this.visualMapModel;var r=this.api;lv(e,t.getBoxLayoutParams(),{width:r.getWidth(),height:r.getHeight()})};r.prototype.doRender=function(e,t,r,i){};r.type="visualMap";return r}(My);var GW=[["left","right","width"],["top","bottom","height"]];function FW(e,t,r){var i=e.option;var n=i.align;if(n!=null&&n!=="auto"){return n}var a={width:t.getWidth(),height:t.getHeight()};var o=i.orient==="horizontal"?1:0;var s=GW[o];var l=[0,null,10];var u={};for(var c=0;c<3;c++){u[GW[1-o][c]]=l[c];u[s[c]]=c===2?r[0]:i[s[c]]}var f=[["x","width",3],["y","height",0]][o];var h=sv(u,a,i.padding);return s[(h.margin[f[2]]||0)+h[f[0]]+h[f[1]]*.5<a[f[1]]*.5?0:1]}function HW(e,t){U(e||[],function(e){if(e.dataIndex!=null){e.dataIndexInside=e.dataIndex;e.dataIndex=null}e.highlightKey="visualMap"+(t?t.componentIndex:"")});return e}var WW=V;var jW=U;var UW=Math.min;var ZW=Math.max;var YW=12;var XW=6;var qW=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;e._shapes={};e._dataInterval=[];e._handleEnds=[];e._hoverLinkDataIndices=[];return e}r.prototype.doRender=function(e,t,r,i){this._api=r;if(!i||i.type!=="selectDataRange"||i.from!==this.uid){this._buildView()}};r.prototype._buildView=function(){this.group.removeAll();var e=this.visualMapModel;var t=this.group;this._orient=e.get("orient");this._useHandle=e.get("calculable");this._resetInterval();this._renderBar(t);var r=e.get("text");this._renderEndsText(t,r,0);this._renderEndsText(t,r,1);this._updateView(true);this.renderBackground(t);this._updateView();this._enableHoverLinkToSeries();this._enableHoverLinkFromSeries();this.positionGroup(t)};r.prototype._renderEndsText=function(e,t,r){if(!t){return}var i=t[1-r];i=i!=null?i+"":"";var n=this.visualMapModel;var a=n.get("textGap");var o=n.itemSize;var s=this._shapes.mainGroup;var l=this._applyTransform([o[0]/2,r===0?-a:o[1]+a],s);var u=this._applyTransform(r===0?"bottom":"top",s);var c=this._orient;var f=this.visualMapModel.textStyleModel;this.group.add(new W({style:{x:l[0],y:l[1],verticalAlign:c==="horizontal"?"middle":u,align:c==="horizontal"?u:"center",text:i,font:f.getFont(),fill:f.getTextColor()}}))};r.prototype._renderBar=function(e){var t=this.visualMapModel;var r=this._shapes;var i=t.itemSize;var n=this._orient;var a=this._useHandle;var o=FW(t,this.api,i);var s=r.mainGroup=this._createBarGroup(o);var l=new H;s.add(l);l.add(r.outOfRange=JW());l.add(r.inRange=JW(null,a?$W(this._orient):null,x(this._dragHandle,this,"all",false),x(this._dragHandle,this,"all",true)));l.setClipPath(new G({shape:{x:0,y:0,width:i[0],height:i[1],r:3}}));var u=t.textStyleModel.getTextRect("");var c=ZW(u.width,u.height);if(a){r.handleThumbs=[];r.handleLabels=[];r.handleLabelPoints=[];this._createHandle(t,s,0,i,c,n);this._createHandle(t,s,1,i,c,n)}this._createIndicator(t,s,i,c,n);e.add(s)};r.prototype._createHandle=function(e,t,r,i,n,a){var o=x(this._dragHandle,this,r,false);var s=x(this._dragHandle,this,r,true);var l=yn(e.get("handleSize"),i[0]);var u=S0(e.get("handleIcon"),-l/2,-l/2,l,l,null,true);var c=$W(this._orient);u.attr({cursor:c,draggable:true,drift:o,ondragend:s,onmousemove:function(e){At(e.event)}});u.x=i[0]/2;u.useStyle(e.getModel("handleStyle").getItemStyle());u.setStyle({strokeNoScale:true,strokeFirst:true});u.style.lineWidth*=2;u.ensureState("emphasis").style=e.getModel(["emphasis","handleStyle"]).getItemStyle();oc(u,true);t.add(u);var f=this.visualMapModel.textStyleModel;var h=new W({cursor:c,draggable:true,drift:o,onmousemove:function(e){At(e.event)},ondragend:s,style:{x:0,y:0,text:"",font:f.getFont(),fill:f.getTextColor()}});h.ensureState("blur").style={opacity:.1};h.stateTransition={duration:200};this.group.add(h);var p=[l,0];var v=this._shapes;v.handleThumbs[r]=u;v.handleLabelPoints[r]=p;v.handleLabels[r]=h};r.prototype._createIndicator=function(e,t,r,i,n){var a=yn(e.get("indicatorSize"),r[0]);var o=S0(e.get("indicatorIcon"),-a/2,-a/2,a,a,null,true);o.attr({cursor:"move",invisible:true,silent:true,x:r[0]/2});var s=e.getModel("indicatorStyle").getItemStyle();if(o instanceof Rl){var l=o.style;o.useStyle(F({image:l.image,x:l.x,y:l.y,width:l.width,height:l.height},s))}else{o.useStyle(s)}t.add(o);var u=this.visualMapModel.textStyleModel;var c=new W({silent:true,invisible:true,style:{x:0,y:0,text:"",font:u.getFont(),fill:u.getTextColor()}});this.group.add(c);var f=[(n==="horizontal"?i/2:XW)+r[0]/2,0];var h=this._shapes;h.indicator=o;h.indicatorLabel=c;h.indicatorLabelPoint=f;this._firstShowIndicator=true};r.prototype._dragHandle=function(e,t,r,i){if(!this._useHandle){return}this._dragging=!t;if(!t){var n=this._applyTransform([r,i],this._shapes.mainGroup,true);this._updateInterval(e,n[1]);this._hideIndicator();this._updateView()}if(t===!this.visualMapModel.get("realtime")){this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()})}if(t){!this._hovering&&this._clearHoverLinkToSeries()}else if(QW(this.visualMapModel)){this._doHoverLinkToSeries(this._handleEnds[e],false)}};r.prototype._resetInterval=function(){var e=this.visualMapModel;var t=this._dataInterval=e.getSelected();var r=e.getExtent();var i=[0,e.itemSize[1]];this._handleEnds=[WW(t[0],r,i,true),WW(t[1],r,i,true)]};r.prototype._updateInterval=function(e,t){t=t||0;var r=this.visualMapModel;var i=this._handleEnds;var n=[0,r.itemSize[1]];WP(t,i,n,e,0);var a=r.getExtent();this._dataInterval=[WW(i[0],n,a,true),WW(i[1],n,a,true)]};r.prototype._updateView=function(e){var t=this.visualMapModel;var r=t.getExtent();var i=this._shapes;var n=[0,t.itemSize[1]];var a=e?n:this._handleEnds;var o=this._createBarVisual(this._dataInterval,r,a,"inRange");var s=this._createBarVisual(r,r,n,"outOfRange");i.inRange.setStyle({fill:o.barColor}).setShape("points",o.barPoints);i.outOfRange.setStyle({fill:s.barColor}).setShape("points",s.barPoints);this._updateHandle(a,o)};r.prototype._createBarVisual=function(e,t,r,i){var n={forceState:i,convertOpacityToAlpha:true};var a=this._makeColorGradient(e,n);var o=[this.getControllerVisual(e[0],"symbolSize",n),this.getControllerVisual(e[1],"symbolSize",n)];var s=this._createBarPoints(r,o);return{barColor:new Sf(0,0,0,1,a),barPoints:s,handlesColor:[a[0].color,a[a.length-1].color]}};r.prototype._makeColorGradient=function(e,t){var r=100;var i=[];var n=(e[1]-e[0])/r;i.push({color:this.getControllerVisual(e[0],"color",t),offset:0});for(var a=1;a<r;a++){var o=e[0]+n*a;if(o>e[1]){break}i.push({color:this.getControllerVisual(o,"color",t),offset:a/r})}i.push({color:this.getControllerVisual(e[1],"color",t),offset:1});return i};r.prototype._createBarPoints=function(e,t){var r=this.visualMapModel.itemSize;return[[r[0]-t[0],e[0]],[r[0],e[0]],[r[0],e[1]],[r[0]-t[1],e[1]]]};r.prototype._createBarGroup=function(e){var t=this._orient;var r=this.visualMapModel.get("inverse");return new H(t==="horizontal"&&!r?{scaleX:e==="bottom"?1:-1,rotation:Math.PI/2}:t==="horizontal"&&r?{scaleX:e==="bottom"?-1:1,rotation:-Math.PI/2}:t==="vertical"&&!r?{scaleX:e==="left"?1:-1,scaleY:-1}:{scaleX:e==="left"?1:-1})};r.prototype._updateHandle=function(a,o){if(!this._useHandle){return}var s=this._shapes;var l=this.visualMapModel;var u=s.handleThumbs;var c=s.handleLabels;var f=l.itemSize;var h=l.getExtent();jW([0,1],function(e){var t=u[e];t.setStyle("fill",o.handlesColor[e]);t.y=a[e];var r=WW(a[e],[0,f[1]],h,true);var i=this.getControllerVisual(r,"symbolSize");t.scaleX=t.scaleY=i/f[0];t.x=f[0]-i/2;var n=th(s.handleLabelPoints[e],eh(t,this.group));c[e].setStyle({x:n[0],y:n[1],text:l.formatValueText(this._dataInterval[e]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",s.mainGroup):"center"})},this)};r.prototype._showIndicator=function(e,t,r,i){var n=this.visualMapModel;var a=n.getExtent();var o=n.itemSize;var s=[0,o[1]];var l=this._shapes;var u=l.indicator;if(!u){return}u.attr("invisible",false);var c={convertOpacityToAlpha:true};var f=this.getControllerVisual(e,"color",c);var h=this.getControllerVisual(e,"symbolSize");var p=WW(e,a,s,true);var v=o[0]-h/2;var d={x:u.x,y:u.y};u.y=p;u.x=v;var g=th(l.indicatorLabelPoint,eh(u,this.group));var y=l.indicatorLabel;y.attr("invisible",false);var m=this._applyTransform("left",l.mainGroup);var x=this._orient;var _=x==="horizontal";y.setStyle({text:(r?r:"")+n.formatValueText(t),verticalAlign:_?m:"middle",align:_?"center":m});var b={x:v,y:p,style:{fill:f}};var w={style:{x:g[0],y:g[1]}};if(n.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var S={duration:100,easing:"cubicInOut",additive:true};u.x=d.x;u.y=d.y;u.animateTo(b,S);y.animateTo(w,S)}else{u.attr(b);y.attr(w)}this._firstShowIndicator=false;var M=this._shapes.handleLabels;if(M){for(var I=0;I<M.length;I++){this._api.enterBlur(M[I])}}};r.prototype._enableHoverLinkToSeries=function(){var i=this;this._shapes.mainGroup.on("mousemove",function(e){i._hovering=true;if(!i._dragging){var t=i.visualMapModel.itemSize;var r=i._applyTransform([e.offsetX,e.offsetY],i._shapes.mainGroup,true,true);r[1]=UW(ZW(0,r[1]),t[1]);i._doHoverLinkToSeries(r[1],0<=r[0]&&r[0]<=t[0])}}).on("mouseout",function(){i._hovering=false;!i._dragging&&i._clearHoverLinkToSeries()})};r.prototype._enableHoverLinkFromSeries=function(){var e=this.api.getZr();if(this.visualMapModel.option.hoverLink){e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this);e.on("mouseout",this._hideIndicator,this)}else{this._clearHoverLinkFromSeries()}};r.prototype._doHoverLinkToSeries=function(e,t){var r=this.visualMapModel;var i=r.itemSize;if(!r.option.hoverLink){return}var n=[0,i[1]];var a=r.getExtent();e=UW(ZW(n[0],e),n[1]);var o=KW(r,a,n);var s=[e-o,e+o];var l=WW(e,n,a,true);var u=[WW(s[0],n,a,true),WW(s[1],n,a,true)];s[0]<n[0]&&(u[0]=-Infinity);s[1]>n[1]&&(u[1]=Infinity);if(t){if(u[0]===-Infinity){this._showIndicator(l,u[1],"< ",o)}else if(u[1]===Infinity){this._showIndicator(l,u[0],"> ",o)}else{this._showIndicator(l,l," ",o)}}var c=this._hoverLinkDataIndices;var f=[];if(t||QW(r)){f=this._hoverLinkDataIndices=r.findTargetDataIndices(u)}var h=Ya(c,f);this._dispatchHighDown("downplay",HW(h[0],r));this._dispatchHighDown("highlight",HW(h[1],r))};r.prototype._hoverLinkFromSeriesMouseOver=function(e){var t=e.target;var r=this.visualMapModel;if(!t||j(t).dataIndex==null){return}var i=j(t);var n=this.ecModel.getSeriesByIndex(i.seriesIndex);if(!r.isTargetSeries(n)){return}var a=n.getData(i.dataType);var o=a.get(r.getDataDimension(a),i.dataIndex);if(!isNaN(o)){this._showIndicator(o,o)}};r.prototype._hideIndicator=function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",true);e.indicatorLabel&&e.indicatorLabel.attr("invisible",true);var t=this._shapes.handleLabels;if(t){for(var r=0;r<t.length;r++){this._api.leaveBlur(t[r])}}};r.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",HW(e,this.visualMapModel));e.length=0};r.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver);e.off("mouseout",this._hideIndicator)};r.prototype._applyTransform=function(e,t,r,i){var n=eh(t,i?null:this.group);return k(e)?th(e,n,r):rh(e,n,r)};r.prototype._dispatchHighDown=function(e,t){t&&t.length&&this.api.dispatchAction({type:e,batch:t})};r.prototype.dispose=function(){this._clearHoverLinkFromSeries();this._clearHoverLinkToSeries()};r.prototype.remove=function(){this._clearHoverLinkFromSeries();this._clearHoverLinkToSeries()};r.type="visualMap.continuous";return r}(VW);function JW(e,t,r,i){return new uf({shape:{points:e},draggable:!!r,cursor:t,drift:r,onmousemove:function(e){At(e.event)},ondragend:i})}function KW(e,t,r){var i=YW/2;var n=e.get("hoverLinkDataSize");if(n){i=WW(n,t,r,true)/2}return i}function QW(e){var t=e.get("hoverLinkOnHandle");return!!(t==null?e.get("realtime"):t)}function $W(e){return e==="vertical"?"ns-resize":"ew-resize"}var e9={type:"selectDataRange",event:"dataRangeSelected",update:"update"};var t9=function(t,e){e.eachComponent({mainType:"visualMap",query:t},function(e){e.setSelected(t.selected)})};var r9=[{createOnAllSeries:true,reset:function(r,e){var i=[];e.eachComponent("visualMap",function(e){var t=r.pipelineContext;if(!e.isTargetSeries(r)||t&&t.large){return}i.push(YG(e.stateList,e.targetVisuals,x(e.getValueState,e),e.getDataDimension(r.getData())))});return i}},{createOnAllSeries:true,reset:function(n,e){var a=n.getData();var o=[];e.eachComponent("visualMap",function(e){if(e.isTargetSeries(n)){var t=e.getVisualMeta(x(i9,null,n,e))||{stops:[],outerColors:[]};var r=e.getDataDimension(a);var i=a.getDimensionInfo(r);if(i!=null){t.dimension=i.index;o.push(t)}}});n.getData().setVisual("visualMeta",o)}}];function i9(e,t,r,i){var n=t.targetVisuals[i];var a=eL.prepareVisualTypes(n);var o={color:wm(e.getData(),"color")};for(var s=0,l=a.length;s<l;s++){var u=a[s];var c=n[u==="opacity"?"__alphaForOpacity":u];c&&c.applyVisual(r,f,h)}return o.color;function f(e){return o[e]}function h(e,t){o[e]=t}}var n9=U;function a9(e){var t=e&&e.visualMap;if(!k(t)){t=t?[t]:[]}n9(t,function(e){if(!e){return}if(o9(e,"splitList")&&!o9(e,"pieces")){e.pieces=e.splitList;delete e.splitList}var t=e.pieces;if(t&&k(t)){n9(t,function(e){if(O(e)){if(o9(e,"start")&&!o9(e,"min")){e.min=e.start}if(o9(e,"end")&&!o9(e,"max")){e.max=e.end}}})}})}function o9(e,t){return e&&e.hasOwnProperty&&e.hasOwnProperty(t)}var s9=false;function l9(t){if(s9){return}s9=true;t.registerSubTypeDefaulter("visualMap",function(e){return!e.categories&&(!(e.pieces?e.pieces.length>0:e.splitNumber>0)||e.calculable)?"continuous":"piecewise"});t.registerAction(e9,t9);U(r9,function(e){t.registerVisual(t.PRIORITY.VISUAL.COMPONENT,e)});t.registerPreprocessor(a9)}function u9(e){e.registerComponentModel(zW);e.registerComponentView(qW);l9(e)}var c9=function(o){d(t,o);function t(){var e=o!==null&&o.apply(this,arguments)||this;e.type=t.type;e._pieceList=[];return e}t.prototype.optionUpdated=function(e,t){o.prototype.optionUpdated.apply(this,arguments);this.resetExtent();var r=this._mode=this._determineMode();this._pieceList=[];f9[this._mode].call(this,this._pieceList);this._resetSelected(e,t);var i=this.option.categories;this.resetVisual(function(e,t){if(r==="categories"){e.mappingMethod="category";e.categories=M(i)}else{e.dataExtent=this.getExtent();e.mappingMethod="piecewise";e.pieceList=A(this._pieceList,function(e){e=M(e);if(t!=="inRange"){e.visual=null}return e})}})};t.prototype.completeVisualOption=function(){var i=this.option;var r={};var e=eL.listVisualTypes();var n=this.isCategory();U(i.pieces,function(t){U(e,function(e){if(t.hasOwnProperty(e)){r[e]=1}})});U(r,function(e,t){var r=false;U(this.stateList,function(e){r=r||a(i,e,t)||a(i.target,e,t)},this);!r&&U(this.stateList,function(e){(i[e]||(i[e]={}))[t]=TW.get(t,e==="inRange"?"active":"inactive",n)})},this);function a(e,t,r){return e&&e[t]&&e[t].hasOwnProperty(r)}o.prototype.completeVisualOption.apply(this,arguments)};t.prototype._resetSelected=function(e,t){var r=this.option;var i=this._pieceList;var n=(t?r:e).selected||{};r.selected=n;U(i,function(e,t){var r=this.getSelectedMapKey(e);if(!n.hasOwnProperty(r)){n[r]=true}},this);if(r.selectedMode==="single"){var a=false;U(i,function(e,t){var r=this.getSelectedMapKey(e);if(n[r]){a?n[r]=false:a=true}},this)}};t.prototype.getItemSymbol=function(){return this.get("itemSymbol")};t.prototype.getSelectedMapKey=function(e){return this._mode==="categories"?e.value+"":e.index+""};t.prototype.getPieceList=function(){return this._pieceList};t.prototype._determineMode=function(){var e=this.option;return e.pieces&&e.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"};t.prototype.setSelected=function(e){this.option.selected=M(e)};t.prototype.getValueState=function(e){var t=eL.findPieceIndex(e,this._pieceList);return t!=null?this.option.selected[this.getSelectedMapKey(this._pieceList[t])]?"inRange":"outOfRange":"outOfRange"};t.prototype.findTargetDataIndices=function(n){var r=[];var a=this._pieceList;this.eachTargetSeries(function(e){var i=[];var t=e.getData();t.each(this.getDataDimension(t),function(e,t){var r=eL.findPieceIndex(e,a);r===n&&i.push(t)},this);r.push({seriesId:e.id,dataIndex:i})},this);return r};t.prototype.getRepresentValue=function(e){var t;if(this.isCategory()){t=e.value}else{if(e.value!=null){t=e.value}else{var r=e.interval||[];t=r[0]===-Infinity&&r[1]===Infinity?0:(r[0]+r[1])/2}}return t};t.prototype.getVisualMeta=function(n){if(this.isCategory()){return}var a=[];var o=["",""];var s=this;function r(e,t){var r=s.getRepresentValue({interval:e});if(!t){t=s.getValueState(r)}var i=n(r,t);if(e[0]===-Infinity){o[0]=i}else if(e[1]===Infinity){o[1]=i}else{a.push({value:e[0],color:i},{value:e[1],color:i})}}var e=this._pieceList.slice();if(!e.length){e.push({interval:[-Infinity,Infinity]})}else{var t=e[0].interval[0];t!==-Infinity&&e.unshift({interval:[-Infinity,t]});t=e[e.length-1].interval[1];t!==Infinity&&e.push({interval:[t,Infinity]})}var i=-Infinity;U(e,function(e){var t=e.interval;if(t){t[0]>i&&r([i,t[0]],"outOfRange");r(t.slice());i=t[1]}},this);return{stops:a,outerColors:o}};t.type="visualMap.piecewise";t.defaultOption=Uh(EW.defaultOption,{selected:null,minOpen:false,maxOpen:false,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:true});return t}(EW);var f9={splitNumber:function(e){var t=this.option;var r=Math.min(t.precision,20);var i=this.getExtent();var n=t.splitNumber;n=Math.max(parseInt(n,10),1);t.splitNumber=n;var a=(i[1]-i[0])/n;while(+a.toFixed(r)!==a&&r<5){r++}t.precision=r;a=+a.toFixed(r);if(t.minOpen){e.push({interval:[-Infinity,i[0]],close:[0,0]})}for(var o=0,s=i[0];o<n;s+=a,o++){var l=o===n-1?i[1]:s+a;e.push({interval:[s,l],close:[1,1]})}if(t.maxOpen){e.push({interval:[i[1],Infinity],close:[0,0]})}la(e);U(e,function(e,t){e.index=t;e.text=this.formatValueText(e.interval)},this)},categories:function(t){var e=this.option;U(e.categories,function(e){t.push({text:this.formatValueText(e,true),value:e})},this);h9(e,t)},pieces:function(h){var e=this.option;U(e.pieces,function(e,t){if(!O(e)){e={value:e}}var r={text:"",index:t};if(e.label!=null){r.text=e.label}if(e.hasOwnProperty("value")){var i=r.value=e.value;r.interval=[i,i];r.close=[1,1]}else{var n=r.interval=[];var a=r.close=[0,0];var o=[1,0,1];var s=[-Infinity,Infinity];var l=[];for(var u=0;u<2;u++){var c=[["gte","gt","min"],["lte","lt","max"]][u];for(var f=0;f<3&&n[u]==null;f++){n[u]=e[c[f]];a[u]=o[f];l[u]=f===2}n[u]==null&&(n[u]=s[u])}l[0]&&n[1]===Infinity&&(a[0]=0);l[1]&&n[0]===-Infinity&&(a[1]=0);if("development"!=="production"){if(n[0]>n[1]){console.warn("Piece "+t+"is illegal: "+n+" lower bound should not greater then uppper bound.")}}if(n[0]===n[1]&&a[0]&&a[1]){r.value=n[0]}}r.visual=eL.retrieveVisuals(e);h.push(r)},this);h9(e,h);la(h);U(h,function(e){var t=e.close;var r=[["<",""][t[1]],[">",""][t[0]]];e.text=e.text||this.formatValueText(e.value!=null?e.value:e.interval,false,r)},this)}};function h9(e,t){var r=e.inverse;if(e.orient==="vertical"?!r:r){t.reverse()}}var p9=function(t){d(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.type=r.type;return e}r.prototype.doRender=function(){var a=this.group;a.removeAll();var o=this.visualMapModel;var s=o.get("textGap");var e=o.textStyleModel;var l=e.getFont();var u=e.getTextColor();var c=this._getItemAlign();var f=o.itemSize;var t=this._getViewData();var r=t.endsText;var h=be(o.get("showLabel",true),!r);r&&this._renderEndsText(a,r[0],f,h,c);U(t.viewPieceList,function(e){var t=e.piece;var r=new H;r.onclick=x(this._onItemClick,this,t);this._enableHoverLink(r,e.indexInModelPieceList);var i=o.getRepresentValue(t);this._createItemSymbol(r,i,[0,0,f[0],f[1]]);if(h){var n=this.visualMapModel.getValueState(i);r.add(new W({style:{x:c==="right"?-s:f[0]+s,y:f[1]/2,text:t.text,verticalAlign:"middle",align:c,font:l,fill:u,opacity:n==="outOfRange"?.5:1}}))}a.add(r)},this);r&&this._renderEndsText(a,r[1],f,h,c);iv(o.get("orient"),a,o.get("itemGap"));this.renderBackground(a);this.positionGroup(a)};r.prototype._enableHoverLink=function(e,r){var i=this;e.on("mouseover",function(){return t("highlight")}).on("mouseout",function(){return t("downplay")});var t=function(e){var t=i.visualMapModel;t.option.hoverLink&&i.api.dispatchAction({type:e,batch:HW(t.findTargetDataIndices(r),t)})}};r.prototype._getItemAlign=function(){var e=this.visualMapModel;var t=e.option;if(t.orient==="vertical"){return FW(e,this.api,e.itemSize)}else{var r=t.align;if(!r||r==="auto"){r="left"}return r}};r.prototype._renderEndsText=function(e,t,r,i,n){if(!t){return}var a=new H;var o=this.visualMapModel.textStyleModel;a.add(new W({style:{x:i?n==="right"?r[0]:0:r[0]/2,y:r[1]/2,verticalAlign:"middle",align:i?n:"center",text:t,font:o.getFont(),fill:o.getTextColor()}}));e.add(a)};r.prototype._getViewData=function(){var e=this.visualMapModel;var t=A(e.getPieceList(),function(e,t){return{piece:e,indexInModelPieceList:t}});var r=e.get("text");var i=e.get("orient");var n=e.get("inverse");if(i==="horizontal"?n:!n){t.reverse()}else if(r){r=r.slice().reverse()}return{viewPieceList:t,endsText:r}};r.prototype._createItemSymbol=function(e,t,r){e.add(S0(this.getControllerVisual(t,"symbol"),r[0],r[1],r[2],r[3],this.getControllerVisual(t,"color")))};r.prototype._onItemClick=function(e){var t=this.visualMapModel;var r=t.option;var i=M(r.selected);var n=t.getSelectedMapKey(e);if(r.selectedMode==="single"){i[n]=true;U(i,function(e,t){i[t]=t===n})}else{i[n]=!i[n]}this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:i})};r.type="visualMap.piecewise";return r}(VW);function v9(e){e.registerComponentModel(c9);e.registerComponentView(p9);l9(e)}function d9(e){t(u9);t(v9)}var g9={label:{enabled:true},decal:{show:false}};var y9=qa();var m9={};function x9(h,c){var f=h.getModel("aria");if(!f.get("enabled")){return}var e=M(g9);y(e.label,h.getLocaleModel().get("aria"),false);y(f.option,e,false);t();r();function t(){var e=f.getModel("decal");var t=e.get("show");if(t){var r=I();h.eachSeries(function(e){if(!e.useColorPaletteOnData){return}var t=r.get(e.type);if(!t){t={};r.set(e.type,t)}y9(e).scope=t});h.eachRawSeries(function(a){if(h.isSeriesFiltered(a)){return}if(typeof a.enableAriaDecal==="function"){a.enableAriaDecal();return}var o=a.getData();if(a.useColorPaletteOnData){var s=a.getRawData();var l={};var u=y9(a).scope;o.each(function(e){var t=o.getRawIndex(e);l[t]=e});var c=s.count();s.each(function(e){var t=l[e];var r=s.getName(e)||e+"";var i=Wv(a.ecModel,r,u,c);var n=o.getItemVisual(t,"decal");o.setItemVisual(t,"decal",f(n,i))})}else{var e=Wv(a.ecModel,a.name,m9,h.getSeriesCount());var t=o.getVisual("decal");o.setVisual("decal",f(t,e))}function f(e,t){var r=e?F(F({},t),e):t;r.dirty=true;return r}})}}function r(){var e=h.getLocaleModel().get("aria");var v=f.getModel("label");v.option=R(v.option,e);if(!v.get("enabled")){return}var t=c.getZr().dom;if(v.get("description")){t.setAttribute("aria-label",v.get("description"));return}var d=h.getSeriesCount();var g=v.get(["data","maxCount"])||10;var r=v.get(["series","maxCount"])||10;var y=Math.min(d,r);var i;if(d<1){return}else{var n=p();if(n){var a=v.get(["general","withTitle"]);i=x(a,{title:n})}else{i=v.get(["general","withoutTitle"])}var m=[];var o=d>1?v.get(["series","multiple","prefix"]):v.get(["series","single","prefix"]);i+=x(o,{seriesCount:d});h.eachSeries(function(e,t){if(t<y){var r=void 0;var i=e.get("name");var n=i?"withName":"withoutName";r=d>1?v.get(["series","multiple",n]):v.get(["series","single",n]);r=x(r,{seriesId:e.seriesIndex,seriesName:e.get("name"),seriesType:_(e.subType)});var a=e.getData();if(a.count()>g){var o=v.get(["data","partialData"]);r+=x(o,{displayCnt:g})}else{r+=v.get(["data","allData"])}var s=[];for(var l=0;l<a.count();l++){if(l<g){var u=a.getName(l);var c=yg(a,l);var f=v.get(["data",u?"withName":"withoutName"]);s.push(x(f,{name:u,value:c}))}}var h=v.get(["data","separator","middle"]);var p=v.get(["data","separator","end"]);r+=s.join(h)+p;m.push(r)}});var s=v.getModel(["series","multiple","separator"]);var l=s.get("middle");var u=s.get("end");i+=m.join(l)+u;t.setAttribute("aria-label",i)}}function x(e,t){if(typeof e!=="string"){return e}var r=e;U(t,function(e,t){r=r.replace(new RegExp("\\{\\s*"+t+"\\s*\\}","g"),e)});return r}function p(){var e=h.get("title");if(e&&e.length){e=e[0]}return e&&e.text}function _(e){return h.getLocaleModel().get(["series","typeNames"])[e]||""}}function _9(e){if(!e||!e.aria){return}var t=e.aria;if(t.show!=null){t.enabled=t.show}t.label=t.label||{};U(["description","general","series","data"],function(e){if(t[e]!=null){t.label[e]=t[e]}})}function b9(e){e.registerPreprocessor(_9);e.registerVisual(e.PRIORITY.VISUAL.ARIA,x9)}var w9={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"};var S9=function(){function e(e){var t=this._condVal=P(e)?new RegExp(e):xe(e)?e:null;if(t==null){var r="";if("development"!=="production"){r=wa("Illegal regexp",e,"in")}g(r)}}e.prototype.evaluate=function(e){var t=typeof e;return t==="string"?this._condVal.test(e):t==="number"?this._condVal.test(e+""):false};return e}();var M9=function(){function e(){}e.prototype.evaluate=function(){return this.value};return e}();var I9=function(){function e(){}e.prototype.evaluate=function(){var e=this.children;for(var t=0;t<e.length;t++){if(!e[t].evaluate()){return false}}return true};return e}();var C9=function(){function e(){}e.prototype.evaluate=function(){var e=this.children;for(var t=0;t<e.length;t++){if(e[t].evaluate()){return true}}return false};return e}();var T9=function(){function e(){}e.prototype.evaluate=function(){return!this.child.evaluate()};return e}();var D9=function(){function e(){}e.prototype.evaluate=function(){var e=!!this.valueParser;var t=this.getValue;var r=t(this.valueGetterParam);var i=e?this.valueParser(r):null;for(var n=0;n<this.subCondList.length;n++){if(!this.subCondList[n].evaluate(e?i:r)){return false}}return true};return e}();function A9(e,t){if(e===true||e===false){var r=new M9;r.value=e;return r}var i="";if(!O9(e)){if("development"!=="production"){i=wa("Illegal config. Expect a plain object but actually",e)}g(i)}if(e.and){return L9("and",e,t)}else if(e.or){return L9("or",e,t)}else if(e.not){return k9(e,t)}return P9(e,t)}function L9(e,t,r){var i=t[e];var n="";if("development"!=="production"){n=wa('"and"/"or" condition should only be `'+e+": [...]` and must not be empty array.","Illegal condition:",t)}if(!k(i)){g(n)}if(!i.length){g(n)}var a=e==="and"?new I9:new C9;a.children=A(i,function(e){return A9(e,r)});if(!a.children.length){g(n)}return a}function k9(e,t){var r=e.not;var i="";if("development"!=="production"){i=wa('"not" condition should only be `not: {}`.',"Illegal condition:",e)}if(!O9(r)){g(i)}var n=new T9;n.child=A9(r,t);if(!n.child){g(i)}return n}function P9(e,t){var r="";var i=t.prepareGetValue(e);var n=[];var a=L(e);var o=e.parser;var s=o?Cg(o):null;for(var l=0;l<a.length;l++){var u=a[l];if(u==="parser"||t.valueGetterAttrMap.get(u)){continue}var c=z(w9,u)?w9[u]:u;var f=e[u];var h=s?s(f):f;var p=kg(c,h)||c==="reg"&&new S9(h);if(!p){if("development"!=="production"){r=wa('Illegal relational operation: "'+u+'" in condition:',e)}g(r)}n.push(p)}if(!n.length){if("development"!=="production"){r=wa("Relational condition must have at least one operator.","Illegal condition:",e)}g(r)}var v=new D9;v.valueGetterParam=i;v.valueParser=s;v.getValue=t.getValue;v.subCondList=n;return v}function O9(e){return O(e)&&!se(e)}var N9=function(){function e(e,t){this._cond=A9(e,t)}e.prototype.evaluate=function(){return this._cond.evaluate()};return e}();function E9(e,t){return new N9(e,t)}var R9={type:"echarts:filter",transform:function(e){var n=e.upstream;var t;var r=E9(e.config,{valueGetterAttrMap:I({dimension:true}),prepareGetValue:function(e){var t="";var r=e.dimension;if(!z(e,"dimension")){if("development"!=="production"){t=wa('Relation condition must has prop "dimension" specified.',"Illegal condition:",e)}g(t)}var i=n.getDimensionInfo(r);if(!i){if("development"!=="production"){t=wa("Can not find dimension info via: "+r+".\n","Existing dimensions: ",n.cloneAllDimensionInfo(),".\n","Illegal condition:",e,".\n")}g(t)}return{dimIdx:i.index}},getValue:function(e){return n.retrieveValueFromItem(t,e.dimIdx)}});var i=[];for(var a=0,o=n.count();a<o;a++){t=n.getRawDataItem(a);if(r.evaluate()){i.push(t)}}return{data:i}}};var z9="";if("development"!=="production"){z9=["Valid config is like:",'{ dimension: "age", order: "asc" }','or [{ dimension: "age", order: "asc"], { dimension: "date", order: "desc" }]'].join(" ")}var B9={type:"echarts:sort",transform:function(e){var u=e.upstream;var t=e.config;var c="";var r=Ia(t);if(!r.length){if("development"!=="production"){c="Empty `config` in sort transform."}g(c)}var f=[];U(r,function(e){var t=e.dimension;var r=e.order;var i=e.parser;var n=e.incomparable;if(t==null){if("development"!=="production"){c='Sort transform config must has "dimension" specified.'+z9}g(c)}if(r!=="asc"&&r!=="desc"){if("development"!=="production"){c='Sort transform config must has "order" specified.'+z9}g(c)}if(n&&n!=="min"&&n!=="max"){var a="";if("development"!=="production"){a='incomparable must be "min" or "max" rather than "'+n+'".'}g(a)}if(r!=="asc"&&r!=="desc"){var o="";if("development"!=="production"){o='order must be "asc" or "desc" rather than "'+r+'".'}g(o)}var s=u.getDimensionInfo(t);if(!s){if("development"!=="production"){c=wa("Can not find dimension info via: "+t+".\n","Existing dimensions: ",u.cloneAllDimensionInfo(),".\n","Illegal config:",e,".\n")}g(c)}var l=i?Cg(i):null;if(i&&!l){if("development"!=="production"){c=wa("Invalid parser name "+i+".\n","Illegal config:",e,".\n")}g(c)}f.push({dimIdx:s.index,parser:l,comparator:new Ag(r,n)})});var i=u.sourceFormat;if(i!==bv&&i!==wv){if("development"!=="production"){c='sourceFormat "'+i+'" is not supported yet'}g(c)}var n=[];for(var a=0,o=u.count();a<o;a++){n.push(u.getRawDataItem(a))}n.sort(function(e,t){for(var r=0;r<f.length;r++){var i=f[r];var n=u.retrieveValueFromItem(e,i.dimIdx);var a=u.retrieveValueFromItem(t,i.dimIdx);if(i.parser){n=i.parser(n);a=i.parser(a)}var o=i.comparator.evaluate(n,a);if(o!==0){return o}}return 0});return{data:n}}};function V9(e){e.registerTransform(R9);e.registerTransform(B9)}var G9=function(i){d(e,i);function e(){var e=i!==null&&i.apply(this,arguments)||this;e.type="dataset";return e}e.prototype.init=function(e,t,r){i.prototype.init.call(this,e,t,r);this._sourceManager=new Wg(this);jg(this)};e.prototype.mergeOption=function(e,t){i.prototype.mergeOption.call(this,e,t);jg(this)};e.prototype.optionUpdated=function(){this._sourceManager.dirty()};e.prototype.getSourceManager=function(){return this._sourceManager};e.type="dataset";e.defaultOption={seriesLayoutBy:Cv};return e}(p);var F9=function(t){d(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.type="dataset";return e}e.type="dataset";return e}(My);function H9(e){e.registerComponentModel(G9);e.registerComponentView(F9)}t([bI]);t([uI]);t([yC,jC,s2,bT,zT,DD,_A,UL,iP,fP,_P,vN,jN,sE,kE,BE,$E,sR,ER,WR,az,dB]);t(u3);t(U3);t(TD);t(cV);t(pN);t(xV);t(OV);t(iG);t(BG);t(l3);t(dF);t(mF);t(RF);t(iH);t(pH);t(MH);t(qH);t(CW);t(cW);t(IW);t(d9);t(u9);t(v9);t(b9);t(V9);t(H9);e.Axis=$S;e.ChartView=v;e.ComponentModel=p;e.ComponentView=My;e.List=qb;e.Model=C;e.PRIORITY=H_;e.SeriesModel=dy;e.color=Fr;e.connect=H1;e.dataTool=fb;e.dependencies=I_;e.disConnect=W1;e.disconnect=j1;e.dispose=U1;e.env=S;e.extendChartView=aM;e.extendComponentModel=rM;e.extendComponentView=iM;e.extendSeriesModel=nM;e.format=ES;e.getCoordinateSystemDimensions=tb;e.getInstanceByDom=Z1;e.getInstanceById=Y1;e.getMap=ub;e.graphic=NS;e.helper=kS;e.init=F1;e.innerDrawElementOnCanvas=$0;e.matrix=Fi;e.number=PS;e.parseGeoJSON=$x;e.parseGeoJson=$x;e.registerAction=$1;e.registerCoordinateSystem=eb;e.registerLayout=rb;e.registerLoading=ob;e.registerLocale=ep;e.registerMap=lb;e.registerPostInit=K1;e.registerPostUpdate=Q1;e.registerPreprocessor=q1;e.registerProcessor=J1;e.registerTheme=X1;e.registerTransform=cb;e.registerVisual=ib;e.setCanvasCreator=sb;e.throttle=Ry;e.time=OS;e.use=t;e.util=RS;e.vector=at;e.version=M_;e.zrUtil=Oe;e.zrender=Hn;Object.defineProperty(e,"__esModule",{value:true})});